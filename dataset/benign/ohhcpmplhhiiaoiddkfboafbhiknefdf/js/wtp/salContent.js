var salContent;(()=>{"use strict";var e={};function t(){return-1!=navigator.userAgent.indexOf("Firefox")}function n(){return t()?browser:chrome}function o(){n().storage.local.get("debug",e=>{e.debug&&console&&console.log&&console.log.apply(this,arguments)})}function a(){console&&console.error&&console.error.apply(this,arguments)}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const r={isFirefox:t,getBrowser:n,logInfo:o,logError:a,getCurrentLocale:function e(){void 0===e.locale_map&&TMExt_$.ajax({url:getURL("settings.json"),async:!1,dataType:"json",success:function(t){o(t),e.locale_map=t.supportLanguage,e.default_lang=t.defaultLanguage,e.l10n_map=t.l10nFolderMap}});let t=navigator.language,n=!1,a=e.locale_map,r="";for(var s=0;s<a.length;++s)if(a[s].includes(t)){r=a[s],n=!0;break}n||(r=e.default_lang);let i=r;return void 0!==e.l10n_map[r]&&(i=e.l10n_map[r]),i},tbc_sendRequest:function(e,t,o){var a={action:e,params:t};n().runtime.sendMessage(a,o)},getBankingList:async function(){let e=[];try{const t=await fetch(n().runtime.getURL("PbBankingList.txt"));e=(await t.text()).split("\n")}catch(e){a("getBankingList: e = "+e)}return o("getBankingList: size of banking list = "+e.length),e},binarySearch:function e(t,n,o,a){if(a<o)return-1;if(a-o<=1)return n===t[o]?o:n===t[a]?a:-1;let r=Math.floor((o+a)/2);return t[r]===n?r:t[r]<n?e(t,n,r,a):t[r]>n?e(t,n,o,r):-1},sendMessageToActiveTab:function(e){return new Promise((t,o)=>{const a=n();a.tabs.query({active:!0,currentWindow:!0},n=>{n.length<=0?t(!1):a.tabs.sendMessage(n[0].id,e,()=>{a.runtime.lastError&&o(a.runtime.lastError.message)})})})},sha256:async function(e){let t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return[...new Uint8Array(n)].map(e=>e.toString(16).padStart(2,"0")).join("")},Lock:class{constructor(){this._locked=!1,this._waiting=[]}async acquire(){for(;this._locked;)await new Promise(e=>this._waiting.push(e));this._locked=!0}release(){this._locked=!1,this._waiting.length>0&&this._waiting.shift()()}}};let s=n();const i=function(e){return new Promise(t=>{s.storage.local.get(e,e=>{t(e)})})},c=r.getBrowser(),l="[SAL][Content]";function u(e,t){c.runtime.sendMessage({action:"tbb_sal_scan",params:{params:{url:e,head:"HTTP/1.1 200 OK \n        Server: Response_header/Fake\n        Product: Titanium/17\n        Content-Length: 30000\n        Content-Type: text/html\n        Connection: Keep-alive\n        ",doc:t,time:Math.floor((new Date).getTime()/1e3)}}})}function d(e){e.addEventListener("load",()=>{e.src&&e.contentDocument&&u(e.src,e.contentDocument.documentElement.innerHTML)})}const g=async()=>{let e=await i({framework_status:!1});e.framework_status?(e=await i({wtp_sal_status:!1}),r.logInfo(l,"storageData = "+JSON.stringify(e)),e.wtp_sal_status?document.URL&&document.documentElement.innerHTML?(u(document.URL,document.documentElement.innerHTML),document.querySelectorAll("iframe").forEach(e=>{d(e)}),new MutationObserver(function(e){e.forEach(function(e){if(e.addedNodes.length)for(var t=0;t<e.addedNodes.length;t++){var n=e.addedNodes[t];"IFRAME"===n.nodeName&&d(n)}})}).observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),c.runtime.onMessage.addListener(e=>{e.hasOwnProperty("action")&&"tbb_tab_state_changed_fullscreen"===e.action&&(r.logInfo(l,"Trigger SAL scan due to tab state changed to fullscreen"),u(document.URL,document.documentElement.innerHTML))})):r.logInfo(l,"no document URL or content"):r.logInfo(l,"SAL is disabled")):setTimeout(()=>{g()},500)};g(),salContent=e})();