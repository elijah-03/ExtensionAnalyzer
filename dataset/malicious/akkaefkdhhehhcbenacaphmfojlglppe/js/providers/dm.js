const DMProvider=class extends AbstractProvider{search(){const a=this.getIdFromLocation();a&&!this.ids[a]&&this.addVideo(a)}getIdFromLocation(){return /^\/\w{0,2}$/.test(location.pathname)?null:location.pathname.replace("/video/","")}getVideoData(a,b){this.getConfig(a,c=>{const d=c.context.metadata_template_url.replace(":videoId",a);this.getMetaData(d,a=>{const c=a.title,d=a.qualities.auto||[],e=d[0];return e&&e.url?void chrome.runtime.sendMessage({action:"ajaxGet",url:e.url},a=>{const d=this.parseM3u8(a),e=this.removeVideoDuplicates(d).map(a=>({title:c||a.NAME,quality:a.RESOLUTION||"",url:a["PROGRESSIVE-URI"]}));"function"==typeof this.mediaUpdateListener&&this.mediaUpdateListener({videos:e}),b(e)}):b([])})})}getConfig(a,b){chrome.runtime.sendMessage({action:"ajaxGet",url:"https://www.dailymotion.com/video/"+a},a=>{const c=/var __PLAYER_CONFIG__ = (.+?);</m.exec(a),d=c[1],e=JSON.parse(d);b(e)})}parseM3u8(a=""){const b=(a="")=>{const[b,c]=a.replace(/(?<=[A-Z])=/g,"|").split("|");return b&&c?{[b.trim()]:c.trim()}:{}},c=a.split("\n").slice(1,-1).filter((a,b)=>(b+1)%2).map(a=>{const c=a.replace("#EXT-X-STREAM-INF:","").replace(/\"/g,"").split(",").reduce((a,c)=>({...a,...b(c)}),{});return c}).filter(a=>!!a["PROGRESSIVE-URI"]);return c}removeVideoDuplicates(a){const b={};return a.filter(a=>{const c=`${a.NAME}_${a.RESOLUTION}`,d=(c in b);return b[c]=!0,d})}getMetaData(a,b){chrome.runtime.sendMessage({action:"ajaxGet",url:a},a=>{const c=JSON.parse(a);b(c)})}registerMediaUpdateListener(a){this.mediaUpdateListener=a}itinializeMessageListeners(){chrome.runtime.onMessage.addListener(a=>{"pageUpdated"===a.action&&($(`.${INIT_CLASS}`).removeClass(INIT_CLASS),this.videos=[],this.setBadge(),this.ids={},this.passMediaBack({videos:this.videos}))})}};