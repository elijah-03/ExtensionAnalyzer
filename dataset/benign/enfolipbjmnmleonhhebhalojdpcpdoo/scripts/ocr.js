function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var r="image/png",n="image/jpeg",a="p".charCodeAt(0),o="H".charCodeAt(0),i="Y".charCodeAt(0),s="s".charCodeAt(0),c=function(){for(var e=new Int32Array(256),t=0;t<256;t+=1){for(var r=t,n=0;n<8;n+=1)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}(),l=function(e,t,l){var g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=t;if(l===n)return e[13]=1,e[14]=d>>8,e[15]=255&d,e[16]=d>>8,e[17]=255&d,e;if(l===r){var m=new Uint8Array(13);d*=39.3701,m[0]=a,m[1]=o,m[2]=i,m[3]=s,m[4]=d>>>24,m[5]=d>>>16,m[6]=d>>>8,m[7]=255&d,m[8]=m[4],m[9]=m[5],m[10]=m[6],m[11]=m[7],m[12]=1;var u=function(e){for(var t=-1,r=0;r<e.length;r+=1)t=c[255&(t^e[r])]^t>>>8;return-1^t}(m),h=new Uint8Array(4);if(h[0]=u>>>24,h[1]=u>>>16,h[2]=u>>>8,h[3]=255&u,g){var f=function(e){for(var t=e.length-1;t>=4;t-=1)if(9===e[t-4]&&e[t-3]===a&&e[t-2]===o&&e[t-1]===i&&e[t]===s)return t-3;return-1}(e);return e.set(m,f),e.set(h,f+13),e}var w=new Uint8Array(4);w[0]=0,w[1]=0,w[2]=0,w[3]=9;var v=new Uint8Array(54);return v.set(e,0),v.set(w,33),v.set(m,37),v.set(h,50),v}return null};window.addEventListener("message",async e=>{if("doOcr"===e.data.type){const t=await m(e.data.imageDataURI);t.type="resultOfOCR",e.source.postMessage(t,e.data.mainUrl)}});const g={};let d=null;const m=t=>new Promise(a=>{console.time("Total Runtime: "),d||(d=Tesseract.createScheduler()),console.log("Loading Tesseract"),console.time("Loading Tesseract: "),new Promise(async e=>{var t;if(g.workerEng)return void e();let r="tesseract/tesseract-core.asm.js";(null===(t=navigator.userAgentData)||void 0===t?void 0:t.brands.find(({brand:e,version:t})=>"Chromium"===e&&parseFloat(t,10)>=102))&&(r="tesseract/tesseract-core-simd.wasm.js"),g.workerEng=await Tesseract.createWorker({workerBlobURL:!1,workerPath:chrome.runtime.getURL("tesseract/worker.min.js"),corePath:chrome.runtime.getURL(r),langPath:chrome.runtime.getURL("tesseract/traineddata"),gzip:!1}),await g.workerEng.load(),await g.workerEng.loadLanguage("eng"),await g.workerEng.initialize("eng"),await g.workerEng.setParameters({tessedit_pageseg_mode:Tesseract.PSM.AUTO_ONLY,tessjs_create_hocr:"0",tessjs_create_tsv:"0"}),null!==d&&d.addWorker(g.workerEng),e()}).then(async()=>{console.log("Loading the English engine and initializing the OCR worker"),console.timeEnd("Loading Tesseract: "),console.log("Tesseract loaded"),console.log("Loading the image"),console.time("Loading the image: ");const o=new Image;o.src=t,o.addEventListener("load",async t=>{console.timeEnd("Loading the image: "),console.log("Image loaded");const o=document.createElement("canvas");o.width=parseInt(t.target.width),o.height=parseInt(t.target.height),o.getContext("2d").drawImage(t.target,0,0,o.width,o.height),console.log(g.workerEng),console.log("OCR image"),console.time("OCR image: ");let i=function(t,a){var o,i,s,c,g=t.split(","),d=g[0],m=g[1],u=!1;if(-1!==d.indexOf(r)){o=r;var h=(-1===(c=(s=m).indexOf("AAlwSFlz"))&&(c=s.indexOf("AAAJcEhZ")),-1===c&&(c=s.indexOf("AAAACXBI")),c);h>=0?(i=4*Math.ceil((h+28)/3),u=!0):i=44}else-1!==d.indexOf(n)&&(o=n,i=24);for(var f=m.substring(0,i),w=m.substring(i),v=atob(f),A=new Uint8Array(v.length),y=0;y<A.length;y+=1)A[y]=v.charCodeAt(y);var p=l(A,a,o,u);return[d,",",btoa(String.fromCharCode.apply(String,e(p))),w].join("")}(o.toDataURL("image/png",.92),300),s={};null!==d&&(s=await d.addJob("recognize",i)),a(s),console.timeEnd("OCR image: "),console.log("OCR result"),console.log(s),console.timeEnd("Total Runtime: "),console.log("======================================================================================"),console.log(""),console.log("OCR Finished")})})});
