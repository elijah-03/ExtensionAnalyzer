var e;!function(e){e[e.GETFULLSCREENIMAGE=0]="GETFULLSCREENIMAGE",e[e.GETSPEECHSETTINGS=1]="GETSPEECHSETTINGS",e[e.DOSCREENSHOTREAD=2]="DOSCREENSHOTREAD"}(e||(e={}));var t=["body"];function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){o(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}class c{constructor(){}static doFetch(e){var n=arguments,o=this;return s(function*(){var i=n.length>1&&void 0!==n[1]?n[1]:{},{body:c}=i,d=a(i,t);return new Promise(function(){var t=s(function*(t,n){if(o.method="GET",o.timeout=0,void 0===d.method?o.method=c?"POST":"GET":o.method=d.method,d.blob){for(var a=atob(c.split(",")[1]),i=new ArrayBuffer(a.length),s=new Uint8Array(i),u=d.headers["content-type"],l=0;l<a.length;l++)s[l]=a.charCodeAt(l);c=new Blob([s],{type:u})}d.timeout&&(o.timeout=d.timeout);var f=r(r({method:o.method},d),{},{headers:r({},d.headers)});c&&(f.body=c);var m=null;if(o.timeout>0)try{var h=new AbortController,y=setTimeout(()=>h.abort(),o.timeout);m=yield fetch(e,r(r({},f),{},{signal:h.signal})),clearTimeout(y)}catch(e){return Promise.reject(e)}else m=yield fetch(e,f);if(m.ok){var p={};if(p.contentType=m.headers.get("content-type"),p.headers=Object.fromEntries(m.headers.entries()),p.contentType){if(-1!==p.contentType.indexOf("application/json"))p.json=yield m.json();else if(p.contentType.startsWith("text"))p.text=yield m.text();else if(-1!==p.contentType.indexOf("audio/mpeg")){var b=yield m.arrayBuffer();p.arrayBuffer=(e=>{for(var t="",n=new Uint8Array(e),r=n.byteLength,o=0;o<r;o++)t+=String.fromCharCode(n[o]);return btoa(t)})(b)}else p.blob=yield m.blob();t({data:p})}else n(p)}else n(p)});return function(e,n){return t.apply(this,arguments)}}())})()}}class d{constructor(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(t.id!==chrome.runtime.id)return!1;if(!e.command)return!1;if("swfetch8598"===e.command)c.doFetch(e.url,e.options).then(e=>{n(e)});return!0})}}let u=null,l=!1;const f={},m=new Map,h=async(e,t,n)=>"CONTENTSCRIPT_TO_FEATURE"===e.direction&&(n&&e.waitForResponse&&m.set(e.id,n),y(e),e.waitForResponse),y=async e=>{await(async()=>{if(!l){try{await b("offscreendocument/offscreendocument.html",[chrome.offscreen.Reason.IFRAME_SCRIPTING],"Reason for needing the document")}catch{}l=!0}})();(u||(u=chrome.runtime.connect({name:"offscreen-communication"}),u.onDisconnect.addListener(()=>{u=null}),u.onMessage.addListener(e=>{p(e)})),u).postMessage(e)},p=async e=>{if(e&&e.data){const{id:t,csID:n,continuousMessage:r}=e,o=m.get(t),a=f[n];if(o&&!r)o(e),m.delete(t);else if(a){const{port:t,messageID:o}=a;"notification"!==e.type&&(e.id=o),t?.postMessage(e),r||delete f[n]}}},b=(e,t,n)=>new Promise((r,o)=>{chrome.offscreen.createDocument({url:e,reasons:t,justification:n},()=>{const e=chrome.runtime.lastError;e?o(e):r()})});chrome.runtime.onConnect.addListener(async e=>{e.name&&(e.onMessage.addListener(t=>{f[t.csID]={port:e,messageID:t.id},t.id&&"CONTENTSCRIPT_TO_FEATURE"===t.direction&&h(t)}),e.onDisconnect.addListener(()=>{delete f[e.name]}))});const E=async()=>await((e=0,t={format:"png",quality:100})=>new Promise(n=>{chrome.tabs.captureVisibleTab(e,t,async e=>{n(e)})}))(null,{format:"png",quality:100});!function(){const t=new Date;new d,chrome.runtime.onMessage.addListener(h),self.addEventListener("activate",e=>{e.waitUntil(clients.claim())}),self.addEventListener("fetch",async e=>{"GET"===e.request.method&&e.respondWith((async()=>{const n=await fetch(e.request),r=await n.blob(),o=new Headers(n.headers);o.set("content-security-policy","script-src 'self' 'wasm-unsafe-eval';  object-src 'none'"),o.set("X-Version",`2022-05-05.01 / ${t.toISOString()}`);return new Response(r,{status:n.status,statusText:n.statusText,headers:o})})())});const n=async()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{const n=t[0].id;n&&chrome.tabs.sendMessage(n,{command:e.DOSCREENSHOTREAD})})};chrome.action.onClicked.addListener(n),chrome.runtime.onMessage.addListener((t,n,r)=>{if(t.command===e.GETFULLSCREENIMAGE)return E().then(r),!0}),chrome.runtime.onMessageExternal.addListener((e,t,r)=>{switch(null==t?void 0:t.id){case"inoeonmfapjbbkmdafoankkfajkcphgd":case"bjglhpoliipklkfjcahfefdlfpifcinb":case"feepmdlmhplaojabeoecaobfmibooaid":if("startScreenShotReader"===e.command)n();return r(),!0}switch(null==e?void 0:e.command){case"TH_externalOCR_SSR":case"externalOCR":chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.tabs.sendMessage(t[0].id,{command:"doExternalOCR",image:e.image},async e=>(r(e),console.log(e.data),!0))})}})}();
