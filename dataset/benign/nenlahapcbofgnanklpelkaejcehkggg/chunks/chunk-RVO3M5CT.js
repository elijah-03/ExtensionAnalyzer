import{a as se}from"./chunk-PFBRUDBV.js";import{b as Z}from"./chunk-BDOU7XT6.js";import{a as Y}from"./chunk-57TRHH3E.js";import{I as J,M as V,a as W,b as H,g as D,m as P,u as $,v as q}from"./chunk-HH5UG254.js";import{a as B}from"./chunk-AGWLSUX4.js";import{a as Q}from"./chunk-IPZXBZPC.js";import{b as M}from"./chunk-GNZEMFDT.js";import{b as h}from"./chunk-DPMK7ZVG.js";import{c as G}from"./chunk-D3B67B3M.js";import{f as L,m as z,q as K}from"./chunk-KJBXKQ52.js";import{a as F,h as f,n as y,o as m,v as _}from"./chunk-4XUWKJYA.js";import{a as ie}from"./chunk-WXGZPSEB.js";import{F as C,z as ne}from"./chunk-K2PA57PF.js";import{e as s}from"./chunk-3GYLW4KZ.js";var d=s(M());var u=async(e,o)=>{if(!(y("ext_ignore_abe_throttle")&&(e==="throttleBonusOffer"||e==="throttleBonusOfferGlobal")))return await _("bonusOfferThrottle",{methodName:e,domain:o})};var X=async({programId:e,url:o,bonusOfferType:i})=>await _("fetchReward",{programId:e,url:o,bonusOfferType:i});var fe=/(^|\.)amazon\.com$/i;async function j(e,o,{allowOnly:i}={}){if(o.includes(e?.pageType)&&!W()&&!H()&&await u("canShowBonusOffer",e?.domain)){let r=(w,l)=>y(w)&&(!i||i.includes(l))?X({programId:f.get("siteAPIData","programId"),url:location.href,bonusOfferType:l}):Promise.resolve(void 0),a=F(),x=fe.test(a)?"ext_nu_abe_amz":"ext_nu_abe_non_amz",S=a!=="amazon.com"||location.href.startsWith("https://www.amazon.com"),U=e?.pageType==="cartPage"||e?.pageType==="checkoutPage"?"ext_to_eml_abe_checkout":"ext_to_eml_abe_product",A=e?.pageType==="cartPage"||e?.pageType==="checkoutPage"?"ext_to_ma_abe_checkout":"ext_to_ma_abe_product",[N,R,v]=await Promise.all([B()&&S?r(x,d.BonusOfferType.newUserActivationBonus):void 0,r(U,d.BonusOfferType.firstTimeEmailActivationBonus),B()?r(A,d.BonusOfferType.desktopToMobileAppBonus):void 0]),E=!!N?.reward?.amount,n=!!R?.reward?.amount,c=!!v?.reward?.amount;if(n){let w=await chrome.runtime.sendMessage({type:"embeddedSignUpCookieIsIncognito"}).catch(()=>null);if(w)w.incognito&&(n=!1);else{m("track","error",{name:"bonus_reward_notification_incognito_check_fail"});return}}if(n&&c&&(c=y("prioritize_desktop_to_app_bonus"),n=!c),(n||c)&&(E=!1),n)return{type:d.BonusOfferType.firstTimeEmailActivationBonus,reward:R};if(c)return{type:d.BonusOfferType.desktopToMobileAppBonus,reward:v};if(E)return{type:d.BonusOfferType.newUserActivationBonus,reward:N}}}var O=s(M());async function b(e,o){return _("bonusOfferApiUtils",{methodName:e,args:o})}var k=s(ne()),ee=s(ie()),oe=s(se());var t=s(C()),le=`${L}/lp/signup/embed/extension`;function pe({bonusReward:e,closeModal:o,onStepChange:i}){let[r,a]=(0,k.useState)(!0),T=(0,oe.useSpinDelay)(r);return(0,t.jsx)("div",{className:"fixed top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-50",children:(0,t.jsxs)("div",{className:"relative w-[600px] h-[600px] bg-white",children:[(0,t.jsx)("button",{onClick:o,"aria-label":"Close",className:"absolute top-2 right-2 p-2",children:(0,t.jsx)(G,{className:"h-4 w-4"})}),T&&(0,t.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(Q,{className:"w-6 h-6"})}),(0,t.jsx)(Z,{closeModal:o,iframeLandingPagePath:"/lp/signup/embed/extension",onStepChange:i,onLoadComplete:()=>a(!1),onSignUpComplete:()=>{e.token&&b("sendBonusOfferEmail",[e.token])}})]})})}function te({blocksSlug:e,bonusReward:o,capitalizePrefix:i,lexiScope:r,notificationName:a,qrCodeToken:T}){let[x,S]=(0,k.useState)(!1),[U,A]=(0,k.useState)(!1),N=(0,k.useRef)("unknown"),{getFullDescription:R,getText:v,getSuffix:E}=J({country:f.get("session","country"),currency:o.reward?.amountCurrency,truncateIntegers:!0}),n=$(`${z}?${ee.default.stringify({domain:o.reward?.domain})}`);function c(p){N.current=p}function w(){S(!1),chrome.runtime.sendMessage({type:"embeddedSignUpCookieRevertSameSiteProperty"}),m("track","closeModal",{label:N.current})}if(x)return(0,t.jsx)(pe,{bonusReward:o,onStepChange:c,closeModal:w});if(n===""||U)return null;let l=f.get("cashback","reward");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y,{blocksSlug:e,templateData:{vendor:f.get("cashback","vendor"),bonusRewardText:R(o.reward,{capitalizePrefix:i}),standardRewardText:l?v(l)+E(l):void 0,logoImageUri:n||q,lexiScope:r,notificationName:a,qrCodeToken:T},onEvent:p=>{if(![h.NotificationShow,h.NotificationDismiss,h.Custom].includes(p.type))return;let g=p.data?.propsData?.name,I=typeof p.data?.label=="string"?p.data.label.trim():"";switch(p.type){case h.NotificationShow:{m("page",g,{pageType:f.get("deweyResult","pageType"),meta:JSON.stringify({bonusRewardId:o.reward.id,standardRewardId:l?.id})}),u("throttleBonusOffer",f.get("siteAPIData","tld"));break}case h.NotificationDismiss:{D(g,"x","dismiss","primary"),u("throttleBonusOfferGlobal");break}}switch(p.eventName){case"activatePrimaryCta":{D(g,I,"cta","primary"),a==="bonusNotifNewUser"?P({reward:o.reward,token:o.token,view:g,label:I.toLowerCase(),sendClickEvent:!1}):a==="bonusNotifEmailOnly"&&(B()&&o.token&&b("sendBonusOfferEmail",[o.token]),S(!0),V({programId:f.get(["siteAPIData","programId"]),creditsDeferred:!1})),A(!0),u("throttleBonusOfferGlobal");break}case"activateSecondaryCta":{D(g,I,"cta","secondary",a==="bonusNotifEmailOnly"?{redirect:!0,cashback:!0}:{}),a==="bonusNotifEmailOnly"&&P({reward:l,view:g,label:I.toLowerCase(),sendClickEvent:!1}),A(!0),u("throttleBonusOfferGlobal");break}}}}),(0,t.jsx)("link",{rel:"prefetch",href:le})]})}var ae=s(C());async function re(e){let o;if(e.type===O.BonusOfferType.desktopToMobileAppBonus&&e?.reward?.token&&(o=await b("createDtmaQrCodeToken",[e.reward.token]),!o)){m("trackError","createDtmaQrCodeTokenFailed");return}let r={[O.BonusOfferType.newUserActivationBonus]:{blocksSlug:"bonus-reward-notification-generic",bonusReward:e.reward,capitalizePrefix:!0,lexiScope:"Bonus_Reward_Notification_New_User",notificationName:"bonusNotifNewUser"},[O.BonusOfferType.firstTimeEmailActivationBonus]:{blocksSlug:"bonus-reward-notification-generic",bonusReward:e.reward,capitalizePrefix:!0,lexiScope:"Bonus_Reward_Notification",notificationName:"bonusNotifEmailOnly"},[O.BonusOfferType.desktopToMobileAppBonus]:{blocksSlug:"bonus-reward-notification-dtma",bonusReward:e.reward,capitalizePrefix:!1,qrCodeToken:o}}[e.type];return r?await K({appName:"blocksNotification",blankSlate:!0,app:(0,ae.jsx)(te,{...r})}):void 0}export{j as a,re as b};
