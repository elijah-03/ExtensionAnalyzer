const FBProvider=class extends AbstractProvider{constructor(){super(),this.dtsgToken=null,this.initStorageListeners(),this.initMessageListener()}run(){this.search()}initStorageListeners(){chrome.storage.onChanged.addListener(a=>{const b=Object.keys(a);b.forEach(b=>{"currentFb_dtsgToken"===b&&(this.dtsgToken=a[b])})})}initMessageListener(){chrome.runtime.onMessage.addListener((a,b,c)=>{if("sendFbVideoId"===a.action){this.videos=[],this.setBadge();const b=this.prepareId(a.videoId);if(!b)return void("function"==typeof this.mediaUpdateListener&&this.mediaUpdateListener({videos:[]}));this.addVideo(b)}return c(),!0})}getVideoData(a,b){this.getDtsgToken().then(c=>{if(!c)return b([]);const d=this.getCookie("c_user");fetch(`https://www.facebook.com/video/video_data_async/?video_id=${a}&fb_dtsg_ag=${c}&__user=${d}&__a=1`).then(a=>a.text()).then(a=>JSON.parse(a.replace("for (;;);",""))).then(c=>{this.filled=!0;const{payload:d}=c,e={vid:a,title:`video_${a}`,ext:".mp4",provider:"fb",quality:d.hd_src?"1080":"720",url:d.hd_src||d.sd_src,isLive:!!d.is_live_stream};return"function"==typeof this.mediaUpdateListener&&this.mediaUpdateListener({videos:[e]}),b([e])})})}prepareId(a){if(!a||a.error)return!1;const b=a.split(":");return b[b.length-1]}getDtsgToken(){return new Promise(a=>{chrome.runtime.sendMessage({action:"getDtsgToken"},b=>a(b))})}search(){window.location.href!==this.location&&(this.videos=[],this.setBadge(),$("*").removeClass(INIT_CLASS),this.location=window.location.href)}saveToStorage(a,b,c=()=>{}){chrome.storage.local.set({[a]:b},c)}registerMediaUpdateListener(a){this.mediaUpdateListener=a}};FBProvider.location="https://facebook.com";