try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="17e41a85-3043-47d4-a173-dc9bda9b1ca9",e._sentryDebugIdIdentifier="sentry-dbid-17e41a85-3043-47d4-a173-dc9bda9b1ca9")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"4.43.1"};(self.webpackChunk=self.webpackChunk||[]).push([[6884],{96884:(e,t,n)=>{n.r(t),System.register([],function(e,t){"use strict";return{execute:function(){e({detectLanguage:async function(e,t){try{var n,i;!function(e){if(0===e.trim().length)throw $.emptyText()}(e),function(){const e=a.get("ON_DEVICE_LANGUAGE_CONFIG");if(!e)throw $.notConfigured();if(!e.modelPath)throw $.modelNotFound(e.modelPath);if(!e.wasmPath)throw $.wasmNotFound(e.wasmPath);if(!e.enabled)throw $.notEnabled({config:e})}(),t&&function(e){s=e}(t);const r=await K.getInstance(e);if(!r)throw z("No detection result returned",W.DETECTION_ERROR,{text:e});return{language:(null==r||null===(n=r.result)||void 0===n?void 0:n.language)||"",score:(null==r||null===(i=r.result)||void 0===i?void 0:i.score)||0,isOnDevice:!0}}catch(t){if(t instanceof $)throw t;if(t instanceof Error)throw z(t,W.DETECTION_ERROR,{text:e});throw z("string"==typeof t?t:"Unknown error occurred",W.UNKNOWN_ERROR,{text:e})}},setOnDeviceLanguageDetectionConfig:function(e){a.set("ON_DEVICE_LANGUAGE_CONFIG",e)}});const n=new Map;n.set("PLATFORM_TYPE",""),n.set("PLATFORM_VERSION",""),n.set("IS_PREMIUM_USER",""),n.set("USER_ID_TOKEN",""),n.set("INPUT_LANGUAGE",""),n.set("REGIONAL_LANGUAGE",""),n.set("DEVICE_ID",""),n.set("GC_BATCH","4"),n.set("SS_BATCH","4"),n.set("PERSONALISATION_UPDATED_AT",""),n.set("PERSONALIZATION",""),n.set("VALID_START_SENTENCE_REGEX",""),n.set("VALID_END_SENTENCE_REGEX",""),n.set("GC_RESPONSE_POST_PROCESS",""),n.set("RECOMMENDATION_DISABLED_CATEGORIES",""),n.set("RECOMMENDATION_PRE_VALIDATE_CHECK",""),n.set("RECOMMENDATION_SENTENCES_PER_BATCH","5"),n.set("RECOMMENDATION_MIN_TEXT_LENGTH","10"),n.set("MAX_RECOMMENDATION_CONCURRENT_REQUESTS","6"),n.set("ENABLE_RECOMMENDATION_CONTEXT","false"),n.set("DISABLE_GC_AFTER_FIX_ERROR","false"),n.set("ON_DEVICE_LANGUAGE_CONFIG",""),n.set("ON_DEVICE_SENTENCE_SPLITTER_CONFIG","");class a{static get(e){return n.get(e)}static set(e,t){return n.set(e,t)}constructor(){}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class r{get modelId(){return this._modelId}get isSkipped(){return Boolean(this._skipReason)}get skipReason(){return this._skipReason}get apiResponse(){return this._apiResponse}get isCached(){return this._apiResponse._cached||!1}async _skipLoad(e,t){this._skipReason=e,t&&await t()}constructor(){i(this,"_modelId",""),i(this,"_skipReason",void 0),i(this,"_apiResponse",{data:null,_cached:!1})}}let s=null;function o({eventName:e,data:t}){s&&s({eventName:e,data:t})}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let l=null;class d{static getInstance(){return d.instance||(d.instance=new d),d.instance}async initialize(){if(this.isLoading&&this.isLoadedSuccessfully)return this.isLoading;try{const e=await(async()=>(l||(l=await t.import("./fasttext-38875d77.js")),l))(),n=a.get("ON_DEVICE_LANGUAGE_CONFIG"),i=(null==n?void 0:n.modelPath)||"",r=(null==n?void 0:n.wasmPath)||"";return this.fastTextInstance||(this.fastTextInstance=(new e.FastText).loadModel(i,r)),this.isLoading=this.fastTextInstance.then(e=>(this.langDetectModel=e,this.isLoadedSuccessfully=!0,!0)).catch(()=>{throw this.isLoadedSuccessfully=!1,this.fastTextInstance=null,!1}),this.isLoading}catch(e){throw this.isLoadedSuccessfully=!1,this.fastTextInstance=null,e}}getModel(){return this.langDetectModel}constructor(){c(this,"langDetectModel",void 0),c(this,"isLoading",null),c(this,"isLoadedSuccessfully",!1),c(this,"fastTextInstance",null)}}c(d,"instance",void 0);let u,E;const _=new WeakMap,O=new WeakMap,h=new WeakMap,g=new WeakMap,N=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return O.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function R(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(I(this),t),p(_.get(this))}:function(...t){return p(e.apply(I(this),t))}:function(t,...n){const a=e.call(I(this),t,...n);return h.set(a,t.sort?t.sort():[t]),p(a)}}function T(e){return"function"==typeof e?R(e):(e instanceof IDBTransaction&&function(e){if(O.has(e))return;const t=new Promise((t,n)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{t(),a()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)});O.set(e,t)}(e),t=e,(u||(u=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,f):e);var t}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{t(p(e.result)),a()},r=()=>{n(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&_.set(t,e)}).catch(()=>{}),N.set(t,e),t}(e);if(g.has(e))return g.get(e);const t=T(e);return t!==e&&(g.set(e,t),N.set(t,e)),t}const I=e=>N.get(e);const D=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],y=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),a=t!==n,i=m.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!i&&!D.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,i?"readwrite":"readonly");let s=r.store;return a&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&r.done]))[0]};return y.set(t,r),r}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}f=(e=>({...e,get:(t,n,a)=>w(t,n)||e.get(t,n,a),has:(t,n)=>!!w(t,n)||e.has(t,n)}))(f);const L="product-gc",C=3,b={cache:"cache",correctedSentences:"correctedSentences",lockedRecommendationMapping:"lockedRecommendationMapping"};class A{async get(e,t){var n;return null===(n=await this.dbPromise)||void 0===n?void 0:n.get(t,e).then(e=>null==e?void 0:e.data)}async set(e,t,n){var a,i;const r={data:t,type:(null==t||null===(a=t.value)||void 0===a?void 0:a.type)||"default",date:+(new Date).setHours(0,0,0,0)};await(null===(i=await this.dbPromise)||void 0===i?void 0:i.put(n,r,e))}async delete(e,t){var n;await(null===(n=await this.dbPromise)||void 0===n?void 0:n.delete(t,e))}async clear(e){var t;await(null===(t=await this.dbPromise)||void 0===t?void 0:t.clear(e))}async deleteOldData(e){try{var t;const n=10,a=+(new Date).setDate((new Date).getDate()-n),i=null===(t=await this.dbPromise)||void 0===t?void 0:t.transaction(e,"readwrite"),r=null==i?void 0:i.store,s=null==r?void 0:r.index("date"),o=IDBKeyRange.upperBound(a);let c=await(null==s?void 0:s.openKeyCursor(o));for(;c;)null==r||r.delete(c.primaryKey),c=await c.continue()}catch(e){}}async getDatabaseSize(e){const t=await this.dbPromise,n=null==t?void 0:t.transaction(e,"readonly"),a=null==n?void 0:n.store;return(null==a?void 0:a.count())||0}async getByType(e,t=b.cache){const n=await this.dbPromise;if(!n)return[];const a=n.transaction(t,"readonly").store.index("type"),i=[];let r=await a.openCursor(IDBKeyRange.only(e));for(;r;)i.push(r.value.data),r=await r.continue();return i}async deleteByType(e,t=b.cache){const n=await this.dbPromise;if(!n)return;const a=n.transaction(t,"readwrite"),i=a.store,r=i.index("type");let s=await r.openKeyCursor(IDBKeyRange.only(e));for(;s;)i.delete(s.primaryKey),s=await s.continue();await a.done}constructor(){v(this,"dbPromise",void 0),v(this,"isAvailable","undefined"!=typeof indexedDB),this.isAvailable?this.dbPromise=new Promise((e,t)=>{(function(e,t,{blocked:n,upgrade:a,blocking:i,terminated:r}={}){const s=indexedDB.open(e,t),o=p(s);return a&&s.addEventListener("upgradeneeded",e=>{a(p(s.result),e.oldVersion,e.newVersion,p(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),o.then(e=>{r&&e.addEventListener("close",()=>r()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o})(L,C,{upgrade(e,t,n,a){try{if(!e.objectStoreNames.contains(b.cache)){const t=e.createObjectStore(b.cache);t.createIndex("date","date"),t.createIndex("type","type",{unique:!1})}if(e.objectStoreNames.contains(b.cache)){const e=a.objectStore(b.cache);e.indexNames.contains("type")||e.createIndex("type","type",{unique:!1})}if(!e.objectStoreNames.contains(b.correctedSentences)){e.createObjectStore(b.correctedSentences).createIndex("date","date")}if(!e.objectStoreNames.contains(b.lockedRecommendationMapping)){e.createObjectStore(b.lockedRecommendationMapping).createIndex("date","date")}}catch(e){}},blocked(){e(null)},blocking(){},terminated(){}}).then(t=>{e(t||null)}).catch(t=>{e(null)})}):this.dbPromise=Promise.resolve(null)}}const S=new Map;class M{async get(e){return S.get(e)}async set(e,t){await S.set(e,t)}async delete(e){await S.delete(e)}async clear(){await S.clear()}async getDatabaseSize(){return S.size}async deleteByType(e){for(const[t,n]of S.entries())n.type===e&&S.delete(t)}async getByType(e){const t=[];for(const[n,a]of S.entries())a.type===e&&t.push(n);return t}constructor(){var e,t,n;n=!0,(t="isAvailable")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}}const P=(e,t,n)=>{if("number"!=typeof n||n<=0)throw new Error(`timedPromise: Encountered invalid timeout value. Got ${n}`);return new Promise((a,i)=>{const r=setTimeout(()=>{a({timedOut:!0,value:t})},n);e.then(e=>{clearTimeout(r),a({timedOut:!1,value:e})}).catch(e=>{clearTimeout(r),i(e)})})},x=b.correctedSentences;(async()=>{try{const e=new A,t=e.dbPromise,n=await P(t,null,3e3);if(e.isAvailable&&n.value)return e.deleteOldData(x),e}catch(e){}new M})();const G=b.lockedRecommendationMapping;(async()=>{try{const e=new A,t=e.dbPromise,n=await P(t,null,3e3);if(e.isAvailable&&n.value)return e.deleteOldData(G),e}catch(e){}new M})();const B=b.cache;let k=(async()=>{try{const e=new A,t=e.dbPromise,n=await P(t,null,3e3);if(e.isAvailable&&n.value)return e.deleteOldData(B),e}catch(e){}return new M})();const U=async e=>{try{const t=await k.then(t=>t.get(e,B));if(!t)return;const n="string"==typeof t?JSON.parse(t):t;let{value:a}=n;const{expireAt:i}=n;if("string"==typeof a)try{a=JSON.parse(a)}catch(e){}if(!i)return a;const r=(new Date).getTime();return r>new Date(i).getTime()?void await k.then(t=>t.delete(e,B)):a}catch(e){return}},V=async(e,t,n)=>{try{const a=n?new Date((new Date).getTime()+n).toISOString():void 0;await k.then(n=>n.set(e,{expireAt:a,value:t},B))}catch(e){return}};var F=function(e){return e.DEBUG_LOG="debugLog",e.ON_DEVICE_SENTENCE_SPLITTER_INIT="on_device_sentence_splitter_init",e.ON_DEVICE_SENTENCE_SPLITTER_INIT_ERROR="on_device_sentence_splitter_init_error",e.ON_DEVICE_SENTENCE_SPLIT_COMPLETE="on_device_sentence_split_complete",e.ON_DEVICE_SENTENCE_SPLIT_ERROR="on_device_sentence_split_error",e.ON_DEVICE_SENTENCE_SPLIT_TOGGLE="on_device_sentence_split_toggle",e.ON_DEVICE_SEGMENTER_SENTENCE_SPLIT_COMPLETE="on_device_segmenter_sentence_split_complete",e.ON_DEVICE_SEGMENTER_SENTENCE_SPLIT_ERROR="on_device_segmenter_sentence_split_error",e.ON_DEVICE_LANG_DETECT_COMPLETE="on_device_lang_detect_complete",e.ON_DEVICE_LANG_DETECT_ERROR="on_device_lang_detect_error",e.ON_DEVICE_LANG_DETECT_TIMEOUT="on_device_lang_detect_timeout",e.ON_DEVICE_LANG_DETECT_TOGGLE="on_device_lang_detect_toggle",e.LOCK_ID_TO_RECOMMENDATION_KEY_MAP_NON_EXISTS="LOCK_ID_TO_RECOMMENDATION_KEY_MAP_NON_EXISTS",e.RECOMMENDATION_UNLOCK_FAILED="RECOMMENDATION_UNLOCK_FAILED",e.GC_MODEL_STATS="gc_model_stats",e}({});function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class K extends r{sanitizeText(e){return e.replace(/(\r\n|\n|\r)/gm," ").replace(RegExp("[^\\p{L}\\p{N}\\s]","gu")," ").replace(/\s+/g," ").trim()}static async getInstance(e){return await new K(e)._load()}get result(){return this._result}static async initialize(){return await d.getInstance().initialize()}_beforeLoad(){this._text?this._text=this.sanitizeText(this._text):this._skipLoad("shortCircuit",()=>{})}async identifyLanguage(e,t){try{const n=this.fastTextManager.getModel(),[a,i]=n.predict(this._text).get(0),r=performance.now()-t,s=i.replace(/^__label__/,""),c=a.toFixed(2);return(null==e?void 0:e.slowThreshold)&&r>(e.slowThreshold||this.SLOW_THRESHOLD)&&this.handleSlowDetection(e,r,s),o({eventName:F.ON_DEVICE_LANG_DETECT_COMPLETE,data:{language:s,timeTaken:r,textLength:this._text.length}}),{language:s,score:c}}catch(e){return o({eventName:F.ON_DEVICE_LANG_DETECT_ERROR,data:{error:e.message,textLength:this._text.length}}),null}}handleSlowDetection(e,t,n){o({eventName:F.ON_DEVICE_LANG_DETECT_TOGGLE,data:{service:"languageDetect",value:!1,language:n,timeTaken:t,reason:"slowThreshold"}})}async _load(){var e;if(this._beforeLoad(),this.isSkipped)return this;const t=await async function(e){try{const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(e){return""}}(this._text),n=await U(t);if(n)return this._result={language:n.data.language,score:n.data.score},this;if(await K.initialize(),!(null===(e=this.fastTextManager.getModel())||void 0===e?void 0:e.predict))return this;const i=a.get("ON_DEVICE_LANGUAGE_CONFIG"),r=new Promise(e=>setTimeout(()=>e(null),i.fallbackThreshold||this.FALLBACK_THRESHOLD)),s=performance.now();if(this._result=await Promise.race([this.identifyLanguage(i,s),r]),this._result){const e=864e5;await V(t,{data:{...this._result,languagePreferenceByCountry:[],status:200},type:"detect-language:on-device"},e)}else o({eventName:F.ON_DEVICE_LANG_DETECT_TIMEOUT,data:{textLength:this._text.length}});return this}constructor(e){super(),j(this,"_text",void 0),j(this,"_result",null),j(this,"fastTextManager",void 0),j(this,"SLOW_THRESHOLD",150),j(this,"FALLBACK_THRESHOLD",400),this._text=e,this.fastTextManager=d.getInstance()}}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const W=e("ErrorCode",{CONFIGURATION_ERROR:"CONFIGURATION_ERROR",MODEL_LOADING_ERROR:"MODEL_LOADING_ERROR",DETECTION_ERROR:"DETECTION_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"});class $ extends Error{getFormattedMessage(){const e=Object.keys(this.context).length>0?` | Context: ${JSON.stringify(this.context)}`:"";return`${this.name} [${this.code}]: ${this.message}${e}`}toJSON(){return{name:this.name,message:this.message,code:this.code,context:this.context,isOperational:this.isOperational,stack:this.stack}}static configurationError(e,t){return new $(e,W.CONFIGURATION_ERROR,t)}static notConfigured(e){return new $("Language detection is not configured. Please call setOnDeviceLanguageDetectionConfig() first.",W.CONFIGURATION_ERROR,e)}static invalidConfig(e,t){return new $(`Invalid configuration provided: ${JSON.stringify(e)}`,W.CONFIGURATION_ERROR,{...t,config:e})}static modelLoadingError(e,t){return new $(e,W.MODEL_LOADING_ERROR,t)}static modelNotFound(e,t){return new $(`Language model path is missing in the config: ${e}`,W.MODEL_LOADING_ERROR,{...t,modelPath:e})}static wasmNotFound(e,t){return new $(`wasm file path is missing in the config: ${e}`,W.MODEL_LOADING_ERROR,{...t,wasmPath:e})}static notEnabled(e){return new $("Language detection is not enabled. Please call setOnDeviceLanguageDetectionConfig() first.",W.CONFIGURATION_ERROR,e)}static wasmNotSupported(e){return new $("WebAssembly is not supported in this environment",W.MODEL_LOADING_ERROR,e)}static detectionError(e,t){return new $(e,W.DETECTION_ERROR,t)}static emptyText(e){return new $("Text cannot be empty",W.VALIDATION_ERROR,e)}static unknownError(e,t){return new $(e,W.UNKNOWN_ERROR,t)}constructor(e,t=W.UNKNOWN_ERROR,n={},a=!0){super(e),H(this,"code",void 0),H(this,"context",void 0),H(this,"isOperational",void 0),Object.setPrototypeOf(this,$.prototype),this.name="OnDeviceDetectLanguageError",this.code=t,this.context=n,this.isOperational=a}}function z(e,t=W.UNKNOWN_ERROR,n={}){if("string"==typeof e)return new $(e,t,n);if(e instanceof $)return e;switch(t){case W.CONFIGURATION_ERROR:return $.configurationError(e.message,n);case W.MODEL_LOADING_ERROR:return $.modelLoadingError(e.message,n);case W.DETECTION_ERROR:return $.detectionError(e.message,n);default:return $.unknownError(e.message,n)}}e("OnDeviceDetectLanguageError",$)}}})}}]);
//# sourceMappingURL=sourceMap/6884.js.map