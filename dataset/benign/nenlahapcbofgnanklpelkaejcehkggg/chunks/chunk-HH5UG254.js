import{a as Ct,c as mt,d as Gt}from"./chunk-EA7CGSTM.js";import{a as it}from"./chunk-AGWLSUX4.js";import{c as Mi,d as zi}from"./chunk-MFH6BM6M.js";import{a as Ri}from"./chunk-NT3RH36Y.js";import{a as Ti,b as Ai,d as Li}from"./chunk-XH6MVEJG.js";import{a as Di}from"./chunk-CQXN2NRJ.js";import{a as Pi}from"./chunk-IPZXBZPC.js";import{c as Ei,e as Ii}from"./chunk-E2GNLB6L.js";import{a as Bt,b as ci,c as di,d as fn}from"./chunk-J7QHBV67.js";import{a as li,b as pi,c as bi,i as gn}from"./chunk-VGEMM5MB.js";import{a as xt,e as wi}from"./chunk-WJZEHHRO.js";import{a as Ni}from"./chunk-HPSGHK7L.js";import{b as W}from"./chunk-GXPO46BF.js";import{b as ki,c as _i}from"./chunk-XZWN3GGK.js";import{a as Ht}from"./chunk-2Q63MOXU.js";import{a as Wt,b as ye,d as xi,e as Yt}from"./chunk-DPMK7ZVG.js";import{f as vi}from"./chunk-D3B67B3M.js";import{a as yi}from"./chunk-H6FSK4DZ.js";import{a as dt}from"./chunk-2GAAOKGQ.js";import{a as wn,b as kn,c as ut,d as _n,f as O,m as Ft,o as Ci,p as Si,q as Vt}from"./chunk-KJBXKQ52.js";import{a as w,h as p,i as _e,n as N,o as f,v}from"./chunk-4XUWKJYA.js";import{a as mi,d as hn}from"./chunk-W7K6NY26.js";import{b as ai,g as ge,k as ni,l as ri,n as we,s as ke}from"./chunk-QWQLNDJC.js";import{a as fi,b as hi,c as bn}from"./chunk-WXGZPSEB.js";import{E as jt,F as d,H as gi,c as an,f as nn,g as rn,k as sn,o as cn,p as ln,r as ui,s as pn,t as un,u as dn,v as mn,z as S}from"./chunk-K2PA57PF.js";import{a as en,d as on}from"./chunk-CBPLEXH3.js";import{a as Ja,c as H,d as tn}from"./chunk-AYDLOBCW.js";import{k as si}from"./chunk-53OM6ECF.js";import{c as A,e as c}from"./chunk-3GYLW4KZ.js";var mo=A((Ip,ee)=>{(function(){"use strict";var t=!!(typeof window<"u"&&window.document&&window.document.createElement),e={canUseDOM:t,canUseWorkers:typeof Worker<"u",canUseEventListeners:t&&!!(window.addEventListener||window.attachEvent),canUseViewport:t&&!!window.screen};typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return e}):typeof ee<"u"&&ee.exports?ee.exports=e:window.ExecutionEnvironment=e})()});var Ye=A((eu,_o)=>{var Bn=an(),jn=function(){try{var t=Bn(Object,"defineProperty");return t({},"",{}),t}catch{}}();_o.exports=jn});var xo=A((iu,vo)=>{var yo=Ye();function Fn(t,e,i){e=="__proto__"&&yo?yo(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}vo.exports=Fn});var So=A((ou,Co)=>{var Hn=xo(),Wn=sn(),Yn=Object.prototype,Vn=Yn.hasOwnProperty;function Gn(t,e,i){var o=t[e];(!(Vn.call(t,e)&&Wn(o,i))||i===void 0&&!(e in t))&&Hn(t,e,i)}Co.exports=Gn});var To=A((au,Do)=>{var $n=So(),qn=ui(),Kn=ln(),No=en(),Xn=pn();function Zn(t,e,i,o){if(!No(t))return t;e=qn(e,t);for(var a=-1,n=e.length,s=n-1,r=t;r!=null&&++a<n;){var l=Xn(e[a]),u=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(a!=s){var m=r[l];u=o?o(m,l,r):void 0,u===void 0&&(u=No(m)?m:Kn(e[a+1])?[]:{})}$n(r,l,u),r=r[l]}return t}Do.exports=Zn});var Io=A((nu,Eo)=>{var Qn=un(),Jn=To(),tr=ui();function er(t,e,i){for(var o=-1,a=e.length,n={};++o<a;){var s=e[o],r=Qn(t,s);i(r,s)&&Jn(n,tr(s,t),r)}return n}Eo.exports=er});var Mo=A((ru,Ao)=>{var ir=Io(),or=dn();function ar(t,e){return ir(t,e,function(i,o){return or(t,o)})}Ao.exports=ar});var zo=A((su,Lo)=>{var Ro=on(),nr=nn(),rr=rn(),Po=Ro?Ro.isConcatSpreadable:void 0;function sr(t){return rr(t)||nr(t)||!!(Po&&t&&t[Po])}Lo.exports=sr});var Bo=A((cu,Uo)=>{var cr=cn(),lr=zo();function Oo(t,e,i,o,a){var n=-1,s=t.length;for(i||(i=lr),a||(a=[]);++n<s;){var r=t[n];e>0&&i(r)?e>1?Oo(r,e-1,i,o,a):cr(a,r):o||(a[a.length]=r)}return a}Uo.exports=Oo});var Fo=A((lu,jo)=>{var pr=Bo();function ur(t){var e=t==null?0:t.length;return e?pr(t,1):[]}jo.exports=ur});var Wo=A((pu,Ho)=>{function dr(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}Ho.exports=dr});var Go=A((uu,Vo)=>{var mr=Wo(),Yo=Math.max;function fr(t,e,i){return e=Yo(e===void 0?t.length-1:e,0),function(){for(var o=arguments,a=-1,n=Yo(o.length-e,0),s=Array(n);++a<n;)s[a]=o[e+a];a=-1;for(var r=Array(e+1);++a<e;)r[a]=o[a];return r[e]=i(s),mr(t,this,r)}}Vo.exports=fr});var qo=A((du,$o)=>{function hr(t){return function(){return t}}$o.exports=hr});var Zo=A((mu,Xo)=>{var br=qo(),Ko=Ye(),gr=mn(),wr=Ko?function(t,e){return Ko(t,"toString",{configurable:!0,enumerable:!1,value:br(e),writable:!0})}:gr;Xo.exports=wr});var Jo=A((fu,Qo)=>{var kr=800,_r=16,yr=Date.now;function vr(t){var e=0,i=0;return function(){var o=yr(),a=_r-(o-i);if(i=o,a>0){if(++e>=kr)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}Qo.exports=vr});var ea=A((hu,ta)=>{var xr=Zo(),Cr=Jo(),Sr=Cr(xr);ta.exports=Sr});var oa=A((bu,ia)=>{var Nr=Fo(),Dr=Go(),Tr=ea();function Er(t){return Tr(Dr(t,void 0,Nr),t+"")}ia.exports=Er});var na=A((gu,aa)=>{var Ir=Mo(),Ar=oa(),Mr=Ar(function(t,e){return t==null?{}:Ir(t,e)});aa.exports=Mr});var xa=A(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});var _a=function(){function t(e,i){var o=[],a=!0,n=!1,s=void 0;try{for(var r=e[Symbol.iterator](),l;!(a=(l=r.next()).done)&&(o.push(l.value),!(i&&o.length===i));a=!0);}catch(u){n=!0,s=u}finally{try{!a&&r.return&&r.return()}finally{if(n)throw s}}return o}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();se.useRoot=Gr;se.useBranch=$r;var vt=S(),ka=Ze(vt),ya=wn(),Hr=Ja(),va=Ze(Hr),Wr=kn(),Xe=Ze(Wr);function Ze(t){return t&&t.__esModule?t:{default:t}}var Qe=va.default.helpers.makeError,Yr=va.default.type.object;function Vr(t,e){throw Qe('baobab-react/hooks.useBranch: given cursors mapping is invalid (check the "'+t+'" component).',{mapping:e})}function Gr(t){if(!(0,ya.isBaobabTree)(t))throw Qe("baobab-react/hooks.useRoot: given tree is not a Baobab.",{target:t});var e=(0,vt.useState)(function(){return function(n){var s=n.children;return ka.default.createElement(Xe.default.Provider,{value:{tree:t}},s)}}),i=_a(e,2),o=i[0],a=i[1];return(0,vt.useEffect)(function(){a(function(){return function(n){var s=n.children;return ka.default.createElement(Xe.default.Provider,{value:{tree:t}},s)}})},[t]),o}function $r(t){!Yr(t)&&typeof t!="function"&&Vr(name,t);var e=(0,vt.useContext)(Xe.default);if(!e||!(0,ya.isBaobabTree)(e.tree))throw Qe("baobab-react/hooks.useBranch: tree is not available.");var i=(0,vt.useState)(function(){var s=typeof t=="function"?t(e):t,r=e.tree.project(s);return r.dispatch=function(l){for(var u=arguments.length,m=Array(u>1?u-1:0),h=1;h<u;h++)m[h-1]=arguments[h];return l.apply(void 0,[e.tree].concat(m))},r}),o=_a(i,2),a=o[0],n=o[1];return(0,vt.useEffect)(function(){var s=typeof t=="function"?t(e):t,r=e.tree.watch(s);return r.on("update",function(){var l=r.get();l.dispatch=function(u){for(var m=arguments.length,h=Array(m>1?m-1:0),b=1;b<m;b++)h[b-1]=arguments[b];return u.apply(void 0,[e.tree].concat(h))},n(l)}),function(){return r.release()}},[t]),a}});var Sa=A(Je=>{var Ca=xa();Je.useRoot=Ca.useRoot;Je.useBranch=Ca.useBranch});var xe=c(H()),Ce=c(si());ci();function ve(...t){_e("ext_sd_debug")&&console.log("[STAND_DOWN]",...t)}function Oi(){let t=_e("ext_sd_tld")?w():(0,Ce.getDomain)(location.href),e=p.get("tabId");return{domain:t,tabId:e,sameTabKey:`${t}_${e}`,allTabsKey:`${t}_all`}}function Ui(t,e){let{domain:i,tabId:o,sameTabKey:a,allTabsKey:n}=Oi(),s=p.get([t,a]),r=p.get([t,n]),l=Bt(),u=s>l,m=r>l;return ve(e,u,i,s,l,o),ve(e,m,i,r,l,"all"),u||m}function Bi(){return Ui("couponsDisabledSites","coupons")}function ji(){return Ui("cashbackDisabledSites","cashback")}function Fi(){let t=(0,Ce.getDomain)(location.href),e=p.get(["mitDisabledSites",t]);return ve("mitDisabledSites",t,e),e}var Hi=xe.default.debounce(()=>{let{sameTabKey:t,allTabsKey:e}=Oi(),i=p.get(["standDownReasons",t])||p.get(["standDownReasons",e]);f("track","standDownIndicator",{reason:i,url:location.href})},5e3,{leading:!0,trailing:!1}),Wi=xe.default.debounce(()=>{f("track","standDownIndicator",{reason:"mit",url:location.href})},5e3,{leading:!0,trailing:!1});ke();var Q=c(H()),ei=c(tn());hn();ci();bn();var Se=async t=>v("activatePinnedTab",t);var $t=t=>v("competitorCashbackCacheGet",{domain:w(),comp:t});var St=t=>v("competitorCashbackCacheRemove",{domain:w(),comp:t});var Yi=t=>v("completeTooltipSteps",{step:t});var Ne=(t,e)=>v("domainLocalStorageSet",{domain:w(),key:t,value:e});var Vi=t=>v("getCashback",{fromSiteHub:t});var z=c(H()),Pa=c(si());fn();var ua=c(S()),da=c(_n()),Mt=c(yi()),C=c(H());var qt=()=>{let t=p.get("deweyResult","pageType");return v("dismissCashback",t)};var Gi=t=>v("setSeenCashbackNotification",t);function $i(){return{left:void 0,right:320,translateX:"initial"}}var Xi=c(H());pi();gn();var qi=c(S()),Nt=c(yi()),Ki=c(H());var L=c(d()),De=class extends qi.Component{constructor(...e){super(...e),this.state={hideNotification:!1}}componentDidMount(){f("track","extEmailConfirmation",{action:"displayed"})}render(){let{hideNotification:e}=this.state,{email:i}=Ki.default.get(this.props,"session");return(0,L.jsx)("div",{className:e?"disabled email-confirmation-page":"email-confirmation-page",style:{top:"0",bottom:"auto",left:"auto",right:"0"},children:(0,L.jsx)(Nt.Motion,{style:{opacity:(0,Nt.spring)(e?0:1,{stiffness:180,damping:20}),y:(0,Nt.spring)(e?!0?-100:100:0,{stiffness:180,damping:20})},children:({opacity:a,y:n})=>(0,L.jsxs)("div",{className:"email-confirmation-notification",style:{transform:`translate3d(0,${n}%,0)`,opacity:`${a}`},children:[(0,L.jsxs)("header",{children:[(0,L.jsx)(dt,{}),(0,L.jsx)(Ht,{onClick:this.onClosePopup.bind(this)})]}),(0,L.jsxs)("section",{children:[(0,L.jsx)("h5",{style:{fontWeight:"600",color:"black"},children:"Please verify your email address so we can notify you when your rewards are ready to use!"}),(0,L.jsx)("br",{}),(0,L.jsxs)("h5",{children:["The email address associated with your account is"," ",(0,L.jsx)("span",{style:{fontWeight:"bold",color:"black"},children:i})]}),(0,L.jsx)("div",{className:"button-wrapper",children:(0,L.jsx)("button",{className:"primary-btn-large",onClick:this.onConfirm.bind(this),children:"Confirm"})}),(0,L.jsx)("div",{className:"link-wrapper",children:(0,L.jsx)("a",{className:"not-your-email-link",href:"https://capitaloneshopping.com/help",target:"_blank",rel:"noopener noreferrer",onClick:this.onNotYourEmailClicked.bind(this),children:"Not your email?"})})]})]})})})}async onClosePopup(){await Ct({message:"dismiss"}),f("track","extEmailConfirmation",{action:"dismiss"}),p.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onConfirm(){await Ct({message:"confirm"}),f("track","extEmailConfirmation",{action:"confirm"}),p.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onNotYourEmailClicked(){f("track","extEmailConfirmation",{action:"notYourEmail"})}},Te=ut({session:["session"]},De);var Zi=c(d());async function Dt(){await vn()&&(Vt({appName:"emailConfirmation",cssUrl:"cashback.css",app:(0,Zi.jsx)(Te,{})}),p.set("emailConfirmationVisible",!0))}async function vn(){if(p.get("emailConfirmationVisible")||!N("email_unengaged"))return!1;let t=await Ct({message:"getEvents"}),e=Xi.default.chain(t).pickBy(s=>new Date-new Date(s)<bi).value();if("hasConfirmedEmail"in e&&new Date-new Date(e.hasConfirmedEmail)<6048e5)return!1;let o="seenEmailConfirmation1"in e&&"seenEmailConfirmation2"in e&&"seenEmailConfirmation3"in e,a=new Date(Math.max(new Date(e.seenEmailConfirmation1||0),new Date(e.seenEmailConfirmation2||0),new Date(e.seenEmailConfirmation3||0))),n=a&&new Date-a<864e5;return!(o||n)}pi();var Qi=t=>v("hasDismissedAnyNotification",t);var Ji=(t,e,i)=>v("setNotificationEvent",{event:t,type:e,subType:i});function to(t,e){Ji(li,t,e)}function hc(){return Qi(864e5)}function Z(t,e,i,o,{redirect:a=!1,cashback:n=!1,...s}={}){let r,l;if(window.__wb_contentId){switch(t){case"cashbackNotification":r="cashback";break;case"couponNotification":case"couponNotificationResult":r="coupons";break;case"siteHubOffers":r="sitehub";break}r&&(l=window.__wb_contentId[r])}f("track","desktopExtensionClick",{name:t,label:e?.toLowerCase(),type:i,subType:o,cashback:n,redirect:a,...s,contentId:l})}var uo=c(S()),nt=c(H());var eo=c(S()),Tt=c(H());var D=c(d()),Ie=class extends eo.Component{constructor(e){super(e),this.state={expanded:!1}}toggleContainerSize(e){e.preventDefault(),this.setState({expanded:!this.state.expanded})}onShowExclusion(){f("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${this.props.tld}/coupon`,"_blank")}render(){let{expanded:e}=this.state,{center:i,couponCount:o,displayInModal:a,hasCoupons:n,reward:s,runTimeSeconds:r,showCouponCount:l,showDismiss:u,showReward:m}=this.props,h=m?s.type==="percentage"?`${s.amount/100}%`:W(s.amount,{currency:s.amountCurrency||s.currency}):"",b=3,M=s&&Tt.default.get(s,"categories.length",0)>b,P=Tt.default.get(s,"categories")||[],_=e?P:P.slice(0,b);return s.categories?(0,D.jsxs)("div",{className:`simple-section ${i?"center":""} ${a?"display-in-modal":""}`,children:[m&&(0,D.jsxs)("div",{className:"reward-text",children:[(0,D.jsxs)("h2",{children:["Up to ",(0,D.jsx)("span",{className:"palmetto",children:h})," in Rewards Activated"]}),l&&(0,D.jsxs)("h6",{className:"bold center",children:[o," ",o===1?" code ":" best codes "," tested in"," ",r," sec."]}),(0,D.jsxs)("h6",{className:"exclusion-text center",children:["*Rewards may vary based on exchange rates. Terms and exclusions apply",Tt.default.get(this.props,"view.exclusions")?(0,D.jsxs)(D.Fragment,{children:[","," ",(0,D.jsx)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),(0,D.jsxs)("div",{className:"reward-categories",children:[(0,D.jsx)("h5",{className:"bold",children:"Rewards by Category"}),(0,D.jsxs)("div",{className:`cashback-category-section ${n&&"show-border"}`,children:[(0,D.jsx)("div",{className:"cashback-category-container",children:Tt.default.map(_,({name:T,amount:k,type:E})=>(0,D.jsxs)("div",{className:"cashback-category-row",children:[(0,D.jsx)("p",{className:"cashback-category-name",children:T}),(0,D.jsx)("span",{className:"cashback-category-reward",children:E==="percentage"?`${k/100}%`:W(k)})]},T))}),M&&(0,D.jsxs)("h5",{className:"toggle-container-cta",onClick:this.toggleContainerSize.bind(this),children:["Show ",this.state.expanded?"fewer":"all"," categories"]})]})]}),u&&(0,D.jsx)("div",{className:"dismiss-notif",children:(0,D.jsx)("h4",{className:"primary-link bold",onClick:this.props.onClosePopup.bind(this),children:"Continue to Checkout"})})]}):null}},Ae=Ie;var ft=c(S());var Kt=c(d());function xn({style:t,flex:e,width:i=40,height:o=25,color:a="#adb9bf",onClick:n,marginTop:s=0,marginRight:r,marginLeft:l}){return(0,Kt.jsx)("div",{style:{...t,display:"flex",flex:e,justifyContent:"right",alignItems:"center",width:i,height:o,color:a,marginTop:s,marginRight:r,marginLeft:l},onClick:n,children:(0,Kt.jsx)("svg",{width:"28",height:"29",viewBox:"0 0 28 29",fill:"none",style:{cursor:"pointer"},"aria-label":"Settings",role:"button",xmlns:"http://www.w3.org/2000/svg",children:(0,Kt.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.9952 15.1504L23.019 18.1266V22.3506C23.019 22.9802 22.5039 23.4953 21.8743 23.4953H17.6389L14.6627 26.4715C14.2163 26.9179 13.4951 26.9179 13.0487 26.4715L10.0725 23.4953H5.84855C5.21896 23.4953 4.70385 22.9802 4.70385 22.3506V18.1152L1.72765 15.139C1.28121 14.6926 1.28121 13.9714 1.72765 13.525L4.70385 10.5488V6.32485C4.70385 5.69527 5.21896 5.18015 5.84855 5.18015H10.0725L13.0601 2.20395C13.274 1.9896 13.5643 1.86914 13.8671 1.86914C14.1699 1.86914 14.4603 1.9896 14.6741 2.20395L17.6503 5.18015H21.8743C22.5039 5.18015 23.019 5.69527 23.019 6.32485V10.5488L25.9952 13.5364C26.4416 13.9829 26.4416 14.704 25.9952 15.1504ZM6.99317 14.3379C6.99317 18.1268 10.0724 21.2061 13.8613 21.2061C17.6503 21.2061 20.7295 18.1268 20.7295 14.3379C20.7295 10.549 17.6503 7.46973 13.8613 7.46973C10.0724 7.46973 6.99317 10.549 6.99317 14.3379Z",fill:"#B4BDC2"})})})}var Me=xn;var U=c(d());function Cn(t){let[e,i]=(0,ft.useState)(!1),o=s=>{let r=(0,ft.useRef)();return(0,ft.useEffect)(()=>{let l=()=>{s()};return document.addEventListener("click",l,!0),()=>{document.removeEventListener("click",l,!0)}},[r]),r},a=()=>{setTimeout(()=>{i(!1)})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{style:{width:48},children:(0,U.jsx)(Me,{onClick:()=>i(!e),style:{position:"fixed",top:14,right:15}})}),e?(0,U.jsx)(()=>(0,U.jsx)("div",{ref:o(a),className:"notification-menu",children:(0,U.jsxs)("ul",{children:[(0,U.jsx)("li",{children:(0,U.jsx)("p",{onClick:t.confirmDismiss,className:"menu-item",children:"Dismiss Notification"})}),(0,U.jsx)("li",{children:(0,U.jsx)("p",{onClick:t.snoozeNotification,className:"menu-item",children:"Snooze for 24 Hours"})})]})}),{}):null]})}var Re=Cn;var io=t=>()=>{t("Snooze for 24 Hours")},Xt=(t,e,i,o,a)=>{t.stopPropagation(),o?(i(e,!0),f("trackClick","dismissCompetitorClickWarning",e,{rewardAmount:a?.amount,rewardDisplay:a?.type})):i(e)};var oo=c(d()),Zt=({onUserClosePopup:t})=>t?(0,oo.jsx)(Re,{confirmDismiss:()=>t("Dismiss Notification"),snoozeNotification:io(t)}):null;var G=c(d());function Sn(){f("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${w()}/coupon`,"_blank")}function Pe({reward:t,containerStyle:e}){if(t?.type!=="threshold"&&!t?.threshold)return null;let i=p.get(["siteAPIData","siteData","merchantPage","exclusions"]);return(0,G.jsx)("div",{style:e,children:(0,G.jsx)(Ri,{side:"left",text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:(0,G.jsxs)(G.Fragment,{children:["The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied.",i&&(0,G.jsxs)(G.Fragment,{children:[" ","Exclusions apply,"," ",(0,G.jsx)("span",{className:"tertiary-link-lighter",onClick:Sn,children:"view details"}),"."]})]})})})}var no=c(fi());var Qt=c(S());var Nn=["data:image/jpeg;base64,","data:image/png;base64,","data:image/webp;base64,"];async function Le(t){try{let e=await fetch(t).then(o=>o.blob());return await new Promise(o=>{let a=new window.FileReader;a.onload=()=>{let n=a.result,s=!!n&&Nn.some(r=>n.startsWith(r));o(s?n:null)},a.readAsDataURL(e)})}catch{return null}}function Et(t){let[e,i]=(0,Qt.useState)("");return(0,Qt.useEffect)(()=>{async function o(){i(await Le(t))}t&&o()},[t]),e}var g=c(d()),al="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI5IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDE1OSAxNTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3R5bGU9ImhlaWdodDomcXVvdDsxMDAlJnF1b3Q7Ij48ZyBmaWxsPSJub25lIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjUwOSAuNTk2KSI+PG1hc2sgaWQ9ImEiIGZpbGw9IiNmZmYiPjxwYXRoIGQ9Ik0uMDE2LjE1OGgxNTYuNzI4djE1Ni43MjlILjAxNnoiLz48L21hc2s+PHBhdGggZD0iTTE1Ni43NDQgNzguNTIyYzAgNDMuMjgtMzUuMDg1IDc4LjM2NS03OC4zNjQgNzguMzY1Uy4wMTYgMTIxLjgwMi4wMTYgNzguNTIyQy4wMTYgMzUuMjQ0IDM1LjEwMS4xNTggNzguMzguMTU4czc4LjM2NCAzNS4wODYgNzguMzY0IDc4LjM2NCIgZmlsbD0iI0U4RTlFOSIgbWFzaz0idXJsKCNhKSIvPjwvZz48bWFzayBpZD0iYiIgZmlsbD0iI2ZmZiI+PHBhdGggZD0iTTAgMTU3LjQ4M2gxNTguMjUzVi43NTRIMHoiLz48L21hc2s+PHBhdGggZmlsbD0iIzM5QjQ0OSIgbWFzaz0idXJsKCNiKSIgZD0iTTIxLjExNCA5OS42NTZIMTM5LjUyVjM3LjE4NEgyMS4xMTR6Ii8+PHBhdGggc3Ryb2tlPSIjMTc3QzNFIiBtYXNrPSJ1cmwoI2IpIiBkPSJNMjcuMDggOTQuMzE0aDEwNi40NzRWNDMuMTE3SDI3LjA4eiIvPjxwYXRoIGQ9Ik0yNy4wOCA4MS40ODF2MTIuODMzaDEyLjgzNGMwLTcuMDg4LTUuNzQ2LTEyLjgzMy0xMi44MzQtMTIuODMzbTEyLjgzNC0zOC4zNjRIMjcuMDhWNTUuOTVjNy4wODkgMCAxMi44MzQtNS43NDUgMTIuODM0LTEyLjgzM205My42NCAxMi44MzNWNDMuMTE2SDEyMC43MmMwIDcuMDg4IDUuNzQ2IDEyLjgzNCAxMi44MzQgMTIuODM0bS0xMi44MzMgMzguMzY0aDEyLjgzM1Y4MS40OGMtNy4wODggMC0xMi44MzMgNS43NDYtMTIuODMzIDEyLjgzNE05Ni4xNTMgNjguNDJjMCA5Ljk2My03LjA5IDE4LjA0LTE1LjgzNiAxOC4wNHMtMTUuODM1LTguMDc3LTE1LjgzNS0xOC4wNCA3LjA5LTE4LjA0IDE1LjgzNS0xOC4wNGM4Ljc0NyAwIDE1LjgzNiA4LjA3NyAxNS44MzYgMTguMDRtLTc1LjAzOSAzNC41NjZIMTM5LjUydi0zLjMzSDIxLjExNHoiIGZpbGw9IiMxNzdDM0UiIG1hc2s9InVybCgjYikiLz48cGF0aCBmaWxsPSIjMzlCNDQ5IiBtYXNrPSJ1cmwoI2IpIiBkPSJNMjEuMTE0IDEwNi4zMTVIMTM5LjUydi0zLjMzSDIxLjExNHoiLz48cGF0aCBmaWxsPSIjMTc3QzNFIiBtYXNrPSJ1cmwoI2IpIiBkPSJNMjEuMTE0IDEwOS42NDVIMTM5LjUydi0zLjMzSDIxLjExNHoiLz48cGF0aCBmaWxsPSIjMzlCNDQ5IiBtYXNrPSJ1cmwoI2IpIiBkPSJNMjEuMTE0IDExMi45NzRIMTM5LjUydi0zLjMyOUgyMS4xMTR6Ii8+PHBhdGggZmlsbD0iIzE3N0MzRSIgbWFzaz0idXJsKCNiKSIgZD0iTTIxLjExNCAxMTYuMzA0SDEzOS41MnYtMy4zM0gyMS4xMTR6Ii8+PHBhdGggZmlsbD0iIzM5QjQ0OSIgbWFzaz0idXJsKCNiKSIgZD0iTTIxLjExNCAxMTkuNjMzSDEzOS41MnYtMy4zM0gyMS4xMTR6Ii8+PHBhdGggZmlsbD0iIzE3N0MzRSIgbWFzaz0idXJsKCNiKSIgZD0iTTIxLjExNCAxMjIuOTYySDEzOS41MnYtMy4zM0gyMS4xMTR6Ii8+PHBhdGggZmlsbD0iIzM5QjQ0OSIgbWFzaz0idXJsKCNiKSIgZD0iTTIxLjExNCAxMjYuMjkySDEzOS41MnYtMy4zM0gyMS4xMTR6Ii8+PHBhdGggZmlsbD0iI0YyRjJGMiIgbWFzaz0idXJsKCNiKSIgZD0iTTczLjA1MyA5OS42NTZIODcuNThWMzcuMTg0SDczLjA1M3oiLz48cGF0aCBmaWxsPSIjQzZDNkM1IiBtYXNrPSJ1cmwoI2IpIiBkPSJNNzMuMDUzIDEyNi4yOTJIODcuNThWOTkuNjU2SDczLjA1M3oiLz48cGF0aCBmaWxsPSIjRTU5NTM0IiBtYXNrPSJ1cmwoI2IpIiBkPSJNOC44NyAxMzEuMDEzaDI5LjMzMXYtNC44MDRIOC44NzF6Ii8+PHBhdGggZmlsbD0iI0ZBQjA0MiIgbWFzaz0idXJsKCNiKSIgZD0iTTIuOTgyIDEyNi4yMDloMjkuMzMxdi00LjgwNkgyLjk4M3oiLz48cGF0aCBmaWxsPSIjRTU5NTM0IiBtYXNrPSJ1cmwoI2IpIiBkPSJNMy4wOTggMTIxLjQwM2gyOS4zM1YxMTYuNkgzLjA5OXoiLz48cGF0aCBmaWxsPSIjRkFCMDQyIiBtYXNrPSJ1cmwoI2IpIiBkPSJNNS45MjYgMTE2LjU5OWgyOS4zMzF2LTQuODA2SDUuOTI3eiIvPjxwYXRoIGZpbGw9IiNFNTk1MzQiIG1hc2s9InVybCgjYikiIGQ9Ik0yLjk4MiAxMTEuNzk0aDI5LjMzMXYtNC44MDZIMi45ODN6Ii8+PHBhdGggZmlsbD0iI0ZBQjA0MiIgbWFzaz0idXJsKCNiKSIgZD0iTTAgMTA2Ljk4OGgyOS4zM3YtNC44MDRIMHoiLz48cGF0aCBmaWxsPSIjRTU5NTM0IiBtYXNrPSJ1cmwoI2IpIiBkPSJNNS45MjYgMTAyLjE4NGgyOS4zMzF2LTQuODA2SDUuOTI3eiIvPjxwYXRoIGZpbGw9IiNGQUIwNDIiIG1hc2s9InVybCgjYikiIGQ9Ik0yLjk0NCA5Ny4zNzhoMjkuMzN2LTQuODA0SDIuOTQ1eiIvPjwvZz48L3N2Zz4=";function Dn(){return(0,g.jsx)("svg",{width:"129px",height:"128px",viewBox:"0 0 159 158",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{height:"100%"},children:(0,g.jsxs)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:[(0,g.jsxs)("g",{transform:"translate(1.508527, 0.595868)",children:[(0,g.jsx)("mask",{id:"mask-2",fill:"white",children:(0,g.jsx)("polygon",{points:"0.0159903815 0.158395289 156.744206 0.158395289 156.744206 156.886611 0.0159903815 156.886611"})}),(0,g.jsx)("path",{d:"M156.744357,78.5224278 C156.744357,121.802055 121.659046,156.886611 78.3801738,156.886611 C35.1013011,156.886611 0.0159903815,121.802055 0.0159903815,78.5224278 C0.0159903815,35.2435551 35.1013011,0.158244436 78.3801738,0.158244436 C121.659046,0.158244436 156.744357,35.2435551 156.744357,78.5224278",fill:"#E8E9E9",mask:"url(#mask-2)"})]}),(0,g.jsx)("mask",{id:"mask-4",fill:"white",children:(0,g.jsx)("polygon",{points:"0 157.48263 158.252733 157.48263 158.252733 0.754263279 0 0.754263279"})}),(0,g.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 99.6562815 139.51985 99.6562815 139.51985 37.1844254 21.114092 37.1844254"}),(0,g.jsx)("polygon",{stroke:"#177C3E",strokeWidth:"3.852",mask:"url(#mask-4)",points:"27.0803145 94.3138347 133.554382 94.3138347 133.554382 43.1167061 27.0803145 43.1167061"}),(0,g.jsx)("path",{d:"M27.0803145,81.4809501 L27.0803145,94.3139856 L39.9141042,94.3139856 C39.9141042,87.2261735 34.1681266,81.4809501 27.0803145,81.4809501",fill:"#177C3E",mask:"url(#mask-4)"}),(0,g.jsx)("path",{d:"M39.9138779,43.1166307 L27.0800882,43.1166307 L27.0800882,55.9504204 C34.1686545,55.9504204 39.9138779,50.205197 39.9138779,43.1166307",fill:"#177C3E",mask:"url(#mask-4)"}),(0,g.jsx)("path",{d:"M133.554457,55.9501187 L133.554457,43.116329 L120.719913,43.116329 C120.719913,50.204141 126.465891,55.9501187 133.554457,55.9501187",fill:"#177C3E",mask:"url(#mask-4)"}),(0,g.jsx)("path",{d:"M120.720969,94.314061 L133.554005,94.314061 L133.554005,81.4802713 C126.466193,81.4802713 120.720969,87.226249 120.720969,94.314061",fill:"#177C3E",mask:"url(#mask-4)"}),(0,g.jsx)("path",{d:"M96.1528794,68.4205043 C96.1528794,78.3828137 89.0635589,86.4602192 80.3171219,86.4602192 C71.5714392,86.4602192 64.4821186,78.3828137 64.4821186,68.4205043 C64.4821186,58.4574407 71.5714392,50.3807895 80.3171219,50.3807895 C89.0635589,50.3807895 96.1528794,58.4574407 96.1528794,68.4205043",fill:"#177C3E",mask:"url(#mask-4)"}),(0,g.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 102.9856 139.51985 102.9856 139.51985 99.6562815 21.114092 99.6562815"}),(0,g.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 106.314918 139.51985 106.314918 139.51985 102.9856 21.114092 102.9856"}),(0,g.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 109.64499 139.51985 109.64499 139.51985 106.315672 21.114092 106.315672"}),(0,g.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 112.974308 139.51985 112.974308 139.51985 109.64499 21.114092 109.64499"}),(0,g.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 116.303626 139.51985 116.303626 139.51985 112.974308 21.114092 112.974308"}),(0,g.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 119.632944 139.51985 119.632944 139.51985 116.303626 21.114092 116.303626"}),(0,g.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 122.962263 139.51985 122.962263 139.51985 119.63219 21.114092 119.63219"}),(0,g.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 126.291581 139.51985 126.291581 139.51985 122.962263 21.114092 122.962263"}),(0,g.jsx)("polygon",{fill:"#F2F2F2",mask:"url(#mask-4)",points:"73.0526614 99.6562815 87.5812807 99.6562815 87.5812807 37.1844254 73.0526614 37.1844254"}),(0,g.jsx)("polygon",{fill:"#C6C6C5",mask:"url(#mask-4)",points:"73.0526614 126.291581 87.5812807 126.291581 87.5812807 99.6562815 73.0526614 99.6562815"}),(0,g.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"8.87013617 131.013269 38.2011723 131.013269 38.2011723 126.208612 8.87013617 126.208612"}),(0,g.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.98235701 126.208612 32.3133932 126.208612 32.3133932 121.4032 2.98235701 121.4032"}),(0,g.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"3.09775929 121.4032 32.4287954 121.4032 32.4287954 116.598543 3.09775929 116.598543"}),(0,g.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"5.92624659 116.598543 35.2572827 116.598543 35.2572827 111.793132 5.92624659 111.793132"}),(0,g.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"2.98235701 111.793886 32.3133932 111.793886 32.3133932 106.988475 2.98235701 106.988475"}),(0,g.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"-0.000754263279 106.988475 29.3302819 106.988475 29.3302819 102.183818 -0.000754263279 102.183818"}),(0,g.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"5.92624659 102.183818 35.2572827 102.183818 35.2572827 97.3784064 5.92624659 97.3784064"}),(0,g.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.94388958 97.3784064 32.2749257 97.3784064 32.2749257 92.5737493 2.94388958 92.5737493"})]})})}var ao=Dn;var ht=c(d()),Tn=({domain:t,width:e=300,height:i=300})=>{let o=Et(`${Ft}?${no.default.stringify({domain:t,width:e,height:i})}`);return wi()?(0,ht.jsx)("div",{className:"partner-logo-component",children:o===null?(0,ht.jsx)("div",{className:"partner-logo",children:(0,ht.jsx)(ao,{})}):o?(0,ht.jsx)("div",{className:"partner-logo success",style:{backgroundImage:`url("${o}")`}}):(0,ht.jsx)("div",{className:"partner-logo"})}):null},ze=Tn;var $=c(d());function Jt({reward:t}){if(!t?.tiers?.length)return null;let e={currency:t.amountCurrency||t.currency,truncateIntegers:!0};return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("h3",{className:"bold mt-3",id:"threshold-tiers","aria-hidden":!0,children:"Rewards by Spend"}),(0,$.jsx)("ol",{"aria-labelledby":"threshold-tiers",children:t.tiers.map((i,o)=>{let a=o<t.tiers.length-1,n=`Spend ${W(i.spendCents||i.spend_cents,e)?.replace(a?/[ A-Z]/g:"","")}${a?"-"+W(t.tiers[o+1].spendCents||t.tiers[o+1].spend_cents,e):"+"}`,s=i.reward.type==="percentage"?`${i.reward.value/100}% back`:W(i.reward.value,e);return(0,$.jsxs)("li",{className:"flex text-sm bold mt-2","aria-label":`${n}, earn ${s}`,children:[(0,$.jsx)("span",{className:"grow text-neutralsecondary","aria-hidden":!0,children:n}),(0,$.jsx)("span",{className:"shrink-0 whitespace-nowrap text-[#0276b1] pl-4","aria-hidden":!0,children:s})]},o)})})]})}var ro=c(S());var ot=c(d()),En=t=>t>160&&t<171?t:160;function In(t){let[e,i]=(0,ro.useState)(!1),o=En(t.exclusions.length),a=t.exclusions.length,n=t.exclusions.substring(0,o);return(0,ot.jsxs)("div",{className:"website-exclusions",children:[(0,ot.jsx)("h5",{className:"bold",children:"Exclusions Apply:"}),(0,ot.jsx)("p",{children:e?t.exclusions:`${n}${a>o?"...":""}`}),a>o?(0,ot.jsx)("div",{className:"exclusion-expand",children:(0,ot.jsx)("span",{className:"exclusion-expand-text",onClick:()=>i(!e),children:e?"Collapse":"Expand"})}):null]})}var Oe=In;var lo=c(S()),po=c(H());function at(t){return["wayfair.com","wayfair.ca","jossandmain.com","birchlane.com","allmodern.com","trade.wayfair.com","perigold.com"].includes(t)}var Y=c(d()),An=({onDetailsClick:t,exclusions:e=!0,...i})=>w()==="quill.com"?(0,Y.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*All HP, Epson, and Samsung products are excluded from coupons, discounts, and rewards offers."}):at(w())?(0,Y.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*Items in cart prior to rewards activation will not be eligible for rewards."}):(0,Y.jsxs)("h6",{...i,children:[(0,Y.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,Y.jsxs)("span",{children:["Rewards may vary based on exchange rates.",e&&(0,Y.jsxs)(Y.Fragment,{children:[" ","Terms and exclusions apply,",(0,Y.jsxs)("span",{className:"tertiary-link-lighter",onClick:t,children:[" ","view details."]})]})]})]}),Ue=An;var so=c(S()),co=c(H());var J=c(d()),Be=class extends so.Component{constructor(...e){super(...e),this.state={}}componentWillMount(){}componentDidMount(){this.props.isCreditsReminderMessage&&setTimeout(()=>{f("page","creditIgnoreTooltip",{view:"cashbackNotification",type:"tooltip"}),chrome.storage.local.set({seenCreditsReminder:Date.now()})},Number(this.props.delay.replace("ms","")))}getCtaButtonText(){let e;try{let i=p.get(["shadowRootsByAppName","notification"]);if(i){let o=i();o&&(e=o.querySelector(".primary-btn-large").textContent)}}catch{}return e}render(){let{tipLabel:e,message:i,isCreditsReminderMessage:o}=this.props,a=this.props.style||{};if(this.props.delay){let n={animationDelay:this.props.delay};a=co.default.merge(n,a)}return(0,J.jsx)("div",{style:a,className:`new-tooltip ${this.props.position||""}${o?" credits-reminder":""}`,children:(0,J.jsxs)("div",{style:this.props.innerStyle||{},onClick:this.props.onDismissTooltip.bind(this),className:"new-tooltip-wrapper",children:[(0,J.jsx)("div",{className:"close icon-x"}),o?(0,J.jsx)("div",{className:`triangle ${o?"credits-reminder":""}`}):null,(0,J.jsxs)("h2",{children:[this.props.tip?(0,J.jsx)("span",{className:"bold",children:e||"tip:"}):null,i]})]})})}},bt=Be;var gt=c(d());function Mn(t,{capitalize:e=!0}={}){return t.type==="threshold"&&t.threshold?e?"Earn ":"earn ":e?"Get ":"get "}function Rn(t,{capitalizeUpTo:e=!1,hideUpTo:i=!1}={}){let o=!i&&(t.categories||t.estimated)?e?"Up to ":"up to ":"",a=t.tiers?.length?t.tiers[t.tiers.length-1].reward.type:t.type,n=t.tiers?.length?t.tiers[t.tiers.length-1].reward.value:t.amount,s=a==="percentage"?`${n/100}%`:W(n,{currency:t.amountCurrency||t.currency,truncateIntegers:!0}),r="";if(t.maxPayoutAmount){let l=W(t.maxPayoutAmount,{currency:t.maxPayoutAmountCurrency,truncateIntegers:!0});r+=` (${l} max)`}return o+s+r}function Pn(t){let e="";if(t.type==="threshold"&&t.threshold){let i=t.tiers?.length?t.tiers[t.tiers.length-1].spendCents||t.tiers[t.tiers.length-1].spend_cents:t.threshold,o=W(i,{currency:t.amountCurrency||t.currency,truncateIntegers:!0});e.length>0&&(e+=","),e+=` when you spend ${o}`}return" back"+e}function te(t,{hidePrefix:e=!1,hideSuffix:i=!1}={}){return(0,gt.jsxs)(gt.Fragment,{children:[!e&&Mn(t),(0,gt.jsx)("span",{className:"brand",children:Rn(t)}),!i&&Pn(t)]})}var R=c(d()),je=class extends lo.Component{constructor(e){super(e),this.state={isLoggedIn:it()},this.ebatesComparisonSiteList=["macys.com","oakley.com","puritanspride.com","ebay.com","walmart.com","marriott.com","sephora.com","zulily.com","tirerack.com","ancestry.com","samsclub.com","samsung.com","nordvpn.com","priceline.com","qvc.com","microsoftstore.com","starwoodhotels.com","discounttire.com","officedepot.com","lifelock.com","omahasteaks.com","woot.com","coursera.org","sixt.com","wsj.com","gilt.com"]}componentWillReceiveProps(e){e.showCreditsReminder!==this.state.showCreditsReminder&&!this.state.didDismiss&&this.setState({showCreditsReminder:e.showCreditsReminder})}renderHeadline(){return(0,R.jsx)("h2",{children:te(this.props.view.reward)})}render(){let i=!xt(w()),o=this.props.activating&&!this.state.hasClickedToLogin,a=this.props.activated&&!this.state.hasClickedToLogin,{reward:n,vendor:s}=this.props.view,r=o||a,l=n.amount/100>=5||!!n.categories,u="Ok";return(0,R.jsxs)("div",{className:"simple-section",children:[r?(0,R.jsxs)("h2",{children:["Activating ",te(n,{hidePrefix:!0})]}):l?this.renderHeadline():(0,R.jsx)("h2",{children:"Found Rewards"}),(0,R.jsxs)("h4",{className:"bold",children:["at ",s,"."]}),(0,R.jsx)("div",{className:"button-wrapper",children:it()?(0,R.jsxs)(R.Fragment,{children:[this.renderControl(u),w()==="quill.com"||at(w())?(0,R.jsx)(Ue,{}):null,this.state.showCreditsReminder&&!(a||o)?(0,R.jsx)(bt,{tip:!0,isCreditsReminderMessage:!0,tipLabel:"Activating Shopping Rewards is completely free.",message:(0,R.jsx)("span",{className:"dismiss-text",children:"Click the \u201COk\u201D button to activate Rewards on your purchases that you can redeem for gift cards at top stores."}),delay:"7000ms",style:{top:"50%",transform:"translateY(-50%)",width:"360px",right:"calc(100% + 16px)"},onDismissTooltip:this.onDismissTooltip.bind(this)}):null]}):(0,R.jsx)("button",{className:`primary-btn-large ${i?"red-btn":""} ${N("notif_rounded_border")?"rounded-btn":""}`,onClick:this.onClickSignIn.bind(this),children:u})})]})}renderControl(e){let o=!xt(w()),a=this.props.activating&&!this.state.hasClickedToLogin;return this.props.activated&&!this.state.hasClickedToLogin?(0,R.jsx)("button",{className:`primary-btn-large ${N("notif_rounded_border")?"rounded-btn":""}`,disabled:!0,children:"Activated"}):a?(0,R.jsx)("button",{className:`primary-btn-large ${N("notif_rounded_border")?"rounded-btn":""}`,disabled:!0,children:"Activating"}):(0,R.jsx)("button",{className:`primary-btn-large ${o?"red-btn":""} ${N("notif_rounded_border")?"rounded-btn":""}`,onClick:s=>{s.stopPropagation(),this.props.onActivate({label:e})},children:e})}async onClickSignIn(e){e.stopPropagation(),this.setState({hasClickedToLogin:!0});let i=po.default.get(this.props.view,"vendor"),o=await Gt();this.props.onActivate({preventHide:!this.state.hasClickedToLogin,shouldLoadEmailCreateAccountNotification:o}),f("track","signinRequired",{vendor:i}),o||window.open(`${O}/sign-in`)}},Fe=je;var y=c(d()),He=class extends uo.Component{constructor(e){super(e),this.state={}}onShowExclusion(){f("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${nt.default.get(this.props.view,"deweyResult.domain")}/coupon`,"_blank")}onConfirmDismiss(){let e=nt.default.get(this.props,"reward",{});f("trackClick","dismissCreditReminder","",{rewardAmount:e.amount,rewardDisplay:e.type}),this.props.onUserClosePopup("activate later",!0)}onShowNewUserDetails(){f("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}render(){let{activating:e,activated:i}=this.props,o=!!nt.default.get(this.props,"reward.categories"),a=this.props.hasActivatedCompetitor,n=this.props.eligibleForNewUserBonus,s=nt.default.get(this.props.view,"reward"),r="No thanks, I don't want rewards",l=this.props.view.exclusions;return(0,y.jsxs)("div",{className:"cash-back-resolve",style:this.props.isLandscape?{padding:"20px 24px 0 0"}:void 0,children:[(0,y.jsx)(Zt,{hasActivatedCompetitor:a,onUserClosePopup:this.props.onUserClosePopup,reward:s}),(0,y.jsxs)("div",{className:"credit-prompt",children:[(0,y.jsx)(ze,{domain:w()}),(0,y.jsxs)("div",{children:[N("show_rewards")&&(0,y.jsx)("div",{className:"rewards-activation",children:(0,y.jsx)(Fe,{...this.props,onShowExclusion:this.onShowExclusion.bind(this)})}),!e&&!i&&!a?(0,y.jsx)(y.Fragment,{children:(0,y.jsx)("h4",{className:"bold activate-later tertiary-link",onClick:u=>Xt(u,r,this.props.onUserClosePopup,a,s),children:r})}):(i||e)&&(0,y.jsxs)("div",{children:[(0,y.jsxs)("h6",{style:{display:"flex",marginTop:"6px",paddingLeft:"3px",fontSize:"8px",lineHeight:"10px",paddingBottom:"10px",marginBottom:o?"15px":0,borderBottom:o?"1px solid #dedede":0},children:[(0,y.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,y.jsxs)("span",{children:["Rewards may vary based on exchange rates.",nt.default.get(this.props,"view.exclusions")?(0,y.jsxs)(y.Fragment,{children:[" ","Terms and exclusions apply,",(0,y.jsx)("span",{style:{paddingLeft:"3px"},className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),o?(0,y.jsx)(Ae,{reward:this.props.reward,tld:nt.default.get(this.props.view,"deweyResult.domain")}):null,(0,y.jsx)(Jt,{reward:this.props.reward}),(i||e)&&l?(0,y.jsx)("div",{style:{paddingTop:"20px"},children:(0,y.jsx)(Oe,{exclusions:l})}):null]}),(0,y.jsx)(Pe,{reward:s,containerStyle:{marginTop:12,textAlign:"left"}}),n&&(0,y.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,y.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,y.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})]})]})}},We=He;var tt=c(S());ke();var ae=c(H());var fo=c(S()),Ln=c(mo());var ho=c(S());var bo=c(S());var go=c(S());var wo=c(S());var ko=c(S());var Un=c(S());var Rr=c(na());function ie(t,e){var i=e===void 0?{}:e,o=i.currency,a=o===void 0?"USD":o,n=i.country,s=n===void 0?"US":n,r=i.noDollarSign,l=r===void 0?!1:r,u=i.roundToNearestInteger,m=u===void 0?!1:u,h=i.floorToInteger,b=h===void 0?!1:h,M=i.truncateIntegers,P=M===void 0?!1:M;if(t==null||!Number.isFinite(t))return null;var _=t,T="en-".concat(s==="CA"||s==="AU"||s==="GB"?"US":s);m?_=Math.round(_):b&&(_=Math.floor(_));var k=_.toLocaleString(T,{style:"currency",currency:a==="CAD"||a==="AUD"?"USD":a,minimumFractionDigits:P&&Number.isInteger(_)?0:2});if(l){var E=s==="GB"?"\xA3":"$";k=k.replace(E,"")}return a==="CAD"&&(k+=" CAD"),a==="AUD"&&(k+=" AUD"),a==="GBP"&&(k+=" GBP"),k}var wt=c(S());function ra({pseudoDomain:t,baobabBranch:e,contentProps:i}){let o=[e,"conquest"],[a,n]=(0,wt.useState)(),[s,r]=(0,wt.useState)(),[l,u]=(0,wt.useState)(!0),m=async()=>{let h=p.select(o);try{u(!0),h.set({loading:!0,error:null,data:null});let b=await zi({pseudoDomain:t,contentProps:i,context:Li()});b.error?(n(void 0),r(b.error),h.set(o,{loading:!1,data:null,error:b.error})):(n(b),r(void 0),h.set(o,{loading:!1,data:b,error:null}))}catch(b){let M=b;r(M.toString()),h.set(o,{data:null,error:M,loading:!1})}finally{u(!1)}};return(0,wt.useEffect)(()=>{m()},[]),{baobabSelector:o,data:a,error:s,loading:l}}var ca=c(S());var sa=c(S()),oe=(0,sa.createContext)({onUserClosePopup:()=>{},hasActivatedCompetitor:!1,reward:null});var Ve=c(d()),la=({children:t})=>{let{onUserClosePopup:e,hasActivatedCompetitor:i,reward:o}=(0,ca.useContext)(oe);return e==null?null:(0,Ve.jsx)(vi,{variant:"tertiary",className:"mb-2 w-full",onClick:a=>Xt(a,t,e,i,o),children:(0,Ve.jsx)("span",{className:"text-gray-400 cursor-pointer font-semibold",children:t})})};var q=c(d());xi(t=>{t("sp-energy-cashback-dismissal",la)});var pa=(0,tt.memo)(({reward:t,onUserClosePopup:e,hasActivatedCompetitor:i,onActivate:o})=>{let[a,n]=(0,tt.useState)(!1),[s,r]=(0,tt.useState)(!1),[l,u]=(0,tt.useState)(!1),m=w(),h={reward:t,domain:m},{data:b,error:M,loading:P}=ra({pseudoDomain:m,baobabBranch:"energyCashback",contentProps:h}),_=(0,tt.useCallback)((0,ae.debounce)(async E=>{if("eventName"in E&&E.eventName==="activate_energy_cashback"){n(!0);try{await o({label:"Activate Rewards"}),r(!0)}catch{u(!0)}finally{n(!1)}}},350),[]);if(P)return(0,q.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,q.jsx)(Pi,{})});if(M||!b?.notification)return(0,q.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,q.jsx)("p",{className:"text-critical",children:"Encountered an error retrieving content"})});let T=ie(t.amount/100,{currency:t.amountCurrency||t.currency,truncateIntegers:!0}),k=ri(ai(new Date,1),"MMMM d");return(0,q.jsxs)(oe.Provider,{value:{onUserClosePopup:e,hasActivatedCompetitor:i,reward:t},children:[(0,q.jsx)(Zt,{onUserClosePopup:e}),(0,q.jsx)(Yt,{client:Wt.DESKTOP_WEB,data:{isActivating:a,isActivated:s,hasActivationError:l,domain:w(),reward:T,expirationDate:k},config:{rootEl:"div",logLevel:void 0},content:b.notification.blocksTemplate,onEvent:_,children:(0,q.jsx)("style",{children:".object-contain { object-fit: contain; }"})})]})},({reward:t,hasActivatedCompetitor:e},{reward:i,hasActivatedCompetitor:o})=>(0,ae.isEqual)(t,i)&&e===o);var ne=t=>(p.get(["energyCashbackDomains"])||[]).includes(t);var et=c(d());function Pr(){return{left:"auto",right:"655px"}}function Lr({offerSignUp:t,storeName:e,hideNotification:i,onDismissTooltip:o,hasSeenCashbackSignupTip:a,hasSeenCashbackActivateTip:n,wrapperStyle:s={}}){let r=Pr();return(0,et.jsxs)("div",{style:s,children:[!a&&t&&!i?(0,et.jsx)(bt,{tip:!0,message:(0,et.jsxs)("span",{children:["Capital One Shopping can help you save ",(0,et.jsx)("br",{}),"on ",e," today, just click activate. It's easy and free money."]}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"461px",left:r.left,right:r.right},onDismissTooltip:o.bind(null,"hasSeenCashbackSignupTip")}):null,!n&&!t&&!i?(0,et.jsx)(bt,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,et.jsx)("span",{children:"Just click when you see this to get free money, seriously."}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"468px",left:r.left,right:r.right},onDismissTooltip:o.bind(null,"hasSeenCashbackActivateTip")}):null]})}var It=Lr;var V=c(d()),Ge=class extends ua.Component{constructor(...e){super(...e),this.state={hideNotification:N("ext_rewards_remove_delay")?this.props.view&&C.default.get(this.props,"view.user.activated"):!0,hasSentPossibleExpMetric:!1}}async componentWillReceiveProps(e){this.props&&e&&!this.props.warnAboutStandDown&&e.warnAboutStandDown&&this.state.activated&&this.setState({hideNotification:!1,hasSentPageNotification:!1,activated:!1,activating:!1,hasActivated:!0})}async componentDidUpdate(e,i){if(i.hideNotification!==this.state.hideNotification&&this.sendCashbackPageEvent(),e.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!p.get("throttleCreditsReactivation")){let o=await Rt();p.merge({cashback:o}),await rt("reactivate")}}componentDidMount(){let e=this.props.view&&C.default.get(this.props,"view.user.activated");setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),N("ext_rewards_remove_delay")||this.setState({hideNotification:e}),this.sendCashbackPageEvent(),Gi()},N("ext_rewards_remove_delay")?0:1e3)}async sendCashbackPageEvent(){let e=(0,da.findDOMNode)(this),i="",o="";if(e){let a=e.querySelector("button");a&&a.textContent&&(i=a.textContent.toLowerCase())}!this.state.hideNotification&&!this.state.hasSentPageNotification&&kt()&&(this.setState({hasSentPageNotification:!0}),f("page","cashbackNotification",{view:"cashbackNotification",type:"notification",source:"cashback",deweyResult:C.default.get(this.props.view,"deweyResult.pageType"),offerSignUp:C.default.get(this.props.view,"offerSignUp"),qualified:C.default.get(this.props.view,"qualified",!1),balance:C.default.get(this.props.view,"balance",0),promotionalRate:void 0,vendorMetaId:C.default.get(this.props.view,"id"),token:C.default.get(this.props.view,"token"),ctaText:i,notificationText:o}))}trackFirstDragEnd=C.default.once((e,i)=>{Ai("cashbackNotification",e,i)});render(){let{hideNotification:e}=this.state,i=C.default.get(this.props.view,"offerSignUp"),o=C.default.get(this.props.view,"vendor");if(!this.props.cashbackVisible||this.props.couponsVisible&&!(this.props.couponView&&this.props.couponView.isQuietSavingsMiss)&&!this.props.view.autoActivate||!kt())return!this.state.hasSentPossibleExpMetric&&!kt()&&(this.setState({hasSentPossibleExpMetric:!0}),f("page","possibleExperience",{type:null,source:"credits",notificationText:"credits"})),null;let a=C.default.get(this.props,"view.reward"),n=$i();return(0,V.jsxs)(Ti,{onClick:()=>this.setState({fullScreen:!1}),className:`${e?"disabled cashback-page":"cashback-page"}`,style:{top:"0",bottom:"auto",left:n.left??"auto",right:n.right??"0",translate:n.translateX},dragSelector:"header",onDragEnd:this.trackFirstDragEnd,children:[(0,V.jsx)(Mt.Motion,{style:{opacity:(0,Mt.spring)(e?0:1,{stiffness:180,damping:20}),tabOpacity:e?0:1,y:(0,Mt.spring)(e?-100:0,{stiffness:180,damping:20}),tabX:e?80:0},children:({opacity:s,y:r})=>(0,V.jsxs)("div",{className:`cashback-notification ${N("notif_rounded_border")?"rounded-notification":""}`,style:{transform:`translate3d(0,${r}%,0)`,opacity:`${s}`},children:[(0,V.jsxs)("header",{className:"reward-header",children:[(0,V.jsx)(dt,{}),(0,V.jsx)(Mi,{})]}),ne(w())?(0,V.jsx)(pa,{reward:a,onUserClosePopup:this.onUserClosePopup.bind(this),hasActivatedCompetitor:this.props.hasActivatedCompetitor,onActivate:this.determineRunCashback.bind(this)}):(0,V.jsx)(We,{view:this.props.view,hasActivated:this.state.hasActivated,hasActivatedCompetitor:this.props.hasActivatedCompetitor,reward:a,activated:this.state.activated,activating:this.state.activating,hasCoupons:C.default.get(this.props,"view.hasCoupons"),session:this.props.session,showInitialSignup:this.state.showInitialSignup,tld:this.props.tld,activate:this.state.activate,onActivate:this.determineRunCashback.bind(this),dismissNotification:()=>this.setState({hideNotification:!0}),hasSeenFTUX:C.default.get(this.props,"events.hasSeenCashbackFtux",!1),onUserClosePopup:this.onUserClosePopup.bind(this),deweyResult:C.default.get(this.props.view,"deweyResult"),setSeenCashbackFtux:this.setSeenCashbackFtux.bind(this),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus})]})}),(0,V.jsx)(It,{offerSignUp:i,storeName:o,hideNotification:e,onDismissTooltip:this.onDismissTooltip.bind(this),hasSeenCashbackSignupTip:C.default.get(this.props,"events.hasSeenCashbackSignupTip"),hasSeenCashbackActivateTip:C.default.get(this.props,"events.hasSeenCashbackActivateTip")})]})}determineRunCashback(e){return it()?this.onActivate(e):(e?.shouldLoadEmailCreateAccountNotification&&this.setState({hideNotification:!0},()=>{mt()}),Pt())}onDismissTooltip(e){C.default.get(this.props,`events.${e}`)||At(e)}async onActivate(e={}){let i=C.default.get(this.props.view,"reward",{}),a=C.default.get(this.props.view,"hasCoupons")?1500:5e3;this.setState({activating:!0}),this.onDismissTooltip("hasSeenCashbackActivateTip");let{isRedirectEnabled:n}=await _t({reward:i,view:e.view,label:e.label});this.setState({activated:!0}),e.preventHide||setTimeout(()=>{this.setState({hideNotification:!0},()=>{n||mt(i)})},a),Dt()}onUserClosePopup(e,i=!1){let o=C.default.get(this.props.view,"reward",{});(C.default.get(this.props.view,"user.hasSeenFirst")||C.default.get(this.props.view,"isCashbackURLMatch"))&&(qt(),to("cashback","cta")),this.setState({hideNotification:!0}),C.default.get(this.props.view,"offerSignUp")?this.onDismissTooltip("hasSeenCashbackSignupTip"):this.onDismissTooltip("hasSeenCashbackActivateTip"),i||(f("trackClick","dismissCashbackNotification",e,{rewardAmount:o.amount,rewardDisplay:o.type}),Z("cashbackNotification",e,"dismiss","primary",{rewardAmount:o.amount,rewardDisplay:o.type}))}setSeenCashbackFtux(){At("hasSeenCashbackFtux")}},$e=ut({view:["cashbackView"],couponView:["couponView"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"],cashbackVisible:["cashbackVisible"]},Ge);var B=c(S()),yt=c(H());var qe=()=>v("setReactivateNotifThrottled",{domain:w()});var x=c(d()),zr=({children:t})=>(0,x.jsx)("div",{className:"bg-overlay flex justify-center items-center fixed top-0 left-0 w-screen h-screen z-[9999]",children:t}),Or=({children:t})=>(0,x.jsx)("div",{className:"bg-white rounded-lg flex flex-col items-center p-2 w-[400px] h-[240px]",children:t}),Ur=({children:t})=>(0,x.jsx)("div",{className:"mt-2 flex justify-between w-full",children:t}),Br=({children:t})=>(0,x.jsx)("div",{className:"flex flex-col items-center mt-8 w-full",children:t}),jr=t=>{let e=p.get("cashback"),[i,o]=(0,B.useState)(t.hasActivatedCompetitor||t.warnAboutStandDown),[a,n]=(0,B.useState)(yt.default.get(e,"user.compInactivated")),[s,r]=(0,B.useState)(a&&i),[l,u]=(0,B.useState)(!1),[m,h]=(0,B.useState)(!1),[b,M]=(0,B.useState)("Re-activate Rewards"),P=(0,B.useState)(yt.default.get(t.view,"reward",{})),_=yt.default.get(t,"view.exclusions");(0,B.useEffect)(()=>{ma(t.tld)},[]),(0,B.useEffect)(()=>{s&&f("page","rewardsReactivation",{view:"rewardsReactivation",type:"notification"})},[s]);let T=async()=>{let j=await Rt();p.merge({cashback:j}),n(yt.default.get(p.get("cashback"),"user.compInactivated")),o(t.hasActivatedCompetitor||t.warnAboutStandDown)};(0,B.useEffect)(()=>{(t.hasActivatedCompetitor||t.warnAboutStandDown)&&T()},[t.hasActivatedCompetitor,t.warnAboutStandDown]),(0,B.useEffect)(()=>{a&&i&&r(!0)},[a,i]);let k=async()=>{let F=`${p.get(["couponView","hasDeferredCouponRewards"])?"Activate":"Re-activate"} Rewards`;return M(F),F};(0,B.useEffect)(()=>{k()},[P]);let E=async(j={})=>{u(!0),await _t({reward:P,view:"cashbackReactivate",label:b}),u(!1),h(!0),qe(),setTimeout(()=>r(!1),1e3)},ct=()=>{f("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${t.tld}/coupon`,"_blank")},X=(j,lt=!1)=>{let F=yt.default.get(t.view,"reward",{});r(!1),lt||(f("trackClick","dismissCashbackNotification",j,{rewardAmount:F.amount,rewardDisplay:F.type}),Z("rewardsReactivation",j,"dismiss","primary",{rewardAmount:F.amount,rewardDisplay:F.type})),qe()};return(0,x.jsx)(x.Fragment,{children:s?(0,x.jsx)(zr,{children:(0,x.jsxs)(Or,{children:[(0,x.jsxs)(Ur,{children:[(0,x.jsx)(dt,{}),(0,x.jsx)(Ht,{onClick:()=>{X(b)}})]}),(0,x.jsxs)(Br,{children:[(0,x.jsx)("p",{className:"text-2xl leading-9 font-bold text-neutralprimary",children:"Oops! Rewards were disabled."}),(0,x.jsx)("p",{className:"leading-6 text-neutralsecondary",children:"You used another coupon site."}),l?(0,x.jsx)("h5",{className:"bold rewards-only-button red",children:"Activating..."}):m?(0,x.jsx)("h5",{className:"bold rewards-only-button red",children:"Activated!"}):(0,x.jsx)("button",{className:"primary-btn-large red-btn",style:{width:"90%",marginTop:"16px"},onClick:E,children:b}),(l||m)&&(0,x.jsx)("div",{className:`exclusions-wrapper ${l||m?"visible":"invisible"}`,children:(0,x.jsx)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px",textAlign:"center"},children:(0,x.jsxs)("span",{children:[(0,x.jsx)("div",{children:"* Rewards may vary based on exchange rates."}),_?(0,x.jsxs)("div",{children:[" ","Terms and exclusions apply,",(0,x.jsxs)("span",{className:"tertiary-link-lighter",onClick:ct,children:[" ","view details."]})]}):null]})})})]})]})}):null})},Ke=ut({view:["cashbackView"],couponView:["couponView"],offers:["offers"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},jr);ke();var fa={cashback:"__wb_cns",sitehub:"__wb_sns"};function ha(t,e=60){let i=fa[t];if(!i)return console.error("[throttleNotification] Unknown notification type:",t),!1;let o=parseInt(localStorage.getItem(i))||0;return ni(new Date,new Date(o))>=e?(localStorage.setItem(i,String(+new Date)),!0):!1}function ba(t){let e=fa[t];if(!e){console.error("[clearThrottle] Unknown notification type:",t);return}localStorage.removeItem(e)}var K=c(S()),Ra=c(fi());gi();var ga="Cashback_Rewards";var re=c(S());async function Fr(t,e){let i=ki(t),o=await _i(i);if(!o)return null;let a=await Ii();return{config:{rootEl:"div",logLevel:null},content:o,data:e,...a}}function wa(t,e){let[i,o]=(0,re.useState)(null);return(0,re.useEffect)(()=>{Fr(t,e).then(a=>o(a)).catch(console.error)},[]),i}var Ia=c(Sa());gi();var qr="Rewards",Kr="prefix",Xr="prefix_lower",Zr="threshold_prefix",Qr="threshold_prefix_lower",Jr="up_to",ts="up_to_lower",es="suffix",is="max_payout",os="suffix_threshold_condition";function Na(t,e,{capitalizePrefix:i=!0}={}){return t.type==="threshold"&&t.threshold?e(i?Zr:Qr):e(i?Kr:Xr)}function Da(t,e,i,{capitalizeUpTo:o=!1,hideUpTo:a=!1}={}){var n,s;let r="";!a&&t.categories&&(r=e(o?Jr:ts));let l=!((n=t.tiers)===null||n===void 0)&&n.length?t.tiers[t.tiers.length-1].reward.type:t.type,u=!((s=t.tiers)===null||s===void 0)&&s.length?t.tiers[t.tiers.length-1].reward.value:t.amount,m=l==="percentage"?`${u/100}%`:i(u),h="";if(t.maxPayoutAmount){let b=i(t.maxPayoutAmount);h+=e(is,{parseValues:{formattedMaxPayoutAmount:b}})}return r+m+h}function Ta(t,e,i){var o;let a="";if(t.type==="threshold"&&t.threshold){let n=!((o=t.tiers)===null||o===void 0)&&o.length?t.tiers[t.tiers.length-1].spendCents:t.threshold,s=i(n);a=e(os,{parseValues:{formattedSpendThreshold:s}})}return e(es)+a}function as(t,e,i,{capitalizePrefix:o=!0,capitalizeUpTo:a=!1,hideUpTo:n=!1}={}){let s=Na(t,e,{capitalizePrefix:o}),r=Da(t,e,i,{capitalizeUpTo:a,hideUpTo:n}),l=Ta(t,e,i);return`${s}${r}${l}`}function Ea(t){let{getValue:e}=jt(qr),{formatCurrency:i}=Ci(),o=l=>i(l,t);return{getFullDescription:(l,u)=>as(l,e,o,u),getPrefix:(l,u)=>Na(l,e,u),getText:(l,u)=>Da(l,e,o,u),getSuffix:l=>Ta(l,e,o)}}function Aa(){let{cashbackView:t,couponView:e,events:i,settings:o,hasActivatedCompetitor:a,warnAboutStandDown:n,couponsVisible:s,throttleCreditsReactivation:r,userCountry:l,userCurrency:u}=(0,Ia.useBranch)({cashbackView:["cashbackView"],couponView:["couponView"],events:["events"],session:["session"],settings:["settings"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"],throttleCreditsReactivation:["throttleCreditsReactivation"],tld:["siteAPIData","siteData","tld"],userCountry:["session","country"],userCurrency:["siteAPIData","meta","currency"]}),{autoActivate:m,balance:h,exclusions:b,hasCoupons:M,id:P,isCashbackURLMatch:_,offerSignUp:T,qualified:k,reward:E,token:ct,user:X,vendor:j}=t,lt=l||"US",F=E?.amountCurrency||E?.currency||u,{getPrefix:pe,getText:Lt,getSuffix:ue}=Ea({country:lt,currency:F,truncateIntegers:!0}),de=!!(X&&X.activated),pt=!!(X&&X.hasSeenFirst),{isQuietSavingsMiss:me}=e,{eligibleForNewUserBonus:zt}=o,ii="hasSeenCashbackSignupTip"in i,I="hasSeenCashbackActivateTip"in i,{type:Ot,amount:Oa,categories:fe,threshold:Ua,tiers:Ba}=E,Ut=Ba?.map(be=>({...be,spendCents:be.spendCents||be.spend_cents}))??[],ja=!!(fe&&fe.length>0),Fa=Ut?.length>0?Ut[Ut.length-1].spendCents:Ua,Ha=pe(E),Wa=Lt(E),Ya=ue(E),{pageType:Va,domain:oi}=t.deweyResult,Ga=kt(),$a=it(),he=w(),qa=xt(he),Ka=he==="quill.com",Xa=at(he),Za=!qa,Qa=`${O}/s/${oi}/coupon`;return{allowNotification:Ga,warnAboutStandDown:n,hasSeenCashbackSignupTip:ii,hasSeenCashbackActivateTip:I,hasActivatedCompetitor:a,hasCategories:ja,hasCoupons:M,isCashbackURLMatch:_,deweyDomain:oi,deweyPageType:Va,offerSignUp:T,qualified:k,balance:h,vendorMetaId:P,exclusionDetailsLink:Qa,websiteExclusions:b,token:ct,eligibleForNewUserBonus:zt,vendor:j,couponsVisible:s,isQuietSavingsMiss:me,autoActivate:m,reward:E,rewardAmount:Oa,rewardType:Ot,rewardThreshold:Fa,rewardCategories:fe,rewardTiers:Ut,rewardPrefixText:Ha,rewardText:Wa,rewardSuffixText:Ya,useRedCta:Za,activated:de,isFullAccount:$a,isQuillDomain:Ka,isWayfairDomain:Xa,throttleCreditsReactivation:r,userHasSeenFirst:pt}}var st=c(d());function ns(t){let{getValue:e}=jt(ga),i=Aa(),{activated:o,allowNotification:a,hasCoupons:n,hasSeenCashbackActivateTip:s,hasSeenCashbackSignupTip:r,isCashbackURLMatch:l,isFullAccount:u,offerSignUp:m,reward:h,throttleCreditsReactivation:b,userHasSeenFirst:M,vendor:P,warnAboutStandDown:_}=i,T=wa("blocks-cashback-rewards"),[k,E]=(0,K.useState)(o),[ct,X]=(0,K.useState)(!1),[j,lt]=(0,K.useState)(!1),[F,pe]=(0,K.useState)(!1),[Lt,ue]=(0,K.useState)(!1);(0,K.useEffect)(()=>{if(j||k||!a)return;let I=e("cta_text");f("page","cashbackNotification",{view:"cashbackNotification",type:"notification",source:"cashback",deweyResult:i.deweyPageType,offerSignUp:i.offerSignUp,qualified:i.qualified,balance:i.balance,promotionalRate:void 0,vendorMetaId:i.vendorMetaId,token:i.token,ctaText:I,notificationText:""}),lt(!0)},[j,k]),(0,K.useEffect)(()=>{async function I(){!_||b||F||(await Ma(),pe(!0))}I()},[_,b,F]),(0,K.useEffect)(()=>{Lt||a||(f("page","possibleExperience",{type:null,source:"credits",notificationText:"credits"}),ue(!0))},[Lt,a]);let de=async()=>(f("track","signinRequired",{vendor:P}),await Gt()?(E(!0),mt()):window.open(`${O}/sign-in`),Pt()),pt=I=>{(I==="hasSeenCashbackSignupTip"&&!r||I==="hasSeenCashbackActivateTip"&&!s)&&At(I)},me=async()=>{if(X(!0),!u)return de();pt("hasSeenCashbackActivateTip");let I=e("cta_text"),{isRedirectEnabled:Ot}=await _t({reward:h,label:I,pageLocation:void 0,view:void 0});setTimeout(()=>{Ot||mt(h),E(!0)},n?1500:5e3),Dt()},zt=I=>{(M||l)&&qt(),E(!0),pt(m?"hasSeenCashbackSignupTip":"hasSeenCashbackActivateTip"),f("trackClick","dismissCashbackNotification",I,{rewardAmount:h.amount,rewardDisplay:h.type}),Z("cashbackNotification",I,"dismiss","primary",{rewardAmount:h.amount,rewardDisplay:h.type})};return{blocksConfig:T,data:i,handleBlocksEvent:I=>{if(Ei(I,t),I.type===ye.NotificationDismiss&&zt("Dismiss Notification"),I.type===ye.Custom)switch(I.eventName){case"activateReward":me();break;case"dismiss":zt(e("dismiss_button_text"));break;default:break}},handleDismissTooltip:pt,hideNotification:k,isActivating:ct,setIsActivating:X,activated:o,hasSentPageNotification:j}}function ce({onUnload:t}){let{blocksConfig:e,data:i,handleBlocksEvent:o,handleDismissTooltip:a,hideNotification:n,isActivating:s,activated:r,hasSentPageNotification:l}=ns(t),{allowNotification:u,couponsVisible:m,hasSeenCashbackActivateTip:h,hasSeenCashbackSignupTip:b,isQuietSavingsMiss:M,autoActivate:P,offerSignUp:_,vendor:T}=i,k=Et(`${Ft}?${Ra.default.stringify({domain:i.deweyDomain,width:300,height:300})}`);return!e||n||!u||m&&!M&&!P?null:(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)(Yt,{client:Wt.DESKTOP_WEB,config:{...e.config,disableAnimation:l},content:e.content,host:e.host,user:e.user,data:{...i,isActivating:s,activated:r,logoImageUri:k},onEvent:o}),(0,st.jsx)(It,{offerSignUp:_,storeName:T,hideNotification:n,onDismissTooltip:a,hasSeenCashbackSignupTip:b,hasSeenCashbackActivateTip:h})]})}var le=c(d());function rs(){return p.get("hasActivatedCompetitor")||p.get("warnAboutStandDown")}function ss(){return ne(w())?!1:N("should_use_blocks_service")&&N("ext_blocks_cashback_rewards_switch")}var La;function cs(){La?.()}async function rt(t="cashback"){let e;t==="reactivate"?e=(0,le.jsx)(Ke,{}):ss()?e=(0,le.jsx)(ce,{onUnload:cs}):e=(0,le.jsx)($e,{}),La=(await Vt({appName:t,cssUrl:"cashback.css",app:e})).unloadApp,p.set("cashbackVisible",!0),t==="reactivate"&&(Si("cashback"),p.set("cashbackReactivateVisible",!0))}var ls={devRewardTest:!1};async function ps(t,e){let{devRewardTest:i=!1}=e??ls,o=p.get("cashback"),a=rs()&&z.default.get(o,"user.compInactivated");if((Bi()||ji())&&!a){Hi();return}let n=Pa.default.getDomain(location.href);if(n?.match(/hilton\.com/)&&N("cb_hilton_honors"))return;let s=n&&di(n)&&N("expedia_extension_testing_q2_2025"),r=!1,l=["cartPage","checkoutPage","reviewPage"],{siteData:u,meta:m}=p.get("siteAPIData")||await Di(),h=u.cashback?.pageTypeOverrides||z.default.get(u.cashback,"pageTypesOverride",{})||{},b=z.default.get(t,"pageType");if(h&&h[b]){let _=h[b],T=z.default.get(_,"value",_),k;if(T==="show"?r=!0:T==="hide"?r=!1:T==="conditional"&&_.conditional&&(k=us(_.conditional),!k||k.type==="hide"&&k.hide?r=!1:r=!0),f("track","cashbackNotificationOverride",{show:r,reason:z.default.get(k,"feature","")}),!r)return}else if(s&&!["cartPage","checkoutPage","confirmationPage"].includes(b))ha("cashback")&&(r=!0,ba("sitehub"));else if(a)r=!0;else if(l){if(r=l.indexOf(b)!==-1,a&&(r=!0),o&&(z.default.get(o,"user.activated")||a)&&!r&&!z.default.get(o,"user.dismissed")&&!p.get("cashbackVisible")&&!p.get("couponsVisible")&&!p.get("cashbackReactivateVisible")&&!p.get("throttleCreditsReactivation")){await rt("reactivate");return}}else b=z.default.snakeCase(b),r=new Set(u.cashback.minNotificationsPageTypes).has(b);if(i&&(r=!0),!r){let _=Object.keys(u.pageTypesV2||{}),T=_.includes("cartPage"),k=_.includes("checkoutPage");(!T&&new RegExp(/^\/cart(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname)||!k&&new RegExp(/^\/checkout(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname))&&(r=!0)}let M=s?o?.user?.dismissed&&o?.user?.dismissedPageType==="checkoutPage":o?.user?.dismissed;if(!o||!r||M||p.get("cashbackVisible")||p.get("cashbackReactivateVisible"))return;if(Fi()){Wi();return}let P=p.get("cashbackView")||o;if(p.set("cashbackView",{...P,isCashbackURLMatch:!0,deweyResult:t,ebatesReward:u.ebatesReward,exclusions:z.default.get(u,"merchantPage.exclusions"),affiliateLinkCurrentTab:z.default.get(m,"affiliate_link_current_tab")}),a&&!z.default.get(o,"user.activated")&&!p.get("couponsVisible")&&!p.get("throttleCreditsReactivation")){p.set(["warnAboutStandDown"],!0),await rt("reactivate");return}await rt()}function us(t){try{let e=JSON.parse(t),i=z.default.map(e.hide,s=>({hide:N(s),feature:s,type:"hide"})),o=z.default.map(e.show,s=>({show:N(s),feature:s,type:"show"})),a=z.default.find(i,{hide:!0}),n=z.default.find(o,{show:!0});return a||n||!1}catch{return!1}}var za=t=>v("checkIfInPriceComparison",t);var ds=new Set(["ebay.com","stubhub.com","stubhub.ca"]);async function ti(t){if(ds.has(t))return za(t)}async function Rt(t=!1){let e=!1,i=await Vi(t);return(i&&Q.default.get(i,"reward.amount")||t&&i?.hasDeferredProgramSelection)&&(e=i),e}async function Ma(){let t=await Rt();p.merge({cashback:t}),await rt("reactivate")}function At(t){let e={[t]:Date.now()},i=Q.default.cloneDeep(p.get(["events"]));i=Q.default.merge(i,e),p.set(["events"],i),Yi(t)}async function ma(t){let e={rakuten:"rakuten",honey:"honey",rmn:"rmn"},i=await $t(e.honey),o=await $t(e.rakuten),a=await $t(e.rmn),n="";i&&(n="honey"),a&&(n="rmn"),o&&(n="rakuten"),chrome.storage.local.set({[`${n}WarningNotif-${t}`]:Bt()},()=>{o&&St(e.rakuten),i&&St(e.honey),a&&St(e.rmn),n===""&&St(n)})}async function Pt({token:t,clickId:e,coupons:i,codeEntered:o,autoSavings:a=!1,fromAutoRun:n,fromActivateRewards:s,isSiteHub:r}={}){let l=w();p.set(["couponsAffiliateDisabledSites",`${l}_${p.get("tabId")}`],we(ge(new Date,30)));let u=e||ei.default.v4().replace(/-/g,""),m=await Se({pageViewId:p.get("pageViewId"),clickId:u,domain:l,coupons:i,codeEntered:o,programId:p.get(["siteAPIData","programId"]),vendorMetaId:p.get("cashback","id"),token:t||p.get("cashback","token"),fromAutoRun:n,autoSavings:a,fromActivateRewards:s,isSiteHub:r});return i&&m?.tripId&&p.set(["couponView","tripId"],m.tripId),m}async function ms({token:t}={}){let e=w();await Promise.all([Ne("affiliateRedirect",JSON.stringify({redirected:!0,location:location.href})),Ne("emailCreateAccount",JSON.stringify({shouldLoadNotification:!0}))]),p.set(["couponsAffiliateDisabledSites",`${e}_${p.get("tabId")}`],we(ge(new Date,30)));let i=ei.default.v4().replace(/-/g,""),o,a="cashback",n=await ti(e);n&&(a="cashback-ims");let s={destUrl:location.href,channel:a,subExperience:"credits",redirectId:hi(i),sameTab:!0,vendorMetaId:p.get("cashback","id"),token:t||p.get("cashback","token"),clickEvent:"cashbackRedirect",...!n&&{destDomain:p.get("siteAPIData","tld")}},r=p.get("cashback","redirectUrl");r?o=mi(r,{extensionVersion:chrome.runtime.getManifest().version,subExperience:s.subExperience,redirectId:s.redirectId,clickEvent:s.clickEvent}):o=Ni({params:s});let l={affiliateUrl:o,pageViewId:p.get("pageViewId"),clickId:i,domain:e,preventPinnedTab:!0,vendorMetaId:p.get("cashback","id"),token:t||p.get("cashback","token"),programId:p.get(["siteAPIData","programId"])};return Se(l),l}async function _t({reward:t,token:e,pageLocation:i,view:o,label:a="",sendClickEvent:n=!0}){f("trackClick","activateCashback","activate",{rewardAmount:t.amount,rewardDisplay:t.type,label:a,view:o,pageLocation:i}),n&&Z(i==="sitehub"?"siteHubOffers":o==="cashbackReactivate"?"rewardsReactivation":"cashbackNotification",a,"cta","primary",{redirect:!0,cashback:!!t.amount,rewardAmount:t.amount,rewardDisplay:t.type,view:o});let s=p.get(["siteAPIData"]),r=p.get(["deweyResult"]),l=Q.default.get(r,"pageData.meta"),u=!0;if(l&&Q.default.has(l,"disable_aff_link_current_tab")&&(u=!1),u&&Q.default.get(s,"meta.affiliate_link_current_tab")){let h=await ms({token:e});return f("track","activateCashbackRedirect",Q.default.assign({rewardAmount:t.amount,rewardDisplay:t.type,view:o},h)),location.href=h.affiliateUrl,{isRedirectEnabled:!0}}p.set(["cashbackView","user","activating"],!0),p.set(["cashback","user","activating"],!0),p.set(["offers","cashback","user","activating"],!0);let m=await Pt({token:e});return p.set(["cashbackView","user","activated"],!0),p.set(["cashback","user","activated"],!0),p.set(["offers","cashback","user","activated"],!0),f("track","activateCashbackRedirect",Q.default.assign({rewardAmount:t.amount,rewardDisplay:t.type,view:o},m)),{isRedirectEnabled:!1}}function kt(){let t=!0;if(N("ext_ae_api_v_2")){let e=p.get(["couponView","elasticityUserDomain"]);e&&!e?.i&&(t=e.s)}return!!t}var Ef=t=>v("activateCashback",t);export{Bi as a,ji as b,Fi as c,Hi as d,Wi as e,Ne as f,Z as g,ti as h,Rt as i,At as j,Pt as k,ms as l,_t as m,$i as n,Dt as o,to as p,hc as q,Ae as r,Me as s,Pe as t,Et as u,al as v,ze as w,Jt as x,Oe as y,at as z,Ue as A,bt as B,Mn as C,Rn as D,Pn as E,te as F,Ke as G,ha as H,Ea as I,rs as J,rt as K,ps as L,Ef as M};
/*! Bundled license information:

exenv/index.js:
  (*!
    Copyright (c) 2015 Jed Watson.
    Based on code that is Copyright 2013-2015, Facebook, Inc.
    All rights reserved.
  *)
*/
