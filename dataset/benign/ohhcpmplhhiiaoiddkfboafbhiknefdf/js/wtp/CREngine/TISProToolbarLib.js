/*! For license information please see TISProToolbarLib.js.LICENSE.txt */
(function(){var exports=window,TitaniumFeatureConfig={EnableUntestedFeedbackFeature:!0,EnableFacebookAlertYourFriend:!0,EnableSafeSearching:!0};function updateFeatureConfig(e){void 0!==e&&(void 0!==e.EnableUntestedFeedbackFeature&&(TitaniumFeatureConfig.EnableUntestedFeedbackFeature=e.EnableUntestedFeedbackFeature),void 0!==e.EnableFacebookAlertYourFriend&&(TitaniumFeatureConfig.EnableFacebookAlertYourFriend=e.EnableFacebookAlertYourFriend),void 0!==e.EnableSafeSearching&&(TitaniumFeatureConfig.EnableSafeSearching=e.EnableSafeSearching),logInfo("updateFeatureConfig: TitaniumFeatureConfig = "+JSON.stringify(TitaniumFeatureConfig)))}exports.TSRUpdateFeatureConfig=updateFeatureConfig;var C_TSRToolTipOffsetX=7,C_TSRToolTipOffsetY=-3,C_TSRToolTipOverlapX=0,C_TSRToolTipOverlapY=40,C_TSRTotalToolTipWidthArea=g_oImgDefine.ImgSize.PopupBodySize.width+g_oImgDefine.ImgSize.Tail.width-C_TSRToolTipOverlapX,C_TSRTotalToolTipHeightArea=g_oImgDefine.ImgSize.PopupBodySize.height+g_oImgDefine.ImgSize.Tail.height-C_TSRToolTipOverlapY,tooltiptopArea=0,g_oEnv={Browser:{isFF:!1,oBHOActiveX:null},Parser:{iResultNumber:0,iRatingNumber:0,rgobjSearchResult:[],rgobjSearchResultForAnalysis:[],iParserFlowID:1},Tooltip:{isToolTipMove:!1,iTSRTimerID:null,posTooltip:{posX:0,posY:0}},UMSTooltip:{iUMSHideTimerID:null,iUMSShowTimerID:null},BaseResourceUrl:""};exports.g_oEnv=g_oEnv;var g_currentBrowser="",g_bisMouseOverShowToolTip=!1,g_bisHighLight=!0,g_bisHowTurnOffHighLightLink="",g_iTSRToolTipTimeout=300;exports.g_iUMSToolTipTimeout=1e3;var g_bEnableImageSafeSearch=!1,g_bIsNeedCheckSPan=!0,g_bIsFirefoxLargerThan3_6_x=!0;function TSRIsImageSafeSearchEnabled(){return g_bEnableImageSafeSearch}function TSREnableImageSafeSearch(e){g_bEnableImageSafeSearch=e}exports.g_bIsFirefoxLargerThan3_6_x=g_bIsFirefoxLargerThan3_6_x,exports.TSREnableImageSafeSearch=TSREnableImageSafeSearch,exports.TSRIsImageSafeSearchEnabled=TSRIsImageSafeSearchEnabled;var TMDOMObj=function(e){this.objDom=e,this.style.objDom=e};function TMDOMEvent(e){this.objEvent=e}function TSRHideToolTip(){var e=document.getElementById(D_TSRToolTipID);e&&(e.style.top="-100000px",e.style.left="-100000px")}function TSRClearParseObjs(){var e=g_oEnv.Parser;TSRHideToolTip(),e.iResultNumber=0,e.iRatingNumber=0,e.rgobjSearchResult.length=1}function TSRappendAttribute(e,t){var o={};return o.key=e,o.value=t,this.attributes.push(o),o}function TSRcompareAttributes(e){if(!e)return!1;if(0===this.attributes.length)return!0;for(var t=new TMDOMObj(e),o=0,n=0;n<this.attributes.length;n++){var i=this.attributes[n],r=t.getAttribute(i.key);if(r&&i.value)new RegExp(i.value,"").test(r)&&o++;else{if(r&&"null"!=r||i.value)break;o++}}return o===this.attributes.length}function CreateTSRLocatedObject(e,t,o,n){o&&(this.tagName=o.toUpperCase()),this.tagID=n,this.indexSource=-1,this.attributes=[],this.tagIDregexFirst=!1,this.multiMatches=!t,this.rootElement=e,this.childLocated=t}function TSRFilterInvalidNode(e){if(!e||!e.length)return[];for(var t=[],o=e.length,n=0;n<o;++n){var i=e[n];if("href"in i)try{""!==TSTrim(i.href)&&t.push(i)}catch(e){}else i&&t.push(i)}return t}function CreateTSRSiblingObject(e){this.tagName=e.toUpperCase(),this.attributes=[],this.indexSource=-1,this.nodeElement=null}function CreateTSRResultObject(e,t,o,n,i,r,a,l){if(!e||!t)return null;var s=0==t.indexOf("http://")?"http://":0==t.indexOf("https://")?"https://":null;if(s&&(t=s+encodeURI(t.slice(s.length))),a&&l){var c=TrendMicro.TB.GetImgRatedObject(e,g_oEnv.Parser.iResultNumber);if(c){if(0==l(c))return TMExt_debug("imgRatedNode="+c+" in image rating queue, return"),null;TMExt_debug("Add to re-rating objNode="+e),c.resulted=!1}else TMExt_debug("Do not find ojNode="+e+" , need to rating.")}else if(TrendMicro.TB.InRatingQueue(e,g_oEnv.Parser.iResultNumber)||TrendMicro.TB.isRated(e))return TMExt_debug("objNode="+e+" InRatingQueue or isRated, return"),null;var d={id:++g_oEnv.Parser.iResultNumber,node:e,FindInsertNode:function(){return this.node},AdjustNodeStyle:void 0,imageCallback:void 0};o&&(d.FindInsertNode=o),n&&(d.ShowRatingResultUI=n),i&&(d.AdjustNodeStyle=i),TitaniumFeatureConfig.EnableSafeSearching&&a&&(d.imageCallback=a);var T=new TMDOMObj(d.node);d.text=T.innerText();try{d.link=decodeURI(t)}catch(e){d.link=t}if(encodeURI(d.link).match(/^(https?|ftps?):\/\/([\w%\-]+\.)+[\w%\-]+(\/[\w\- .\/?%&=]*)?/i)){var g=d.FindInsertNode();return(r||!HasImageTag(g)||TitaniumFeatureConfig.EnableSafeSearching&&g_bEnableImageSafeSearch&&a)&&(g_oEnv.Parser.rgobjSearchResult[d.id]=d),d}}function CreateTSRObjectForAnalysis(e,t){if(!e||!t)return null;if(TrendMicro.TB.InAnalysisQueue(t))return null;var o=0===t.indexOf("http://")?"http://":0===t.indexOf("https://")?"https://":null;o&&(t=o+encodeURI(t.slice(o.length)));var n={id:g_oEnv.Parser.rgobjSearchResultForAnalysis.length,node:e};try{n.link=decodeURI(t)}catch(e){n.link=t}return encodeURI(n.link).match(/^(https?|ftps?):\/\/([\w%\-]+\.)+[\w%\-]+(\/[\w\- .\/?%&=]*)?/i)?(g_oEnv.Parser.rgobjSearchResultForAnalysis.push(n),n):void 0}function GetTSRObjectsForAnalysis(){return g_oEnv.Parser.rgobjSearchResultForAnalysis}function HasImageTag(e){var t=!1;if(e&&e.childNodes)for(var o=0;o<e.childNodes.length;++o){var n=e.childNodes[o];if(n&&n.tagName&&"IMG"===n.tagName.toUpperCase()){t=!0;break}if(HasImageTag(n))return!0}return t}function TSTrim(e){return e.replace(/^\s+|\s+$/g,"")}function InsertURLProtocolString(e){var t=TSTrim(e);return D_HTTP_PREFIX+t+"/"}function GetAllTSRLocatedNodes(e){if(!e)return null;for(var t=[],o=0;o<e.length;o++)if(e[o].TSRChild){if(e[o].TSRLocatedSet){var n=GetAllTSRLocatedNodes(e[o].TSRLocatedSet);t=t.concat(n)}}else t.push(e[o]);return TSRFilterInvalidNode(t)}function TSRTagFlowID(){g_oEnv.Parser.rgobjSearchResult.FlowID=++g_oEnv.Parser.iParserFlowID}function TSRGetOffset(e){if("getBoundingClientRect"in document.documentElement){var t=e;if(!t||!t.ownerDocument)return null;var o=null;try{o=t.getBoundingClientRect()}catch(e){return null}var n=t.ownerDocument,i=n.documentElement,r=n.body,a=window,l=i.clientTop||r.clientTop||0,s=i.clientLeft||r.clientLeft||0,c=a.pageYOffset||i.scrollTop||r.scrollTop,d=a.pageXOffset||i.scrollLeft||r.scrollLeft;return{top:o.top+c-l,left:o.left+d-s,elePos:o}}for(var T,g,u=0,p=0,m=e,S=null;m&&(u+=m.offsetLeft,p+=m.offsetTop,document.body!==m&&"HTML"!==m.nodeName);)m.scrollTop&&(u-=m.scrollLeft,p-=m.scrollTop),S=m.nodeName,m=m.offsetParent;return T=document.documentElement.scrollTop>0?document.documentElement.scrollTop:document.body.scrollTop,g=document.documentElement.scrollLeft>0?document.documentElement.scrollLeft:document.body.scrollLeft,"TD"!==S&&"TH"!==S||(u+=g,p+=T),{top:p,left:u}}function resetPosForYahooMail(){let e=0,t=0,o=0,n=!1;const i=document.querySelector('[data-cy="htmlMail"]'),r=document.querySelector(".mainColumn");return i&&r?(o=i.closest("article").scrollTop,e=i.offsetLeft,t=i.offsetTop+r.offsetTop):(t=i.offsetTop,e=i.offsetLeft,n=!0),{left:e,top:t,scrollTop:o,isNewWindow:n}}function TSRCalculateOffset(e){var t,o,n={PosX:0,BodyX:0,TailX:0,PosY:0,BodyY:0,TailY:0,TailBG:null};if(!e)return n;var i,r,a,l,s={left:0,top:0,scrollTop:0},c=TSRGetOffset(e);if(t=c.left,o=c.top,"mail.yahoo.co.jp"===window.location.host&&document.querySelector('[data-cy="htmlMail"]')&&(s=resetPosForYahooMail()),i=document.documentElement.scrollTop>0?document.documentElement.scrollTop:document.body.scrollTop,r=document.documentElement.scrollLeft>0?document.documentElement.scrollLeft:document.body.scrollLeft,n.PosX=t+C_TSRToolTipOffsetX+s.left,n.BodyX=g_oImgDefine.ImgSize.Tail.width,n.TailX=0,a="Right",n.PosX+C_TSRTotalToolTipWidthArea>=document.body.clientWidth){var d=t+C_TSRToolTipOffsetX-C_TSRTotalToolTipWidthArea;d>r&&(n.PosX=d,n.BodyX=0,n.TailX=g_oImgDefine.ImgSize.PopupBodySize.width,a="Left")}return n.PosY=o-C_TSRTotalToolTipHeightArea-C_TSRToolTipOffsetY+s.top-s.scrollTop,n.BodyY=0,n.TailY=C_TSRTotalToolTipHeightArea-g_oImgDefine.ImgSize.Tail.height,l="Top",n.PosY<i&&(n.PosY=o+e.offsetHeight+C_TSRToolTipOffsetY-s.scrollTop,n.BodyY=g_oImgDefine.ImgSize.Tail.height-C_TSRToolTipOverlapY,n.TailY=0,l="Bottom"),s.isNewWindow&&(n.PosX=n.PosX-r,n.PosY=n.PosY-i,s.top+n.PosY-i<C_TSRTotalToolTipHeightArea&&(n.PosY=s.top+c.elePos.y-4,n.TailY=16,l="Bottom")),n.TailBG=l+a,n}function TSREscapeURL(e){return g_oEnv.BaseResourceUrl+encodeURIComponent(e)}function TSRConstructUntestURLWindow(e){var t=TSRTruncateText(e,!1),o=g_oRatingLevelToolTipString.SiteSafetyReportString;return'<div id="ID_TSRUntestURLWindow_Wrapper" class="TSRUntestURLWindow_Wrapper"><div id="ID_TSRUntestURLWindow_Wrapper_closeButton" class="closeButton"></div><div class="photo" style="float:left; padding-top:35px; padding-left:20px; padding-right:10px;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAACUElEQVR42s2YvU4CQRSFJ2AC0kNiyd9T2EJitUSxwScQHwBLO4FaNDFEK+QNgBcQY4xKh0Q7aiwttGC9Nzkmw7Ass784yUlwvHPmy+7cnTsjhMO2091Lk45JHdILaUb6hmbo6yAmLYJoZBwlVUhD0pxkkqakPqlFakAt9E0RM8cYHhv1C6ZAesMEY9IpKacxLofYMcayR8ELSJx0DbMP0gEp4sInQtonvcOLPeNOTZKkJzzypmMDa88YvObwTjqBmZC+SKUA1mMJ3pO1UBSQID1iwK4IqLE35uC5EnaBbTzSkgi44UnxXG27bOJF1xQhNawpcyn7kAljZEI8RKA45nxb+E7hw8WkhyLkxnNi7orceY8nFAkB4Ixl8XaG8t7Ei6sWEowJyVA1MGT4jyoC8iHCsAakLfwvj76qwM483QBMTInhDbnDP0ak3iZhENcjvQrUMFebhEEsly6fAoVVfZMwiD9nFlsgNUWDglGB+JVd6qZoEDDqK1ta1JyOMDKdQLmFkRb1iH/cWaU9CiptKC8watr/fRhzbqF8gMnKH8aM3daxDsorzNLWobO5AqqvQvkEs7i5KuVHeU2RrkJ5goFv2ar8iKJIsi3QbKDcwsQsCzSlhG1omAy8wsCrAY/iqoBbLC5DA6rvEcbAXDe+HIMA5RZG7xhkcVA0Ath0De2DojQoRXqWjtIxH0DkozR7p5wabP+bywbFsIjHK1/HZDW3A/k6ZrIymzxcWD2suLCqQxfKhZWJMUe+XVituNI7IXW5BkY99QPN0NdFjOMrvV9P+Le8x/en9wAAAABJRU5ErkJggg=="></div><div class="titleArea">'+o.ReceivedReviewTitle+'</div><div class="descriptionArea">'+o.Description+'</div><div class="addressArea" style="visibility:hidden;"><span class="title">'+o.Address+'</span><span id="ID_TSRUntestURLWindow_Wrapper_webURL" class="webURL">'+t+'</span></div><div class="textAreaBelowSeperator"></div><div class="footArea"><div id="ID_TSRUntestURLWindow_Wrapper_logo" class="logo" style="visibility:hidden;"></div><button id="ID_TSRUntestURLWindow_Wrapper_send" class="TSRUntestURLWindow_Wrapper_btn_red send">'+o.OKButton+"</button></div></div>"}function removeUntestURLOverlay(){var e=document.getElementById("ID_TSRUntestURLWindow");document.body.removeChild(e)}function TISProShowReport(e){if(!1 in g_oRatingLevelToolTipString)return null;g_oRatingLevelToolTipString.SiteSafetyReportString;var t=e.link,o=document.createElement("DIV");if(o.id="ID_TSRUntestURLWindow",o.className="TSRUntestURLWindow",o.style.backgroundImage="url("+TSREscapeURL("overlay_background.png")+")",TSRConstructUntestURLWindow(t)){o.innerHTML=TSRConstructUntestURLWindow(t),document.body.appendChild(o);var n=document.getElementById("ID_TSRUntestURLWindow_Wrapper_closeButton"),i=document.getElementById("ID_TSRUntestURLWindow_Wrapper_logo"),r=document.getElementById("ID_TSRUntestURLWindow_Wrapper_send");document.getElementById("ID_TSRUntestURLWindow_Wrapper_webURL").title=t,n.style.backgroundImage="url("+TSREscapeURL("icon_close.png")+")",n.onmouseover=function(){this.style.backgroundPosition="0px 120px"},n.onmouseout=function(){this.style.backgroundPosition="0px 0px"},n.onmousedown=function(){this.style.backgroundPosition="0px 80px"},n.onclick=function(){removeUntestURLOverlay()},i.style.backgroundImage="url("+TSREscapeURL("ic_tmlogo_web.png")+")",i.style.position="static",i.style.lineHeight="19.5px",i.style.fontSize="13px",i.style.padding="0px",i.style.margin="0px",a(r,"#e6e6e6","#fafafa"),r.onmouseover=function(){a(r,"#e6e6e6","#fafafa")},r.onmouseout=function(){a(r,"#e6e6e6","#fafafa")},r.onmousedown=function(){a(r,"#e6e6e6","#fafafa")},r.onclick=function(){removeUntestURLOverlay()}}else TMExt_debug.log("missing L10n files");function a(e,t,o){try{e.style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr='"+t+"', endColorstr='"+o+"')"}catch(e){}try{e.style["-ms-filter"]="progid:DXImageTransform.Microsoft.gradient(startColorstr='"+t+"', endColorstr='"+o+"')"}catch(e){}try{e.style.background="linear-gradient("+t+", "+o+")"}catch(e){}try{e.style.background="-webkit-gradient(linear, 0 0, 0 100%, from("+t+"), to("+o+"))"}catch(e){}try{e.style.background="-moz-linear-gradient(top,  "+t+",  "+o+")"}catch(e){}}}function Feedback2SiteSafety(e){window.browser.runtime.sendMessage({action:TB_ACTIONS.FEEDBACK_UNTESTED_URL,params:e})}function replaceProductName(e){return(e=e.toString()).replace(/__productName__/g,D_TSRToolTipTitleString)}function TSRChangeTooltip(e,t){if(!e||void 0===e.level)return;var o=document.getElementById(D_TSRToolTipTailID),n=document.getElementById(D_TSRToolTipBodyID),i=document.getElementById(D_TSRToolTipIconID),r=document.getElementById(D_TSRToolTipRLStringID),a=document.getElementById(D_TSRToolTipSiteUrlID),l=document.getElementById(D_TSRToolTipCheckUrlID);if(!(o&&n&&i&&r))return;n.style.left=t.BodyX+D_PIXEL_UNIT,n.style.top=t.BodyY+D_PIXEL_UNIT;var s="url("+TSREscapeURL(g_oRatingLevel[e.level].Tail[t.TailBG])+")";o.style.backgroundImage=s,o.style.left=t.TailX+D_PIXEL_UNIT,o.style.top=t.TailY+D_PIXEL_UNIT,o.style.visibility="visible",i.src=TSREscapeURL(g_oRatingLevel[e.level].Content.Icon),r.innerHTML=g_oRatingLevel[e.level].Content.LevelString,r.style.color=g_oRatingLevel[e.level].Content.TextColor,a.style.color=g_oRatingLevel[e.level].Content.SiteUrlColor,D_TSRToolTipBGIkbLinkID.innerHTML=g_oRatingLevel[e.level].Content.LevelString;const c=!!document.getElementById("ums_img_tooltip");document.getElementById(D_TSRToolTipBGIkbLinkID).style.visibility=c?"hidden":"initial",l&&(l.onclick=function(){if(TitaniumFeatureConfig.EnableUntestedFeedbackFeature){TSRHideToolTip();var t=e.link;void 0!==Feedback2SiteSafety&&(Feedback2SiteSafety({url:t,site_owner:"0",email:"",description:"",score:"71"}),window.browser.runtime.sendMessage({action:TB_ACTIONS.SEND_UNTEST_URL_UBM,type:"ask_trendmicro"})),TISProShowReport(e)}else window.open("http://sitesafety.trendmicro.com")});var d=document.getElementById(D_TSRToolTipRLDetailedID),T=document.getElementById(D_TSRToolTipRLDetailedShareID),g=document.getElementById(D_TSRToolTipSiteNameID),u=document.getElementById(D_TSRToolTipSiteUrlID);if(d&&T&&g&&u){var p=e.text,m=e.link;g.innerHTML=htmlEncode(TSRTruncateText(p,!0)),g.title=p,u.innerHTML=htmlEncode(TSRTruncateText(m,!1)),u.title=m,d.innerHTML=replaceProductName(g_oRatingLevel[e.level].Content.HelpString),5!==e.level?T.style.display="none":T.style.display="block",0==t.BodyY&&(tooltiptopArea=t.BodyY+(g_oImgDefine.ImgSize.PopupBodySize.height-n.offsetHeight)+D_PIXEL_UNIT,n.style.top=t.BodyY+(g_oImgDefine.ImgSize.PopupBodySize.height-n.offsetHeight)+D_PIXEL_UNIT),window.browser.runtime.sendMessage({action:"send_untested_url_ubm",type:"show_tooltip",levelNumber:e.level})}}function TSRClearToolTipTimer(){g_oEnv.Tooltip.iTSRTimerID&&(clearTimeout(g_oEnv.Tooltip.iTSRTimerID),g_oEnv.Tooltip.iTSRTimerID=null)}function TSRSetToolTipTimer(){TSRClearToolTipTimer(),g_oEnv.Tooltip.iTSRTimerID=setTimeout(TSRHideToolTip,g_iTSRToolTipTimeout)}function TSRConstructToolTipWindow(){var e=g_bisHowTurnOffHighLightLink?g_oRatingLevelToolTipString.ToogleBgIkbString:"";return'<div id="'+D_TSRToolTipTailID+'" ></div><div id="'+D_TSRToolTipBodyID+'" ><div id="TSRToolTipBodyContent" ><img id="'+D_TSRToolTipIconID+'" ><span id="'+D_TSRToolTipRLStringID+'" ></span><br style="clear:both;"/><p id="'+D_TSRToolTipSiteNameID+'" ></p><p id="'+D_TSRToolTipSiteUrlID+'" ></p><p id="'+D_TSRToolTipRLDetailedID+'" ></p><p id="'+D_TSRToolTipRLDetailedShareID+'" style="display:none;">'+g_oRatingLevelToolTipString.CheckUrlString+'</p><a href="#" id="'+D_TSRToolTipBGIkbLinkID+'" >'+e+'</a></div><div id="'+D_TSRToolTipCloseSpanID+'" ><div style="background-image:url('+TSREscapeURL(g_oImgDefine.CloseIcon)+')" id="'+D_TSRToolTipCloseID+'" ></div></div><div id="'+D_TSRToolTipTitleID+'"><img src="'+TSREscapeURL(g_oImgDefine.LogoIcon)+'" class="TSRLogoIcon"><span class="TSRProductTitle">'+D_TSRToolTipTitleString+"</span></div></div>"}function TSRInitToolTip(e,t,o,n,i,r,a){g_oEnv.BaseResourceUrl=e,g_bisMouseOverShowToolTip=t,g_bisHighLight=o,g_currentBrowser=a,g_bisHowTurnOffHighLightLink=r,g_iTSRToolTipTimeout=n,void 0!==i&&(exports.g_iUMSToolTipTimeout=i)}function TSRCreateTooltip(){var e=document.getElementById(D_TSRToolTipID);if(e)return e;e=document.createElement("DIV");var t=C_TSRTotalToolTipWidthArea,o=C_TSRTotalToolTipHeightArea;e.id=D_TSRToolTipID,e.className=D_TSRToolTipShowClass,e.style.width=t,e.style.height=o,e.innerHTML=TSRConstructToolTipWindow(),document.body.insertBefore(e,null);var n=document.getElementById(D_TSRToolTipTailID),i=document.getElementById(D_TSRToolTipBodyID);return n.onmouseout=TSRSetToolTipTimer,n.onmousemove=TSRClearToolTipTimer,n.onmouseover=TSRClearToolTipTimer,i.onmouseout=TSRSetToolTipTimer,i.onmousemove=TSRClearToolTipTimer,i.onmouseover=TSRClearToolTipTimer,document.getElementById(D_TSRToolTipCloseID).onclick=TSRHideToolTip,document.getElementById(D_TSRToolTipBGIkbLinkID).onclick=function(){let e=new URL(document.location.href);window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_HOW_TURN_OFF_HIGHLIGHT_LINK,value:JSON.stringify({Browser:g_currentBrowser,host:e.hostname})}}),g_bisHowTurnOffHighLightLink&&window.open(g_bisHowTurnOffHighLightLink)},e}function TSRShowToolTip(e){var t=new TMDOMEvent(e=e||window.event);if("click"===e.type||g_bisMouseOverShowToolTip){var o=TSRCreateTooltip(),n=t.target(),i=n.TSRResult||n.parentNode.TSRResult||n.wrappedJSObject.TSRResult;TSRClearToolTipTimer();var r=TSRCalculateOffset(n);if(TSRChangeTooltip(i,r),0===r.BodyY){var a=document.getElementById(D_TSRToolTipBodyID);tooltiptopArea=r.BodyY+(g_oImgDefine.ImgSize.PopupBodySize.height-a.offsetHeight),a.style.top=r.BodyY+(g_oImgDefine.ImgSize.PopupBodySize.height-a.offsetHeight)+D_PIXEL_UNIT;var l=TSRCalculateOffset(n);r.PosY=l.PosY}o.style.left=r.PosX+D_PIXEL_UNIT,o.style.top=r.PosY+D_PIXEL_UNIT,o.className=D_TSRToolTipShowClass;let e=i.entry;g_categoryUbmNameTable&&g_categoryUbmNameTable.hasOwnProperty(e)&&(e=g_categoryUbmNameTable[e]);let s=new URL(document.location.href);window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_URLS_MOUSEOVER_TOOLTIP,value:JSON.stringify({rating:i.level,entry:e,host:s.hostname})}})}return e.cancelBubble=!0,!1}function getYahooJPSchemeMode(){return new Promise(e=>{const t=setInterval(()=>{document.querySelector('[data-cy="switchMailTab"]')&&(window.clearInterval(t),document.querySelector('[data-cy="switchMailTab"]')&&("rgb(22, 19, 19)"===window.getComputedStyle(document.querySelector('[data-cy="switchMailTab"]'),null).getPropertyValue("background-color")||"rgb(48, 46, 46)"===window.getComputedStyle(document.querySelector('[data-cy="switchMailTab"]'),null).getPropertyValue("background-color"))||"rgb(22, 19, 19)"===window.getComputedStyle(document.querySelector('span[role="search"]'),null).getPropertyValue("background-color")?e("dark"):e("normal"))},1e3)})}async function schemeMode(){var e={entry:window.location.host,mode:"normal"};const t="ID_detectionDarkThemeWindow";if(!TMExt_$(`#${t}`).length){var o=`<div id="${t}" style="display: none; background-color: canvas; color-scheme: light"></div>`;TMExt_$("body").append(o)}const n=document.querySelector(`#${t}`);if("rgb(255, 255, 255)"!=window.getComputedStyle(n).backgroundColor&&(e.mode="dark"),"mail.yahoo.co.jp"===window.location.host){const t=await getYahooJPSchemeMode();return e.mode=t,e}return window.location.host.includes("facebook")?document.querySelector('html[id="facebook"]').classList.contains("__fb-dark-mode")&&(e.mode="dark"):window.location.host.includes("x.com")?"#FFFFFF"!==document.querySelector('meta[name="theme-color"]').content&&(e.mode="dark"):window.location.host.includes("linkedin")?document.querySelector("html").classList.contains("theme--dark")&&(e.mode="dark"):(window.location.host.startsWith("www.google.com")&&"/search"===window.location.pathname&&"rgb(255, 255, 255)"!==window.getComputedStyle(document.body,null).getPropertyValue("background-color")||navigator.userAgent.indexOf("Firefox")>=0&&"www.google.com"===window.location.host&&"/search"===window.location.pathname&&"rgb(255, 255, 255)"!==window.getComputedStyle(document.body,null).getPropertyValue("background-color")||"outlook.live.com"===window.location.host&&document.querySelector("html").getAttribute("style").includes("--black:#ffffff")||"www.baidu.com"===window.location.host&&document.querySelector("body").getAttribute("class")&&document.querySelector("body").getAttribute("class").includes("darkmode")||"www.bing.com"===window.location.host&&document.querySelector("body").getAttribute("class")&&document.querySelector("body").getAttribute("class").includes("b_dark")||document.querySelector('meta[name="color-scheme"]')&&"dark"===document.querySelector('meta[name="color-scheme"]').content)&&(e.mode="dark"),e}function productNameLogic(e){let t=e.ja,o="";for(const[t,n]of Object.entries(e))n&&(o=o+" "+t);return t?`<div>\n            <div class="tball"></div>\n            <div class=" ${o}"></div>\n        </div>`:`<div class=" ${o}"></div>`}function ratingSettingCon(e){return`\n        <div id="wtp_notification_mask" class="show"></div>\n        <div id="wtp_notification-wrapper">\n            <div class="wtp_notification_header">\n                <button type="button" class="notification-close"></button>\n                <h1 class="product-name pull-left">\n                    ${e}\n                </h1>\n            </div>\n            <div class="wtp_notification_content" id="setting_content">\n                <div>\n                    <h2>${g_oRatingSetPopupString.Title}</h2>\n                    <p>${g_oRatingSetPopupString.Desc}</p>\n                    <div class="trend-form-radio">\n                        <div class="form-radio">\n                            <input type="radio" id="heighLight" name="isHighLight" value="1" checked>\n                            <label for="html"><span>${g_oRatingSetPopupString.RadioHightlignt}</span></label>\n                        </div>\n                        <div class="form-radio">\n                            <input type="radio" id="notHightlight" name="isHighLight" value="0">\n                            <label for="css"><span>${g_oRatingSetPopupString.RadioNotHightlight}</span></label>\n                        </div>\n                    </div>\n                    <div id="mode_view" class="bg">\n                        <div class="safe_block">\n                            <i class="ic_safe"></i>\n                            <p><span>${g_oRatingSetPopupString.Safe}</span></p>\n                            <div class="grayblock"></div>\n                        </div>\n                        <div class="dangerous_block">\n                            <i class="ic_dangerous"></i>\n                            <p><span>${g_oRatingSetPopupString.Dangerous}</span></p>\n                            <div class="grayblock"></div>\n                        </div>\n                    </div>\n                    <a href="#" id="${D_TSRExplainHowToolbarWorksIkbLinkID}">${g_oRatingSetPopupString.HowDoWorkLink}</a>\n                </div>\n                <div class="wtp_notification_footer">\n                    <button type="button" class="red_action notification_apply">${g_oRatingSetPopupString.ApplyButton}</button>\n                    <a href="#" id="notification_remindlater">${g_oRatingSetPopupString.RemindLater}</a>\n                </div>\n            </div>\n            <div class="wtp_notification_content" id="applied_content" style="display:none">\n                <i class="applied_icon"></i>\n                <h2>${g_oRatingSetPopupString.AppliedTitle}</h2>\n                <p><span>${g_oRatingSetPopupString.ChangeSettingDesc}</span></p>\n            </div>\n        </div> `}async function ratingSettingPopup(e,t,o,n,i,r){if(g_bisHighLight=t,g_currentBrowser=o,document.getElementById("ID_ratingSettingWindow"))return;var a=document.createElement("DIV");a.id="ID_ratingSettingWindow",a.className="ratingSettingWindow",document.body.appendChild(a);var l=ratingSettingCon(e);TMExt_$("#ID_ratingSettingWindow").append(l);var s=document.getElementById("wtp_notification-wrapper"),c=await schemeMode();"dark"===c.mode?(TMExt_$("#wtp_notification-wrapper #setting_content h2").text(g_oRatingSetPopupString.DarkTitle),TMExt_$("#mode_view").addClass("dark")):TMExt_$("#mode_view").removeClass("dark"),TMExt_$("input[type=radio][name=isHighLight]").change(function(){"1"==this.value?TMExt_$("#mode_view").addClass("bg"):"0"==this.value&&TMExt_$("#mode_view").removeClass("bg")}),TMExt_$(`input[type=radio][name=isHighLight][value=${1*g_bisHighLight}]`).click(),s.classList.add("show");let d=new URL(document.location.href);window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_SETTING_POPUP_SHOW,value:JSON.stringify({Browser:g_currentBrowser,host:d.hostname,mode:c.mode,initialSetting:!!g_bisHighLight})}}),TMExt_$("#ID_ratingSettingWindow .notification-close").bind("click",function(){let e;s.classList.remove("show"),TMExt_$("#wtp_notification_mask").removeClass("show"),TMExt_$(this).hasClass("applyed")?e=UBM_ID.RATING_SETTING_POPUP_CLOSE_BUTTON_CLICK:(r(!0,!1),e=UBM_ID.RATING_SETTING_POPUP_APPLIED_CLOSE_BUTTON_CLICK),window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:e,value:JSON.stringify({Browser:g_currentBrowser,host:d.hostname})}})}),TMExt_$("#ID_ratingSettingWindow #notification_remindlater").bind("click",function(){s.classList.remove("show"),TMExt_$("#wtp_notification_mask").removeClass("show"),r(!0,!1),window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_SETTING_POPUP_REMIND_LATER_LINK,value:JSON.stringify({Browser:g_currentBrowser,host:d.hostname})}})}),TMExt_$(`#${D_TSRExplainHowToolbarWorksIkbLinkID}`).bind("click",function(){window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_SETTING_POPUP_EXPLAIN_HOW_TOOLBAR_WORKS_LINK,value:JSON.stringify({Browser:g_currentBrowser,host:d.hostname})}}),n&&window.open(n)}),TMExt_$("#ID_ratingSettingWindow #how_update_pagerating_link").bind("click",function(){s.classList.remove("show"),window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_SETTING_POPUP_SETTING_LINK,value:JSON.stringify({Browser:g_currentBrowser,host:d.hostname,initialSetting:TMExt_$("#ID_ratingSettingWindow #applied_content").attr("initialSetting"),finalSetting:TMExt_$("#ID_ratingSettingWindow #applied_content").attr("finalSetting"),mode:c.mode})}}),s.classList.remove("show"),window.browser.runtime.sendMessage({action:TB_ACTIONS.RATINGCREATETABS,url:"js/common/index.html#entry=settings"})}),TMExt_$("#ID_ratingSettingWindow .notification_apply").bind("click",function(){var e=TMExt_$("input[type=radio][name=isHighLight]:checked").val();i(parseInt(e)),TMExt_$("#ID_ratingSettingWindow #setting_content").css("display","none"),TMExt_$("#ID_ratingSettingWindow #applied_content").css("display","block"),TMExt_$("#ID_ratingSettingWindow #applied_content").attr("initialSetting",!!g_bisHighLight),TMExt_$("#ID_ratingSettingWindow #applied_content").attr("finalSetting",!!parseInt(e)),TMExt_$("#wtp_notification_mask").removeClass("show"),TMExt_$("#ID_ratingSettingWindow .notification-close").addClass("applyed"),r(!0,!0),window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_SETTING_POPUP_APPLY_BUTTON_CLICK,value:JSON.stringify({Browser:g_currentBrowser,host:d.hostname,initialSetting:!!g_bisHighLight,finalSetting:!!parseInt(e),mode:c.mode})}})})}function ForSRBingUI(e){if(window.location.host.startsWith("www.bin")&&"/search"===window.location.pathname){let t="SPAN"===e.node.firstChild.nodeName,o=e.node.nextElementSibling,n=e.node.previousElementSibling;if(t&&n){let t=window.getComputedStyle(e.node,null).getPropertyValue("background-color");"-22px"===window.getComputedStyle(e.node.firstChild,null).getPropertyValue("margin-left")&&(n.style.position="absolute",e.node.style.paddingRight="22px",e.node.style.backgroundColor="",o.style.backgroundColor=t)}}}async function TSRHightlightById(e,t){var o=g_oEnv.Parser.rgobjSearchResult[e];if(o){var n=await schemeMode(),i="www.baidu.com"===n.entry,r=D_TSRHIGHLIGHT_COLOR_OFF;t&&g_oRatingLevel[o.level]&&(r="dark"===n.mode?i?`rgb(${g_oRatingLevel[o.level].DarkBaiduHeightlight}, 1)`:`rgb(${g_oRatingLevel[o.level].DarkHeighlight}, 1)`:`rgb(${g_oRatingLevel[o.level].Highlight}, 1)`);var a=o.FindInsertNode(),l=!0;if(a&&a.childNodes)for(var s=0;s<a.childNodes.length;++s){var c=a.childNodes[s];if(c&&c.tagName&&"DIV"===c.tagName.toUpperCase()){l=!1;break}}!a.NotHighLight&&l&&a&&a.style&&(a.style.backgroundColor=r),ForSRBingUI(o)}}function TSRHighlight(e){g_bisHighLight=e;for(var t=1;t<g_oEnv.Parser.rgobjSearchResult.length;t++)TSRHightlightById(t,e)}function TSRMouseOverShowTips(e){g_bisMouseOverShowToolTip=e}function TSRInsertResultICON(e,t,o,n){if(!g_oEnv.Parser.rgobjSearchResult[e]||!g_oRatingLevel[t]||TrendMicro.TB.isDocumentEditable())return;var i=g_oEnv.Parser.rgobjSearchResult[e];if(i.resulted)return;if(g_oEnv.Parser.iRatingNumber++,i.resulted=!0,i.level=t,i.phishing=o,i.entry=n,i.imageCallback)return i.imageCallback(i);var r=null;r=i.spanIcon&&"SPAN"===i.spanIcon.nodeName?i.spanIcon:document.createElement("SPAN"),i.spanIcon=r,r.className="TSRSpan",window.location.host.startsWith("search.yahoo")&&(i.node.classList.add("YahooPGTitle"),r.classList.add("YahooPGIcon")),window.location.host.startsWith("www.google")&&"/search"===window.location.pathname&&(i.node.classList.add("GSPGTitle"),r.classList.add("GSPGIcon")),window.location.host.startsWith("www.bing")&&"/search"===window.location.pathname&&i.node.classList.add("BingTitle");const a="noreferrer"===i.node.getAttribute("rel");window.location.host.startsWith("mail.yahoo.com")&&a&&r.classList.add("iconInYahooGlobalMailAD");var l=i.FindInsertNode();let s=!1,c=l.previousElementSibling;if(c){let e=c.id;console.log(e),e.includes("TSRSpan")&&(s=!0,console.log(s))}if(!l||!l.parentNode)return;if(g_bIsNeedCheckSPan&&l.parentNode.childNodes&&l.parentNode.childNodes.length>=2){var d=l.previousSibling;if(d&&"SPAN"===d.tagName&&"TSRSpan"===d.className)return}s||l.parentNode.insertBefore(r,l),r.id=D_TSRSpanIDPrefix+parseInt(e,10),r.onmouseout=TSRSetToolTipTimer,r.onmouseover=TSRShowToolTip,r.onclick=TSRShowToolTip,r.TSRID=parseInt(e,10),r.TSRResult=i;var T=document.createElement("IMG");T.className="TSRWebRatingIcon",T.src=TSREscapeURL(g_oRatingLevel[t].WebIcon),T.style.width=g_oImgDefine.ImgSize.WarningIcon.width+"px",T.style.height=g_oImgDefine.ImgSize.WarningIcon.height+"px",T.style.border="0px";const g=g_oRatingLevel_mapping.filter(e=>e.id===i.level);T.setAttribute("data-status",g[0].key),r.appendChild(T),g_bisHighLight&&TSRHightlightById(e,g_bisHighLight),i.AdjustNodeStyle&&i.AdjustNodeStyle(l),TitaniumFeatureConfig.EnableFacebookAlertYourFriend&&g_bIsFirefoxLargerThan3_6_x&&"undefined"!=typeof TSNSInsertAlertICON&&TSNSInsertAlertICON(i),"undefined"!=typeof TSNSFeedbackUnsafeURL&&TSNSFeedbackUnsafeURL(i)}function getYahooMailConIframe(){return TMExt_$('[data-cy="htmlMail"]')||!1}function UMSCreateTooltip(){var e=TMExt_$('<div id="UMS_TOOLTIP"></div>');if(e.css({position:"absolute",cursor:"pointer","z-index":2147483647,background:"transparent",top:"-100000px",left:"-100000px"}),"mail.yahoo.co.jp"===window.location.host){let t=getYahooMailConIframe();return t&&0===t.contents().find("#UMS_TOOLTIP").length&&e.appendTo(t.contents().find("body")),t.contents().find("#UMS_TOOLTIP")}return 0===TMExt_$("#UMS_TOOLTIP").length&&e.appendTo(TMExt_$("body")),TMExt_$("#UMS_TOOLTIP")}function UMSClearToolHideTipTimer(){g_oEnv.UMSTooltip.iUMSHideTimerID&&(clearTimeout(g_oEnv.UMSTooltip.iUMSHideTimerID),g_oEnv.UMSTooltip.iUMSHideTimerID=null)}function TUMSCalculateOffset(e){var t=TSRGetOffset(e),o=t.left-g_oImgDefine.ImgSize.WarningIcon.width;return o>0&&(t.left=o),t}function UMSShowToolTip(e){var t=UMSCreateTooltip(),o=g_manual_rating.gCurrentEvent;UMSClearToolHideTipTimer();var n=TUMSCalculateOffset(o);t[0].style.left=n.left+D_PIXEL_UNIT,t[0].style.top=n.top+D_PIXEL_UNIT;let i=new URL(document.location.href);return window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:UBM_ID.RATING_URLS_MOUSEOVER_TOOLTIP,value:JSON.stringify({rating:e,entry:"ManualRating",host:i.hostname})}}),!1}function UMSHideToolTip(){var e;if("mail.yahoo.co.jp"===window.location.host){let t=getYahooMailConIframe();t&&(e=t.contents().find("#UMS_TOOLTIP"))}else e=TMExt_$("#UMS_TOOLTIP");0!==e.length&&(e[0].style.left="-100000px",e[0].style.top="-100000px",TMExt_$("#ums_img_tooltip").hide())}function UMSSetToolTipShowTimer(e,t,o){1===e.gMouseLeaveFlag&&e.getCurrentNode()===o&&UMSShowToolTip(t)}function UMSSetToolTipHideTimer(){UMSClearToolHideTipTimer(),g_oEnv.UMSTooltip.iUMSHideTimerID=setTimeout(UMSHideToolTip,500)}function UMSInsertResultICON(e,t,o){if(0!==e.gMouseLeaveFlag&&e.getCurrentNode()===o){var n={id:-1,node:e.getCurrentTarget()[0],FindInsertNode:function(){return this.node},AdjustNodeStyle:void 0};n.level=t;var i=n.node.href;try{n.link=decodeURIComponent(i)}catch(e){n.link=i}var r=new TMDOMObj(n.node);n.text=r.innerText()||i,UMSCreateTooltip();var a,l=TMExt_$("<img id='ums_img_tooltip' class='UMSRatingIcon' src=''/>");if("mail.yahoo.co.jp"===window.location.host){let e=getYahooMailConIframe();0===e.contents().find("#ums_img_tooltip").length&&l.appendTo(e.contents().find("#UMS_TOOLTIP")),a=e.contents().find("#ums_img_tooltip")}else 0===TMExt_$("#ums_img_tooltip").length&&l.appendTo(TMExt_$("#UMS_TOOLTIP")),a=TMExt_$("#ums_img_tooltip");var s=a[0];s.src=TSREscapeURL(g_oRatingLevel[t].WebIcon),s.style.width=g_oImgDefine.ImgSize.WarningIcon.width+"px",s.style.height=g_oImgDefine.ImgSize.WarningIcon.height+"px",s.style.border="0px",s.TSRID=-1,s.TSRResult=n,UMSSetToolTipShowTimer(e,t,o),a.unbind(),a.mouseout(function(t){e.gMouseLeaveFlag=0,TSRSetToolTipTimer(),UMSSetToolTipHideTimer(t)}),a.mouseover(function(t){e.gMouseLeaveFlag=1,TSRShowToolTip(t),UMSClearToolHideTipTimer()}),a.click(function(t){e.gMouseLeaveFlag=1,TSRShowToolTip(t),UMSClearToolHideTipTimer()}),a.show()}else TMExt_debug("Mouse is not in the node")}function TSRChangeResultICON(e,t){if(g_oEnv.Parser.rgobjSearchResult[e]&&g_oRatingLevel[t]){var o=g_oEnv.Parser.rgobjSearchResult[e];if(o.resulted){o.orglevel||(o.orglevel=o.level),o.level=t;var n=document.getElementById(D_TSRSpanIDPrefix+parseInt(e,10));n&&(n.firstChild.src=TSREscapeURL(g_oRatingLevel[t].WebIcon),TSRHightlightById(e,g_bisHighLight))}}}function TSRIsFinishedSRRating(){return g_oEnv.Parser.iRatingNumber===g_oEnv.Parser.iResultNumber}function TSRGetRatingFlowID(){return g_oEnv.Parser.iParserFlowID}function htmlEncode(e){var t=document.createElement("div"),o=document.createTextNode(e);return t.appendChild(o),t.innerHTML}function htmlDecode(e){var t=document.createElement("div");return t.innerHTML=e,t.innerHTML}function TSRTruncateText(e,t){var o=TSRByteLength(e,D_SITE_MSG_TRUNCATE_LIMIT-D_SITE_MSG_TRUNCATE_SUFFIC.length);if(o>0){var n=e.substr(0,o);if(t){var i=TSRFindSeparator(n);i>0&&(n=n.substr(0,i+1))}return n+D_SITE_MSG_TRUNCATE_SUFFIC}return e}function TSRByteLength(e,t){for(var o=0,n=0,i=0,r=0,a=0;a<e.length;a++,o++){var l=e.charCodeAt(a),s=e.charAt(a);if(255<l?0==++n%2&&(o+=3):s>="A"&&s<="Z"&&0==++i%4&&o++,o>t&&r<=0){r=a-1;break}}return 0!=n%2&&o++,r}function TSRFindSeparator(e){var t=0;for(t=e.length-1;t>=0;t--){var o=e.charCodeAt(t),n=e.charAt(t);if(" -.:/|".indexOf(n)>-1||o>255)return t}return t}function TMExt_debug(e){logInfo(e)}TMDOMObj.prototype.innerText=function(){return this.objDom.innerText||this.objDom.textContent||""},TMDOMObj.prototype.getAttribute=function(e){return this.objDom.getAttribute(e)},TMDOMObj.prototype.style={setFloat:function(e){this.objDom.style.cssFloat=e},setMargin:function(e){this.objDom.style.margin=e}},exports.TMDOMObj=TMDOMObj,TMDOMEvent.prototype.target=function(){return this.objEvent.srcElement||this.objEvent.target},TMDOMEvent.prototype.LeftButton=function(){return 0===this.objEvent.button},exports.CreateTSRLocatedObject=CreateTSRLocatedObject,CreateTSRLocatedObject.prototype.findElement=function(e){e&&(this.rootElement=e);var t=this.tagID?this.findElementByID():this.findElementByTagName(),o=t;if(o){t=[];for(var n=0;n<o.length;n++){var i=new TMDOMObj(o[n]).getAttribute("style");new RegExp("display\\s*:\\s*none","i").test(i)||t.push(o[n])}}if(t)for(var r=0;r<t.length;r++)this.childLocated?(t[r].TSRChild=!0,t[r].TSRLocatedSet=this.childLocated.findElement(t[r])):t[r].TSRChild=!1;return t},CreateTSRLocatedObject.prototype.findElementByID=function(){if(!this.tagID)return null;var e=[],t=null;if(this.tagIDregexFirst&&this.tagName){for(var o=this.rootElement.getElementsByTagName(this.tagName),n=new RegExp(this.tagID,""),i=0;i<o.length&&(t=o[i],!n.test(t.id)||(e.push(t),this.multiMatches));i++);return e.length>0?e:null}return(t=this.rootElement.getElementById(this.tagID))?(e.push(t),this.tagName=t.tagName,e):null},CreateTSRLocatedObject.prototype.findElementByTagName=function(){if(!this.tagName)return null;var e=0,t=this.rootElement.getElementsByTagName(this.tagName);if(0===t.length)return null;var o=[];if(this.indexSource>-1&&t[this.indexSource])return o.push(t[this.indexSource]),o;if(0===this.attributes.length){if(this.multiMatches)for(e=0;e<t.length;e++)o.push(t[e]);else o.push(t[0]);return o}for(e=0;e<t.length;e++){var n=t[e];if(this.compareAttributes(n)&&(o.push(n),!this.multiMatches))break}return o.length>0?o:null},CreateTSRLocatedObject.prototype.appendAttribute=TSRappendAttribute,CreateTSRLocatedObject.prototype.compareAttributes=TSRcompareAttributes,CreateTSRSiblingObject.prototype.findSibling=function(e){for(var t=this.indexSource,o=e;o;){if(this.tagName===o.tagName&&this.compareAttributes(o)){if(t<1)return this.nodeElement=o,!0;t--}o=o.nextSibling}return!1},CreateTSRSiblingObject.prototype.appendAttribute=TSRappendAttribute,CreateTSRSiblingObject.prototype.compareAttributes=TSRcompareAttributes,exports.CreateTSRSiblingObject=CreateTSRSiblingObject,exports.CreateTSRResultObject=CreateTSRResultObject,exports.CreateTSRObjectForAnalysis=CreateTSRObjectForAnalysis,exports.GetTSRObjectsForAnalysis=GetTSRObjectsForAnalysis,exports.TSTrim=TSTrim,exports.InsertURLProtocolString=InsertURLProtocolString,exports.GetAllTSRLocatedNodes=GetAllTSRLocatedNodes,exports.TSRTagFlowID=TSRTagFlowID,exports.TSREscapeURL=TSREscapeURL,exports.TSRInitToolTip=TSRInitToolTip,exports.schemeMode=schemeMode,exports.productNameLogic=productNameLogic,exports.ratingSettingPopup=ratingSettingPopup,exports.TSRHightlightById=TSRHightlightById,exports.TSRInsertResultICON=TSRInsertResultICON,exports.UMSCreateTooltip=UMSCreateTooltip,exports.UMSCreateTooltip=UMSCreateTooltip,exports.UMSSetToolTipHideTimer=UMSSetToolTipHideTimer,exports.UMSInsertResultICON=UMSInsertResultICON,exports.TSRGetRatingFlowID=TSRGetRatingFlowID,exports.TMExt_debug=TMExt_debug;var TrendMicro={},ID_IMAGE_BLOCK_POPUP,constructImageBlockPopup,isNeedToBlock,ImageBlockImgDefine_defaultImg,ImageBlockImgDefine_imgList,setBlockImage,_refreshBlockImages;TrendMicro.TB={},TrendMicro.TB={},TrendMicro.TB.console={},TrendMicro.TB.console.info=function(e){},TrendMicro.TB.extend=function(e,t){for(var o in t)e[o]=t[o]},TrendMicro.TB.$=function(e){return document.getElementById(e)},TrendMicro.TB.Each=function(e,t){for(var o=0,n=0;n=e[o];o++)t(n)},TrendMicro.TB.reduce=function(e,t){for(var o=[],n=0;n<e.length;n++){var i=e[n];i&&t(i)&&o.push(i)}return o},TrendMicro.TB.TrimSpace=function(e){return e.replace(/^\s*|\s*$/g,"")},TrendMicro.TB.FindChar=function(e,t){for(var o=0;e.charAt(o)&&-1===t.indexOf(e.charAt(o));)++o;return e.charAt(o)?{c:e.charAt(o),i:o}:{c:null,i:-1}},TrendMicro.TB.NodeListToArray=function(e){for(var t=[],o=0;o<e.length&&e[o];o++)t.push(e[o]);return t},TrendMicro.TB.hasClass=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},TrendMicro.TB.$S=function(selector){for(var selectorF=function(key,parent){var results=[];if("#"===key.substr(0,1)){var elem=TrendMicro.TB.$(key.substr(1));results.push(elem)}else{"."===key.substr(0,1)&&(key="*"+key);var index=TrendMicro.TB.FindChar(key,"[");if(TrendMicro.TB.console.info("key="+key+"i="+index.i+",c="+index.c),-1===index.i)TrendMicro.TB.console.info("tag="+key+",parent="+parent.innerHTML),results=TrendMicro.TB.NodeListToArray(parent.getElementsByTagName(key));else if("["===index.c){var tag=key.substr(0,index.i);TrendMicro.TB.console.info("tag="+tag+",parent="+parent+",parent.getElementsByTagName(tag),"+parent.getElementsByTagName(tag).length),results=TrendMicro.TB.NodeListToArray(parent.getElementsByTagName(tag));var rightBracket=key.indexOf("]");if(-1===rightBracket)throw"can not find right bracket";var sExtendRule=key.substring(index.i+1,rightBracket);TrendMicro.TB.console.info("sExtendRule="+sExtendRule);var sKV=sExtendRule.split("="),name=sKV[0],value=sKV[1];TrendMicro.TB.console.info("name="+name+",value="+value),name&&value&&("hasClass"===name?(TrendMicro.TB.console.info("results of get tag="+results.length),results=TrendMicro.TB.reduce(results,function(e){return TrendMicro.TB.hasClass(e,value)})):"custom"===name&&(results=TrendMicro.TB.reduce(results,function(node){return eval(value+"(node)")})))}}return results},keys=selector.split(" "),results=[],i=0;i<keys.length&&keys[i];i++){var parents=results.length?results:[document];results=[];for(var k=TrendMicro.TB.TrimSpace(keys[i]),j=0;j<parents.length&&parents[j];j++)results=results.concat(selectorF(k,parents[j]));if(!results.length)break}return results},TrendMicro.TB.isRated=function(e){var t=!1;if(e&&e.parentNode&&e.parentNode.childNodes&&e.parentNode.childNodes.length>=2){var o=e.previousSibling;o&&"SPAN"===o.tagName&&"TSRSpan"===o.className&&(t=!0)}return TrendMicro.TB.console.info("node="+e+"_isRated="+t),t},TrendMicro.TB.InRatingQueue=function(e,t){for(var o=g_oEnv.Parser.rgobjSearchResult,n=t-1;n>=1;n--)if(o[n]&&o[n].node===e)return!0;return!1},TrendMicro.TB.InImageRatingQueue=function(e,t){for(var o=g_oEnv.Parser.rgobjSearchResult,n=t-1;n>=1;n--)if(o[n]&&o[n].node===e&&1==o[n].resulted)return!0;return!1},TrendMicro.TB.InAnalysisQueue=function(e){for(var t=g_oEnv.Parser.rgobjSearchResultForAnalysis,o=0;o<t.length;o++)if(t[o]&&t[o].link===e)return!0;return!1},TrendMicro.TB.GetImgRatedObject=function(e,t){for(var o=g_oEnv.Parser.rgobjSearchResult,n=t-1;n>=1;n--)if(o[n]&&o[n].node===e&&1==o[n].resulted)return o[n];return null},TrendMicro.TB.ReduceNewNode=function(e){for(var t=g_oEnv.Parser.rgobjSearchResult,o=g_oEnv.Parser.rgobjSearchResult.length,n=o-1;n>=e;n--){var i=t[n]?t[n].node:void 0;(i&&TrendMicro.TB.isRated(i)||TrendMicro.TB.InRatingQueue(i,e))&&delete t[n]}for(var r=o-1;r>=e&&null==t[r];r--);t.length=r+1,g_oEnv.Parser.iResultNumber=t.length<=0?0:t.length-1},TrendMicro.TB.ReduceImageNewNode=function(e){for(var t=g_oEnv.Parser.rgobjSearchResult,o=g_oEnv.Parser.rgobjSearchResult.length,n=o-1;n>=e;n--){var i=t[n]?t[n].node:void 0;i&&TrendMicro.TB.InImageRatingQueue(i,e)&&delete t[n]}for(var r=o-1;r>=e&&null==t[r];r--);t.length=r+1,g_oEnv.Parser.iResultNumber=t.length<=0?0:t.length-1},TrendMicro.TB.FindTargetLinks=function(e,t,o){var n={isRated:TrendMicro.TB.isRated,blacklist:[]};o&&TrendMicro.TB.extend(n,o);var i=TrendMicro.TB.$S(t);if(n.blacklist.length){for(var r=[],a=n.blacklist.length-1;a>=0;--a)r.push(new RegExp(n.blacklist[a],"i"));i=TrendMicro.TB.reduce(i,function(e){try{var t=e&&e.href;if(t)for(var n=o.blacklist.length-1;n>=0;--n)if(r[n].test(t))return!1}catch(e){return!1}return!0})}return i=TrendMicro.TB.reduce(i,function(e){if(n.isRated(e))return!1;for(var t=g_oEnv.Parser.rgobjSearchResult,o=1,i=0;i=t[o];++o)if(i&&i.node===e)return!1;return!0}),TrendMicro.TB.console.info("elems="+i.length),i},TrendMicro.TB.ClearResultedNode=function(){!function(e){for(var t=1,o=0;o=e[t];++t)o.resulted&&delete e[t]}(g_oEnv.Parser.rgobjSearchResult),function(){for(var e=g_oEnv.Parser.rgobjSearchResult,t=e.length-1;t>=0&&void 0===e[t];t--)e.length--;g_oEnv.Parser.iResultNumber=e.length<=0?0:e.length-1}()},TrendMicro.TB.PagePattern=function(e,t,o){var n={isRated:function(e){if(e&&e.parentNode&&e.parentNode.childNodes&&e.parentNode.childNodes.length>=2){var t=e.previousSibling;t&&"SPAN"===t.tagName&&t.className}}};o&&TrendMicro.TB.extend(n,o),this.urlPathPattern=e,this.selector=t,this.options=n},TrendMicro.TB.TBSet=function(){this.Nodes=[]},TrendMicro.TB.TBSet.prototype.getNodesCount=function(){return this.Nodes.length},TrendMicro.TB.TBSet.prototype.isNodeExist=function(e){for(var t=!1,o=0;o<this.Nodes.length;o++)if(this.Nodes[o]===e){t=!0;break}return t},TrendMicro.TB.TBSet.prototype.addNode=function(e){this.isNodeExist(e)||this.Nodes.push(e)},TrendMicro.TB.TBSet.prototype.createResultNodes=function(e,t){for(var o=0;o<this.Nodes.length;o++)CreateTSRResultObject(this.Nodes[o],this.Nodes[o].href,null,null,e,t)},TrendMicro.TB.TBSet.prototype.filterByHref=function(e){if(e){for(var t=[],o=0;o<this.Nodes.length;o++)if(this.Nodes[o].href){for(var n=!1,i=0;i<e.length;i++)if(new RegExp(e[i],"").test(this.Nodes[o].href)){n=!0;break}n||t.push(this.Nodes[o])}this.Nodes=t.slice(0)}},TrendMicro.TB.TBSet.prototype.filterByContent=function(e){if(e){for(var t,o=[],n=0;n<this.Nodes.length;n++)if(t=this.Nodes[n].innerHTML){for(var i=!1,r=0;r<e.length;r++)if(new RegExp(e[r],"i").test(t)){i=!0;break}i||o.push(this.Nodes[n])}this.Nodes=o.slice(0)}},TrendMicro.TB.isDocumentEditable=function(e){var t=document.getElementsByTagName("body"),o="false";return t.length>0&&(o=t[0].getAttribute("contenteditable")),"on"===document.designMode||""===o||"true"===o},TrendMicro.TB.DOMIdExist=function(e){return!!document.getElementById(e)},TrendMicro.TB.SAFESEARCHING=(ID_IMAGE_BLOCK_POPUP="ID_TSRImageBlockPopup",constructImageBlockPopup=function(){var e='<div id="'+ID_IMAGE_BLOCK_POPUP+'" class="TSRImageBlock_Root"><div class="TSRImageBlock_Wrapper"><div class="TSRImageBlock_body"><div class="TSRImageBlock_body_title">'+g_oSafeSearchingString.warnUserTitle+'</div><div class="TSRImageBlock_body_desc">'+g_oSafeSearchingString.reallyNeedToSeeUntilRestart+'</div></div><div class="TSRImageBlock_footer"><div class="TSRImageBlock_footer_logo" style="background-image: url('+TSREscapeURL("PC_Icon_Guide_16.png")+')"></div><div class="TSRImageBlock_footer_productName">'+D_TSRToolTipTitleString+"</div></div></div></div>";return TMExt_$(e)},isNeedToBlock=function(e){return 7===e||8===e},ImageBlockImgDefine_defaultImg="img_image_block_16_16.png",ImageBlockImgDefine_imgList=[{imgSize:110,src:"img_image_block_110_110.png"},{imgSize:100,src:"img_image_block_100_100.png"},{imgSize:90,src:"img_image_block_90_90.png"},{imgSize:80,src:"img_image_block_80_80.png"},{imgSize:70,src:"img_image_block_70_70.png"},{imgSize:60,src:"img_image_block_60_60.png"},{imgSize:50,src:"img_image_block_50_50.png"},{imgSize:40,src:"img_image_block_40_40.png"},{imgSize:30,src:"img_image_block_30_30.png"},{imgSize:20,src:"img_image_block_20_20.png"},{imgSize:16,src:"img_image_block_16_16.png"}],setBlockImage=function(e){var t=e.width()<e.height()?e.width():e.height(),o=ImageBlockImgDefine_defaultImg;TMExt_$.each(ImageBlockImgDefine_imgList,function(e,n){if(t>n.imgSize)return o=n.src,!1}),e.css("background-image","url("+TSREscapeURL(o)+")"),e.css("background-repeat","no-repeat"),e.css("background-position","center center")},_refreshBlockImages=function(e){for(var t="link_level",o=TMExt_$("["+t+"]"),n=0,i=o.length;n<i;n++){var r=o.eq(n),a=r.attr(t);isNeedToBlock(parseInt(a))&&e(r)}},{ID_IMAGE_BLOCK_POPUP,constructImageBlockPopup,checkImageBlockPopupExist:function(){if(0===TMExt_$("#"+ID_IMAGE_BLOCK_POPUP).length){var e=constructImageBlockPopup();e.bind("mouseleave",function(){TMExt_$(this).hide()}),e.find(".provide_password").bind("click",function(){"undefined"!=typeof SetTempImageSafeSearchStatus&&SetTempImageSafeSearchStatus(function(){location.reload()})}),TMExt_$("body").append(e)}},bindMouseEnterEvent:function(e){e.bind("mouseenter",function(){var e=TMExt_$("#"+ID_IMAGE_BLOCK_POPUP);e.css("width","auto"),e.css("height","auto"),e.fadeIn(200,function(){});var t=TMExt_$(this).offset(),o=TMExt_$(this).width()-e.width(),n=TMExt_$(this).height()-e.height(),i=0,r=0;o>=0?(e.css("width",TMExt_$(this).width()),i=t.left):(e.css("width","auto"),i=t.left+o/2),n>=0?(e.css("height",TMExt_$(this).height()),r=t.top):r=t.top+n/2,i<0&&(i=5),r<0&&(r=5),i+e.width()>TMExt_$(document).width()&&(i=i-(i+e.width()-TMExt_$(document).width())-5),e.css("left",i),e.css("top",r)})},isNeedToBlock,getParamFromURL:function(e,t){try{var o=document.createElement("a");o.href=e;var n=o.search;if("string"==typeof n&&n.length>0)for(var i=(n=n.substring(1)).split("&"),r=0;r<i.length;r++){var a=i[r].split("=");if(a[0]==t)return a[1]}return null}catch(e){return null}},assert:function(e,t){!e&&console&&console.error&&console.error(t)},setBlockImage,refreshBlockImages:function(e){setTimeout(function(){_refreshBlockImages(function(t){e&&e(t),setBlockImage(t)})},500)}}),exports.TrendMicro=TrendMicro})();