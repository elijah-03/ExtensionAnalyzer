!function(){var a=window.storyUtils,b=function(){return{dlBtnClassName:"ext_stories_dl_btn",showingStoryItems:[],allCurrentStories:[],gallery:null,lastTimeLiveStoriesUpdate:0,liveStoriesUpdatePeriod:6e4,storiesWrapperClass:"ext_stories_wrap",visibleIgStories:!0,hideIgStoriesBlock:function(a){$(".ext_stories_wrap").hide(),a.querySelector(".ext_stories_toggler_text_ig").innerText=d.getLang("show_ig_stories"),a.dataset.state="switched_off",this.visibleIgStories=!1,chrome.runtime.sendMessage("hideIgStoriesBlock")},showIgStoriesBlock:function(a){$(".ext_stories_wrap").show(),a.querySelector(".ext_stories_toggler_text_ig").innerText=d.getLang("hide_ig_stories"),a.dataset.state="switched_on",this.visibleIgStories=!0,chrome.runtime.sendMessage("showIgStoriesBlock")},insertVisibilityIgStoriesToggler:function(a,b){var c=this.visibleIgStories?d.getLang("hide_ig_stories"):d.getLang("show_ig_stories"),e=this.visibleIgStories?"switched_on":"switched_off",f=document.createElement("div");f.className="ext_stories_toggler_wrap_ig",f.innerHTML='<div class="ext_stories_toggler_ig" data-state="'+e+'"><div class="ext_stories_toggler_text_ig">'+c+"</div></div>",a.insertBefore(f,b)},insertStoriesBlock:function(a){if(d.isMainPage()&&a){var c=document.querySelector("."+b.storiesWrapperClass);c||(c=document.createElement("div"),c.className=b.storiesWrapperClass,a.firstElementChild?a.insertBefore(c,a.firstElementChild):a.appendChild(c),this.visibleIgStories?c.style.display="block":c.style.display="none",this.insertVisibilityIgStoriesToggler(a,c),this.insertStories(c),d.isWindows()||Ps.initialize(c,{minScrollbarLength:50,maxScrollbarLength:50}))}},insertStories:function(b){var c=this;c.lastTimeLiveStoriesUpdate=Date.now(),a.sendMessage("getAllStoriesForce",function(a){a&&(a.post_live.length||a.broadcasts.length||a.tray.length)&&(c.allCurrentStories=a,[].concat(c.allCurrentStories.broadcasts,c.allCurrentStories.post_live).forEach(function(a){var d=!!a.broadcast_owner;c.insertStoryLiveItem(a,b,d)}),c.allCurrentStories.tray.forEach(function(a){c.insertStoryTrayItem(a,b)}),d.isWindows()&&$(b).smoothDivScroll())})},addPrivacyWatchingInfo2StoriesBlock:function(a){var b=document.createElement("div");b.className="ext_story_item_wrap ext_story_privacy_wrap",b.innerHTML='<div class="ext_story_privacy_icon"><img src="'+chrome.runtime.getURL("img/eye_crossed_out.png")+'"></div>',tippy(b,{content:d.getLang("privacy_watching_msg")}),a.insertBefore(b,a.firstElementChild)},updateLiveStories:function(){var c=this,e=document.querySelector("."+b.storiesWrapperClass);e&&(Date.now()<this.lastTimeLiveStoriesUpdate+this.liveStoriesUpdatePeriod||(c.lastTimeLiveStoriesUpdate=Date.now(),a.sendMessage("getAllStories",function(a){if(a){c.allCurrentStories=a;var b=$('.ext_our_story_item[data-story-type="live"], .ext_our_story_item[data-story-type="postlive"]');b.attr("data-updated","0");var f=!1;if([].concat(c.allCurrentStories.broadcasts,c.allCurrentStories.post_live).forEach(function(a){var d=a.id||a.pk;if(!(b.filter('[data-story-id="'+d+'"]').attr("data-updated","1").length>0)){var g=!!a.broadcast_owner;f=!0,c.insertStoryLiveItem(a,e,g)}}),b.filter('[data-updated="0"]').remove(),f&&d.isWindows())try{$(e).smoothDivScroll("recalculateScrollableArea")}catch(g){}}})))},getStoryLiveElemItem:function(a){var b=a.broadcast_owner||a.user,c="undefined"!=typeof a.broadcast_owner,d=b.username.length>11?b.username.substr(0,10)+"...":b.username,e=chrome.runtime.getURL("/img/"+(c?"icon_live.png":"icon_post_live.png")),f=document.createElement("div");return f.className="ext_story_item_wrap ext_our_story_item",f.dataset.storyId=a.id||a.pk,f.dataset.storyType=c?"live":"postlive",f.innerHTML='<div class="ext_live_tray_item ext_unseen_story_item"><img class="user_icon_live center_div" src="'+b.profile_pic_url+'"><div class="user_icon_black_background center_div"></div><img class="ext_live_icon center_div" src="'+e+'"></div><div class="ext_story_item_author">'+d+"</div>",f},insertStoryLiveItem:function(a,b,c){var e=this.getStoryLiveElemItem(a);if(d.isWindows()){var f=b.querySelector(".scrollableArea");f||(f=b)}else f=b;if(c)var g=b.querySelector(".ext_our_story_item");else g=b.querySelector('.ext_our_story_item[data-story-type="postlive"], .ext_our_story_item[data-story-type="tray"]');f.querySelector('[data-story-id="'+a.id+'"]')||(g?f.insertBefore(e,g):f.appendChild(e))},insertStoryTrayItem:function(a,b){if(a.user){var c=a.user,d=c.username.length>11?c.username.substr(0,10)+"...":c.username,e=document.createElement("div");e.className="ext_story_item_wrap ext_our_story_item",e.dataset.storyType="tray",e.dataset.storyId=a.id||a.pk,e.innerHTML='<div class="ext_story_item_image"><img class="ext_item_image_orig" src="'+c.profile_pic_url+'"></div><div class="ext_story_item_author">'+d+"</div>",b.appendChild(e)}},checkStoryOneUser:function(c,d){var e=this;a.requestJSONgraphqlUser(c,function(a){if(!a||a.error||!a.graphql)return d({error:1});var c=a.graphql.user,f=c&&c.id;return f?void b.requestOneUserTrayStories(f,function(a){if(!a||!a.items||!a.items.length)return d({error:1});var b=e.prepareStoryItems(a.items);return b.length?void d(b):d({error:1})}):d({error:1})})},requestOneUserTrayStories:function(b,c){a.sendMessage({action:"requestOneUserTrayStories",user_id:b},function(a){c(a)})},requestOneUserAllTypesStories:function(b,c){a.sendMessage({action:"requestOneUserAllTypesStories",options:b},function(a){c(a)})},checkPostLiveOneUser:function(b){var c=this,d=a.getUserNameFromWindowLocation();if(!d){var e=document.querySelector("main header section h2");d=e&&e.innerText}return d?void a.requestJSONgraphqlUser(d,function(d){try{var e=d.graphql.user.id}catch(f){console.error(f)}return e?void a.sendMessage({action:"getCachedPostLives",author_user_id:e},function(a){return a?void c.requestOneUserAllTypesStories({user_id:e},function(c){if(!c)return b(!1);var d=c.reel&&"undefined"!=typeof c.reel.items;b({user_id:e,stories_exists:d,shortcodes:a})}):b(!1)}):b(!1)}):b(!1)},addPostLiveIcon2UserPage:function(a,b){$('<div class="ext_post_live_icon_wrap"><img src="'+chrome.runtime.getURL("/img/icon_post_live.png")+'"></div><div class="ext_post_live_placeholder" data-opts=\''+JSON.stringify(b)+"'</div>").appendTo(a)},showPostLiveFromOneUserPage:function(c){var d=JSON.parse(c.dataset.opts),f=function(){b.showWaitingLiveLoader(),a.sendMessage({action:"getIGTVDetailedRecursively",shortcodes:d.shortcodes},function(a){if(b.hideWaitingLiveLoader(),a&&a.broadcasts&&a.broadcasts.length){var c=b.prepareIgtv2SavedLive(a.broadcasts);b.showInPswp(c)}})};return d.stories_exists?void e.getModalBox().showStoryTypeUserChoice({showPostLiveCallback:f,showStoriesCallback:function(){c.parentElement.click()}}):f()},prepareStoryItems:function(b,c){var d=[];return b.forEach(function(b){try{var e,f=null,g=0,h=0,i=void 0,j=void 0,k="undefined"!=typeof b.video_versions;k?(b.video_versions.forEach(function(a){a.width>g&&(g=a.width,h=a.height,f=a.url)}),b.image_versions2.candidates.forEach(function(a){(!i||a.width<i)&&(i=a.width,j=a.url)}),e="mp4",-1!==f.indexOf(".flv")&&(e="flv")):(b.image_versions2.candidates.forEach(function(a){a.width>g&&(g=a.width,h=a.height,f=a.url),"undefined"==typeof i?(i=a.width,j=a.url):(!i||a.width<i)&&(i=a.width,j=a.url)}),e="jpg",-1!==f.indexOf(".png")&&(e="png"));var l=f.match(/\/([^\/?]+)(?:$|\?)/);l=l&&l[1],l||(l="noname."+e);var m=b.user.username||c&&c.username||"";m.length&&(l=m+"_"+l),l=a.filename.modify(l);var n={w:g,h:h,isVideo:k,type:k?"video":"photo",url:f,prev:j,filename:l,story_type:"tray",username:m,userPic:b.user.profile_pic_url||c&&c.profile_pic_url||"",locations:b.story_locations,hashtags:b.story_hashtags};k?n.html='<video class="ext_video_story_player" controls><source src="'+f+'" type="video/mp4"></video>':n.src=f,d.push(n)}catch(o){}}),d},prepareIgtv2SavedLive:function(b){var c=[];return b.forEach(function(b){try{var d={filename:a.getIgtvFileName(b),story_type:"post_live_igtv",html:'<video class="ext_video_story_player" controls><source src="'+b.url+'" type="video/mp4"></video>',user_pk:b.owner.pk,username:b.owner.username,userPic:b.owner.profile_pic_url,isVideo:!0,url:b.url};c.push(d)}catch(e){}}),c},createPswp:function(){var a=document.createElement("div");a.setAttribute("tabindex","-1"),a.setAttribute("role","dialog"),a.setAttribute("aria-hidden","true"),a.className="pswp insta_down";var c=d.getLang("download"),e=d.getLang("download_all");return a.innerHTML='<div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden pswp__ctrls-wrap"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><div class="dl_btns_container"><a type="button" class="'+b.dlBtnClassName+' ext_ds_dl_btn ext_story__download" title="'+c+'"><span class="ext_icon"></span><span class="ext_text">'+c+'</span></a><a type="button" class="'+b.dlBtnClassName+' ext_ds_dl_all_btn ext_story__download_all" title="'+e+'"><span class="ext_icon"></span><span class="ext_text">'+e+'</span></a></div><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="story_author_wrap"><div class="story_author_wrap_2"><a target="_blank" class="author_link"><img src="" class="story_author_icon"></a><div class="story_author_name"></div></div></div><div class="ext_story_privacy_msg_in_view"><div class="ext_story_privacy_icon"><img src="'+chrome.runtime.getURL("img/eye_crossed_out_white.png")+'"></div></div><div class="story_location_hashtags_wrap"></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div>',document.querySelector("body").appendChild(a),a},getPswp:function(){var a=document.querySelector(".insta_down");return a?a:this.createPswp()},stopAllVideos:function(){document.querySelectorAll(".ext_video_story_player").forEach(function(a){a.pause()})},showInPswp:function(b){try{var c=this;if(!b||!b.length)return;var e,f,g,h,i=function(a){var b=e.querySelector(".story_author_wrap");return a?(b.querySelector(".author_link").href="https://www.instagram.com/"+a.username,b.querySelector(".story_author_icon").src=a.userPic,b.querySelector(".story_author_name").innerText=a.username,void(b.style.display="block")):b.style.display="none"};c.showingStoryItems=b,e=c.getPswp();var j={index:0,closeOnScroll:!1,history:!1,focus:!0,bgOpacity:.96,escKey:!0};f=new PhotoSwipe(e,PhotoSwipeUI_Default,b,j),c.gallery=f,tippy(".ext_story_privacy_msg_in_view",{content:d.getLang("privacy_watching_msg")}),h=e.querySelector(".ext_ds_dl_all_btn"),"post_live_igtv"==b[0].story_type||c.showingStoryItems.length<2?h.style.display="none":h.style.display="block",f.listen("afterChange",function(){this.currItem.container&&(i(this.currItem),this.currItem.isVideo&&(g=this.currItem.container.querySelector(".ext_video_story_player"),g.currentTime=0,g.play()))}),f.listen("beforeChange",function(){c.stopAllVideos()}),f.listen("close",function(){c.stopAllVideos(),c.showingStoryItems=[]}),f.listen("destroy",function(){c.gallery=null,e.remove()}),f.init()}catch(k){Math.random()<.01&&a.trackCodeError(k,"showInPswp")}},toggleVisibleDlAllBtnInNativeStories:function(a){var b=document.querySelector(".ext_ns_dl_all_btn");if(b){if(window.location.href.indexOf("/stories/locations/")>-1||window.location.href.indexOf("/stories/tags/")>-1)return void(b.style.display="none");var c=1,d=a.querySelector("section > header + div");d||(d=a.querySelector("section header > div:first-child")),d&&(c=d.childElementCount),c>1?(b.querySelector(".stories_count").innerText="("+c+")",b.style.display="flex"):b.style.display="none"}},addDlBtn2NativeStories:function(a){var b=a.parentNode;b.querySelector(".native_stories_dl_wrap")||this.appendDlBtn2NativeStories(b),this.toggleVisibleDlAllBtnInNativeStories(b)},appendDlBtn2NativeStories:function(a){$('<div class="native_stories_dl_wrap"><a class="'+b.dlBtnClassName+' ext_ns_dl_btn ext_story__download"><span class="ext_icon"></span><span class="ext_text">'+d.getLang("download")+'</span></a><a class="'+b.dlBtnClassName+' ext_ns_dl_all_btn ext_story__download_all"><span class="ext_icon"></span><span class="ext_text">'+d.getLang("download_all")+'</span><span class="stories_count"></span></a></div>').appendTo(a),this.toggleVisibleDlAllBtnInNativeStories(a)},onClickDlBtnNativeStoryOne:function(b){var c=this,d=window.location.pathname.match(/stories\/([^\/]+)/);d=d&&d[1];var f,g,h=c.parentNode.parentNode.querySelector("section");if(h){var i=e.findVideoElement(h);if(i)f=e.getLinkFromVideoElement(i),g=a.getFileNameFromVideoLink(f,d);else{var j=e.findImageElement(h);f=e.getLinkFromImgElement(j),g=a.getFileNameFromImageLink(f,d)}f&&g&&(g=a.filename.modify(g),e.onGetMediaInfo.call(e,{url:f,filename:g,isStory:!0},c))}},onClickDlBtnNativeStoryAll:function(a){c.zipCanceledByUser=!1,e.loaderBtnState.on(this),b.getAllLinksCurrentNativeStories(function(a){if(e.loaderBtnState.off(),a&&!a.error){var b=a;if(b&&b.length){var d=b[0]&&b[0].username;c.downloadZIP(b,d,function(){})}}})},onClickDlBtnOurStoryOne:function(c){var d=b.gallery.currItem,e=d.filename;b.storiesPause.on(),e=a.filename.modify(e),a.downloadFile({url:d.url,filename:e,isStory:!0},function(a){})},onClickDlBtnOurStoryAll:function(a){c.zipCanceledByUser=!1,b.storiesPause.on(),c.downloadZIP(b.showingStoryItems.slice(0),b.gallery.currItem.username,function(a){b.storiesPause.off()})},storiesPause:{isPausedByUs:!1,isNativeStories:function(){return window.location.href.indexOf("/stories/")>-1},isOurStories:function(){return!(!b.gallery||!b.gallery.currItem)},pauseNativeStories:function(){var a=document.querySelector(".glyphsSpriteMore_horizontal__filled__24__grey_0");if(a){var b=document.createElement("style");b.id="ext_native_stories_pause_style",b.innerText='[role="presentation"] > div:not(.ext_modal){opacity: 0 !important;}',document.head.appendChild(b);var c=this;setTimeout(function(){a.click(),c.isPausedByUs=!0},100)}},playNativeStories:function(){$('[role="presentation"]').click(),$("#ext_native_stories_pause_style").remove(),this.isPausedByUs=!1},pauseOurStories:function(){if(!b.gallery||!b.gallery.currItem||!b.gallery.currItem.container)return!1;var a=b.gallery.currItem.container,c=a.querySelector(".ext_video_story_player");return c?void(c.paused||(c.pause(),this.isPausedByUs=!0)):!1},playOurStories:function(){if(this.isPausedByUs=!1,b.gallery&&b.gallery.currItem&&b.gallery.currItem.container){var a=b.gallery.currItem.container,c=a.querySelector(".ext_video_story_player");c&&c.paused&&c.play()}},on:function(){this.isNativeStories()?this.pauseNativeStories():this.isOurStories()&&this.pauseOurStories()},off:function(){this.isPausedByUs&&(this.isNativeStories()?this.playNativeStories():this.isOurStories()&&this.playOurStories())}},getAllLinksCurrentNativeStories:function(b){if(!window.location.pathname.match(/stories\/locations\/([^\/]+)/)&&!window.location.pathname.match(/stories\/tags\/([^\/]+)/))if(window.location.pathname.match(/stories\/highlights\/([^\/]+)/)){var c=window.location.pathname.match(/stories\/highlights\/([^\/]+)/);c=c&&c[1],a.getPostsDataFromUserGraphqlOther({highlight_reel_id:c},b)}else{var d=window.location.pathname.match(/stories\/([^\/]+)/);if(d=d&&d[1],!d)return void b();this.checkStoryOneUser(d,b)}},showWaitingLiveLoader:function(){$('<div class="wait_live_placeholder"><span></span></div>').appendTo(document.body)},hideWaitingLiveLoader:function(){document.querySelector(".wait_live_placeholder").remove()}}}(),c=function(){return{zipCanceledByUser:!1,dlBtnClassName:"ext_btn_dl_all",downloadZIP:function(b,c,f){function g(){j.zipCanceledByUser=!0,m.aborted=!0,i()}function h(a){if(j.zipCanceledByUser)return void(m.aborted=!0);if("undefined"==typeof n[a])i();else if(0==n[a].length&&n[a+1]&&n[a+1].length)setTimeout(function(){h(a+1)},1e3*(a+1));else if(0!=n[a].length||n[a+1]&&n[a+1].length)if(n[a].length){var b=n[a].shift();JSZipUtils.getBinaryContent(b.url,function(c,d){c?n[a+1]&&n[a+1].push(b):(p.rejectedCount--,p.successCount++,p.retrySuccessCount++,p.lastSuccess=!0,l.updateDownloadZipProgressBar(p),k.file(b.filename,d,{binary:!0})),setTimeout(function(){h(a)},1e3*a)},m,r)}else i();else i()}function i(){k.generateAsync({type:"blob"}).then(function(b){var d=new Date,e=c+"_"+d.getFullYear()+"_"+(d.getMonth()+1)+"_"+d.getDate()+"_"+d.getHours()+"_"+d.getMinutes()+"_"+d.getSeconds()+".zip";saveAs(b,e),l.close(),"function"==typeof f&&f({success:1}),a.sendMessage({action:"downloadZip",count:o,successCount:p.successCount})})}var j=this,k=new JSZip;c=c||"Instagram",c=a.filename.modify(c);var l=e.getModalBox(),m={aborted:!1},n=[null,[],[],[]],o=b.length,p={allCount:o,successCount:0,rejectedCount:0,retrySuccessCount:0,retryRequestsCount:void 0,oneValuePercent:100/o,lastSuccess:!1},q=6e4,r=3e5,s={enoughCallback:g};s.cancelCallback=function(){j.zipCanceledByUser=!0,m.aborted=!0,f()},l.showDownloadProcess(o,s),d.customPromiseAll({data:b,asyncCount:12},function(a,b,c){return j.zipCanceledByUser?(m.aborted=!0,c()):void JSZipUtils.getBinaryContent(a.url,function(c,d){c?(p.rejectedCount++,n[1].push(a),b(a.filename)):(p.successCount++,p.lastSuccess=!0,l.updateDownloadZipProgressBar(p),k.file(a.filename,d,{binary:!0}),b(a.filename))},m,q)}).thenOne(function(a){j.zipCanceledByUser||(n[1].length?(p.retryRequestsCount=n[1].length,p.text=d.getLang("retry_requests"),p.lastSuccess=!1,l.updateDownloadZipProgressBar(p),setTimeout(function(){h(1)},1e3)):i())},function(a){j.zipCanceledByUser||(l.showErrorBox(d.getLang("errorZip")),"function"==typeof f&&f({error:1}))})}}}(),d=function(){return{getLang:function(a){return chrome.i18n&&chrome.i18n.getMessage(a)||""},customPromiseAll:function(a,b){function c(){f||(f=setInterval(function(){g!==i&&(clearInterval(f),f=void 0,g===j?q():r())},10))}var d,e,f,g,h,i=0,j=1,k=2,l=a.data,m=(a.timeout||6e5,a.asyncCount||48),n=!1,o=this,p=[],q=function(){"function"==typeof h.resolve&&(l=p,setTimeout(function(){try{h.resolve(l)}catch(a){p=a,r()}},0))},r=function(){n||(n=!0,"function"==typeof h.reject&&(b=h.reject)(p))},s=function(){e=0,d=l.length;var a=0,f=function(b){return function(c){Array.isArray(p)&&g!=k&&(a--,e++,p[b]=c,e===d&&(g=j))}},h=function(a){g=k,p=a};g=i,c();var n=setInterval(function(){if(!l.length||g!=i)return void clearInterval(n);var c=m-a;1>c||l.splice(0,c).forEach(function(c,d){setTimeout(function(){try{a++,b(c,f(d),h)}catch(e){p=e,g=k}},0)})},500)};return this.thenOne=function(a,b){return h={resolve:a,reject:b},c(),o},s(),this},isMainPage:function(){return"/"==window.location.pathname&&"instagram.com"==window.location.host.replace(/^w{3}\./,"")&&null==document.querySelector('input[type="password"]')},isNativeStories:function(){return/instagram.com\/stories\/[^\/]+/.test(window.location.href)},isLoginPage:function(){return null!=document.querySelector('input[type="password"]')},isAccountSettingPage:function(){return window.location.pathname.indexOf("instagram.com/emails/")>-1||window.location.pathname.indexOf("instagram.com/accounts/")>-1},isWindows:function(){return window.navigator.userAgent.toLowerCase().indexOf("windows")>-1},isFrame:function(){return window.top!=window.self}}}(),e=function(){return{instaFirst:!1,run:function(){d.isFrame()||(a.fixForeach(),a.getWorkingQueryHashes(),this.observerDOMInit(),this.messagesListenerInit(),this.userActionsListenerInit(),this.disconnectPortObserver.testConnect())},loadCfg:function(a){chrome.runtime.sendMessage("getIgStoriesVisibility",function(c){b.visibleIgStories=c,a()})},observerDOMInit:function(){function a(){var a=document.querySelector("#react-root");if(a){var b={attributes:!1,childList:!0,characterData:!1,subtree:!1},c=new MutationObserver(function(a){a.forEach(function(a){if(a.addedNodes.length)for(var b=0;a.addedNodes[b];b++)if("section"==a.addedNodes[b].tagName.toLowerCase()){j();break}})});c.observe(a,b)}}function c(){if(-1!==window.location.href.indexOf("instagram.com/tv/")||-1!==window.location.href.indexOf("instagram.com/p/")){var a=document.querySelectorAll("div > div > article > header + div > div > div");0===a.length&&(a=document.querySelectorAll("div > div > article header + div + div > div > div")),a.forEach(function(a){a.parentNode.dataset.extSkip>0||a.querySelector("ul > li > div > div > div")||a.querySelector("video")&&a.querySelector("video").controls&&e.addDlBtn(a.parentNode)})}}function f(){if(!d.isNativeStories())return!1;var a=document.querySelector("._sq4bv ._psbeo ._ni05h section");a||(a=document.querySelector("section > div div section")),a&&b.toggleVisibleDlAllBtnInNativeStories(a)}function g(a){if(!d.isNativeStories())return!1;var c=document.querySelector("._sq4bv ._psbeo ._ni05h section");return c||(c=document.querySelector("section > div div section")),c?c&&"1"!=c.dataset.extSkip&&(c.dataset.extSkip=1,setTimeout(function(){b.addDlBtn2NativeStories(c)},0)):a||setTimeout(function(){g(!0)},1e3),!0}function h(){if(d.isMainPage()){var a=document.querySelector("section > main > section > div:first-child");a&&a.querySelector("article")||(a=document.querySelector("section > main > section > div:first-child+div")),a&&a.querySelector("article")&&b.insertStoriesBlock(a)}}function i(){window.location.href.indexOf("/stories/")>-1?f():d.isMainPage()?b.updateLiveStories():c()}function j(){window.location.href.indexOf("/stories/")>-1?g():d.isMainPage()&&h()}setTimeout(function(){j()},0),setTimeout(function(){i()},0),a(),setInterval(function(){i()},1500),window.location.href.indexOf("/stories/")>-1&&setTimeout(function(){g()},1500)},messagesListenerInit:function(){chrome.runtime.onMessage.addListener(function(a){return a?void("storyPauseOffByDownloadId"==a?b.storiesPause.off():"storyPauseOffByBlobUrl"==a.action&&b.storiesPause.off()):!1})},userActionsListenerInit:function(){var c=$("body"),f=Date.now(),g=function(a,b){a.preventDefault(),a.stopPropagation(),b=b||500;var c=Date.now();return f+b>c?!0:(f=c,!1)};c.on("click",".ext_our_story_item",function(c){if(!g(c)){var f=this,h=f.dataset.storyId,i=f.dataset.storyType,j=null;if("tray"==i)var k=b.allCurrentStories.tray;else k="live"==i?b.allCurrentStories.broadcasts:b.allCurrentStories.post_live;for(var l in k){var m=k[l];if(m&&(m.id==h||m.pk==h)){j=m;break}}if(j)if("tray"==i){var n=j.user&&j.user.pk;if(!n)return e.getModalBox().showErrorBox(d.getLang("story_is_not_available"));var o=$(".ext_story_item_image",f),p=o.find("img"),q=p.clone();q.removeClass("ext_item_image_orig").addClass("ext_item_image_clone").appendTo(o);var r,s;setTimeout(function(){s||(o.addClass("ext_story_loading"),r=setInterval(function(){o.toggleClass("ext_story_loading")},1e3))},300),b.requestOneUserTrayStories(n,function(a){if(s=!0,clearInterval(r),q.remove(),o.removeClass("ext_story_loading"),!a)return e.getModalBox().showErrorBox(d.getLang("story_is_not_available"));var c=b.prepareStoryItems(a.items);return c.length?void b.showInPswp(c):e.getModalBox().showErrorBox(d.getLang("story_is_not_available"))})}else if("postlive"==i&&"post_live_igtv"==j.broadcasts[0].story_type){var t=b.prepareIgtv2SavedLive(j.broadcasts);b.showInPswp(t)}else{var u={action:"open_stories_tab",type:i};"live"==i?(u.live_id=h,u.user_id=j.broadcast_owner.pk):u.user_id=j.user.pk,a.sendMessage(u)}}}),c.on("click",".ext_ds_dl_btn",function(a){g(a,1e3)||b.onClickDlBtnOurStoryOne.call(this,a)}),c.on("click",".ext_ds_dl_all_btn",function(a){g(a)||b.onClickDlBtnOurStoryAll.call(this,a)}),c.on("click",".ext_ns_dl_btn",function(a){g(a)||b.onClickDlBtnNativeStoryOne.call(this,a)}),c.on("click",".ext_ns_dl_all_btn",function(a){g(a)||b.onClickDlBtnNativeStoryAll.call(this,a)}),c.on("click",".ext_igtv_dl_btn",function(a){g(a)||e.onClickDownloadIgtvBtn.call(this,a)}),c.on("click",".ext_post_live_placeholder",function(a){g(a)||b.showPostLiveFromOneUserPage(this)}),c.on("click",".ext_stories_toggler_ig",function(a){g(a)||("switched_on"==this.dataset.state?b.hideIgStoriesBlock(this):"switched_off"==this.dataset.state&&b.showIgStoriesBlock(this))})},addDlBtn:function(a){"use strict";if(!a.querySelector(".ext_igtv_dl_btn")){var b=window.location.href.match(/instagram\.com\/(tv|p)\/([^\/?]+)\//);if(b=b&&b[2]){var c=document.createElement("a");c.className="ext_igtv_dl_btn",c.setAttribute("type","button"),c.dataset.shortcode=b,c.innerHTML='<span class="ext_text">'+d.getLang("download").toUpperCase()+'</span><span class="ext_icon"></span>',d.isWindows()&&c.classList.add("ext_windows_font"),a.appendChild(c),a.dataset.extSkip="1"}}},onClickDownloadIgtvBtn:function(b){b.stopPropagation(),b.preventDefault();var c=this;e.loaderBtnState.on(c),a.sendMessage({action:"requestIGTVDetailedData",shortcode:c.dataset.shortcode},function(b){if(b)var d={url:b.video_url,filename:a.getFileNameFromVideoLink(b.video_url,b.owner.username)};else{var f=e.findVideoElement(c.parentNode);if(f){var g=e.getLinkFromVideoElement(f),h=a.getFileNameFromVideoLink(g);g&&h&&-1==g.indexOf("blob:")&&(d={url:g,filename:h})}}e.onGetMediaInfo.call(e,d,c)})},onGetMediaInfo:function(b,c){var d=this;return b&&!b.error&&b.url&&b.filename?void a.downloadFile(b,function(a){d.loaderBtnState.off(),a||d.showDownloadError(c)}):(d.loaderBtnState.off(),d.showDownloadError(c))},loaderBtnState:{on:function(a){$(".ext_icon",a).addClass("preloader2")},off:function(){$(".ext_icon.preloader2").removeClass("preloader2")}},showDownloadError:function(a){if(a){var b=a.parentNode;$(b).append('<div class="error_dl_msg_desktop">'+d.getLang("error_dl_msg")+"</div>"),setTimeout(function(){$(".error_dl_msg_desktop").remove()},2e3)}},disconnectPortObserver:{port:null,disconnected:!1,testConnect:function(){this.port=chrome.runtime.connect(),this.port.onDisconnect.addListener(this.disconnectListener)},disconnectListener:function(){this.disconnected=!0,window.insta_story_dl_disabled=!0}},findVideoElement:function(a){return a.querySelector("video")},findImageElement:function(a){var b=null,c=a.querySelectorAll("img[src], img[srcset]");if(1===c.length)b=c[0];else if(c.length>1){for(var d=0;c[d];d++){var e=c[d].getAttribute("src"),f=c[d].getAttribute("srcset");if((e||f)&&!("string"==typeof e&&e.indexOf("chromeznsion")>-1)&&("string"==typeof e&&e.indexOf("instagram")>-1||"string"==typeof f&&f.indexOf("instagram")>-1)&&c[d].width>100){b=c[d];break}}b||(b=c[0])}return b?b:null},getLinkFromImgElement:function(a){if(!(a instanceof HTMLElement))return null;var b=a.getAttribute("srcset");if(b){var c={},d=b.split(",");d.forEach(function(a){var b=a.split(" ");c[b[1].replace(/[^\d]/,"")]=b[0]});var e=0;for(var f in c)+f>+e&&(e=f);var g=c[e]}return"string"==typeof g&&g.match(/\.(jpg|png)/)||(g=a.getAttribute("src")),"string"!=typeof g?null:g},getLinkFromVideoElement:function(a){if(!(a instanceof HTMLElement))return!1;var b=a.getAttribute("src");if("string"==typeof b)return b;var c=a.querySelectorAll("source");if(!c.length)return!1;var d=["avc1.64001E","avc1.4D401E","avc1.58A01E","avc1.42E01E"],e=[];c.forEach(function(a){var b=a.getAttribute("type");if(b){var c=b.match(/codecs="([^,]+)/);if(c=c&&c[1]){var f=d.indexOf(c);-1!=f&&(e[f]=a.src)}}});for(var f in e)if("string"==typeof e[f]&&e[f].length){b=e[f];break}return b||(b=c[0].getAttribute("src")),"string"!=typeof b?!1:b},getModalBox:function(){function c(){t=p.querySelector("#ext_modal_checkbox"),t&&t.checked&&a.sendMessage("warning-off"),n(),p.style.display="none",B.innerHTML="",p.opened=0,p.remove()}function f(a){return function(){c(),a()}}function g(a){return function(){c(),a()}}function h(a){return function(){c(),b.storiesPause.off(),e.loaderBtnState.off(),"function"==typeof a&&a()}}function i(a){return function(){c(),a()}}function j(a){return function(){c(),a()}}function k(a){a.target==p&&c()}function l(a){27==a.keyCode&&h()()}function m(a,b,c){a&&b&&c&&a.addEventListener(b,c),C.push({el:a,event:b,listener:c})}function n(){C.forEach(function(a){a.el&&a.event&&a.listener&&a.el.removeEventListener(a.event,a.listener)}),window.removeEventListener("click",k),window.removeEventListener("keydown",l)}function o(a){q=p.querySelector(".ext_btn_continue"),r=p.querySelector(".ext_btn_cancel"),u=B.querySelector(".ext_modal_close"),s=B.querySelector(".ext_btn_enough"),z=B.querySelector(".show_post_live_user_btn"),A=B.querySelector(".show_stories_user_btn"),a&&("function"==typeof a.continueCallback&&q&&m(q,"click",f(a.continueCallback)),"function"==typeof a.enoughCallback&&s&&m(s,"click",g(a.enoughCallback)),"function"==typeof a.showStoriesCallback&&A&&m(A,"click",j(a.showStoriesCallback)),"function"==typeof a.showPostLiveCallback&&z&&m(z,"click",i(a.showPostLiveCallback))),m(r,"click",h(a&&a.cancelCallback)),m(u,"click",h(a&&a.cancelCallback)),window.addEventListener("keydown",l)}var p=document.querySelector(".ext_modal");p||(p=document.createElement("div"),p.className="ext_modal igsdr",p.innerHTML='<div class="ext_modal_content"></div>',document.querySelector("body").appendChild(p));var q,r,s,t,u,v,w,x,y,z,A,B=p.querySelector(".ext_modal_content"),C=[];return p.close=function(){c()},p.showDownloadProcess=function(a,b){window.removeEventListener("click",k),B.innerHTML='<div class="ext_download_all_process"><div class="download_all_process_state">'+d.getLang("download_zip")+'</div><div class="download_all_retry">'+d.getLang("retry_requests")+'<span></span></div><div id="ext_progress"><div id="ext_bar"></div></div><div class="download_all_success_count"></div><div class="ext_modal_buttons_wrap"><button class="ext_btn_cancel cancel_download">'+d.getLang("btn_cancel").toUpperCase()+'</button><button class="ext_btn_enough">'+d.getLang("btn_enough").toUpperCase()+"</button></div></div>",w=B.querySelector(".download_all_success_count"),x=B.querySelector(".download_all_retry"),y=B.querySelector(".download_all_retry span"),v=p.querySelector("#ext_bar"),w.innerText="(0/"+a+")",o(b);var c=$('[role="presentation"]');d.isNativeStories()&&c.length&&c.append(p),p.style.display="block",p.opened=1},p.showStoryTypeUserChoice=function(a){B.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_modal_buttons_wrap"><button class="show_post_live_user_btn">'+d.getLang("show_post_live")+'</button><button class="show_stories_user_btn">'+d.getLang("show_stories")+"</button></div>",o(a),window.addEventListener("click",k),p.style.display="block",p.opened=1},p.updateDownloadZipProgressBar=function(a){if(p.querySelector(".ext_download_all_process")&&(w.innerText="("+a.successCount+"/"+a.allCount+")",a.retryRequestsCount&&(x.style.display="block",y.innerText=" ("+a.retrySuccessCount+"/"+a.retryRequestsCount+")"),a.lastSuccess)){var b=a.oneValuePercent;v.style.width||(v.style.width="0%");var c=parseFloat(v.style.width),d=c+b;(100==d||d>100)&&(d=100),v.style.width=d+"%"}},p.showErrorBox=function(a){B.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_error_modal_wrap"><div class="ext_error_modal_text">'+a+"</div></div>",o(),window.addEventListener("click",k),p.opened=1,p.style.display="block"},p.opened=0,B.innerHTML="",p}}}();$(document).ready(function(){if(location.href.indexOf("instagram.com")>-1){if(!document.body)return;a.bridge({func:function(a){var b=navigator.userAgent.toLowerCase().indexOf("mobile")>-1;a({is_mobile:b})},cb:function(a){a&&a.is_mobile||chrome.runtime.sendMessage("exist_a_br",function(a){a||e.loadCfg(function(){e.run()})})}})}})}();