(()=>{"use strict";function e(){return-1!=navigator.userAgent.indexOf("Firefox")}function t(){return e()?browser:chrome}function n(){t().storage.local.get("debug",e=>{e.debug&&console&&console.log&&console.log.apply(this,arguments)})}function o(){console&&console.error&&console.error.apply(this,arguments)}const r={isFirefox:e,getBrowser:t,logInfo:n,logError:o,getCurrentLocale:function e(){void 0===e.locale_map&&TMExt_$.ajax({url:getURL("settings.json"),async:!1,dataType:"json",success:function(t){n(t),e.locale_map=t.supportLanguage,e.default_lang=t.defaultLanguage,e.l10n_map=t.l10nFolderMap}});let t=navigator.language,o=!1,r=e.locale_map,a="";for(var s=0;s<r.length;++s)if(r[s].includes(t)){a=r[s],o=!0;break}o||(a=e.default_lang);let i=a;return void 0!==e.l10n_map[a]&&(i=e.l10n_map[a]),i},tbc_sendRequest:function(e,n,o){var r={action:e,params:n};t().runtime.sendMessage(r,o)},getBankingList:async function(){let e=[];try{const n=await fetch(t().runtime.getURL("PbBankingList.txt"));e=(await n.text()).split("\n")}catch(e){o("getBankingList: e = "+e)}return n("getBankingList: size of banking list = "+e.length),e},binarySearch:function e(t,n,o,r){if(r<o)return-1;if(r-o<=1)return n===t[o]?o:n===t[r]?r:-1;let a=Math.floor((o+r)/2);return t[a]===n?a:t[a]<n?e(t,n,a,r):t[a]>n?e(t,n,o,a):-1},sendMessageToActiveTab:function(e){return new Promise((n,o)=>{const r=t();r.tabs.query({active:!0,currentWindow:!0},t=>{t.length<=0?n(!1):r.tabs.sendMessage(t[0].id,e,()=>{r.runtime.lastError&&o(r.runtime.lastError.message)})})})},sha256:async function(e){let t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return[...new Uint8Array(n)].map(e=>e.toString(16).padStart(2,"0")).join("")},Lock:class{constructor(){this._locked=!1,this._waiting=[]}async acquire(){for(;this._locked;)await new Promise(e=>this._waiting.push(e));this._locked=!0}release(){this._locked=!1,this._waiting.length>0&&this._waiting.shift()()}}},a="[AdBlock]";let s=t(),i=[],c=r.getBrowser();const l=()=>{c.storage.local.get({framework_status:!1},e=>{e.framework_status?c.runtime.sendMessage({action:"adGetSettings",url:document.location.href},e=>{if(void 0===e.action||null===e.action)return;const t=e=>{r.logInfo("tryCheckAdElement: count = "+e),e>=10||setTimeout(()=>{(async function(){if(!document||!document.querySelectorAll)return o(a,"checkAdElement: unable to use querySelectorAll"),!1;let e=!1;try{for(let t of i){n(a,"checkAdElement: queryString = "+t);let o=document.querySelectorAll(t);n(a,"checkAdElement: length of queryRet  = "+o.length);for(let t=0;t<o.length;++t)"none"!==o[t].style.display&&(o[t].style.display="none",s.runtime.sendMessage({action:"adUpdateCount"}),e=!0)}}catch(e){o(a,"checkAdElement: e = "+e)}return n(a,"checkAdElement: ret = "+e),e})().then(()=>{t(e+1)})},1e3)};"check_content"===e.action&&async function(){let e=!1;try{const t=await fetch(s.runtime.getURL("js/adblock/settings.json")),n=await t.json();let o=new URL(document.location.href).hostname;n.queries.hasOwnProperty(o)&&(i=n.queries[o],e=!0)}catch(e){o(a,"loadQueryList: e = "+e)}return e}().then(e=>{e&&t(0)})}):setTimeout(()=>{l()},500)})};l()})();