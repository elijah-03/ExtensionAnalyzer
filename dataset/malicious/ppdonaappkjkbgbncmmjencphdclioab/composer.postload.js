"use strict";let blockelementPopupId=null,currentlyPickingElement=!1,lastMouseOverEvent=null,currentElement=null,highlightedElementsSelector=null,highlightedElementsInterval=null,lastRightClickEvent=null,lastRightClickEventIsMostRecent=!1;function getFiltersForElement(e,t){let n=e.getAttribute("src");ext.backgroundPage.sendMessage({type:"composer.getFilters",tagName:e.localName,id:e.id,src:n&&n.length<=1e3?n:null,style:e.getAttribute("style"),classes:Array.prototype.slice.call(e.classList),urls:getURLsFromElement(e),mediatype:typeMap.get(e.localName),baseURL:document.location.href},(e=>{t(e.filters,e.selectors)}))}function getBlockableElementOrAncestor(e,t){for(;e&&e!=document.documentElement&&e!=document.body;)if(e instanceof HTMLElement&&"area"!=e.localName){if("map"!=e.localName)return void getFiltersForElement(e,(n=>{n.length>0?t(e):getBlockableElementOrAncestor(e.parentElement,t)}));{let t=document.querySelectorAll("img[usemap]"),n=null;for(let l of t){let t=l.getAttribute("usemap"),o=t.indexOf("#");if(-1!=o&&t.substr(o+1)==e.name){n=l;break}}e=n}}else e=e.parentElement;t(null)}function addElementOverlay(e){let t="absolute",n=window.scrollX,l=window.scrollY;for(let o=e;o;o=o.parentElement){let e=getComputedStyle(o);if("none"==e.display)return null;"fixed"==e.position&&(t="fixed",n=l=0)}let o=document.createElement("div");o.prisoner=e,o.className="__adblockplus__overlay",o.setAttribute("style","opacity:0.4; display:inline-block !important; overflow:hidden; box-sizing:border-box;");let r=e.getBoundingClientRect();return o.style.width=r.width+"px",o.style.height=r.height+"px",o.style.left=r.left+n+"px",o.style.top=r.top+l+"px",o.style.position=t,o.style.zIndex=2147483646,document.documentElement.appendChild(o),o}function highlightElement(e,t,n){unhighlightElement(e);"prisoner"in e?(()=>{let l=e.style.getPropertyValue("box-shadow"),o=e.style.getPropertyPriority("box-shadow"),r=e.style.getPropertyValue("background-color"),i=e.style.getPropertyPriority("background-color");e.style.setProperty("box-shadow","inset 0px 0px 5px "+t,"important"),e.style.setProperty("background-color",n,"important"),e._unhighlight=()=>{e.style.removeProperty("box-shadow"),e.style.setProperty("box-shadow",l,o),e.style.removeProperty("background-color"),e.style.setProperty("background-color",r,i)}})():(()=>{let l=addElementOverlay(e);l&&(highlightElement(l,t,n),l.style.pointerEvents="none",e._unhighlight=()=>{l.parentNode.removeChild(l)})})()}function unhighlightElement(e){e&&"_unhighlight"in e&&(e._unhighlight(),delete e._unhighlight)}function highlightElements(e){unhighlightElements();let t=Array.prototype.slice.call(document.querySelectorAll(e));highlightedElementsSelector=e,highlightedElementsInterval=setInterval((()=>{if(t.length>0){let e=t.shift();e!=currentElement&&highlightElement(e,"#fd6738","#f6e1e5")}else clearInterval(highlightedElementsInterval),highlightedElementsInterval=null}),0)}function unhighlightElements(){highlightedElementsInterval&&(clearInterval(highlightedElementsInterval),highlightedElementsInterval=null),highlightedElementsSelector&&(Array.prototype.forEach.call(document.querySelectorAll(highlightedElementsSelector),unhighlightElement),highlightedElementsSelector=null)}function stopEventPropagation(e){e.stopPropagation()}function mouseOver(e){lastMouseOverEvent=e,getBlockableElementOrAncestor(e.target,(t=>{e==lastMouseOverEvent&&(lastMouseOverEvent=null,currentlyPickingElement&&(currentElement&&unhighlightElement(currentElement),t&&highlightElement(t,"#d6d84b","#f8fa47"),currentElement=t))})),e.stopPropagation()}function mouseOut(e){currentlyPickingElement&&currentElement==e.target&&(unhighlightElement(currentElement),e.stopPropagation())}function keyDown(e){e.ctrlKey||e.altKey||e.shiftKey||(13==e.keyCode?elementPicked(e):27==e.keyCode&&deactivateBlockElement())}function startPickingElement(){currentlyPickingElement=!0,Array.prototype.forEach.call(document.querySelectorAll("object,embed,iframe,frame"),(e=>{getFiltersForElement(e,(t=>{t.length>0&&addElementOverlay(e)}))})),document.addEventListener("mousedown",stopEventPropagation,!0),document.addEventListener("mouseup",stopEventPropagation,!0),document.addEventListener("mouseenter",stopEventPropagation,!0),document.addEventListener("mouseleave",stopEventPropagation,!0),document.addEventListener("mouseover",mouseOver,!0),document.addEventListener("mouseout",mouseOut,!0),document.addEventListener("click",elementPicked,!0),document.addEventListener("contextmenu",elementPicked,!0),document.addEventListener("keydown",keyDown,!0),ext.onExtensionUnloaded.addListener(deactivateBlockElement)}function elementPicked(e){if(!currentElement)return;getFiltersForElement(currentElement.prisoner||currentElement,((e,t)=>{currentlyPickingElement&&stopPickingElement(),ext.backgroundPage.sendMessage({type:"composer.openDialog"},(t=>{ext.backgroundPage.sendMessage({type:"forward",targetPageId:t,payload:{type:"composer.dialog.init",filters:e}}),window==window.top?blockelementPopupId=t:ext.backgroundPage.sendMessage({type:"forward",payload:{type:"composer.content.dialogOpened",popupId:t}})})),t.length>0&&highlightElements(t.join(",")),highlightElement(currentElement,"#fd1708","#f6a1b5")})),e.preventDefault(),e.stopPropagation()}function stopPickingElement(){currentlyPickingElement=!1,document.removeEventListener("mousedown",stopEventPropagation,!0),document.removeEventListener("mouseup",stopEventPropagation,!0),document.removeEventListener("mouseenter",stopEventPropagation,!0),document.removeEventListener("mouseleave",stopEventPropagation,!0),document.removeEventListener("mouseover",mouseOver,!0),document.removeEventListener("mouseout",mouseOut,!0),document.removeEventListener("click",elementPicked,!0),document.removeEventListener("contextmenu",elementPicked,!0),document.removeEventListener("keydown",keyDown,!0)}function deactivateBlockElement(){currentlyPickingElement&&stopPickingElement(),null!=blockelementPopupId&&(ext.backgroundPage.sendMessage({type:"forward",targetPageId:blockelementPopupId,payload:{type:"composer.dialog.close"}}),blockelementPopupId=null),lastRightClickEvent=null,currentElement&&(unhighlightElement(currentElement),currentElement=null),unhighlightElements();let e=document.getElementsByClassName("__adblockplus__overlay");for(;e.length>0;)e[0].parentNode.removeChild(e[0]);ext.onExtensionUnloaded.removeListener(deactivateBlockElement)}document instanceof HTMLDocument&&(document.addEventListener("contextmenu",(e=>{lastRightClickEvent=e,lastRightClickEventIsMostRecent=!0,ext.backgroundPage.sendMessage({type:"forward",payload:{type:"composer.content.clearPreviousRightClickEvent"}})}),!0),ext.onMessage.addListener(((e,t,n)=>{switch(e.type){case"composer.content.getState":window==window.top&&n({active:currentlyPickingElement||null!=blockelementPopupId});break;case"composer.content.startPickingElement":window==window.top&&startPickingElement();break;case"composer.content.contextMenuClicked":let t=lastRightClickEvent;deactivateBlockElement(),t&&getBlockableElementOrAncestor(t.target,(e=>{e&&(currentElement=e,elementPicked(t))}));break;case"composer.content.finished":currentElement&&e.remove&&(checkCollapse(currentElement.prisoner||currentElement),elemhide.apply()),deactivateBlockElement();break;case"composer.content.clearPreviousRightClickEvent":lastRightClickEventIsMostRecent||(lastRightClickEvent=null),lastRightClickEventIsMostRecent=!1;break;case"composer.content.dialogOpened":window==window.top&&(blockelementPopupId=e.popupId);break;case"composer.content.dialogClosed":window==window.top&&blockelementPopupId==e.popupId&&ext.backgroundPage.sendMessage({type:"forward",payload:{type:"composer.content.finished"}})}})),window==window.top&&ext.backgroundPage.sendMessage({type:"composer.ready"}));