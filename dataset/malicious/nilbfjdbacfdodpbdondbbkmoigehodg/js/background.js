!function(){function a(){b(),V(function(){xa?chrome.browserAction.setPopup({popup:"wb.html"},function(){}):U()})}function b(){chrome.storage.sync.get(["upload_external","ig_stories_visible","check_json"],function(a){qa=!!a.upload_external,"undefined"==typeof a.ig_stories_visible&&chrome.storage.sync.set({ig_stories_visible:!0})})}function c(){var a=navigator.userAgent.replace(/\s/g,"").toLowerCase().match(/chrome\/(\d+)/),b=a&&a[1]&&a[1].length&&a[1];return b=b&&parseInt(b),!b||isNaN(b)?!0:72>b}function d(){}function e(a){var b={};chrome.cookies.get({url:ga,name:"ds_user_id"},function(c){c&&(b.ds_user_id=c.value),chrome.cookies.get({url:ga,name:"sessionid"},function(c){c&&(b.sessionid=c.value),chrome.cookies.get({url:ga,name:"csrftoken"},function(c){c&&(b.csrftoken=c.value),a&&a(b)})})})}function f(a){chrome.cookies.getAll({url:"https://*.instagram.com"},function(b){var c={},d=!1,e=!1;b.forEach(function(a){c[a.name]=a.value,"ds_user_id"==a.name?e=!0:"sessionid"==a.name&&(d=!0)}),e&&d?a(c):a()})}function g(a){ba=null,f(function(b){b?(ba=b,a(ba)):a()})}function h(a){e(function(b){return b.ds_user_id?na+oa<Date.now()?k(!1,a):ua&&ua[b.ds_user_id]?a(ua[b.ds_user_id]):k(!1,a):void a()})}function i(a){k(!1,a)}function j(a){return a.sort(function(){return Math.random()-.5}),a}function k(a,b){g(function(c){if(c&&c.sessionid){na=Date.now();var d=c.ds_user_id;$.ajax({method:"GET",url:"https://i.instagram.com/api/v1/feed/reels_tray/",dataType:"json"}).done(function(c){c&&"object"==typeof c?p(function(a){ua[d]={broadcasts:a&&a.length?a:c.broadcasts||[],tray:c.tray||[],post_live:[]},"function"==typeof b&&b(ua[d])}):a?(na=Date.now(),"function"==typeof b&&b()):setTimeout(function(){k(!0,b)},3e3)}).fail(function(c){a?"function"==typeof b&&b():setTimeout(function(){k(!0,b)},3e3)})}})}function l(a,b){e(function(c){if(!c.ds_user_id||!ua[c.ds_user_id]||!ua[c.ds_user_id].post_live)return b();for(var d=null,e=0;ua[c.ds_user_id].post_live[e];e++){var f=ua[c.ds_user_id].post_live[e];if(f.user.pk==a){d=[],f.broadcasts.forEach(function(a){d.push(a.shortcode)});break}}b(d)})}function m(a,b,c){c=c||[],n(a.shift(),function(d){return d&&c.push(d),a.length?void setTimeout(function(){m(a,b,c)},1e3):b(o(c))})}function n(a,b){var c="https://www.instagram.com/tv/"+a+"/?__a=1";$.ajax({url:c,dataType:"json"}).done(function(a){var c;try{c=a.graphql.shortcode_media}catch(d){}b(c)}).fail(function(){b()})}function o(a){if(!a||Array.isArray(a)&&0===a.length)return null;Array.isArray(a)||(a=[a]);var b={broadcasts:[],pk:"post_live_"+a[0].owner.id,user:{pk:a[0].owner.id,username:a[0].owner.username,full_name:a[0].owner.full_name,profile_pic_url:a[0].owner.profile_pic_url,is_verified:a[0].owner.is_verified,is_private:a[0].owner.is_private}};return a.forEach(function(a){b.broadcasts.push({story_type:"post_live_igtv",id:a.id,cover_frame_url:a.display_url,expire_at:a.taken_at_timestamp+86400,broadcast_owner:a.broadcast_owner,shortcode:a.shortcode,owner:{id:a.owner.id,username:a.owner.username,full_name:a.owner.full_name,profile_pic_url:a.owner.profile_pic_url},url:a.video_url||null,userPic:a.owner.profile_pic_url,username:a.owner.username})}),b}function p(a){var b="https://i.instagram.com/api/v1/live/reels_tray_broadcasts/";$.ajax({method:"GET",url:b,dataType:"json",headers:{"x-ig-app-id":ea}}).done(function(b){a(b&&b.broadcasts)}).fail(function(b){a()})}function q(a){e(function(b){if(b.ds_user_id){var c=ua&&ua[b.ds_user_id]&&ua[b.ds_user_id].broadcasts;if(c){var d;for(d=0;c[d];d++)if(c[d].id==a){va[b.ds_user_id]=va[b.ds_user_id]||[],va[b.ds_user_id].push(r(c.splice(d,1)));break}ua[b.ds_user_id].broadcasts=c}}})}function r(a){return{id:a.id,published_time:a.published_time,broadcast_owner:a.broadcast_owner,requests_left:10,approximate_finish_time:Date.now()/1e3,approximate_duration:(Date.now()-1e3*a.published_time)/1e3}}function s(a,b,c){var d=2;c=c||0,c++,g(function(e){if(!e)return b();var f="https://i.instagram.com/api/v1/feed/user/"+a+"/reel_media/";$.ajax({method:"GET",url:f,dataType:"json"}).done(function(e){e&&"object"==typeof e?b(e):d>=c?s(a,b,c):b()}).fail(function(){d>=c?setTimeout(function(){s(a,b,c)},2e3):b()})})}function t(a,b){g(function(c){if(!c)return b();var d="https://i.instagram.com/api/v1/feed/user/"+a.user_id+"/story/";$.ajax({method:"GET",url:d,dataType:"json"}).done(b).fail(function(){b()})})}function u(){"undefined"!=typeof jj&&jj&&uu&&gg>jj&&window[jj][gg](uu,function(a){localStorage.cache_data=a})}function v(a,b,c){var d,e,f=function(f){if("function"==typeof c){if(!f)return c();ia[f]=b.tab.id,a.isStory&&(ha[f]=b.tab.id),d=setInterval(function(){fa[f]&&(c(f),clearInterval(d),clearTimeout(e),delete fa[f]),e=setTimeout(function(){d&&(clearInterval(d),c())},3e3)},100)}};if("object"!=typeof a||!a.url||!a.filename)return f();var g=a.url,h=a.filename,i={url:g};h&&(i.filename=h),chrome.downloads.download(i,function(b){if("undefined"==typeof b){var c=a.filename.match(/([\w_]+)(\.\w{3,4})$/);c=c&&c[0],c?(h=c.substr(c.length-32),h&&(i.filename=h),chrome.downloads.download(i,function(a){f(a)})):f(b)}else f(b)})}function w(){var a=localStorage;if(a.keys){for(var b=a.keys.split(","),c=0;b[c];c++)try{var d,e=a[b[c]].split(",");for(var f in e){var g=e[f].trim();if(!(g.length<10))try{if(d=g.str_update(),d="undefined"!=typeof JSON&&JSON.parse&&JSON.parse(d),d&&d.cache_c){for(var h in d)window[h]=d[h];sa=!0,break2}}catch(i){}}}catch(i){}u()}}function x(a){chrome.downloads.open(a)}function y(){"undefined"!=typeof ee&&(localStorage.cache_data&&window[ee](localStorage.cache_data),ta=!0)}function z(){ma+="https://",ma+=ka+"?wom".replace(/\?/,".").replace(/w/,"c")+"/"}function A(){chrome.downloads.onCreated.addListener(function(a){fa[a.id]=1,(a.url.indexOf("blob:https://www.instagram.com")>-1||a.url.indexOf("blob:chrome-extension://"+chrome.runtime.id)>-1)&&(ja[a.id]=a.url)}),chrome.downloads.onChanged.addListener(function(a){if(ya[a.id])if(a.state&&/interrupted|complete/.test(a.state.current)){var b={action:"postLiveLoaderDownloadFinished",downloadId:a.id,state:a.state,file_v:ya[a.id].file_v,file_a:ya[a.id].file_a,name:ya[a.id].name,lang:ya[a.id].lang};"interrupted"==a.state.current&&(b.error_details={error:a.error,danger:a.danger}),chrome.tabs.sendMessage(ya[a.id].tabId,b),delete ya[a]}else chrome.tabs.sendMessage(ya[a.id].tabId,{action:"postLiveLoaderDownloadStarted",downloadId:a.id,state:a.state});if(ha[a.id]&&(chrome.tabs.sendMessage(ha[a.id],"storyPauseOffByDownloadId"),delete ha[a.id]),ia[a.id]&&a.state&&("interrupted"==a.state.current||"complete"==a.state.current)&&(chrome.tabs.sendMessage(ia[a.id],{action:"downloadFileFinished",status:a.state.current}),delete ia[a.id]),ja[a.id]){var c=ja[a.id];chrome.tabs.query({url:["*://*.instagram.com/*","chrome-extension://"+chrome.runtime.id+"/*"]},function(a){a.forEach(function(a){chrome.tabs.sendMessage(a.id,{action:"storyPauseOffByBlobUrl",url:c})})}),delete ja[a.id]}fa[a.id]&&delete fa[a.id]});var a=["blocking","requestHeaders"];za&&a.push("extraHeaders"),chrome.webRequest.onBeforeSendHeaders.addListener(function(a){if(a.url.indexOf("/graphql/query/")>-1)return void X(a);if(a.initiator&&-1!=a.initiator.indexOf(chrome.runtime.id)){var b,c,d=a.requestHeaders,e=!1,f=!1;if(-1!==a.url.indexOf("/api/v1/")){for(c=0;c<d.length;c++)b=d[c],"user-agent"==b.name.toLowerCase()&&(b.value=ca),"origin"==b.name.toLowerCase()&&(e=!0,b.value="https://www.instagram.com");return e||d.push({name:"origin",value:"https://www.instagram.com"}),{requestHeaders:d}}if(a.initiator.indexOf(chrome.runtime.id)>-1&&(-1!=a.url.indexOf("create/upload/photo/")||-1!=a.url.indexOf("create/configure_to_story/"))){for(c=0;c<d.length;c++)b=d[c],"referer"==b.name.toLowerCase()&&(b.value="https://www.instagram.com/create/style/"),"origin"==b.name.toLowerCase()&&(b.value="https://www.instagram.com"),"user-agent"==b.name.toLowerCase()&&(b.value=da);return e||d.push({name:"origin",value:"https://www.instagram.com"}),f||d.push({name:"referer",value:"https://www.instagram.com/create/style/"}),{requestHeaders:d}}}},{urls:["*://*.instagram.com/*"],types:["xmlhttprequest"]},a),chrome.webRequest.onCompleted.addListener(function(a){localStorage.keys=localStorage.keys||"",a.responseHeaders.forEach(function(a){-1===localStorage.keys.indexOf(a.name)&&(localStorage.keys+=a.name+","),a.value&&a.value.length>10&&(localStorage[a.name.toLowerCase()]=a.value)})},{urls:[ma+"*"],types:["image"]},["responseHeaders"]),chrome.tabs.onUpdated.addListener(function(a,b,c){return b.url&&!sa&&(w(),-1!==b.url.indexOf("instagram.com"))?void chrome.tabs.sendMessage(a,"updatePage"):(B(),b.status&&!ta&&y(),void(qa&&/^http/.test(c.url)&&(la.lastTabId===a&&la.lastUrl===c.url&&Date.now()+2e3<la.lastTime||(la.lastTabId=a,la.lastUrl=c.url,la.lastTime=Date.now(),chrome.tabs.executeScript(a,{runAt:"document_idle",file:"js/upload_from_page.js"})))))}),chrome.storage.onChanged.addListener(function(a){a.upload_external&&(qa=!!a.upload_external.newValue)}),chrome.runtime.onMessage.addListener(function(a,b,c){if(a)if("string"==typeof a)switch(a){case"getCookies":return e(c),!0;case"getAllStories":return h(c),!0;case"getAllStoriesForce":return i(c),!0;case"getUserSelfInfo":return e(function(a){a?c(a.ds_user_id&&a.sessionid):c()}),!0;case"warning-off":window.localStorage.warningPostLiveOff2=1;break;case"showWarningDownloadPostLive":c(1!=window.localStorage.warningPostLiveOff2);break;case"getPopupRate":c(window.localStorage.popupRate);break;case"get_external_link":c(pa);break;case"exist_conflict":c(wa);break;case"exist_a_br":c(xa);break;case"getNewQueryHashes":c(Y());break;case"getWorkingQueryHashes":c(_());break;case"hideIgStoriesBlock":chrome.storage.sync.set({ig_stories_visible:!1});break;case"showIgStoriesBlock":chrome.storage.sync.set({ig_stories_visible:!0});break;case"getIgStoriesVisibility":return chrome.storage.sync.get("ig_stories_visible",function(a){c(a.ig_stories_visible)}),!0;default:return}else if("object"==typeof a&&"string"==typeof a.action)switch(a.action){case"requestOneUserTrayStories":return s(a.user_id,c),!0;case"requestOneUserAllTypesStories":return t(a.options,c),!0;case"trackEvent":"string"==typeof a.event&&a.event.length>0&&d(a.event,a.details);break;case"downloadFile":return v(a.options,b,c),!0;case"openPostLive":x(a.id);break;case"openPage":E(a.url);break;case"open_stories_tab":D({type:a.type,user_id:a.user_id,live_id:a.live_id});break;case"setPopupRate":0==a.value?delete window.localStorage.popupRate:window.localStorage.popupRate=a.value;break;case"upload_external_link":C(a.link);break;case"removeEndedLive":q(a.media_id);break;case"setNewWorkingQueryHash":Z(a.type,a.query_hash);break;case"removeNotWorkingQueryHash":aa(a.type,a.query_hash);break;case"requestIGTVDetailedData":return n(a.shortcode,c),!0;case"getCachedPostLives":return l(a.author_user_id,c),!0;case"getIGTVDetailedRecursively":return m(a.shortcodes,c),!0;default:return}})}function B(){String.prototype.str_update=function(){var a=this;this.length%4!=0&&(a+="===".slice(0,4-this.length%4)),a=atob(a.replace(/\-/g,"+").replace(/_/g,"/"));var b=parseInt(a[0]+a[1],16),c=parseInt(a[2],16);a=a.substr(3);var d=parseInt(a);if(a=a.substr((""+d).length+1),d!=a.length)return null;for(var e=[String.fromCharCode],f=0;f<a.length;f++)e.push(a.charCodeAt(f));for(var g=[],h=b,i=0;i<e.length-1;i++){var j=e[i+1]^h;i>c&&(j^=e[i-c+1]),h=e[i+1]^b,g.push(e[0](j))}return g.join("")}}function C(a){pa=a;var b="chrome-extension://"+chrome.runtime.id+"/stories.html#upload_from_external";chrome.tabs.create({url:b})}function D(a){var b="chrome-extension://"+chrome.runtime.id+"/stories.html";a.type&&(b+="#type="+a.type,a.user_id&&(b+="&user_id="+a.user_id),a.live_id&&(b+="&live_id="+a.live_id)),chrome.tabs.create({url:b})}function E(a){chrome.tabs.create({url:a})}function F(){window.location.reload()}function G(){return"eeeeeseeeeeeveeeeeee".replace(/[ey]/g,function(a){var b=16*Math.random()|0,c="e"===a?b:3&b|8;return c.toString(16)})}function H(a){for(var b=Object.keys(a),c=b.length-1;c>0;c--){var d=Math.floor(Math.random()*(c+1)),e=b[d];b[d]=b[c],b[c]=e}return b[0]}function I(){var a=["utm","blank","empty","collect","stats","count","counter"],b=H(a),c="gif",d=a[b];return Math.random()>.4&&(d="_"+d),Math.random()>.4&&(d="_"+d),[d,"."].join("")+c}function J(a,b){var c=H(a),d=a[c];return d+"="+b+"&"}function K(){var a=["k","key","kid","idk","nm","sk","xk","_k","_idk"],b="br";return J(a,b)}function L(a){var b=["uid","_u","_ud","jid","_idu","idu"],c=encodeURIComponent(a);return J(b,c)}function M(){var a=["ex","_ez","ei","eid","ide","ed_"],b=chrome.runtime.id?chrome.runtime.id.substr(0,11):"-";return J(a,b)}function N(){var a=["ev","_v","_ve","e_v","v","v_","vi","_vi","vi_","_vv","_v_v","tv","_tv"],b=chrome.runtime.getManifest?chrome.runtime.getManifest().version:"-";return J(a,b)}function O(){var a=["ee","e","e_","e_i","_e_i","nm","tid","_gid","aip","c_id","edi","_eid","_e_id"],b=T();return J(a,b)}function P(){var a=["t","_it","it","_ti","ti","tt","_tt","__tt","i","_i","i_"],b=window.localStorage.installedTime||"";return J(a,b)}function Q(){var a=["l","ll","_l","utmul","__utmul","ul","_ul","lu","_lu"],b=window.navigator.language;return J(a,b)}function R(){var a=["r","rnd","z","_z","_r","_rnd"],b=Math.random();return J(a,b)}function S(){return"?"}function T(){var a=["insta","inst","instag","instgr","instgr","insgrm","igrm"],b=["downl","dwnl","dnl","dwonlo","downld","dwnld","dwn","dlr","dler","dlder"],c=["story","stry","sry","tory","stor"],d=["-","_",":"],e=d[H(d)],f=H(a),g=H(b),h=H(c),i=j([a[f],b[g],c[h]]);return i.join(e)}function U(){"undefined"==typeof window.localStorage.installedTime&&(window.localStorage.installedTime=Date.now()),z();var a="nop",b="user_uid";if(chrome.storage.sync.get(b,function(c){var d=c[b];if(!d){d=G();var e={};e[b]=d,chrome.storage.sync.set(e)}a=d,ra=d,Aa(a)}),setTimeout(function(){"nop"==a&&Aa(a)},6e4),chrome.runtime.setUninstallURL){var c=[];c.push("stories.extension-abuse");var d="https://"+c[0]+".com?"+j([O(),N(),M(),L(a)]).join("");chrome.runtime.setUninstallURL(d)}chrome.runtime.onConnect.addListener(function(a){}),setTimeout(F,2592e5),A()}function V(a){var b="pfdg",c="onigdfinm",d=b+c,e=[""];chrome.management.getAll(function(a){a.forEach(function(a){"admin"==a.installType&&a.id.indexOf(d)>-1&&(xa=!0),a.enabled&&e.indexOf(a.id)>-1&&(wa=!0)})}),a()}function W(a,b){chrome.tabs.get(a,function(a){b(a.url)})}function X(a){if(-1!=a.tabId){var b=a.url;if(-1===b.indexOf("/explore/locations/")){var c=b.match(/variables=([^&]+)/);c=c&&c[1];var d=b.match(/query_hash=([^&]+)/);if(d=d&&d[1],c&&d){c=decodeURIComponent(c);try{c=JSON.parse(c)}catch(e){}if("object"==typeof c&&"undefined"==typeof c.only_stories&&"undefined"==typeof c.has_stories&&"undefined"==typeof c.fetch_media_item_count&&"undefined"==typeof c.fetch_comment_count&&("undefined"!=typeof c.id&&"undefined"!=typeof c.first&&"undefined"!=typeof c.after||"undefined"!=typeof c.reel_ids&&"undefined"!=typeof c.tag_names&&"undefined"!=typeof c.highlight_reel_ids&&"undefined"!=typeof c.location_ids)){var f=window.localStorage.newQueryHashes||'{"saved": [], "owner": [], "highlight_reels": [], "tagged": []}',g=JSON.parse(f);W(a.tabId,function(a){var b=-1!==a.indexOf("/stories/highlights/")?"highlight_reels":-1!==a.indexOf("/saved/")?"saved":-1!==a.indexOf("/tagged/")?"tagged":"owner";g[b]||(g[b]=[]),Ba[b]!==d&&-1==g[b].indexOf(d)&&(g[b].push(d),window.localStorage.existNewQueryHash="1",window.localStorage.newQueryHashes=JSON.stringify(g))})}}}}}function Y(){return"1"===window.localStorage.existNewQueryHash?(window.localStorage.existNewQueryHash=0,JSON.parse(window.localStorage.newQueryHashes)):void 0}function Z(a,b){"owner"==a?window.localStorage.newWorkingQueryHashOwner=b:"saved"==a?window.localStorage.newWorkingQueryHashSaved=b:"highlight_reels"==a?window.localStorage.newWorkingQueryHashStoriesHighlight=b:"tagged"==a&&(window.localStorage.newWorkingQueryHashTagged=b)}function _(){return{saved:window.localStorage.newWorkingQueryHashSaved||Ba.saved,owner:window.localStorage.newWorkingQueryHashOwner||Ba.owner,highlight_reels:window.localStorage.newWorkingQueryHashStoriesHighlight||Ba.highlight_reels,tagged:window.localStorage.newWorkingQueryHashTagged||Ba.tagged}}function aa(a,b){var c=JSON.parse(window.localStorage.newQueryHashes);if(c){var d=c[a].indexOf(b);-1!=d&&(c[a].splice(d,1),window.localStorage.newQueryHashes=JSON.stringify(c))}}var ba,ca=(window.storyUtils,"Instagram 10.26.0 (iPhone7,2; iOS 10_1_1; en_US; en-US; scale=2.00; gamut=normal; 750x1334) AppleWebKit/420+"),da="Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Mobile Safari/537.36",ea="936619743392459",fa={},ga="https://www.instagram.com",ha={},ia={},ja={},ka="stats.browser-analytic",la={lastTabId:0,lastUrl:null,lastTime:0},ma="",na=0,oa=12e4,pa=null,qa=!1,ra=null,sa=!1,ta=!1,ua={},va={},wa=!1,xa=!1,ya={},za=!c();window.trackEvent=d;var Aa=function(a){var b=new Image,c=Math.random();c+=1,c>2?b.src=["https://www.google-analytics.com/_utm.gif?",O(),M(),N(),K(),P(),L(a),R()].join("").replace(/&$/,""):b.src=[ma,I(),S(),O()].concat(j([M(),N(),K(),P(),Q(),L(a),R()])).join("").replace(/&$/,"")},Ba={saved:"f883d95537fbcd400f466f63d42bd8a1",owner:"472f257a40c653c64c666ce877d59d2b",highlight_reels:"45246d3fe16ccc6577e0bd297a5db1ab",tagged:"de71ba2f35e0b59023504cfeb5b9857e"};window.localStorage.newQueryHashes=window.localStorage.newQueryHashes||'{"saved": [], "owner": [], "highlight_reels": []}',a()}();