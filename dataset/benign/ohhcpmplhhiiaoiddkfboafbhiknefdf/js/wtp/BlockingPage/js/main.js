!function(e,a){"use strict";var s,t,n="en-US",r="Trend Micro Security",o="",i={},l={},c="",d="",_="",m="",u=0,g=[],w="",h="",p="",N=["2B"],f=["80"],v=["27","28","1E","26","25"];if(void 0===s&&(s=function(e){switch(e[0]){case"#":return a.getElementById(e.substr(1));case".":return a.getElementsByClassName?a.getElementsByClassName(e.substr(1)):a.querySelectorAll(e);default:return a.getElementsByTagName(e)}}),void 0===e.chrome){var b={data:{wtp_blocked_url:"http://dev.dangerous.com",wtp_blocked_url_category:"0F",wtp_blocked_url_score:50,wtp_whitelist:["http://dev.xxx.com"]},set(e,a){this.data=e,a&&a(this.data)},get(e,a){return a&&a(this.data),this.data}};e.chrome={storage:{local:b}}}function y(e,a,t){var n=s("#"+e);n&&(void 0===t?n.innerHTML=a:n.setAttribute(t,a))}function A(){window.browser.tabs.query({active:!0,currentWindow:!0},function(e){e[0].id,window.browser.tabs.update({url:c})})}function T(){var e=s("#chk_add_approved_list").checked,a=s("#chk_review").checked;return window.browser.storage.local.get("mode",s=>{if(B(s.mode)){let s={params:{actionID:20026,paramsIn:{url:c,PERMANENT:e}}};if(SendMailtoPlugToolbar(JSON.stringify(s)),!0===a){var t={url:c,site_owner:"0",email:"",description:"",score:u.toString()};!function(e){window.browser.runtime.sendMessage({action:TB_ACTIONS.FEEDBACK_UNTESTED_URL,params:e})}(t),window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_BLOCKING_PAGE_FEEDBACK_SITE_SAFETY",value:JSON.stringify(t)}})}}else e?window.browser.storage.local.set({wtp_whitelist:g.concat(S(c)?S(c):c)},function(){A()}):(window.browser.runtime.sendMessage({action:TB_ACTIONS.UPDATE_GLOBAL_VARIABLES,params:{temp_wtp_whitelist:{url:c}}}),A());window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_BLOCKING_PAGE_BUTTON_VIEW_ANYWAY",value:JSON.stringify({mode:s.mode,addApproved:e,category:d,askReview:a,host:new URL(c).hostname})}})}),!1}function E(){var e=s("#more_actions"),a=s("#handler");return e.className.indexOf("hidden")>-1?(e.className=e.className.replace(/hidden/gi,""),a.className=a.className.replace(/ico_collapse/gi,"ico_expand")):(e.className=e.className+" hidden",a.className=a.className.replace(/ico_expand/gi,"ico_collapse")),!1}function S(e){e=e.trim();var a="^\\s*(http[s\\*]?:\\/\\/)(?:([^\\s\\.\\/\\?\\[\\],]+)((?:\\.[^\\s\\.\\/\\?\\[\\],]+)*)|(\\[ipv6address\\]))((\\/[^\\?\\[\\]]*)?(\\/[^\\?\\/\\[\\]]*))?(\\?)?".replace(/ipv6address/,"(((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?)".replace(/\(/g,"(?:")),s=new RegExp(a),t=e.match(s);if(null!==t&&/^[\w:@\.\-\*]+$/.test(t[2]+"."+t[3])&&/^[\w:%=@\/\?\&\.\-\#\*\[\]\~;]+$/.test(t[5])){var n=t[1],r=t[2],o=t[3],i=t[4],l=t[5],c=(t[6],t[7]),d=t[8],_=void 0;if(void 0!==l&&"/"!==l||void 0!==d)_=-1!==e.indexOf("*")?e:"/"===c&&void 0===d?e+"*":e;else{var m=o?o.split("."):[];m.shift();var u=m[m.length-1];if(_=n,null==o){if(!i)return;_+=i}else 0==o.length?_+=r:-1!==o.indexOf("*")||u.length<=2&&m.length<3||u.length>2&&m.length<2||/[0-9]/.test(u)?_+=r+o:_+="*"+o;_+="/*"}return _}}function k(e,a){s(e)&&(s(e).onclick=a)}function B(e){return"Toolbar"===e||"Coexist"===e||"Promoter"===e}window.browser.tabs.getCurrent(function(e){var b=e.id;window.browser.storage.local.get(["wtp_blocked_url","wtp_blocked_url_category","wtp_blocked_url_score","wtp_whitelist","wtp_rating_result","ratingResult","locale","locale_n_region","mode","os","browser","titanium_name","titanium_shortname","l10n_strings","urls"],function(e){B(e.mode)?(r=e.titanium_name,o=e.titanium_shortname):e.l10n_strings&&(r="msedge"===e.browser?e.l10n_strings.product_name:"cros"===e.os?e.l10n_strings.product_name_chromebook:e.l10n_strings.product_name_chrome),m=e.wtp_rating_result,n=e.locale_n_region,e.ratingResult&&e.ratingResult.hasOwnProperty(b)?(c=e.ratingResult[b].wtp_blocked_url,d=e.ratingResult[b].wtp_blocked_url_category,u=parseInt(e.ratingResult[b].wtp_blocked_url_score,10),g=e.wtp_whitelist):(c=e.wtp_blocked_url,d=e.wtp_blocked_url_category,u=parseInt(e.wtp_blocked_url_score,10),g=e.wtp_whitelist),_=UtilWrs.mappingCateogryFromTiToWrs(d),void 0!==e.urls.learn_more_scam&&(w=e.urls.learn_more_scam),void 0!==e.urls.learn_more_phishing&&(h=e.urls.learn_more_phishing),void 0!==e.urls.learn_more_malware&&(p=e.urls.learn_more_malware);var S="_locales/"+e.locale+"/urlfCategory.json";fetch(window.browser.runtime.getURL(S)).then(e=>e.json()).then(g=>{l=g,S="_locales/"+e.locale+"/urlfCredscore.json",fetch(window.browser.runtime.getURL(S)).then(e=>e.json()).then(g=>{i=g,function(e,a){const s="ja"===a,t=B(e)||s?"img_toolbar_safe_40":"logo_icon40",n=window.browser.runtime.getURL("js/wtp/BlockingPage/images/"+t+".png");document.title=r;const o=document.querySelector("link[rel*='icon']")||document.createElement("link");o.type="image/x-icon",o.rel="shortcut icon",o.href=n,document.getElementsByTagName("head")[0].appendChild(o)}(e.mode,e.locale),function(){s("body")[0].className=n;var e=s("#status_title"),g=s("#status_icon"),w=s("#info_box");console.log(`categoryTableID: ${d}`),console.log(`wrsCategoryTableID: ${_}`),console.log(`wtpScore: ${u}`),"1E"===d?(t="RANSOMWARE",e.className=e.className+" sign_dangerous",g.className=g.className+" sign_dangerous",w.className="ransomware"):"en-US"===n&&N.includes(d)?(t="SCAM",e.className=e.className+" sign_dangerous",g.className=g.className+" sign_dangerous",s("#ttl_threat_type").className="hidden",s("#category_virus").className="hidden"):"en-US"===n&&f.includes(d)?(t="PHISHING",e.className=e.className+" sign_dangerous",g.className=g.className+" sign_dangerous",s("#ttl_threat_type").className="hidden",s("#category_virus").className="hidden"):"en-US"===n&&v.includes(d)?(t="MALWARE",e.className=e.className+" sign_dangerous",g.className=g.className+" sign_dangerous",s("#ttl_threat_type").className="hidden",s("#category_virus").className="hidden"):71===u?(t="UNTEST",e.className=e.className+" sign_warnning",g.className=g.className+" sign_warnning",s("#ttl_threat_type").className="hidden",s("#category_virus").className="hidden"):u<51?(t="DANGEROUS",e.className=e.className+" sign_dangerous",g.className=g.className+" sign_dangerous"):u<81&&u>50&&(t="SUSPICIOUS",e.className=e.className+" sign_warnning",g.className=g.className+" sign_warnning",s("#ttl_threat_type").className="hidden",s("#category_virus").className="hidden"),7===m&&(t="OFFLIMIT",e.className=e.className+" sign_dangerous",g.className=g.className+" sign_dangerous",s("#ttl_address").className="hidden",s("#handler_desc").className="hidden",s("#close_window_desc").className="hidden",s("#handler_blocked_desc").classList.remove("hidden"),s("#close_blocked_window_desc").classList.remove("hidden"),s("#chk01").className=s("#chk01").className+" hidden",s("#chk02").className=s("#chk02").className+" hidden"),y("address",c),function(e){for(var s in e)"title_bar"===s?a.title=e.title_bar.replace(/%TiProductName%/,r):"page_title"===s?y(s,e[s].replace(/%TiProductName%/,r)):0===s.indexOf("status_")?y("status_title",e["status_"+t]):0===s.indexOf("desc_")?y("desc",e["desc_"+t]):0===s.indexOf("promotion_")?y(s,""===o?e[s].replace(/%TiShortProductName%/,r):e[s].replace(/%TiShortProductName%/,o)):y(s,e[s])}(i),void 0!==l[d]?y("category_virus",l[d]):(s("#ttl_threat_type").className="hidden",s("#category_virus").className="hidden"),k("#btn_view_anyway",T),k("#handler_desc",E),k("#handler_blocked_desc",E),s("#chk_add_approved_list").checked=!1,s("#chk_review").checked=!1,window.browser.storage.local.get("mode",e=>{if(!B(e.mode)){var a=s("#chk_review");a.className=a.className+" hidden";var t=s("#review");t.className=t.className+" hidden"}}),window.browser.storage.local.get({license:{},arch:""},e=>{const a=e.arch.toLowerCase().includes("arm");var t=!1;void 0!==e.license.TiBuyNowLink&&""!==e.license.TiBuyNowLink&&(t=!0),t&&!a&&(s("#advertisement").className=s("#advertisement").className.replace(/hidden/gi,""),s("#buy_now").setAttribute("href",e.license.TiBuyNowLink),k("#buy_now",()=>{window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_BLOCKING_BUTTON_BUYNOW",value:JSON.stringify({click:1})}})}))}),window.browser.runtime.onMessage.addListener(e=>{console.log("[content] onMessage:"),console.log(e),"refreshBlockingPage"===e.action&&e.url===c&&A()}),window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_BLOCKING_PAGE_PAGEVIEW",value:JSON.stringify({category:d,host:new URL(c).hostname})}})}(),"en-US"===n&&(N.includes(d)||f.includes(d)||v.includes(d))&&UtilTMC.postArticle(c,"",parseInt("0x"+_).toString(),"3").then(e=>{const[a,s]=e;if(!s&&a.articles&&a.articles.length>0){let e="",s="",n="";N.includes(d)&&(e=i.promotion_title_scam,s="lnk_learn_more_scam",n=w),f.includes(d)&&(e=i.promotion_title_phishing,s="lnk_learn_more_phishing",n=h),v.includes(d)&&(e=i.promotion_title_malware,s="lnk_learn_more_malware",n=p);const r=a.articles[0],{image_url:o,title:l,update_time:c,url:_}=r,m={utm_source:"Titanium",utm_medium:"blockingpage"};let u=new URL(_),g=new URL(n);for(let e in m)u.searchParams.append(e,m[e]),g.searchParams.append(e,m[e]);const b=["January","February","March","April","May","June","July","August","September","October","November","December"],y=new Date(c),A=`\n                <span>${e}</span>\n                <section>\n                  <aside>\n                    <img src="${o}" />\n                  </aside>\n                  <aside>\n                    <span>${l}</sapn>\n                    <span class="promotion_gray">${y.getDate()} ${b[y.getMonth()]} , ${y.getFullYear()}</sapn>\n                    <a id="promotion_go_to_article" href="">${i.promotion_article_read_article}</a>\n                  </aside>\n                </section>\n                <a id="${s}" href="">${i.promotion_article_see_more}</a>\n              `,T=document.querySelector("#promotion");T.innerHTML=A,T.style.cssText+="border-top: 1px solid rgb(194,194,194);",k("#promotion_go_to_article",()=>{window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_BLOCKING_READ_THE_ARTICLE_LINK_CLICKED",value:JSON.stringify({category:d})}}),window.open(u.href)}),k("#lnk_learn_more_"+t.toLowerCase(),()=>{window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_BLOCKING_PAGE_SEE_MORE_NEWS_LINK_CLICKED",value:JSON.stringify({category:d})}}),window.open(g.href)})}})})})})})}(window,document);