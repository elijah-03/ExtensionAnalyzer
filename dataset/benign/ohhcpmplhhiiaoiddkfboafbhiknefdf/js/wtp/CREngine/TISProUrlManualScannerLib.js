!function(){var t=window,e={gOnRatingTimer:null,gMouseLeaveFlag:1,gCurrentEvent:null,gCurrentTarget:null,gCurrentNode:null,gUrlMap:[],gDoc:null,gToolTip:null,gLinkNum:-1,gLastLink:null,gIntervalThread:null,gTooltipTimeout:0,gDocGuid:null,getCurrentTarget:function(){return this.gCurrentTarget},setCurrentTarget:function(t){this.gCurrentTarget=t},isEditable:function(){var t=TMExt_$("body").attr("contenteditable"),e="on"===document.designMode||""===t||"true"===t,n=TMExt_$("body#punymce").length>0,r=TMExt_$("body#tinymce").length>0;return e||n&&!0===n||r&&!0===r},getCurrentNode:function(){return this.gCurrentNode},setCurrentNode:function(t){this.gCurrentNode=t},getUrlMapLenth:function(){return this.gUrlMap.length},getUrlMapValueByKey:function(t){return this.gUrlMap[t]},getUrlMapValueByIndex:function(t){return this.gUrlMap[t]},setUrlMapValue:function(t,e){this.gUrlMap[t]=e},pushUrlMapValue:function(t){this.gUrlMap.push(t)},getDocument:function(){return this.gDoc},setDocument:function(t){this.gDoc=t},getToolTip:function(){return this.gToolTip},setToolTip:function(t){this.gToolTip=t},canHookLink:function(t,e){return(t!==this.gLinkNum||e!==this.gLastLink)&&(this.gLinkNum=t,this.gLastLink=e,!0)},callbackFromDoc:function(e,n){this.isEditable()||t.UMSInsertResultICON(this,e,n)},isValidUrl:function(t){var e=encodeURI(t);return!!e.match(/^(https?|ftps?):\/\/([\w%\-]+\.)+[\w%\-]+(\/[\w\- .\/?%&=]*)?/i)||(TMExt_debug(e+" is invalid url"),!1)},isUrlRated:function(t){for(var e=0;e<this.getUrlMapLenth();++e)if(t==this.getUrlMapValueByIndex(e))return!0;return TMExt_debug(t+" has not be rated."),this.pushUrlMapValue(t),!1},getLocalUrlRule:function(){for(var t="^https?://(.*)",e=document.location.hostname.split("."),n=e.length<5?2===e.length?2:e.length-1:3;n>0;--n)t+="\\."+e[e.length-n];return t},isRated:function(t){var e=!1;if("TSRSpan"!==t.prev().attr("class")&&"TSRSpan"!==t.parent().prev().attr("class")||(e=!0),!0!==e)for(var n=t.children(),r=0;r<n.length;++r)if("TSRSpan"===TMExt_$(n[r]).attr("class")){e=!0;break}return!0===e&&TMExt_debug("It is a Rated link"),e}};t.g_manual_rating=e;var n={UMS_SEND_DATA_EVENT:"UMSSendDataEvent",UMS_EVENT_ID:"UMSSendDataEventElement",UMS_TAG_NAME:"UMSDataElement",UMS_IEObject:null,D_TOOLBAR_CALLBACK_ACTIVEX_PROG_ID:"ProToolbarIMRatingActiveX.ToolbarCB",init:function(){n.createElement()},createElement:function(){if(document.getElementById(n.UMS_EVENT_ID))return document.getElementById(n.UMS_EVENT_ID);var t=document.createElement(n.UMS_TAG_NAME);return t.id=n.UMS_TAG_NAME,t.style.display="None",document.documentElement.appendChild(t),t},call:function(t){var r=n.createElement();if(r){r.setAttribute("data",t),r.setAttribute("docguid",e.gDocGuid);var o=document.createEvent("Event");o.initEvent(n.UMS_SEND_DATA_EVENT,!0,!1),r.dispatchEvent(o)}else TMExt_debug("start ToolbarInvoke url="+t),n.UMS_IEObject.ToolbarInvoke({Action:5,URL:t,HTMLDocument:document})}};function r(){n.init(),t.UMSCreateTooltip();const r=t=>{let e="";try{e=t?decodeURI(t):""}catch(t){TMExt_debug("tryDecodeURI: e = "+t)}return e},o=t=>{let e="";try{e=t?encodeURI(t):""}catch(t){TMExt_debug("tryEncodeURI: e = "+t)}return e},i=(i,a)=>{a.UMSMouseEnterEventHandler&&a.UMSMouseEnterEventHandler||(a.UMSMouseEnterEventHandler=!0,TMExt_$(a).mouseenter(()=>{(i=>{try{var a=TMExt_$(i);if(e.isRated(a))return;var u=(t=>{let e="";try{do{if(e=r(t),e)break;if(e=o(t),e)break;e=t}while(0)}catch(t){TMExt_debug("tryGetURI: e = "+t),e=""}return e})(a[0].href);if(!u)return void TMExt_debug("just return: href is null");if(console.log("mouseenter href = "+u),u=t.TSTrim(u),!e.isValidUrl(u))return TMExt_debug("just return: href is invalid:"+u),void e.setCurrentNode(null);e.setCurrentTarget(a),e.setDocument(document),e.setCurrentNode(u),e.gMouseLeaveFlag=1;var l=t.g_iUMSToolTipTimeout&&t.g_iUMSToolTipTimeout>0?t.g_iUMSToolTipTimeout:2e3;e.gOnRatingTimer=setTimeout(function(){TMExt_debug("timeout start rating"),e.gOnRatingTimer=0,e.gCurrentEvent=a[0],n.call(u)},l)}catch(t){TMExt_debug(t)}})(a)})),a.UMSMouseLeaveEventHandler&&a.UMSMouseLeaveEventHandler||(a.UMSMouseLeaveEventHandler=!0,TMExt_$(a).mouseleave(()=>{(()=>{try{e.gOnRatingTimer?(TMExt_debug("clear rating time out"),clearTimeout(e.gOnRatingTimer),e.gOnRatingTimer=0):(t.UMSSetToolTipHideTimer(),e.gMouseLeaveFlag=0,e.setCurrentNode(null))}catch(t){TMExt_debug(t)}})()}))};TMExt_$("a").each(i),TMExt_$("iframe").each((t,e)=>{$("iframe").contentWindow.location.href.includes("mail.yahoo.co.jp")&&e.contentDocument&&TMExt_$(e.contentDocument).contents().find("a").each(i)})}function o(){try{r(),0==e.gMouseLeaveFlag&&t.UMSSetToolTipHideTimer()}catch(t){TMExt_debug(t)}}t.Communicator=n;const i=()=>{e.isEditable()||(TMExt_debug("manual rating document.ready TMExt_UMS_Start"),o(),setInterval(o,2e3))};try{TMExt_$(document).ready(i)}catch(t){"undefined"!=typeof console&&void 0!==console.log&&console.log("TMExt_$(document) in TISProUrlManualScannerLib.js Error"+t)}}();