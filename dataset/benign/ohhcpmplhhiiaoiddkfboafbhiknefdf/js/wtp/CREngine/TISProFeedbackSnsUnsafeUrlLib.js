function findFacebookObj(e){for(var t=1,a=TMExt_$(e).parent();!a.hasClass("userContentWrapper")&&t<10;)t++,a=a.parent();return a.hasClass("userContentWrapper")?a:null}function findTwitterObj(e){for(var t=1,a=TMExt_$(e).parent();!a.hasClass("tweet")&&!a.hasClass("ProfileTweet")&&t<10;)t++,a=a.parent();return a.hasClass("tweet")||a.hasClass("ProfileTweet")?a:null}function TSNSFeedbackUnsafeURL(e){if(IsInSNSandRequiredForThisLevel(e))try{if(/x\.com/.test(document.location)){PSDebug.log("in TSNSFeedbackUnsafeURL");var t,a,r,n=findTwitterObj(S=e.FindInsertNode());if(!n)return;if(n.hasClass("tweet"))q=n.find("._timestamp").attr("data-time"),r=n.find(".tweet-text");else{if(!n.hasClass("ProfileTweet"))return;q=n.find(".js-short-timestamp").attr("data-time"),r=n.find(".ProfileTweet-text")}t=r.attr("lang"),a=r.text().trim().replace(new RegExp(String.fromCharCode(160),"gi"),"");var i,d=n.attr("data-tweet-id"),o=n.attr("data-screen-name"),l=n.attr("data-user-id"),s=!!n.attr("data-has-cards")+"",c=n.attr("data-you-follow"),u=n.attr("data-you-block"),f=n.attr("data-retweet-id"),b=n.attr("data-retweeter"),h=n.find(".js-retweet-text a.js-user-profile-link").attr("data-user-id"),m=n.attr("data-mentions")||"",p=TMExt_$(S).attr("data-expanded-url"),g=!!n.attr("data-protected")+"",T=r.find("a[data-query-source='hashtag_click'] b");if(T.length){i=[];for(var w=0;w<T.length;w++)i.push(TMExt_$(T[w]).text())}var v=e.level,x=e.link;PSDebug.log("check data-tweet-id:",d),d&&(PSDebug.log("do feedback "),SendMailtoPlugToolbar(JSON.stringify({params:{actionID:20001,paramsIn:{webSite:"twitter",url:[x],urlLevel:[v],dataTweetId:d,dataScreenName:o,dataUserID:l,dataHasCards:s,dataYouFollow:c,dataYouBlock:u,dataMentions:m.split(" "),dataReScreenName:b,dataReTweetId:f,dataReTweeterUserId:h,dateTime:q,lang:t,text:a,dataExpendUrl:[p],hashTag:i,dataProtect:g}}})))}else if(/facebook\.com/.test(document.location)){var S,C=findFacebookObj(S=e.FindInsertNode());if(!C)return;var k=C.find("a[data-hover='tooltip']:eq(0)").attr("aria-label"),I=C.find("h5 a:eq(0),h6 a:eq(0)").text(),P=C.find("h5 a:eq(0),h6 a:eq(0)").attr("href"),N=C.find("h5 a:eq(1),h6 a:eq(1)").text()||C.find(".userContent .userContentSecondary a").text(),q=C.find("abbr").attr("data-utime"),F=C.find(".userContent").text();if("公開"!=k&&"公开"!=k&&"public"!=k&&"Public"!=k)return;v=e.level,x=e.link,q&&(PSDebug.log("do feedback "),SendMailtoPlugToolbar(JSON.stringify({params:{actionID:20001,paramsIn:{webSite:"facebook",url:[x],accountName:I,accountLink:P,accessPrivilege:k,dateTime:q,userContent:F,urlLevel:[v],place:N}}})))}}catch(e){if(e.number&&e.description){var M="catch err:[\n";M+="Facility Code: "+(e.number>>16&8191)+"\n",M+="Number: "+(65535&e.number)+"\n",M+="Description: "+e.description+"\n",TMExt_debug(M)}else TMExt_debug(e)}}function IsInSNSandRequiredForThisLevel(e){if(3!=e.level&&5!=e.level&&7!=e.level&&8!=e.level)return!1;var t=!1;try{(/facebook\.com/.test(document.location)||/x\.com/.test(document.location))&&(t=!0)}catch(e){TMExt_debug(e)}return t}