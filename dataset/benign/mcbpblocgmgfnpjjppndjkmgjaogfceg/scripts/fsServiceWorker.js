/**
* @license FireShot - Webpage Screenshots and Annotations
* Copyright (C) 2007-2025 Evgeny Vokilsus (contacts@getfireshot.com)
*/

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="32645bf6-9484-56df-beeb-4c9335d64e31")}catch(e){}}();
(()=>{function q(e,t){return de.getOption(e,t)}function G(e,t){de.setOption(e,t+"")}var de={storage:{},onChanged:{listeners:[],addListener(e){this.listeners.indexOf(e)===-1&&this.listeners.push(e)},removeListener(e){this.listeners=this.listeners.filter(t=>t!==e)},notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch{}})}},initPromise:null,inited:!1,onInit:null,assignOptions:function(e){this.storage={...this.storage,...e},chrome.storage.local.set(e)},ensureLoaded:function(){return this.initPromise=this.initPromise||new Promise(e=>{chrome.storage.onChanged.addListener((n,o)=>{if(o==="local"){let a=Object.keys(n);for(let c of a)this.storage[c]=n[c].newValue;this.inited&&this.onChanged.notifyListeners(n)}});let t=n=>{this.inited=!0,n&&(this.storage=n),this.onInit?this.onInit().then(()=>this.onInit=null).finally(e):e()};chrome.storage.local.get(null,n=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError),n?t(n):(console.log("chrome.storage.local.get failed to obtain preferences"),setTimeout(()=>chrome.storage.local.get(null,a=>{!a&&console.log("chrome.storage.local.get failed to obtain preferences for the second time"),t(a)}),500))})}),this.initPromise},setOption:function(e,t){if(!this.inited)console.error(`Preferences were not initialized yet! (setOption(${e}))`);else{var n={};n[e]=t,chrome.storage.local.set(n),this.storage[e]=t}},getOption:function(e,t){if(!this.inited)console.error(`Preferences were not initialized yet! (getOption(${e}))`);else return typeof this.storage[e]>"u"?t:this.storage[e]}};var y={Y:0,E:1,Pe:2,De:3,Oe:4,Re:5,Me:7,Fe:8,I:10,Ne:11,T:12,se:13,Le:100,ce:101,m:0,i:1,k:2,B:3,O:4,_t:268435456,ue:8192,le:"lastAction",fe:"lastMode",Be:"enableAPI",de:"fsDebug",$e:"errorReporting",Ue:"notifyOnUpdates",R:!1,St:"disableWASMWorker",Ke:"allTabsCaptureOnlyVisiblePart",t:"pluginProMode",p:"registeredMode",g:"curVersion",Et:"curVersion1",M:"filenameTemplate",v:"filenameNumber",U:"filenameNumberPadCheck",K:"filenameNumberPadValue",j:"filenameMaxLen",je:"contextMenuIntegration",He:"pageScrollSpeedValue",It:"allowInfiniteScrolling",xt:"sendUsageDataToGA",Ve:"newTabIsNextToSource",We:"screenshotDelay",Tt:"defaultFolderLite",kt:"FireShot",Ge:"openFolderAfterSavingLite",Ct:"noFilenamePrompt",At:"closeTabAfterSavingLite",Pt:"batchModePrefs",ze:"historyRetainPeriod",pe:"notifyOnUpdates",Dt:"captureTimeLimit",Je:"nativeFetchErrorCntr-",H:"uCheck",C:"uEmit",Ye:"https://ssl.getfireshot.com/images/api/utm.gif?dummy:",Ot:"canBeCapturedBetterNextShow",he:"errorFilter",Xe:"https://ssl.getfireshot.com/sentry-filter-%VERSION%.csv",me:"onlyLite",Rt:"nativeInstall",Mt:"userLikedFireShot",Ft:"userRatedFireShot",Nt:"resultPageShown",Lt:"WASMErrorReported",Bt:"nextAdShownTime",a:"guid",X:1296e6,qe:2592e5,q:432e5,Qe:1e4,$t:"png",ge:"queuedBadgeURL.1",Ut:"showSelectionHint.1",Kt:"advancedFeaturesAvailable",jt:"showAdvertising",Ht:"betaPreviewWarningExpanded",Vt:"betaPreviewCompactMode",Wt:"PDFOptionsEverDisplayed",ye:"regUserCorrected",ve:"regKeyCorrected",b:"regUser",u:"regKey",Q:"taskProgressValue",Gt:"https://ssl.getfireshot.com/images/api/chromefeatures.gif?dummy:",be:"FireShot Capture %n - %t - [%e]",zt:"https://getfireshot.com/downloads/%VERSION%/fireshot-chrome-plugin.exe",Ze:"https://screenshot-program.com/fireshot/crash_report.php",F:"captureState",A:"nativeHostReady",Z:"resumeMenuEnabled",Jt:"disableSelectionImprovements",o:"t",N:"te",we:"checksum",et:1,_e:0,_:1,f:2,Yt:4,P:8,V:16};var kt=(function(e){let t=Object.prototype.toString;function n(r){switch(t.call(r)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return S(r,Error)}}function o(r,i){return t.call(r)===`[object ${i}]`}function a(r){return o(r,"ErrorEvent")}function c(r){return o(r,"DOMError")}function u(r){return o(r,"DOMException")}function d(r){return o(r,"String")}function p(r){return typeof r=="object"&&r!==null&&"__sentry_template_string__"in r&&"__sentry_template_values__"in r}function m(r){return r===null||p(r)||typeof r!="object"&&typeof r!="function"}function g(r){return o(r,"Object")}function v(r){return typeof Event<"u"&&S(r,Event)}function _(r){return typeof Element<"u"&&S(r,Element)}function D(r){return o(r,"RegExp")}function w(r){return!!(r&&r.then&&typeof r.then=="function")}function E(r){return g(r)&&"nativeEvent"in r&&"preventDefault"in r&&"stopPropagation"in r}function S(r,i){try{return r instanceof i}catch{return!1}}function T(r){return!!(typeof r=="object"&&r!==null&&(r.__isVue||r._isVue))}function C(r,i=0){return typeof r!="string"||i===0||r.length<=i?r:`${r.slice(0,i)}...`}function k(r,i){if(!Array.isArray(r))return"";let s=[];for(let l=0;l<r.length;l++){let f=r[l];try{T(f)?s.push("[VueViewModel]"):s.push(String(f))}catch{s.push("[value cannot be serialized]")}}return s.join(i)}function P(r,i,s=!1){return d(r)?D(i)?i.test(r):d(i)?s?r===i:r.includes(i):!1:!1}function A(r,i=[],s=!1){return i.some(l=>P(r,l,s))}function U(r,i,s=250,l,f,h,b){if(!h.exception||!h.exception.values||!b||!S(b.originalException,Error))return;let I=h.exception.values.length>0?h.exception.values[h.exception.values.length-1]:void 0;I&&(h.exception.values=H(V(r,i,f,b.originalException,l,h.exception.values,I,0),s))}function V(r,i,s,l,f,h,b,I){if(h.length>=s+1)return h;let R=[...h];if(S(l[f],Error)){j(b,I);let K=r(i,l[f]),Y=R.length;B(K,f,Y,I),R=V(r,i,s,l[f],f,[K,...R],K,Y)}return Array.isArray(l.errors)&&l.errors.forEach((K,Y)=>{if(S(K,Error)){j(b,I);let J=r(i,K),ce=R.length;B(J,`errors[${Y}]`,ce,I),R=V(r,i,s,K,f,[J,...R],J,ce)}}),R}function j(r,i){r.mechanism=r.mechanism||{type:"generic",handled:!0},r.mechanism={...r.mechanism,...r.type==="AggregateError"&&{is_exception_group:!0},exception_id:i}}function B(r,i,s,l){r.mechanism=r.mechanism||{type:"generic",handled:!0},r.mechanism={...r.mechanism,type:"chained",source:i,exception_id:s,parent_id:l}}function H(r,i){return r.map(s=>(s.value&&(s.value=C(s.value,i)),s))}let F="8.18.0",N=globalThis;function L(r,i,s){let l=s||N,f=l.D=l.D||{},h=f[F]=f[F]||{};return h[r]||(h[r]=i())}let z=N,$=80;function X(r,i={}){if(!r)return"<unknown>";try{let s=r,l=5,f=[],h=0,b=0,I=" > ",R=I.length,K,Y=Array.isArray(i)?i:i.keyAttrs,J=!Array.isArray(i)&&i.maxStringLength||$;for(;s&&h++<l&&(K=te(s,Y),!(K==="html"||h>1&&b+f.length*R+K.length>=J));)f.push(K),b+=K.length,s=s.parentNode;return f.reverse().join(I)}catch{return"<unknown>"}}function te(r,i){let s=r,l=[];if(!s||!s.tagName)return"";if(z.HTMLElement&&s instanceof HTMLElement&&s.dataset){if(s.dataset.sentryComponent)return s.dataset.sentryComponent;if(s.dataset.sentryElement)return s.dataset.sentryElement}l.push(s.tagName.toLowerCase());let f=i&&i.length?i.filter(b=>s.getAttribute(b)).map(b=>[b,s.getAttribute(b)]):null;if(f&&f.length)f.forEach(b=>{l.push(`[${b[0]}="${b[1]}"]`)});else{s.id&&l.push(`#${s.id}`);let b=s.className;if(b&&d(b)){let I=b.split(/\s+/);for(let R of I)l.push(`.${R}`)}}let h=["aria-label","type","name","title","alt"];for(let b of h){let I=s.getAttribute(b);I&&l.push(`[${b}="${I}"]`)}return l.join("")}function ne(){try{return z.document.location.href}catch{return""}}function ue(r){if(!z.HTMLElement)return null;let i=r,s=5;for(let l=0;l<s;l++){if(!i)return null;if(i instanceof HTMLElement){if(i.dataset.sentryComponent)return i.dataset.sentryComponent;if(i.dataset.sentryElement)return i.dataset.sentryElement}i=i.parentNode}return null}let _e="Sentry Logger ",ye=["debug","info","warn","error","log","assert","trace"],Ee={};function se(r){if(!("console"in N))return r();let i=N.console,s={},l=Object.keys(Ee);l.forEach(f=>{let h=Ee[f];s[f]=i[f],i[f]=h});try{return r()}finally{l.forEach(f=>{i[f]=s[f]})}}function me(){let r=!1,i={enable:()=>{r=!0},disable:()=>{r=!1},isEnabled:()=>r};return ye.forEach(s=>{i[s]=(...l)=>{r&&se(()=>{N.console[s](`${_e}[${s}]:`,...l)})}}),i}let M=me(),he=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function ge(r){return r==="http"||r==="https"}function Ge(r,i=!1){let{host:s,path:l,pass:f,port:h,projectId:b,protocol:I,publicKey:R}=r;return`${I}://${R}${i&&f?`:${f}`:""}@${s}${h?`:${h}`:""}/${l&&`${l}/`}${b}`}function tt(r){let i=he.exec(r);if(!i){se(()=>{console.error(`Invalid Sentry Dsn: ${r}`)});return}let[s,l,f="",h="",b="",I=""]=i.slice(1),R="",K=I,Y=K.split("/");if(Y.length>1&&(R=Y.slice(0,-1).join("/"),K=Y.pop()),K){let J=K.match(/^\d+/);J&&(K=J[0])}return Ye({host:h,pass:f,path:R,projectId:K,port:b,protocol:s,publicKey:l})}function Ye(r){return{protocol:r.protocol,publicKey:r.publicKey||"",pass:r.pass||"",host:r.host,port:r.port||"",path:r.path||"",projectId:r.projectId}}function ju(r){let{port:i,projectId:s,protocol:l}=r;return["protocol","publicKey","host","projectId"].find(b=>r[b]?!1:(M.error(`Invalid Sentry Dsn: ${b} missing`),!0))?!1:s.match(/^\d+$/)?ge(l)?i&&isNaN(parseInt(i,10))?(M.error(`Invalid Sentry Dsn: Invalid port ${i}`),!1):!0:(M.error(`Invalid Sentry Dsn: Invalid protocol ${l}`),!1):(M.error(`Invalid Sentry Dsn: Invalid projectId ${s}`),!1)}function la(r){let i=typeof r=="string"?tt(r):Ye(r);if(!(!i||!ju(i)))return i}class at extends Error{constructor(i,s="warn"){super(i),this.message=i,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=s}}function De(r,i,s){if(!(i in r))return;let l=r[i],f=s(l);typeof f=="function"&&fa(f,l),r[i]=f}function Ht(r,i,s){try{Object.defineProperty(r,i,{value:s,writable:!0,configurable:!0})}catch{M.log(`Failed to add non-enumerable property "${i}" to object`,r)}}function fa(r,i){try{let s=i.prototype||{};r.prototype=i.prototype=s,Ht(r,"__sentry_original__",i)}catch{}}function _i(r){return r.Xt}function Hu(r){return Object.keys(r).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(r[i])}`).join("&")}function da(r){if(n(r))return{message:r.message,name:r.name,stack:r.stack,...ha(r)};if(v(r)){let i={type:r.type,target:pa(r.target),currentTarget:pa(r.currentTarget),...ha(r)};return typeof CustomEvent<"u"&&S(r,CustomEvent)&&(i.detail=r.detail),i}else return r}function pa(r){try{return _(r)?X(r):Object.prototype.toString.call(r)}catch{return"<unknown>"}}function ha(r){if(typeof r=="object"&&r!==null){let i={};for(let s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s]);return i}else return{}}function Vu(r,i=40){let s=Object.keys(da(r));s.sort();let l=s[0];if(!l)return"[object has no keys]";if(l.length>=i)return C(l,i);for(let f=s.length;f>0;f--){let h=s.slice(0,f).join(", ");if(!(h.length>i))return f===s.length?h:C(h,i)}return""}function Ze(r){return Si(r,new Map)}function Si(r,i){if(Wu(r)){let s=i.get(r);if(s!==void 0)return s;let l={};i.set(r,l);for(let f of Object.keys(r))typeof r[f]<"u"&&(l[f]=Si(r[f],i));return l}if(Array.isArray(r)){let s=i.get(r);if(s!==void 0)return s;let l=[];return i.set(r,l),r.forEach(f=>{l.push(Si(f,i))}),l}return r}function Wu(r){if(!g(r))return!1;try{let i=Object.getPrototypeOf(r).constructor.name;return!i||i==="Object"}catch{return!0}}let ma=50,st="?",ga=/\(error: (.*)\)/,ya=/captureMessage|captureException/;function va(...r){let i=r.sort((s,l)=>s[0]-l[0]).map(s=>s[1]);return(s,l=0,f=0)=>{let h=[],b=s.split(`
`);for(let I=l;I<b.length;I++){let R=b[I];if(R.length>1024)continue;let K=ga.test(R)?R.replace(ga,"$1"):R;if(!K.match(/\S*Error: /)){for(let Y of i){let J=Y(K);if(J){h.push(J);break}}if(h.length>=ma+f)break}}return zu(h.slice(f))}}function Gu(r){return Array.isArray(r)?va(...r):r}function zu(r){if(!r.length)return[];let i=Array.from(r);return/sentryWrapped/.test(mr(i).function||"")&&i.pop(),i.reverse(),ya.test(mr(i).function||"")&&(i.pop(),ya.test(mr(i).function||"")&&i.pop()),i.slice(0,ma).map(s=>({...s,filename:s.filename||mr(i).filename,function:s.function||st}))}function mr(r){return r[r.length-1]||{}}let Ei="<anonymous>";function It(r){try{return!r||typeof r!="function"?Ei:r.name||Ei}catch{return Ei}}function ba(r){let i=r.exception;if(i){let s=[];try{return i.values.forEach(l=>{l.stacktrace.frames&&s.push(...l.stacktrace.frames)}),s}catch{return}}}let gr={},wa={};function Vt(r,i){gr[r]=gr[r]||[],gr[r].push(i)}function Wt(r,i){wa[r]||(i(),wa[r]=!0)}function nt(r,i){let s=r&&gr[r];if(s)for(let l of s)try{l(i)}catch(f){M.error(`Error while triggering instrumentation handler.
Type: ${r}
Name: ${It(l)}
Error:`,f)}}function Ju(r){let i="console";Vt(i,r),Wt(i,Yu)}function Yu(){"console"in N&&ye.forEach(function(r){r in N.console&&De(N.console,r,function(i){return Ee[r]=i,function(...s){nt("console",{args:s,level:r});let f=Ee[r];f&&f.apply(N.console,s)}})})}let Ii=N;function _a(){if(!("fetch"in Ii))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function xi(r){return r&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(r.toString())}function Xu(){if(typeof EdgeRuntime=="string")return!0;if(!_a())return!1;if(xi(Ii.fetch))return!0;let r=!1,i=Ii.document;if(i&&typeof i.createElement=="function")try{let s=i.createElement("iframe");s.hidden=!0,i.head.appendChild(s),s.contentWindow&&s.contentWindow.fetch&&(r=xi(s.contentWindow.fetch)),i.head.removeChild(s)}catch(s){M.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",s)}return r}let Sa=1e3;function Fn(){return Date.now()/Sa}function qu(){let{performance:r}=N;if(!r||!r.now)return Fn;let i=Date.now()-r.now(),s=r.timeOrigin==null?i:r.timeOrigin;return()=>(s+r.now())/Sa}let ht=qu();(()=>{let{performance:r}=N;if(!r||!r.now)return;let i=3600*1e3,s=r.now(),l=Date.now(),f=r.timeOrigin?Math.abs(r.timeOrigin+s-l):i,h=f<i,b=r.timing&&r.timing.navigationStart,R=typeof b=="number"?Math.abs(b+s-l):i,K=R<i;return h||K?f<=R?r.timeOrigin:b:l})();function Qu(r){let i="fetch";Vt(i,r),Wt(i,Zu)}function Zu(){Xu()&&De(N,"fetch",function(r){return function(...i){let{method:s,url:l}=el(i),f={args:i,fetchData:{method:s,url:l},startTimestamp:ht()*1e3};nt("fetch",{...f});let h=new Error().stack;return r.apply(N,i).then(b=>{let I={...f,endTimestamp:ht()*1e3,response:b};return nt("fetch",I),b},b=>{let I={...f,endTimestamp:ht()*1e3,error:b};throw nt("fetch",I),n(b)&&b.stack===void 0&&(b.stack=h,Ht(b,"framesToPop",1)),b})}})}function Ti(r,i){return!!r&&typeof r=="object"&&!!r[i]}function Ea(r){return typeof r=="string"?r:r?Ti(r,"url")?r.url:r.toString?r.toString():"":""}function el(r){if(r.length===0)return{method:"GET",url:""};if(r.length===2){let[s,l]=r;return{url:Ea(s),method:Ti(l,"method")?String(l.method).toUpperCase():"GET"}}let i=r[0];return{url:Ea(i),method:Ti(i,"method")?String(i.method).toUpperCase():"GET"}}let yr=null;function tl(r){let i="error";Vt(i,r),Wt(i,nl)}function nl(){yr=N.onerror,N.onerror=function(r,i,s,l,f){return nt("error",{column:l,error:f,line:s,msg:r,url:i}),yr&&!yr.tt?yr.apply(this,arguments):!1},N.onerror.nt=!0}let vr=null;function rl(r){let i="unhandledrejection";Vt(i,r),Wt(i,il)}function il(){vr=N.onunhandledrejection,N.onunhandledrejection=function(r){return nt("unhandledrejection",r),vr&&!vr.tt?vr.apply(this,arguments):!0},N.onunhandledrejection.nt=!0}function ol(){return"npm"}function al(){let r=typeof WeakSet=="function",i=r?new WeakSet:[];function s(f){if(r)return i.has(f)?!0:(i.add(f),!1);for(let h=0;h<i.length;h++)if(i[h]===f)return!0;return i.push(f),!1}function l(f){if(r)i.delete(f);else for(let h=0;h<i.length;h++)if(i[h]===f){i.splice(h,1);break}}return[s,l]}function ke(){let r=N,i=r.crypto||r.msCrypto,s=()=>Math.random()*16;try{if(i&&i.randomUUID)return i.randomUUID().replace(/-/g,"");i&&i.getRandomValues&&(s=()=>{let l=new Uint8Array(1);return i.getRandomValues(l),l[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,l=>(l^(s()&15)>>l/4).toString(16))}function Ia(r){return r.exception&&r.exception.values?r.exception.values[0]:void 0}function xt(r){let{message:i,event_id:s}=r;if(i)return i;let l=Ia(r);return l?l.type&&l.value?`${l.type}: ${l.value}`:l.type||l.value||s||"<unknown>":s||"<unknown>"}function ki(r,i,s){let l=r.exception=r.exception||{},f=l.values=l.values||[],h=f[0]=f[0]||{};h.value||(h.value=i||""),h.type||(h.type=s||"Error")}function Nn(r,i){let s=Ia(r);if(!s)return;let l={type:"generic",handled:!0},f=s.mechanism;if(s.mechanism={...l,...f,...i},i&&"data"in i){let h={...f&&f.data,...i.data};s.mechanism.data=h}}function xa(r){if(r&&r.qt)return!0;try{Ht(r,"__sentry_captured__",!0)}catch{}return!1}function Ta(r){return Array.isArray(r)?r:[r]}function Tt(r,i=100,s=1/0){try{return Ci("",r,i,s)}catch(l){return{ERROR:`**non-serializable** (${l})`}}}function ka(r,i=3,s=102400){let l=Tt(r,i);return ll(l)>s?ka(r,i-1,s):l}function Ci(r,i,s=1/0,l=1/0,f=al()){let[h,b]=f;if(i==null||["number","boolean","string"].includes(typeof i)&&!Number.isNaN(i))return i;let I=sl(r,i);if(!I.startsWith("[object "))return I;if(i.__sentry_skip_normalization__)return i;let R=typeof i.__sentry_override_normalization_depth__=="number"?i.__sentry_override_normalization_depth__:s;if(R===0)return I.replace("object ","");if(h(i))return"[Circular ~]";let K=i;if(K&&typeof K.toJSON=="function")try{let fe=K.toJSON();return Ci("",fe,R-1,l,f)}catch{}let Y=Array.isArray(i)?[]:{},J=0,ce=da(i);for(let fe in ce){if(!Object.prototype.hasOwnProperty.call(ce,fe))continue;if(J>=l){Y[fe]="[MaxProperties ~]";break}let le=ce[fe];Y[fe]=Ci(fe,le,R-1,l,f),J++}return b(i),Y}function sl(r,i){try{if(r==="domain"&&i&&typeof i=="object"&&i._events)return"[Domain]";if(r==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&i===global)return"[Global]";if(typeof window<"u"&&i===window)return"[Window]";if(typeof document<"u"&&i===document)return"[Document]";if(T(i))return"[VueViewModel]";if(E(i))return"[SyntheticEvent]";if(typeof i=="number"&&i!==i)return"[NaN]";if(typeof i=="function")return`[Function: ${It(i)}]`;if(typeof i=="symbol")return`[${String(i)}]`;if(typeof i=="bigint")return`[BigInt: ${String(i)}]`;let s=cl(i);return/^HTML(\w*)Element$/.test(s)?`[HTMLElement: ${s}]`:`[object ${s}]`}catch(s){return`**non-serializable** (${s})`}}function cl(r){let i=Object.getPrototypeOf(r);return i?i.constructor.name:"null prototype"}function ul(r){return~-encodeURI(r).split(/%..|./).length}function ll(r){return ul(JSON.stringify(r))}var mt;(function(r){r[r.PENDING=0]="PENDING";let s=1;r[r.RESOLVED=s]="RESOLVED";let l=2;r[r.REJECTED=l]="REJECTED"})(mt||(mt={}));function Gt(r){return new et(i=>{i(r)})}function br(r){return new et((i,s)=>{s(r)})}class et{constructor(i){et.prototype.__init.call(this),et.prototype.__init2.call(this),et.prototype.__init3.call(this),et.prototype.__init4.call(this),this._state=mt.PENDING,this._handlers=[];try{i(this._resolve,this._reject)}catch(s){this._reject(s)}}then(i,s){return new et((l,f)=>{this._handlers.push([!1,h=>{if(!i)l(h);else try{l(i(h))}catch(b){f(b)}},h=>{if(!s)f(h);else try{l(s(h))}catch(b){f(b)}}]),this._executeHandlers()})}catch(i){return this.then(s=>s,i)}finally(i){return new et((s,l)=>{let f,h;return this.then(b=>{h=!1,f=b,i&&i()},b=>{h=!0,f=b,i&&i()}).then(()=>{if(h){l(f);return}s(f)})})}__init(){this._resolve=i=>{this._setResult(mt.RESOLVED,i)}}__init2(){this._reject=i=>{this._setResult(mt.REJECTED,i)}}__init3(){this._setResult=(i,s)=>{if(this._state===mt.PENDING){if(w(s)){s.then(this._resolve,this._reject);return}this._state=i,this._value=s,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===mt.PENDING)return;let i=this._handlers.slice();this._handlers=[],i.forEach(s=>{s[0]||(this._state===mt.RESOLVED&&s[1](this._value),this._state===mt.REJECTED&&s[2](this._value),s[0]=!0)})}}}function fl(r){let i=[];function s(){return r===void 0||i.length<r}function l(b){return i.splice(i.indexOf(b),1)[0]||Promise.resolve(void 0)}function f(b){if(!s())return br(new at("Not adding Promise because buffer limit was reached."));let I=b();return i.indexOf(I)===-1&&i.push(I),I.then(()=>l(I)).then(null,()=>l(I).then(null,()=>{})),I}function h(b){return new et((I,R)=>{let K=i.length;if(!K)return I(!0);let Y=setTimeout(()=>{b&&b>0&&I(!1)},b);i.forEach(J=>{Gt(J).then(()=>{--K||(clearTimeout(Y),I(!0))},R)})})}return{$:i,add:f,drain:h}}function Ai(r){if(!r)return{};let i=r.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!i)return{};let s=i[6]||"",l=i[8]||"";return{host:i[4],path:i[5],protocol:i[2],search:s,hash:l,relative:i[5]+s+l}}let dl=["fatal","error","warning","log","info","debug"];function pl(r){return r==="warn"?"warning":dl.includes(r)?r:"log"}let Ca="sentry-",hl=/^sentry-/,ml=8192;function Aa(r){let i=yl(r);if(!i)return;let s=Object.entries(i).reduce((l,[f,h])=>{if(f.match(hl)){let b=f.slice(Ca.length);l[b]=h}return l},{});if(Object.keys(s).length>0)return s}function gl(r){if(!r)return;let i=Object.entries(r).reduce((s,[l,f])=>(f&&(s[`${Ca}${l}`]=f),s),{});return vl(i)}function yl(r){if(!(!r||!d(r)&&!Array.isArray(r)))return Array.isArray(r)?r.reduce((i,s)=>{let l=Pa(s);return Object.entries(l).forEach(([f,h])=>{i[f]=h}),i},{}):Pa(r)}function Pa(r){return r.split(",").map(i=>i.split("=").map(s=>decodeURIComponent(s.trim()))).reduce((i,[s,l])=>(s&&l&&(i[s]=l),i),{})}function vl(r){if(Object.keys(r).length!==0)return Object.entries(r).reduce((i,[s,l],f)=>{let h=`${encodeURIComponent(s)}=${encodeURIComponent(l)}`,b=f===0?h:`${i},${h}`;return b.length>ml?(M.warn(`Not adding key: ${s} with val: ${l} to baggage header due to exceeding baggage size limits.`),i):b},"")}let bl=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function wl(r){if(!r)return;let i=r.match(bl);if(!i)return;let s;return i[3]==="1"?s=!0:i[3]==="0"&&(s=!1),{traceId:i[1],parentSampled:s,parentSpanId:i[2]}}function _l(r,i){let s=wl(r),l=Aa(i),{traceId:f,parentSpanId:h,parentSampled:b}=s||{};return s?{traceId:f||ke(),parentSpanId:h||ke().substring(16),spanId:ke().substring(16),sampled:b,dsc:l||{}}:{traceId:f||ke(),spanId:ke().substring(16)}}function Sl(r=ke(),i=ke().substring(16),s){let l="";return s!==void 0&&(l=s?"-1":"-0"),`${r}-${i}${l}`}function Ln(r,i=[]){return[r,i]}function El(r,i){let[s,l]=r;return[s,[...l,i]]}function Da(r,i){let s=r[1];for(let l of s){let f=l[0].type;if(i(l,f))return!0}return!1}function Pi(r){return N.D&&N.D.encodePolyfill?N.D.encodePolyfill(r):new TextEncoder().encode(r)}function Il(r){let[i,s]=r,l=JSON.stringify(i);function f(h){typeof l=="string"?l=typeof h=="string"?l+h:[Pi(l),h]:l.push(typeof h=="string"?Pi(h):h)}for(let h of s){let[b,I]=h;if(f(`
${JSON.stringify(b)}
`),typeof I=="string"||I instanceof Uint8Array)f(I);else{let R;try{R=JSON.stringify(I)}catch{R=JSON.stringify(Tt(I))}f(R)}}return typeof l=="string"?l:xl(l)}function xl(r){let i=r.reduce((f,h)=>f+h.length,0),s=new Uint8Array(i),l=0;for(let f of r)s.set(f,l),l+=f.length;return s}function Tl(r){let i=typeof r.data=="string"?Pi(r.data):r.data;return[Ze({type:"attachment",length:i.length,filename:r.filename,content_type:r.contentType,attachment_type:r.attachmentType}),i]}let kl={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function Oa(r){return kl[r]}function Ra(r){if(!r||!r.sdk)return;let{name:i,version:s}=r.sdk;return{name:i,version:s}}function Cl(r,i,s,l){let f=r.sdkProcessingMetadata&&r.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:r.event_id,sent_at:new Date().toISOString(),...i&&{sdk:i},...!!s&&l&&{dsn:Ge(l)},...f&&{trace:Ze({...f})}}}function Al(r,i,s){let l=[{type:"client_report"},{timestamp:s||Fn(),discarded_events:r}];return Ln(i?{dsn:i}:{},[l])}let Pl=60*1e3;function Dl(r,i=Date.now()){let s=parseInt(`${r}`,10);if(!isNaN(s))return s*1e3;let l=Date.parse(`${r}`);return isNaN(l)?Pl:l-i}function Ol(r,i){return r[i]||r.all||0}function Rl(r,i,s=Date.now()){return Ol(r,i)>s}function Ml(r,{statusCode:i,headers:s},l=Date.now()){let f={...r},h=s&&s["x-sentry-rate-limits"],b=s&&s["retry-after"];if(h)for(let I of h.trim().split(",")){let[R,K,,,Y]=I.split(":",5),J=parseInt(R,10),ce=(isNaN(J)?60:J)*1e3;if(!K)f.all=l+ce;else for(let fe of K.split(";"))fe==="metric_bucket"?(!Y||Y.split(";").includes("custom"))&&(f[fe]=l+ce):f[fe]=l+ce}else b?f.all=l+Dl(b,l):i===429&&(f.all=l+6e4);return f}function Ma(){return{traceId:ke(),spanId:ke().substring(16)}}let wr=N;function Fl(){let r=wr.chrome,i=r&&r.app&&r.app.runtime,s="history"in wr&&!!wr.history.pushState&&!!wr.history.replaceState;return!i&&s}let Fa=()=>{},Nl=["attachTo","createWidget","remove"];function Na(r){return se(()=>{console.warn("You are using feedbackIntegration() even though this bundle does not include feedback.")}),{name:"Feedback",...Nl.reduce((i,s)=>(i[s]=Fa,i),{})}}let Ll=["start","stop","flush"];function Bl(r){return se(()=>{console.warn("You are using replayIntegration() even though this bundle does not include replay.")}),{name:"Replay",...Ll.reduce((i,s)=>(i[s]=Fa,i),{})}}function Bn(){return Di(N),N}function Di(r){let i=r.D=r.D||{};return i.version=i.version||F,i[F]=i[F]||{}}function $l(r){let i=ht(),s={sid:ke(),init:!0,timestamp:i,started:i,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Kl(s)};return r&&cn(s,r),s}function cn(r,i={}){if(i.user&&(!r.ipAddress&&i.user.ip_address&&(r.ipAddress=i.user.ip_address),!r.did&&!i.did&&(r.did=i.user.id||i.user.email||i.user.username)),r.timestamp=i.timestamp||ht(),i.abnormal_mechanism&&(r.abnormal_mechanism=i.abnormal_mechanism),i.ignoreDuration&&(r.ignoreDuration=i.ignoreDuration),i.sid&&(r.sid=i.sid.length===32?i.sid:ke()),i.init!==void 0&&(r.init=i.init),!r.did&&i.did&&(r.did=`${i.did}`),typeof i.started=="number"&&(r.started=i.started),r.ignoreDuration)r.duration=void 0;else if(typeof i.duration=="number")r.duration=i.duration;else{let s=r.timestamp-r.started;r.duration=s>=0?s:0}i.release&&(r.release=i.release),i.environment&&(r.environment=i.environment),!r.ipAddress&&i.ipAddress&&(r.ipAddress=i.ipAddress),!r.userAgent&&i.userAgent&&(r.userAgent=i.userAgent),typeof i.errors=="number"&&(r.errors=i.errors),i.status&&(r.status=i.status)}function Ul(r,i){let s={};i?s={status:i}:r.status==="ok"&&(s={status:"exited"}),cn(r,s)}function Kl(r){return Ze({sid:`${r.sid}`,init:r.init,started:new Date(r.started*1e3).toISOString(),timestamp:new Date(r.timestamp*1e3).toISOString(),status:r.status,errors:r.errors,did:typeof r.did=="number"||typeof r.did=="string"?`${r.did}`:void 0,duration:r.duration,abnormal_mechanism:r.abnormal_mechanism,attrs:{release:r.release,environment:r.environment,ip_address:r.ipAddress,user_agent:r.userAgent}})}let Oi="_sentrySpan";function La(r,i){i?Ht(r,Oi,i):delete r[Oi]}function Ba(r){return r[Oi]}let jl=100;class Ri{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=Ma()}clone(){let i=new Ri;return i._breadcrumbs=[...this._breadcrumbs],i._tags={...this._tags},i._extra={...this._extra},i._contexts={...this._contexts},i._user=this._user,i._level=this._level,i._session=this._session,i._transactionName=this._transactionName,i._fingerprint=this._fingerprint,i._eventProcessors=[...this._eventProcessors],i._requestSession=this._requestSession,i._attachments=[...this._attachments],i._sdkProcessingMetadata={...this._sdkProcessingMetadata},i._propagationContext={...this._propagationContext},i._client=this._client,i._lastEventId=this._lastEventId,La(i,Ba(this)),i}setClient(i){this._client=i}setLastEventId(i){this._lastEventId=i}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(i){this._scopeListeners.push(i)}addEventProcessor(i){return this._eventProcessors.push(i),this}setUser(i){return this._user=i||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&cn(this._session,{user:i}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(i){return this._requestSession=i,this}setTags(i){return this._tags={...this._tags,...i},this._notifyScopeListeners(),this}setTag(i,s){return this._tags={...this._tags,[i]:s},this._notifyScopeListeners(),this}setExtras(i){return this._extra={...this._extra,...i},this._notifyScopeListeners(),this}setExtra(i,s){return this._extra={...this._extra,[i]:s},this._notifyScopeListeners(),this}setFingerprint(i){return this._fingerprint=i,this._notifyScopeListeners(),this}setLevel(i){return this._level=i,this._notifyScopeListeners(),this}setTransactionName(i){return this._transactionName=i,this._notifyScopeListeners(),this}setContext(i,s){return s===null?delete this._contexts[i]:this._contexts[i]=s,this._notifyScopeListeners(),this}setSession(i){return i?this._session=i:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(i){if(!i)return this;let s=typeof i=="function"?i(this):i,[l,f]=s instanceof gt?[s.getScopeData(),s.getRequestSession()]:g(s)?[i,i.requestSession]:[],{tags:h,extra:b,user:I,contexts:R,level:K,fingerprint:Y=[],propagationContext:J}=l||{};return this._tags={...this._tags,...h},this._extra={...this._extra,...b},this._contexts={...this._contexts,...R},I&&Object.keys(I).length&&(this._user=I),K&&(this._level=K),Y.length&&(this._fingerprint=Y),J&&(this._propagationContext=J),f&&(this._requestSession=f),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,La(this,void 0),this._attachments=[],this._propagationContext=Ma(),this._notifyScopeListeners(),this}addBreadcrumb(i,s){let l=typeof s=="number"?s:jl;if(l<=0)return this;let f={timestamp:Fn(),...i},h=this._breadcrumbs;return h.push(f),this._breadcrumbs=h.length>l?h.slice(-l):h,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(i){return this._attachments.push(i),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Ba(this)}}setSDKProcessingMetadata(i){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...i},this}setPropagationContext(i){return this._propagationContext=i,this}getPropagationContext(){return this._propagationContext}captureException(i,s){let l=s&&s.event_id?s.event_id:ke();if(!this._client)return M.warn("No client configured on scope - will not capture exception!"),l;let f=new Error("Sentry syntheticException");return this._client.captureException(i,{originalException:i,syntheticException:f,...s,event_id:l},this),l}captureMessage(i,s,l){let f=l&&l.event_id?l.event_id:ke();if(!this._client)return M.warn("No client configured on scope - will not capture message!"),f;let h=new Error(i);return this._client.captureMessage(i,s,{originalException:i,syntheticException:h,...l,event_id:f},this),f}captureEvent(i,s){let l=s&&s.event_id?s.event_id:ke();return this._client?(this._client.captureEvent(i,{...s,event_id:l},this),l):(M.warn("No client configured on scope - will not capture event!"),l)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(i=>{i(this)}),this._notifyingListeners=!1)}}let gt=Ri;function Hl(){return L("defaultCurrentScope",()=>new gt)}function Vl(){return L("defaultIsolationScope",()=>new gt)}class Wl{constructor(i,s){let l;i?l=i:l=new gt;let f;s?f=s:f=new gt,this._stack=[{scope:l}],this._isolationScope=f}withScope(i){let s=this._pushScope(),l;try{l=i(s)}catch(f){throw this._popScope(),f}return w(l)?l.then(f=>(this._popScope(),f),f=>{throw this._popScope(),f}):(this._popScope(),l)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){let i=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:i}),i}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function un(){let r=Bn(),i=Di(r);return i.stack=i.stack||new Wl(Hl(),Vl())}function Gl(r){return un().withScope(r)}function zl(r,i){let s=un();return s.withScope(()=>(s.getStackTop().scope=r,i(r)))}function $a(r){return un().withScope(()=>r(un().getIsolationScope()))}function Jl(){return{withIsolationScope:$a,withScope:Gl,withSetScope:zl,withSetIsolationScope:(r,i)=>$a(i),getCurrentScope:()=>un().getScope(),getIsolationScope:()=>un().getIsolationScope()}}function _r(r){let i=Di(r);return i.acs?i.acs:Jl()}function $e(){let r=Bn();return _r(r).getCurrentScope()}function je(){let r=Bn();return _r(r).getIsolationScope()}function Ua(){return L("globalScope",()=>new gt)}function Sr(...r){let i=Bn(),s=_r(i);if(r.length===2){let[l,f]=r;return l?s.withSetScope(l,f):s.withScope(f)}return s.withScope(r[0])}function Yl(...r){let i=Bn(),s=_r(i);if(r.length===2){let[l,f]=r;return l?s.withSetIsolationScope(l,f):s.withIsolationScope(f)}return s.withIsolationScope(r[0])}function ve(){return $e().getClient()}let Xl="_sentryMetrics";function ql(r){let i=r[Xl];if(!i)return;let s={};for(let[,[l,f]]of i)(s[l]||(s[l]=[])).push(Ze(f));return s}let Ka="sentry.source",ja="sentry.sample_rate",Ha="sentry.op",Va="sentry.origin",Ql=0,Zl=1,ef=1;function tf(r){let{spanId:i,traceId:s}=r.spanContext(),{parent_span_id:l}=$n(r);return Ze({parent_span_id:l,span_id:i,trace_id:s})}function nf(r){let{traceId:i,spanId:s}=r.spanContext(),l=za(r);return Sl(i,s,l)}function Wa(r){return typeof r=="number"?Ga(r):Array.isArray(r)?r[0]+r[1]/1e9:r instanceof Date?Ga(r.getTime()):ht()}function Ga(r){return r>9999999999?r/1e3:r}function $n(r){if(of(r))return r.getSpanJSON();try{let{spanId:i,traceId:s}=r.spanContext();if(rf(r)){let{attributes:l,startTime:f,name:h,endTime:b,parentSpanId:I,status:R}=r;return Ze({span_id:i,trace_id:s,data:l,description:h,parent_span_id:I,start_timestamp:Wa(f),timestamp:Wa(b)||void 0,status:af(R),op:l[Ha],origin:l[Va],_metrics_summary:ql(r)})}return{span_id:i,trace_id:s}}catch{return{}}}function rf(r){let i=r;return!!i.attributes&&!!i.startTime&&!!i.name&&!!i.endTime&&!!i.status}function of(r){return typeof r.getSpanJSON=="function"}function za(r){let{traceFlags:i}=r.spanContext();return i===ef}function af(r){if(!(!r||r.code===Ql))return r.code===Zl?"ok":r.message||"unknown_error"}let sf="_sentryRootSpan";function Ja(r){return r[sf]||r}let Mi="production",cf="_frozenDsc";function Ya(r,i){let s=i.getOptions(),{publicKey:l}=i.getDsn()||{},f=Ze({environment:s.environment||Mi,release:s.release,public_key:l,trace_id:r});return i.emit("createDsc",f),f}function Xa(r){let i=ve();if(!i)return{};let s=Ya($n(r).trace_id||"",i),l=Ja(r),f=l[cf];if(f)return f;let h=l.spanContext().traceState,b=h&&h.get("sentry.dsc"),I=b&&Aa(b);if(I)return I;let R=$n(l),K=R.data||{},Y=K[ja];Y!=null&&(s.sample_rate=`${Y}`);let J=K[Ka],ce=R.description;return J!=="url"&&ce&&(s.transaction=ce),s.sampled=String(za(l)),i.emit("createDsc",s,l),s}function uf(r){let i=Xa(r);return gl(i)}function lf(r){if(typeof r=="boolean")return Number(r);let i=typeof r=="string"?parseFloat(r):r;if(typeof i!="number"||isNaN(i)||i<0||i>1){M.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(r)} of type ${JSON.stringify(typeof r)}.`);return}return i}function ff(r,i){return i&&(r.sdk=r.sdk||{},r.sdk.name=r.sdk.name||i.name,r.sdk.version=r.sdk.version||i.version,r.sdk.integrations=[...r.sdk.integrations||[],...i.integrations||[]],r.sdk.packages=[...r.sdk.packages||[],...i.packages||[]]),r}function df(r,i,s,l){let f=Ra(s),h={sent_at:new Date().toISOString(),...f&&{sdk:f},...!!l&&i&&{dsn:Ge(i)}},b="aggregates"in r?[{type:"sessions"},r]:[{type:"session"},r.toJSON()];return Ln(h,[b])}function pf(r,i,s,l){let f=Ra(s),h=r.type&&r.type!=="replay_event"?r.type:"event";ff(r,s&&s.sdk);let b=Cl(r,f,l,i);return delete r.sdkProcessingMetadata,Ln(b,[[{type:h},r]])}let hf=({sentryTrace:r,baggage:i},s)=>Sr(l=>{let f=_l(r,i);return l.setPropagationContext(f),s()});function Fi(r,i,s,l=0){return new et((f,h)=>{let b=r[l];if(i===null||typeof b!="function")f(i);else{let I=b({...i},s);b.id&&I===null&&M.log(`Event processor "${b.id}" dropped event`),w(I)?I.then(R=>Fi(r,R,s,l+1).then(f)).then(null,h):Fi(r,I,s,l+1).then(f).then(null,h)}})}function mf(r,i){let{fingerprint:s,span:l,breadcrumbs:f,sdkProcessingMetadata:h}=i;gf(r,i),l&&bf(r,l),wf(r,s),yf(r,f),vf(r,h)}function qa(r,i){let{extra:s,tags:l,user:f,contexts:h,level:b,sdkProcessingMetadata:I,breadcrumbs:R,fingerprint:K,eventProcessors:Y,attachments:J,propagationContext:ce,transactionName:fe,span:le}=i;Un(r,"extra",s),Un(r,"tags",l),Un(r,"user",f),Un(r,"contexts",h),Un(r,"sdkProcessingMetadata",I),b&&(r.level=b),fe&&(r.transactionName=fe),le&&(r.span=le),R.length&&(r.breadcrumbs=[...r.breadcrumbs,...R]),K.length&&(r.fingerprint=[...r.fingerprint,...K]),Y.length&&(r.eventProcessors=[...r.eventProcessors,...Y]),J.length&&(r.attachments=[...r.attachments,...J]),r.propagationContext={...r.propagationContext,...ce}}function Un(r,i,s){if(s&&Object.keys(s).length){r[i]={...r[i]};for(let l in s)Object.prototype.hasOwnProperty.call(s,l)&&(r[i][l]=s[l])}}function gf(r,i){let{extra:s,tags:l,user:f,contexts:h,level:b,transactionName:I}=i,R=Ze(s);R&&Object.keys(R).length&&(r.extra={...R,...r.extra});let K=Ze(l);K&&Object.keys(K).length&&(r.tags={...K,...r.tags});let Y=Ze(f);Y&&Object.keys(Y).length&&(r.user={...Y,...r.user});let J=Ze(h);J&&Object.keys(J).length&&(r.contexts={...J,...r.contexts}),b&&(r.level=b),I&&r.type!=="transaction"&&(r.transaction=I)}function yf(r,i){let s=[...r.breadcrumbs||[],...i];r.breadcrumbs=s.length?s:void 0}function vf(r,i){r.sdkProcessingMetadata={...r.sdkProcessingMetadata,...i}}function bf(r,i){r.contexts={trace:tf(i),...r.contexts},r.sdkProcessingMetadata={dynamicSamplingContext:Xa(i),...r.sdkProcessingMetadata};let s=Ja(i),l=$n(s).description;l&&!r.transaction&&r.type==="transaction"&&(r.transaction=l)}function wf(r,i){r.fingerprint=r.fingerprint?Ta(r.fingerprint):[],i&&(r.fingerprint=r.fingerprint.concat(i)),r.fingerprint&&!r.fingerprint.length&&delete r.fingerprint}function _f(r,i,s,l,f,h){let{normalizeDepth:b=3,normalizeMaxBreadth:I=1e3}=r,R={...i,event_id:i.event_id||s.event_id||ke(),timestamp:i.timestamp||Fn()},K=s.integrations||r.integrations.map(He=>He.name);Sf(R,r),xf(R,K),f&&f.emit("applyFrameMetadata",i),i.type===void 0&&Ef(R,r.stackParser);let Y=kf(l,s.captureContext);s.mechanism&&Nn(R,s.mechanism);let J=f?f.getEventProcessors():[],ce=Ua().getScopeData();if(h){let He=h.getScopeData();qa(ce,He)}if(Y){let He=Y.getScopeData();qa(ce,He)}let fe=[...s.attachments||[],...ce.attachments];fe.length&&(s.attachments=fe),mf(R,ce);let le=[...J,...ce.eventProcessors];return Fi(le,R,s).then(He=>(He&&If(He),typeof b=="number"&&b>0?Tf(He,b,I):He))}function Sf(r,i){let{environment:s,release:l,dist:f,maxValueLength:h=250}=i;"environment"in r||(r.environment="environment"in i?s:Mi),r.release===void 0&&l!==void 0&&(r.release=l),r.dist===void 0&&f!==void 0&&(r.dist=f),r.message&&(r.message=C(r.message,h));let b=r.exception&&r.exception.values&&r.exception.values[0];b&&b.value&&(b.value=C(b.value,h));let I=r.request;I&&I.url&&(I.url=C(I.url,h))}let Qa=new WeakMap;function Ef(r,i){let s=N._sentryDebugIds;if(!s)return;let l,f=Qa.get(i);f?l=f:(l=new Map,Qa.set(i,l));let h=Object.entries(s).reduce((b,[I,R])=>{let K,Y=l.get(I);Y?K=Y:(K=i(I),l.set(I,K));for(let J=K.length-1;J>=0;J--){let ce=K[J];if(ce.filename){b[ce.filename]=R;break}}return b},{});try{r.exception.values.forEach(b=>{b.stacktrace.frames.forEach(I=>{I.filename&&(I.debug_id=h[I.filename])})})}catch{}}function If(r){let i={};try{r.exception.values.forEach(l=>{l.stacktrace.frames.forEach(f=>{f.debug_id&&(f.abs_path?i[f.abs_path]=f.debug_id:f.filename&&(i[f.filename]=f.debug_id),delete f.debug_id)})})}catch{}if(Object.keys(i).length===0)return;r.debug_meta=r.debug_meta||{},r.debug_meta.images=r.debug_meta.images||[];let s=r.debug_meta.images;Object.entries(i).forEach(([l,f])=>{s.push({type:"sourcemap",code_file:l,debug_id:f})})}function xf(r,i){i.length>0&&(r.sdk=r.sdk||{},r.sdk.integrations=[...r.sdk.integrations||[],...i])}function Tf(r,i,s){if(!r)return null;let l={...r,...r.breadcrumbs&&{breadcrumbs:r.breadcrumbs.map(f=>({...f,...f.data&&{data:Tt(f.data,i,s)}}))},...r.user&&{user:Tt(r.user,i,s)},...r.contexts&&{contexts:Tt(r.contexts,i,s)},...r.extra&&{extra:Tt(r.extra,i,s)}};return r.contexts&&r.contexts.trace&&l.contexts&&(l.contexts.trace=r.contexts.trace,r.contexts.trace.data&&(l.contexts.trace.data=Tt(r.contexts.trace.data,i,s))),r.spans&&(l.spans=r.spans.map(f=>({...f,...f.data&&{data:Tt(f.data,i,s)}}))),l}function kf(r,i){if(!i)return r;let s=r?r.clone():new gt;return s.update(i),s}function Cf(r){if(r)return Af(r)?{captureContext:r}:Df(r)?{captureContext:r}:r}function Af(r){return r instanceof gt||typeof r=="function"}let Pf=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function Df(r){return Object.keys(r).some(i=>Pf.includes(i))}function Za(r,i){return $e().captureException(r,Cf(i))}function Of(r,i){let s=typeof i=="string"?i:void 0,l=typeof i!="string"?{captureContext:i}:void 0;return $e().captureMessage(r,s,l)}function Er(r,i){return $e().captureEvent(r,i)}function es(r,i){je().setContext(r,i)}function ts(r){je().setExtras(r)}function ns(r,i){je().setExtra(r,i)}function rs(r){je().setTags(r)}function is(r,i){je().setTag(r,i)}function os(r){je().setUser(r)}function as(){return je().lastEventId()}async function Rf(r){let i=ve();return i?i.flush(r):(M.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}async function Mf(r){let i=ve();return i?i.close(r):(M.warn("Cannot flush events and disable SDK. No client defined."),Promise.resolve(!1))}function Ff(){return!!ve()}function Nf(r){je().addEventProcessor(r)}function Ir(r){let i=ve(),s=je(),l=$e(),{release:f,environment:h=Mi}=i&&i.getOptions()||{},{userAgent:b}=N.navigator||{},I=$l({release:f,environment:h,user:l.getUser()||s.getUser(),...b&&{userAgent:b},...r}),R=s.getSession();return R&&R.status==="ok"&&cn(R,{status:"exited"}),Kn(),s.setSession(I),l.setSession(I),I}function Kn(){let r=je(),i=$e(),s=i.getSession()||r.getSession();s&&Ul(s),ss(),r.setSession(),i.setSession()}function ss(){let r=je(),i=$e(),s=ve(),l=i.getSession()||r.getSession();l&&s&&s.captureSession(l)}function Ni(r=!1){if(r){Kn();return}ss()}let Lf="7";function cs(r){let i=r.protocol?`${r.protocol}:`:"",s=r.port?`:${r.port}`:"";return`${i}//${r.host}${s}${r.path?`/${r.path}`:""}/api/`}function Bf(r){return`${cs(r)}${r.projectId}/envelope/`}function $f(r,i){return Hu({sentry_key:r.publicKey,sentry_version:Lf,...i&&{sentry_client:`${i.name}/${i.version}`}})}function Uf(r,i,s){return i||`${Bf(r)}?${$f(r,s)}`}function Kf(r,i){let s=la(r);if(!s)return"";let l=`${cs(s)}embed/error-page/`,f=`dsn=${Ge(s)}`;for(let h in i)if(h!=="dsn"&&h!=="onClose")if(h==="user"){let b=i.user;if(!b)continue;b.name&&(f+=`&name=${encodeURIComponent(b.name)}`),b.email&&(f+=`&email=${encodeURIComponent(b.email)}`)}else f+=`&${encodeURIComponent(h)}=${encodeURIComponent(i[h])}`;return`${l}?${f}`}let us=[];function jf(r){let i={};return r.forEach(s=>{let{name:l}=s,f=i[l];f&&!f.isDefaultInstance&&s.isDefaultInstance||(i[l]=s)}),Object.values(i)}function Hf(r){let i=r.defaultIntegrations||[],s=r.integrations;i.forEach(b=>{b.isDefaultInstance=!0});let l;Array.isArray(s)?l=[...i,...s]:typeof s=="function"?l=Ta(s(i)):l=i;let f=jf(l),h=f.findIndex(b=>b.name==="Debug");if(h>-1){let[b]=f.splice(h,1);f.push(b)}return f}function Vf(r,i){let s={};return i.forEach(l=>{l&&fs(r,l,s)}),s}function ls(r,i){for(let s of i)s&&s.afterAllSetup&&s.afterAllSetup(r)}function fs(r,i,s){if(s[i.name]){M.log(`Integration skipped because it was already installed: ${i.name}`);return}if(s[i.name]=i,us.indexOf(i.name)===-1&&typeof i.setupOnce=="function"&&(i.setupOnce(),us.push(i.name)),i.setup&&typeof i.setup=="function"&&i.setup(r),typeof i.preprocessEvent=="function"){let l=i.preprocessEvent.bind(i);r.on("preprocessEvent",(f,h)=>l(f,h,r))}if(typeof i.processEvent=="function"){let l=i.processEvent.bind(i),f=Object.assign((h,b)=>l(h,b,r),{id:i.name});r.addEventProcessor(f)}M.log(`Integration installed: ${i.name}`)}function Wf(r){let i=ve();if(!i){M.warn(`Cannot add integration "${r.name}" because no SDK Client is available.`);return}i.addIntegration(r)}function sg(r){return r}let ds="Not capturing exception because it's already been captured.";class Gf{constructor(i){if(this._options=i,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],i.dsn?this._dsn=la(i.dsn):M.warn("No DSN provided, client will not send events."),this._dsn){let s=Uf(this._dsn,i.tunnel,i._metadata?i._metadata.sdk:void 0);this._transport=i.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...i.transportOptions,url:s})}}captureException(i,s,l){let f=ke();if(xa(i))return M.log(ds),f;let h={event_id:f,...s};return this._process(this.eventFromException(i,h).then(b=>this._captureEvent(b,h,l))),h.event_id}captureMessage(i,s,l,f){let h={event_id:ke(),...l},b=p(i)?i:String(i),I=m(i)?this.eventFromMessage(b,s,h):this.eventFromException(i,h);return this._process(I.then(R=>this._captureEvent(R,h,f))),h.event_id}captureEvent(i,s,l){let f=ke();if(s&&s.originalException&&xa(s.originalException))return M.log(ds),f;let h={event_id:f,...s},I=(i.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(i,h,I||l)),h.event_id}captureSession(i){typeof i.release!="string"?M.warn("Discarded session because of missing or non-string release"):(this.sendSession(i),cn(i,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(i){let s=this._transport;return s?(this.emit("flush"),this._isClientDoneProcessing(i).then(l=>s.flush(i).then(f=>l&&f))):Gt(!0)}close(i){return this.flush(i).then(s=>(this.getOptions().enabled=!1,this.emit("close"),s))}getEventProcessors(){return this._eventProcessors}addEventProcessor(i){this._eventProcessors.push(i)}init(){this._isEnabled()&&this._setupIntegrations()}getIntegrationByName(i){return this._integrations[i]}addIntegration(i){let s=this._integrations[i.name];fs(this,i,this._integrations),s||ls(this,[i])}sendEvent(i,s={}){this.emit("beforeSendEvent",i,s);let l=pf(i,this._dsn,this._options._metadata,this._options.tunnel);for(let h of s.attachments||[])l=El(l,Tl(h));let f=this.sendEnvelope(l);f&&f.then(h=>this.emit("afterSendEvent",i,h),null)}sendSession(i){let s=df(i,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(s)}recordDroppedEvent(i,s,l){if(this._options.sendClientReports){let f=`${i}:${s}`;M.log(`Adding outcome: "${f}"`),this._outcomes[f]=(this._outcomes[f]||0)+1}}on(i,s){let l=this._hooks[i]=this._hooks[i]||[];return l.push(s),()=>{let f=l.indexOf(s);f>-1&&l.splice(f,1)}}emit(i,...s){let l=this._hooks[i];l&&l.forEach(f=>f(...s))}sendEnvelope(i){return this.emit("beforeEnvelope",i),this._isEnabled()&&this._transport?this._transport.send(i).then(null,s=>(M.error("Error while sending event:",s),s)):(M.error("Transport disabled"),Gt({}))}_setupIntegrations(){let{integrations:i}=this._options;this._integrations=Vf(this,i),ls(this,i)}_updateSessionFromEvent(i,s){let l=!1,f=!1,h=s.exception&&s.exception.values;if(h){f=!0;for(let R of h){let K=R.mechanism;if(K&&K.handled===!1){l=!0;break}}}let b=i.status==="ok";(b&&i.errors===0||b&&l)&&(cn(i,{...l&&{status:"crashed"},errors:i.errors||Number(f||l)}),this.captureSession(i))}_isClientDoneProcessing(i){return new et(s=>{let l=0,f=1,h=setInterval(()=>{this._numProcessing==0?(clearInterval(h),s(!0)):(l+=f,i&&l>=i&&(clearInterval(h),s(!1)))},f)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(i,s,l,f=je()){let h=this.getOptions(),b=Object.keys(this._integrations);return!s.integrations&&b.length>0&&(s.integrations=b),this.emit("preprocessEvent",i,s),i.type||f.setLastEventId(i.event_id||s.event_id),_f(h,i,s,l,this,f).then(I=>{if(I===null)return I;let R={...f.getPropagationContext(),...l?l.getPropagationContext():void 0};if(!(I.contexts&&I.contexts.trace)&&R){let{traceId:Y,spanId:J,parentSpanId:ce,dsc:fe}=R;I.contexts={trace:Ze({trace_id:Y,span_id:J,parent_span_id:ce}),...I.contexts};let le=fe||Ya(Y,this);I.sdkProcessingMetadata={dynamicSamplingContext:le,...I.sdkProcessingMetadata}}return I})}_captureEvent(i,s={},l){return this._processEvent(i,s,l).then(f=>f.event_id,f=>{{let h=f;h.logLevel==="log"?M.log(h.message):M.warn(h)}})}_processEvent(i,s,l){let f=this.getOptions(),{sampleRate:h}=f,b=Li(i),I=ps(i),R=i.type||"error",K=`before send for type \`${R}\``,Y=typeof h>"u"?void 0:lf(h);if(I&&typeof Y=="number"&&Math.random()>Y)return this.recordDroppedEvent("sample_rate","error",i),br(new at(`Discarding event because it's not included in the random sample (sampling rate = ${h})`,"log"));let J=R==="replay_event"?"replay":R,fe=(i.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(i,s,l,fe).then(le=>{if(le===null)throw this.recordDroppedEvent("event_processor",J,i),new at("An event processor returned `null`, will not send event.","log");if(s.data&&s.data.rt===!0)return le;let He=Jf(this,f,le,s);return zf(He,K)}).then(le=>{if(le===null){if(this.recordDroppedEvent("before_send",J,i),Li(i)){let Np=1+(i.spans||[]).length;this._outcomes.span=(this._outcomes.span||0)+Np}throw new at(`${K} returned \`null\`, will not send event.`,"log")}let Pr=l&&l.getSession();!b&&Pr&&this._updateSessionFromEvent(Pr,le);let He=le.transaction_info;if(b&&He&&le.transaction!==i.transaction){let Ys="custom";le.transaction_info={...He,source:Ys}}return this.sendEvent(le,s),le}).then(null,le=>{throw le instanceof at?le:(this.captureException(le,{data:{rt:!0},originalException:le}),new at(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${le}`))})}_process(i){this._numProcessing++,i.then(s=>(this._numProcessing--,s),s=>(this._numProcessing--,s))}_clearOutcomes(){let i=this._outcomes;return this._outcomes={},Object.entries(i).map(([s,l])=>{let[f,h]=s.split(":");return{reason:f,category:h,quantity:l}})}}function zf(r,i){let s=`${i} must return \`null\` or a valid event.`;if(w(r))return r.then(l=>{if(!g(l)&&l!==null)throw new at(s);return l},l=>{throw new at(`${i} rejected with ${l}`)});if(!g(r)&&r!==null)throw new at(s);return r}function Jf(r,i,s,l){let{beforeSend:f,beforeSendTransaction:h,beforeSendSpan:b}=i;if(ps(s)&&f)return f(s,l);if(Li(s)){if(s.spans&&b){let I=[];for(let R of s.spans){let K=b(R);K?I.push(K):r.recordDroppedEvent("before_send","span")}s.spans=I}if(h)return h(s,l)}return s}function ps(r){return r.type===void 0}function Li(r){return r.type==="transaction"}function Yf(r,i){i.debug===!0&&M.enable(),$e().update(i.initialScope);let l=new r(i);return hs(l),l.init(),l}function hs(r){$e().setClient(r)}let Xf=64;function ms(r,i,s=fl(r.bufferSize||Xf)){let l={},f=b=>s.drain(b);function h(b){let I=[];if(Da(b,(J,ce)=>{let fe=Oa(ce);if(Rl(l,fe)){let le=gs(J,ce);r.recordDroppedEvent("ratelimit_backoff",fe,le)}else I.push(J)}),I.length===0)return Gt({});let R=Ln(b[0],I),K=J=>{Da(R,(ce,fe)=>{let le=gs(ce,fe);r.recordDroppedEvent(J,Oa(fe),le)})},Y=()=>i({body:Il(R)}).then(J=>(J.statusCode!==void 0&&(J.statusCode<200||J.statusCode>=300)&&M.warn(`Sentry responded with status code ${J.statusCode} to sent event.`),l=Ml(l,J),J),J=>{throw K("network_error"),J});return s.add(Y).then(J=>J,J=>{if(J instanceof at)return M.error("Skipped sending event because buffer is full."),K("queue_overflow"),Gt({});throw J})}return{send:h,flush:f}}function gs(r,i){if(!(i!=="event"&&i!=="transaction"))return Array.isArray(r)?r[1]:void 0}function qf(r,...i){let s=new String(String.raw(r,...i));return s.it=r.join("\0").replace(/%/g,"%%").replace(/\0/g,"%s"),s.ot=i,s}function Qf(r,i,s=[i],l="npm"){let f=r._metadata||{};f.sdk||(f.sdk={name:`sentry.javascript.${i}`,packages:s.map(h=>({name:`${l}:@sentry/${h}`,version:F})),version:F}),r._metadata=f}let Zf=100;function yt(r,i){let s=ve(),l=je();if(!s)return;let{beforeBreadcrumb:f=null,maxBreadcrumbs:h=Zf}=s.getOptions();if(h<=0)return;let I={timestamp:Fn(),...r},R=f?se(()=>f(I,i)):I;R!==null&&(s.emit&&s.emit("beforeAddBreadcrumb",R,i),l.addBreadcrumb(R,h))}let ys,ed="FunctionToString",vs=new WeakMap,bs=(()=>({name:ed,setupOnce(){ys=Function.prototype.toString;try{Function.prototype.toString=function(...r){let i=_i(this),s=vs.has(ve())&&i!==void 0?i:this;return ys.apply(s,r)}}catch{}},setup(r){vs.set(r,!0)}})),td=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler"],nd="InboundFilters",ws=((r={})=>({name:nd,processEvent(i,s,l){let f=l.getOptions(),h=rd(r,f);return id(i,h)?null:i}}));function rd(r={},i={}){return{allowUrls:[...r.allowUrls||[],...i.allowUrls||[]],denyUrls:[...r.denyUrls||[],...i.denyUrls||[]],ignoreErrors:[...r.ignoreErrors||[],...i.ignoreErrors||[],...r.disableErrorDefaults?[]:td],ignoreTransactions:[...r.ignoreTransactions||[],...i.ignoreTransactions||[]],ignoreInternal:r.ignoreInternal!==void 0?r.ignoreInternal:!0}}function id(r,i){return i.ignoreInternal&&ld(r)?(M.warn(`Event dropped due to being internal Sentry Error.
Event: ${xt(r)}`),!0):od(r,i.ignoreErrors)?(M.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${xt(r)}`),!0):dd(r)?(M.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${xt(r)}`),!0):ad(r,i.ignoreTransactions)?(M.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${xt(r)}`),!0):sd(r,i.denyUrls)?(M.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${xt(r)}.
Url: ${xr(r)}`),!0):cd(r,i.allowUrls)?!1:(M.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${xt(r)}.
Url: ${xr(r)}`),!0)}function od(r,i){return r.type||!i||!i.length?!1:ud(r).some(s=>A(s,i))}function ad(r,i){if(r.type!=="transaction"||!i||!i.length)return!1;let s=r.transaction;return s?A(s,i):!1}function sd(r,i){if(!i||!i.length)return!1;let s=xr(r);return s?A(s,i):!1}function cd(r,i){if(!i||!i.length)return!0;let s=xr(r);return s?A(s,i):!0}function ud(r){let i=[];r.message&&i.push(r.message);let s;try{s=r.exception.values[r.exception.values.length-1]}catch{}return s&&s.value&&(i.push(s.value),s.type&&i.push(`${s.type}: ${s.value}`)),i}function ld(r){try{return r.exception.values[0].type==="SentryError"}catch{}return!1}function fd(r=[]){for(let i=r.length-1;i>=0;i--){let s=r[i];if(s&&s.filename!=="<anonymous>"&&s.filename!=="[native code]")return s.filename||null}return null}function xr(r){try{let i;try{i=r.exception.values[0].stacktrace.frames}catch{}return i?fd(i):null}catch{return M.error(`Cannot extract url for event ${xt(r)}`),null}}function dd(r){return r.type||!r.exception||!r.exception.values||r.exception.values.length===0?!1:!r.message&&!r.exception.values.some(i=>i.stacktrace||i.type&&i.type!=="Error"||i.value)}let pd="Dedupe",_s=(()=>{let r;return{name:pd,processEvent(i){if(i.type)return i;try{if(hd(i,r))return M.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return r=i}}});function hd(r,i){return i?!!(md(r,i)||gd(r,i)):!1}function md(r,i){let s=r.message,l=i.message;return!(!s&&!l||s&&!l||!s&&l||s!==l||!Es(r,i)||!Ss(r,i))}function gd(r,i){let s=Is(i),l=Is(r);return!(!s||!l||s.type!==l.type||s.value!==l.value||!Es(r,i)||!Ss(r,i))}function Ss(r,i){let s=ba(r),l=ba(i);if(!s&&!l)return!0;if(s&&!l||!s&&l||(s=s,l=l,l.length!==s.length))return!1;for(let f=0;f<l.length;f++){let h=l[f],b=s[f];if(h.filename!==b.filename||h.lineno!==b.lineno||h.colno!==b.colno||h.function!==b.function)return!1}return!0}function Es(r,i){let s=r.fingerprint,l=i.fingerprint;if(!s&&!l)return!0;if(s&&!l||!s&&l)return!1;s=s,l=l;try{return s.join("")===l.join("")}catch{return!1}}function Is(r){return r.exception&&r.exception.values&&r.exception.values[0]}function yd(){return{bindClient(r){$e().setClient(r)},withScope:Sr,getClient:()=>ve(),getScope:$e,getIsolationScope:je,captureException:(r,i)=>$e().captureException(r,i),captureMessage:(r,i,s)=>$e().captureMessage(r,i,s),captureEvent:Er,addBreadcrumb:yt,setUser:os,setTags:rs,setTag:is,setExtra:ns,setExtras:ts,setContext:es,getIntegration(r){let i=ve();return i&&i.getIntegrationByName(r.id)||null},startSession:Ir,endSession:Kn,captureSession(r){if(r)return Kn();bd()}}}let vd=yd;function bd(){let r=$e(),i=ve(),s=r.getSession();i&&s&&i.captureSession(s)}let wd=r=>(se(()=>{console.warn("You are using browserTracingIntegration() even though this bundle does not include tracing.")}),{name:"BrowserTracing"});function jn(){se(()=>{console.warn("You are using metrics even though this bundle does not include tracing.")})}let _d={increment:jn,distribution:jn,set:jn,gauge:jn,timing:(r,i)=>{if(jn(),typeof i=="function")return i()}},oe=N,Bi=0;function xs(){return Bi>0}function Sd(){Bi++,setTimeout(()=>{Bi--})}function ln(r,i={},s){if(typeof r!="function")return r;try{let f=r.at;if(f)return f;if(_i(r))return r}catch{return r}let l=function(){let f=Array.prototype.slice.call(arguments);try{s&&typeof s=="function"&&s.apply(this,arguments);let h=f.map(b=>ln(b,i));return r.apply(this,h)}catch(h){throw Sd(),Sr(b=>{b.addEventProcessor(I=>(i.mechanism&&(ki(I,void 0,void 0),Nn(I,i.mechanism)),I.extra={...I.extra,arguments:f},I)),Za(h)}),h}};try{for(let f in r)Object.prototype.hasOwnProperty.call(r,f)&&(l[f]=r[f])}catch{}fa(l,r),Ht(r,"__sentry_wrapped__",l);try{Object.getOwnPropertyDescriptor(l,"name").configurable&&Object.defineProperty(l,"name",{get(){return r.name}})}catch{}return l}function Tr(r,i){let s=Ui(r,i),l={type:i&&i.name,value:kd(i)};return s.length&&(l.stacktrace={frames:s}),l.type===void 0&&l.value===""&&(l.value="Unrecoverable error caught"),l}function Ed(r,i,s,l){let f=ve(),h=f&&f.getOptions().normalizeDepth,b=Pd(i),I={Qt:ka(i,h)};if(b)return{exception:{values:[Tr(r,b)]},extra:I};let R={exception:{values:[{type:v(i)?i.constructor.name:l?"UnhandledRejection":"Error",value:Cd(i,{isUnhandledRejection:l})}]},extra:I};if(s){let K=Ui(r,s);K.length&&(R.exception.values[0].stacktrace={frames:K})}return R}function $i(r,i){return{exception:{values:[Tr(r,i)]}}}function Ui(r,i){let s=i.stacktrace||i.stack||"",l=xd(i),f=Td(i);try{return r(s,l,f)}catch{}return[]}let Id=/Minified React error #\d+;/i;function xd(r){return r&&Id.test(r.message)?1:0}function Td(r){return typeof r.framesToPop=="number"?r.framesToPop:0}function kd(r){let i=r&&r.message;return i?i.error&&typeof i.error.message=="string"?i.error.message:i:"No error message"}function Ts(r,i,s,l){let f=s&&s.syntheticException||void 0,h=Ki(r,i,f,l);return Nn(h),h.level="error",s&&s.event_id&&(h.event_id=s.event_id),Gt(h)}function ks(r,i,s="info",l,f){let h=l&&l.syntheticException||void 0,b=ji(r,i,h,f);return b.level=s,l&&l.event_id&&(b.event_id=l.event_id),Gt(b)}function Ki(r,i,s,l,f){let h;if(a(i)&&i.error)return $i(r,i.error);if(c(i)||u(i)){let b=i;if("stack"in i)h=$i(r,i);else{let I=b.name||(c(b)?"DOMError":"DOMException"),R=b.message?`${I}: ${b.message}`:I;h=ji(r,R,s,l),ki(h,R)}return"code"in b&&(h.tags={...h.tags,"DOMException.code":`${b.code}`}),h}return n(i)?$i(r,i):g(i)||v(i)?(h=Ed(r,i,s,f),Nn(h,{synthetic:!0}),h):(h=ji(r,i,s,l),ki(h,`${i}`,void 0),Nn(h,{synthetic:!0}),h)}function ji(r,i,s,l){let f={};if(l&&s){let h=Ui(r,s);h.length&&(f.exception={values:[{value:i,stacktrace:{frames:h}}]})}if(p(i)){let{it:h,ot:b}=i;return f.logentry={message:h,params:b},f}return f.message=i,f}function Cd(r,{isUnhandledRejection:i}){let s=Vu(r),l=i?"promise rejection":"exception";return a(r)?`Event \`ErrorEvent\` captured as ${l} with message \`${r.message}\``:v(r)?`Event \`${Ad(r)}\` (type=${r.type}) captured as ${l}`:`Object captured as ${l} with keys: ${s}`}function Ad(r){try{let i=Object.getPrototypeOf(r);return i?i.constructor.name:void 0}catch{}}function Pd(r){for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i)){let s=r[i];if(s instanceof Error)return s}}function Cs(r,{metadata:i,tunnel:s,dsn:l}){let f={event_id:r.event_id,sent_at:new Date().toISOString(),...i&&i.sdk&&{sdk:{name:i.sdk.name,version:i.sdk.version}},...!!s&&!!l&&{dsn:Ge(l)}},h=Dd(r);return Ln(f,[h])}function Dd(r){return[{type:"user_report"},r]}class As extends Gf{constructor(i){let s={parentSpanIsAlwaysRootSpan:!0,...i},l=oe.SENTRY_SDK_SOURCE||ol();Qf(s,"browser",["browser"],l),super(s),s.sendClientReports&&oe.document&&oe.document.addEventListener("visibilitychange",()=>{oe.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(i,s){return Ts(this._options.stackParser,i,s,this._options.attachStacktrace)}eventFromMessage(i,s="info",l){return ks(this._options.stackParser,i,s,l,this._options.attachStacktrace)}captureUserFeedback(i){if(!this._isEnabled()){M.warn("SDK not enabled, will not capture user feedback.");return}let s=Cs(i,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(s)}_prepareEvent(i,s,l){return i.platform=i.platform||"javascript",super._prepareEvent(i,s,l)}_flushOutcomes(){let i=this._clearOutcomes();if(i.length===0){M.log("No outcomes to send");return}if(!this._dsn){M.log("No dsn provided, will not send outcomes");return}M.log("Sending outcomes:",i);let s=Al(i,this._options.tunnel&&Ge(this._dsn));this.sendEnvelope(s)}}let Ue=N,Od=1e3,Ps,Hi,Vi;function Rd(r){Vt("dom",r),Wt("dom",Md)}function Md(){if(!Ue.document)return;let r=nt.bind(null,"dom"),i=Ds(r,!0);Ue.document.addEventListener("click",i,!1),Ue.document.addEventListener("keypress",i,!1),["EventTarget","Node"].forEach(s=>{let l=Ue[s]&&Ue[s].prototype;!l||!l.hasOwnProperty||!l.hasOwnProperty("addEventListener")||(De(l,"addEventListener",function(f){return function(h,b,I){if(h==="click"||h=="keypress")try{let R=this,K=R.ee=R.ee||{},Y=K[h]=K[h]||{refCount:0};if(!Y.handler){let J=Ds(r);Y.handler=J,f.call(this,h,J,I)}Y.refCount++}catch{}return f.call(this,h,b,I)}}),De(l,"removeEventListener",function(f){return function(h,b,I){if(h==="click"||h=="keypress")try{let R=this,K=R.ee||{},Y=K[h];Y&&(Y.refCount--,Y.refCount<=0&&(f.call(this,h,Y.handler,I),Y.handler=void 0,delete K[h]),Object.keys(K).length===0&&delete R.ee)}catch{}return f.call(this,h,b,I)}}))})}function Fd(r){if(r.type!==Hi)return!1;try{if(!r.target||r.target._sentryId!==Vi)return!1}catch{}return!0}function Nd(r,i){return r!=="keypress"?!1:!i||!i.tagName?!0:!(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)}function Ds(r,i=!1){return s=>{if(!s||s._sentryCaptured)return;let l=Ld(s);if(Nd(s.type,l))return;Ht(s,"_sentryCaptured",!0),l&&!l._sentryId&&Ht(l,"_sentryId",ke());let f=s.type==="keypress"?"input":s.type;Fd(s)||(r({event:s,name:f,global:i}),Hi=s.type,Vi=l?l._sentryId:void 0),clearTimeout(Ps),Ps=Ue.setTimeout(()=>{Vi=void 0,Hi=void 0},Od)}}function Ld(r){try{return r.target}catch{return null}}let kr;function Os(r){let i="history";Vt(i,r),Wt(i,Bd)}function Bd(){if(!Fl())return;let r=Ue.onpopstate;Ue.onpopstate=function(...s){let l=Ue.location.href,f=kr;if(kr=l,nt("history",{from:f,to:l}),r)try{return r.apply(this,s)}catch{}};function i(s){return function(...l){let f=l.length>2?l[2]:void 0;if(f){let h=kr,b=String(f);kr=b,nt("history",{from:h,to:b})}return s.apply(this,l)}}De(Ue.history,"pushState",i),De(Ue.history,"replaceState",i)}let Cr={};function $d(r){let i=Cr[r];if(i)return i;let s=Ue[r];if(xi(s))return Cr[r]=s.bind(Ue);let l=Ue.document;if(l&&typeof l.createElement=="function")try{let f=l.createElement("iframe");f.hidden=!0,l.head.appendChild(f);let h=f.contentWindow;h&&h[r]&&(s=h[r]),l.head.removeChild(f)}catch(f){M.warn(`Could not create sandbox iframe for ${r} check, bailing to window.${r}: `,f)}return s&&(Cr[r]=s.bind(Ue))}function Rs(r){Cr[r]=void 0}let Hn="__sentry_xhr_v3__";function Ud(r){Vt("xhr",r),Wt("xhr",Kd)}function Kd(){if(!Ue.XMLHttpRequest)return;let r=XMLHttpRequest.prototype;De(r,"open",function(i){return function(...s){let l=ht()*1e3,f=d(s[0])?s[0].toUpperCase():void 0,h=jd(s[1]);if(!f||!h)return i.apply(this,s);this[Hn]={method:f,url:h,request_headers:{}},f==="POST"&&h.match(/sentry_key/)&&(this.Zt=!0);let b=()=>{let I=this[Hn];if(I&&this.readyState===4){try{I.status_code=this.status}catch{}let R={endTimestamp:ht()*1e3,startTimestamp:l,xhr:this};nt("xhr",R)}};return"onreadystatechange"in this&&typeof this.onreadystatechange=="function"?De(this,"onreadystatechange",function(I){return function(...R){return b(),I.apply(this,R)}}):this.addEventListener("readystatechange",b),De(this,"setRequestHeader",function(I){return function(...R){let[K,Y]=R,J=this[Hn];return J&&d(K)&&d(Y)&&(J.request_headers[K.toLowerCase()]=Y),I.apply(this,R)}}),i.apply(this,s)}}),De(r,"send",function(i){return function(...s){let l=this[Hn];if(!l)return i.apply(this,s);s[0]!==void 0&&(l.body=s[0]);let f={startTimestamp:ht()*1e3,xhr:this};return nt("xhr",f),i.apply(this,s)}})}function jd(r){if(d(r))return r;try{return r.toString()}catch{}}function Ms(r,i=$d("fetch")){let s=0,l=0;function f(h){let b=h.body.length;s+=b,l++;let I={body:h.body,method:"POST",referrerPolicy:"origin",headers:r.headers,keepalive:s<=6e4&&l<15,...r.fetchOptions};if(!i)return Rs("fetch"),br("No fetch implementation available");try{return i(r.url,I).then(R=>(s-=b,l--,{statusCode:R.status,headers:{"x-sentry-rate-limits":R.headers.get("X-Sentry-Rate-Limits"),"retry-after":R.headers.get("Retry-After")}}))}catch(R){return Rs("fetch"),s-=b,l--,br(R)}}return ms(r,f)}let Hd=10,Vd=20,Wd=30,Gd=40,zd=50;function fn(r,i,s,l){let f={filename:r,function:i==="<anonymous>"?st:i,in_app:!0};return s!==void 0&&(f.lineno=s),l!==void 0&&(f.colno=l),f}let Jd=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Yd=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Xd=/\((\S*)(?::(\d+))(?::(\d+))\)/,Fs=[Wd,r=>{let i=Jd.exec(r);if(i){let[,l,f,h]=i;return fn(l,st,+f,+h)}let s=Yd.exec(r);if(s){if(s[2]&&s[2].indexOf("eval")===0){let b=Xd.exec(s[2]);b&&(s[2]=b[1],s[3]=b[2],s[4]=b[3])}let[f,h]=$s(s[1]||st,s[2]);return fn(h,f,s[3]?+s[3]:void 0,s[4]?+s[4]:void 0)}}],qd=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Qd=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Ns=[zd,r=>{let i=qd.exec(r);if(i){if(i[3]&&i[3].indexOf(" > eval")>-1){let h=Qd.exec(i[3]);h&&(i[1]=i[1]||"eval",i[3]=h[1],i[4]=h[2],i[5]="")}let l=i[3],f=i[1]||st;return[f,l]=$s(f,l),fn(l,f,i[4]?+i[4]:void 0,i[5]?+i[5]:void 0)}}],Zd=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,ep=[Gd,r=>{let i=Zd.exec(r);return i?fn(i[2],i[1]||st,+i[3],i[4]?+i[4]:void 0):void 0}],tp=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,np=[Hd,r=>{let i=tp.exec(r);return i?fn(i[2],i[3]||st,+i[1]):void 0}],rp=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\(.*\))? in (.*):\s*$/i,ip=[Vd,r=>{let i=rp.exec(r);return i?fn(i[5],i[3]||i[4]||st,+i[1],+i[2]):void 0}],Ls=[Fs,Ns],Bs=va(...Ls),$s=(r,i)=>{let s=r.indexOf("safari-extension")!==-1,l=r.indexOf("safari-web-extension")!==-1;return s||l?[r.indexOf("@")!==-1?r.split("@")[0]:st,s?`safari-extension:${i}`:`safari-web-extension:${i}`]:[r,i]},Ar=1024,op="Breadcrumbs",Us=((r={})=>{let i={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...r};return{name:op,setup(s){i.console&&Ju(cp(s)),i.dom&&Rd(sp(s,i.dom)),i.xhr&&Ud(up(s)),i.fetch&&Qu(lp(s)),i.history&&Os(fp(s)),i.sentry&&s.on("beforeSendEvent",ap(s))}}});function ap(r){return function(s){ve()===r&&yt({category:`sentry.${s.type==="transaction"?"transaction":"event"}`,event_id:s.event_id,level:s.level,message:xt(s)},{event:s})}}function sp(r,i){return function(l){if(ve()!==r)return;let f,h,b=typeof i=="object"?i.serializeAttribute:void 0,I=typeof i=="object"&&typeof i.maxStringLength=="number"?i.maxStringLength:void 0;I&&I>Ar&&(M.warn(`\`dom.maxStringLength\` cannot exceed ${Ar}, but a value of ${I} was configured. Sentry will use ${Ar} instead.`),I=Ar),typeof b=="string"&&(b=[b]);try{let K=l.event,Y=dp(K)?K.target:K;f=X(Y,{keyAttrs:b,maxStringLength:I}),h=ue(Y)}catch{f="<unknown>"}if(f.length===0)return;let R={category:`ui.${l.name}`,message:f};h&&(R.data={"ui.component_name":h}),yt(R,{event:l.event,name:l.name,global:l.global})}}function cp(r){return function(s){if(ve()!==r)return;let l={category:"console",data:{arguments:s.args,logger:"console"},level:pl(s.level),message:k(s.args," ")};if(s.level==="assert")if(s.args[0]===!1)l.message=`Assertion failed: ${k(s.args.slice(1)," ")||"console.assert"}`,l.data.arguments=s.args.slice(1);else return;yt(l,{input:s.args,level:s.level})}}function up(r){return function(s){if(ve()!==r)return;let{startTimestamp:l,endTimestamp:f}=s,h=s.xhr[Hn];if(!l||!f||!h)return;let{method:b,url:I,status_code:R,body:K}=h,Y={method:b,url:I,status_code:R},J={xhr:s.xhr,input:K,startTimestamp:l,endTimestamp:f};yt({category:"xhr",data:Y,type:"http"},J)}}function lp(r){return function(s){if(ve()!==r)return;let{startTimestamp:l,endTimestamp:f}=s;if(f&&!(s.fetchData.url.match(/sentry_key/)&&s.fetchData.method==="POST"))if(s.error){let h=s.fetchData,b={data:s.error,input:s.args,startTimestamp:l,endTimestamp:f};yt({category:"fetch",data:h,level:"error",type:"http"},b)}else{let h=s.response,b={...s.fetchData,status_code:h&&h.status},I={input:s.args,response:h,startTimestamp:l,endTimestamp:f};yt({category:"fetch",data:b,type:"http"},I)}}}function fp(r){return function(s){if(ve()!==r)return;let l=s.from,f=s.to,h=Ai(oe.location.href),b=l?Ai(l):void 0,I=Ai(f);(!b||!b.path)&&(b=h),h.protocol===I.protocol&&h.host===I.host&&(f=I.relative),h.protocol===b.protocol&&h.host===b.host&&(l=b.relative),yt({category:"navigation",data:{from:l,to:f}})}}function dp(r){return!!r&&!!r.target}let pp=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],hp="BrowserApiErrors",Ks=((r={})=>{let i={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...r};return{name:hp,setupOnce(){i.setTimeout&&De(oe,"setTimeout",js),i.setInterval&&De(oe,"setInterval",js),i.requestAnimationFrame&&De(oe,"requestAnimationFrame",mp),i.XMLHttpRequest&&"XMLHttpRequest"in oe&&De(XMLHttpRequest.prototype,"send",gp);let s=i.eventTarget;s&&(Array.isArray(s)?s:pp).forEach(yp)}}});function js(r){return function(...i){let s=i[0];return i[0]=ln(s,{mechanism:{data:{function:It(r)},handled:!1,type:"instrument"}}),r.apply(this,i)}}function mp(r){return function(i){return r.apply(this,[ln(i,{mechanism:{data:{function:"requestAnimationFrame",handler:It(r)},handled:!1,type:"instrument"}})])}}function gp(r){return function(...i){let s=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(f=>{f in s&&typeof s[f]=="function"&&De(s,f,function(h){let b={mechanism:{data:{function:f,handler:It(h)},handled:!1,type:"instrument"}},I=_i(h);return I&&(b.mechanism.data.handler=It(I)),ln(h,b)})}),r.apply(this,i)}}function yp(r){let i=oe,s=i[r]&&i[r].prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(De(s,"addEventListener",function(l){return function(f,h,b){try{typeof h.handleEvent=="function"&&(h.handleEvent=ln(h.handleEvent,{mechanism:{data:{function:"handleEvent",handler:It(h),target:r},handled:!1,type:"instrument"}}))}catch{}return l.apply(this,[f,ln(h,{mechanism:{data:{function:"addEventListener",handler:It(h),target:r},handled:!1,type:"instrument"}}),b])}}),De(s,"removeEventListener",function(l){return function(f,h,b){let I=h;try{let R=I&&I.at;R&&l.call(this,f,R,b)}catch{}return l.call(this,f,I,b)}}))}let vp="GlobalHandlers",Hs=((r={})=>{let i={onerror:!0,onunhandledrejection:!0,...r};return{name:vp,setupOnce(){Error.stackTraceLimit=50},setup(s){i.onerror&&(bp(s),Vs("onerror")),i.onunhandledrejection&&(wp(s),Vs("onunhandledrejection"))}}});function bp(r){tl(i=>{let{stackParser:s,attachStacktrace:l}=Ws();if(ve()!==r||xs())return;let{msg:f,url:h,line:b,column:I,error:R}=i,K=Ep(Ki(s,R||f,void 0,l,!1),h,b,I);K.level="error",Er(K,{originalException:R,mechanism:{handled:!1,type:"onerror"}})})}function wp(r){rl(i=>{let{stackParser:s,attachStacktrace:l}=Ws();if(ve()!==r||xs())return;let f=_p(i),h=m(f)?Sp(f):Ki(s,f,void 0,l,!0);h.level="error",Er(h,{originalException:f,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function _p(r){if(m(r))return r;try{if("reason"in r)return r.reason;if("detail"in r&&"reason"in r.detail)return r.detail.reason}catch{}return r}function Sp(r){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(r)}`}]}}}function Ep(r,i,s,l){let f=r.exception=r.exception||{},h=f.values=f.values||[],b=h[0]=h[0]||{},I=b.stacktrace=b.stacktrace||{},R=I.frames=I.frames||[],K=isNaN(parseInt(l,10))?void 0:l,Y=isNaN(parseInt(s,10))?void 0:s,J=d(i)&&i.length>0?i:ne();return R.length===0&&R.push({colno:K,filename:J,function:st,in_app:!0,lineno:Y}),r}function Vs(r){M.log(`Global Handler attached: ${r}`)}function Ws(){let r=ve();return r&&r.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}let Gs=()=>({name:"HttpContext",preprocessEvent(r){if(!oe.navigator&&!oe.location&&!oe.document)return;let i=r.request&&r.request.url||oe.location&&oe.location.href,{referrer:s}=oe.document||{},{userAgent:l}=oe.navigator||{},f={...r.request&&r.request.headers,...s&&{Referer:s},...l&&{"User-Agent":l}},h={...r.request,...i&&{url:i},headers:f};r.request=h}}),Ip="cause",xp=5,Tp="LinkedErrors",zs=((r={})=>{let i=r.limit||xp,s=r.key||Ip;return{name:Tp,preprocessEvent(l,f,h){let b=h.getOptions();U(Tr,b.stackParser,b.maxValueLength,s,i,l,f)}}});function Js(r){return[ws(),bs(),Ks(),Us(),Hs(),zs(),_s(),Gs()]}function kp(r={}){return{...{defaultIntegrations:Js(),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:oe.SENTRY_RELEASE&&oe.SENTRY_RELEASE.id?oe.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0},...r}}function Cp(){let r=oe,i=r.chrome?"chrome":"browser",s=r[i],l=s&&s.runtime&&s.runtime.id,f=oe.location&&oe.location.href||"",h=["chrome-extension:","moz-extension:","ms-browser-extension:"],b=!!l&&oe===oe.top&&h.some(R=>f.startsWith(`${R}//`)),I=typeof r.nw<"u";return!!l&&!b&&!I}function Ap(r={}){let i=kp(r);if(Cp()){se(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}_a()||M.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill.");let s={...i,stackParser:Gu(i.stackParser||Bs),integrations:Hf(i),transport:i.transport||Ms},l=Yf(As,s);return i.autoSessionTracking&&Rp(),l}function Pp(r={}){if(!oe.document){M.error("Global document not defined in showReportDialog call");return}let i=$e(),s=i.getClient(),l=s&&s.getDsn();if(!l){M.error("DSN not configured for showReportDialog call");return}if(i&&(r.user={...i.getUser(),...r.user}),!r.eventId){let I=as();I&&(r.eventId=I)}let f=oe.document.createElement("script");f.async=!0,f.crossOrigin="anonymous",f.src=Kf(l,r),r.onLoad&&(f.onload=r.onLoad);let{onClose:h}=r;if(h){let I=R=>{if(R.data==="__sentry_reportdialog_closed__")try{h()}finally{oe.removeEventListener("message",I)}};oe.addEventListener("message",I)}let b=oe.document.head||oe.document.body;b?b.appendChild(f):M.error("Not injecting report dialog. No injection point found in HTML")}function Dp(){}function Op(r){r()}function Rp(){if(typeof oe.document>"u"){M.warn("Session tracking in non-browser environment with @sentry/browser is not supported.");return}Ir({ignoreDuration:!0}),Ni(),Os(({from:r,to:i})=>{r!==void 0&&r!==i&&(Ir({ignoreDuration:!0}),Ni())})}function Mp(r){let i=ve();i&&i.captureUserFeedback(r)}let wg={replayIntegration:"replay",replayCanvasIntegration:"replay-canvas",feedbackIntegration:"feedback",feedbackModalIntegration:"feedback-modal",feedbackScreenshotIntegration:"feedback-screenshot",captureConsoleIntegration:"captureconsole",contextLinesIntegration:"contextlines",linkedErrorsIntegration:"linkederrors",debugIntegration:"debug",dedupeIntegration:"dedupe",extraErrorDataIntegration:"extraerrordata",httpClientIntegration:"httpclient",reportingObserverIntegration:"reportingobserver",rewriteFramesIntegration:"rewriteframes",sessionTimingIntegration:"sessiontiming",browserProfilingIntegration:"browserprofiling"},_g=oe;async function Fp(r){throw new Error("Disabled due to CWS Policy requirement.")}function Sg(r){}return e.BrowserClient=As,e.SDK_VERSION=F,e.SEMANTIC_ATTRIBUTE_SENTRY_OP=Ha,e.SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN=Va,e.SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE=ja,e.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE=Ka,e.Scope=gt,e.WINDOW=oe,e.addBreadcrumb=yt,e.addEventProcessor=Nf,e.addIntegration=Wf,e.breadcrumbsIntegration=Us,e.browserApiErrorsIntegration=Ks,e.browserTracingIntegration=wd,e.captureEvent=Er,e.captureException=Za,e.captureMessage=Of,e.captureSession=Ni,e.captureUserFeedback=Mp,e.chromeStackLineParser=Fs,e.close=Mf,e.continueTrace=hf,e.createTransport=ms,e.createUserFeedbackEnvelope=Cs,e.dedupeIntegration=_s,e.defaultStackLineParsers=Ls,e.defaultStackParser=Bs,e.endSession=Kn,e.eventFromException=Ts,e.eventFromMessage=ks,e.exceptionFromError=Tr,e.feedbackAsyncIntegration=Na,e.feedbackIntegration=Na,e.flush=Rf,e.forceLoad=Dp,e.functionToStringIntegration=bs,e.geckoStackLineParser=Ns,e.getClient=ve,e.getCurrentHub=vd,e.getCurrentScope=$e,e.getDefaultIntegrations=Js,e.getGlobalScope=Ua,e.getIsolationScope=je,e.globalHandlersIntegration=Hs,e.httpContextIntegration=Gs,e.inboundFiltersIntegration=ws,e.init=Ap,e.isInitialized=Ff,e.lastEventId=as,e.lazyLoadIntegration=Fp,e.linkedErrorsIntegration=zs,e.makeFetchTransport=Ms,e.metrics=_d,e.onLoad=Op,e.opera10StackLineParser=np,e.opera11StackLineParser=ip,e.parameterize=qf,e.replayIntegration=Bl,e.setContext=es,e.setCurrentClient=hs,e.setExtra=ns,e.setExtras=ts,e.setTag=is,e.setTags=rs,e.setUser=os,e.showReportDialog=Pp,e.spanToBaggageHeader=uf,e.spanToJSON=$n,e.spanToTraceHeader=nf,e.startSession=Ir,e.winjsStackLineParser=ep,e.withIsolationScope=Yl,e.withScope=Sr,e})({});var Wi,Vn,Xs,qs,Qs,Lp,Wn,Oe,Re,Me,Fe,Gi,zi,Dr,Ji,Zs,ec,vt,Or;vt=function(e,t){var n,o;return n=(e&65535)+(t&65535),o=(e>>16)+(t>>16)+(n>>16),o<<16|n&65535};Xs=function(e,t){return e<<t|e>>>32-t};Wn=function(e,t,n,o,a,c){return vt(Xs(vt(vt(t,e),vt(o,c)),a),n)};Oe=function(e,t,n,o,a,c,u){return Wn(t&n|~t&o,e,t,a,c,u)};Re=function(e,t,n,o,a,c,u){return Wn(t&o|n&~o,e,t,a,c,u)};Me=function(e,t,n,o,a,c,u){return Wn(t^n^o,e,t,a,c,u)};Fe=function(e,t,n,o,a,c,u){return Wn(n^(t|~o),e,t,a,c,u)};Vn=function(e,t){var n,o,a,c,u,d,p,m,g;for(e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t,u=void 0,d=void 0,p=void 0,m=void 0,g=void 0,n=1732584193,o=-271733879,a=-1732584194,c=271733878,u=0;u<e.length;)d=n,p=o,m=a,g=c,n=Oe(n,o,a,c,e[u],7,-680876936),c=Oe(c,n,o,a,e[u+1],12,-389564586),a=Oe(a,c,n,o,e[u+2],17,606105819),o=Oe(o,a,c,n,e[u+3],22,-1044525330),n=Oe(n,o,a,c,e[u+4],7,-176418897),c=Oe(c,n,o,a,e[u+5],12,1200080426),a=Oe(a,c,n,o,e[u+6],17,-1473231341),o=Oe(o,a,c,n,e[u+7],22,-45705983),n=Oe(n,o,a,c,e[u+8],7,1770035416),c=Oe(c,n,o,a,e[u+9],12,-1958414417),a=Oe(a,c,n,o,e[u+10],17,-42063),o=Oe(o,a,c,n,e[u+11],22,-1990404162),n=Oe(n,o,a,c,e[u+12],7,1804603682),c=Oe(c,n,o,a,e[u+13],12,-40341101),a=Oe(a,c,n,o,e[u+14],17,-1502002290),o=Oe(o,a,c,n,e[u+15],22,1236535329),n=Re(n,o,a,c,e[u+1],5,-165796510),c=Re(c,n,o,a,e[u+6],9,-1069501632),a=Re(a,c,n,o,e[u+11],14,643717713),o=Re(o,a,c,n,e[u],20,-373897302),n=Re(n,o,a,c,e[u+5],5,-701558691),c=Re(c,n,o,a,e[u+10],9,38016083),a=Re(a,c,n,o,e[u+15],14,-660478335),o=Re(o,a,c,n,e[u+4],20,-405537848),n=Re(n,o,a,c,e[u+9],5,568446438),c=Re(c,n,o,a,e[u+14],9,-1019803690),a=Re(a,c,n,o,e[u+3],14,-187363961),o=Re(o,a,c,n,e[u+8],20,1163531501),n=Re(n,o,a,c,e[u+13],5,-1444681467),c=Re(c,n,o,a,e[u+2],9,-51403784),a=Re(a,c,n,o,e[u+7],14,1735328473),o=Re(o,a,c,n,e[u+12],20,-1926607734),n=Me(n,o,a,c,e[u+5],4,-378558),c=Me(c,n,o,a,e[u+8],11,-2022574463),a=Me(a,c,n,o,e[u+11],16,1839030562),o=Me(o,a,c,n,e[u+14],23,-35309556),n=Me(n,o,a,c,e[u+1],4,-1530992060),c=Me(c,n,o,a,e[u+4],11,1272893353),a=Me(a,c,n,o,e[u+7],16,-155497632),o=Me(o,a,c,n,e[u+10],23,-1094730640),n=Me(n,o,a,c,e[u+13],4,681279174),c=Me(c,n,o,a,e[u],11,-358537222),a=Me(a,c,n,o,e[u+3],16,-722521979),o=Me(o,a,c,n,e[u+6],23,76029189),n=Me(n,o,a,c,e[u+9],4,-640364487),c=Me(c,n,o,a,e[u+12],11,-421815835),a=Me(a,c,n,o,e[u+15],16,530742520),o=Me(o,a,c,n,e[u+2],23,-995338651),n=Fe(n,o,a,c,e[u],6,-198630844),c=Fe(c,n,o,a,e[u+7],10,1126891415),a=Fe(a,c,n,o,e[u+14],15,-1416354905),o=Fe(o,a,c,n,e[u+5],21,-57434055),n=Fe(n,o,a,c,e[u+12],6,1700485571),c=Fe(c,n,o,a,e[u+3],10,-1894986606),a=Fe(a,c,n,o,e[u+10],15,-1051523),o=Fe(o,a,c,n,e[u+1],21,-2054922799),n=Fe(n,o,a,c,e[u+8],6,1873313359),c=Fe(c,n,o,a,e[u+15],10,-30611744),a=Fe(a,c,n,o,e[u+6],15,-1560198380),o=Fe(o,a,c,n,e[u+13],21,1309151649),n=Fe(n,o,a,c,e[u+4],6,-145523070),c=Fe(c,n,o,a,e[u+11],10,-1120210379),a=Fe(a,c,n,o,e[u+2],15,718787259),o=Fe(o,a,c,n,e[u+9],21,-343485551),n=vt(n,d),o=vt(o,p),a=vt(a,m),c=vt(c,g),u+=16;return[n,o,a,c]};Wi=function(e){var t,n,o;for(t=void 0,o="",n=e.length*32,t=0;t<n;)o+=String.fromCharCode(e[t>>5]>>>t%32&255),t+=8;return o};Dr=function(e){var t,n,o;for(t=void 0,o=[],o[(e.length>>2)-1]=void 0,t=0;t<o.length;)o[t]=0,t+=1;for(n=e.length*8,t=0;t<n;)o[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32,t+=8;return o};ec=function(e){return Wi(Vn(Dr(e),e.length*8))};Zs=function(e,t){var n,o,a,c,u;for(a=void 0,n=Dr(e),c=[],u=[],o=void 0,c[15]=u[15]=void 0,n.length>16&&(n=Vn(n,e.length*8)),a=0;a<16;)c[a]=n[a]^909522486,u[a]=n[a]^1549556828,a+=1;return o=Vn(c.concat(Dr(t)),512+t.length*8),Wi(Vn(u.concat(o),640))};Ji=function(e){var t,n,o,a;for(t="0123456789abcdef",o="",a=void 0,n=void 0,n=0;n<e.length;)a=e.charCodeAt(n),o+=t.charAt(a>>>4&15)+t.charAt(a&15),n+=1;return o};Or=function(e){return unescape(encodeURIComponent(e))};zi=function(e){return ec(Or(e))};Qs=function(e){return Ji(zi(e))};Gi=function(e,t){return Zs(Or(e),Or(t))};qs=function(e,t){return Ji(Gi(e,t))};var Bp=Lp=function(e,t,n){return t?n?Gi(t,e):qs(t,e):n?zi(e):Qs(e)},Rr=Bp;var Ct=kt,Yi=!1,ct=e=>(...t)=>{try{return e(...t)}catch(n){Ct.captureException(n),console.error(n)}},dn=(e,t)=>async(...n)=>{try{return await e(...n)}catch(o){Ct.captureException(o),console.error(o),t&&t(o)}};async function Gn(e){return(await chrome.storage.local.get(e)||{})[e]}async function $p(){let e=await Gn(y.he);try{if(!e||(e?.lastUpdated||0)+(e?.validity||0)<Date.now()){O("Fetching sentry filter...")();let t=Ne().extVersionFull,n=await fetch(y.Xe.replace("%VERSION%",t),{cache:"reload"});if(n.status===200){e=await n.json(),e.lastUpdated=Date.now();let o={};o[y.he]=e,await chrome.storage.local.set(o)}}}catch{}return e||{}}function Up(e,t,n){if(e.action==="deny all")return O("Error reporting is 'deny all'")(),!0;if(e.action==="filter"&&e.patterns){ie&&(n&&console.log(n),t&&console.log(t));let o=!1;for(let a of e.patterns){if(a.hash&&a.hash===t)O("Sentry filter matched hash: "+t)(),o=!0;else if(a.regex&&n){let[,c,u]=a.regex.match(/^\/(.+)\/(.*)$/)||[];o=c&&n.match(new RegExp(c,u))!==null,o&&O("Sentry filter matched regex: "+a.regex)()}if(o){let c=a.rate||1;if(Math.random()>c)return O("Sentry filter matched a rate-limited pattern with rate: "+c)(),`[x${Math.round(1/(1-c)*10)/10}]`;break}}return o}else return!1}async function Kp(e){let t=await Gn(y.a),n=await Gn(y.u),o=await Gn(y.t)=="true";return e.tags={...e.tags||{}},t&&(e.tags.UUID=t),n&&(e.tags.Serial=n),e.tags.Pro=o,e}function jp(){let e=chrome.runtime.id;return!["mcbpblocgmgfnpjjppndjkmgjaogfceg","kmmldmlijnljnnhagfldmihaimmholga","pbjmgmedeliohhbaefhlplndokcbmjio","fcbmiimfkmkkkffjlopcpdlgclncnkn","fireshot-beta@getfireshot.com","{0b457cAA-602d-484a-8fe7-c1d894a011ba}","{5e11ab1e-083c-11e5-a6c0-1697f925ec7b}","com.getfireshot.fireshot.extension (83PVANDQL9)"].includes(e)}async function Hp(){return chrome.runtime.id==="fireshot-beta@getfireshot.com"||chrome.runtime.id==="{0b457cAA-602d-484a-8fe7-c1d894a011ba}"?(await browser.permissions.getAll())?.data_collection?.includes("technicalAndInteraction")?"true":"false":Gn(y.$e)}function tc(){(self||window).nw={},Yi=!0;function e(t){function n(o){O("Reporting error...")();let a={body:o.body,method:"POST",referrerPolicy:"origin",headers:t.headers,...t.fetchOptions};return fetch(t.url,a).then(c=>({statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}return Ct.createTransport(t,n)}Ct.init({dsn:"https://a45606e8915fe486ea11781be7653734@o4507590541901824.ingest.us.sentry.io/4507590546096128",release:"head@"+Ne().extVersionFull,debug:ie,autoSessionTracking:!1,transport:e,integrations:[],beforeSend:t=>Hp().then(n=>n==="false"?(ie&&(O(t)(),O("Sentry is disabled")()),null):jp()?(O("Extension not recognized, skipping error report")(),null):new Promise(o=>{let a=(c,u)=>{t.breadcrumbs=[{level:c,timestamp:Date.now()/1e3,message:u},...t.breadcrumbs||[]]};try{let c,u,d=t?.exception?.values?.slice(-1).pop();if(d){let m=d.stacktrace?.frames;if(m?.length>0){let g=m.map(_=>({filename:_.filename,lineno:_.lineno,colno:_.colno,function:_.function})),v=JSON.stringify(g);c=Rr(v),a("debug",v),a("info",`FSHASH: ${c}`)}u=d.type.trim()+": "+d.value.trim()}!c&&!u&&o(t);let p=$p().then(m=>{let g=Up(m,c,u);if(typeof g=="string"){let v=g;t.message&&(t.message=`${v} ${t.message}`),t.exception&&t.exception.values&&t.exception.values.forEach(_=>{_.value&&(_.value=`${v} ${_.value}`)}),g=!1}return g?null:Kp(t)}).catch(m=>(a("debug",m.message+" "+m.stack),t));o(p)}catch(c){a("debug",c.message+" "+c.stack),o(t)}}))})}function zn(e){Yi&&Ct.addBreadcrumb({message:e})}function nc(e,t){Yi&&Ct.captureMessage(e,t)}function At(){return/^win/i.test(navigator.platform)}function rc(){return/opr\/\d+\./i.test(navigator.appVersion)||chrome.runtime.id==="pbjmgmedeliohhbaefhlplndokcbmjio"}function ic(){return/edg\/\d+\./i.test(navigator.appVersion)||chrome.runtime.id==="fcbmiimfkmkkkffjlopcpdlgclncnknm"}function Ie(){return typeof browser<"u"&&typeof browser.runtime<"u"&&typeof browser.runtime.getBrowserInfo>"u"}function Le(){return typeof browser<"u"&&typeof browser.runtime?.getBrowserInfo=="function"}function Mr(){return chrome.runtime.getManifest().manifest_version===2}function ut(){return rc()?"op":ic()?"edge":Ie()?"safari":Le()?"fx":"ch"}function Vp(){var e=chrome.runtime.id;if(e==="legfpnnmhhnhjgekmmbkilmijnjoehne")return rc()?"opera":ic()?"edge":"chrome";let t=["pbjmgmedeliohhbaefhlplndokcbmjio"],n=["fireshot@getfireshot.com","fireshot-pro@getfireshot.com","fireshot-beta@getfireshot.com","{0b457cAA-602d-484a-8fe7-c1d894a011ba}","{5e11ab1e-083c-11e5-a6c0-1697f925ec7b}"],o=["fcbmiimfkmkkkffjlopcpdlgclncnknm"];return t.indexOf(e)>-1?"opera":n.indexOf(e)>-1?"firefox":o.indexOf(e)>-1?"edge":"chrome"}var qi=Vp(),pn={contractId:{chrome:"com.getfireshot.api",opera:"com.getfireshot.api",edge:"com.getfireshot.api",firefox:"com.getfireshot.api.firefox"},nativeFilePath:{chrome:"fireshot-chrome-plugin.dat",opera:"fireshot-chrome-plugin.dat",edge:"fireshot-chrome-plugin.dat",firefox:"fireshot-chrome-plugin.dat"}};for(Xi in pn)pn[Xi]=pn[Xi][qi];var Xi;function Wp(){chrome.scripting||(chrome.scripting={}),chrome.scripting.executeScript||(chrome.scripting.executeScript=function(e){return new Promise((t,n)=>{let o=e.target?.tabId,a=(e.target?.frameIds||[void 0])[0],c=e.target?.allFrames,u={};if(a!==void 0&&(u.frameId=a),c!==void 0&&(u.allFrames=c),!o){n(new Error("chrome.scripting.executeScript polyfill: Missing target.tabId"));return}if(e.files&&e.files.length>0){let d=[],p=m=>{if(m>=e.files.length){t(d);return}chrome.tabs.executeScript(o,{file:e.files[m],runAt:"document_start",...u},g=>{d.push(g),p(m+1)})};p(0);return}if(e.func){let d;e.args&&e.args.length>0?d=`(${e.func})(${e.args.map(p=>JSON.stringify(p)).join(",")});`:d=`(${e.func})();`,chrome.tabs.executeScript(o,{code:d}).then(t).catch(n);return}n(new Error("chrome.scripting.executeScript polyfill: No files or func provided"))})}),chrome.scripting.insertCSS||(chrome.scripting.insertCSS=function({target:e,files:t,css:n}){return new Promise((o,a)=>{if(!e||!e.tabId){a(new Error("chrome.scripting.insertCSS: target.tabId is required"));return}if(t&&t.length){let c=t.length;t.forEach(u=>{chrome.tabs.insertCSS(e.tabId,{file:u},()=>{chrome.runtime.lastError&&console.warn(chrome.runtime.lastError),--c===0&&o()})})}else n?chrome.tabs.insertCSS(e.tabId,{code:n},()=>{chrome.runtime.lastError&&console.warn(chrome.runtime.lastError),o()}):a(new Error("chrome.scripting.insertCSS: either files[] or css is required"))})})}function Gp(){if(!chrome.alarms){let n=function(a){if(t.length){let c={name:a,scheduledTime:Date.now()};t.forEach(u=>u(c))}},e={},t=[],o={create(a,c={}){this.clear(a);let u=Date.now(),d,p;c.when?d=c.when-u:c.delayInMinutes&&(d=c.delayInMinutes*60*1e3),c.periodInMinutes&&(p=c.periodInMinutes*60*1e3),d<0&&(d=0);function m(){n(a),p&&(e[a].id=setTimeout(m,p))}let g=d>0?d:p;g>0?e[a]={id:setTimeout(m,g),period:p}:console.error("Error in setting alarm, none of delay or period specified")},clear(a,c=u=>{}){e[a]?(clearTimeout(e[a].id),delete e[a],c(!0)):c(!1)},clearAll(a=c=>{}){Object.keys(e).forEach(c=>clearTimeout(e[c].id));for(let c in e)delete e[c];a(!0)},get(a,c=u=>{}){e[a]?c({name:a,scheduledTime:Date.now()}):c(void 0)},getAll(a=c=>{}){let c=Object.keys(e).map(u=>({name:u,scheduledTime:Date.now()}));a(c)},onAlarm:{addListener(a){t.push(a)},removeListener(a){let c=t.indexOf(a);c>=0&&t.splice(c,1)}}};chrome.alarms=o}}function zp(){if(!chrome.action){let e={setBadgeBackgroundColor:t=>{browser.browserAction.setBadgeBackgroundColor(t)},setBadgeTextColor:(t,n)=>{Ie()?n&&n():browser.browserAction.setBadgeTextColor(t).then(n)},setBadgeText:(t,n)=>{chrome.browserAction.setBadgeText(t,n)},setIcon:(t,n)=>{chrome.browserAction.setIcon(t,n)}};chrome.action=e}}Le()&&(window.chrome=window.browser);Wp();Gp();zp();var Jn="alarmUpdateToken",Nr=360,Zi=30,oc="b2s=",Ce=Object.freeze({success:0,networkError:1,rejectedByServer:2,invalidResponse:3,noValidExistingToken:4,tokenInactive:5});function ac(e){for(let t in Ce)if(Ce[t]===e)return t;return"unknown status"}function sc(){return Fr(JSON.stringify({UA:navigator.userAgent,rid:new Date().getTime(),hwid:de.getOption(y.we,""),extver:chrome.runtime.getManifest().version}))}var Qi=class{async st(){O("Checking token activation")();let t=q(y.b),n=q(y.u);t&&n&&await this.W(hn(t,n),n)}async te(t,n,o){await this.ne();let a=await this.ct(t,n,kt);if(a.result)return ee("setToken",{data:await bt()}),Yn(),a;if(a?.code==="104"&&!o)try{let[,c]=a.message.match(/\[\d+\]\s*(.+)$/);return G(y.ye,c),G(y.ve,n),await this.te(c,n,!0)}catch(c){return{result:!1,message:c.message}}else return{result:!1,message:a.message}}async W(t,n){return await this.ut(t,n)?await this.te(t,n):(O("Activation is not required")(),{result:!0})}#i=!1;async Se(t){if(this.#i){O("Token update already in progress.")();return}this.#i=!0,await dn(async()=>{await this.lt(kt),ee("setToken",{data:await bt()}),Yn(),t&&t(!0)})(),this.#i=!1}async re(){await chrome.alarms.create(Jn,{periodInMinutes:Zi})}async ft(){await bt()?await chrome.alarms.get(Jn)||(O("Scheduling token update alarm")(),await this.re()):(O("No token found, not scheduling update timer")(),this.G())}async G(){O("Disabling token update timer")(),await chrome.alarms.clear(Jn)}async ne(){O("Removing token from the storage")(),await chrome.storage.local.set({[y.o]:""}),await this.G()}async ie(t,n,o){let a=p=>p.user&&p.serial?`${Fr(p.user)}/${Fr(p.serial)}`:p.sid?p.sid:null,c=async p=>{let m;try{m=await fetch(p,{signal:AbortSignal.timeout(1e4),credentials:"include",method:"get",headers:{"X-FS-DATA":sc()}})}catch(v){return v.message||"Network error occurred while fetching the response"}if(!m.ok)return`Network error: ${m.status} ${m.statusText}`;let g;try{g=await m.json(),O("Received response: "+JSON.stringify(g))()}catch{return"Invalid response from server"}return g},d=await(async()=>{ie||(n=void 0),ie||(o=void 0);let p=n||await Lr(),m=o||chrome.runtime.id,g=a(t);if(!g)return"Invalid credentials";let v=`${eo}/activate/${g}/${p}/${btoa(m)}`,_=await c(v);if(typeof _!="object"||!_.status)return JSON.stringify(_);if(btoa(_.status)===oc){let w=await new zt(_.payload).Ee();return w===null&&(await chrome.storage.local.set({[y.o]:_.payload}),await this.re()),w}return _.message||"Unknown error"})();return d?{result:!1,code:(/\[(\d+)\]/.exec(d)||[])[1],message:d}:{result:!0}}async dt(){let t=async c=>{let u=!1;switch(c){case Ce.noValidExistingToken:await this.ne();break;case Ce.networkError:u=!0;break;case Ce.invalidResponse:u=!0;break;case Ce.success:u=!0;break;case Ce.tokenInactive:await this.G();break;case Ce.rejectedByServer:await this.ne();break}u&&await this.re()},n=async c=>{let u;try{if(u=await fetch(c,{signal:AbortSignal.timeout(1e4),method:"get",headers:{"X-FS-DATA":sc()}}),!u.ok)return Ce.networkError;let d=await u.json();return O("Received response from server: "+JSON.stringify(d))(),d}catch(d){return O("Network error while fetching update: "+d)(),Ce.networkError}},a=await(async()=>{let c=await bt();if(!c)return Ce.noValidExistingToken;let u,d=!1;try{u=await rt(c),d=u.S()}catch(g){return O("Error while parsing old token: "+g)(),Ce.noValidExistingToken}if(!ie&&!d)return Ce.tokenInactive;let p=await n(await u.pt());if(typeof p=="number")return p;if(typeof p!="object"||!p.status)return Ce.invalidResponse;if(btoa(p.status)===oc){O("Received token")();let v=await(await new zt(p.payload)).Ee();return v!==null?(O("Error while parsing new token: "+v)(),Ce.invalidResponse):(await chrome.storage.local.set({[y.o]:p.payload}),Ce.success)}else return Ce.rejectedByServer})();return O("update status: "+ac(a))(),await t(a),a}async ht(t){try{let o=(await rt(t)).Ie();await fetch(`https://auth.getfireshot.com/deactivate/${o.sid}/${o.guid}/${btoa(o.eid)}`),await this.G(),O("Token successfully deactivated")()}catch{}}async ut(t,n){if(!t||!n)return!0;let o=await rt();if(o){let a,c;try{a=o.Ie(),c=o.S()}catch{return!0}if(c){if(a&&a.user===t&&a.serial===n)return!1}else return!0}return!0}async ct(t,n,o){let a=await this.ie({user:t,serial:n});if(a.result)return a;{let c=a.code,u=a.message;return O(`Failed to activate token with user '${t}' and serial '${n}'. Code: ${c}, Message: ${u}`)(),a}}async lt(t){let n=await this.dt();return n!==Ce.success?(n!==Ce.networkError&&t?.captureException(`Failed to update token [${ac(n)}]`),!1):!0}async xe(){let t=await rt();t&&(t.mt()?(O(`Time since last token update: ${Math.round((new Date-new Date(t.L().c+"Z"))/1e3/6)/10} minutes.`)(),await this.Se()):O(`Token (${t.gt()} old) does not need update at this time (update period is ${Nr} minutes).`)())}async yt(t){let n;try{n=await new zt(t).z(!0)}catch{return}if(n&&n.S()&&n.oe()&&n.Te()&&!n.J()){O("Found previous token, restoring...")();let o=n.ke();(await this.ie({sid:o})).result&&(ee("setToken",{data:await bt()}),O("... successfully restored."))}}};async function cc(e,t,n,o){async function a(c){return new Promise(u=>setTimeout(u,c))}try{t!=="create"&&await a(1e3);let c=await Lr(),u=o?`/${btoa(o)}`:"";await fetch(`https://auth.getfireshot.com/experiment/v2/${t}/${e}/${c}${u}`,{method:"get",mode:"no-cors",signal:AbortSignal.timeout(1e4)})}catch{}}var Ke=new Qi;var uc=Object.freeze({active:"YWN0aXZl",past_due:"cGFzdF9kdWU=",canceled:"canceY2FuY2VsZWQled"}),eo="https://auth.getfireshot.com",zt=class{#i="";#e=null;constructor(t){this.#i=t}async#s(t){async function n(_){let D="object",w=typeof x,E=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(D)),S=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(w)),T=await crypto.subtle.importKey("raw",E,"AES-CBC",!1,["decrypt"]),C=await crypto.subtle.decrypt({name:"AES-CBC",iv:new Uint8Array(S).subarray(0,16)},T,_);return T=null,new TextDecoder("utf-8").decode(C)}function o(_){return Uint8Array.from(atob(_),D=>D.charCodeAt(0))}function a(_){return Uint8Array.from(_,D=>D.charCodeAt(0))}async function c(_,D){let E=o(`
                MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAv7UA7s/pYDrVCY4kunni                DnmdnwgAxBpfqCOEFQZMGHh6G+/FsDbuyyQntq21W5Qi42P3UrPBJqnZ7wfhVsvj                TT9Kuty1r2mn3BD7zz2owamqtGX0s7JiQ4sdjDcVYwxTXbeq5rvX2Fh4PRQfGCIU                HWK8A4/rJDOwy0PseSnB+MsRh+XorlgMNm6VYpMkW6I2fERH96N97K9rS8HkEdLO                Y6mKYy5m41y1xttGhFxHRJkfbMlK0dqvkOI7RT0dRltnnb1x96HSabUok+A7+2fu                G3Pzb0lbVKKDuRsBIk2VExvMAW49JLy9Qi3y3iOgQQ/fmeLcv5JWe6YQQ3kyZP2O                iY01PF3V3UxH0yI5c6+13VENabHmfE1GAGSRikdZc7w5P3iuTJ+KxPLnrOFm1swl                ga23qG4rnZ1+b768dAUhWA1JRcpEaW4NKigb6x0vveaI09eTdNXHgnYtmMUx7Ubg                xeIdVtWXoJdrJ6tKMTrbaSUmJAur5lFhhdHd2RmJuT8SIIzWyGNroP5KxB+uOaPz                cltBajATKRSzwgSB6HP1rKADTRrNgVZQhIQJqJg2GoQQ0R5ijKdIOm95eraKnEeC                OvTlhVV+NHwo/QsoSBlMmpnFAS+S9AwiqH46xM0We1w9nlpEdb3ZcCVqm1NIK0Ta                3SbTHMwiWFh52R0DpU+AxiECAwEAAQ==`.replace(/\s/g,"")),S={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},T=await crypto.subtle.importKey("spki",E,S,!0,["verify"]);return await crypto.subtle.verify("RSASSA-PKCS1-v1_5",T,D,_)}let u=o(this.#i),d;try{d=await n(u)}catch(_){throw"Invalid token format: "+_}let p=JSON.parse(d);if(!p||!p.data||!p.signature)throw"Token misses data or signature";let m;try{m=await c(a(p.data),o(p.signature))}catch(_){throw"Error while checking signature: "+_}if(!m)throw"Signature is wrong";let g=JSON.parse(p.data),v=await Lr();if(!t&&g.guid!==v)throw"This token belongs to another extension guid.";if(!t&&g.eid!==chrome.runtime.id)throw"This token belongs to another extension.";return g}async z(t){try{return this.#e=await this.#s(t),this}catch{return null}}pt(){return`${eo}/update/${this.#e.sid}/${this.#e.guid}/${btoa(this.#e.eid)}`}vt(){return this.#e.status}bt(){return this.#e.owner}en(){return this.#e.plan}oe(){return typeof this.#e.enabled<"u"?this.#e.enabled:!0}gt(){let t=(new Date-new Date(this.L().c+"Z"))/1e3/60/60;return`${Math.floor(t)}h:${Math.floor((t-Math.floor(t))*60)}m`}mt(){return this.J()?!0:new Date-new Date(this.L().c+"Z")>Nr*60*1e3}Ce(){let t=new Date-new Date(this.L().c+"Z");return t>(Nr+Zi*4)*60*1e3?(O(`Token update expired: ${Math.round(t/1e3/60/6)/10} hours ago`)(),!0):!1}J(){let t=new Date-new Date(this.L().e+"Z");return t>0?(O(`Subscription expired: ${Math.round(t/1e3/60/6)/10} hours ago`)(),!0):!1}ae(){return this.oe()&&(!this.S()||this.J()&&this.Ce())}tn(){return this.#e.cap||1}Te(){return this.ke().substring(0,4)==="sub_"}ke(){return this.#e.sid}S(){let t=this.vt();if(!t)return!1;let n=btoa(t);return n===uc.active||n===uc.past_due}Ie(){return this.#e}L(){return{c:this.#e.c,s:this.#e.s,e:this.#e.e}}async Ee(){try{return await this.#s(),null}catch(t){return t}}};async function Lr(){return(await chrome.storage.local.get(y.a))[y.a]||""}async function bt(){return(await chrome.storage.local.get(y.o))[y.o]}async function rt(e){try{return await new zt(e||await bt()).z()}catch{return null}}var wt=chrome.runtime.id,ie=chrome.runtime.getManifest()?.version_name==="debug"||["legfpnnmhhnhjgekmmbkilmijnjoehne","fireshot-beta@getfireshot.com","kmmldmlijnljnnhagfldmihaimmholga"].indexOf(wt)>-1;chrome.storage.local.get([y.de]).then(e=>ie=ie||e[y.de]);var Jp=console.log.bind(console);O("Extension ID: "+wt)();function Yp(e){ie&&console.log(`${e} not implemented yet.`)}function to(){return q(y.me)==="true"||q(y.me)==="1"}function Xp(){return self.constructor.name==="ServiceWorkerGlobalScope"}function qp(){let e=q(y.A,"false")==="true";return Xp()&&e&&!ot.port?(G(y.A,"false"),!1):e}function Pt(){return to()?!1:qp()}function it(){return Pt()&&(q(y.N)!=="true"||q(y.t)==="true")}function Ne(){let e=chrome.runtime.getManifest();return{extVersion:e.version.split(".",3).join("."),extVersionFull:e.version.split(".",4).join("."),fSilentMode:wt=="legfpnnmhhnhjgekmmbkilmijnjoehne"}}function mn(e){O("openURLV2")();let n=(o,a=0)=>{a>0&&O(`trial ${a}`)();let c=()=>{++a<10?setTimeout(()=>n(o,a),150):chrome.windows.create({url:e}).catch(u=>reportError(u))};try{chrome.tabs.create(o).catch(()=>c())}catch{c()}};n({url:e})}function Xn(e,t){if(O("openURL")(),!t)return chrome.tabs.create({url:e});chrome.tabs.create({url:e},n=>{let o=(a,c)=>{if(a===n.id)switch(c.status){case"complete":chrome.tabs.onUpdated.removeListener(o),t(n);break}};chrome.tabs.onUpdated.addListener(o),setTimeout(()=>chrome.tabs.onUpdated.removeListener(o),1e4)})}function Ve(){return(...e)=>{if(e.length!==0)if(ie&&console.log.bind(console,...e)(),e.length>1)zn(JSON.stringify(e).substring(0,512));else{let t=typeof e[0]=="string"?e[0]:JSON.stringify(e);zn(t.substring(0,512))}}}function O(...e){let t=()=>{};if(e.length===0)return t;if(e.length>1)zn(JSON.stringify(e).substring(0,512));else{let n=typeof e[0]=="string"?e[0]:JSON.stringify(e);zn(n.substring(0,512))}return ie?Jp.bind(console,...e):t}function lt(e){ie&&console.time(e)}function ft(e){ie&&console.timeEnd(e)}function Jt(e){console.error("FireShot: "+e)}function gn(e,t,n,o,a){Yp("gaTrack")}function yn(e,t,n){for(e=e.toString();e.length<n;)e=t+e;return e}function vn(e){if(!e||!io()||q(y.Ue,"false")==="true"){G(y.ge,e),chrome.action.setBadgeBackgroundColor({color:"#c72a1c"});try{chrome.action.setBadgeTextColor({color:"#fff"})}catch{}chrome.action.setBadgeText({text:e?"New":""}),e&&O("Setting badge for url: "+e)()}}function no(){let e=parseInt(q(y.le,y.Y)),t=Br();return it()?t===y.O&&e===y.I&&(e=y.T):t===y.O&&e===y.T?e=y.I:(e===y.I||e===y.E)&&(t===y.i||t===y.k||t===y.m)&&(e=y.Y),e}function Br(){return parseInt(q(y.fe,y.i))}function ro(e,t){G(y.le,e),G(y.fe,t),Kr()}function Xe(){return Pt()?q(y.t)=="true":(!At()||q(y.N)==="true")&&q(y.t)=="true"}async function Yn(){let e=()=>{if(new Date>new Date(2026,1,15)&&!Pt()){let t,n=q(y.b,""),o=q(y.u,"");n!==""&&o!==""&&(n=hn(n,o),t=eh(n,o)),G(y.t,t?"true":""),G(y.p,t?"true":"")}};try{let t=await rt();if(t.oe())if(G(y.N,"true"),t.Te()){let n=t.S(),o=t.J(),a=t.Ce();O(`Token is active: ${n}, expired: ${o}, update expired: ${a}, blocked: ${o&&a}`)();let u=!t.ae();G(y.t,u.toString()),G(y.p,u.toString())}else G(y.t,t.S().toString()),G(y.p,t.S().toString());else e()}catch{q(y.N)==="true"?(G(y.N,""),G(y.t,""),G(y.p,""),G(y.b,""),G(y.u,"")):e()}}function io(){return q(y.p)==="true"}function lc(e){var t,n;if(e.substring(0,23)==="data:image/jpeg;base64,"&&(e=atob(e.replace("data:image/jpeg;base64,",""))),e.charCodeAt(0)!==255||e.charCodeAt(1)!==216||e.charCodeAt(2)!==255||e.charCodeAt(3)!==224||e.charCodeAt(6)!==74||e.charCodeAt(7)!==70||e.charCodeAt(8)!==73||e.charCodeAt(9)!==70||e.charCodeAt(10)!==0)throw new Error("getJpegSize requires a binary jpeg file");for(var o=e.charCodeAt(4)*256+e.charCodeAt(5),a=4,c=e.length;a<c;){if(a+=o,e.charCodeAt(a)!==255)throw new Error("getJpegSize could not find the size of the image");if(e.charCodeAt(a+1)===192)return n=e.charCodeAt(a+5)*256+e.charCodeAt(a+6),t=e.charCodeAt(a+7)*256+e.charCodeAt(a+8),[t,n];a+=2,o=e.charCodeAt(a)*256+e.charCodeAt(a+1)}}function oo(e){return Math.abs(e-Math.floor(e))<.009&&(e=Math.floor(e)),e}function bn(){return q(y.Be)==="true"}async function fc(e){if(Mr())return!0;let t="fsAPIScript";if(e){if((await chrome.scripting.getRegisteredContentScripts()).filter(a=>a.id===t).length>0)return O("Script is already registered, nothing to do")(),!0;let o={id:t,js:["scripts/page/fsAPIEvents.js"],matches:["<all_urls>"],excludeMatches:["*://getfireshot.com/activate*"]};try{await chrome.scripting.registerContentScripts([o])}catch(a){return console.error(`failed to register content scripts: ${a}`),!1}}else try{await chrome.scripting.unregisterContentScripts({ids:[t]})}catch(n){return console.log(`failed to unregister content scripts: ${n}`),!1}return!0}function Qp(e,t,n){Ie()||Le()?t():chrome.permissions.contains(e,o=>{o?t():chrome.permissions.request(e,a=>{!chrome.runtime.lastError||console.log(chrome.runtime.lastError),a?t():(O("The user rejected to grant permissions.")(),n&&n())})})}function dc(){return new Promise(e=>Qp({origins:["https://mail.google.com/*"]},()=>e(!0),()=>e(!1)))}function pc(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function hc(e){let t=JSON.parse(e),n="guid="+encodeURIComponent(q(y.a,""))+"&stack="+encodeURIComponent(t.stack)+"&comment="+encodeURIComponent(t.comment)+"&contacts="+encodeURIComponent(t.contacts);fetch(y.Ze,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n})}function mc(e,t){let n=e.split("|"),o="guid="+encodeURIComponent(q(y.a,""))+"&session="+encodeURIComponent(n[1]);fetch(n[0],{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(a=>{if(a.ok)return a.text()}).then(a=>t(a)).catch(()=>{})}function $r(){G(y.b,""),G(y.u,""),G(y.p,""),G(y.t,"");let e=q(y.o,"");G(y.o,""),Ke.ht(e)}function Ur(e){let t=e.match(/,(.{100})/);if(t&&t.length>0){let n=Uint8Array.from(atob(t[1]),o=>o.charCodeAt(0));return{w:n[18]<<8|n[19],h:n[22]<<8|n[23]}}else return{w:0,h:0}}function ao(){var e=!1;function t(){chrome.action.setIcon({path:"/images/sss_48.png"})}return{start:()=>{let n=0,o=[];for(let c=1;c<=30;++c)o.push(`/images/progress/frame-${c}.png`);let a=()=>{e?chrome.action.setIcon({path:o[++n%o.length]},()=>setTimeout(a,60)):t()};e=!0,a()},stop:function(){e=!1,t()}}}function qn(e){O("open folder")(),Ie()?bc():chrome.downloads.show(e)}function gc(e){let t=JSON.parse(e);G(y.M,t.filenameTemplate),G(y.v,t.filenameNumber),G(y.U,t.filenameNumberPadCheck===1?"true":"false"),G(y.K,t.filenameNumberPadValue),G(y.j,t.filenameMaxLen)}function Qn(){let e={};return e[y.M]=q(y.M,"")===""?y.be:q(y.M,""),e[y.v]=parseInt(q(y.v,2))-1,e[y.U]=q(y.U,"true"),e[y.K]=parseInt(q(y.K,3)),e[y.j]=parseInt(q(y.j,100)),e}function Kr(){chrome.contextMenus.removeAll(()=>{if(q(y.je,"true")==="true")if(be().isIdle()){let e=Zp();chrome.contextMenus.create({title:e,contexts:["all"],id:"mnuLastCommand"},()=>{chrome.runtime.lastError})}else chrome.contextMenus.create({title:"Stop",contexts:["all"],id:"mnuStopCommand"},()=>{chrome.runtime.lastError})})}function be(){function e(){let t=parseInt(q(y.F,0));return{reset:()=>{O("reset state")(),t=y._e,G(y.F,t)},add:n=>{O("add state")(),t|=n,G(y.F,t)},remove:n=>{O("remove state")(),t&=~n>>>0,G(y.F,t)},contains:n=>(t&n)===n,isIdle:()=>t===y._e}}return new e}function Zp(){function e(c){switch(c){case y.E:return"action_save";case y.I:return"action_save_pdf";case y.Pe:return"action_copy";case y.De:return"action_email";case y.Oe:return"action_external";case y.Ne:return"action_onenote";case y.Re:return"action_upload";case y.Me:return"action_print";case y.T:return"action_save_pdf_single";default:return"action_edit"}}let t,n=e(no()),o=!it(),a=Br();switch(a){case y.m:t=o?"action_capture_visible_lite":"action_capture_visible";break;case y.k:t=o?"action_capture_selection_lite":"action_capture_selection";break;case y.B:t="action_capture_browser";break;case y.O:t="action_capture_tabs";break;default:t=o?"action_capture_entire_lite":"action_capture_entire"}return o&&a!==y.O?chrome.i18n.getMessage(t):chrome.i18n.getMessage(t)+" "+chrome.i18n.getMessage(n)}function yc(e=0){return new Promise(t=>{setTimeout(t,e)})}async function vc(){await chrome.offscreen.createDocument({url:"fsMigrateOptions.html",reasons:["LOCAL_STORAGE"],justification:"import settings"});let e=await chrome.runtime.sendMessage({message:"getLocalStorage"});return await chrome.offscreen.closeDocument(),e}function Zn(){chrome.runtime.sendMessage({message:"closeProgress"}).catch(()=>{})}function hn(e,t){let n=q(y.ve,""),o=q(y.ye,"");return n&&o&&n===t&&(e=o),e}function Fr(e){return btoa(String.fromCharCode(...new TextEncoder().encode(e)))}function so(e){let t="";for(let n=0;n<e.length;n+=2){let o=parseInt(e.substr(n,2),16);t+=String.fromCharCode(o)}return t}function eh(e,t){let n=p=>{for(var m="",g=0;g<p.length;g++){var v=p[g].toString(16);v.length<2&&(v="0"+v),m+=v}return m},o=p=>{if(!p||p.length<1)return new Uint8Array(0);let m=[],g=p.length,v="0123456789abcdefghijklmnopqrstuvwxyz";p[0]!=="2"&&(v="23456789abcdefghjklmnpqrstuvwxyz");let _=[];for(let k=0;k<g;k++){let P=p[k].toLowerCase();for(let A=0;A<v.length;A++)if(v[A]===P){_[k]=A;break}}let D=0,w,E,S=0,T=0;for(;S<g;){w=0;let k=0;for(;w<8&&S<g;){let P=_[S];E=Math.min(5-D,8-w),D<=w?P=P<<w:P=P>>D,k=k|P,w+=E,D+=E,D>=5&&(S++,D=0)}m[T++]=k}let C=Math.floor(g*5/8);return new Uint8Array(m.slice(0,C))},a=(p,m,g,v)=>{let _=m.length;if(v===1)for(let D=0;D<g;D++){let w=D%_;p[D]=p[D]^m.charCodeAt(w)}else if(v===2){let D=0,w=0;for(let E=0;E<Math.max(g,_);E++)p[D]=p[D]^m.charCodeAt(w),D++,w++,D===g&&(D=0),w===_&&(w=0)}return p};t=t.replace(/-/g,"");let c=o(t),u=c[0]&15,d=!1;if(u===2){if((c[0]&240)>>5===1){let m=a(c.slice(1),e,c.length-1,2),g=n(m.slice(0,5));d=g===n([0,26,26,51,84])||g===n([5,27,26,57,74])}}else if(u===4&&(c[0]&240)>>5===1){let m="FS";for(let w=13;w>=10;--w)m+=n(c.slice(w,w+1));m=m.toUpperCase();let g=Rr(m),v=a(c.slice(1),g,c.length-1,2),_=a(v,e,v.length,2);d=n(_.slice(0,5))===n([0,26,26,51,84])}return d}var co=0,th=1,ot={port:void 0,ready:!1,autoReconnect:!1,updating:!1,updated:!1,ignoreResponse:!1,portBusy:!1,callback:void 0,callbackDisconnected:void 0,prevVersion:void 0,updateTrials:0,pendingData:"",firstPacket:!0,onNativeHostUpdated:null,onPluginEvent:null,init:function(e,t,n,o){this.onNativeHostUpdated=t,this.onPluginEvent=e;let a=c=>{if(this.ignoreResponse){O("Ignored response: "+JSON.stringify(c))(),c.topic==="status"&&c.code==th&&(this.updating=!1,this.autoReconnect=!1,e&&e(c));return}this.autoReconnect=!1,!this.processInternally(c)&&e&&e(c)};this.callback=n,this.callbackDisconnected=o,this.ignoreResponse=!1,this.portBusy=!0;try{this.port=chrome.runtime.connectNative(pn.contractId+"")}catch(c){Jt(c.message),this.portBusy=!1}this.port.onMessage.addListener(c=>{if(c.data!=="")this.pendingData+=c.data;else try{let u=JSON.parse(this.pendingData);ie&&O("Original Packet: "+this.pendingData.substring(0,1024))(),this.pendingData="",a(u)}catch(u){O("Raw packet data triggered error:",this.pendingData.substring(0,1024))(),Ct.captureException(u),this.pendingData="",Jt(u.message)}}),this.port.onDisconnect.addListener(()=>{chrome.runtime.lastError&&console.log("ERROR: "+chrome.runtime.lastError.message),this.ready=!1,this.portBusy=!1,G(y.A,"false"),!this.updating&&this.callbackDisconnected&&this.callbackDisconnected(),O("Native port disconnected.")(),this.firstPacket=!0,this.pendingData="",this.autoReconnect&&this.doReconnect()}),O("Native port created successfully. Starting test...")(),this.launchJSON({JSONCommand:"ping",version:Ne().extVersionFull,id:wt})},processInternally:function(e){if(e.topic=="hostVersion"){if(this.hostVersion=e.data,Ne().extVersion!=this.hostVersion)return++this.updateTrials>3?(O("Too much of unsuccessful update trials. No updates anymore.")(),this.updating=!1,!1):(this.prevVersion=this.hostVersion,this.doUpdate(),!0)}else if(e.topic=="status")if(e.code==co){var t=e.data;return this.updateTrials=0,this.ready=!0,G(y.A,"true"),this.callback&&(this.callback(),this.callback=void 0),this.updating&&(this.updated=!0,this.updating=!1,this.prevVersion!="0"&&this.onNativeHostUpdated(t)),!1}else return this.updating&&(this.updating=!1),!1;else if(e.topic=="getDLL")return this.sendDLL(e.x64),!0;return!1},launchJSON:function(e){this.port.postMessage(e)},getFile:function(e,t){let n=()=>{let o=!0;if(e.search(/sss-x64\.dat|sss\.dat|fireshot-chrome-plugin\.dat/)!==-1){let a=Ne().extVersionFull,c=y.Je+a,u=parseInt(de.getOption(c,"0"));u<3?(O("Opening helper installer page.")(),o=!1,de.setOption(c,u+1),mn("https://getfireshot.com/helper-install.php?ver="+a)):O("Helper installer page cannot be shown more than 3 times, aborting.")()}return o};O("Fetching: "+e)(),fetch(chrome.runtime.getURL(e)).then(o=>{O(`Fetching status = [${o.status}]`)(),o.ok?o.blob().then(a=>{O(`Blob size is ${a.size} bytes`)();let c=new FileReader;c.onload=u=>{O("Fetching complete")();let d="base64,";t(u.target.result.substr(u.target.result.indexOf(d)+d.length,u.target.result.length))},c.onerror=()=>{O("Error in FileReader")()},c.readAsDataURL(a)}).catch(a=>{n()&&reportError(a)}):(O("NativeError-Error retrieving file")(),nc(`Error retrieving file: ${o.status}`))}).catch(o=>{n()&&reportError(o)})},sendDLL:function(e){this.getFile(`native/${e?"sss-x64.dat":"sss.dat"}`,t=>{t&&this.launchJSON({JSONCommand:"updateDLL",version:Ne().extVersionFull,data:t})})},doUpdate:function(){let e=Ne().extVersionFull;O("Updating native to the version: "+e)(),this.ignoreResponse=!0,this.getFile("native/"+pn.nativeFilePath,t=>{this.updating=!0,this.autoReconnect=!0,this.launchJSON({JSONCommand:"updateNative",version:e,data:t})})},doReconnect:function(){setTimeout(()=>{O("Trying to reconnect...")(),this.init(this.onPluginEvent,this.onNativeHostUpdated,this.callback,this.callbackDisconnected)},1e3)},forceDisconnect:function(){this.autoReconnect=!1,this.port&&this.port.disconnect(),this.ready=!1,G(y.A,"false")}};async function wc(e,t){O(`Sending ${e.topic}`)();let n=150*1024*1024;if(e.topic!=="saveFile"||e.data.length<n)browser.runtime.sendNativeMessage("application.id",e,o=>{O("Response from native App:")(),O(o)(),t&&t(o)});else{let o={};for(let a in e)a!="data"&&(o[a]=e[a]);O("Sending saveFile in async mode...")(),browser.runtime.sendNativeMessage("application.id",o,async a=>{O("Response from native App:")(),O(a)();let c=u=>new Promise(d=>browser.runtime.sendNativeMessage("application.id",u,d));if(a.success==="true"){let u=a.fileId,d=e.data,p=0,m;for(;p<d.length;){let g=d.substring(p,p+n);if(p+=n,m=await c({topic:"writeBlock",fileId:u,data:g}),O(`Written ${g.length} bytes, result:`)(),O(m)(),m.success!=="true")break}m.success==="true"&&(m=await c({topic:"writeBlock",fileId:u,openFolder:e.openFolder})),O("Signaling to finish. result:")(),O(m)(),t&&t(m)}else t&&t(a)})}}var bo=function(e,t){return bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])},bo(e,t)};function nh(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");bo(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var re=function(){return re=Object.assign||function(t){for(var n,o=1,a=arguments.length;o<a;o++){n=arguments[o];for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(t[c]=n[c])}return t},re.apply(this,arguments)};function ti(e,t,n){if(n||arguments.length===2)for(var o=0,a=t.length,c;o<a;o++)(c||!(o in t))&&(c||(c=Array.prototype.slice.call(t,0,o)),c[o]=t[o]);return e.concat(c||Array.prototype.slice.call(t))}var Be=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Pe=Object.keys,Se=Array.isArray;typeof Promise<"u"&&!Be.Promise&&(Be.Promise=Promise);function Qe(e,t){return typeof t!="object"||Pe(t).forEach(function(n){e[n]=t[n]}),e}var xn=Object.getPrototypeOf,rh={}.hasOwnProperty;function Je(e,t){return rh.call(e,t)}function Tn(e,t){typeof t=="function"&&(t=t(xn(e))),(typeof Reflect>"u"?Pe:Reflect.ownKeys)(t).forEach(function(n){Ft(e,n,t[n])})}var Bc=Object.defineProperty;function Ft(e,t,n,o){Bc(e,t,Qe(n&&Je(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},o))}function kn(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Ft(e.prototype,"constructor",e),{extend:Tn.bind(null,e.prototype)}}}}var ih=Object.getOwnPropertyDescriptor;function $c(e,t){var n=ih(e,t),o;return n||(o=xn(e))&&$c(o,t)}var oh=[].slice;function pi(e,t,n){return oh.call(e,t,n)}function Uc(e,t){return t(e)}function er(e){if(!e)throw new Error("Assertion Failed")}function Kc(e){Be.setImmediate?setImmediate(e):setTimeout(e,0)}function ah(e,t){return e.reduce(function(n,o,a){var c=t(o,a);return c&&(n[c[0]]=c[1]),n},{})}function Et(e,t){if(typeof t=="string"&&Je(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],o=0,a=t.length;o<a;++o){var c=Et(e,t[o]);n.push(c)}return n}var u=t.indexOf(".");if(u!==-1){var d=e[t.substr(0,u)];return d==null?void 0:Et(d,t.substr(u+1))}}function ze(e,t,n){if(!(!e||t===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){er(typeof n!="string"&&"length"in n);for(var o=0,a=t.length;o<a;++o)ze(e,t[o],n[o])}else{var c=t.indexOf(".");if(c!==-1){var u=t.substr(0,c),d=t.substr(c+1);if(d==="")n===void 0?Se(e)&&!isNaN(parseInt(u))?e.splice(u,1):delete e[u]:e[u]=n;else{var p=e[u];(!p||!Je(e,u))&&(p=e[u]={}),ze(p,d,n)}}else n===void 0?Se(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function sh(e,t){typeof t=="string"?ze(e,t,void 0):"length"in t&&[].map.call(t,function(n){ze(e,n,void 0)})}function jc(e){var t={};for(var n in e)Je(e,n)&&(t[n]=e[n]);return t}var ch=[].concat;function Hc(e){return ch.apply([],e)}var uh="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Hc([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return Be[e]}),Vc=new Set(uh.map(function(e){return Be[e]}));function Wc(e){var t={};for(var n in e)if(Je(e,n)){var o=e[n];t[n]=!o||typeof o!="object"||Vc.has(o.constructor)?o:Wc(o)}return t}function lh(e){for(var t in e)if(Je(e,t))return!1;return!0}var nr=null;function nn(e){nr=new WeakMap;var t=wo(e);return nr=null,t}function wo(e){if(!e||typeof e!="object")return e;var t=nr.get(e);if(t)return t;if(Se(e)){t=[],nr.set(e,t);for(var n=0,o=e.length;n<o;++n)t.push(wo(e[n]))}else if(Vc.has(e.constructor))t=e;else{var a=xn(e);t=a===Object.prototype?{}:Object.create(a),nr.set(e,t);for(var c in e)Je(e,c)&&(t[c]=wo(e[c]))}return t}var fh={}.toString;function _o(e){return fh.call(e).slice(8,-1)}var So=typeof Symbol<"u"?Symbol.iterator:"@@iterator",dh=typeof So=="symbol"?function(e){var t;return e!=null&&(t=e[So])&&t.apply(e)}:function(){return null};function Yt(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var Sn={};function St(e){var t,n,o,a;if(arguments.length===1){if(Se(e))return e.slice();if(this===Sn&&typeof e=="string")return[e];if(a=dh(e)){for(n=[];o=a.next(),!o.done;)n.push(o.value);return n}if(e==null)return[e];if(t=e.length,typeof t=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var No=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ph=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Gc=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Lo=ph.concat(Gc),hh={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Cn(e,t){this.name=e,this.message=t}kn(Cn).from(Error).extend({toString:function(){return this.name+": "+this.message}});function zc(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,o,a){return a.indexOf(n)===o}).join(`
`)}function ni(e,t,n,o){this.failures=t,this.failedKeys=o,this.successCount=n,this.message=zc(e,t)}kn(ni).from(Cn);function En(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=zc(e,this.failures)}kn(En).from(Cn);var Bo=Lo.reduce(function(e,t){return e[t]=t+"Error",e},{}),mh=Cn,Z=Lo.reduce(function(e,t){var n=t+"Error";function o(a,c){this.name=n,a?typeof a=="string"?(this.message="".concat(a).concat(c?`
 `+c:""),this.inner=c||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=hh[t]||n,this.inner=null)}return kn(o).from(mh),e[t]=o,e},{});Z.Syntax=SyntaxError;Z.Type=TypeError;Z.Range=RangeError;var _c=Gc.reduce(function(e,t){return e[t+"Error"]=Z[t],e},{});function gh(e,t){if(!e||e instanceof Cn||e instanceof TypeError||e instanceof SyntaxError||!e.name||!_c[e.name])return e;var n=new _c[e.name](t||e.message,e);return"stack"in e&&Ft(n,"stack",{get:function(){return this.inner.stack}}),n}var hi=Lo.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=Z[t]),e},{});hi.ModifyError=ni;hi.DexieError=Cn;hi.BulkError=En;function pe(){}function ur(e){return e}function yh(e,t){return e==null||e===ur?t:function(n){return t(e(n))}}function rn(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function vh(e,t){return e===pe?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var o=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var c=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?rn(o,this.onsuccess):o),a&&(this.onerror=this.onerror?rn(a,this.onerror):a),c!==void 0?c:n}}function bh(e,t){return e===pe?t:function(){e.apply(this,arguments);var n=this.onsuccess,o=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?rn(n,this.onsuccess):n),o&&(this.onerror=this.onerror?rn(o,this.onerror):o)}}function wh(e,t){return e===pe?t:function(n){var o=e.apply(this,arguments);Qe(n,o);var a=this.onsuccess,c=this.onerror;this.onsuccess=null,this.onerror=null;var u=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?rn(a,this.onsuccess):a),c&&(this.onerror=this.onerror?rn(c,this.onerror):c),o===void 0?u===void 0?void 0:u:Qe(o,u)}}function _h(e,t){return e===pe?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function $o(e,t){return e===pe?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var o=this,a=arguments.length,c=new Array(a);a--;)c[a]=arguments[a];return n.then(function(){return t.apply(o,c)})}return t.apply(this,arguments)}}var pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Jc(e,t){pt=e}var ir={},Yc=100,Uo=typeof Promise>"u"?[]:(function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,xn(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,xn(t),e]})(),Sc=Uo[0],Ec=Uo[1],Sh=Uo[2],Eh=Ec&&Ec.then,Xt=Sc&&Sc.constructor,Ko=!!Sh;function Ih(){queueMicrotask(Th)}var or=function(e,t){tr.push([e,t]),ri&&(Ih(),ri=!1)},Eo=!0,ri=!0,Zt=[],Jr=[],Io=ur,Mt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pe,pgp:!1,env:{},finalize:pe},Q=Mt,tr=[],en=0,Yr=[];function W(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Q;if(typeof e!="function"){if(e!==ir)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&To(this,this._value);return}this._state=null,this._value=null,++t.ref,qc(this,e)}var xo={get:function(){var e=Q,t=ii;function n(o,a){var c=this,u=!e.global&&(e!==Q||t!==ii),d=u&&!Lt(),p=new W(function(m,g){jo(c,new Xc(Ic(o,e,u,d),Ic(a,e,u,d),m,g,e))});return this._consoleTask&&(p._consoleTask=this._consoleTask),p}return n.prototype=ir,n},set:function(e){Ft(this,"then",e&&e.prototype===ir?xo:{get:function(){return e},set:xo.set})}};Tn(W.prototype,{then:xo,_then:function(e,t){jo(this,new Xc(null,null,e,t,Q))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,function(o){return o instanceof t?n(o):Xr(o)}):this.then(null,function(o){return o&&o.name===t?n(o):Xr(o)})},finally:function(e){return this.then(function(t){return W.resolve(e()).then(function(){return t})},function(t){return W.resolve(e()).then(function(){return Xr(t)})})},timeout:function(e,t){var n=this;return e<1/0?new W(function(o,a){var c=setTimeout(function(){return a(new Z.Timeout(t))},e);n.then(o,a).finally(clearTimeout.bind(null,c))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&Ft(W.prototype,Symbol.toStringTag,"Dexie.Promise");Mt.env=Zc();function Xc(e,t,n,o,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=o,this.psd=a}Tn(W,{all:function(){var e=St.apply(null,arguments).map(oi);return new W(function(t,n){e.length===0&&t([]);var o=e.length;e.forEach(function(a,c){return W.resolve(a).then(function(u){e[c]=u,--o||t(e)},n)})})},resolve:function(e){if(e instanceof W)return e;if(e&&typeof e.then=="function")return new W(function(n,o){e.then(n,o)});var t=new W(ir,!0,e);return t},reject:Xr,race:function(){var e=St.apply(null,arguments).map(oi);return new W(function(t,n){e.map(function(o){return W.resolve(o).then(t,n)})})},PSD:{get:function(){return Q},set:function(e){return Q=e}},totalEchoes:{get:function(){return ii}},newPSD:Nt,usePSD:on,scheduler:{get:function(){return or},set:function(e){or=e}},rejectionMapper:{get:function(){return Io},set:function(e){Io=e}},follow:function(e,t){return new W(function(n,o){return Nt(function(a,c){var u=Q;u.unhandleds=[],u.onunhandled=c,u.finalize=rn(function(){var d=this;kh(function(){d.unhandleds.length===0?a():c(d.unhandleds[0])})},u.finalize),e()},t,n,o)})}});Xt&&(Xt.allSettled&&Ft(W,"allSettled",function(){var e=St.apply(null,arguments).map(oi);return new W(function(t){e.length===0&&t([]);var n=e.length,o=new Array(n);e.forEach(function(a,c){return W.resolve(a).then(function(u){return o[c]={status:"fulfilled",value:u}},function(u){return o[c]={status:"rejected",reason:u}}).then(function(){return--n||t(o)})})})}),Xt.any&&typeof AggregateError<"u"&&Ft(W,"any",function(){var e=St.apply(null,arguments).map(oi);return new W(function(t,n){e.length===0&&n(new AggregateError([]));var o=e.length,a=new Array(o);e.forEach(function(c,u){return W.resolve(c).then(function(d){return t(d)},function(d){a[u]=d,--o||n(new AggregateError(a))})})})}),Xt.withResolvers&&(W.withResolvers=Xt.withResolvers));function qc(e,t){try{t(function(n){if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var o=e._lib&&An();n&&typeof n.then=="function"?qc(e,function(a,c){n instanceof W?n._then(a,c):n.then(a,c)}):(e._state=!0,e._value=n,Qc(e)),o&&Pn()}},To.bind(null,e))}catch(n){To(e,n)}}function To(e,t){if(Jr.push(t),e._state===null){var n=e._lib&&An();t=Io(t),e._state=!1,e._value=t,Ch(e),Qc(e),n&&Pn()}}function Qc(e){var t=e._listeners;e._listeners=[];for(var n=0,o=t.length;n<o;++n)jo(e,t[n]);var a=e._PSD;--a.ref||a.finalize(),en===0&&(++en,or(function(){--en===0&&Ho()},[]))}function jo(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++en,or(xh,[n,e,t])}function xh(e,t,n){try{var o,a=t._value;!t._state&&Jr.length&&(Jr=[]),o=pt&&t._consoleTask?t._consoleTask.run(function(){return e(a)}):e(a),!t._state&&Jr.indexOf(a)===-1&&Ah(t),n.resolve(o)}catch(c){n.reject(c)}finally{--en===0&&Ho(),--n.psd.ref||n.psd.finalize()}}function Th(){on(Mt,function(){An()&&Pn()})}function An(){var e=Eo;return Eo=!1,ri=!1,e}function Pn(){var e,t,n;do for(;tr.length>0;)for(e=tr,tr=[],n=e.length,t=0;t<n;++t){var o=e[t];o[0].apply(null,o[1])}while(tr.length>0);Eo=!0,ri=!0}function Ho(){var e=Zt;Zt=[],e.forEach(function(o){o._PSD.onunhandled.call(null,o._value,o)});for(var t=Yr.slice(0),n=t.length;n;)t[--n]()}function kh(e){function t(){e(),Yr.splice(Yr.indexOf(t),1)}Yr.push(t),++en,or(function(){--en===0&&Ho()},[])}function Ch(e){Zt.some(function(t){return t._value===e._value})||Zt.push(e)}function Ah(e){for(var t=Zt.length;t;)if(Zt[--t]._value===e._value){Zt.splice(t,1);return}}function Xr(e){return new W(ir,!1,e)}function we(e,t){var n=Q;return function(){var o=An(),a=Q;try{return Bt(n,!0),e.apply(this,arguments)}catch(c){t&&t(c)}finally{Bt(a,!1),o&&Pn()}}}var Ae={awaits:0,echoes:0,id:0},Ph=0,qr=[],Qr=0,ii=0,Dh=0;function Nt(e,t,n,o){var a=Q,c=Object.create(a);c.parent=a,c.ref=0,c.global=!1,c.id=++Dh,Mt.env,c.env=Ko?{Promise:W,PromiseProp:{value:W,configurable:!0,writable:!0},all:W.all,race:W.race,allSettled:W.allSettled,any:W.any,resolve:W.resolve,reject:W.reject}:{},t&&Qe(c,t),++a.ref,c.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=on(c,e,n,o);return c.ref===0&&c.finalize(),u}function Dn(){return Ae.id||(Ae.id=++Ph),++Ae.awaits,Ae.echoes+=Yc,Ae.id}function Lt(){return Ae.awaits?(--Ae.awaits===0&&(Ae.id=0),Ae.echoes=Ae.awaits*Yc,!0):!1}(""+Eh).indexOf("[native code]")===-1&&(Dn=Lt=pe);function oi(e){return Ae.echoes&&e&&e.constructor===Xt?(Dn(),e.then(function(t){return Lt(),t},function(t){return Lt(),Te(t)})):e}function Oh(e){++ii,(!Ae.echoes||--Ae.echoes===0)&&(Ae.echoes=Ae.awaits=Ae.id=0),qr.push(Q),Bt(e,!0)}function Rh(){var e=qr[qr.length-1];qr.pop(),Bt(e,!1)}function Bt(e,t){var n=Q;if((t?Ae.echoes&&(!Qr++||e!==Q):Qr&&(!--Qr||e!==Q))&&queueMicrotask(t?Oh.bind(null,e):Rh),e!==Q&&(Q=e,n===Mt&&(Mt.env=Zc()),Ko)){var o=Mt.env.Promise,a=e.env;(n.global||e.global)&&(Object.defineProperty(Be,"Promise",a.PromiseProp),o.all=a.all,o.race=a.race,o.resolve=a.resolve,o.reject=a.reject,a.allSettled&&(o.allSettled=a.allSettled),a.any&&(o.any=a.any))}}function Zc(){var e=Be.Promise;return Ko?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Be,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function on(e,t,n,o,a){var c=Q;try{return Bt(e,!0),t(n,o,a)}finally{Bt(c,!1)}}function Ic(e,t,n,o){return typeof e!="function"?e:function(){var a=Q;n&&Dn(),Bt(t,!0);try{return e.apply(this,arguments)}finally{Bt(a,!1),o&&queueMicrotask(Lt)}}}function uo(e){Promise===Xt&&Ae.echoes===0?Qr===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}var Te=W.reject;function ko(e,t,n,o){if(!e.idbdb||!e._state.openComplete&&!Q.letThrough&&!e._vip){if(e._state.openComplete)return Te(new Z.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return Te(new Z.DatabaseClosed);e.open().catch(pe)}return e._state.dbReadyPromise.then(function(){return ko(e,t,n,o)})}else{var a=e._createTransaction(t,n,e._dbSchema);try{a.create(),e._state.PR1398_maxLoop=3}catch(c){return c.name===Bo.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return ko(e,t,n,o)})):Te(c)}return a._promise(t,function(c,u){return Nt(function(){return Q.trans=a,o(c,u,a)})}).then(function(c){if(t==="readwrite")try{a.idbtrans.commit()}catch{}return t==="readonly"?c:a._completion.then(function(){return c})})}}var xc="4.2.1",Qt="\uFFFF",Co=-1/0,_t="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",eu="String expected.",In=[],mi="__dbnames",lo="readonly",fo="readwrite";function an(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var tu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function jr(e){return typeof e=="string"&&!/\./.test(e)?function(t){return t[e]===void 0&&e in t&&(t=nn(t),delete t[e]),t}:function(t){return t}}function Mh(){throw Z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ae(e,t){try{var n=Tc(e),o=Tc(t);if(n!==o)return n==="Array"?1:o==="Array"?-1:n==="binary"?1:o==="binary"?-1:n==="string"?1:o==="string"?-1:n==="Date"?1:o!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return Nh(kc(e),kc(t));case"Array":return Fh(e,t)}}catch{}return NaN}function Fh(e,t){for(var n=e.length,o=t.length,a=n<o?n:o,c=0;c<a;++c){var u=ae(e[c],t[c]);if(u!==0)return u}return n===o?0:n<o?-1:1}function Nh(e,t){for(var n=e.length,o=t.length,a=n<o?n:o,c=0;c<a;++c)if(e[c]!==t[c])return e[c]<t[c]?-1:1;return n===o?0:n<o?-1:1}function Tc(e){var t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";var n=_o(e);return n==="ArrayBuffer"?"binary":n}function kc(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Zr(e,t,n){var o=e.schema.yProps;return o?(t&&n.numFailures>0&&(t=t.filter(function(a,c){return!n.failures[c]})),Promise.all(o.map(function(a){var c=a.updatesTable;return t?e.db.table(c).where("k").anyOf(t).delete():e.db.table(c).clear()})).then(function(){return n})):n}var Lh=(function(){function e(t){this["@@propmod"]=t}return e.prototype.execute=function(t){var n,o=this["@@propmod"];if(o.add!==void 0){var a=o.add;if(Se(a))return ti(ti([],Se(t)?t:[],!0),a,!0).sort();if(typeof a=="number")return(Number(t)||0)+a;if(typeof a=="bigint")try{return BigInt(t)+a}catch{return BigInt(0)+a}throw new TypeError("Invalid term ".concat(a))}if(o.remove!==void 0){var c=o.remove;if(Se(c))return Se(t)?t.filter(function(d){return!c.includes(d)}).sort():[];if(typeof c=="number")return Number(t)-c;if(typeof c=="bigint")try{return BigInt(t)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}var u=(n=o.replacePrefix)===null||n===void 0?void 0:n[0];return u&&typeof t=="string"&&t.startsWith(u)?o.replacePrefix[1]+t.substring(u.length):t},e})();function nu(e,t){for(var n=Pe(t),o=n.length,a=!1,c=0;c<o;++c){var u=n[c],d=t[u],p=Et(e,u);d instanceof Lh?(ze(e,u,d.execute(p)),a=!0):p!==d&&(ze(e,u,d),a=!0)}return a}var ru=(function(){function e(){}return e.prototype._trans=function(t,n,o){var a=this._tx||Q.trans,c=this.name,u=pt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function d(g,v,_){if(!_.schema[c])throw new Z.NotFound("Table "+c+" not part of transaction");return n(_.idbtrans,_)}var p=An();try{var m=a&&a.db._novip===this.db._novip?a===Q.trans?a._promise(t,d,o):Nt(function(){return a._promise(t,d,o)},{trans:a,transless:Q.transless||Q}):ko(this.db,t,[this.name],d);return u&&(m._consoleTask=u,m=m.catch(function(g){return console.trace(g),Te(g)})),m}finally{p&&Pn()}},e.prototype.get=function(t,n){var o=this;return t&&t.constructor===Object?this.where(t).first(n):t==null?Te(new Z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return o.core.get({trans:a,key:t}).then(function(c){return o.hook.reading.fire(c)})}).then(n)},e.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(Se(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var n=Pe(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);var o=this.schema.indexes.concat(this.schema.primKey).filter(function(g){if(g.compound&&n.every(function(_){return g.keyPath.indexOf(_)>=0})){for(var v=0;v<n.length;++v)if(n.indexOf(g.keyPath[v])===-1)return!1;return!0}return!1}).sort(function(g,v){return g.keyPath.length-v.keyPath.length})[0];if(o&&this.db._maxKey!==Qt){var a=o.keyPath.slice(0,n.length);return this.where(a).equals(a.map(function(g){return t[g]}))}!o&&pt&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(n.join("+"),"]"));var c=this.schema.idxByName;function u(g,v){return ae(g,v)===0}var d=n.reduce(function(g,v){var _=g[0],D=g[1],w=c[v],E=t[v];return[_||w,_||!w?an(D,w&&w.multi?function(S){var T=Et(S,v);return Se(T)&&T.some(function(C){return u(E,C)})}:function(S){return u(E,Et(S,v))}):D]},[null,null]),p=d[0],m=d[1];return p?this.where(p.name).equals(t[p.keyPath]).filter(m):o?this.filter(m):this.where(n).equals("")},e.prototype.filter=function(t){return this.toCollection().and(t)},e.prototype.count=function(t){return this.toCollection().count(t)},e.prototype.offset=function(t){return this.toCollection().offset(t)},e.prototype.limit=function(t){return this.toCollection().limit(t)},e.prototype.each=function(t){return this.toCollection().each(t)},e.prototype.toArray=function(t){return this.toCollection().toArray(t)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,Se(t)?"[".concat(t.join("+"),"]"):t))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(t){var n=this,o=n.db,a=n.name;this.schema.mappedClass=t,t.prototype instanceof Mh&&(t=(function(p){nh(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return Object.defineProperty(m.prototype,"db",{get:function(){return o},enumerable:!1,configurable:!0}),m.prototype.table=function(){return a},m})(t));for(var c=new Set,u=t.prototype;u;u=xn(u))Object.getOwnPropertyNames(u).forEach(function(p){return c.add(p)});var d=function(p){if(!p)return p;var m=Object.create(t.prototype);for(var g in p)if(!c.has(g))try{m[g]=p[g]}catch{}return m};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=d,this.hook("reading",d),t},e.prototype.defineClass=function(){function t(n){Qe(this,n)}return this.mapToClass(t)},e.prototype.add=function(t,n){var o=this,a=this.schema.primKey,c=a.auto,u=a.keyPath,d=t;return u&&c&&(d=jr(u)(t)),this._trans("readwrite",function(p){return o.core.mutate({trans:p,type:"add",keys:n!=null?[n]:null,values:[d]})}).then(function(p){return p.numFailures?W.reject(p.failures[0]):p.lastResult}).then(function(p){if(u)try{ze(t,u,p)}catch{}return p})},e.prototype.upsert=function(t,n){var o=this,a=this.schema.primKey.keyPath;return this._trans("readwrite",function(c){return o.core.get({trans:c,key:t}).then(function(u){var d=u??{};return nu(d,n),a&&ze(d,a,t),o.core.mutate({trans:c,type:"put",values:[d],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[n]}}).then(function(p){return p.numFailures?W.reject(p.failures[0]):!!u})})})},e.prototype.update=function(t,n){if(typeof t=="object"&&!Se(t)){var o=Et(t,this.schema.primKey.keyPath);return o===void 0?Te(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(o).modify(n)}else return this.where(":id").equals(t).modify(n)},e.prototype.put=function(t,n){var o=this,a=this.schema.primKey,c=a.auto,u=a.keyPath,d=t;return u&&c&&(d=jr(u)(t)),this._trans("readwrite",function(p){return o.core.mutate({trans:p,type:"put",values:[d],keys:n!=null?[n]:null})}).then(function(p){return p.numFailures?W.reject(p.failures[0]):p.lastResult}).then(function(p){if(u)try{ze(t,u,p)}catch{}return p})},e.prototype.delete=function(t){var n=this;return this._trans("readwrite",function(o){return n.core.mutate({trans:o,type:"delete",keys:[t]}).then(function(a){return Zr(n,[t],a)}).then(function(a){return a.numFailures?W.reject(a.failures[0]):void 0})})},e.prototype.clear=function(){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"deleteRange",range:tu}).then(function(o){return Zr(t,null,o)})}).then(function(n){return n.numFailures?W.reject(n.failures[0]):void 0})},e.prototype.bulkGet=function(t){var n=this;return this._trans("readonly",function(o){return n.core.getMany({keys:t,trans:o}).then(function(a){return a.map(function(c){return n.hook.reading.fire(c)})})})},e.prototype.bulkAdd=function(t,n,o){var a=this,c=Array.isArray(n)?n:void 0;o=o||(c?void 0:n);var u=o?o.allKeys:void 0;return this._trans("readwrite",function(d){var p=a.schema.primKey,m=p.auto,g=p.keyPath;if(g&&c)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(c&&c.length!==t.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var v=t.length,_=g&&m?t.map(jr(g)):t;return a.core.mutate({trans:d,type:"add",keys:c,values:_,wantResults:u}).then(function(D){var w=D.numFailures,E=D.results,S=D.lastResult,T=D.failures,C=u?E:S;if(w===0)return C;throw new En("".concat(a.name,".bulkAdd(): ").concat(w," of ").concat(v," operations failed"),T)})})},e.prototype.bulkPut=function(t,n,o){var a=this,c=Array.isArray(n)?n:void 0;o=o||(c?void 0:n);var u=o?o.allKeys:void 0;return this._trans("readwrite",function(d){var p=a.schema.primKey,m=p.auto,g=p.keyPath;if(g&&c)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(c&&c.length!==t.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var v=t.length,_=g&&m?t.map(jr(g)):t;return a.core.mutate({trans:d,type:"put",keys:c,values:_,wantResults:u}).then(function(D){var w=D.numFailures,E=D.results,S=D.lastResult,T=D.failures,C=u?E:S;if(w===0)return C;throw new En("".concat(a.name,".bulkPut(): ").concat(w," of ").concat(v," operations failed"),T)})})},e.prototype.bulkUpdate=function(t){var n=this,o=this.core,a=t.map(function(d){return d.key}),c=t.map(function(d){return d.changes}),u=[];return this._trans("readwrite",function(d){return o.getMany({trans:d,keys:a,cache:"clone"}).then(function(p){var m=[],g=[];t.forEach(function(_,D){var w=_.key,E=_.changes,S=p[D];if(S){for(var T=0,C=Object.keys(E);T<C.length;T++){var k=C[T],P=E[k];if(k===n.schema.primKey.keyPath){if(ae(P,w)!==0)throw new Z.Constraint("Cannot update primary key in bulkUpdate()")}else ze(S,k,P)}u.push(D),m.push(w),g.push(S)}});var v=m.length;return o.mutate({trans:d,type:"put",keys:m,values:g,updates:{keys:a,changeSpecs:c}}).then(function(_){var D=_.numFailures,w=_.failures;if(D===0)return v;for(var E=0,S=Object.keys(w);E<S.length;E++){var T=S[E],C=u[Number(T)];if(C!=null){var k=w[T];delete w[T],w[C]=k}}throw new En("".concat(n.name,".bulkUpdate(): ").concat(D," of ").concat(v," operations failed"),w)})})})},e.prototype.bulkDelete=function(t){var n=this,o=t.length;return this._trans("readwrite",function(a){return n.core.mutate({trans:a,type:"delete",keys:t}).then(function(c){return Zr(n,t,c)})}).then(function(a){var c=a.numFailures,u=a.lastResult,d=a.failures;if(c===0)return u;throw new En("".concat(n.name,".bulkDelete(): ").concat(c," of ").concat(o," operations failed"),d)})},e})();function lr(e){var t={},n=function(d,p){if(p){for(var m=arguments.length,g=new Array(m-1);--m;)g[m-1]=arguments[m];return t[d].subscribe.apply(null,g),e}else if(typeof d=="string")return t[d]};n.addEventType=c;for(var o=1,a=arguments.length;o<a;++o)c(arguments[o]);return n;function c(d,p,m){if(typeof d=="object")return u(d);p||(p=_h),m||(m=pe);var g={subscribers:[],fire:m,subscribe:function(v){g.subscribers.indexOf(v)===-1&&(g.subscribers.push(v),g.fire=p(g.fire,v))},unsubscribe:function(v){g.subscribers=g.subscribers.filter(function(_){return _!==v}),g.fire=g.subscribers.reduce(p,m)}};return t[d]=n[d]=g,g}function u(d){Pe(d).forEach(function(p){var m=d[p];if(Se(m))c(p,d[p][0],d[p][1]);else if(m==="asap")var g=c(p,ur,function(){for(var _=arguments.length,D=new Array(_);_--;)D[_]=arguments[_];g.subscribers.forEach(function(w){Kc(function(){w.apply(null,D)})})});else throw new Z.InvalidArgument("Invalid event config")})}}function fr(e,t){return kn(t).from({prototype:e}),t}function Bh(e){return fr(ru.prototype,function(n,o,a){this.db=e,this._tx=a,this.name=n,this.schema=o,this.hook=e._allTables[n]?e._allTables[n].hook:lr(null,{creating:[vh,pe],reading:[yh,ur],updating:[wh,pe],deleting:[bh,pe]})})}function wn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function po(e,t){e.filter=an(e.filter,t)}function ho(e,t,n){var o=e.replayFilter;e.replayFilter=o?function(){return an(o(),t())}:t,e.justLimit=n&&!o}function $h(e,t){e.isMatch=an(e.isMatch,t)}function ei(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new Z.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Cc(e,t,n){var o=ei(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:o,range:e.range}})}function Hr(e,t,n,o){var a=e.replayFilter?an(e.filter,e.replayFilter()):e.filter;if(e.or){var c={},u=function(d,p,m){if(!a||a(p,m,function(_){return p.stop(_)},function(_){return p.fail(_)})){var g=p.primaryKey,v=""+g;v==="[object ArrayBuffer]"&&(v=""+new Uint8Array(g)),Je(c,v)||(c[v]=!0,t(d,p,m))}};return Promise.all([e.or._iterate(u,n),Ac(Cc(e,o,n),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}else return Ac(Cc(e,o,n),an(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function Ac(e,t,n,o){var a=o?function(u,d,p){return n(o(u),d,p)}:n,c=we(a);return e.then(function(u){if(u)return u.start(function(){var d=function(){return u.continue()};(!t||t(u,function(p){return d=p},function(p){u.stop(p),d=pe},function(p){u.fail(p),d=pe}))&&c(u.value,u,function(p){return d=p}),d()})})}var Uh=(function(){function e(){}return e.prototype._read=function(t,n){var o=this._ctx;return o.error?o.table._trans(null,Te.bind(null,o.error)):o.table._trans("readonly",t).then(n)},e.prototype._write=function(t){var n=this._ctx;return n.error?n.table._trans(null,Te.bind(null,n.error)):n.table._trans("readwrite",t,"locked")},e.prototype._addAlgorithm=function(t){var n=this._ctx;n.algorithm=an(n.algorithm,t)},e.prototype._iterate=function(t,n){return Hr(this._ctx,t,n,this._ctx.table.core)},e.prototype.clone=function(t){var n=Object.create(this.constructor.prototype),o=Object.create(this._ctx);return t&&Qe(o,t),n._ctx=o,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(t){var n=this._ctx;return this._read(function(o){return Hr(n,t,o,n.table.core)})},e.prototype.count=function(t){var n=this;return this._read(function(o){var a=n._ctx,c=a.table.core;if(wn(a,!0))return c.count({trans:o,query:{index:ei(a,c.schema),range:a.range}}).then(function(d){return Math.min(d,a.limit)});var u=0;return Hr(a,function(){return++u,!1},o,c).then(function(){return u})}).then(t)},e.prototype.sortBy=function(t,n){var o=t.split(".").reverse(),a=o[0],c=o.length-1;function u(m,g){return g?u(m[o[g]],g-1):m[a]}var d=this._ctx.dir==="next"?1:-1;function p(m,g){var v=u(m,c),_=u(g,c);return ae(v,_)*d}return this.toArray(function(m){return m.sort(p)}).then(n)},e.prototype.toArray=function(t){var n=this;return this._read(function(o){var a=n._ctx;if(a.dir==="next"&&wn(a,!0)&&a.limit>0){var c=a.valueMapper,u=ei(a,a.table.core.schema);return a.table.core.query({trans:o,limit:a.limit,values:!0,query:{index:u,range:a.range}}).then(function(p){var m=p.result;return c?m.map(c):m})}else{var d=[];return Hr(a,function(p){return d.push(p)},o,a.table.core).then(function(){return d})}},t)},e.prototype.offset=function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,wn(n)?ho(n,function(){var o=t;return function(a,c){return o===0?!0:o===1?(--o,!1):(c(function(){a.advance(o),o=0}),!1)}}):ho(n,function(){var o=t;return function(){return--o<0}}),this)},e.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),ho(this._ctx,function(){var n=t;return function(o,a,c){return--n<=0&&a(c),n>=0}},!0),this},e.prototype.until=function(t,n){return po(this._ctx,function(o,a,c){return t(o.value)?(a(c),n):!0}),this},e.prototype.first=function(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)},e.prototype.last=function(t){return this.reverse().first(t)},e.prototype.filter=function(t){return po(this._ctx,function(n){return t(n.value)}),$h(this._ctx,t),this},e.prototype.and=function(t){return this.filter(t)},e.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(o,a){t(a.key,a)})},e.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},e.prototype.eachPrimaryKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(o,a){t(a.primaryKey,a)})},e.prototype.keys=function(t){var n=this._ctx;n.keysOnly=!n.isMatch;var o=[];return this.each(function(a,c){o.push(c.key)}).then(function(){return o}).then(t)},e.prototype.primaryKeys=function(t){var n=this._ctx;if(n.dir==="next"&&wn(n,!0)&&n.limit>0)return this._read(function(a){var c=ei(n,n.table.core.schema);return n.table.core.query({trans:a,values:!1,limit:n.limit,query:{index:c,range:n.range}})}).then(function(a){var c=a.result;return c}).then(t);n.keysOnly=!n.isMatch;var o=[];return this.each(function(a,c){o.push(c.primaryKey)}).then(function(){return o}).then(t)},e.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},e.prototype.firstKey=function(t){return this.limit(1).keys(function(n){return n[0]}).then(t)},e.prototype.lastKey=function(t){return this.reverse().firstKey(t)},e.prototype.distinct=function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var o={};return po(this._ctx,function(a){var c=a.primaryKey.toString(),u=Je(o,c);return o[c]=!0,!u}),this},e.prototype.modify=function(t){var n=this,o=this._ctx;return this._write(function(a){var c;typeof t=="function"?c=t:c=function(T){return nu(T,t)};var u=o.table.core,d=u.schema.primaryKey,p=d.outbound,m=d.extractKey,g=200,v=n.db._options.modifyChunkSize;v&&(typeof v=="object"?g=v[u.name]||v["*"]||200:g=v);var _=[],D=0,w=[],E=function(T,C){var k=C.failures,P=C.numFailures;D+=T-P;for(var A=0,U=Pe(k);A<U.length;A++){var V=U[A];_.push(k[V])}},S=t===Pc;return n.clone().primaryKeys().then(function(T){var C=wn(o)&&o.limit===1/0&&(typeof t!="function"||S)&&{index:o.index,range:o.range},k=function(P){var A=Math.min(g,T.length-P),U=T.slice(P,P+A);return(S?Promise.resolve([]):u.getMany({trans:a,keys:U,cache:"immutable"})).then(function(V){var j=[],B=[],H=p?[]:null,F=S?U:[];if(!S)for(var N=0;N<A;++N){var L=V[N],z={value:nn(L),primKey:T[P+N]};c.call(z,z.value,z)!==!1&&(z.value==null?F.push(T[P+N]):!p&&ae(m(L),m(z.value))!==0?(F.push(T[P+N]),j.push(z.value)):(B.push(z.value),p&&H.push(T[P+N])))}return Promise.resolve(j.length>0&&u.mutate({trans:a,type:"add",values:j}).then(function($){for(var X in $.failures)F.splice(parseInt(X),1);E(j.length,$)})).then(function(){return(B.length>0||C&&typeof t=="object")&&u.mutate({trans:a,type:"put",keys:H,values:B,criteria:C,changeSpec:typeof t!="function"&&t,isAdditionalChunk:P>0}).then(function($){return E(B.length,$)})}).then(function(){return(F.length>0||C&&S)&&u.mutate({trans:a,type:"delete",keys:F,criteria:C,isAdditionalChunk:P>0}).then(function($){return Zr(o.table,F,$)}).then(function($){return E(F.length,$)})}).then(function(){return T.length>P+A&&k(P+g)})})};return k(0).then(function(){if(_.length>0)throw new ni("Error modifying one or more objects",_,D,w);return T.length})})})},e.prototype.delete=function(){var t=this._ctx,n=t.range;return wn(t)&&!t.table.schema.yProps&&(t.isPrimKey||n.type===3)?this._write(function(o){var a=t.table.core.schema.primaryKey,c=n;return t.table.core.count({trans:o,query:{index:a,range:c}}).then(function(u){return t.table.core.mutate({trans:o,type:"deleteRange",range:c}).then(function(d){var p=d.failures,m=d.numFailures;if(m)throw new ni("Could not delete some values",Object.keys(p).map(function(g){return p[g]}),u-m);return u-m})})}):this.modify(Pc)},e})(),Pc=function(e,t){return t.value=null};function Kh(e){return fr(Uh.prototype,function(n,o){this.db=e;var a=tu,c=null;if(o)try{a=o()}catch(m){c=m}var u=n._ctx,d=u.table,p=d.hook.reading.fire;this._ctx={table:d,index:u.index,isPrimKey:!u.index||d.schema.primKey.keyPath&&u.index===d.schema.primKey.name,range:a,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:u.or,valueMapper:p!==ur?p:null}})}function jh(e,t){return e<t?-1:e===t?0:1}function Hh(e,t){return e>t?-1:e===t?0:1}function qe(e,t,n){var o=e instanceof ou?new e.Collection(e):e;return o._ctx.error=n?new n(t):new TypeError(t),o}function _n(e){return new e.Collection(e,function(){return iu("")}).limit(0)}function Vh(e){return e==="next"?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function Wh(e){return e==="next"?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function Gh(e,t,n,o,a,c){for(var u=Math.min(e.length,o.length),d=-1,p=0;p<u;++p){var m=t[p];if(m!==o[p])return a(e[p],n[p])<0?e.substr(0,p)+n[p]+n.substr(p+1):a(e[p],o[p])<0?e.substr(0,p)+o[p]+n.substr(p+1):d>=0?e.substr(0,d)+t[d]+n.substr(d+1):null;a(e[p],m)<0&&(d=p)}return u<o.length&&c==="next"?e+n.substr(e.length):u<e.length&&c==="prev"?e.substr(0,n.length):d<0?null:e.substr(0,d)+o[d]+n.substr(d+1)}function Vr(e,t,n,o){var a,c,u,d,p,m,g,v=n.length;if(!n.every(function(E){return typeof E=="string"}))return qe(e,eu);function _(E){a=Vh(E),c=Wh(E),u=E==="next"?jh:Hh;var S=n.map(function(T){return{lower:c(T),upper:a(T)}}).sort(function(T,C){return u(T.lower,C.lower)});d=S.map(function(T){return T.upper}),p=S.map(function(T){return T.lower}),m=E,g=E==="next"?"":o}_("next");var D=new e.Collection(e,function(){return Dt(d[0],p[v-1]+o)});D._ondirectionchange=function(E){_(E)};var w=0;return D._addAlgorithm(function(E,S,T){var C=E.key;if(typeof C!="string")return!1;var k=c(C);if(t(k,p,w))return!0;for(var P=null,A=w;A<v;++A){var U=Gh(C,k,d[A],p[A],u,m);U===null&&P===null?w=A+1:(P===null||u(P,U)>0)&&(P=U)}return S(P!==null?function(){E.continue(P+g)}:T),!1}),D}function Dt(e,t,n,o){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:o}}function iu(e){return{type:1,lower:e,upper:e}}var ou=(function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(t,n,o,a){o=o!==!1,a=a===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(o||a)&&!(o&&a)?_n(this):new this.Collection(this,function(){return Dt(t,n,!o,!a)})}catch{return qe(this,_t)}},e.prototype.equals=function(t){return t==null?qe(this,_t):new this.Collection(this,function(){return iu(t)})},e.prototype.above=function(t){return t==null?qe(this,_t):new this.Collection(this,function(){return Dt(t,void 0,!0)})},e.prototype.aboveOrEqual=function(t){return t==null?qe(this,_t):new this.Collection(this,function(){return Dt(t,void 0,!1)})},e.prototype.below=function(t){return t==null?qe(this,_t):new this.Collection(this,function(){return Dt(void 0,t,!1,!0)})},e.prototype.belowOrEqual=function(t){return t==null?qe(this,_t):new this.Collection(this,function(){return Dt(void 0,t)})},e.prototype.startsWith=function(t){return typeof t!="string"?qe(this,eu):this.between(t,t+Qt,!0,!0)},e.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):Vr(this,function(n,o){return n.indexOf(o[0])===0},[t],Qt)},e.prototype.equalsIgnoreCase=function(t){return Vr(this,function(n,o){return n===o[0]},[t],"")},e.prototype.anyOfIgnoreCase=function(){var t=St.apply(Sn,arguments);return t.length===0?_n(this):Vr(this,function(n,o){return o.indexOf(n)!==-1},t,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var t=St.apply(Sn,arguments);return t.length===0?_n(this):Vr(this,function(n,o){return o.some(function(a){return n.indexOf(a)===0})},t,Qt)},e.prototype.anyOf=function(){var t=this,n=St.apply(Sn,arguments),o=this._cmp;try{n.sort(o)}catch{return qe(this,_t)}if(n.length===0)return _n(this);var a=new this.Collection(this,function(){return Dt(n[0],n[n.length-1])});a._ondirectionchange=function(u){o=u==="next"?t._ascending:t._descending,n.sort(o)};var c=0;return a._addAlgorithm(function(u,d,p){for(var m=u.key;o(m,n[c])>0;)if(++c,c===n.length)return d(p),!1;return o(m,n[c])===0?!0:(d(function(){u.continue(n[c])}),!1)}),a},e.prototype.notEqual=function(t){return this.inAnyRange([[Co,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var t=St.apply(Sn,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return qe(this,_t)}var n=t.reduce(function(o,a){return o?o.concat([[o[o.length-1][1],a]]):[[Co,a]]},null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(t,n){var o=this,a=this._cmp,c=this._ascending,u=this._descending,d=this._min,p=this._max;if(t.length===0)return _n(this);if(!t.every(function(A){return A[0]!==void 0&&A[1]!==void 0&&c(A[0],A[1])<=0}))return qe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var m=!n||n.includeLowers!==!1,g=n&&n.includeUppers===!0;function v(A,U){for(var V=0,j=A.length;V<j;++V){var B=A[V];if(a(U[0],B[1])<0&&a(U[1],B[0])>0){B[0]=d(B[0],U[0]),B[1]=p(B[1],U[1]);break}}return V===j&&A.push(U),A}var _=c;function D(A,U){return _(A[0],U[0])}var w;try{w=t.reduce(v,[]),w.sort(D)}catch{return qe(this,_t)}var E=0,S=g?function(A){return c(A,w[E][1])>0}:function(A){return c(A,w[E][1])>=0},T=m?function(A){return u(A,w[E][0])>0}:function(A){return u(A,w[E][0])>=0};function C(A){return!S(A)&&!T(A)}var k=S,P=new this.Collection(this,function(){return Dt(w[0][0],w[w.length-1][1],!m,!g)});return P._ondirectionchange=function(A){A==="next"?(k=S,_=c):(k=T,_=u),w.sort(D)},P._addAlgorithm(function(A,U,V){for(var j=A.key;k(j);)if(++E,E===w.length)return U(V),!1;return C(j)?!0:(o._cmp(j,w[E][1])===0||o._cmp(j,w[E][0])===0||U(function(){_===c?A.continue(w[E][0]):A.continue(w[E][1])}),!1)}),P},e.prototype.startsWithAnyOf=function(){var t=St.apply(Sn,arguments);return t.every(function(n){return typeof n=="string"})?t.length===0?_n(this):this.inAnyRange(t.map(function(n){return[n,n+Qt]})):qe(this,"startsWithAnyOf() only works with strings")},e})();function zh(e){return fr(ou.prototype,function(n,o,a){if(this.db=e,this._ctx={table:n,index:o===":id"?null:o,or:a},this._cmp=this._ascending=ae,this._descending=function(c,u){return ae(u,c)},this._max=function(c,u){return ae(c,u)>0?c:u},this._min=function(c,u){return ae(c,u)<0?c:u},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new Z.MissingAPI})}function dt(e){return we(function(t){return ar(t),e(t.target.error),!1})}function ar(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var dr="storagemutated",Ao="x-storagemutated-1",$t=lr(null,dr),Jh=(function(){function e(){}return e.prototype._lock=function(){return er(!Q.global),++this._reculock,this._reculock===1&&!Q.global&&(Q.lockOwnerFor=this),this},e.prototype._unlock=function(){if(er(!Q.global),--this._reculock===0)for(Q.global||(Q.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{on(t[1],t[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&Q.lockOwnerFor!==this},e.prototype.create=function(t){var n=this;if(!this.mode)return this;var o=this.db.idbdb,a=this.db._state.dbOpenError;if(er(!this.idbtrans),!t&&!o)switch(a&&a.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(a);case"MissingAPIError":throw new Z.MissingAPI(a.message,a);default:throw new Z.OpenFailed(a)}if(!this.active)throw new Z.TransactionInactive;return er(this._completion._state===null),t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):o.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),t.onerror=we(function(c){ar(c),n._reject(t.error)}),t.onabort=we(function(c){ar(c),n.active&&n._reject(new Z.Abort(t.error)),n.active=!1,n.on("abort").fire(c)}),t.oncomplete=we(function(){n.active=!1,n._resolve(),"mutatedParts"in t&&$t.storagemutated.fire(t.mutatedParts)}),this},e.prototype._promise=function(t,n,o){var a=this;if(t==="readwrite"&&this.mode!=="readwrite")return Te(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return Te(new Z.TransactionInactive);if(this._locked())return new W(function(u,d){a._blockedFuncs.push([function(){a._promise(t,n,o).then(u,d)},Q])});if(o)return Nt(function(){var u=new W(function(d,p){a._lock();var m=n(d,p,a);m&&m.then&&m.then(d,p)});return u.finally(function(){return a._unlock()}),u._lib=!0,u});var c=new W(function(u,d){var p=n(u,d,a);p&&p.then&&p.then(u,d)});return c._lib=!0,c},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(t){var n=this._root(),o=W.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return o});else{n._waitingFor=o,n._waitingQueue=[];var a=n.idbtrans.objectStore(n.storeNames[0]);(function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(a.get(-1/0).onsuccess=u)})()}var c=n._waitingFor;return new W(function(u,d){o.then(function(p){return n._waitingQueue.push(we(u.bind(null,p)))},function(p){return n._waitingQueue.push(we(d.bind(null,p)))}).finally(function(){n._waitingFor===c&&(n._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Z.Abort))},e.prototype.table=function(t){var n=this._memoizedTables||(this._memoizedTables={});if(Je(n,t))return n[t];var o=this.schema[t];if(!o)throw new Z.NotFound("Table "+t+" not part of transaction");var a=new this.db.Table(t,o,this);return a.core=this.db.core.table(t),n[t]=a,a},e})();function Yh(e){return fr(Jh.prototype,function(n,o,a,c,u){var d=this;n!=="readonly"&&o.forEach(function(p){var m,g=(m=a[p])===null||m===void 0?void 0:m.yProps;g&&(o=o.concat(g.map(function(v){return v.updatesTable})))}),this.db=e,this.mode=n,this.storeNames=o,this.schema=a,this.chromeTransactionDurability=c,this.idbtrans=null,this.on=lr(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new W(function(p,m){d._resolve=p,d._reject=m}),this._completion.then(function(){d.active=!1,d.on.complete.fire()},function(p){var m=d.active;return d.active=!1,d.on.error.fire(p),d.parent?d.parent._reject(p):m&&d.idbtrans&&d.idbtrans.abort(),Te(p)})})}function Po(e,t,n,o,a,c,u,d){return{name:e,keyPath:t,unique:n,multi:o,auto:a,compound:c,src:(n&&!u?"&":"")+(o?"*":"")+(a?"++":"")+au(t),type:d}}function au(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Vo(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:ah(n,function(o){return[o.name,o]})}}function Xh(e){return e.length===1?e[0]:e}var sr=function(e){try{return e.only([[]]),sr=function(){return[[]]},[[]]}catch{return sr=function(){return Qt},Qt}};function Do(e){return e==null?function(){}:typeof e=="string"?qh(e):function(t){return Et(t,e)}}function qh(e){var t=e.split(".");return t.length===1?function(n){return n[e]}:function(n){return Et(n,e)}}function Dc(e){return[].slice.call(e)}var Qh=0;function rr(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Zh(e,t,n){function o(v,_){var D=Dc(v.objectStoreNames);return{schema:{name:v.name,tables:D.map(function(w){return _.objectStore(w)}).map(function(w){var E=w.keyPath,S=w.autoIncrement,T=Se(E),C=E==null,k={},P={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:C,compound:T,keyPath:E,autoIncrement:S,unique:!0,extractKey:Do(E)},indexes:Dc(w.indexNames).map(function(A){return w.index(A)}).map(function(A){var U=A.name,V=A.unique,j=A.multiEntry,B=A.keyPath,H=Se(B),F={name:U,compound:H,keyPath:B,unique:V,multiEntry:j,extractKey:Do(B)};return k[rr(B)]=F,F}),getIndexByKeyPath:function(A){return k[rr(A)]}};return k[":id"]=P.primaryKey,E!=null&&(k[rr(E)]=P.primaryKey),P})},hasGetAll:D.length>0&&"getAll"in _.objectStore(D[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function a(v){if(v.type===3)return null;if(v.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var _=v.lower,D=v.upper,w=v.lowerOpen,E=v.upperOpen,S=_===void 0?D===void 0?null:t.upperBound(D,!!E):D===void 0?t.lowerBound(_,!!w):t.bound(_,D,!!w,!!E);return S}function c(v){var _=v.name;function D(S){var T=S.trans,C=S.type,k=S.keys,P=S.values,A=S.range;return new Promise(function(U,V){U=we(U);var j=T.objectStore(_),B=j.keyPath==null,H=C==="put"||C==="add";if(!H&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var F=(k||P||{length:1}).length;if(k&&P&&k.length!==P.length)throw new Error("Given keys array must have same length as given values array.");if(F===0)return U({numFailures:0,failures:{},results:[],lastResult:void 0});var N,L=[],z=[],$=0,X=function(Ee){++$,ar(Ee)};if(C==="deleteRange"){if(A.type===4)return U({numFailures:$,failures:z,results:[],lastResult:void 0});A.type===3?L.push(N=j.clear()):L.push(N=j.delete(a(A)))}else{var te=H?B?[P,k]:[P,null]:[k,null],ne=te[0],ue=te[1];if(H)for(var _e=0;_e<F;++_e)L.push(N=ue&&ue[_e]!==void 0?j[C](ne[_e],ue[_e]):j[C](ne[_e])),N.onerror=X;else for(var _e=0;_e<F;++_e)L.push(N=j[C](ne[_e])),N.onerror=X}var ye=function(Ee){var se=Ee.target.result;L.forEach(function(me,M){return me.error!=null&&(z[M]=me.error)}),U({numFailures:$,failures:z,results:C==="delete"?k:L.map(function(me){return me.result}),lastResult:se})};N.onerror=function(Ee){X(Ee),ye(Ee)},N.onsuccess=ye})}function w(S){var T=S.trans,C=S.values,k=S.query,P=S.reverse,A=S.unique;return new Promise(function(U,V){U=we(U);var j=k.index,B=k.range,H=T.objectStore(_),F=j.isPrimaryKey?H:H.index(j.name),N=P?A?"prevunique":"prev":A?"nextunique":"next",L=C||!("openKeyCursor"in F)?F.openCursor(a(B),N):F.openKeyCursor(a(B),N);L.onerror=dt(V),L.onsuccess=we(function(z){var $=L.result;if(!$){U(null);return}$.___id=++Qh,$.done=!1;var X=$.continue.bind($),te=$.continuePrimaryKey;te&&(te=te.bind($));var ne=$.advance.bind($),ue=function(){throw new Error("Cursor not started")},_e=function(){throw new Error("Cursor not stopped")};$.trans=T,$.stop=$.continue=$.continuePrimaryKey=$.advance=ue,$.fail=we(V),$.next=function(){var ye=this,Ee=1;return this.start(function(){return Ee--?ye.continue():ye.stop()}).then(function(){return ye})},$.start=function(ye){var Ee=new Promise(function(me,M){me=we(me),L.onerror=dt(M),$.fail=M,$.stop=function(he){$.stop=$.continue=$.continuePrimaryKey=$.advance=_e,me(he)}}),se=function(){if(L.result)try{ye()}catch(me){$.fail(me)}else $.done=!0,$.start=function(){throw new Error("Cursor behind last entry")},$.stop()};return L.onsuccess=we(function(me){L.onsuccess=se,se()}),$.continue=X,$.continuePrimaryKey=te,$.advance=ne,se(),Ee},U($)},V)})}function E(S){return function(T){return new Promise(function(C,k){C=we(C);var P=T.trans,A=T.values,U=T.limit,V=T.query,j=U===1/0?void 0:U,B=V.index,H=V.range,F=P.objectStore(_),N=B.isPrimaryKey?F:F.index(B.name),L=a(H);if(U===0)return C({result:[]});if(S){var z=A?N.getAll(L,j):N.getAllKeys(L,j);z.onsuccess=function(ne){return C({result:ne.target.result})},z.onerror=dt(k)}else{var $=0,X=A||!("openKeyCursor"in N)?N.openCursor(L):N.openKeyCursor(L),te=[];X.onsuccess=function(ne){var ue=X.result;if(!ue)return C({result:te});if(te.push(A?ue.value:ue.primaryKey),++$===U)return C({result:te});ue.continue()},X.onerror=dt(k)}})}}return{name:_,schema:v,mutate:D,getMany:function(S){var T=S.trans,C=S.keys;return new Promise(function(k,P){k=we(k);for(var A=T.objectStore(_),U=C.length,V=new Array(U),j=0,B=0,H,F=function($){var X=$.target;(V[X._pos]=X.result)!=null,++B===j&&k(V)},N=dt(P),L=0;L<U;++L){var z=C[L];z!=null&&(H=A.get(C[L]),H._pos=L,H.onsuccess=F,H.onerror=N,++j)}j===0&&k(V)})},get:function(S){var T=S.trans,C=S.key;return new Promise(function(k,P){k=we(k);var A=T.objectStore(_),U=A.get(C);U.onsuccess=function(V){return k(V.target.result)},U.onerror=dt(P)})},query:E(p),openCursor:w,count:function(S){var T=S.query,C=S.trans,k=T.index,P=T.range;return new Promise(function(A,U){var V=C.objectStore(_),j=k.isPrimaryKey?V:V.index(k.name),B=a(P),H=B?j.count(B):j.count();H.onsuccess=we(function(F){return A(F.target.result)}),H.onerror=dt(U)})}}}var u=o(e,n),d=u.schema,p=u.hasGetAll,m=d.tables.map(function(v){return c(v)}),g={};return m.forEach(function(v){return g[v.name]=v}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(v){var _=g[v];if(!_)throw new Error("Table '".concat(v,"' not found"));return g[v]},MIN_KEY:-1/0,MAX_KEY:sr(t),schema:d}}function em(e,t){return t.reduce(function(n,o){var a=o.create;return re(re({},n),a(n))},e)}function tm(e,t,n,o){var a=n.IDBKeyRange;n.indexedDB;var c=em(Zh(t,a,o),e.dbcore);return{dbcore:c}}function ai(e,t){var n=t.db,o=tm(e._middlewares,n,e._deps,t);e.core=o.dbcore,e.tables.forEach(function(a){var c=a.name;e.core.schema.tables.some(function(u){return u.name===c})&&(a.core=e.core.table(c),e[c]instanceof e.Table&&(e[c].core=a.core))})}function si(e,t,n,o){n.forEach(function(a){var c=o[a];t.forEach(function(u){var d=$c(u,a);(!d||"value"in d&&d.value===void 0)&&(u===e.Transaction.prototype||u instanceof e.Transaction?Ft(u,a,{get:function(){return this.table(a)},set:function(p){Bc(this,a,{value:p,writable:!0,configurable:!0,enumerable:!0})}}):u[a]=new e.Table(a,c))})})}function Oo(e,t){t.forEach(function(n){for(var o in n)n[o]instanceof e.Table&&delete n[o]})}function nm(e,t){return e._cfg.version-t._cfg.version}function rm(e,t,n,o){var a=e._dbSchema;n.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=Vo("$meta",cu("")[0],[]),e._storeNames.push("$meta"));var c=e._createTransaction("readwrite",e._storeNames,a);c.create(n),c._completion.catch(o);var u=c._reject.bind(c),d=Q.transless||Q;Nt(function(){if(Q.trans=c,Q.transless=d,t===0)Pe(a).forEach(function(p){Go(n,p,a[p].primKey,a[p].indexes)}),ai(e,n),W.follow(function(){return e.on.populate.fire(c)}).catch(u);else return ai(e,n),om(e,c,t).then(function(p){return am(e,p,c,n)}).catch(u)})}function im(e,t){su(e._dbSchema,t),t.db.version%10===0&&!t.objectStoreNames.contains("$meta")&&t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=gi(e,e.idbdb,t);ui(e,e._dbSchema,t);for(var o=Wo(n,e._dbSchema),a=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var g=t.objectStore(m.name);m.add.forEach(function(v){pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(v.src)),ci(g,v)})},c=0,u=o.change;c<u.length;c++){var d=u[c],p=a(d);if(typeof p=="object")return p.value}}function om(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then(function(o){return o??n}):W.resolve(n)}function am(e,t,n,o){var a=[],c=e._versions,u=e._dbSchema=gi(e,e.idbdb,o),d=c.filter(function(m){return m._cfg.version>=t});if(d.length===0)return W.resolve();d.forEach(function(m){a.push(function(){var g=u,v=m._cfg.dbschema;ui(e,g,o),ui(e,v,o),u=e._dbSchema=v;var _=Wo(g,v);_.add.forEach(function(C){Go(o,C[0],C[1].primKey,C[1].indexes)}),_.change.forEach(function(C){if(C.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var k=o.objectStore(C.name);C.add.forEach(function(P){return ci(k,P)}),C.change.forEach(function(P){k.deleteIndex(P.name),ci(k,P)}),C.del.forEach(function(P){return k.deleteIndex(P)})});var D=m._cfg.contentUpgrade;if(D&&m._cfg.version>t){ai(e,o),n._memoizedTables={};var w=jc(v);_.del.forEach(function(C){w[C]=g[C]}),Oo(e,[e.Transaction.prototype]),si(e,[e.Transaction.prototype],Pe(w),w),n.schema=w;var E=No(D);E&&Dn();var S,T=W.follow(function(){if(S=D(n),S&&E){var C=Lt.bind(null,null);S.then(C,C)}});return S&&typeof S.then=="function"?W.resolve(S):T.then(function(){return S})}}),a.push(function(g){var v=m._cfg.dbschema;sm(v,g),Oo(e,[e.Transaction.prototype]),si(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),a.push(function(g){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===m._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(v){return v!=="$meta"})):g.objectStore("$meta").put(m._cfg.version,"version"))})});function p(){return a.length?W.resolve(a.shift()(n.idbtrans)).then(p):W.resolve()}return p().then(function(){su(u,o)})}function Wo(e,t){var n={del:[],add:[],change:[]},o;for(o in e)t[o]||n.del.push(o);for(o in t){var a=e[o],c=t[o];if(!a)n.add.push([o,c]);else{var u={name:o,def:c,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(c.primKey.keyPath||"")||a.primKey.auto!==c.primKey.auto)u.recreate=!0,n.change.push(u);else{var d=a.idxByName,p=c.idxByName,m=void 0;for(m in d)p[m]||u.del.push(m);for(m in p){var g=d[m],v=p[m];g?g.src!==v.src&&u.change.push(v):u.add.push(v)}(u.del.length>0||u.add.length>0||u.change.length>0)&&n.change.push(u)}}}return n}function Go(e,t,n,o){var a=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return o.forEach(function(c){return ci(a,c)}),a}function su(e,t){Pe(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(pt&&console.debug("Dexie: Creating missing table",n),Go(t,n,e[n].primKey,e[n].indexes))})}function sm(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return e[n]==null&&t.db.deleteObjectStore(n)})}function ci(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function gi(e,t,n){var o={},a=pi(t.objectStoreNames,0);return a.forEach(function(c){for(var u=n.objectStore(c),d=u.keyPath,p=Po(au(d),d||"",!0,!1,!!u.autoIncrement,d&&typeof d!="string",!0),m=[],g=0;g<u.indexNames.length;++g){var v=u.index(u.indexNames[g]);d=v.keyPath;var _=Po(v.name,d,!!v.unique,!!v.multiEntry,!1,d&&typeof d!="string",!1);m.push(_)}o[c]=Vo(c,p,m)}),o}function cm(e,t,n){e.verno=t.version/10;var o=e._dbSchema=gi(e,t,n);e._storeNames=pi(t.objectStoreNames,0),si(e,[e._allTables],Pe(o),o)}function um(e,t){var n=gi(e,e.idbdb,t),o=Wo(n,e._dbSchema);return!(o.add.length||o.change.some(function(a){return a.add.length||a.change.length}))}function ui(e,t,n){for(var o=n.db.objectStoreNames,a=0;a<o.length;++a){var c=o[a],u=n.objectStore(c);e._hasGetAll="getAll"in u;for(var d=0;d<u.indexNames.length;++d){var p=u.indexNames[d],m=u.index(p).keyPath,g=typeof m=="string"?m:"["+pi(m).join("+")+"]";if(t[c]){var v=t[c].idxByName[g];v&&(v.name=p,delete t[c].idxByName[g],t[c].idxByName[p]=v)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Be.WorkerGlobalScope&&Be instanceof Be.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function cu(e){return e.split(",").map(function(t,n){var o,a=t.split(":"),c=(o=a[1])===null||o===void 0?void 0:o.trim();t=a[0].trim();var u=t.replace(/([&*]|\+\+)/g,""),d=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Po(u,d||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),Se(d),n===0,c)})}var lm=(function(){function e(){}return e.prototype._createTableSchema=function(t,n,o){return Vo(t,n,o)},e.prototype._parseIndexSyntax=function(t){return cu(t)},e.prototype._parseStoresSpec=function(t,n){var o=this;Pe(t).forEach(function(a){if(t[a]!==null){var c=o._parseIndexSyntax(t[a]),u=c.shift();if(!u)throw new Z.Schema("Invalid schema for table "+a+": "+t[a]);if(u.unique=!0,u.multi)throw new Z.Schema("Primary key cannot be multiEntry*");c.forEach(function(p){if(p.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!p.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")});var d=o._createTableSchema(a,u,c);n[a]=d}})},e.prototype.stores=function(t){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?Qe(this._cfg.storesSource,t):t;var o=n._versions,a={},c={};return o.forEach(function(u){Qe(a,u._cfg.storesSource),c=u._cfg.dbschema={},u._parseStoresSpec(a,c)}),n._dbSchema=c,Oo(n,[n._allTables,n,n.Transaction.prototype]),si(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Pe(c),c),n._storeNames=Pe(c),this},e.prototype.upgrade=function(t){return this._cfg.contentUpgrade=$o(this._cfg.contentUpgrade||pe,t),this},e})();function fm(e){return fr(lm.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function zo(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ut(mi,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Jo(e){return e&&typeof e.databases=="function"}function dm(e){var t=e.indexedDB,n=e.IDBKeyRange;return Jo(t)?Promise.resolve(t.databases()).then(function(o){return o.map(function(a){return a.name}).filter(function(a){return a!==mi})}):zo(t,n).toCollection().primaryKeys()}function pm(e,t){var n=e.indexedDB,o=e.IDBKeyRange;!Jo(n)&&t!==mi&&zo(n,o).put({name:t}).catch(pe)}function hm(e,t){var n=e.indexedDB,o=e.IDBKeyRange;!Jo(n)&&t!==mi&&zo(n,o).delete(t).catch(pe)}function Ro(e){return Nt(function(){return Q.letThrough=!0,e()})}function mm(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var t;return new Promise(function(n){var o=function(){return indexedDB.databases().finally(n)};t=setInterval(o,100),o()}).finally(function(){return clearInterval(t)})}var mo;function Yo(e){return!("from"in e)}var We=function(e,t){if(this)Qe(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{var n=new We;return e&&"d"in e&&Qe(n,e),n}};Tn(We.prototype,(mo={add:function(e){return li(this,e),this},addKey:function(e){return cr(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return cr(t,n,n)}),this},hasKey:function(e){var t=fi(this).next(e).value;return t&&ae(t.from,e)<=0&&ae(t.to,e)>=0}},mo[So]=function(){return fi(this)},mo));function cr(e,t,n){var o=ae(t,n);if(!isNaN(o)){if(o>0)throw RangeError();if(Yo(e))return Qe(e,{from:t,to:n,d:1});var a=e.l,c=e.r;if(ae(n,e.from)<0)return a?cr(a,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Oc(e);if(ae(t,e.to)>0)return c?cr(c,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Oc(e);ae(t,e.from)<0&&(e.from=t,e.l=null,e.d=c?c.d+1:1),ae(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var u=!e.r;a&&!e.l&&li(e,a),c&&u&&li(e,c)}}function li(e,t){function n(o,a){var c=a.from,u=a.to,d=a.l,p=a.r;cr(o,c,u),d&&n(o,d),p&&n(o,p)}Yo(t)||n(e,t)}function gm(e,t){var n=fi(t),o=n.next();if(o.done)return!1;for(var a=o.value,c=fi(e),u=c.next(a.from),d=u.value;!o.done&&!u.done;){if(ae(d.from,a.to)<=0&&ae(d.to,a.from)>=0)return!0;ae(a.from,d.from)<0?a=(o=n.next(d.from)).value:d=(u=c.next(a.from)).value}return!1}function fi(e){var t=Yo(e)?null:{s:0,n:e};return{next:function(n){for(var o=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,o)for(;t.n.l&&ae(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!o||ae(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Oc(e){var t,n,o=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),a=o>1?"r":o<-1?"l":"";if(a){var c=a==="r"?"l":"r",u=re({},e),d=e[a];e.from=d.from,e.to=d.to,e[a]=d[a],u[a]=d[c],e[c]=u,u.d=Rc(u)}e.d=Rc(e)}function Rc(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function yi(e,t){return Pe(t).forEach(function(n){e[n]?li(e[n],t[n]):e[n]=Wc(t[n])}),e}function Xo(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&gm(t[n],e[n])})}var tn={},go={},yo=!1;function Wr(e,t){yi(go,e),yo||(yo=!0,setTimeout(function(){yo=!1;var n=go;go={},qo(n,!1)},0))}function qo(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var o=0,a=Object.values(tn);o<a.length;o++){var c=a[o];Mc(c,e,n,t)}else for(var u in e){var d=/^idb\:\/\/(.*)\/(.*)\//.exec(u);if(d){var p=d[1],m=d[2],c=tn["idb://".concat(p,"/").concat(m)];c&&Mc(c,e,n,t)}}n.forEach(function(g){return g()})}function Mc(e,t,n,o){for(var a=[],c=0,u=Object.entries(e.queries.query);c<u.length;c++){for(var d=u[c],p=d[0],m=d[1],g=[],v=0,_=m;v<_.length;v++){var D=_[v];Xo(t,D.obsSet)?D.subscribers.forEach(function(T){return n.add(T)}):o&&g.push(D)}o&&a.push([p,g])}if(o)for(var w=0,E=a;w<E.length;w++){var S=E[w],p=S[0],g=S[1];e.queries.query[p]=g}}function ym(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Te(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var o=t.openCanceller,a=Math.round(e.verno*10),c=!1;function u(){if(t.openCanceller!==o)throw new Z.DatabaseClosed("db.open() was cancelled")}var d=t.dbReadyResolve,p=null,m=!1,g=function(){return new W(function(v,_){if(u(),!n)throw new Z.MissingAPI;var D=e.name,w=t.autoSchema||!a?n.open(D):n.open(D,a);if(!w)throw new Z.MissingAPI;w.onerror=dt(_),w.onblocked=we(e._fireOnBlocked),w.onupgradeneeded=we(function(E){if(p=w.transaction,t.autoSchema&&!e._options.allowEmptyDB){w.onerror=ar,p.abort(),w.result.close();var S=n.deleteDatabase(D);S.onsuccess=S.onerror=we(function(){_(new Z.NoSuchDatabase("Database ".concat(D," doesnt exist")))})}else{p.onerror=dt(_);var T=E.oldVersion>Math.pow(2,62)?0:E.oldVersion;m=T<1,e.idbdb=w.result,c&&im(e,p),rm(e,T/10,p,_)}},_),w.onsuccess=we(function(){p=null;var E=e.idbdb=w.result,S=pi(E.objectStoreNames);if(S.length>0)try{var T=E.transaction(Xh(S),"readonly");if(t.autoSchema)cm(e,E,T);else if(ui(e,e._dbSchema,T),!um(e,T)&&!c)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),E.close(),a=E.version+1,c=!0,v(g());ai(e,T)}catch{}In.push(e),E.onversionchange=we(function(C){t.vcFired=!0,e.on("versionchange").fire(C)}),E.onclose=we(function(){e.close({disableAutoOpen:!1})}),m&&pm(e._deps,D),v()},_)}).catch(function(v){switch(v?.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),g();break;case"VersionError":if(a>0)return a=0,g();break}return W.reject(v)})};return W.race([o,(typeof navigator>"u"?W.resolve():mm()).then(g)]).then(function(){return u(),t.onReadyBeingFired=[],W.resolve(Ro(function(){return e.on.ready.fire(e.vip)})).then(function v(){if(t.onReadyBeingFired.length>0){var _=t.onReadyBeingFired.reduce($o,pe);return t.onReadyBeingFired=[],W.resolve(Ro(function(){return _(e.vip)})).then(v)}})}).finally(function(){t.openCanceller===o&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(v){t.dbOpenError=v;try{p&&p.abort()}catch{}return o===t.openCanceller&&e._close(),Te(v)}).finally(function(){t.openComplete=!0,d()}).then(function(){if(m){var v={};e.tables.forEach(function(_){_.schema.indexes.forEach(function(D){D.name&&(v["idb://".concat(e.name,"/").concat(_.name,"/").concat(D.name)]=new We(-1/0,[[[]]]))}),v["idb://".concat(e.name,"/").concat(_.name,"/")]=v["idb://".concat(e.name,"/").concat(_.name,"/:dels")]=new We(-1/0,[[[]]])}),$t(dr).fire(v),qo(v,!0)}return e})}function Mo(e){var t=function(u){return e.next(u)},n=function(u){return e.throw(u)},o=c(t),a=c(n);function c(u){return function(d){var p=u(d),m=p.value;return p.done?m:!m||typeof m.then!="function"?Se(m)?Promise.all(m).then(o,a):o(m):m.then(o,a)}}return c(t)()}function vm(e,t,n){var o=arguments.length;if(o<2)throw new Z.InvalidArgument("Too few arguments");for(var a=new Array(o-1);--o;)a[o-1]=arguments[o];n=a.pop();var c=Hc(a);return[e,c,n]}function uu(e,t,n,o,a){return W.resolve().then(function(){var c=Q.transless||Q,u=e._createTransaction(t,n,e._dbSchema,o);u.explicit=!0;var d={trans:u,transless:c};if(o)u.idbtrans=o.idbtrans;else try{u.create(),u.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(v){return v.name===Bo.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return uu(e,t,n,null,a)})):Te(v)}var p=No(a);p&&Dn();var m,g=W.follow(function(){if(m=a.call(u,u),m)if(p){var v=Lt.bind(null,null);m.then(v,v)}else typeof m.next=="function"&&typeof m.throw=="function"&&(m=Mo(m))},d);return(m&&typeof m.then=="function"?W.resolve(m).then(function(v){return u.active?v:Te(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):g.then(function(){return m})).then(function(v){return o&&u._resolve(),u._completion.then(function(){return v})}).catch(function(v){return u._reject(v),Te(v)})})}function Gr(e,t,n){for(var o=Se(e)?e.slice():[e],a=0;a<n;++a)o.push(t);return o}function bm(e){return re(re({},e),{table:function(t){var n=e.table(t),o=n.schema,a={},c=[];function u(E,S,T){var C=rr(E),k=a[C]=a[C]||[],P=E==null?0:typeof E=="string"?1:E.length,A=S>0,U=re(re({},T),{name:A?"".concat(C,"(virtual-from:").concat(T.name,")"):T.name,lowLevelIndex:T,isVirtual:A,keyTail:S,keyLength:P,extractKey:Do(E),unique:!A&&T.unique});if(k.push(U),U.isPrimaryKey||c.push(U),P>1){var V=P===2?E[0]:E.slice(0,P-1);u(V,S+1,T)}return k.sort(function(j,B){return j.keyTail-B.keyTail}),U}var d=u(o.primaryKey.keyPath,0,o.primaryKey);a[":id"]=[d];for(var p=0,m=o.indexes;p<m.length;p++){var g=m[p];u(g.keyPath,0,g)}function v(E){var S=a[rr(E)];return S&&S[0]}function _(E,S){return{type:E.type===1?2:E.type,lower:Gr(E.lower,E.lowerOpen?e.MAX_KEY:e.MIN_KEY,S),lowerOpen:!0,upper:Gr(E.upper,E.upperOpen?e.MIN_KEY:e.MAX_KEY,S),upperOpen:!0}}function D(E){var S=E.query.index;return S.isVirtual?re(re({},E),{query:{index:S.lowLevelIndex,range:_(E.query.range,S.keyTail)}}):E}var w=re(re({},n),{schema:re(re({},o),{primaryKey:d,indexes:c,getIndexByKeyPath:v}),count:function(E){return n.count(D(E))},query:function(E){return n.query(D(E))},openCursor:function(E){var S=E.query.index,T=S.keyTail,C=S.isVirtual,k=S.keyLength;if(!C)return n.openCursor(E);function P(A){function U(j){j!=null?A.continue(Gr(j,E.reverse?e.MAX_KEY:e.MIN_KEY,T)):E.unique?A.continue(A.key.slice(0,k).concat(E.reverse?e.MIN_KEY:e.MAX_KEY,T)):A.continue()}var V=Object.create(A,{continue:{value:U},continuePrimaryKey:{value:function(j,B){A.continuePrimaryKey(Gr(j,e.MAX_KEY,T),B)}},primaryKey:{get:function(){return A.primaryKey}},key:{get:function(){var j=A.key;return k===1?j[0]:j.slice(0,k)}},value:{get:function(){return A.value}}});return V}return n.openCursor(D(E)).then(function(A){return A&&P(A)})}});return w}})}var wm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:bm};function Qo(e,t,n,o){return n=n||{},o=o||"",Pe(e).forEach(function(a){if(!Je(t,a))n[o+a]=void 0;else{var c=e[a],u=t[a];if(typeof c=="object"&&typeof u=="object"&&c&&u){var d=_o(c),p=_o(u);d!==p?n[o+a]=t[a]:d==="Object"?Qo(c,u,n,o+a+"."):c!==u&&(n[o+a]=t[a])}else c!==u&&(n[o+a]=t[a])}}),Pe(t).forEach(function(a){Je(e,a)||(n[o+a]=t[a])}),n}function Zo(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var _m={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return re(re({},e),{table:function(t){var n=e.table(t),o=n.schema.primaryKey,a=re(re({},n),{mutate:function(c){var u=Q.trans,d=u.table(t).hook,p=d.deleting,m=d.creating,g=d.updating;switch(c.type){case"add":if(m.fire===pe)break;return u._promise("readwrite",function(){return v(c)},!0);case"put":if(m.fire===pe&&g.fire===pe)break;return u._promise("readwrite",function(){return v(c)},!0);case"delete":if(p.fire===pe)break;return u._promise("readwrite",function(){return v(c)},!0);case"deleteRange":if(p.fire===pe)break;return u._promise("readwrite",function(){return _(c)},!0)}return n.mutate(c);function v(w){var E=Q.trans,S=w.keys||Zo(o,w);if(!S)throw new Error("Keys missing");return w=w.type==="add"||w.type==="put"?re(re({},w),{keys:S}):re({},w),w.type!=="delete"&&(w.values=ti([],w.values,!0)),w.keys&&(w.keys=ti([],w.keys,!0)),Sm(n,w,S).then(function(T){var C=S.map(function(k,P){var A=T[P],U={onerror:null,onsuccess:null};if(w.type==="delete")p.fire.call(U,k,A,E);else if(w.type==="add"||A===void 0){var V=m.fire.call(U,k,w.values[P],E);k==null&&V!=null&&(k=V,w.keys[P]=k,o.outbound||ze(w.values[P],o.keyPath,k))}else{var j=Qo(A,w.values[P]),B=g.fire.call(U,j,k,A,E);if(B){var H=w.values[P];Object.keys(B).forEach(function(F){Je(H,F)?H[F]=B[F]:ze(H,F,B[F])})}}return U});return n.mutate(w).then(function(k){for(var P=k.failures,A=k.results,U=k.numFailures,V=k.lastResult,j=0;j<S.length;++j){var B=A?A[j]:S[j],H=C[j];B==null?H.onerror&&H.onerror(P[j]):H.onsuccess&&H.onsuccess(w.type==="put"&&T[j]?w.values[j]:B)}return{failures:P,results:A,numFailures:U,lastResult:V}}).catch(function(k){return C.forEach(function(P){return P.onerror&&P.onerror(k)}),Promise.reject(k)})})}function _(w){return D(w.trans,w.range,1e4)}function D(w,E,S){return n.query({trans:w,values:!1,query:{index:o,range:E},limit:S}).then(function(T){var C=T.result;return v({type:"delete",keys:C,trans:w}).then(function(k){return k.numFailures>0?Promise.reject(k.failures[0]):C.length<S?{failures:[],numFailures:0,lastResult:void 0}:D(w,re(re({},E),{lower:C[C.length-1],lowerOpen:!0}),S)})})}}});return a}})}};function Sm(e,t,n){return t.type==="add"?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function lu(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var o=[],a=0,c=0;a<t.keys.length&&c<e.length;++a)ae(t.keys[a],e[c])===0&&(o.push(n?nn(t.values[a]):t.values[a]),++c);return o.length===e.length?o:null}catch{return null}}var Em={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return re(re({},n),{getMany:function(o){if(!o.cache)return n.getMany(o);var a=lu(o.keys,o.trans._cache,o.cache==="clone");return a?W.resolve(a):n.getMany(o).then(function(c){return o.trans._cache={keys:o.keys,values:o.cache==="clone"?nn(c):c},c})},mutate:function(o){return o.type!=="add"&&(o.trans._cache=null),n.mutate(o)}})}}}};function fu(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function du(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var Im={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new We(e.MIN_KEY,e.MAX_KEY);return re(re({},e),{transaction:function(o,a,c){if(Q.subscr&&a!=="readonly")throw new Z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Q.querier));return e.transaction(o,a,c)},table:function(o){var a=e.table(o),c=a.schema,u=c.primaryKey,d=c.indexes,p=u.extractKey,m=u.outbound,g=u.autoIncrement&&d.filter(function(w){return w.compound&&w.keyPath.includes(u.keyPath)}),v=re(re({},a),{mutate:function(w){var E,S,T=w.trans,C=w.mutatedParts||(w.mutatedParts={}),k=function(L){var z="idb://".concat(t,"/").concat(o,"/").concat(L);return C[z]||(C[z]=new We)},P=k(""),A=k(":dels"),U=w.type,V=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[Zo(u,w).filter(function(L){return L}),w.values]:[],j=V[0],B=V[1],H=w.trans._cache;if(Se(j)){P.addKeys(j);var F=U==="delete"||j.length===B.length?lu(j,H):null;F||A.addKeys(j),(F||B)&&xm(k,c,F,B)}else if(j){var N={from:(E=j.lower)!==null&&E!==void 0?E:e.MIN_KEY,to:(S=j.upper)!==null&&S!==void 0?S:e.MAX_KEY};A.add(N),P.add(N)}else P.add(n),A.add(n),c.indexes.forEach(function(L){return k(L.name).add(n)});return a.mutate(w).then(function(L){return j&&(w.type==="add"||w.type==="put")&&(P.addKeys(L.results),g&&g.forEach(function(z){for(var $=w.values.map(function(ue){return z.extractKey(ue)}),X=z.keyPath.findIndex(function(ue){return ue===u.keyPath}),te=0,ne=L.results.length;te<ne;++te)$[te][X]=L.results[te];k(z.name).addKeys($)})),T.mutatedParts=yi(T.mutatedParts||{},C),L})}}),_=function(w){var E,S,T=w.query,C=T.index,k=T.range;return[C,new We((E=k.lower)!==null&&E!==void 0?E:e.MIN_KEY,(S=k.upper)!==null&&S!==void 0?S:e.MAX_KEY)]},D={get:function(w){return[u,new We(w.key)]},getMany:function(w){return[u,new We().addKeys(w.keys)]},count:_,query:_,openCursor:_};return Pe(D).forEach(function(w){v[w]=function(E){var S=Q.subscr,T=!!S,C=fu(Q,a)&&du(w,E),k=C?E.obsSet={}:S;if(T){var P=function(F){var N="idb://".concat(t,"/").concat(o,"/").concat(F);return k[N]||(k[N]=new We)},A=P(""),U=P(":dels"),V=D[w](E),j=V[0],B=V[1];if(w==="query"&&j.isPrimaryKey&&!E.values?U.add(B):P(j.name||"").add(B),!j.isPrimaryKey)if(w==="count")U.add(n);else{var H=w==="query"&&m&&E.values&&a.query(re(re({},E),{values:!1}));return a[w].apply(this,arguments).then(function(F){if(w==="query"){if(m&&E.values)return H.then(function($){var X=$.result;return A.addKeys(X),F});var N=E.values?F.result.map(p):F.result;E.values?A.addKeys(N):U.addKeys(N)}else if(w==="openCursor"){var L=F,z=E.values;return L&&Object.create(L,{key:{get:function(){return U.addKey(L.primaryKey),L.key}},primaryKey:{get:function(){var $=L.primaryKey;return U.addKey($),$}},value:{get:function(){return z&&A.addKey(L.primaryKey),L.value}}})}return F})}}return a[w].apply(this,arguments)}}),v}})}};function xm(e,t,n,o){function a(c){var u=e(c.name||"");function d(m){return m!=null?c.extractKey(m):null}var p=function(m){return c.multiEntry&&Se(m)?m.forEach(function(g){return u.addKey(g)}):u.addKey(m)};(n||o).forEach(function(m,g){var v=n&&d(n[g]),_=o&&d(o[g]);ae(v,_)!==0&&(v!=null&&p(v),_!=null&&p(_))})}t.indexes.forEach(a)}function Fc(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var o=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(n.numFailures===o)return null;var a=re({},t);return Se(a.keys)&&(a.keys=a.keys.filter(function(c,u){return!(u in n.failures)})),"values"in a&&Se(a.values)&&(a.values=a.values.filter(function(c,u){return!(u in n.failures)})),a}function Tm(e,t){return t.lower===void 0?!0:t.lowerOpen?ae(e,t.lower)>0:ae(e,t.lower)>=0}function km(e,t){return t.upper===void 0?!0:t.upperOpen?ae(e,t.upper)<0:ae(e,t.upper)<=0}function vo(e,t){return Tm(e,t)&&km(e,t)}function Nc(e,t,n,o,a,c){if(!n||n.length===0)return e;var u=t.query.index,d=u.multiEntry,p=t.query.range,m=o.schema.primaryKey,g=m.extractKey,v=u.extractKey,_=(u.lowLevelIndex||u).extractKey,D=n.reduce(function(w,E){var S=w,T=[];if(E.type==="add"||E.type==="put")for(var C=new We,k=E.values.length-1;k>=0;--k){var P=E.values[k],A=g(P);if(!C.hasKey(A)){var U=v(P);(d&&Se(U)?U.some(function(F){return vo(F,p)}):vo(U,p))&&(C.addKey(A),T.push(P))}}switch(E.type){case"add":{var V=new We().addKeys(t.values?w.map(function(F){return g(F)}):w);S=w.concat(t.values?T.filter(function(F){var N=g(F);return V.hasKey(N)?!1:(V.addKey(N),!0)}):T.map(function(F){return g(F)}).filter(function(F){return V.hasKey(F)?!1:(V.addKey(F),!0)}));break}case"put":{var j=new We().addKeys(E.values.map(function(F){return g(F)}));S=w.filter(function(F){return!j.hasKey(t.values?g(F):F)}).concat(t.values?T:T.map(function(F){return g(F)}));break}case"delete":var B=new We().addKeys(E.keys);S=w.filter(function(F){return!B.hasKey(t.values?g(F):F)});break;case"deleteRange":var H=E.range;S=w.filter(function(F){return!vo(g(F),H)});break}return S},e);return D===e?e:(D.sort(function(w,E){return ae(_(w),_(E))||ae(g(w),g(E))}),t.limit&&t.limit<1/0&&(D.length>t.limit?D.length=t.limit:e.length===t.limit&&D.length<t.limit&&(a.dirty=!0)),c?Object.freeze(D):D)}function Lc(e,t){return ae(e.lower,t.lower)===0&&ae(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Cm(e,t,n,o){if(e===void 0)return t!==void 0?-1:0;if(t===void 0)return 1;var a=ae(e,t);if(a===0){if(n&&o)return 0;if(n)return 1;if(o)return-1}return a}function Am(e,t,n,o){if(e===void 0)return t!==void 0?1:0;if(t===void 0)return-1;var a=ae(e,t);if(a===0){if(n&&o)return 0;if(n)return-1;if(o)return 1}return a}function Pm(e,t){return Cm(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&Am(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Dm(e,t,n,o){var a=tn["idb://".concat(e,"/").concat(t)];if(!a)return[];var c=a.queries[n];if(!c)return[null,!1,a,null];var u=o.query?o.query.index.name:null,d=c[u||""];if(!d)return[null,!1,a,null];switch(n){case"query":var p=d.find(function(v){return v.req.limit===o.limit&&v.req.values===o.values&&Lc(v.req.query.range,o.query.range)});if(p)return[p,!0,a,d];var m=d.find(function(v){var _="limit"in v.req?v.req.limit:1/0;return _>=o.limit&&(o.values?v.req.values:!0)&&Pm(v.req.query.range,o.query.range)});return[m,!1,a,d];case"count":var g=d.find(function(v){return Lc(v.req.query.range,o.query.range)});return[g,!!g,a,d]}}function Om(e,t,n,o){e.subscribers.add(n),o.addEventListener("abort",function(){e.subscribers.delete(n),e.subscribers.size===0&&Rm(e,t)})}function Rm(e,t){setTimeout(function(){e.subscribers.size===0&&Yt(t,e)},3e3)}var Mm={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name,n=re(re({},e),{transaction:function(o,a,c){var u=e.transaction(o,a,c);if(a==="readwrite"){var d=new AbortController,p=d.signal,m=function(g){return function(){if(d.abort(),a==="readwrite"){for(var v=new Set,_=0,D=o;_<D.length;_++){var w=D[_],E=tn["idb://".concat(t,"/").concat(w)];if(E){var S=e.table(w),T=E.optimisticOps.filter(function(z){return z.trans===u});if(u._explicit&&g&&u.mutatedParts)for(var C=0,k=Object.values(E.queries.query);C<k.length;C++)for(var P=k[C],A=0,U=P.slice();A<U.length;A++){var V=U[A];Xo(V.obsSet,u.mutatedParts)&&(Yt(P,V),V.subscribers.forEach(function(z){return v.add(z)}))}else if(T.length>0){E.optimisticOps=E.optimisticOps.filter(function(z){return z.trans!==u});for(var j=0,B=Object.values(E.queries.query);j<B.length;j++)for(var P=B[j],H=0,F=P.slice();H<F.length;H++){var V=F[H];if(V.res!=null&&u.mutatedParts)if(g&&!V.dirty){var N=Object.isFrozen(V.res),L=Nc(V.res,V.req,T,S,V,N);V.dirty?(Yt(P,V),V.subscribers.forEach(function(X){return v.add(X)})):L!==V.res&&(V.res=L,V.promise=W.resolve({result:L}))}else V.dirty&&Yt(P,V),V.subscribers.forEach(function(X){return v.add(X)})}}}}v.forEach(function(z){return z()})}}};u.addEventListener("abort",m(!1),{signal:p}),u.addEventListener("error",m(!1),{signal:p}),u.addEventListener("complete",m(!0),{signal:p})}return u},table:function(o){var a=e.table(o),c=a.schema.primaryKey,u=re(re({},a),{mutate:function(d){var p=Q.trans;if(c.outbound||p.db._options.cache==="disabled"||p.explicit||p.idbtrans.mode!=="readwrite")return a.mutate(d);var m=tn["idb://".concat(t,"/").concat(o)];if(!m)return a.mutate(d);var g=a.mutate(d);return(d.type==="add"||d.type==="put")&&(d.values.length>=50||Zo(c,d).some(function(v){return v==null}))?g.then(function(v){var _=re(re({},d),{values:d.values.map(function(w,E){var S;if(v.failures[E])return w;var T=!((S=c.keyPath)===null||S===void 0)&&S.includes(".")?nn(w):re({},w);return ze(T,c.keyPath,v.results[E]),T})}),D=Fc(m,_,v);m.optimisticOps.push(D),queueMicrotask(function(){return d.mutatedParts&&Wr(d.mutatedParts)})}):(m.optimisticOps.push(d),d.mutatedParts&&Wr(d.mutatedParts),g.then(function(v){if(v.numFailures>0){Yt(m.optimisticOps,d);var _=Fc(m,d,v);_&&m.optimisticOps.push(_),d.mutatedParts&&Wr(d.mutatedParts)}}),g.catch(function(){Yt(m.optimisticOps,d),d.mutatedParts&&Wr(d.mutatedParts)})),g},query:function(d){var p;if(!fu(Q,a)||!du("query",d))return a.query(d);var m=((p=Q.trans)===null||p===void 0?void 0:p.db._options.cache)==="immutable",g=Q,v=g.requery,_=g.signal,D=Dm(t,o,"query",d),w=D[0],E=D[1],S=D[2],T=D[3];if(w&&E)w.obsSet=d.obsSet;else{var C=a.query(d).then(function(k){var P=k.result;if(w&&(w.res=P),m){for(var A=0,U=P.length;A<U;++A)Object.freeze(P[A]);Object.freeze(P)}else k.result=nn(P);return k}).catch(function(k){return T&&w&&Yt(T,w),Promise.reject(k)});w={obsSet:d.obsSet,promise:C,subscribers:new Set,type:"query",req:d,dirty:!1},T?T.push(w):(T=[w],S||(S=tn["idb://".concat(t,"/").concat(o)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),S.queries.query[d.query.index.name||""]=T)}return Om(w,T,v,_),w.promise.then(function(k){return{result:Nc(k.result,d,S?.optimisticOps,a,w,m)}})}});return u}});return n}};function zr(e,t){return new Proxy(e,{get:function(n,o,a){return o==="db"?t:Reflect.get(n,o,a)}})}var Ut=(function(){function e(t,n){var o=this;this._middlewares={},this.verno=0;var a=e.dependencies;this._options=n=re({addons:e.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var c=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:pe,dbReadyPromise:null,cancelOpen:pe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};u.dbReadyPromise=new W(function(p){u.dbReadyResolve=p}),u.openCanceller=new W(function(p,m){u.cancelOpen=m}),this._state=u,this.name=t,this.on=lr(this,"populate","blocked","versionchange","close",{ready:[$o,pe]}),this.once=function(p,m){var g=function(){for(var v=[],_=0;_<arguments.length;_++)v[_]=arguments[_];o.on(p).unsubscribe(g),m.apply(o,v)};return o.on(p,g)},this.on.ready.subscribe=Uc(this.on.ready.subscribe,function(p){return function(m,g){e.vip(function(){var v=o._state;if(v.openComplete)v.dbOpenError||W.resolve().then(m),g&&p(m);else if(v.onReadyBeingFired)v.onReadyBeingFired.push(m),g&&p(m);else{p(m);var _=o;g||p(function D(){_.on.ready.unsubscribe(m),_.on.ready.unsubscribe(D)})}})}}),this.Collection=Kh(this),this.Table=Bh(this),this.Transaction=Yh(this),this.Version=fm(this),this.WhereClause=zh(this),this.on("versionchange",function(p){p.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(o.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(o.name,"'. Closing db now to resume the delete request.")),o.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(o.name,"') was blocked")):console.warn("Upgrade '".concat(o.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=sr(n.IDBKeyRange),this._createTransaction=function(p,m,g,v){return new o.Transaction(p,m,g,o._options.chromeTransactionDurability,v)},this._fireOnBlocked=function(p){o.on("blocked").fire(p),In.filter(function(m){return m.name===o.name&&m!==o&&!m._state.vcFired}).map(function(m){return m.on("versionchange").fire(p)})},this.use(Em),this.use(Mm),this.use(Im),this.use(wm),this.use(_m);var d=new Proxy(this,{get:function(p,m,g){if(m==="_vip")return!0;if(m==="table")return function(_){return zr(o.table(_),d)};var v=Reflect.get(p,m,g);return v instanceof ru?zr(v,d):m==="tables"?v.map(function(_){return zr(_,d)}):m==="_createTransaction"?function(){var _=v.apply(this,arguments);return zr(_,d)}:v}});this.vip=d,c.forEach(function(p){return p(o)})}return e.prototype.version=function(t){if(isNaN(t)||t<.1)throw new Z.Type("Given version is not a positive number");if(t=Math.round(t*10)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=this._versions,o=n.filter(function(a){return a._cfg.version===t})[0];return o||(o=new this.Version(t),n.push(o),n.sort(nm),o.stores({}),this._state.autoSchema=!1,o)},e.prototype._whenReady=function(t){var n=this;return this.idbdb&&(this._state.openComplete||Q.letThrough||this._vip)?t():new W(function(o,a){if(n._state.openComplete)return a(new Z.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen){a(new Z.DatabaseClosed);return}n.open().catch(pe)}n._state.dbReadyPromise.then(o,a)}).then(t)},e.prototype.use=function(t){var n=t.stack,o=t.create,a=t.level,c=t.name;c&&this.unuse({stack:n,name:c});var u=this._middlewares[n]||(this._middlewares[n]=[]);return u.push({stack:n,create:o,level:a??10,name:c}),u.sort(function(d,p){return d.level-p.level}),this},e.prototype.unuse=function(t){var n=t.stack,o=t.name,a=t.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(c){return a?c.create!==a:o?c.name!==o:!1})),this},e.prototype.open=function(){var t=this;return on(Mt,function(){return ym(t)})},e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,n=In.indexOf(this);if(n>=0&&In.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new W(function(o){t.dbReadyResolve=o}),t.openCanceller=new W(function(o,a){t.cancelOpen=a}))},e.prototype.close=function(t){var n=t===void 0?{disableAutoOpen:!0}:t,o=n.disableAutoOpen,a=this._state;o?(a.isBeingOpened&&a.cancelOpen(new Z.DatabaseClosed),this._close(),a.autoOpen=!1,a.dbOpenError=new Z.DatabaseClosed):(this._close(),a.autoOpen=this._options.autoOpen||a.isBeingOpened,a.openComplete=!1,a.dbOpenError=null)},e.prototype.delete=function(t){var n=this;t===void 0&&(t={disableAutoOpen:!0});var o=arguments.length>0&&typeof arguments[0]!="object",a=this._state;return new W(function(c,u){var d=function(){n.close(t);var p=n._deps.indexedDB.deleteDatabase(n.name);p.onsuccess=we(function(){hm(n._deps,n.name),c()}),p.onerror=dt(u),p.onblocked=n._fireOnBlocked};if(o)throw new Z.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(d):d()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var t=this;return Pe(this._allTables).map(function(n){return t._allTables[n]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var t=vm.apply(this,arguments);return this._transaction.apply(this,t)},e.prototype._transaction=function(t,n,o){var a=this,c=Q.trans;(!c||c.db!==this||t.indexOf("!")!==-1)&&(c=null);var u=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");var d,p;try{if(p=n.map(function(g){var v=g instanceof a.Table?g.name:g;if(typeof v!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return v}),t=="r"||t===lo)d=lo;else if(t=="rw"||t==fo)d=fo;else throw new Z.InvalidArgument("Invalid transaction mode: "+t);if(c){if(c.mode===lo&&d===fo)if(u)c=null;else throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");c&&p.forEach(function(g){if(c&&c.storeNames.indexOf(g)===-1)if(u)c=null;else throw new Z.SubTransaction("Table "+g+" not included in parent transaction.")}),u&&c&&!c.active&&(c=null)}}catch(g){return c?c._promise(null,function(v,_){_(g)}):Te(g)}var m=uu.bind(null,this,d,p,c,o);return c?c._promise(d,m,"lock"):Q.trans?on(Q.transless,function(){return a._whenReady(m)}):this._whenReady(m)},e.prototype.table=function(t){if(!Je(this._allTables,t))throw new Z.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},e})(),Fm=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Nm=(function(){function e(t){this._subscribe=t}return e.prototype.subscribe=function(t,n,o){return this._subscribe(!t||typeof t=="function"?{next:t,error:n,complete:o}:t)},e.prototype[Fm]=function(){return this},e})(),di;try{di={indexedDB:Be.indexedDB||Be.mozIndexedDB||Be.webkitIndexedDB||Be.msIndexedDB,IDBKeyRange:Be.IDBKeyRange||Be.webkitIDBKeyRange}}catch{di={indexedDB:null,IDBKeyRange:null}}function Lm(e){var t=!1,n,o=new Nm(function(a){var c=No(e);function u(T){var C=An();try{c&&Dn();var k=Nt(e,T);return c&&(k=k.finally(Lt)),k}finally{C&&Pn()}}var d=!1,p,m={},g={},v={get closed(){return d},unsubscribe:function(){d||(d=!0,p&&p.abort(),_&&$t.storagemutated.unsubscribe(E))}};a.start&&a.start(v);var _=!1,D=function(){return uo(S)};function w(){return Xo(g,m)}var E=function(T){yi(m,T),w()&&D()},S=function(){if(!(d||!di.indexedDB)){m={};var T={};p&&p.abort(),p=new AbortController;var C={subscr:T,signal:p.signal,requery:D,querier:e,trans:null},k=u(C);Promise.resolve(k).then(function(P){t=!0,n=P,!(d||C.signal.aborted)&&(m={},g=T,!lh(g)&&!_&&($t(dr,E),_=!0),uo(function(){return!d&&a.next&&a.next(P)}))},function(P){t=!1,["DatabaseClosedError","AbortError"].includes(P?.name)||d||uo(function(){d||a.error&&a.error(P)})})}};return setTimeout(D,0),v});return o.hasValue=function(){return t},o.getValue=function(){return n},o}var qt=Ut;Tn(qt,re(re({},hi),{delete:function(e){var t=new qt(e,{addons:[]});return t.delete()},exists:function(e){return new qt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return dm(qt.dependencies).then(e)}catch{return Te(new Z.MissingAPI)}},defineClass:function(){function e(t){Qe(this,t)}return e},ignoreTransaction:function(e){return Q.trans?on(Q.transless,e):e()},vip:Ro,async:function(e){return function(){try{var t=Mo(e.apply(this,arguments));return!t||typeof t.then!="function"?W.resolve(t):t}catch(n){return Te(n)}}},spawn:function(e,t,n){try{var o=Mo(e.apply(n,t||[]));return!o||typeof o.then!="function"?W.resolve(o):o}catch(a){return Te(a)}},currentTransaction:{get:function(){return Q.trans||null}},waitFor:function(e,t){var n=W.resolve(typeof e=="function"?qt.ignoreTransaction(e):e).timeout(t||6e4);return Q.trans?Q.trans.waitFor(n):n},Promise:W,debug:{get:function(){return pt},set:function(e){Jc(e)}},derive:kn,extend:Qe,props:Tn,override:Uc,Events:lr,on:$t,liveQuery:Lm,extendObservabilitySet:yi,getByKeyPath:Et,setByKeyPath:ze,delByKeyPath:sh,shallowClone:jc,deepClone:nn,getObjectDiff:Qo,cmp:ae,asap:Kc,minKey:Co,addons:[],connections:In,errnames:Bo,dependencies:di,cache:tn,semVer:xc,version:xc.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,n*2)})}));qt.maxKey=sr(qt.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($t(dr,function(e){if(!Rt){var t;t=new CustomEvent(Ao,{detail:e}),Rt=!0,dispatchEvent(t),Rt=!1}}),addEventListener(Ao,function(e){var t=e.detail;Rt||ea(t)}));function ea(e){var t=Rt;try{Rt=!0,$t.storagemutated.fire(e),qo(e,!0)}finally{Rt=t}}var Rt=!1,Ot,Fo=function(){};typeof BroadcastChannel<"u"&&(Fo=function(){Ot=new BroadcastChannel(Ao),Ot.onmessage=function(e){return e.data&&ea(e.data)}},Fo(),typeof Ot.unref=="function"&&Ot.unref(),$t(dr,function(e){Rt||Ot.postMessage(e)}));typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ut.disableBfCache&&e.persisted){pt&&console.debug("Dexie: handling persisted pagehide"),Ot?.close();for(var t=0,n=In;t<n.length;t++){var o=n[t];o.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(e){!Ut.disableBfCache&&e.persisted&&(pt&&console.debug("Dexie: handling persisted pageshow"),Fo(),ea({all:new We(-1/0,[[]])}))}));W.rejectionMapper=gh;Jc(pt);var ta=class{getDB(){let t=new Ut("FireShotDB");return t.version(1).stores({captures:`
              ++id,
              time,
              url,
              title`,tiles:"++id, parentId"}),t}async createNewEntry(){return await this.getDB().captures.add({time:0})}async addTile(t,n){await this.getDB().tiles.add({parentId:t,blob:n})}async commitEntry(t,n,o,a,c){await this.getDB().captures.update(t,{time:n,url:o,title:a,metadata:c})}async cleanup(){Ve()("DB cleanup...");let n=await this.getDB().captures.where("time").equals(0).primaryKeys();await this.deleteCaptures(n)}async deleteCaptures(t){let n=this.getDB();await n.tiles.where("parentId").anyOf(t).delete(),await n.captures.bulkDelete(t)}async deleteOlderThanGivenDays(t){Ve()("Performing database cleanup...");let n=this.getDB(),o=new Date;o.setDate(o.getDate()-t);let a=await n.captures.where("time").below(o).primaryKeys();a.length>0?(console.log(`Removing ${a.length} items`),await this.deleteCaptures(a)):Ve()("Nothing to do.")}async getCapture(t){try{let n=this.getDB();return{...await n.captures.get(t),tiles:(await n.tiles.where("parentId").equals(t).sortBy("id")).map(o=>o.blob)}}catch(n){return console.error(n),null}}async getAllCaptures(){return await this.getDB().captures.toArray()}},sn=new ta;var pu="image/png",vi=class{#i=0;#e=0;#s=Number.MAX_SAFE_INTEGER;#y=Number.MAX_SAFE_INTEGER;#v=0;#p=0;#h;#u=0;#m=0;#b=0;#l=-1;#n=0;#r=0;#d=[];#t=null;#a=null;#f=null;#o;#c=null;#g=0;dbError=!1;constructor(){}async z(){await dn(async()=>{await sn.cleanup()})()}#E(){this.#t=new OffscreenCanvas(this.#n,y.ue),this.#t.aTag=1,this.#a=new OffscreenCanvas(this.#n,y.ue),this.#a.aTag=2,this.#f=this.#t.getContext("2d",{alpha:!1,willReadFrequently:!1}),this.#f.aTag=1,this.#c=this.#a.getContext("2d",{alpha:!1,willReadFrequently:!1}),this.#c.aTag=2}async#w(t){await dn(async()=>{this.#l<0&&(this.#l=await sn.createNewEntry()),this.#m+=t.size,Ie()&&(t=await t.arrayBuffer()),await sn.addTile(this.#l,t),++this.#b},()=>this.dbError=!0)()}async#_(){lt("swapActiveContext"),this.#g=0,this.#o+=this.#t.height,await this.#w(await this.#t.convertToBlob({type:pu})),[this.#t,this.#a]=[this.#a,this.#t],[this.#f,this.#c]=[this.#c,this.#f],ft("swapActiveContext")}async#I(t){let n=t.x,o=t.y,a=this.#p===t.y||this.#u===0,c=t.metrics.div,u=t.metrics.left,d=t.metrics.top,p=t.metrics.crop,m=t.metrics.cropLeft||0,g=t.metrics.cropTop||0,v=t.metrics.cropRight||0,_=t.metrics.cropBottom||0,D=t.metrics.stickyHdrHeight,{w,h:E}=Ur(t.dataurl),[S,T]=c?[t.metrics.cw,t.metrics.ch]:[w,E];this.#u===0&&(this.#v=t.x,this.#p=t.y),this.#u=this.#u+1,this.#y=Math.min(this.#y,t.y),this.#e=Math.max(this.#e,t.y),this.#n===0&&(this.#n=this.#i+S-this.#s-(p?m:0),p&&(this.#n=Math.min(this.#n,v-m)),this.#E(),this.#o=0);let C=a?0:D,k=n-this.#v-m,P=o-this.#p-g+C,A=c?T-C:T-C-d,U=P+A;this.#r=Math.max(this.#r,U),p&&(this.#r=Math.min(this.#r,Math.floor(_-g))),lt("fetch dataurl");let V=await fetch(t.dataurl);if(!V.ok)throw new Error("failed to preload image chunk");ft("fetch dataurl"),lt("createImageBitmap");let j=await createImageBitmap(await V.blob());ft("createImageBitmap"),P-this.#o>=this.#t.height&&await this.#_();let B=Math.max(S,w)-u,H=Math.max(T,E)-(d+C);this.#f.drawImage(j,u,d+C,B,H,k,P-this.#o,B,H),this.#r-this.#o>=this.#t.height&&(this.#g=this.#r-this.#o-this.#t.height,this.#c.drawImage(j,u,d+C,B,H,k,P-this.#o-this.#t.height,B,H))}async#x(t){lt("commitDBRecord");let n=q(y.v,2)-1;await dn(async()=>{let o={calculatedHeight:Math.floor(this.#r),calculatedWidth:this.#n,blobsSize:this.#m,totalTiles:this.#b,pageUrl:t.url,...t.savedCapParamsForDebugging};await sn.commitEntry(this.#l,new Date(t.created),t.url,t.title,{n,size:this.#m,width:this.#n,height:Math.floor(this.#r),cbb:t.canBeBetter,debug:o,links:t.links,words:t.words})},()=>this.dbError=!0)(),ft("commitDBRecord")}async#S(){this.#n===0&&this.#d.forEach(t=>{this.#s=Math.min(this.#s,t.x),this.#i=Math.max(this.#i,t.x)});for(let t of this.#d)await this.#I(t);this.#d.length=0}async Ae(t){this.#d.push(t),typeof this.#h>"u"&&(this.#h=t.y),this.#h!==t.y&&await this.#S()}async wt(t){return lt("Finalize"),this.#u===0&&await this.#S(),this.#g>0&&await this.#_(),this.#a.height=this.#r-this.#o,this.#c.drawImage(this.#t,0,0,this.#n,this.#r-this.#o,0,0,this.#n,this.#r-this.#o),await this.#w(await this.#a.convertToBlob({type:pu})),this.#t.width=1,this.#t.height=1,this.#a.width=1,this.#a.height=1,await this.#x(t),O("tiles created")(),ft("Finalize"),this.#l}};function Bm(){let e=null,t=null,n=null;function o(){G(y.p,!0),G(y.t,!0)}async function a(){t=new vi,await t.z(),n=null}async function c(d){n?n=n.then(()=>t.Ae(d)):n=t.Ae(d)}async function u(d){try{if(d.rows===0)return;await n;let p=await t.wt(d);if(t.dbError){hu(!0);return}t=null,n=null,ie&&lt("captureDone");let m=[y.E,y.I].indexOf(d.action)!==-1,g;if(m){let _=btoa(JSON.stringify({action:d.action,folder:d.overrideFolder||"",context:d.contextId}));g={url:`fsCaptured.html?id=${p}&params=${_}`,active:!0}}else g={url:`fsCaptured.html?id=${p}`,windowId:d.tab.windowId,index:d.tab.incognito?void 0:d.tab.index+1,openerTabId:d.tab.incognito?void 0:d.tab.id},q(y.Ve)!=="true"&&(delete g.index,Le()&&delete g.openerTabId);if(Le()&&d.tab.incognito&&!d.justStore){let _=(await browser.windows.getAll({windowTypes:["normal"]})).filter(w=>!w.incognito),D;if(_.length>0)D=_[0],await browser.windows.update(D.id,{focused:!0});else{D=await browser.windows.create({incognito:!1,focused:!0,allowScriptsToClose:!0});let w=await browser.tabs.query({windowId:D.id});if(w?.length>0){let E=w[0];setTimeout(()=>browser.tabs.remove(E.id),1e3)}}g.windowId=D.id}let v=_=>new Promise(D=>{chrome.tabs.create(_,w=>{chrome.runtime.lastError?(delete _.index,delete _.openerTabId,chrome.tabs.create(_,D)):D(w)})});d.justStore||await v(g),ie&&ft("captureDone")}finally{e({topic:"processingFinished"})}}return{init:function(d){e=d},launchJSON:function(d){switch(d.JSONCommand){case"captureInit":return a();case"captureTabPNG":c(d);break;case"captureDone":return u(d);case"activateFireShot":o();break}}}}var xe=new Bm;function na(){return Pt()?ot:xe}function ee(e,t,n){if(typeof ot>"u"){console.error("This method should be called only from the Service worker.");return}let o;typeof e=="object"?(o=e,e=t,t=n):o=na();try{let a=t||{},c=e;if(a.JSONCommand=c,ie)if(a.dataurl){let u=a.dataurl;a.dataurl="<cut>",O("plugin command: "+c+" : "+JSON.stringify(a))(),a.dataurl=u}else O("plugin command: "+c+" : "+JSON.stringify(a).substring(0,2e3))();return o.launchJSON(a)}catch(a){return Jt(a.message),!1}}function mu(){ee("openSettings")}function hu(e){chrome.tabs.create({url:`fsHistory.html${e?"?cleanup=1":""}`})}function gu(){ee("resumeEditing")}function yu(){ee("ieCaptureOptions")}function ra(){gn("UA-1025658-9","fireshot.com","DoTrial"),ee("upgradeToProTrial")}function vu(){Xn("fsEnterLicense.html")}function bu(){ee("openFile")}function wu(){ee("openFromClipboard")}function _u(){ee("showLicensingInfo")}function Su(){ee("showAboutWindow")}function Eu(){$r(),ee("deactivateFireShot")}function Iu(){At()?(Le()?chrome.windows:chrome.tabs).create({url:"fsNativeInstall.html"}):$m()}function $m(){new Date>new Date(2026,1,15)?alert("This beta preview period has ended. Please visit the purchase page to get the full version of FireShot Pro."):(G(y.t,"true"),ie||Um())}function Um(){Xn("https://getfireshot.com/beta-pro.php?browser="+ut())}function bc(){wc({topic:"highlightLastCreatedFile"})}var xu=function(e){var n,o,a,c=!1,u={timeout:10,delay:0};function d(S){return new Promise(T=>{chrome.tabs.create(S,T)})}function p(S,T){try{S&&S.postMessage(T)}catch{}}function m(S,T){return new Promise((C,k)=>{chrome.tabs.update(S,{},P=>{chrome.runtime.lastError?k({message:chrome.runtime.lastError.message,abort:!0}):P?chrome.scripting.executeScript(T).then(C).catch(A=>k({message:A,abort:!1})):k({message:"Error: the tab does not exist",abort:!0})})})}function g(S){return new Promise(T=>{Ie()?chrome.tabs.update(S.id,{active:!0,highlighted:!0},T):chrome.tabs.highlight({windowId:S.windowId,tabs:S.index},T)})}async function v(S,T){let C;try{let k=await Promise.race([new Promise(P=>{C=setInterval(()=>{be().contains(y.f)?chrome.tabs.update(S,{},A=>{(chrome.runtime.lastError||!A)&&(Ve()("Closed main tab detected"),P("error_closed"))}):(Ve()("Abort detected"),P("error_aborted"))},200)}),T]);return clearInterval(C),k}catch(k){return console.error(k.message),clearInterval(C),"error_aborted"}}function _(S,T){return v(S,new Promise(C=>{let k=!1;chrome.tabs.update(S,{url:T},P=>{P||C(!1);let A=(V,j)=>{if(S===V)switch(j.status){case"complete":Ve()(`${T} loaded.`),clearTimeout(U),chrome.tabs.onUpdated.removeListener(A),C(!0);break;case"loading":k=!0;break}};var U=setTimeout(()=>{Ve()(`${T} timed out.`),chrome.tabs.onUpdated.removeListener(A),C(k)},u.timeout*1e3);chrome.tabs.onUpdated.addListener(A)})}))}function D(S,T,C,k,P,A){return new Promise(U=>{e.executeGrabber(T,C,{JSPlugin:!0,overrideSpeed:k,overrideFolder:P,tabId:S,contextId:A},()=>{U()},!0)})}function w(S,T,C){return new Promise((k,P)=>{if(!C){k();return}T&&(p(T,{topic:"delay-info",secsLeft:C}),p(T,{topic:"set-visible",visible:!0}));let A=setInterval(()=>{--C,m(S,{args:[C],target:{tabId:S},injectImmediately:!0,func:U=>{window.fsTitle||(window.fsTitle=document.title),document.title=(U>0?"["+U+"] ":"")+window.fsTitle}}).then(()=>{C<=0||o||a?(clearInterval(A),p(T,{topic:"set-visible",visible:!1}),setTimeout(k,Ie()?100:0)):p(T,{topic:"delay-info",secsLeft:C})}).catch(U=>{clearInterval(A),P(U)})},1e3)})}function E(S){return new Promise((T,C)=>{chrome.scripting.insertCSS({target:{tabId:S},files:["css/fsautomationbanner.css"]}).catch(k=>C({message:k,abort:!1})),m(S,{target:{tabId:S},injectImmediately:!0,files:["scripts/page/fsAutomationBanner.js"]}).then(()=>{let k=chrome.tabs.connect(S,{name:"fsAutomationPort"});k.onMessage.addListener(A=>{switch(Ve()(A),A.topic){case"abort":o=!0,c&&e.stopCapturing(!0);break;case"next":a=!0,c&&e.stopCapturing();break}});let P={};for(let A=1;A<=6;++A){let U=`automation_banner_locale_string_${A}`;P[U]=chrome.i18n.getMessage(U)}p(k,{topic:"set-locale-strings",localeStrings:P}),T(k)}).catch(k=>C(k))})}return{grabPages:async function(S,T,C,k){ie&&lt("automation"),k&&(u=k),n=await d({url:"about:blank"});for(let P=0;P<S.length&&!o&&be().contains(y.f);++P){let A=S[P],U,V=await _(n.id,A);if(V==="error_closed"||V==="error_aborted")break;if(!V)continue;await g(n),a=!1,c=!1;try{U=await E(n.id),await w(n.id,U,u.delay)}catch(j){if(console.log("ERROR: "+j.message),U=null,j.abort){o=!0;break}}!o&&!a&&(p(U,{topic:"set-progress",progress:P+1,total:S.length}),c=!0,await D(n.id,T,C,k.speed,k.subfolder,k.callbackContextId)),U&&U.disconnect()}return chrome.tabs.remove(n.id,()=>{chrome.runtime.lastError}),ie&&ft("automation"),Ve()("grabPages completed."),!o}}};var ia=class{getDB(){let t=new Ut("FireShotDebug");return t.version(1).stores({replay:`
              ++id`}),t}async clear(){await this.getDB().replay.clear()}async saveCommand(t,n){await this.getDB().replay.add({command:t,data:n})}async getReplay(){return await this.getDB().replay.filter(()=>!0).toArray()}},On=new ia;function oa(){let e=null,t=null,n=null,o,a,c,u=new Map,d=null,p=0,m=null,g,v,_,D;function w(B){return B.JSPlugin||!it()?xe:na()}function E(B){return new Promise(H=>{let F,N=0,L=500;if(B){H();return}let z=()=>{chrome.runtime.onMessage.removeListener(F),$&&(clearTimeout($),$=null,H())};chrome.runtime.onMessage.addListener(F=(X,te)=>{switch(X.message){case"frameInfo":{if(!N)return;X.data.frameId=te.frameId,O(te.frameId+"  ",X.data)(),u.set(te.frameId,X.data),u.size>=N&&(N=0,z());break}}});let $=setTimeout(()=>{O("frame collector timeout")(),z()},L);chrome.scripting.executeScript({target:{allFrames:!0,tabId:e.id},injectImmediately:!0,files:["scripts/page/fsFrames.js"]}).then(X=>(Le()?N=X&&X.length>0?X[0].length:0:{length:N=0}=X||0,chrome.scripting.executeScript({target:{tabId:e.id},injectImmediately:!0,func:()=>window.postMessage({message:"rInfo",exts:{x:0,y:0,clientLeft:0,clientTop:0},fullyVisible:!0,level:0},"*")}).catch(te=>{throw te}))).catch(X=>{O(`chrome.scripting error: ${X}`)(),z()})})}function S(){G(y.v,parseInt(q(y.v,1))+1)}function T(B,H,F){let N=setTimeout(()=>{N&&(N=void 0,F(!1))},H);chrome.scripting.executeScript({target:{tabId:B},injectImmediately:!1,func:()=>{}}).then(()=>{N&&(clearTimeout(N),N=void 0,F(!0))}).catch(L=>{O(L)(),N&&(clearTimeout(N),N=void 0,F(!0))})}async function C(B,H){let F=await chrome.scripting.executeScript({target:{tabId:B,frameIds:[H]},injectImmediately:!0,func:()=>"pong"});if(!F||F.length===0||F[0]!=="pong"&&F[0]?.result!=="pong")throw new Error("This page does not support scripting");let N=this?["scripts/page/fsContent.js"]:["scripts/page/fsPageUtils.js","scripts/page/fsSelection.js","scripts/page/fsLinks.js","scripts/page/fsContent.js"];await chrome.scripting.executeScript({target:{tabId:B,frameIds:[H]},injectImmediately:!0,files:N})}function k(B,H,F,N,L,z){o=!1,a=!1,e=L,n=z;let $=H!==y.i&&H!==y.k||z!==0||Ie()&&/Version\/14/.test(navigator.appVersion);E($).then(()=>{m=function(X){X?A(B,F,N):U(B,H,F,N)},O("capturePage: checking capabilities at "+L.url+". Tab state is: "+L.status)(),H!=y.B&&(L.url?.startsWith("chrome://")||L.url?.startsWith("chrome-extension://"))?(O("Chrome url detected. Calling default cap method.")(),A(B,F,N)):H==y.B&&L.url!==void 0&&L.title!==void 0?setTimeout(function(){O("Calling captureBrowser directly...")(),S(),ee("updateFilenameTemplateSettings",Qn()),ee("captureBrowser",{action:B+":-",url:L.url,title:L.title}),N&&N()},100):C(L.id,z).then(()=>setTimeout(m,200)).catch(()=>{O("Calling default capturing on exception")(),m(!0)})})}function P(B,H,F){return new Promise((N,L)=>{let z=$=>chrome.tabs.captureVisibleTab(B,H,X=>{!chrome.runtime.lastError&&X?N(X):$<F.MAX_CAP_TRIALS?(O("Capture visible tab retry "+$)(),setTimeout(()=>{z(++$)},F.CAP_DELAY)):(O("Maximum attempts to call captureVisibleTab reached.")(),L())});z(0)})}function A(B,H,F){P(void 0,{format:"png"},{MAX_CAP_TRIALS:5,CAP_DELAY:510}).then(async N=>{let L=w(H),z=Ur(N);await ee(L,"captureInit"),L!==xe&&await ee(xe,"captureInit");let $={};Le()&&(!e.url||e.url.startsWith("about:"))&&e.width>0&&z.w/e.width*e.height<z.h&&($.crop=!0,$.cropLeft=0,$.cropTop=0,$.cropRight=Math.floor(z.w/e.width)*e.width,$.cropBottom=Math.floor(z.h/e.height)*e.height),ee(L,"captureTabPNG",{dataurl:N,datasize:N.length,x:0,y:0,metrics:{left:0,top:0,crop:!1,stickyHdrHeight:0,...$}}),L!==xe&&ee(xe,"captureTabPNG",{dataurl:N,datasize:N.length,x:0,y:0,metrics:{left:0,top:0,crop:!1,stickyHdrHeight:0,...$}});let X=e.url||"not available",te=e.title?e.title.replace(/[\u200B-\u200F\u202A-\u202E\u2060\u2066-\u2069]/g,"").replace(/\u00A0/g," "):"not available",ne={action:B,url:X,title:te,left:0,top:0,cw:z.w,ch:z.h};ne={...ne,...$};let ue=navigator.userAgent.match(/(Firefox|Chrom(e|ium)|Safari)\/([0-9]+)\./);ne.browserVersion=parseInt(ue&&ue.length>=4?ue[3]:"0.0"),ne.usrData=H.usrData,ne.overrideFolder=H.overrideFolder,ne.contextId=H.contextId,ne.links={},ne.words={},ne.created=new Date,ne.tab={},{windowId:ne.tab.windowId,incognito:ne.tab.incognito,index:ne.tab.index,id:ne.tab.id}=e,ne.savedCapParamsForDebugging={version:Ne().extVersionFull,pro:Xe(),action:ne.action,left:ne.left,top:ne.top,rows:1,cols:1,cw:ne.cw,ch:ne.ch,ratioW:1,ratioH:1},S(),await ee("updateFilenameTemplateSettings",Qn()),await ee(L,"captureDone",ne),L!==xe&&await ee(xe,"captureDone",{...ne,justStore:!0})}).catch(N=>{N&&console.log(N.message)}).finally(()=>{F&&F(!0)})}function U(B,H,F,N){let L=$=>{N&&N($),N=null};function z($,X,te){let ne=-1,ue=-1;P(e.windowId,{format:"jpeg"},{MAX_CAP_TRIALS:20,CAP_DELAY:50}).then(_e=>{try{let ye=lc(_e);ne=ye[0],ue=ye[1],O("Emulation extents: "+ye[0]+" x "+ye[1])()}catch(ye){O(ye.toString())()}}).catch(()=>{}).finally(()=>{g={rw:oo(ne/$),rh:oo(ue/X)},te()})}O("doCapturing")();try{let $=chrome.tabs.connect(e.id,{frameId:n}),X=()=>{L(!1)},te=w(F);v=()=>{t=void 0,$.onMessage.removeListener(se),$.onDisconnect.removeListener(X);try{$.disconnect()}catch{}L(!1)};let ne=()=>{let he=[...u].filter(Ye=>Ye[0]>0&&Ye[1].clientWidth>=100&&Ye[1].clientHeight>=100&&Ye[1].scrollable&&Ye[1].fullyVisible).map(Ye=>Ye[1]),ge=1,Ge=1;if(n>0){let Ye=u.get(n);ge=Ye.scales[0],Ge=Ye.scales[1]}let tt={...de.storage};F.overrideSpeed&&(tt[y.He]=F.overrideSpeed),$.postMessage({topic:"init",mode:H,debug:ie,options:JSON.stringify(tt),adv:Xe(),frames:he,altKey:F.altKey,ratioW:g.rw*ge,ratioH:g.rh*Ge})},ue,_e,ye=null,Ee=parseInt(q(y.edtLimitScrollingTime,1200))||1200;ye=new Date,y.R&&On.clear();let se=async M=>{if(M)switch(O(Ie()?JSON.stringify(M).substring(0,2e3):JSON.stringify(M))(),M.topic){case"ping":$.postMessage({topic:"pong"});break;case"preStep1Done":z(M.windowW,M.windowH,()=>{$.postMessage({topic:"preStep2"})});break;case"preStep2Done":ne();break;case"initAborted":O("init Aborted")(),L();break;case"initDone":switch(ue=M.url,_e=M.title,H){case y.m:case y.i:y.R&&On.saveCommand("captureInit",{}),await ee(te,"captureInit"),te!==xe&&await ee(xe,"captureInit"),$.postMessage({topic:"scrollNext"});break;case y.k:y.R&&On.saveCommand("captureInit",{}),await ee(te,"captureInit"),te!==xe&&await ee(xe,"captureInit"),t=()=>{$.postMessage({topic:"cancelSelection"})},$.postMessage({topic:"selectArea"});break;case y.B:S(),ee("updateFilenameTemplateSettings",Qn()),ee("captureBrowser",{action:B+":-",url:ue,title:_e}),$.onMessage.removeListener(se),$.onDisconnect.removeListener(X),$.disconnect(),L(!0);break}break;case"areaSelected":t=void 0,$.postMessage({topic:"scrollNext"});break;case"areaSelectionCanceled":v();break;case"switchToFrame":{$.onMessage.removeListener(se),$.onDisconnect.removeListener(X),_=M.restorePosition,D=M.capturePosition;let he=new Map;he.set(M.id,u.get(M.id)),u=he,F.overrideTitle=_e,$.disconnect(),k(B,y.i,F,N,e,M.id)}break;case"scrollDone":G(y.Q,M.progress),chrome.runtime.sendMessage({message:"setProgressValue",progress:M.progress}).catch(()=>{}),P(e.windowId,{format:"png"},{MAX_CAP_TRIALS:40,CAP_DELAY:50}).then(he=>{let ge=M.metrics;if(n>0){let tt=u.get(n);ge.left=Math.round((D.left+tt.clientLeft)*g.rw),ge.top=Math.round((D.top+tt.clientTop)*g.rh),ge.cw=tt.clientWidth*g.rw*tt.scales[0],ge.ch=tt.clientHeight*g.rh*tt.scales[1],ge.div=1}y.R&&On.saveCommand("captureTabPNG",{dataurl:he,datasize:he.length,x:M.x,y:M.y,metrics:M.metrics}),ee(te,"captureTabPNG",{dataurl:he,datasize:he.length,x:M.x,y:M.y,metrics:M.metrics}),te!==xe&&ee(xe,"captureTabPNG",{dataurl:he,datasize:he.length,x:M.x,y:M.y,metrics:M.metrics});let Ge=new Date-ye>Ee*1e3;$.postMessage({topic:"scrollNext",cancel:o||Ge})}).catch(()=>$.postMessage({topic:"scrollNext",cancel:!0})).catch(()=>v);break;case"scrollFinished":{if(O("FINISHED ("+M.rows+" x "+M.cols+")")(),G(y.Q,100),chrome.runtime.sendMessage({message:"setProgressValue",progress:100}).catch(()=>{}),(M.rows>10||te!==xe)&&setTimeout(()=>chrome.runtime.sendMessage({message:"setProcessingStatus"}).catch(()=>{}),100),H===y.i&&await yc(200),$.onMessage.removeListener(se),$.onDisconnect.removeListener(X),$.disconnect(),n>0){let ge=u.get(n);M.left=Math.round((D.left+ge.clientLeft)*g.rw),M.top=Math.round((D.top+ge.clientTop)*g.rh),M.cw=ge.clientWidth*g.rw*ge.scales[0],M.ch=ge.clientHeight*g.rh*ge.scales[1],M.div=1}M.savedCapParamsForDebugging={version:Ne().extVersionFull,pro:Xe(),action:B,div:M.div,left:M.left,top:M.top,rows:M.rows,cols:M.cols,cw:M.cw,ch:M.ch,ratioW:g.rw,ratioH:g.rh,cropLeft:M.cropLeft,cropRight:M.cropRight,cropTop:M.cropTop,cropBottom:M.cropBottom},M.url=ue,M.title=F.overrideTitle||_e,M.key="-",M.action=B;let he=navigator.userAgent.match(/(Firefox|Chrom(e|ium)|Safari)\/([0-9]+)\./);if(M.browserVersion=parseInt(he&&he.length>=4?he[3]:"0.0"),M.usrData=F.usrData,M.overrideFolder=F.overrideFolder,M.contextId=te===xe?F.contextId:0,M.created=new Date,M.tab={},{windowId:M.tab.windowId,incognito:M.tab.incognito,index:M.tab.index,id:M.tab.id}=e,!a){y.R&&On.saveCommand("captureDone",M),S(),await ee("updateFilenameTemplateSettings",Qn());try{await ee(te,"captureDone",M),te!==xe&&await ee(xe,"captureDone",{...M,justStore:!0})}catch(ge){console.error(ge)}}n>0&&_&&(chrome.scripting.executeScript({args:[_.left,_.top],target:{tabId:e.id,frameIds:[0]},injectImmediately:!0,func:(ge,Ge)=>document.scrollingElement.scrollTo(ge,Ge)}),_=void 0),L(!0);break}case"setOption":G(M.optionName,M.optionValue);break}};$.onMessage.addListener(se),$.onDisconnect.addListener(X),G(y.Q,0);let me=()=>{n===0?$.postMessage({topic:"preStep1",debug:ie}):ne()};Ie()?new Promise(M=>{setTimeout(M,200)}).then(()=>{try{me()}catch(M){console.log(M),A(B,F,N)}}):me()}catch($){console.error($),L()}}function V(B){o=!1,a=!1,O("capturetabs")();function H(X,te){return{next:function(ne){te(ne)||X(this)}}}function F(X,te){Ie()?chrome.tabs.update(X.id,{active:!0,highlighted:!0},te):chrome.tabs.highlight({windowId:X.windowId,tabs:X.index},te)}function N(X){return new Promise(function(te){var ne=0;let ue=Number(new Date),_e=!Xe()||q(y.Ke)==="true"?y.m:y.i,ye=Ie()||q(y.Ge)==="true",Ee;ye&&(d=(se,me)=>{se===ue&&(Ee||(Ee=me,qn(me)))}),chrome.tabs.query({currentWindow:!0},se=>{if(!se||se.length===0){te(ne);return}for(let he=0;he<se.length&&!$;++he)se[he].active&&($=se[he]);var me=0,M=new H(he=>{try{F(se[me],()=>{T(se[me].id,5e3,ge=>{ge?k(X,_e,{contextId:ue},Ge=>{Ge&&++ne,he.next()},se[me++],0):(me++,he.next())})})}catch(ge){Jt(ge.message),te(ne)}},()=>me>=se.length||o||!be().contains(y.P)?(ye&&Ee&&setTimeout(()=>qn(Ee),1e3),te(ne),!0):!1);M.next()})})}let L=new ao;L.start();var z=B===y.T||!it()?B:y.se,$;B===y.T&&(ee("startMultiPagePDF"),c=!0),p=0,be().add(y.P),be(),N(z).then(X=>{be().remove(y.P),L.stop(),B===y.T?(ee("endMultiPagePDF"),c=void 0):ee("doGroupAction",{action:B,count:X})})}let j={doTest:B=>{let H={id:B},F=0;m=N=>{N=N||!1,console.log("Called pendingCapFunction with result: "+N)},C(H.id,F).then(()=>setTimeout(m,200)).catch(()=>{O("Calling default capturing on exception")(),m(!0)})},onFileSavedEvent:(B,H)=>{d&&d(B,H)},stopCapturing:B=>{o=!0,a=B,O("Capturing canceled")();let H=be();p++===0?t&&(Zn(),t()):H.contains(y._)?setTimeout(v,1500):(H.contains(y.f)||H.contains(y.P))&&H.reset()},executeGrabber:(B,H,F,N)=>{if(p=0,F=F||{},H===y.O)V(B);else{c&&(ee("cancelMultiPagePDF"),c=void 0);let L=z=>{be().remove(y._),N&&N(z)};be().add(y._),F.tabId?chrome.tabs.get(F.tabId,z=>z?k(B,H,F,L,z,0):L(!1)):chrome.tabs.query({currentWindow:!0,active:!0},z=>{z.length>0?k(B,H,F,L,z[0],0):(Zn(),L(!1))})}},captureList:async B=>{B={...B};let H=B.prefBatchURLs.split(`
`).filter(L=>L.trim().length>0).map(L=>(L=L.trim(),/^(http|https|ftp|ftps):\/\/.*/.test(L)?L:"https://"+L)),F="";if(B.prefBatchCreateFolder){let L=new Date;F=`FireShot batch job (${L.getFullYear()}-${yn(L.getMonth()+1,0,2)}-${yn(L.getDate(),0,2)} ${yn(L.getHours(),0,2)}-${yn(L.getMinutes(),0,2)}-${yn(L.getSeconds(),0,2)})`}be().add(y.f);let N=new ao;N.start();try{let L,z=Number(new Date);B.prefBatchOpenFolder&&(d=($,X)=>{$===z&&(L||(L=X,qn(X)))}),await new xu(j).grabPages(H,B.prefBatchFormat==="pdf"?y.I:y.E,B.prefBatchMode==="entire"?y.i:y.m,{timeout:parseInt(B.prefBatchTimeout),delay:parseInt(B.prefBatchDelay),speed:parseInt(B.prefBatchScrollSpeed),subfolder:F,callbackContextId:z}),B.prefBatchOpenFolder&&L&&setTimeout(()=>qn(L),1e3)}catch(L){console.error(L)}N.stop(),be().remove(y.f)}};return j}var bi="utmrAlarmUpdated";function Tu(){let e=new Date,t=Math.round(e.getTime()/(1e3*60*60*24)),n=y.Ye+t;fetch(n).then(o=>{if(o.status==200)G(y.C,e.getTime()+Math.round(Math.random()*y.qe)),O("Update info available in "+(parseInt(q(y.C))-e.getTime())/1e3+" seconds")(),ku();else throw"fail"}).catch(()=>{console.log(`Failed to check update, resuming in ${y.q/1e3} seconds`),setTimeout(Tu,y.q),G(y.H,Date.now()+y.q)}),O("Checking "+n)()}function ku(){let e=parseInt(q(y.C,"0")),t=e-Date.now();e&&t<=0?(chrome.alarms.clear(bi),Cu()):(chrome.alarms.clear(bi),chrome.alarms.create(bi,{when:e}))}function pr(){O("checkAdvancedUpdates")();let e=parseInt(q(y.H,"0")),t=parseInt(q(y.C,"0")),n=new Date().getTime();t?(O("scheduling update badge")(),ku()):e?n>=e?(O("almost time to check updates")(),setTimeout(Tu,Math.random()*y.Qe)):(O(`not a time to check for updates, have to wait for ${(e-n+1e3)/1e3} seconds`)(),setTimeout(pr,e-n+1e3)):(O(`first run, scheduling check in ${y.X/1e3} seconds`)(),G(y.H,n+y.X),setTimeout(pr,y.X+1e3))}function Cu(){parseInt(q(y.C,"0"))&&(G(y.H,""),G(y.C,""),O("Update!")(),(!(Xe()&&io())||ie)&&vn(`https://getfireshot.com/updated.php?app=${ut()}&src=ext&ver=${q(y.g)}&win=${At()?1:0}`),pr())}function Km(e){de.ensureLoaded().then(()=>{switch(e.name){case bi:Cu();break}})}chrome.alarms.onAlarm.addListener(Km);async function Au(e){let t=-1;async function n(){async function m(g,v){function _(k,P){return new Promise(A=>{fetch(P.data).then(U=>U.blob()).then(U=>{U.name=decodeURIComponent(P.name),k.push(U),A()})})}let D=await chrome.runtime.sendMessage({type:"getAttachments",email:g.User.getEmailAddress()}),w=JSON.parse(D),E=[],S=[],T=[];v.setToRecipients(decodeURIComponent(w.to).split(",")),v.setSubject(decodeURIComponent(w.subject));for(var C=0;C<w.files.length;++C)E.push(_(w.files[C].inline==="yes"?S:T,w.files[C]));await Promise.all(E).then(()=>{S.length>0&&v.attachInlineFiles(S),T.length>0&&(setTimeout(function(){v.attachFiles(T)},1e3),v.getBodyElement().focus())})}InboxSDK.load(2,"sdk_FireShot_c30c6a0127").then(g=>{let v=g.Compose.registerComposeViewHandler(_=>{v(),m(g,_)});g.Compose.openNewComposeView()})}let o=!1;chrome.runtime.onMessage.addListener(function m(g,v,_){v?.tab?.id===t&&(g.type==="inboxsdk__injectPageWorld"&&!o?(o=!0,chrome.scripting.executeScript({target:{tabId:v.tab.id},world:"MAIN",files:["scripts/3p/pageWorld.js"]}),_(!0)):g.type==="getAttachments"&&(chrome.runtime.onMessage.removeListener(m),_(e)))});let a=!1,c=async(m,g,v)=>{!a&&t===m&&g?.status==="complete"&&/^https?:\/\/mail.google.com\/mail.*$/.test(v.url)&&(chrome.tabs.onUpdated.removeListener(c),a=!0,await chrome.scripting.executeScript({target:{tabId:t},files:["scripts/3p/inboxsdk.js"]}),await chrome.scripting.executeScript({target:{tabId:t},func:n}))},u=null,d=async()=>{chrome.tabs.onUpdated.addListener(c),{id:t}=await chrome.tabs.create({url:"https://gmail.com/"})};if(setTimeout(()=>{chrome.tabs.onUpdated.removeListener(c),chrome.tabs.onRemoved.removeListener(u)},300*60*1e3),await dc())d();else{let{id:m}=await chrome.tabs.create({url:"fsGmailPermissions.html"});u=async g=>{g===m&&(Ve()("Permissions tab closed"),chrome.tabs.onRemoved.removeListener(u),await chrome.permissions.contains({origins:["https://mail.google.com/*"]})?(Ve()("Gmail permissions granted starting GMail."),d()):Ve()("Gmail permissions not granted, aborting attachment"))},chrome.tabs.onRemoved.addListener(u)}}function Pu(e){function t(){chrome.tabs.executeScript(null,{file:"scripts/page/fsAPIEvents.js",runAt:"document_start",allFrames:!0},function(){chrome.runtime.lastError&&O(chrome.runtime.lastError)()})}Le()?t():e==="tabSwitch"?chrome.permissions.contains({permissions:["activeTab"]},n=>n&&t()):t()}function Du(){chrome.tabs.onUpdated.addListener(function(e,t,n){t&&t.status==="complete"&&(/https:\/\/(dbg\.)?getfireshot\.com\/activate[1]*\.php/.test(n.url)?chrome.tabs.executeScript(e,{file:"scripts/page/fsActivation.js",runAt:"document_start"},()=>{chrome.runtime.lastError}):bn()&&Pu("pageLoad"))}),chrome.tabs.onActivated.addListener(function(){bn()&&Pu("tabSwitch")})}tc();var aa=()=>{},Rn=null,Mu="alarmCleanupDB",wi={openFile:bu,openClipboard:wu,showAbout:Su,onFileSavedEvent:Qm,onStopCapturingClicked:ua,resumeEditing:gu,executeGrabber:Mn,executeBatch:Jm,enterLicense:vu,openCaptureSettings:yu,openSettings:mu,addOnDeterminingFilenameHandler:rg,doTrial:ra,tryReconnecNativePlugin:Ym,showLicenseInfo:_u,captureLoaded:og,captureCreated:ig,doTest:zm,isNativeSupported:Pt,scrollingCompleted:ag,addTaskOnPermissionGranted:hr,reactivateToken:Ke.W.bind(Ke),updateToken:Ke.Se.bind(Ke),removeLicensingInfo:Eu};O("Service worker started.")();var Kt,{extVersion:jt,extVersionFull:ca,fSilentMode:Fu}=Ne(),Ou=!1,Nu=!1,Lu;de.onInit=async()=>{if(O("fsPreferences.onInit event.")(),be().reset(),!de.getOption("migrationFromMV2Done",!1)){try{O("Performing migration from MV2...")();let e=Ie()?{...localStorage}:{...await vc()};[y.a,y.g].forEach(t=>delete e[t]),de.assignOptions(e)}catch{}de.setOption("migrationFromMV2Done",!0)}};chrome.runtime.onMessage.addListener(ct(Xm));chrome.commands.onCommand.addListener(ct(eg));chrome.contextMenus.onClicked.addListener(ct(tg));chrome.alarms.onAlarm.addListener(ct(ng));chrome.runtime.onInstalled.addListener(ct(async e=>{de.ensureLoaded().then(Kr),e.reason&&e.reason==="install"&&(Nu=!0,de.ensureLoaded().then(qm))}));!Le()&&!Ie()?(de.ensureLoaded().then(Ru),chrome.runtime.onStartup.addListener(ct(()=>{O("*** chrome.runtime.onStartup")(),de.ensureLoaded().then(sa)})),self.oninstall=()=>de.ensureLoaded().then(sa)):de.ensureLoaded().then(async()=>{await Ru(),await sa()});function jm(){O("restoreBadge")();let e=q(y.ge,"");e!==""&&vn(e)}function Hm(){if(O("displayAnnouncements")(),Fu)return;if(Nu){mn(Vm());return}else if(it())return;let e=q(y.g);e&&jt!=e&&(!Xe()||ie||q(y.pe,"true")==="true"?vn(Bu()):G(y.g,jt))}function Vm(){return O("getInstalledPageUR")(),it()||Xe()&&!Ie()?`https://getfireshot.com/installed.php?ver=${jt}&app=${ut()}&native=1`:`https://getfireshot.com/installed-lite.php?ver=${jt}&app=${ut()}`}function Bu(){return O("getUpdatedPageURL")(),it()||Xe()&&!Ie()?`https://getfireshot.com/updated.php?app=${ut()}&ver=${jt}&h=${Xe()?"1":"0"}`:`https://getfireshot.com/updated-lite.php?app=${ut()}&ver=${jt}`}function $u(){return O("initNativeModule")(),new Promise(e=>{ot.init(Ku,Zm,()=>{O("Host ready event")(),e(),Wm()},()=>{e()})})}function Wm(){let e=wt=="{5e11ab1e-083c-11e5-a6c0-1697f925ec7b}";G(y.t,q(y.t)==="true"||e)}async function Gm(){O("performVisualDelay")();let e=q(y.We,5);be().add(y.V);let t=!1,n=o=>new Promise(a=>setTimeout(a,o));for(let o=e;o>0&&!t;--o){chrome.action.setBadgeBackgroundColor({color:"#333"}),chrome.action.setBadgeTextColor({color:"#fff"}),chrome.action.setBadgeText({text:o.toString()});for(let a=0;a<5&&!t;++a)await n(200),t=!be().contains(y.V)}return chrome.action.setBadgeText({text:""}),be().remove(y.V),!t}function hr(e,t){if(!wi[t.method]){console.error("Unknown method: "+t.method);return}chrome.permissions.contains(e).then(n=>{if(n)return wi[t.method].apply(self,t.args);hr.callId=hr.callId||0;let o=()=>chrome.permissions.onAdded.removeListener(c),c=(d=>()=>{o(),d===hr.callId&&chrome.permissions.contains(e).then(p=>p?wi[t.method].apply(self,t.args):!1)})(++hr.callId);chrome.permissions.onAdded.addListener(c),setTimeout(o,3e4)})}async function zm(){}function Uu(){Mn(no(),Br())}async function Mn(e,t,n,o,a,c){O(`executeGrabber(${e}, ${t})`)();let u=be();u.contains(y._)||u.contains(y.V)||(!n?.delayed||await Gm())&&(a||ro(e,t),Kt=new oa,Kt.executeGrabber(e,t,n,o,c))}function Jm(e){O("executeBatch")(),!be().contains(y._)&&(Kt=new oa,Kt.captureList(e))}function Ym(){O("tryReconnecNativePlugin")(),!ot.autoReconnect&&!ot.updating&&!ot.portBusy&&$u()}function Ku(e){ct(()=>{var t=e.topic,n=e.data?e.data+"":"";if(t=="status")e.code==co?(ee("setToken",{data:de.getOption(y.o,"")}),ee("setAddonVersion",{version:ca,browser:qi,id:wt,guid:q(y.a)})):(gn("UA-1025658-9","DLL","NativeError",e.data),O("Error from native module: "+e.data)());else if(t=="licenseRemoved")$r();else if(t=="hostInfo"){e.data.id&&G(y.we,e.data.id);let o;try{o=[...so(e.data.key).match(/(\w{4})(\w{4})(\w{4})(\w{4})(\w{4})(\w{4})/).slice(1)].join("-").toUpperCase()}catch{}o&&e.data.user?(G(y.u,o),G(y.b,so(e.data.user)),setTimeout(()=>Ke.W(hn(e.data.user,o),o),1e3)):Lu&&e.data.token!==""&&!q(y.o)&&Ke.yt(e.data.token)}else if(t=="openURL")/buy\.php/.test(n)&&(n+=`${n.includes("?")?"&":"?"}ver=${Ne().extVersionFull}`),mn(n);else if(t=="enableResumeMenu")G(y.Z,n==="enable");else if(t=="setupMode")rt().then(o=>{o?.ae()||G(y.t,n!=="false")});else if(t=="processingFinished")Zn();else if(t=="setRegistered")rt().then(o=>{o?.ae()||G(y.p,n!=="false")});else if(t=="getInfo"){let o=n.split("|"),a=new URL(o[0]),c=a.searchParams.get("serial")?.toUpperCase(),u=a.searchParams.get("user");c&&u&&Ke.W(hn(u,c),c),mc(n,function(d){ee("processInfo",{data:d})})}else if(t=="sendCrashReport")hc(n);else if(t=="base64Content")Rn&&Rn(n);else if(t=="sendToGmail")Au(n);else if(t=="switchToLite")gn("UA-1025658-9","fireshot.com","NativeSwitchBackToLite"),ro(y.E,y.i),G(y.t,"false"),ot.forceDisconnect();else if(t=="updateFilenameTemplate")gc(n);else if(t=="enterLicense")Xn("fsEnterLicense.html");else if(t==="dll-experiment"){let o;n!=="success"&&n!=="create"&&(o=n,n="fail"),cc("dll-token2",n,kt,o)}else t==="dll-sentry-catch"&&kt.captureException(new Error(n))})()}function Xm(e,t,n){let o=["callExtensionMethodMsg","checkFSAvailabilityEvt","activateFireShot"].indexOf(e.message)!==-1,a=async c=>{try{if(c.name&&c.key){if(O(c.name+" "+c.key)(),c.usetoken=="false")return G(y.b,c.name),G(y.u,c.key),ee("setToken",{data:""}),ee("activateFireShot",{name:c.name,key:c.key}),"OK";{let u=await Ke.te(c.name,c.key);if(u.result){let d=await rt();return d?(G(y.b,d.bt()),G(y.u,c.key),ee("activateFireShot",{}),"OK"):"Token retrieval error"}else return u.message||"Unknown error"}}else if(c.sid){let u=await Ke.ie({sid:c.sid});return ee("setToken",{data:await bt()}),u.result&&ee("activateFireShot",{name:"",key:""}),u.result?"OK":u.message||"Unknown error"}}catch(u){return"An exception occurred during activation: "+u.message}};return de.ensureLoaded().then(()=>{switch(e.message){case"callExtensionMethodMsg":{let c=wi[e.method];c?typeof c=="function"?e.async?(e.params.push(u=>n(u)),c(...e.params)):n(c(...e.params)):console.error(`Error: ${e.method}() is not a function.`):console.error(`Error: function ${e.method}() not found.`)}break;case"checkFSAvailabilityEvt":O("checkFSAvailabilityEvt")(),n({FSAvailable:!0,FSNative:Pt(),FSUpgraded:q(y.t)==="true",FSVersion:ca});break;case"capturePageEvt":{let c=parseInt(e.Action);if(c==y.Le)it()?ra():mn("https://getfireshot.com/buy.php?SRC="+ut()+`-lite&ver=${Ne().extVersionFull}`);else if(bn()){Rn=d=>{Rn=null;try{chrome.scripting.executeScript({args:[d],target:{tabId:t.tab.id,frameIds:[t.frameId]},injectImmediately:!0,func:p=>{if(window.fsPendingCB){let m={cbId:window.fsPendingCB,data:p};typeof cloneInto<"u"&&(m=cloneInto(m,document.defaultView));let g=new document.defaultView.CustomEvent("FireShotCaptureCompleteEvent",{detail:m});document.dispatchEvent(g)}}})}catch{}};let u;switch(e.Entire){case"selected":u=y.k;break;case"true":u=y.i;break;default:u=y.m;break}Mn(c===y.ce?y.se:c,u,{usrData:e.Data},function(){c===y.ce&&ee("storeEncodedContent",{path:e.Data}),c!==y.Fe&&Rn&&Rn("")},!0,t.frameId)}}break;case"switchToNativeEvt":Iu();break;case"activateFireShot":{a(e).then(c=>n(c));break}}}),o}function qm(){O("FireShot installed.")(),G(y.g,jt);}function Qm(e,t){O(`onFileSavedEvent(ctxId = ${e}, fileId = ${t})`)(),Kt&&Kt.onFileSavedEvent(e,t)}function ua(){O("onStopCapturingClicked")();let e=be();return e.contains(y.f)&&e.remove(y.f),Kt?(Kt.stopCapturing(),!0):!1}function Zm(e){O("onNativeHostUpdated")(),ct(()=>{O("Native module has updated to the "+e+" version.")(),gn("UA-1025658-9","DLL","NativeHostUpdated");let t=q(y.g);t&&t!=jt&&e==ca&&!Fu&&(!Xe()||ie||q(y.pe,"true")==="true"?vn(Bu()):G(y.g,e))})()}function eg(e){O("Hotkey command:"+e)(),de.ensureLoaded().then(Yn).then(()=>{let t=be();if(!t.contains(y._)&&!t.contains(y.f)&&!t.contains(y.P)){let n=it()?y.E:y.Y;switch(e){case"last-used-action":Uu();break;case"capture-entire-page-action":Mn(n,y.i);break;case"capture-visible-page-action":Mn(n,y.m);break;case"capture-selection-action":Mn(n,y.k);break}}else(t.contains(y._)||t.contains(y.f)||t.contains(y.P))&&e==="last-used-action"&&ua()})}function tg(e){de.ensureLoaded().then(()=>{switch(e.menuItemId){case"mnuLastCommand":be().isIdle()&&Uu();break;case"mnuStopCommand":ua();break}})}async function sa(){Ou||(Ou=!0,O("onExtensionStartup event")(),chrome.alarms.create(Mu,{periodInMinutes:1440}),G(y.Z,!1),G(y.A,!1),Mr()?Du():bn()&&fc(!0),jm(),At()&&!to()?await $u():await Ke.st(),await Ke.ft(),q(y.o)&&Ke.xe(),Hm())}async function Ru(){O("onServiceWorkerStarted event")(),q(y.a)||(G(y.a,pc()),Lu=!0),xe.init(Ku),pr(),de.onChanged.addListener(e=>{e&&e[y.F]&&Kr()})}function ng(e){switch(O(e)(),e.name){case Mu:setTimeout(()=>{de.ensureLoaded().then(()=>{let t=parseInt(de.getOption(y.ze,"30"));t&&sn.deleteOlderThanGivenDays(t)})},3e3);break;case Jn:Ke.xe();break}}function rg(e){Le()||Ie()||(O("addOnDeterminingFilenameHandler")(),aa(),e&&ct(()=>{let t=(n,o)=>{n.byExtensionId===wt&&(o({filename:e}),aa())};aa=()=>chrome.downloads.onDeterminingFilename.removeListener(t),chrome.downloads.onDeterminingFilename.addListener(t)})())}function ig(){}function og(){}function ag(){}})();
//# sourceMappingURL=fsServiceWorker.js.map

//# debugId=32645bf6-9484-56df-beeb-4c9335d64e31
