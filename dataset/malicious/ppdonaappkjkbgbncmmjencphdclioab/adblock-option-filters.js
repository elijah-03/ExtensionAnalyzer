function CheckboxForFilterList(t,i,e,n){this._container=n,this._filterList=t;var r=i+"_"+e;this._div=$("<div></div>").addClass("subscription").addClass(i).attr("name",t.id).css("display","language_filter_list"===i?t.subscribed?"block":"none":"block"),this._checkBox=$("<input />").attr("type","checkbox").attr("id",r).css("margin-left","2px").prop("checked",!!t.subscribed||null).addClass("filter_list_control"),this._label=$("<label></label>").text(t.label||t.title||t.url).attr("title",t.url).attr("for",r),this._link=$("<a></a>").text(t.label||t.title).css("margin-left","6px").css("font-size","10px").css("display",$("#btnShowLinks").prop("disabled")?"inline":"none").attr("target","_blank").attr("class","linkToList").attr("data-URL",t.url).click((function(t){var i=$(this).attr("data-URL");$(this).attr("href",i)})),this._infospan=$("<span></span>").addClass("subscription_info").text(t.subscribed&&!t.lastDownload?translate("fetchinglabel"):""),this._removeFilterListLabel=t.user_submitted?$("<a>").css("font-size","10px").css("display",t.subscribed?"none":"inline").css("padding-left","10px").attr("href","#").addClass("remove_filterList").text(translate("removefromlist")).click((function(i){i.preventDefault();var e=$(this).parent(),n=e.attr("name");SubscriptionUtil.unsubscribe(n,t,!0),e.remove()})):null}function OptionForFilterList(t,i){this._option=$("<option>",{value:t.id,text:t.label||t.title,hidden:t.hidden}).data("index",i)}CheckboxForFilterList.prototype={_bindActions:function(){this._checkBox.change((function(){var t=$(this).parent(),i=$(this).is(":checked"),e=t.attr("name");if(i){if(!SubscriptionUtil.validateOverSubscription())return void $(this).prop("checked",!1);$(".subscription_info",t).text(translate("fetchinglabel")),SubscriptionUtil.subscribe(e),FilterListUtil.cachedSubscriptions[e].subscribed=!0}else{if(!SubscriptionUtil.validateUnderSubscription())return void $(this).prop("checked",!0);SubscriptionUtil.unsubscribe(e,!1),$(".subscription_info",t).text(translate("unsubscribedlabel")),FilterListUtil.cachedSubscriptions[e].subscribed=!1,FilterListUtil.cachedSubscriptions[e].lastDownload=-1,FilterListUtil.cachedSubscriptions[e]._lastDownload=-1}if($(".remove_filterList",t).css("display",i?"none":"inline"),t.attr("class").indexOf("language_filter_list")>-1&&(t.toggle(500),!i)){var n=$(this).attr("id").split("_")[3],r=filterListSections.language_filter_list.array[n];r.hasOwnProperty("label")||(r.label=translateIDs(e));var s=new OptionForFilterList(r,n);LanguageSelectUtil.insertOption(s.get(),n)}})),this._filterList.user_submitted&&this._removeFilterListLabel.click((function(t){t.preventDefault();var i=$(this).parent(),e=i.attr("name");SubscriptionUtil.unsubscribe(e,i._filterList,!0),i.remove()}))},createCheckbox:function(t){this._div.append(this._checkBox).append(this._label).append(this._link).append(this._infospan).append(this._removeFilterListLabel),this._container.append(this._div),this._bindActions(),t&&(this._checkBox.prop("checked",!0),this._checkBox.trigger("change"))}},OptionForFilterList.prototype={get:function(){return this._option}};var filterListSections={adblock_filter_list:{array:[],$container:$("#ad_blocking_list")},language_filter_list:{array:[],$container:$("#language_list")},other_filter_list:{array:[],$container:$("#other_filter_lists")},custom_filter_list:{array:[],$container:$("#custom_filter_lists")}};function SectionHandler(t,i){this._cachedSubscriptions=t.array,this._$section=t.$container,this._filterList_type=i}function FilterListUtil(){}function LanguageSelectUtil(){}function SubscriptionUtil(){}function CustomFilterListUploadUtil(){}function onFilterChangeHandler(t,i,e,n){var r=function(t,i){if(t){for(var e=["downloadStatus","label","lastDownload","_downloadStatus","language"],n=0;n<e.length;n++)t[e[n]]&&(FilterListUtil.cachedSubscriptions[t.id][e[n]]=t[e[n]]);i&&"subscription.added"===i&&(FilterListUtil.cachedSubscriptions[t.id].subscribed=!0),i&&"subscription.removed"===i&&(FilterListUtil.cachedSubscriptions[t.id].subscribed=!1),FilterListUtil.updateCheckbox(FilterListUtil.cachedSubscriptions[t.id],t.id),FilterListUtil.cachedSubscriptions[t.id].subscribed&&FilterListUtil.updateSubscriptionInfoForId(t.id)}};if(t&&("load"===t||t.indexOf("subscription.")>-1)){if(i&&i.url){var s=function(i,e){i.id=e,r(i,t)};if(o=backgroundPage.getIdFromURL(i.url))return void s(i,o);if(FilterListUtil.cachedSubscriptions["url:"+i.url])return void s(i,"url:"+i.url);if("subscription.title"===t&&e){if(o=backgroundPage.getIdFromURL(e))return void s(i,o);if(o=backgroundPage.getIdFromURL(n))return void s(i,o)}}var a=backgroundPage.getAllSubscriptionsMinusText(),l=FilterListUtil.cachedSubscriptions;for(var o in l){var c=a[o];r(c)}}}function translateIDs(t){if(t.endsWith("_old")){var i=t.split(/_old$/)[0];return translate("filter"+i)}var e=translate("filter_"+t);return""!=(e=e.trim())&&e.length>0?e:translate("filter"+t)}SectionHandler.prototype={_organize:function(){for(var t=0;t<this._cachedSubscriptions.length;t++){new CheckboxForFilterList(this._cachedSubscriptions[t],this._filterList_type,t,this._$section).createCheckbox()}},initSection:function(){this._organize()}},FilterListUtil.sortFilterListArrays=function(){for(var t in filterListSections)filterListSections[t].array.sort((function(t,i){return t.label>i.label?1:t.label===i.label?0:-1}))},FilterListUtil.getFilterListType=function(t){return"adblock_custom"===t.id||"easylist"===t.id||"acceptable_ads"===t.id?"adblock_filter_list":"easyprivacy"===t.id||"antisocial"===t.id||"malware"===t.id||"annoyances"===t.id||"bitcoin_mining_protection"===t.id||"warning_removal"===t.id?"other_filter_list":!0===t.language?"language_filter_list":"custom_filter_list"},FilterListUtil.prepareSubscriptions=function(t){for(var i in FilterListUtil.cachedSubscriptions=t,t)if(i){var e=t[i];e.label=translateIDs(i),e.id=i;var n=FilterListUtil.getFilterListType(e);filterListSections[n].array.push(e)}FilterListUtil.sortFilterListArrays()},FilterListUtil.checkUrlForExistingFilterList=function(t){var i=FilterListUtil.cachedSubscriptions;for(var e in i)if(t===i[e].url)return i[e]},FilterListUtil.updateSubscriptionInfoAll=function(){var t=FilterListUtil.cachedSubscriptions;for(var i in t)FilterListUtil.updateSubscriptionInfoForId(i)},FilterListUtil.updateSubscriptionInfoForId=function(t){var i=$("[name='"+t+"']"),e=FilterListUtil.cachedSubscriptions[t];if(!1!==e.subscribed){var n=$(".subscription_info",i),r=n.text(),s=e.lastDownload||e._lastDownload;if(n.text()!==translate("invalidListUrl")){if(Synchronizer.isExecuting(e.url))r=translate("fetchinglabel");else if(e.downloadStatus&&"synchronize_ok"!=e.downloadStatus){var a={synchronize_invalid_url:translate("ab_filters_subscription_lastDownload_invalidURL"),synchronize_connection_error:translate("ab_filters_subscription_lastDownload_connectionError"),synchronize_invalid_data:translate("ab_filters_subscription_lastDownload_invalidData"),synchronize_checksum_mismatch:translate("ab_filters_subscription_lastDownload_checksumMismatch")};r=e.downloadStatus in a?a[e.downloadStatus]:e.downloadStatus}else if(s>0){var l=Date.now()-1e3*s,o=Math.round(l/1e3),c=Math.round(o/60),u=Math.round(c/60),d=Math.round(u/24);r="";r+=o<10?translate("updatedrightnow"):o<60?translate("updatedsecondsago",[o]):1===c?translate("updatedminuteago"):c<60?translate("updatedminutesago",[c]):1===u?translate("updatedhourago"):u<24?translate("updatedhoursago",[u]):1===d?translate("updateddayago"):translate("updateddaysago",[d])}n.text(r)}}},FilterListUtil.updateCheckbox=function(t,i){var e=$("div[name='"+i+"']"),n=$(e).find("input");n.is(":checked")!==t.subscribed&&(n.prop("checked",!!t.subscribed||null),$(".subscription_info",e).text(t.subscribed?translate("fetchinglabel"):translate("unsubscribedlabel")))},LanguageSelectUtil.insertOption=function(t,i){var e,n=$("#language_select"),r=n.find("option");for(e=0;e<r.length;e++){var s=r.eq(e).data("index");if(s&&parseInt(s)>parseInt(i))break}r.eq(e).length>0?r.eq(e).before(t):n.append(t)},LanguageSelectUtil.init=function(){for(var t=filterListSections.language_filter_list.array,i=0;i<t.length;i++){var e=t[i];if(!e.subscribed){var n=new OptionForFilterList(e,i);LanguageSelectUtil.insertOption(n.get(),i)}}$("#language_select").change((function(){var i=$(this),e=i.find(":selected"),n=$(e).data("index"),r=t[n];if(r){i.find("option:first").prop("selected",!0),e.remove();var s=$("[name='"+r.id+"']").find("input");s.prop("checked",!0),s.trigger("change")}}))},LanguageSelectUtil.triggerChange=function(t){var i=$("#language_select");i.val(t.id),i.trigger("change")},SubscriptionUtil.validateOverSubscription=function(){if($(".subscription :checked").length<=6)return!0;if(optionalSettings&&optionalSettings.show_advanced_options){if($.cookie("noOversubscriptionWarning"))return!0;$.cookie("noOversubscriptionWarning","true",{expires:1/48})}return confirm(translate("you_know_thats_a_bad_idea_right"))},SubscriptionUtil.validateUnderSubscription=function(){if($(".subscription :checked").length>=1)return!0;if(optionalSettings&&optionalSettings.show_advanced_options){if($.cookie("noUnderSubscriptionWarning"))return!0;$.cookie("noUnderSubscriptionWarning","true",{expires:1/48})}return confirm(translate("unsubscribe_from_all_confirmation"))},SubscriptionUtil.subscribe=function(t,i){SubscriptionUtil._updateCacheValue(t);var e=FilterListUtil.cachedSubscriptions[t];if(e)e=Subscription.fromURL(e.url);else if(/^url\:.*/.test(t)){var n={user_submitted:!0,initialUrl:t.substr(4),url:t.substr(4),title:i};FilterListUtil.cachedSubscriptions[t]=n,e=Subscription.fromURL(n.url)}FilterStorage.addSubscription(e),e instanceof DownloadableSubscription&&Synchronizer.execute(e),"acceptable_ads"===t&&($("#acceptable_ads_info").slideUp(),$("#acceptable_ads").prop("checked",!0),optionalSettings=backgroundPage.getSettings(),optionalSettings&&optionalSettings.safari_content_blocking&&backgroundPage.updateFilterLists()),"easylist"===t&&$("#easylist_info").slideUp()},SubscriptionUtil.unsubscribe=function(t){SubscriptionUtil._updateCacheValue(t);var i=FilterListUtil.cachedSubscriptions[t];i=Subscription.fromURL(i.url),setTimeout((function(){FilterStorage.removeSubscription(i)}),1),"acceptable_ads"===t&&($("#acceptable_ads_info").slideDown(),$("#acceptable_ads").prop("checked",!1),optionalSettings=backgroundPage.getSettings(),optionalSettings&&optionalSettings.safari_content_blocking&&backgroundPage.updateFilterLists()),"easylist"===t&&$("#easylist_info").slideDown()},SubscriptionUtil._updateCacheValue=function(t){var i=FilterListUtil.cachedSubscriptions[t];if(i)for(var e=["downloadStatus","label","lastDownload","_downloadStatus"],n=0;n<e.length;n++)i[e[n]]&&delete i[e[n]]},CustomFilterListUploadUtil._performUpload=function(t,i,e){var n={id:i,url:t,subscribed:!1,user_submitted:!0,label:"",title:e};FilterListUtil.cachedSubscriptions[n.id]=n;var r=filterListSections.custom_filter_list;new CheckboxForFilterList(n,"custom_filter_list",r.array.length,r.$container).createCheckbox(!0)},CustomFilterListUploadUtil._updateExistingFilterList=function(t){var i=$("div[name='"+t.id+"']");if(i.length<1){var e=FilterListUtil.getFilterListType(t),n=filterListSections[e].array,r=n.indexOf(t);r<0&&(r=n.length,n.push(t)),new CheckboxForFilterList(t,e,r,filterListSections[e].$container).createCheckbox(),i=$("div[name='"+t.id+"']")}var s=$(i).find("input");s.is(":checked")||(s.attr("id").indexOf("language_filter_list")>=0?LanguageSelectUtil.triggerChange(t):(s.prop("checked",!0),s.trigger("change")))},CustomFilterListUploadUtil.bindControls=function(){$("#btnNewSubscriptionUrl").click((function(){var t=$("#txtNewSubscriptionUrl").val(),i=/^abp.*\Wlocation=([^\&]+)/i;i.test(t)&&(t=t.match(i)[1],t=unescape(t));var e="url:"+(t=t.trim()),n=FilterListUtil.checkUrlForExistingFilterList(t);n?CustomFilterListUploadUtil._updateExistingFilterList(n):/^https?\:\/\/[^\<]+$/.test(t)?CustomFilterListUploadUtil._performUpload(t,e):alert(translate("failedtofetchfilter")),$("#txtNewSubscriptionTitle").hide(),$("#txtNewSubscriptionUrl").val("")})),$("#txtNewSubscriptionUrl").keypress((function(t){13===t.keyCode&&(t.preventDefault(),$("#btnNewSubscriptionUrl").click())}))},$((function(){var t=backgroundPage.getAllSubscriptionsMinusText();for(var i in FilterListUtil.prepareSubscriptions(t),filterListSections){new SectionHandler(filterListSections[i],i).initSection()}LanguageSelectUtil.init(),CustomFilterListUploadUtil.bindControls(),FilterNotifier.addListener(onFilterChangeHandler),FilterListUtil.updateSubscriptionInfoAll(),window.setInterval((function(){FilterListUtil.updateSubscriptionInfoAll()}),1e4),$("#btnUpdateNow").click((function(){$(this).prop("disabled",!0),backgroundPage.updateFilterLists(),setTimeout((function(){$("#btnUpdateNow").prop("disabled",!1)}),3e5)})),$("#btnShowLinks").click((function(){$(".linkToList").fadeIn("slow"),$("#btnShowLinks").remove()})),delayedSubscriptionSelection&&startSubscriptionSelection.apply(null,delayedSubscriptionSelection)}));