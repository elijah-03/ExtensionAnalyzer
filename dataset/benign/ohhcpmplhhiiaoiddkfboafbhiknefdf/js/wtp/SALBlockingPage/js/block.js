var $,l10nStr={},productName="Trend Micro Security",productShortName="",blockedUrl=function(){var e,t=getUrlParam("url_session_id");return e=t&&SendMailtoPlugToolbar('{"params":{"actionID":20009,"paramsIn":{"url_session_id":"'+t+'"}}}')||getUrlParam("url"),decodeURIComponent(e)}(),blockScriptRedirectURL=null==getUrlParam("script_redirect")?"":getUrlParam("script_redirect"),pageType=function(){var e=getUrlParam("category_group");return e&&-1!==e.split(":").indexOf("2B")?"fake":"malicious"}(),STRINGS={address:blockedUrl,lbl_title_bar:GetL10NString("lbl_title_bar").replace("%TiProductName%",decodeURI(getUrlParam("product_name_ti"))),lbl_page_title:GetL10NString("lbl_page_title").replace("%TiProductName%",decodeURI(getUrlParam("product_name_ti"))),lbl_status:GetL10NString("lbl_status_"+pageType),lbl_address:GetL10NString("lbl_address"),lbl_desc:GetL10NString("lbl_desc_"+pageType),lbl_close_window_desc:GetL10NString("lbl_close_window_desc"),lbl_handler_desc:GetL10NString("lbl_handler_desc"),lbl_review:GetL10NString("lbl_review"),lbl_siteowner:GetL10NString("lbl_siteowner"),txt_email_placeholder:GetL10NString("txt_email_placeholder"),lbl_validate_email:GetL10NString("lbl_validate_email"),txt_description_placeholder:GetL10NString("txt_description_placeholder"),lbl_add_approved_list:GetL10NString("lbl_add_approved_list"),lbl_btn_view_anyway:GetL10NString("lbl_btn_view_anyway"),lbl_copyright:GetL10NString("lbl_copyright"),lnk_learn_more:GetL10NString("lnk_learn_more")},CONFIG={url:blockedUrl,url_continue:blockedUrl,lang:getUrlParam("locale")};function getStyle(e,t){var a=$("#"+e);if(a&&a.currentStyle)var l=a.currentStyle[t];else window.getComputedStyle&&(l=document.defaultView.getComputedStyle(a,null).getPropertyValue(t));return l}function isExistTitanium(e){return"Toolbar"===e||"Coexist"===e||"Promoter"===e}function bindClick(e,t){$(e)&&($(e).onclick=t)}function init(){document.getElementsByTagName("body")[0].className=CONFIG.lang,window.fillInBlockingContent&&window.fillInBlockingContent();var e=$("#lbl_status"),t=$("#status_icon");"fake"===pageType?(e.className=e.className+" sign_warning",t.className=t.className+" sign_warning"):(e.className=e.className+" sign_dangerous",t.className=t.className+" sign_dangerous"),localizePageContent(STRINGS),$("#btn_try_another").setAttribute("href",blockedUrl),$("#btn_try_another").onclick=takeAction,$("#lbl_handler_desc").onclick=toggleExtraOptions,$("#review").onclick=toggleFeedback,$("#chk_siteowner").onclick=toggleEmail,$("#review").checked=$("#chk_siteowner").checked=$("#add_approved_list").checked=!1;var a=$("#txt_email_placeholder");a.onfocus=focusEmailEvent,a.onblur=blurEmailEvent,a.className=a.className+" placeholder",a.value=a.getAttribute("placeholder");var l=$("#txt_description_placeholder");l.onfocus=focusDescEvent,l.onblur=blurDescEvent,l.className=l.className+" placeholder",l.value=l.getAttribute("placeholder"),document.onselectstart=function(){return!1},window.browser.storage.local.get({license:{},arch:""},e=>{const t=e.arch.toLowerCase().includes("arm");var a=!1;void 0!==e.license.TiBuyNowLink&&""!==e.license.TiBuyNowLink&&(a=!0),a&&!t&&(localizeAdvertisementContent(l10nStr),$("#advertisement").className=$("#advertisement").className.replace(/hidden/gi,""),$("#buy_now").setAttribute("href",e.license.TiBuyNowLink),bindClick("#buy_now",()=>{window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_SAL_BLOCKING_BUTTON_BUYNOW",value:JSON.stringify({click:1})}})}))});let r=getUrlParam("category_group");window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_SAL_BLOCKING_PAGE_PAGEVIEW",value:JSON.stringify({host:new URL(blockedUrl).hostname,category:r})}})}function localizePageContent(e){for(var t in e)if("lbl_title_bar"==t)document.title=e.lbl_title_bar;else if("alt_"==t.substr(0,4))insertString(t,e[t],"alt");else if("ttl_"==t.substr(0,4))insertString(t,e[t],"alt");else if("lnk_"==t.substr(0,4))insertString(t,e[t],"href");else if(t.match(/txt_\w*_placeholder/))insertString(t,e[t],"placeholder");else{if("msg_for_submission"==t)break;insertString(t,e[t])}}function localizeAdvertisementContent(e){for(var t in e)0===t.indexOf("promotion_")?insertString(t,""===productShortName?e[t].replace(/%TiShortProductName%/,productName):e[t].replace(/%TiShortProductName%/,productShortName)):"buy_now"==t&&insertString(t,e[t])}function insertString(e,t,a){document.getElementById&&$("#"+e)&&(void 0===a?$("#"+e).innerHTML=t:$("#"+e).setAttribute(a,t))}function takeAction(){var e=$("#add_approved_list").checked,t=$("#review").checked,a=CONFIG.url_continue,l="",r=document.createElement("a");if(r.href=a,l=e?'{"params":{"actionID":20016,"paramsIn":{"url":"'+r.href+'","hostname":"'+r.hostname+'","port":'+(r.port||443)+',"scriptRedirect":"'+blockScriptRedirectURL+'"}}}':'{"params":{"actionID":20015,"paramsIn":{"url":"'+r.href+'","hostname":"'+r.hostname+'","port":'+(r.port||443)+',"scriptRedirect":"'+blockScriptRedirectURL+'"}}}',SendMailtoPlugToolbar(l),t){var i=$("#txt_email_placeholder").value.substr(0,63),n=$("#txt_description_placeholder").value.substr(0,1023);l='{"params":{"actionID":20012,"paramsIn":{"url":"'+r.href+'","email":"'+i+'","desc":"'+n+'"}}}',SendMailtoPlugToolbar(l)}return window.browser.runtime.sendMessage({action:TB_ACTIONS.FEED_UBM,params:{event:"WTP_SAL_BLOCKING_BUTTON_VIEW_ANYWAY",value:JSON.stringify({addApproved:e,review:t,host:new URL(blockedUrl).hostname})}}),!1}function toggleExtraOptions(){var e=$("#more_actions"),t=$("#handler");return e.className.indexOf("hidden")>-1?(e.className=e.className.replace(/hidden/gi,""),t.className=t.className.replace(/ico_collapse/gi,"ico_expand")):(e.className=e.className+" hidden",t.className=t.className.replace(/ico_expand/gi,"ico_collapse")),!1}function toggleFeedback(){var e=$("#feedback");this.checked?e.className=e.className.replace(/hidden/gi,""):e.className=e.className+" hidden"}function toggleEmail(){var e=$("#txt_email_placeholder"),t=$("#txt_description_placeholder"),a=$("#lbl_validate_email");this.checked?(e.removeAttribute("disabled"),t.removeAttribute("disabled")):(e.setAttribute("disabled","disabled"),t.setAttribute("disabled","disabled"),a.className=a.className+" hidden")}function focusEmailEvent(){var e=$("#lbl_validate_email");this.value===this.getAttribute("placeholder")&&(this.value=""),this.className=this.className.replace(/placeholder/gi,""),e.className=e.className+" hidden"}function blurEmailEvent(){var e=$("#lbl_validate_email"),t=$("#txt_email_placeholder"),a=t.value,l=t.getAttribute("placeholder");if(a===l||""===a||a!==l&&!validateEmail(a))return t.value=l,t.className=t.className+" placeholder",e.className=e.className.replace(/hidden/gi,""),!1}function validateEmail(e){return/^([a-zA-Z0-9_\-]+)([a-zA-Z0-9_\.\-]*)@([a-zA-Z0-9_\-]+)\.([a-zA-Z0-9_\.\-]*)([a-zA-Z]{2,})$/.test(e)}function focusDescEvent(){this.value===this.getAttribute("placeholder")&&(this.value=""),this.className=this.className.replace(/placeholder/gi,"")}function blurDescEvent(){""===this.value&&(this.value=this.getAttribute("placeholder"),this.className=this.className+" placeholder")}function setCookie(e,t){var a=new Date;a.setDate(a.getDate()+90),document.cookie=e+"="+escape(t)+";expires="+a.toGMTString()}function getCookie(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}void 0===$&&($=function(e){return document.getElementById(e.replace(/#/gi,""))}),window.browser.tabs.getCurrent(function(e){e.id,window.browser.storage.local.get(["titanium_name","titanium_shortname","mode","locale"],function(e){isExistTitanium(e.mode)&&(productName=e.titanium_name,productShortName=e.titanium_shortname);var t="_locales/"+e.locale+"/urlfCredscore.json";fetch(window.browser.runtime.getURL(t)).then(e=>e.json()).then(e=>{l10nStr=e,init()})})});