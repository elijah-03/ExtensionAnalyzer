var SAFARI=!1,backgroundPage=ext.backgroundPage.getWindow(),require=backgroundPage.require;with(require("filterClasses"))this.Filter=Filter,this.WhitelistFilter=WhitelistFilter;with(require("subscriptionClasses"))this.Subscription=Subscription,this.SpecialSubscription=SpecialSubscription,this.DownloadableSubscription=DownloadableSubscription;with(require("filterValidation"))this.parseFilter=parseFilter,this.parseFilters=parseFilters;var FilterStorage=require("filterStorage").FilterStorage,FilterNotifier=require("filterNotifier").FilterNotifier,Prefs=require("prefs").Prefs,Synchronizer=require("synchronizer").Synchronizer,Utils=require("utils").Utils,NotificationStorage=require("notification").Notification;function loadOptions(){backgroundPage&&"function"!=typeof backgroundPage.getSettings&&window.setTimeout((function(){window.location.reload()}),50),backgroundPage&&"function"==typeof backgroundPage.getSettings&&(optionalSettings=backgroundPage.getSettings());var t=$.cookie("activetab");if(window.location&&window.location.search){var i=parseUri.parseSearch(window.location.search);i&&i.tab&&(t=i.tab)}backgroundPage.recordGeneralMessage("options_opened",void 0,{tab:t}),$("#tabpages").tabs({active:t,activate:function(t,i){$.cookie("activetab",i.newTab.index(),{expires:10})},beforeLoad:function(t,i){var e=i.tab.index();i.tab.data("loaded")&&3!==e?t.preventDefault():i.jqXHR.success((function(){i.tab.data("loaded",!0)}))},load:function(t,i){localizePage(),optionalSettings&&!optionalSettings.show_advanced_options&&$(".advanced").hide(),SAFARI&&$(".chrome-only").hide(),SAFARI||$(".safari-only").hide(),i.tab[0].dataset.scripts.split(" ").forEach((function(t){var i=document.createElement("script");i.src=t,document.body.appendChild(i)}))}}).show()}var language=navigator.language.match(/^[a-z]+/i)[0];function rightToLeft(){"ar"===language||"he"===language?($(window).resize((function(){$(".social").is(":hidden")?($("#translation_credits").css({margin:"0px 50%",width:"350px"}),$("#paymentlink").css({margin:"0px 50%",width:"350px"}),$("#version_number").css({margin:"20px 50%",width:"350px"})):($("#translation_credits").css("right","0px"),$("#paymentlink").css("right","0px"),$("#version_number").css({right:"0px",padding:"0px"}))})),$("li").css("float","right"),$("#small_nav").css({right:"initial",left:"45px"}),$(".ui-tabs .ui-tabs-nav li").css("float","right")):$(".ui-tabs .ui-tabs-nav li").css("float","left")}function showMiniMenu(){$("#small_nav").click((function(){$(".ui-tabs-nav").is(":hidden")?($(".ui-tabs .ui-tabs-nav li").css("float","none"),$(".ui-tabs-nav").fadeIn("fast"),"ar"!==language&&"he"!==language||$(".ui-tabs-nav").css({right:"auto",left:"40px"})):$(".ui-tabs-nav").fadeOut("fast")})),$(window).resize((function(){$(".ui-tabs-nav").is(":hidden")&&$("#small_nav").is(":hidden")?("ar"===language||"he"===language?($(".ui-tabs .ui-tabs-nav li").css("float","right"),$(".ui-tabs-nav").css({right:"auto",left:"auto"})):$(".ui-tabs .ui-tabs-nav li").css("float","left"),$(".ui-tabs-nav").show()):$("#small_nav").is(":visible")&&$(".ui-tabs-nav").hide()}))}function displayVersionNumber(){try{var t=new XMLHttpRequest;t.open("GET",chrome.extension.getURL("manifest.json"),!0),t.onreadystatechange=function(){if(4==this.readyState){var t=JSON.parse(this.responseText);$("#version_number").text(translate("optionsversion",[t.version]))}},t.send()}catch(t){}}function displayTranslationCredit(){if("en"!=navigator.language.substring(0,2)){var t=[],i=new XMLHttpRequest;i.open("GET",chrome.extension.getURL("translators.json"),!0),i.onload=function(){var i=JSON.parse(this.responseText),e=navigator.language;for(var a in i)if(SAFARI){if(e.substring(0,2)===a)for(var n in i[a].translators){s=i[a].translators[n].credit;t.push(" "+s)}else for(var n in i[a].translators)if(a===e){s=i[e].translators[n].credit;t.push(" "+s)}}else if(a===e)for(var n in i[a].translators){var s=i[a].translators[n].credit;t.push(" "+s)}else for(var n in i[a].translators){if(a===(e=e.toLowerCase())){var s=i[e].translators[n].credit;t.push(" "+s)}}$("#translator_credit").text(translate("translator_credit")),$("#translator_names").text(t.toString())},i.send()}}backgroundPage.ext.storage.get("userid",(function(t){t.userid}));var isSelectorFilter=function(t){return/\#\@?\#./.test(t)},isSelectorExcludeFilter=function(t){return/\#\@\#./.test(t)},isWhitelistFilter=function(t){return/^\@\@/.test(t)},optionalSettings={};$(document).ready((function(){loadOptions(),rightToLeft(),showMiniMenu(),displayVersionNumber(),displayTranslationCredit(),localizePage()}));var delayedSubscriptionSelection=null;function startSubscriptionSelection(t,i){if(!document.getElementById("language_select")||"undefined"==typeof FilterListUtil||null===FilterListUtil||"undefined"==typeof CustomFilterListUploadUtil||null===CustomFilterListUploadUtil)return $("#tabpages").tabs("option","active",1),void(delayedSubscriptionSelection=[t,i]);var e=translate("subscribeconfirm",t);if(window.confirm(e)){var a=FilterListUtil.checkUrlForExistingFilterList(i);a?CustomFilterListUploadUtil._updateExistingFilterList(a):/^https?\:\/\/[^\<]+$/.test(i)?CustomFilterListUploadUtil._performUpload(i,"url:"+i,t):alert(translate("failedtofetchfilter"))}}function onMessage(t){if(("app.listen"===t.type||"app.respond"===t.type)&&"addSubscription"===t.action&&t.args&&t.args.length>0){var i=t.args[0];startSubscriptionSelection(i.title,i.url)}}ext.onMessage.addListener(onMessage),ext.backgroundPage.sendMessage({type:"app.listen",filter:["addSubscription"]});