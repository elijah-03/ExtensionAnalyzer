
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d5825c19-169d-5196-90fa-76eeadd9a3fa")}catch(e){}}();
import{a as b}from"/chunks/chunk-ELSMRAMV.js";import{a as w}from"/chunks/chunk-OK4UQCTS.js";import{X as v,b as f,l as L,n as y}from"/chunks/chunk-PTEF4S3V.js";var P=s=>{let[e]=s.split("?");return`PortOpener: ${e}`},k=(s,e,t)=>{let n=x(s,e);return e?.reconnect&&R(n,t),n},x=(s,e,t)=>S(s,e||{},t),S=(s,e,t)=>{let{port:n,portId:r}=D(s,e,t),a=P(n.name);`${a}`;let g=I(n);n.onMessage.addListener(g);let l=()=>{n.onMessage.removeListener(g),n.onDisconnect.removeListener(l)};n.onDisconnect.addListener(l);let c=new WeakMap;return{name:`${s.toString()}/${r.toString()}`,disconnect:()=>n.disconnect(),postMessage:i=>{`${a}${i.type}`,n.postMessage(i)},onMessage:{addListener:i=>{let d=(o,m)=>{o.type!=="pm-health-check-request"&&i(o,m.name)};n.onMessage.addListener(d),c.set(i,d)},removeListener:i=>{let d=c.get(i);n.onMessage.removeListener(d),c.delete(i)}},onDisconnect:{addListener:i=>{n.onDisconnect.addListener(i)},removeListener:i=>{n.onDisconnect.removeListener(i)}},getConfig:()=>({id:r,reqId:e.reqId,type:s})}},R=(s,e)=>{let t=P(s.name),n=new Map,r=new Map,a={...s.onMessage},g={...s.onDisconnect},l=o=>{`${t}`,a.addListener(o),n.set(o,o)},c=o=>{`${t}`,a.removeListener(o),n.delete(o)},h=o=>{`${t}`,g.addListener(o),r.set(o,o)},i=o=>{`${t}`,g.removeListener(o),r.delete(o)},d=o=>{if(!o.persisted)return;window.removeEventListener("pageshow",d),`${t}`;let m=s.getConfig(),u=x(m.type,{reconnect:!0,reqId:m.reqId},m.id);R(u,e);for(let p of n.keys())s.onMessage.removeListener(p),u.onMessage.addListener(p);for(let p of r.keys())s.onDisconnect.removeListener(p),u.onDisconnect.addListener(p);e?.(u)};s.onMessage.addListener=l,s.onMessage.removeListener=c,s.onDisconnect.addListener=h,s.onDisconnect.removeListener=i,window.addEventListener("pageshow",d)},D=(s,e,t)=>{let n=v(),r={};e.reqId&&(r.reqId=e.reqId.str),e.reconnect&&(r.reconnect=`${e.reconnect}`),t&&(r.reconnectId=t.str);let a="?"+new URLSearchParams(r).toString();return{port:chrome.runtime.connect({name:`${s.str}/${n.str}${a.length>1?a:""}`}),portId:n}},I=s=>e=>{let t=P(s.name);if(e.type==="error"){console.warn(`${t} received error: "${e.data.loggableReason}"`);return}if(e.type!=="pm-health-check-request"){`${t}${e.type}`;return}if(e.type==="pm-health-check-request"){`${t}${e.type}`,s.postMessage({type:"pm-health-check-response",data:{windowClosed:window.closed,id:e.data.id}});return}f(e,y`message`)};function q(s){try{return s?.useChrome||browser?.runtime===void 0?async e=>T(e):async e=>browser.runtime.sendMessage(e)}catch{return async t=>T(t)}}async function $(s,e){let n=await q(e)(s).catch(r=>{let a=r instanceof Error?r.message:String(r);if(a.includes("Receiving end does not exist"))`${s.name}`;else if(a.includes("The message port closed"))`${s.name}`;else if(!a)`${s.name}`;else throw new Error(`Unhandled error response received for message <${s.name}>`)});if(w(n))switch(n.type){case"Success":return n.data;case"Error":throw new Error(n.message??`Error response received for message <${s.name}>`)}if(n)throw new Error(`Unknown response type received for message <${s.name}>`);return n}async function T(s){return new Promise((e,t)=>{chrome.runtime.sendMessage(s,n=>{if(n?.type==="Success")e(n);else{let r=chrome.runtime.lastError;t(new Error(r?.message))}})})}var M=class{port;portType;registeredHandlers;constructor(e){e&&(this.portType=e,this.setupPort(e),this.registeredHandlers=[])}request=async e=>$(e);setupRegisteredHandler=(e,t)=>{function n(r,a,g){if(r.name&&r.name===e){let l=new b("WebExtListener handler registration");return new Promise(c=>c(t(r.data))).then(g).catch(c=>{console.warn(`Caught error handling <${r.name}> message`),l.error(c)}),!0}return!1}return n};on=(e,t)=>{let n=this.setupRegisteredHandler(e,t);return this.registeredHandlers=this.registeredHandlers??[],this.registeredHandlers.push(n),chrome.runtime.onMessage.addListener(n),n};setupPort=e=>{this.port=k(L.assertLogSafe(e),{reconnect:!0},this.onPortReconnect),this.port.onMessage.addListener(this.onPortMessage)};onPortReconnect=e=>{this.port=e};onPortMessage=({type:e,data:t})=>{if(e!=="targeted-inline-message")return;(this.registeredHandlers??[]).forEach(r=>{let a=()=>{`${t.message.name}`};r(t.message,void 0,a)})};off=(e,t)=>{chrome.runtime.onMessage.removeListener(t)}};function j(s,e={targetParent:!1}){return{name:"relay-message-to-frames",data:{message:JSON.stringify(s),targetParent:e.targetParent}}}function z(s){return new M(s)}export{k as a,j as b,z as c};

//# debugId=d5825c19-169d-5196-90fa-76eeadd9a3fa
