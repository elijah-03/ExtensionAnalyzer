function selector_from_elm(t){for(var e=["id","class","name","src","href","data"],i=[t.prop("nodeName")],a=0;a<e.length;a++){var l=e[a],n=t.attr(l);n&&i.push("["+l+"="+JSON.stringify(n)+"]")}return i.join("")}function BlacklistUi(t,e){this._cancelled=!0,this._current_step=0,this._callbacks={cancel:[],block:[]},this._clicked_item=t,this._advanced_user=e}BlacklistUi.prototype.cancel=function(t){this._callbacks.cancel.push(t)},BlacklistUi.prototype.block=function(t){this._callbacks.block.push(t)},BlacklistUi.prototype._fire=function(t,e){for(var i=this._callbacks[t],a=0;a<i.length;a++)i[a](e)},BlacklistUi.prototype._onClose=function(){1==this._cancelled&&(this._ui_page1.empty().remove(),this._ui_page2.empty().remove(),$(".adblock-ui-stylesheet").remove(),this._chain.current().show(),this._fire("cancel"))},BlacklistUi.prototype.handle_change=function(){this._last.show(),this._chain.current().hide(),this._last=this._chain.current(),this._redrawPage1(),this._redrawPage2(),this._preview(selector_from_elm(this._chain.current()))},BlacklistUi.prototype.show=function(){if(null==this._clicked_item){var t=new ClickWatcher,e=this;return t.cancel((function(){e._preview(null),e._fire("cancel")})),t.click((function(t){e._clicked_item=t,e.show()})),this._preview("*"),void t.show()}this._chain=new ElementChain(this._clicked_item),this._ui_page1=this._build_page1(),this._ui_page2=this._build_page2(),this._last=this._chain.current(),this._chain.change(this,this.handle_change),this._chain.change(),this._redrawPage1(),this._ui_page1.dialog("open")},BlacklistUi.prototype._build_page1=function(){var t=this,e=$("<div>").append(translate("sliderexplanation")).append("<br/>").append("<input id='slider' type='range' min='0' value='0'/>").append("<div id='selected_data'></div>"),i={},a=translate("buttonlooksgood");i[a]={text:a,class:"adblock_default_button",click:function(){t._cancelled=!1,t._ui_page1.dialog("close"),t._cancelled=!0,t._redrawPage2(),t._ui_page2.dialog("open")}},i[translate("buttoncancel")]=function(){t._ui_page1.dialog("close")},e.dialog({dialogClass:"adblock-blacklist-dialog",position:[50,50],width:410,autoOpen:!1,title:translate("slidertitle"),buttons:i,open:function(){t._current_step=1,t._preview(selector_from_elm(t._chain.current()))},close:function(){t._preview(null),t._onClose()}}),e.dialog("widget").css("position","fixed"),changeTextDirection($("body .adblock-blacklist-dialog"));for(var l=0,n=this._chain.current();n.length>0&&"BODY"!=n[0].nodeName;)n=n.parent(),l++;return $("#slider",e).attr("max",Math.max(l-1,1)).on("input change",(function(){t._chain.moveTo(this.valueAsNumber)})),e},BlacklistUi.prototype._build_page2=function(){var t=this,e=$("<div>"+translate("blacklisteroptions1")+"<div><div id='adblock-details'></div><br/><div id='count'></div></div><div><br/>"+translate("blacklisternotsure")+"<br/><br/></div><div style='clear:left; font-size:smaller; margin-top: -20px;'><br/>"+translate("blacklisterthefilter")+"<div style='margin-left:15px;margin-bottom:15px'><div><div id='summary'></div><br/><div id='filter_warning'></div></div></div></div></div>"),i={},a=translate("buttonblockit");return i[a]={text:a,class:"adblock_default_button",click:function(){var e=$("#summary",t._ui_page2).text();if(e.length>0){var i=getUnicodeDomain(document.location.hostname)+"##"+e;BGcall("addCustomFilter",i,(function(){block_list_via_css([e]),t._ui_page2.dialog("close"),t._fire("block")}))}else alert(translate("blacklisternofilter"))}},t._advanced_user&&(i[translate("buttonedit")]=function(){var e=getUnicodeDomain(document.location.hostname)+"##"+$("#summary",t._ui_page2).text();t._ui_page2.dialog("close"),(e=prompt(translate("blacklistereditfilter"),e))&&(/\#\#/.test(e)||(e="##"+e),BGcall("parseFilter",e,(function(i){i.filter?BGcall("addCustomFilter",i.filter.text,(function(i){i?alert(translate("blacklistereditinvalid1",i)):(block_list_via_css([e.substr(e.indexOf("##")+2)]),t._fire("block"))})):i.error&&i.error.type&&alert(translate("blacklistereditinvalid1",i.error.type))})))}),i[translate("buttonback")]=function(){t._cancelled=!1,t._ui_page2.dialog("close"),t._cancelled=!0,t._redrawPage1(),t._ui_page1.dialog("open")},i[translate("buttoncancel")]=function(){t._ui_page2.dialog("close")},e.dialog({dialogClass:"adblock-blacklist-dialog ui-page-2",position:[50,50],width:500,autoOpen:!1,title:translate("blacklisteroptionstitle"),buttons:i,open:function(){t._current_step=2,t._preview($("#summary",t._ui_page2).text())},close:function(){t._preview(null),t._onClose()}}),e.dialog("widget").css("position","fixed"),changeTextDirection($("body .adblock-blacklist-dialog")),e},BlacklistUi.prototype._redrawPage1=function(){var t=this._chain.current(),e=$("#selected_data",this._ui_page1);e.html("<b>"+translate("blacklisterblockedelement")+"</b><br/>"),e.append($("<i></i>").text("<"+t[0].nodeName));var i=["id","class","name","src","href","data"];for(var a in i){var l=BlacklistUi._ellipsis(t.attr(i[a]));l&&e.append("<br/>").append($("<i></i>").text(i[a]+'="'+l+'"').css("margin-left","10px"))}e.append("<i>&nbsp;&gt;</i>")},BlacklistUi.prototype._makeFilter=function(){var t=[],e=this._chain.current(),i=$("#adblock-details",this._ui_page2);if($("input[type='checkbox']#cknodeName",i).is(":checked")&&(t.push(e.prop("nodeName")),"IFRAME"==e.prop("nodeName")&&""==e.attr("id")))for(var a=e.parent();"BODY"!=a.prop("nodeName");)t.unshift(a.prop("nodeName")+" "),a=a.parent();var l,n=["id","class","name","src","href","data"];for(var r in n)$("input[type='checkbox']#ck"+n[r],i).is(":checked")&&t.push("["+n[r]+"="+JSON.stringify(e.attr(n[r]))+"]");return 0==t.length?l=translate("blacklisterwarningnofilter"):1==t.length&&$("input[type='checkbox']#cknodeName",i).is(":checked")&&(l=translate("blacklisterblocksalloftype",[t[0]])),$("#filter_warning",this._ui_page2).css("display",l?"block":"none").text(l),t.join("")},BlacklistUi.prototype._redrawPage2=function(){var t=this._chain.current(),e=this,i=$("#adblock-details",e._ui_page2),a=$("#summary",e._ui_page2);function l(){var t=e._makeFilter();a.text(t);var i=$(t).not(".ui-dialog").not(".ui-dialog *").length;$("#count",e._ui_page2).html("<center>"+(1==i?translate("blacklistersinglematch"):translate("blacklistermatches",["<b>"+i+"</b>"]))+"</center>")}i.empty();for(var n=["nodeName","id","class","name","src","href","data"],r=0;r<n.length;r++){var c=n[r],o="nodeName"==c?t.prop("nodeName"):t.attr(c),s=BlacklistUi._ellipsis(o);if(s){var d=!0;"src"!=c&&"href"!=c&&"data"!=c||(d=1==$("input",i).length);var p=$("<i></i>").text(s),_=$("<label></label>").html(translate("blacklisterattrwillbe",["<b>"+("nodeName"==c?translate("blacklistertype"):c)+"</b>","<i></i>"])).attr("for","ck"+c);$("i",_).replaceWith(p);var u=$("<div></div>").append("<input type=checkbox "+(d?'checked="checked"':"")+" id=ck"+c+" /> ").append(_);u.find("input").change((function(){l(),e._preview($("#summary",e._ui_page2).text())})),i.append(u)}}l()},BlacklistUi.prototype._preview=function(t){if($("#adblock_blacklist_preview_css").remove(),t){var e=document.createElement("style");e.type="text/css",e.id="adblock_blacklist_preview_css";var i="body .adblock-blacklist-dialog";switch(this._current_step){case 0:e.innerText="body .adblock-highlight-node,";break;case 1:e.innerText=i+", "+i+" * {opacity:1!important;} ",e.innerText+=t+" {opacity:.1!important;} "+t+" "+t+" {opacity:1!important;}";break;case 2:e.innerText=i+" input, "+i+" button {display:inline-block!important;} "+i+".ui-page-2, "+i+" div:not(#filter_warning), "+i+" .ui-icon, "+i+" a, "+i+" center {display:block!important;} "+i+" #adblock-details, "+i+" span, "+i+" b, "+i+" i {display:inline!important;} ",e.innerText+=t+" {display:none!important;}"}e.innerText+=" "+i+" {z-index:2147483647!important;}",document.documentElement.appendChild(e)}},BlacklistUi._ellipsis=function(t,e){if(null==t)return t;null==e&&(e=50);var i=e/2-2;return(t=getUnicodeUrl(t)).length>e&&(t=t.substring(0,i)+"..."+t.substring(t.length-i)),t};