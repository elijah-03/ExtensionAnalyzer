class Content{constructor(){this.storage=STORAGE,this.pr=null,this.initHandlers(),this.initStorage(),this.onMessage(),this.onContentMessage()}initHandlers(){const a=$(document.body);a.on("click",".mtz-modal-item",a=>this.modalItemClick(a)),a.on("click",".mtz-modal-close-icon",a=>this.closeModal(a)),a.on("click",".mtz-modal-overlay",a=>this.closeModal(a))}initStorage(){chrome.storage.sync.get(this.storage,a=>{this.storage=a,this.initProvider()})}initProvider(){this.pr=location.href.includes("facebook.com")?new FBProvider:location.href.includes("vimeo.com")?new VMProvider:location.href.includes("dailymotion.com")?new DMProvider:location.href.includes("instagram.com")?new INProvider:location.href.includes("twitter.com")?new TWProvider(this.storage.config.twToken):location.href.includes("deezer.com")?new DZProvider:location.href.includes("spotify.com")?new SFProvider:location.href.includes("soundcloud.com")?new SCProvider:location.href.includes("music.yandex.")?new YAProvider:location.href.includes("mail.ru/music")?new MRProvider:location.href.includes("vk.com")?new VKProvider:location.href.includes("rt.pornhub.com")?new PHProvider:location.href.includes("xvideos.com")?new XVProvider:location.href.includes("tiktok.com")?new TTProvider:location.href.includes("youtube.com")?null:new XXProvider,this.pr&&this.pr.run&&this.pr.run()}onMessage(){chrome.runtime.onMessage.addListener((a,b,c)=>("getVideo"===a.action&&c(this.pr.videos),"openAppInSidebar"===a.action&&this.openAppInSidebar(),"sideBarUpdated"===a.action&&this.openSideBarUpda,"searchResult"===a.action&&this.searchHandler(a),"getItems"===a.action&&(this.pr.getItems?this.pr.getItems(c):c([])),"getYAAudioSrc"===a.action&&this.pr.getYAAudioSrc(a.aId).then(c),"getVKAudioSrc"===a.action&&this.pr.getVKAudioSrc(a.item).then(c).catch(()=>c(null)),"removeExistingPopup"===a.action&&this.checkPopupExisting(c),!0))}onContentMessage(){document.addEventListener("loadymsg",a=>{chrome.runtime.sendMessage({action:"requestPermission"},b=>{b?chrome.runtime.sendMessage(a.detail):alert("You must allow download files")})})}openAppInSidebar(){let a=document.getElementById("vlc-root");a?(a.classList.remove("vlc-show"),setTimeout(()=>a.remove())):(a=document.createElement("div"),a.id="vlc-root",document.body.appendChild(a),window.runVlcApp(),a.classList.add("vlc-show"))}searchHandler({aId:a,items:b}){if(b&&1==b.length){const c={action:"download",url:b[0].url,filename:clearFilename(b[0].name)+".mp3",aId:a};chrome.runtime.sendMessage(c)}else b&&1<b.length&&this.renderModal(a,b)}checkPopupExisting(a){let b=document.getElementById("vlc-root");b&&(b.classList.remove("vlc-show"),setTimeout(()=>b.remove())),a()}renderModal(a,b){const c=b.map(a=>`<div class="mtz-modal-item" url="${a.url}">${a.name}</div>`).join("");$(`
        <div class="mtz-modal-overlay ${this.pr.code}" aId="${a}">
            <div class="mtz-modal">
                <div class="mtz-modal-close-icon"></div>
                <div class="mtz-modal-body">${c}</div>
            </div>
        </div>`).appendTo(document.body)}closeModal(a){$(a.target).closest(".mtz-modal-overlay").remove()}modalItemClick(a){const b=$(a.target).attr("url"),c=$(a.target).text(),d=clearFilename(c)+".mp3";chrome.runtime.sendMessage({action:"download",url:b,filename:d})}}window.ContentScript=new Content;