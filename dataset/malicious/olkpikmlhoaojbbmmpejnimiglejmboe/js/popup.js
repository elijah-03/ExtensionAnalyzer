!function(){function a(a){function b(a){k=!0;var b=this.dataset.pos;i.forEach(function(a){a.dataset.pos<=b?(a.querySelector(".empty").style.display="none",a.querySelector(".filled").style.display="inline-block"):(a.querySelector(".empty").style.display="inline-block",a.querySelector(".filled").style.display="none")})}function d(a){f||(k=!1,setTimeout(function(){k||i.forEach(function(a){a.querySelector(".empty").style.display="inline-block",a.querySelector(".filled").style.display="none"})},100))}function e(a){f=!0;var h=this.dataset.pos;i.forEach(function(a){a.dataset.pos<=h&&(a.querySelector(".empty").style.display="none",a.querySelector(".filled").style.display="inline-block")}),i.forEach(function(a){a.removeEventListener("mouseover",b),a.removeEventListener("mouseout",d),a.removeEventListener("click",e)}),j.innerText=chrome.i18n.getMessage("your_rate"),chrome.runtime.sendMessage({action:"setPopupRate",value:h}),h>3&&!g?(g=!0,D.trackEvent("user_popup_rate",{value:h}),chrome.tabs.create({url:"https://chrome.google.com/webstore/detail/instagram-downloader/"+chrome.runtime.id+"/reviews"})):c("rate",h)}if(!a){var f=!1,g=!1,h=F.querySelector(".rating_ask");h.style.display="flex";var i=h.querySelectorAll(".stars a"),j=h.querySelector(".ext_text"),k=!1;i&&i.forEach&&(i.forEach(function(a){a.querySelector(".empty").style.display="inline-block",a.querySelector(".filled").style.display="none"}),j.innerText=chrome.i18n.getMessage("rate_us_popup")+":",i.forEach(function(a){a.addEventListener("mouseover",b),a.addEventListener("mouseout",d),a.addEventListener("click",e)}))}}function b(a,b){var c=a.url,d=a.filename;chrome.downloads.download({url:c,filename:d},function(e){if("undefined"==typeof e){var f=a.filename.match(/([\w_]+)(\.\w{3,4})$/);f=f&&f[0],f?(d=f.substr(f.length-32),chrome.downloads.download({url:c,filename:d},function(a){"undefined"==typeof a&&"function"==typeof b&&b()})):"function"==typeof b&&b()}else"function"==typeof b&&b(e)})}function c(b,c){function d(a){var b=this.value.length;b>=800&&a.preventDefault(),b>600?(q.style.display="inline-block",s.innerText=800-b):q.style.display="none"}function e(a){return a.preventDefault(),!1}function f(){p.style.display="none",o.classList.remove("error")}function g(a){var b=n.value,d=o.value;if(d&&!d.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))return p.style.display="inline-block",void o.classList.add("error");if(Y="",Z=!1,k.style.visibility="hidden",k.style.opacity="0",k.style.display="none",i(),j)var e={msg:b,email:d},f="user_report_problem";else e={value:c,msg:b,email:d},f="user_popup_rate";D.trackEvent(f,e)}function h(){Y="",Z=!1,k.style.visibility="hidden",k.style.opacity="0",k.style.display="none",i(),a(),chrome.runtime.sendMessage({action:"setPopupRate",value:0})}function i(){l.removeEventListener("click",g),m.removeEventListener("click",h),n.removeEventListener("input",d),o.removeEventListener("input",f)}var j="report"==b;Z=j;var k=document.querySelector(".comment-wrapper");k.style.display="block",k.style.visibility="visible",k.style.opacity="1";var l=k.querySelector(".send_btn"),m=k.querySelector(".cancel_btn"),n=k.querySelector("textarea"),o=k.querySelector("#email_input"),p=k.querySelector(".not_valid_email"),q=k.querySelector(".symbols_left"),r=q.querySelector(".text"),s=q.querySelector(".count");l.innerText=chrome.i18n.getMessage("send").toUpperCase(),m.innerText=chrome.i18n.getMessage("btn_cancel").toUpperCase(),n.placeholder=chrome.i18n.getMessage("write_us")+"...",r.innerText=chrome.i18n.getMessage("symbols_left")+":",p.innerText=chrome.i18n.getMessage("not_valid_email"),o.setAttribute("placeholder",chrome.i18n.getMessage("enter_your_email")),n.value="",l.addEventListener("click",g),m.addEventListener("click",h),n.addEventListener("input",d),n.addEventListener("paste",e),o.addEventListener("input",f)}function d(){var a=document.createElement("div");a.classList.add("download_item");var b=document.createElement("div");b.classList.add("download_item_icon");var c=document.createElement("div");c.classList.add("download_item_overlay"),a.appendChild(c),a.appendChild(b),K=a}function e(){return K||d(),K.cloneNode(!0)}function f(a){return a.shortcode?M.indexOf(a.shortcode)>-1?!1:(M.push(a.shortcode),!0):M.indexOf(a.url)>-1?!1:(M.push(a.url),!0)}function g(){return L?!1:void chrome.tabs.query({active:!0,currentWindow:!0},function(a){var b=document.querySelector(".links-no-found");b.innerText=chrome.i18n.getMessage("noLinksFound"),ca.hide(),b.style.display="block"})}function h(a){l(),r(a.length),a.forEach(function(a){i(a)&&f(a)&&j(a)})}function i(a){return a?"string"==typeof a.shortcode&&a.shortcode.length?!0:D.isValidUrl(a.url)?!0:!1:!1}function j(a){if(a.isMultiple){var b=u(a),c=0;D.getAllMediaDataFromJsonGraphql({shortCode:a.shortcode},function(a){a.forEach(function(a){c++,2>c||u(a,b)})})}else u(a)}function k(a){f(a)&&(L||l(),j(a))}function l(){L=!0,document.querySelector(".links-no-found").style.display="none",G.style.display="none",H.style.display="none",I.style.display="none",document.body.style.width="632px",chrome.runtime.sendMessage("getPopupRate",a),J.querySelector(".ext_text").innerText=chrome.i18n.getMessage("report_a_problem")+":",J.addEventListener("click",function(){Z||c("report")}),ca.hide(),F.style.display="flex",E.style.display="block",m(),n(),o(),$("body").on("click",".download_item",v)}function m(){$(".phone_icon").show().on("click",function(){chrome.runtime.sendMessage("openMobileMode")}),tippy(".phone_icon",{content:chrome.i18n.getMessage("mobile_view")})}function n(){$(".settings_icon").show().on("click",p),tippy(".settings_icon",{content:chrome.i18n.getMessage("settings_btn")})}function o(){chrome.storage.sync.get(["upload_external","add_video_control"],function(a){function b(){var a=c.find(".push-toggle");a.on("click",function(){var a=$(this);a.closest(".upload_from_anywhere").length>0?e.hasClass("active")?(e.removeClass("active"),chrome.storage.sync.set({upload_external:!1})):(e.addClass("active"),chrome.storage.sync.set({upload_external:!0})):a.closest(".add_video_control").length>0&&(f.hasClass("active")?(f.removeClass("active"),chrome.storage.sync.set({add_video_control:!1}),t({action:"changeVideoControl",add_video_control:!1})):(f.addClass("active"),chrome.storage.sync.set({add_video_control:!0}),t({action:"changeVideoControl",add_video_control:!0})))});var b,d=$(".title-help");d.on("mouseover",function(){b=document.createElement("div");var a=document.createElement("img"),d=$(this);if(d.closest(".upload_from_anywhere").length)a.src="img/help_screen_upload_from_anywhere.jpg";else{if(!d.closest(".add_video_control").length)return;a.src="img/help_screen_add_video_control.jpg"}b.className="help_image_wrap",b.appendChild(a),c.append(b)}),d.on("mouseleave",function(){b&&b.parentElement&&b.remove()}),c.data({event:"on"})}var c=$(".settings_page_wrap"),d=c.find(".settings_title"),e=c.find(".upload_from_anywhere"),f=c.find(".add_video_control");d.text(chrome.i18n.getMessage("settings_title")),e.find(".title .text").text(chrome.i18n.getMessage("upload_from_external_link")),f.find(".title .text").text(chrome.i18n.getMessage("add_video_control")),c.find(".btn_back").on("click",q),c.data().event||b(),a.upload_external&&e.addClass("active"),a.add_video_control&&f.addClass("active")})}function p(){$("#header").hide(),$("#download_item_container").hide(),$(".settings_page_wrap").show()}function q(){$(".settings_page_wrap").hide(),$("#header").show(),$("#download_item_container").show()}function r(a){3>a?(O=R,T="big_size",U="/s300x300/"):3==a?(O=Q,T="medium_size",U="/s200x200/"):(S=!1,O=P,T="mini_size",U="/s150x150/")}function s(){if(O==Q){var a=document.querySelectorAll(".download_item");a&&a.forEach&&a.forEach(function(a){a.classList.remove("big_size"),a.classList.add("medium_size")})}else O==P&&(a=document.querySelectorAll(".download_item"),a&&a.forEach&&a.forEach(function(a){a.classList.remove("big_size","medium_size"),a.classList.add("mini_size")}))}function t(a){chrome.tabs.query({url:[ba]},function(b){b.forEach(function(b){b.id&&chrome.tabs.sendMessage(b.id,a)})})}function u(a,b){aa++;var c=M.length>aa?M.length:aa;S&&(r(c),s());var d=x(a),f=e();return f.style.backgroundImage="url("+d+")",f.classList.add(a.type,T),a.isStory&&(f.dataset.isStory=1),a.shortcode&&(f.dataset.shortcode=a.shortcode),a.url&&(f.dataset.url=a.url),a.filename&&(f.dataset.filename=a.filename),"igtv"==a.type&&(f.dataset.igtv="1"),b?$(b).after(f):E.appendChild(f),f}function v(a){var c=Date.now();if(!(W+X>c||V)){W=c,V=!0;var d=this;if(this.querySelector(".download_item_icon").classList.add("clicked_now_item"),d.dataset.isStory||!d.dataset.shortcode)b({url:d.dataset.url,filename:d.dataset.filename});else{var e=d.dataset.shortcode;if(!e)return;var f=!!d.dataset.igtv;D.getMediaItemFromJsonGraphql({shortCode:e,isIgtv:f},function(a){(!a||a.error)&&(a=w(d)),a.url&&a.filename&&b({url:a.url,filename:a.filename})})}}}function w(a){return a.dataset.url&&a.dataset.filename?{url:a.dataset.url,filename:a.dataset.filename}:null}function x(a){var b=a.prev;return b=b||a.url}function y(){H.querySelector(".message").innerText=chrome.i18n.getMessage("reloadPage"),H.querySelector(".ext_text").innerText=chrome.i18n.getMessage("reloadPageShort"),I.style.display="none",ca.hide(),H.style.display="block",document.body.addEventListener("click",function(){chrome.tabs.reload(function(){window.close()})})}function z(a){I.style.display="none",G.querySelector(".instagram_no_msg").innerText=chrome.i18n.getMessage(a);var b=G.querySelector(".instagram_link_wrap a");b.innerText=chrome.i18n.getMessage("go_to_instagram"),setInterval(function(){b.blur()},50),ca.hide(),G.style.display="block"}function A(){$(".it_is_stories_space_msg").html("<p>"+chrome.i18n.getMessage("stories_space_desc1")+"</p><p>"+chrome.i18n.getMessage("stories_space_desc2")+"</p>").show(),ca.hide()}function B(){L||(ca.hide(),I.querySelector(".text").innerText=chrome.i18n.getMessage("tab_is_not_complete"),I.querySelector(".loader2").style.display="block",I.style.display="block")}function C(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){N=a[0];var b=N.id;if(N.url.indexOf("chrome-extension://"+chrome.runtime.id+"/stories.html")>-1)return A();var c=["chrome://","chrome-search://","https://chrome.google","chrome-extension://"],d=!1;return c.forEach(function(a){-1!=N.url.indexOf(a)&&(d=!0)}),/^http/.test(N.url)||(d=!0),d?void z("it_is_not_instagram"):void chrome.tabs.sendMessage(b,"checkConnect",function(a){a?(chrome.tabs.sendMessage(b,"getFoundLinks",da),_=-1!==N.url.indexOf("/saved/")):"complete"!=N.status?(B(),setTimeout(function(){L||C()},500)):-1!=N.url.indexOf("instagram.com")?y():chrome.runtime.sendMessage({action:"pageHasIframe",tabId:b},function(a){a=parseInt(a),"number"==typeof a&&!isNaN(a)&&a>0?y():z("it_is_not_instagram")})})})}var D=window.globalUtils;document.head.setAttribute("lang",chrome.i18n.getMessage("lang"));var E=document.querySelector("#download_item_container"),F=document.querySelector("header#header"),G=document.querySelector(".it_is_not_instagram"),H=document.querySelector(".install_now"),I=document.querySelector(".tab_is_not_complete"),J=document.querySelector(".report_ask"),K=null,L=!1,M=[],N=null,O=null,P=1,Q=2,R=3,S=!0,T=null,U=null,V=!1,W=0,X=1e3,Y="",Z=!1,_=!1,aa=0,ba="*://*.instagram.com/*",ca=function(){var a=document.querySelector(".loader");return a.show=function(){this.style.display="block"},a.hide=function(){this.style.display="none"},a}();chrome.runtime.onMessage.addListener(function(a,b,c){a&&"object"==typeof a&&a.action&&"linkFound"==a.action&&a.mediaInfo&&b.tab.id==N.id&&k(a.mediaInfo)}),chrome.downloads.onCreated.addListener(function(a){V=!1;var b=document.querySelector(".clicked_now_item");b&&b.classList.remove("clicked_now_item")});var da=function(a){return setTimeout(g,2e3),a&&Array.isArray(a)&&a.length?(L=!0,void h(a)):!1},ea=function(){ca.show(),D.fixForeach(),C()};ea(),function(){document.body.style.opacity=0,document.body.style.transition="opacity ease-out .4s",requestAnimationFrame(function(){document.body.style.opacity=1});var a=function(){document.body.style.border="none",setTimeout(function(){document.body.style.border="1px solid transparent"},100),setTimeout(function(){document.body.style.border="none"},300)},b=function(b){setTimeout(function(){var b=document.outerWidth||window.outerWidth;100>b&&a()},b)};a(),b(600),b(1500),b(3e3),b(1e4)}()}();