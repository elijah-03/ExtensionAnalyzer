try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="bf77ad9e-45b0-44a4-9eff-e3a99ebe11a9",e._sentryDebugIdIdentifier="sentry-dbid-bf77ad9e-45b0-44a4-9eff-e3a99ebe11a9")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"4.43.1"};(self.webpackChunk=self.webpackChunk||[]).push([[6251],{46251:(e,t,n)=>{function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{ErrorCode:()=>Xe,OnDeviceSentenceSplitterError:()=>He,getSplitSentences:()=>$e,setOnDeviceSentenceSplitterConfig:()=>Ye});var o=new Map;o.set("PLATFORM_TYPE",""),o.set("PLATFORM_VERSION",""),o.set("IS_PREMIUM_USER",""),o.set("USER_ID_TOKEN",""),o.set("INPUT_LANGUAGE",""),o.set("REGIONAL_LANGUAGE",""),o.set("DEVICE_ID",""),o.set("GC_BATCH","4"),o.set("SS_BATCH","4"),o.set("PERSONALISATION_UPDATED_AT",""),o.set("PERSONALIZATION",""),o.set("VALID_START_SENTENCE_REGEX",""),o.set("VALID_END_SENTENCE_REGEX",""),o.set("GC_RESPONSE_POST_PROCESS",""),o.set("RECOMMENDATION_DISABLED_CATEGORIES",""),o.set("RECOMMENDATION_PRE_VALIDATE_CHECK",""),o.set("RECOMMENDATION_SENTENCES_PER_BATCH","5"),o.set("RECOMMENDATION_MIN_TEXT_LENGTH","10"),o.set("MAX_RECOMMENDATION_CONCURRENT_REQUESTS","6"),o.set("ENABLE_RECOMMENDATION_CONTEXT","false"),o.set("DISABLE_GC_AFTER_FIX_ERROR","false"),o.set("ON_DEVICE_LANGUAGE_CONFIG",""),o.set("ON_DEVICE_SENTENCE_SPLITTER_CONFIG","");var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"get",value:function(e){return o.get(e)}},{key:"set",value:function(e,t){return o.set(e,t)}}],(n=null)&&r(t.prototype,n),a&&r(t,a),e}();function i(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"_modelId",""),c(this,"_skipReason",void 0),c(this,"_apiResponse",{data:null,_cached:!1})}var t,n,r;return t=e,n=[{key:"modelId",get:function(){return this._modelId}},{key:"isSkipped",get:function(){return Boolean(this._skipReason)}},{key:"skipReason",get:function(){return this._skipReason}},{key:"apiResponse",get:function(){return this._apiResponse}},{key:"isCached",get:function(){return this._apiResponse._cached||!1}},{key:"_skipLoad",value:function(e,t){return(n=function(){return s(this,function(n){switch(n.label){case 0:return this._skipReason=e,t?[4,t()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function u(e){i(a,r,o,u,c,"next",e)}function c(e){i(a,r,o,u,c,"throw",e)}u(void 0)})}).call(this);var n}}],n&&u(t.prototype,n),r&&u(t,r),e}(),f=null;function h(e){var t=e.eventName,n=e.data;f&&f({eventName:t,data:n})}function p(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function d(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function y(e){return(t=function(){var t,n,r;return d(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=new TextEncoder,n=t.encode(e),[4,crypto.subtle.digest("SHA-256",n)];case 1:return r=o.sent(),[2,Array.from(new Uint8Array(r)).map(function(e){return e.toString(16).padStart(2,"0")}).join("")];case 2:return o.sent(),[2,""];case 3:return[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){p(a,r,o,i,u,"next",e)}function u(e){p(a,r,o,i,u,"throw",e)}i(void 0)})})();var t}let v,b;const E=new WeakMap,g=new WeakMap,_=new WeakMap,m=new WeakMap,w=new WeakMap;let O={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return g.get(e);if("objectStoreNames"===t)return e.objectStoreNames||_.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return I(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function S(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(b||(b=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(N(this),t),I(E.get(this))}:function(...t){return I(e.apply(N(this),t))}:function(t,...n){const r=e.call(N(this),t,...n);return _.set(r,t.sort?t.sort():[t]),I(r)}}function T(e){return"function"==typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(g.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});g.set(e,t)}(e),t=e,(v||(v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,O):e);var t}function I(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(I(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&E.set(t,e)}).catch(()=>{}),w.set(t,e),t}(e);if(m.has(e))return m.get(e);const t=T(e);return t!==e&&(m.set(e,t),w.set(t,e)),t}const N=e=>w.get(e);const k=["get","getKey","getAll","getAllKeys","count"],R=["put","add","delete","clear"],P=new Map;function C(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(P.get(t))return P.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=R.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!k.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,o?"readwrite":"readonly");let i=a.store;return r&&(i=i.index(t.shift())),(await Promise.all([i[n](...t),o&&a.done]))[0]};return P.set(t,a),a}function x(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function D(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){x(a,r,o,i,u,"next",e)}function u(e){x(a,r,o,i,u,"throw",e)}i(void 0)})}}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}O=(e=>({...e,get:(t,n,r)=>C(t,n)||e.get(t,n,r),has:(t,n)=>!!C(t,n)||e.has(t,n)}))(O);var j="product-gc",G=3,B={cache:"cache",correctedSentences:"correctedSentences",lockedRecommendationMapping:"lockedRecommendationMapping"},U=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"dbPromise",void 0),L(this,"isAvailable","undefined"!=typeof indexedDB),this.isAvailable?this.dbPromise=new Promise(function(e,t){(function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,t),u=I(i);return r&&i.addEventListener("upgradeneeded",e=>{r(I(i.result),e.oldVersion,e.newVersion,I(i.transaction))}),n&&i.addEventListener("blocked",()=>n()),u.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",()=>o())}).catch(()=>{}),u})(j,G,{upgrade:function(e,t,n,r){try{if(!e.objectStoreNames.contains(B.cache)){var o=e.createObjectStore(B.cache);o.createIndex("date","date"),o.createIndex("type","type",{unique:!1})}if(e.objectStoreNames.contains(B.cache)){var a=r.objectStore(B.cache);a.indexNames.contains("type")||a.createIndex("type","type",{unique:!1})}if(!e.objectStoreNames.contains(B.correctedSentences))e.createObjectStore(B.correctedSentences).createIndex("date","date");if(!e.objectStoreNames.contains(B.lockedRecommendationMapping))e.createObjectStore(B.lockedRecommendationMapping).createIndex("date","date")}catch(e){}},blocked:function(){e(null)},blocking:function(){},terminated:function(){}}).then(function(t){e(t||null)}).catch(function(t){e(null)})}):this.dbPromise=Promise.resolve(null)}var t,n,r;return t=e,n=[{key:"get",value:function(e,t){return D(function(){var n;return M(this,function(r){switch(r.label){case 0:return[4,this.dbPromise];case 1:return[2,null===(n=r.sent())||void 0===n?void 0:n.get(t,e).then(function(e){return null==e?void 0:e.data})]}})}).call(this)}},{key:"set",value:function(e,t,n){return D(function(){var r,o,a;return M(this,function(i){switch(i.label){case 0:return a={data:t,type:(null==t||null===(r=t.value)||void 0===r?void 0:r.type)||"default",date:+(new Date).setHours(0,0,0,0)},[4,this.dbPromise];case 1:return[4,null===(o=i.sent())||void 0===o?void 0:o.put(n,a,e)];case 2:return i.sent(),[2]}})}).call(this)}},{key:"delete",value:function(e,t){return D(function(){var n;return M(this,function(r){switch(r.label){case 0:return[4,this.dbPromise];case 1:return[4,null===(n=r.sent())||void 0===n?void 0:n.delete(t,e)];case 2:return r.sent(),[2]}})}).call(this)}},{key:"clear",value:function(e){return D(function(){var t;return M(this,function(n){switch(n.label){case 0:return[4,this.dbPromise];case 1:return[4,null===(t=n.sent())||void 0===t?void 0:t.clear(e)];case 2:return n.sent(),[2]}})}).call(this)}},{key:"deleteOldData",value:function(e){return D(function(){var t,n,r,o,a,i,u;return M(this,function(c){switch(c.label){case 0:return c.trys.push([0,6,,7]),n=+(new Date).setDate((new Date).getDate()-10),[4,this.dbPromise];case 1:return r=null===(t=c.sent())||void 0===t?void 0:t.transaction(e,"readwrite"),o=null==r?void 0:r.store,a=null==o?void 0:o.index("date"),i=IDBKeyRange.upperBound(n),[4,null==a?void 0:a.openKeyCursor(i)];case 2:u=c.sent(),c.label=3;case 3:return u?(null==o||o.delete(u.primaryKey),[4,u.continue()]):[3,5];case 4:return u=c.sent(),[3,3];case 5:return[3,7];case 6:return c.sent(),[3,7];case 7:return[2]}})}).call(this)}},{key:"getDatabaseSize",value:function(e){return D(function(){var t,n,r;return M(this,function(o){switch(o.label){case 0:return[4,this.dbPromise];case 1:return t=o.sent(),n=null==t?void 0:t.transaction(e,"readonly"),[2,(null==(r=null==n?void 0:n.store)?void 0:r.count())||0]}})}).call(this)}},{key:"getByType",value:function(e){return D(function(e){var t,n,r,o,a,i,u,c=arguments;return M(this,function(s){switch(s.label){case 0:return t=c.length>1&&void 0!==c[1]?c[1]:B.cache,[4,this.dbPromise];case 1:return(n=s.sent())?(r=n.transaction(t,"readonly"),o=r.store,a=o.index("type"),i=[],[4,a.openCursor(IDBKeyRange.only(e))]):[2,[]];case 2:u=s.sent(),s.label=3;case 3:return u?(i.push(u.value.data),[4,u.continue()]):[3,5];case 4:return u=s.sent(),[3,3];case 5:return[2,i]}})}).apply(this,arguments)}},{key:"deleteByType",value:function(e){return D(function(e){var t,n,r,o,a,i=arguments;return M(this,function(u){switch(u.label){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:B.cache,[4,this.dbPromise];case 1:return(n=u.sent())?(r=n.transaction(t,"readwrite"),[4,(o=r.store).index("type").openKeyCursor(IDBKeyRange.only(e))]):[2];case 2:a=u.sent(),u.label=3;case 3:return a?(o.delete(a.primaryKey),[4,a.continue()]):[3,5];case 4:return a=u.sent(),[3,3];case 5:return[4,r.done];case 6:return u.sent(),[2]}})}).apply(this,arguments)}}],n&&A(t.prototype,n),r&&A(t,r),e}();function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function K(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){V(a,r,o,i,u,"next",e)}function u(e){V(a,r,o,i,u,"throw",e)}i(void 0)})}}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}var z=new Map,q=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=!0,(n="isAvailable")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"get",value:function(e){return K(function(){return W(this,function(t){return[2,z.get(e)]})})()}},{key:"set",value:function(e,t){return K(function(){return W(this,function(n){switch(n.label){case 0:return[4,z.set(e,t)];case 1:return n.sent(),[2]}})})()}},{key:"delete",value:function(e){return K(function(){return W(this,function(t){switch(t.label){case 0:return[4,z.delete(e)];case 1:return t.sent(),[2]}})})()}},{key:"clear",value:function(){return K(function(){return W(this,function(e){switch(e.label){case 0:return[4,z.clear()];case 1:return e.sent(),[2]}})})()}},{key:"getDatabaseSize",value:function(){return K(function(){return W(this,function(e){return[2,z.size]})})()}},{key:"deleteByType",value:function(e){return K(function(){var t,n,r,o,a,i,u;return W(this,function(c){t=!0,n=!1,r=void 0;try{for(o=z.entries()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)i=H(a.value,2),u=i[0],i[1].type===e&&z.delete(u)}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return[2]})})()}},{key:"getByType",value:function(e){return K(function(){var t,n,r,o,a,i,u,c;return W(this,function(s){t=[],n=!0,r=!1,o=void 0;try{for(a=z.entries()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0)u=H(i.value,2),c=u[0],u[1].type===e&&t.push(c)}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return[2,t]})})()}}])&&X(t.prototype,n),r&&X(t,r),e}(),J=function(e,t,n){if("number"!=typeof n||n<=0)throw new Error("timedPromise: Encountered invalid timeout value. Got ".concat(n));return new Promise(function(r,o){var a=setTimeout(function(){r({timedOut:!0,value:t})},n);e.then(function(e){clearTimeout(a),r({timedOut:!1,value:e})}).catch(function(e){clearTimeout(a),o(e)})})};function Y(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function $(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}var Q,Z=B.correctedSentences;function ee(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function te(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}(Q=function(){var e,t,n;return $(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=new U,t=e.dbPromise,[4,J(t,null,3e3)];case 1:return n=r.sent(),e.isAvailable&&n.value?(e.deleteOldData(Z),[2,e]):[3,3];case 2:return r.sent(),[3,3];case 3:return[2,new q]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=Q.apply(e,t);function a(e){Y(o,n,r,a,i,"next",e)}function i(e){Y(o,n,r,a,i,"throw",e)}a(void 0)})})();var ne=B.lockedRecommendationMapping;function re(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function oe(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){re(a,r,o,i,u,"next",e)}function u(e){re(a,r,o,i,u,"throw",e)}i(void 0)})}}function ae(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}!function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ee(a,r,o,i,u,"next",e)}function u(e){ee(a,r,o,i,u,"throw",e)}i(void 0)})}}(function(){var e,t,n;return te(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=new U,t=e.dbPromise,[4,J(t,null,3e3)];case 1:return n=r.sent(),e.isAvailable&&n.value?(e.deleteOldData(ne),[2,e]):[3,3];case 2:return r.sent(),[3,3];case 3:return[2,new q]}})})();var ie=B.cache,ue=oe(function(){var e,t,n;return ae(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=new U,t=e.dbPromise,[4,J(t,null,3e3)];case 1:return n=r.sent(),e.isAvailable&&n.value?(e.deleteOldData(ie),[2,e]):[3,3];case 2:return r.sent(),[3,3];case 3:return[2,new q]}})})(),ce=function(e){return oe(function(){var t,n,r,o,a,i,u;return ae(this,function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),[4,ue.then(function(t){return t.get(e,ie)})];case 1:if(!(t=c.sent()))return[2,void 0];if(n="string"==typeof t?JSON.parse(t):t,r=n.value,o=n.expireAt,"string"==typeof r)try{a=JSON.parse(r),r=a}catch(e){}return o?(i=(new Date).getTime(),u=new Date(o).getTime(),i>u?[4,ue.then(function(t){return t.delete(e,ie)})]:[3,3]):[2,r];case 2:case 4:return c.sent(),[2,void 0];case 3:return[2,r];case 5:return[2]}})})()},se=function(e,t,n){return oe(function(){var r;return ae(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),r=n?new Date((new Date).getTime()+n).toISOString():void 0,[4,ue.then(function(n){return n.set(e,{expireAt:r,value:t},ie)})];case 1:return o.sent(),[3,3];case 2:return o.sent(),[2,void 0];case 3:return[2]}})})()},le=function(e){return e.DEBUG_LOG="debugLog",e.ON_DEVICE_SENTENCE_SPLITTER_INIT="on_device_sentence_splitter_init",e.ON_DEVICE_SENTENCE_SPLITTER_INIT_ERROR="on_device_sentence_splitter_init_error",e.ON_DEVICE_SENTENCE_SPLIT_COMPLETE="on_device_sentence_split_complete",e.ON_DEVICE_SENTENCE_SPLIT_ERROR="on_device_sentence_split_error",e.ON_DEVICE_SENTENCE_SPLIT_TOGGLE="on_device_sentence_split_toggle",e.ON_DEVICE_SEGMENTER_SENTENCE_SPLIT_COMPLETE="on_device_segmenter_sentence_split_complete",e.ON_DEVICE_SEGMENTER_SENTENCE_SPLIT_ERROR="on_device_segmenter_sentence_split_error",e.ON_DEVICE_LANG_DETECT_COMPLETE="on_device_lang_detect_complete",e.ON_DEVICE_LANG_DETECT_ERROR="on_device_lang_detect_error",e.ON_DEVICE_LANG_DETECT_TIMEOUT="on_device_lang_detect_timeout",e.ON_DEVICE_LANG_DETECT_TOGGLE="on_device_lang_detect_toggle",e.LOCK_ID_TO_RECOMMENDATION_KEY_MAP_NON_EXISTS="LOCK_ID_TO_RECOMMENDATION_KEY_MAP_NON_EXISTS",e.RECOMMENDATION_UNLOCK_FAILED="RECOMMENDATION_UNLOCK_FAILED",e.GC_MODEL_STATS="gc_model_stats",e}({}),fe=function(e){return e.recommendationNone="recommendation:none",e.recommendationPremium="recommendation:premium",e.recommendationLocked="recommendation:locked",e.recommendationUpsell="recommendation:upsell",e["detect-language:on-device"]="detect-language:on-device",e["sentence-splitter:on-device"]="sentence-splitter:on-device",e}({});function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pe(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function de(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){pe(a,r,o,i,u,"next",e)}function u(e){pe(a,r,o,i,u,"throw",e)}i(void 0)})}}function ye(e,t,n){return t=Ee(t),function(e,t){if(t&&("object"==(n=t,n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;var n;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Oe()?Reflect.construct(t,n||[],Ee(e).constructor):t.apply(e,n))}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ee(e){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(e)}function ge(e,t){return ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ge(e,t)}function _e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw o}}return a}}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||we(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(e,t){if(e){if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}function Oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Oe=function(){return!!e})()}function Se(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}var Te=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),be(e=ye(this,t),"module",null),be(e,"initialized",!1),be(e,"loadingPromise",null),be(e,"srxText",null),e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,e),n=t,r=[{key:"getModel",value:function(){if(!this.module)throw new Error("Segmentation module not initialized");return this.module}},{key:"process",value:function(e){return de(function(e){var t,n,r;return Se(this,function(o){return t=e.input,n=e.language,r=void 0===n?"English":n,[2,this.getModel().segmentText(t,r)]})}).apply(this,arguments)}},{key:"_preProcess",value:function(e){return e}},{key:"_postProcess",value:function(e){return e}},{key:"convertPattern",value:function(e){var t="g",n=e;return/^\(\?i\)/.test(e)&&(t+="i",n=e.replace(/^\(\?i\)/,"")),/\(\?[a-z]*:?/.test(n),{pattern:n,flags:t}}},{key:"parseSRX",value:function(e){if("undefined"!=typeof DOMParser)try{return this.parseSRXWithDOMParser(e)}catch(e){}return this.parseSRXWithRegex(e)}},{key:"parseSRXWithDOMParser",value:function(e){var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("languagerule"),n={},r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var c=i.value,s=c.getAttribute("languagerulename");if(s){var l={breaks:[],non_breaks:[]},f=c.getElementsByTagName("rule"),h=!0,p=!1,d=void 0;try{for(var y,v=f[Symbol.iterator]();!(h=(y=v.next()).done);h=!0){var b,E,g=y.value,_="no"!==g.getAttribute("break"),m=(null===(b=g.getElementsByTagName("beforebreak")[0])||void 0===b?void 0:b.textContent)||"",w=(null===(E=g.getElementsByTagName("afterbreak")[0])||void 0===E?void 0:E.textContent)||"";(_?l.breaks:l.non_breaks).push([m,w])}}catch(e){p=!0,d=e}finally{try{h||null==v.return||v.return()}finally{if(p)throw d}}n[s]=l}}}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}for(var O=0,S=["English","Catalan","Spanish"];O<S.length;O++){var T=S[O];n[T]||(n[T]={breaks:[],non_breaks:[]}),n[T].breaks.push(["\\n",""])}return n}},{key:"decodeXMLEntities",value:function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}},{key:"parseSRXWithRegex",value:function(e){for(var t,n={},r=e.replace(/<!--[\s\S]*?-->/g,""),o=/<languagerule\s+languagerulename="([^"]+)">([\s\S]*?)<\/languagerule>/g;null!==(t=o.exec(r));){for(var a=t[1],i=t[2],u={breaks:[],non_breaks:[]},c=/<rule\s+break="([^"]+)">([\s\S]*?)<\/rule>/g,s=void 0;null!==(s=c.exec(i));){var l="no"!==s[1],f=s[2],h=f.match(/<beforebreak>([\s\S]*?)<\/beforebreak>/),p=f.match(/<afterbreak>([\s\S]*?)<\/afterbreak>/),d=h?this.decodeXMLEntities(h[1]):"",y=p?this.decodeXMLEntities(p[1]):"";(l?u.breaks:u.non_breaks).push([d,y])}n[a]=u}for(var v=0,b=["English","Catalan","Spanish"];v<b.length;v++){var E=b[v];n[E]||(n[E]={breaks:[],non_breaks:[]}),n[E].breaks.push(["\\n",""])}return n}},{key:"getBreakPoints",value:function(e,t){return de(function(){var n,r,o,a,i,u,c,s,l,f,h,p,d;return Se(this,function(y){n=new Set,r=!0,o=!1,a=void 0;try{for(i=t[Symbol.iterator]();!(r=(u=i.next()).done);r=!0)for(c=_e(u.value,2),s=c[0],l=c[1],f=this.convertPattern(s),h=this.convertPattern(l),p=new RegExp("(".concat(f.pattern,")(").concat(h.pattern,")"),f.flags.includes("i")||h.flags.includes("i")?"gi":"g"),d=void 0;null!==(d=p.exec(e));)n.add(d.index+d[1].length)}catch(e){o=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(o)throw a}}return[2,new Promise(function(e){return setTimeout(function(){return e(n)},0)})]})}).call(this)}},{key:"extractSegments",value:function(e,t){return de(function(){var n,r,o,a,i,u,c,s,l,f,h,p,d,y,v;return Se(this,function(b){switch(b.label){case 0:return[4,this.getBreakPoints(e,t.non_breaks)];case 1:return n=b.sent(),[4,this.getBreakPoints(e,t.breaks)];case 2:for(r=b.sent(),o=Array.from(r).filter(function(e){return!n.has(e)}).sort(function(e,t){return e-t}),a=[],i="",u=[0].concat(me(o)),c=me(o).concat([e.length]),s=0;s<u.length;s++)l=e.slice(u[s],c[s]),(f=l.trim())?(h=l.indexOf(f),p=u[s]+h,d=p+f.length,y=l.slice(0,h),v=l.slice(h+f.length),a.push({text:f,start:p,end:d,whitespace:i+y}),i=v):i+=l;return[2,a]}})}).call(this)}},{key:"loadSRXFile",value:function(){return de(function(){var e,t,n;return Se(this,function(r){switch(r.label){case 0:return e=a.get("ON_DEVICE_SENTENCE_SPLITTER_CONFIG"),[4,fetch(e.srxPath)];case 1:if(!(t=r.sent()).ok)throw new Error("HTTP error! status: ".concat(t.status));return n=this,[4,t.text()];case 2:return n.srxText=r.sent(),[2,this.parseSRX(this.srxText)]}})}).call(this)}},{key:"createSegmentationModule",value:function(e){var t=this;return{rules:e,segmentText:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"English";return de(function(){var t;return Se(this,function(o){switch(o.label){case 0:if(!e||!e[r])throw new Error("SRX rules not loaded or language '".concat(r,"' not found"));if(!n.trim())throw new Error("Please enter some text to segment.");o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.extractSegments(n,e[r])];case 2:return[2,{sentences:t=o.sent(),fullOutput:t.map(function(e){return e.text}).join("\n")}];case 3:throw o.sent();case 4:return[2]}})}).call(t)}}}},{key:"initialize",value:function(){return de(function(){var e;return Se(this,function(t){return e=this,this.initialized?[2,Promise.resolve(this.module)]:(this.loadingPromise||(this.loadingPromise=de(function(){var e,t,n;return Se(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,3,4]),[4,this.loadSRXFile()];case 1:return e=r.sent(),this.module=this.createSegmentationModule(e),this.initialized=!0,[2,this.module];case 2:throw t=r.sent(),this.initialized=!1,o=t,a=Error,n=(null!=a&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?a[Symbol.hasInstance](o):o instanceof a)?t.message:"Unknown error occurred",new Error("Failed to initialize Segmentation module: ".concat(n));case 3:return this.loadingPromise=null,[7];case 4:return[2]}var o,a})}).call(e)),[2,this.loadingPromise])})}).call(this)}}],o=[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}],r&&ve(n.prototype,r),o&&ve(n,o),t}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)});function Ie(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function Ne(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ie(a,r,o,i,u,"next",e)}function u(e){Ie(a,r,o,i,u,"throw",e)}i(void 0)})}}function ke(e,t,n){return t=Ce(t),function(e,t){if(t&&("object"==(n=t,n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;var n;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,De()?Reflect.construct(t,n||[],Ce(e).constructor):t.apply(e,n))}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}function xe(e,t){return xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xe(e,t)}function De(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(De=function(){return!!e})()}function Ae(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}be(Te,"instance",null);var Le=function(e){function t(e,n){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Pe(r=ke(this,t),"segmenterManager",void 0),Pe(r,"_text",void 0),Pe(r,"_language",void 0),Pe(r,"_sentences",[]),Pe(r,"slowThreshold",void 0),Pe(r,"fallbackThreshold",void 0),r._text=e,r._modelId="segmenter",r._language=n,r.segmenterManager=Te.getInstance();var o=a.get("ON_DEVICE_SENTENCE_SPLITTER_CONFIG");return r.slowThreshold=(null==o?void 0:o.slowThreshold)||t.DEFAULT_SLOW_THRESHOLD,r.fallbackThreshold=(null==o?void 0:o.fallbackThreshold)||t.DEFAULT_FALLBACK_THRESHOLD,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(t,e),n=t,o=[{key:"getInstance",value:function(e,n){return Ne(function(){return Ae(this,function(r){switch(r.label){case 0:return[4,new t(e,n)._load()];case 1:return[2,r.sent()]}})})()}}],(r=[{key:"_isLanguageSupported",value:function(e){return e.toLowerCase()in t.SEGMENTER_LANGUAGE_MAP}},{key:"_getLanguageName",value:function(e){return t.SEGMENTER_LANGUAGE_MAP[e.toLowerCase()]}},{key:"sentences",get:function(){return this._sentences}},{key:"_beforeLoad",value:function(){return this._isLanguageSupported(this._language)?(this._language=this._getLanguageName(this._language)||"",this._text?void(this._text=function(e){try{return e.replace(/\u00A0/g," ").replace(/\u200B/g,"")}catch(t){return e}}(this._text)):(""===this._text&&(this._sentences=[{text:"",start:0,end:-1}]),void this._skipLoad("shortCircuit",function(){}))):(this._sentences=[],void this._skipLoad("shortCircuit",function(){}))}},{key:"_afterLoad",value:function(){return Ne(function(){return Ae(this,function(e){return[2]})})()}},{key:"_load",value:function(){return Ne(function(){var e,t,n,r;return Ae(this,function(o){switch(o.label){case 0:return this._beforeLoad(),this.isSkipped?[2,this]:[4,this.generateCacheKey()];case 1:return e=o.sent(),[4,this.retrieveFromCache(e)];case 2:if(t=o.sent())return this._sentences=t,[2,this];o.label=3;case 3:return o.trys.push([3,7,,8]),[4,this.segmenterManager.initialize()];case 4:return o.sent(),n=this,[4,this.processSentences()];case 5:return n._sentences=o.sent(),[4,this.cacheResults(e)];case 6:return o.sent(),[2,this];case 7:return r=o.sent(),this.handleError(r),[2,this];case 8:return[2]}})}).call(this)}},{key:"generateCacheKey",value:function(){return Ne(function(){return Ae(this,function(e){switch(e.label){case 0:return[4,y(t.CACHE_PREFIX+this._text)];case 1:return[2,e.sent()]}})}).call(this)}},{key:"retrieveFromCache",value:function(e){return Ne(function(){var t;return Ae(this,function(n){switch(n.label){case 0:return[4,ce(e)];case 1:return[2,(null==(t=n.sent())?void 0:t.data.sentences)||null]}})})()}},{key:"cacheResults",value:function(e){return Ne(function(){var n;return Ae(this,function(r){switch(r.label){case 0:return n={data:{sentences:this._sentences},type:fe["sentence-splitter:on-device"]},[4,se(e,n,t.CACHE_TTL)];case 1:return r.sent(),[2]}})}).call(this)}},{key:"processSentences",value:function(){return Ne(function(){var e;return Ae(this,function(t){switch(t.label){case 0:return[4,Promise.race([this.createTimeoutPromise(),this.executeSentenceProcessing()])];case 1:return e=t.sent(),[2,this.mapSentencesToOffsets(this._text,e)]}})}).call(this)}},{key:"createTimeoutPromise",value:function(){var e=this;return new Promise(function(t,n){return setTimeout(function(){return n(new Error("fallback timeout"))},e.fallbackThreshold)})}},{key:"executeSentenceProcessing",value:function(){return Ne(function(){var e,t,n;return Ae(this,function(r){switch(r.label){case 0:return e=performance.now(),[4,this.segmenterManager.process({input:this._text,language:this._language})];case 1:return t=r.sent(),n=performance.now()-e,this.trackPerformance(n),[2,t.sentences.map(function(e){return e.text})]}})}).call(this)}},{key:"trackPerformance",value:function(e){e>this.slowThreshold&&this.notifySlowProcessing(e),this.notifyProcessingComplete(e)}},{key:"notifySlowProcessing",value:function(e){h({eventName:le.ON_DEVICE_SENTENCE_SPLIT_TOGGLE,data:{value:!1,timeTaken:e,reason:"slowThreshold",modelId:this._modelId}})}},{key:"notifyProcessingComplete",value:function(e){h({eventName:le.ON_DEVICE_SEGMENTER_SENTENCE_SPLIT_COMPLETE,data:{timeTaken:e,textLength:this._text.length,modelId:this._modelId}})}},{key:"handleError",value:function(e){var t,n,r=(t=e,(null!=(n=Error)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)?e.message:"Unknown error");h({eventName:le.ON_DEVICE_SEGMENTER_SENTENCE_SPLIT_ERROR,data:{error:r,textLength:this._text.length,modelId:this._modelId}})}},{key:"mapSentencesToOffsets",value:function(e,t){var n=0;return t.map(function(t){var r=e.indexOf(t,n),o=r+t.length-1;return n=r+t.length,{text:t,start:r,end:o}})}}])&&Re(n.prototype,r),o&&Re(n,o),t}(l);function Me(e,t,n){return t=Ue(t),function(e,t){if(t&&("object"==(n=t,n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;var n;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ke()?Reflect.construct(t,n||[],Ue(e).constructor):t.apply(e,n))}function je(e,t,n){return je=Ke()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&Fe(o,n.prototype),o},je.apply(null,arguments)}function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ue(e){return Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ue(e)}function Fe(e,t){return Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fe(e,t)}function Ve(e){var t="function"==typeof Map?new Map:void 0;return Ve=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return je(e,arguments,Ue(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Fe(n,e)},Ve(e)}function Ke(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ke=function(){return!!e})()}Pe(Le,"DEFAULT_SLOW_THRESHOLD",150),Pe(Le,"DEFAULT_FALLBACK_THRESHOLD",400),Pe(Le,"CACHE_PREFIX","SENTENCE_SPLITTER_SEGMENTER"),Pe(Le,"CACHE_TTL",864e5),Pe(Le,"SEGMENTER_LANGUAGE_MAP",{en:"English",de:"German",fr:"French",es:"Spanish",nl:"Dutch",pt:"Portuguese"});var Xe={CONFIGURATION_ERROR:"CONFIGURATION_ERROR",MODEL_LOADING_ERROR:"MODEL_LOADING_ERROR",SPLITTING_ERROR:"SPLITTING_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},He=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe.UNKNOWN_ERROR,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Be(n=Me(this,t,[e]),"code",void 0),Be(n,"context",void 0),Be(n,"isOperational",void 0),Object.setPrototypeOf(n,t.prototype),n.name="OnDeviceSentenceSplitterError",n.code=r,n.context=o,n.isOperational=a,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(t,e),n=t,o=[{key:"emptyText",value:function(){return new t("Input text cannot be empty or whitespace only",Xe.VALIDATION_ERROR,{},!0)}},{key:"invalidLanguage",value:function(e){return new t("Language parameter is required and cannot be empty",Xe.VALIDATION_ERROR,{language:e},!0)}},{key:"notConfigured",value:function(){return new t("On-device sentence splitter configuration is not set",Xe.CONFIGURATION_ERROR,{},!0)}},{key:"notEnabled",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new t("On-device sentence splitter is not enabled in configuration",Xe.CONFIGURATION_ERROR,e,!0)}},{key:"unknownError",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="string"==typeof e?e:e.message;return new t("Unknown error occurred: ".concat(r),Xe.UNKNOWN_ERROR,n,!1)}}],(r=[{key:"getFormattedMessage",value:function(){var e=Object.keys(this.context).length>0?" | Context: ".concat(JSON.stringify(this.context)):"";return"".concat(this.name,": ").concat(this.message).concat(e)}},{key:"toJSON",value:function(){return{name:this.name,message:this.message,code:this.code,context:this.context,isOperational:this.isOperational,stack:this.stack}}}])&&Ge(n.prototype,r),o&&Ge(n,o),t}(Ve(Error));function We(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe.UNKNOWN_ERROR,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t=e,null!=(n=He)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)return e;var a="string"==typeof e?e:e.message;return new He(a,r,o)}function ze(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function qe(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Je(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function Ye(e){a.set("ON_DEVICE_SENTENCE_SPLITTER_CONFIG",e)}function $e(e,t){return function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ze(a,r,o,i,u,"next",e)}function u(e){ze(a,r,o,i,u,"throw",e)}i(void 0)})}}(function(e,t){var n,r,o,i;return Je(this,function(u){switch(u.label){case 0:n=e.text,r=e.language,u.label=1;case 1:return u.trys.push([1,3,,4]),function(e){if(0===e.trim().length)throw He.emptyText()}(n),function(e){if(!e||0===e.trim().length)throw He.invalidLanguage(e)}(r),function(){var e=a.get("ON_DEVICE_SENTENCE_SPLITTER_CONFIG");if(!e)throw He.notConfigured();if(!e.enabled)throw He.notEnabled({config:e})}(),t&&function(e){f=e}(t),[4,Le.getInstance(n,r)];case 2:if(!(o=u.sent()))throw We("No splitting result returned",Xe.SPLITTING_ERROR,{text:n,language:r});return[2,{sentences:(null==o?void 0:o.sentences)||[],language:r,isOnDevice:!0}];case 3:if(qe(i=u.sent(),He))throw i;if(qe(i,Error))throw We(i,Xe.SPLITTING_ERROR,{text:n,language:r});throw We("string"==typeof i?i:"Unknown error occurred",Xe.UNKNOWN_ERROR,{text:n,language:r});case 4:return[2]}})}).apply(this,arguments)}}}]);
//# sourceMappingURL=sourceMap/6251.js.map