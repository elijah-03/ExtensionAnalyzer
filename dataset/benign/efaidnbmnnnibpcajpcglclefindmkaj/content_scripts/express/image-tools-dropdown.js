/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import expressUtils from"./express-utils.js";import state from"../gmail/state.js";class ImageToolsDropdown{DROPDOWN_MENU_CLASS="cc440d50ba-express-dropdown-menu";DROPDOWN_MENU_SHOW_CLASS="cc440d50ba-express-dropdown-menu-show";ENTRY_POINT_BUTTON_CLASS="cc440d50ba-express-entrypoint-button";ENTRY_POINT_BUTTON_ICON_CLASS_IMG="cc440d50ba-express-entrypoint-button-icon-img";SECTION_HEADER_CLASS="cc440d50ba-express-dropdown-section-header";MENU_ITEM_ICON_IMG_CLASS="cc440d50ba-express-dropdown-menu-content-item-icon-img";VERBS={CONVERT_TO_PDF:{intent:"convertToPdf",divClass:"cc440d50ba-express-item-convert-to-pdf",iconPath:chrome.runtime.getURL("browser/images/convert_img_to_pdf.svg")},EDIT_IMAGE:{intent:"editImage",divClass:"cc440d50ba-express-item-edit-image",iconPath:chrome.runtime.getURL("browser/images/express_edit.svg")}};constructor(){this.ready=this.init()}async init(){const e=fetch(chrome.runtime.getURL("resources/express/imageToolsDropdown.html")).then(e=>e.text()),t=import(chrome.runtime.getURL("content_scripts/express/express-cta-tooltip.js")).then(e=>e.default),s=expressUtils.addFontToDocument();[this.htmlData,this.ExpressCTATooltip]=await Promise.all([e,t,s])}toggleDropdown(e,t,s){return o=>{o.stopPropagation(),chrome?.runtime?.id||t?.remove();const n=t.getElementsByClassName(this.DROPDOWN_MENU_CLASS)[0];n?.classList.toggle(this.DROPDOWN_MENU_SHOW_CLASS),s?.classList.toggle("is-open"),this.tooltip&&this.tooltip.hideTooltip();const i=new URL(window.location.href).hostname;expressUtils.sendAnalyticsEvent([["DCBrowserExt:Image:EditDropdown:Shown",{domain:i,source:e,eventContext:state.expressState.mimeType},{frequency:"always"}]])}}async renderMenuButton(e,t){await this.ready;const s=document.createElement("div");s.innerHTML=this.htmlData,s.className=t,this.surface=t;const o=s.getElementsByClassName(this.ENTRY_POINT_BUTTON_CLASS)[0],n=new URL(window.location.href).hostname,i=state.expressState.mimeType,r={frequency:"always"};expressUtils.sendAnalyticsEvent([["DCBrowserExt:Image:EditOptions:CTA:Shown",{domain:n,source:t,eventContext:i},r]]),o.onclick=this.toggleDropdown(t,s,o).bind(this),this.button=o;return s.getElementsByClassName(this.ENTRY_POINT_BUTTON_ICON_CLASS_IMG)[0].src=chrome.runtime.getURL("browser/images/acrobat_prodc_appicon_24.svg"),Object.values(this.VERBS).forEach(n=>{const a=s.getElementsByClassName(n.divClass)[0];if(!a)return;a.getElementsByClassName(this.MENU_ITEM_ICON_IMG_CLASS)[0].src=n.iconPath,a.onclick=a=>{a.stopPropagation(),chrome?.runtime?.id||s.remove();const c=s.getElementsByClassName(this.DROPDOWN_MENU_CLASS)[0];c?.classList.remove(this.DROPDOWN_MENU_SHOW_CLASS),o?.classList.remove("is-open");const m=new URL(window.location.href).hostname;expressUtils.sendAnalyticsEvent([["DCBrowserExt:Image:EditDropdown:Verb:Clicked",{domain:m,workflow:n.intent,source:t,eventContext:i},r]]),e(n.intent)}}),util.translateElements(".translate",s),document.body.onclick=e=>{if(e.target.closest(`.${this.DROPDOWN_MENU_CLASS}`))return;const t=document.getElementsByClassName(this.DROPDOWN_MENU_SHOW_CLASS),s=document.getElementsByClassName("is-open");Array.from(t).forEach(e=>e.classList.remove(this.DROPDOWN_MENU_SHOW_CLASS)),Array.from(s).forEach(e=>e.classList.remove("is-open"))},s}attachTooltip(e,t=null){return this.tooltip=new this.ExpressCTATooltip({button:this.button,tooltipPosition:e,surface:this.surface,tooltipTextKey:"imageToolsContextMenuTooltip"}),this.tooltip.addTooltipToDOM(t),this.tooltip}}export default ImageToolsDropdown;