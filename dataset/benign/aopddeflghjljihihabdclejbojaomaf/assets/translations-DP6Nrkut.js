var w=Object.defineProperty;var f=(l,t,e)=>t in l?w(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var p=(l,t,e)=>f(l,typeof t!="symbol"?t+"":t,e);import{U as g,bn as k,b as S,bo as m,z as x,E,ak as z,bp as _}from"./academia-BTetjztC.js";class A{constructor(){p(this,"authorizationToken");p(this,"authorizationTokenExpires");p(this,"authorizationTokenExpiresDuration");this.authorizationToken="",this.authorizationTokenExpires=0,this.authorizationTokenExpiresDuration=6e4}async translate(t=[],e="",n=""){if(!t.length)return[];const i=await this.getAuthorizationToken(),a=t.map(h=>({Text:h.text}));return(await(await fetch(`https://api-edge.cognitive.microsofttranslator.com/translate?from=${e}&to=${n}&api-version=3.0&includeSentenceLength=true`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(a)})).json()).map(h=>h.translations[0].text)}async getAuthorizationToken(){if(Date.now()>this.authorizationTokenExpires){const t=await this.fetchAuthorizationToken();return this.authorizationTokenExpires=Date.now()+this.authorizationTokenExpiresDuration,t}return this.authorizationToken}async fetchAuthorizationToken(){const t=await fetch("https://edge.microsoft.com/translate/auth");return this.authorizationToken=await t.text(),this.authorizationToken}}class v{async translate(t=[],e="",n=""){var r;if(!t.length)return[];const{onlineParams:i}=S(),a=(r=i.value)==null?void 0:r.useNewGoogleTranslate;return await Promise.all(a?t.map(c=>this.translateWithLineBreaks(c.text,e,n)):t.map(c=>this.oldTranslateSingle(c.text,e,n)))}async translateWithLineBreaks(t,e="",n=""){if(!t)return"";const i=t.split(/(\r\n|\n|\r)/),a=[],s=[];for(let o=0;o<i.length;o++)o%2===0?a.push(i[o]):s.push(i[o]);const r=[],c=[];if(a.forEach((o,T)=>{o.trim()===""?c.push(T):r.push({text:o,originalIndex:T})}),r.length===0)return t;const h=await this.translateSingle(r.map(o=>o.text),e,n),u=[];let d=0;for(let o=0;o<a.length;o++)c.includes(o)?u.push(a[o]):(u.push(h[d]),d++),o<s.length&&u.push(s[o]);return u.join("")}async translateSingle(t,e="",n=""){const s=await(await fetch("https://translate-pa.googleapis.com/v1/translateHtml",{method:"POST",headers:{"Content-Type":"application/json+protobuf","X-Goog-Api-Key":"AIzaSyATBXajvzQLTDHEQbcpq0Ihe0vWDHmO520"},body:JSON.stringify([[t,e||"auto",n],"te_lib"])})).json();return Array.isArray(t)?s[0].map(c=>m(c)):m(s[0][0])}async oldTranslateSingle(t,e="",n=""){if(!t.trim())return t;const i=new URLSearchParams({client:"gtx",sl:e||"auto",tl:n,dt:"t",q:t}).toString();return(await(await fetch(`https://translate.googleapis.com/translate_a/single?${i}`)).json())[0].map(r=>r[0]).join("")}}class b{constructor(){p(this,"clientKey");this.clientKey=this.getClientKey()}getClientKey(){return`tencent_transmart_crx_${k(100)}`}async checkLanguage(t=[]){if(!t.length)return[];const e=t.map(s=>s.text).join(" "),n={header:{fn:"text_analysis",client_key:this.clientKey},normalize:{merge_broken_line:!1},text:e,type:"plain"};return(await(await fetch("https://transmart.qq.com/api/imt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json()).language}async translateSingle(t,e="",n=""){const i={header:{fn:"auto_translation_block",client_key:this.clientKey},source:{lang:e,text_block:t},target:{lang:n}},s=await(await fetch("https://transmart.qq.com/api/imt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();if(s!=null&&s.auto_translation)return s.auto_translation;throw new Error(s.message)}async translate(t=[],e="",n=""){return t.length?n?(e=e?e.includes("-")?e.split("-")[0]:e:await this.checkLanguage(t),n.includes("-")&&(n=n.split("-")[0]),await Promise.all(t.map(a=>this.translateSingle(a.text,e,n)))):t:[]}}class j{async getAccessToken(){const n=(await(await fetch("https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=es&widgetTheme=light&autoMode=false")).text()).match(/sid\:\s\'[0-9a-f\.]+/);return n&&n[0]&&n[0].length>7?n[0].substring(6):""}async translate(t=[],e="",n=""){if(!t.length)return[];if(!n)return t.map(h=>h.text);e=e?e.includes("-")?e.split("-")[0]:e:"",n=n.includes("-")?n.split("-")[0]:n;const i=await this.getAccessToken(),a=new URLSearchParams;a.append("srv","tr-url-widget"),a.append("id",`${i}-0-0`),a.append("format","text"),a.append("lang",`${e?`${e}-`:""}${n}`),t.forEach(h=>{a.append("text",h.text)});const s=a.toString();return(await(await fetch(`https://translate.yandex.net/api/v1/tr.json/translate?${s}`)).json()).text}}const y={[g.MICROSOFT]:A,[g.GOOGLE]:v,[g.TENCENT]:b,[g.YANDEX]:j};async function I(l){const{service:t,texts:e,from:n,to:i,type:a,requestId:s}=l;try{if(!x(t)&&y[t])return new y[t]().translate(e,n,i).then(c=>({code:E.SUCCESS,msg:"success",data:c.map(h=>({text:h}))})).catch(c=>({code:500,msg:c&&c.message?c.message:"network_error"}));{const r=z(t);return await _({texts:e,from:n,to:i,engine_code:r,requestId:s},a)}}catch(r){return{code:500,msg:r&&r.message?r.message:"network_error"}}}export{I as t};
