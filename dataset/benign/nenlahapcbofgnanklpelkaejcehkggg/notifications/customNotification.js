import{C as _,o as O}from"../chunks/chunk-NPIK4BSC.js";import"../chunks/chunk-XNVYV2NQ.js";import"../chunks/chunk-VCPNQHGQ.js";import"../chunks/chunk-N3S7YKRT.js";import"../chunks/chunk-HH5UG254.js";import"../chunks/chunk-EA7CGSTM.js";import"../chunks/chunk-AGWLSUX4.js";import{c as L}from"../chunks/chunk-MFH6BM6M.js";import"../chunks/chunk-N2ICXIKO.js";import"../chunks/chunk-JDXM4SX2.js";import"../chunks/chunk-NT3RH36Y.js";import{a as D,b as q}from"../chunks/chunk-XH6MVEJG.js";import{a as S}from"../chunks/chunk-CQXN2NRJ.js";import"../chunks/chunk-IPZXBZPC.js";import"../chunks/chunk-E2GNLB6L.js";import"../chunks/chunk-J7QHBV67.js";import"../chunks/chunk-VGEMM5MB.js";import"../chunks/chunk-JDV5FZKX.js";import"../chunks/chunk-BCG2KUGW.js";import"../chunks/chunk-WJZEHHRO.js";import{a as C}from"../chunks/chunk-HPSGHK7L.js";import"../chunks/chunk-GXPO46BF.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-XZWN3GGK.js";import{a as x}from"../chunks/chunk-2Q63MOXU.js";import"../chunks/chunk-DPMK7ZVG.js";import"../chunks/chunk-D3B67B3M.js";import{a as H}from"../chunks/chunk-H6FSK4DZ.js";import"../chunks/chunk-TYA5STFG.js";import{a as v}from"../chunks/chunk-2GAAOKGQ.js";import{c as k,q as N}from"../chunks/chunk-KJBXKQ52.js";import{h as y,o as p,q as F,v as m}from"../chunks/chunk-4XUWKJYA.js";import{a as b,b as W}from"../chunks/chunk-74K3EJN3.js";import"../chunks/chunk-W7K6NY26.js";import"../chunks/chunk-QWQLNDJC.js";import"../chunks/chunk-WXGZPSEB.js";import{F as f,z as $}from"../chunks/chunk-K2PA57PF.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{c as w}from"../chunks/chunk-AYDLOBCW.js";import"../chunks/chunk-JENJKWHP.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import"../chunks/chunk-BTBTC4NL.js";import{e as s}from"../chunks/chunk-3GYLW4KZ.js";var A=s(F()),c=s(w());var P=()=>m("getCustomNotification");var T=s($()),u=s(H()),r=s(w());W();var E=t=>m("engageCustomNotification",t);function h(){E()}var e=s(f()),g=class extends T.Component{constructor(...i){super(...i);let o,n=r.default.get(r.default.find(this.props.customNotificationData,"displaySequence"),"displaySequence",[]);n.length?o=n[0]:o=this.props.customNotificationData[0].display,this.state={rightOffset:310,notification:0,hideNotification:!0,dismiss:!1,progress:!1,displaySequence:n,...o}}componentDidMount(){p("page","customNotification",{view:"customNotification",type:"notification",offerSignUp:r.default.get(this.props.view,"offerSignUp"),qualified:r.default.get(this.props.view,"qualified",!1),balance:r.default.get(this.props.view,"balance",0)}),setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),this.setState({hideNotification:!1})},500)}render(){let{hideNotification:i,rightOffset:o}=this.state,n=!0,a=!0,l;return this.state.cta&&(l=(0,e.jsx)("div",{className:"button-wrapper",children:(0,e.jsx)("button",{className:"primary-btn-large",onClick:this.onClick.bind(this),children:this.state.cta})})),(0,e.jsx)(D,{className:i?"disabled follow-page":"follow-page",style:{top:n?"0":"auto",bottom:n?"auto":"0",left:a?"auto":"0",right:o},dragSelector:"header",onDragEnd:this.trackFirstDragEnd,children:(0,e.jsx)(u.Motion,{style:{opacity:(0,u.spring)(i?0:1,{stiffness:180,damping:20}),y:(0,u.spring)(i?n?-100:100:0,{stiffness:180,damping:20})},children:({opacity:M,y:R})=>(0,e.jsxs)("div",{className:"custom-notification",style:{transform:`translate3d(0,${R}%,0)`,opacity:`${M}`},children:[(0,e.jsxs)("header",{children:[(0,e.jsx)(v,{width:120}),(0,e.jsx)(L,{}),(0,e.jsx)(x,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,e.jsxs)("section",{children:[(0,e.jsx)("h2",{children:this.state.title}),this.state.progress?(0,e.jsx)(_,{estimatedDuration:5e3}):null,this.state.subtitle?(0,e.jsx)("h4",{className:"bold",children:this.state.subtitle}):null,l]})]})})})}trackFirstDragEnd=r.default.once((i,o)=>{q("customNotification",i,o)});onClick(){let{clickId:i,redirectId:o}=b();if(this.state.dropCookie&&O(i),this.state.sendShoppingEvent&&p("track","noCouponsNotify",{clickId:i,currentLocation:r.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),this.state.notification<this.state.displaySequence.length-1){let n=this.state.notification+1,a=this.state.displaySequence[n],l=()=>{this.setState({notification:n,...a}),this.state.timeout&&a.timeout===void 0&&this.setState({timeout:void 0}),n===this.state.displaySequence.length-1&&a.timeout&&setTimeout(()=>{this.onClosePopup()},this.state.timeout)};this.setState({progress:!!this.state.timeout}),setTimeout(()=>{l(),this.setState({progress:!1})},this.state.timeout*2||0)}else if(this.props.customNotificationData.url){h();let n={destUrl:this.props.customNotificationData.url,redirectId:o},a=C({params:n});window.open(a,"_blank"),p("trackClick","customNotificationClick","",{view:"customNotification",pageLocation:"notification",clickId:i})}else setTimeout(()=>{this.onClosePopup()},this.state.timeout||0)}onClosePopup(i){h(),this.setState({hideNotification:!0}),p("trackClick","dismissCustomNotification",i)}},d=k({view:["customView"],customNotificationData:["customNotificationData"],events:["events"],session:["session"]},g);var I=s(f());function U(t){if(t.type==="url")return!!document.URL.match(t.value);if(t.type==="title")return document.title.match(t.value);if(t.type==="selector")return!!(0,A.default)(t.value).length}function V(t){if(t.and)return(0,c.default)(t.and).map(o=>U(o)).filter().value().length===t.and.length;if(t.or)return!!(0,c.default)(t.or).map(o=>U(o)).filter().value().length}function j(t){return c.default.find(t,i=>V(i.identifiers))}function B(t,i){if(c.default.has(i,"runWithCoupons")){let o=!c.default.get(t,"coupons.ignoreSite");return!!(o&&i.runWithCoupons!==!1||!o)}return!0}async function z(){try{let t=await P();if(t&&t.engaged)return!1;let{siteData:i}=await S(),o=c.default.filter(i.notifications,a=>a.enabled!==!1&&B(i,a));j(o)&&o.length&&(y.set("customNotificationData",o),N({appName:"customNotification",cssUrl:"customNotification.css",app:(0,I.jsx)(d,{})}))}catch{}}document.readyState!=="loading"?z():document.addEventListener("DOMContentLoaded",z);
