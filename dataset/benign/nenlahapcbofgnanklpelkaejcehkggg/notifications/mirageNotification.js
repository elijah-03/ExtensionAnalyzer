import{a as tt}from"../chunks/chunk-XNVYV2NQ.js";import{c as Q,d as Z}from"../chunks/chunk-MFH6BM6M.js";import{b as N}from"../chunks/chunk-N2ICXIKO.js";import"../chunks/chunk-JDXM4SX2.js";import{a as F,b as X,d as Y}from"../chunks/chunk-XH6MVEJG.js";import{a as H}from"../chunks/chunk-CQXN2NRJ.js";import{c as W,d as j,e as J}from"../chunks/chunk-E2GNLB6L.js";import"../chunks/chunk-JDV5FZKX.js";import{a as z}from"../chunks/chunk-HPSGHK7L.js";import"../chunks/chunk-GXPO46BF.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-F2BE3OL5.js";import{a as R}from"../chunks/chunk-2Q63MOXU.js";import{a as K,b as V,e as $}from"../chunks/chunk-DPMK7ZVG.js";import"../chunks/chunk-D3B67B3M.js";import{a as wt}from"../chunks/chunk-H6FSK4DZ.js";import"../chunks/chunk-TYA5STFG.js";import{a as O}from"../chunks/chunk-2GAAOKGQ.js";import{c as U,m as L,q as D}from"../chunks/chunk-KJBXKQ52.js";import{a as p,c as bt,g as P,h as d,n as k,o as f,q as A,v as y}from"../chunks/chunk-4XUWKJYA.js";import{a as B,b as yt}from"../chunks/chunk-74K3EJN3.js";import"../chunks/chunk-WXGZPSEB.js";import{F as _,z as G}from"../chunks/chunk-K2PA57PF.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{c as q}from"../chunks/chunk-AYDLOBCW.js";import"../chunks/chunk-JENJKWHP.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import"../chunks/chunk-BTBTC4NL.js";import{e as c}from"../chunks/chunk-3GYLW4KZ.js";var mt=c(A()),m=c(q()),dt=c(bt());async function it(o,t){try{return await Z({pseudoDomain:o,contentProps:{supportedComponents:["extensionDefaultNotification"],programId:d.get(["siteAPIData","programId"]),storedVendorMetaId:d.get(["siteAPIData","siteData","cashback","id"]),...t},context:Y()})}catch(e){return console.error(e),null}}var et=o=>y("clearConquestThrottle",o);var ot=o=>y("getConquestThrottle",o);var rt=c(G()),w=c(wt()),at=c(A()),n=c(q());yt();var b=o=>y("setConquestThrottles",o);var s=c(_()),nt="activateMirageNotification",T,x,C=class extends rt.Component{constructor(...t){super(...t),this.state={hideNotification:!0}}componentDidMount(){let t=n.default.get(this.props.view,"actions",[]);n.default.each(t,i=>{let r=n.default.get(i,"type");["openNonLoyaltyUrl","openUrl"].includes(r)&&(T=n.default.get(i,"props.domain"),r==="openUrl"&&(x=n.default.get(i,"props.vendorMetaId")))}),f("page","mirageNotification",{view:"mirageNotification",type:"notification",destDomain:T,vendorMetaId:x,runId:n.default.get(this.props,"view.runId")});let e=Number(n.default.get(this.props.view,"launchDelayMS"))||1e3;setTimeout(()=>{this.setState({hideNotification:!1})},e)}render(){let{hideNotification:t}=this.state,{image:e,heading:i,subheading:r,cta:a}=this.props.view,l=!0;return t||f("page","mirageNotificationShown",{view:"mirageNotification",type:"notification",destDomain:T,vendorMetaId:x,runId:n.default.get(this.props,"view.runId"),ctaText:a?.value,headerText:i?.value,subheaderText:r?.value}),(0,s.jsx)(F,{className:t?"disabled mirage-notification":"mirage-notification",style:{top:"0",bottom:"auto",left:l?"auto":"0",right:l?"0":"auto"},children:(0,s.jsx)(w.Motion,{style:{opacity:(0,w.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,w.spring)(t?-100:0,{stiffness:180,damping:20})},dragSelector:"header",onDragEnd:this.trackFirstDragEnd,children:({opacity:u,y:g})=>(0,s.jsxs)("div",{className:"mirage-notification-content",style:{transform:`translate3d(0,${g}%,0)`,opacity:`${u}`},children:[(0,s.jsxs)("header",{children:[(0,s.jsx)(O,{width:120}),(0,s.jsx)(Q,{}),(0,s.jsx)(R,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,s.jsxs)("section",{children:[n.default.get(e,"src")?(0,s.jsx)("div",{className:"notification-image-wrapper",style:n.default.get(e,"wrapperStyle"),children:(0,s.jsx)("div",{className:"notification-image",style:{backgroundImage:`url("${n.default.get(e,"src")}")`,...n.default.get(e,"style",{})}})}):null,(0,s.jsx)("h2",{style:n.default.get(i,"style"),children:n.default.get(i,"value")}),(0,s.jsx)("h4",{style:n.default.get(r,"style"),children:n.default.get(r,"value","")}),(0,s.jsx)("div",{className:"button-wrapper",children:(0,s.jsx)("button",{className:"primary-btn-large",style:n.default.get(a,"style"),onClick:this.onClickCTA.bind(this),children:n.default.get(a,"value")})})]})]})})})}trackFirstDragEnd=n.default.once((t,e)=>{X("mirageNotification",t,e)});async onClickCTA(){b({domain:p(),throttleGroupId:this.props.view?.conquestThrottleGroupId,cacheValue:{conquestNotificationId:this.props.view?.conquestNotificationId,throttleDurationMs:this.props.view?.throttleDurationMs,conquestTriggerId:this.props.view?.conquestTriggerId,conquestTriggerNotificationId:this.props.view?.conquestTriggerNotificationId,conquestDomainId:this.props.view?.conquestDomainId,conquestDomainGroupId:this.props.view?.conquestDomainGroupId}});let{clickId:t,redirectId:e}=B();n.default.map(n.default.get(this.props.view,"actions"),i=>{let r=n.default.get(i,"props.vendorMetaId")||this.props.view.vendorMetaId;if(["openNonLoyaltyUrl","openUrl"].includes(i.type)&&n.default.get(i,"props.href")){let a=i.type==="openUrl"?this.getRedirectUrl(i,e,r):n.default.get(i,"props.href");window.open(a,"_blank","noopener noreferrer")}else if(i.type==="track")f("trackClick",i.event||nt,"",n.default.assign({clickId:t,redirectId:e,vendorMetaId:r,runId:n.default.get(this.props,"view.runId")},i.props));else if(i.type==="click")(0,at.default)(i.selector).click();else if(i.type==="pinnedTab"){let a=this.getRedirectUrl(i,e,r);this.pinnedTab(t,a)}}),this.setState({hideNotification:!0}),this.throttleNotif()}onClosePopup(t){b({domain:p(),throttleGroupId:this.props.view?.conquestThrottleGroupId,cacheValue:{conquestNotificationId:this.props.view?.conquestNotificationId,throttleDurationMs:this.props.view?.throttleDurationMs,conquestTriggerId:this.props.view?.conquestTriggerId,conquestTriggerNotificationId:this.props.view?.conquestTriggerNotificationId,conquestDomainId:this.props.view?.conquestDomainId,conquestDomainGroupId:this.props.view?.conquestDomainGroupId}}),this.setState({hideNotification:!0}),f("trackClick","dismissMirageNotification",t,{runId:n.default.get(this.props,"view.runId")}),this.throttleNotif()}throttleNotif(){let t=p();P({domain:t,message:"throttle"})}async pinnedTab(t,e){try{tt({url:e})}catch{}}getRedirectUrl(t,e,i){let r=n.default.get(t,"props.channel","cashback");return z({params:{channel:r,clickEvent:nt,credits:r==="cashback"||r==="cashback-ims",destUrl:n.default.get(t,"props.href"),destDomain:n.default.get(t,"props.destDomain")||n.default.get(t,"props.domain"),redirectId:e,subExperience:n.default.get(t,"props.subExperience")||"mirage_notification",vendorMetaId:i},isWbPublisher:!0})}},S=U({view:["mirageNotification"],events:["events"],session:["session"]},C);var I=c(G()),st=c(q());var ut=c(_());async function kt(o,t,e){let i=d.get("siteAPIData"),r={rootEl:"div",logLevel:null},a={siteAPIData:i,providedData:t,runId:e};k("ext_conquest_disable_blocks_native_throttling")||(a={...a,...(0,st.pick)(t,["throttleDurationMs","throttleKey"])});let l=await J();return{config:r,content:o,data:a,...l}}var ct=({content:o,providedData:t,onUnload:e,runId:i})=>{let[r,a]=(0,I.useState)();if((0,I.useEffect)(()=>{kt(o,t,i).then(u=>a(u)).catch(console.error)},[]),!r)return null;let l=u=>{let g=()=>{b({domain:p(),throttleGroupId:t.throttleGroup?.id,cacheValue:{conquestNotificationId:t.notification.id,throttleDurationMs:t.throttleDurationMs,conquestTriggerId:t.trigger.id,conquestTriggerNotificationId:t.triggerNotification.id,conquestDomainId:t.domain.id,conquestDomainGroupId:t.domainGroup.id}})};switch(u.eventName){case"conquest_cta":t.throttleDurationMs&&g();break}switch(u.type){case V.NotificationDismiss:t.throttleDurationMs&&g();break}return!1};return(0,ut.jsx)($,{client:K.DESKTOP_WEB,config:r.config,content:r.content,host:r.host,user:r.user,data:r.data,onEvent:u=>{l(u),W(u,e)},onRequest:j})};var M=c(_());window.__wb_timing.mirageNoteRequireAt=performance.now();var ft;function It(){ft?.()}var v,vt=async o=>{let{notification:t,throttleGroup:e}=o;if(t.blocksTemplate){let h={throttleKey:p(),throttleDurationMs:12096e5};return typeof e?.throttleDurationMS=="number"&&e?.id&&(h={throttleDurationMs:e.throttleDurationMS,throttleKey:e.id}),typeof t?.throttleDurationMS=="number"&&(h.throttleDurationMs=t.throttleDurationMS),{blocksTemplate:t.blocksTemplate,blocksData:{...o,...h},throttleDurationMs:h.throttleDurationMs,conquestNotificationId:t.id,conquestThrottleGroupId:e?.id}}let i=h=>{let E=new URL(h).hostname.split(".");return E.slice(E.length-2).join(".")},r="openUrl";t.skipRedirectService&&(r="openNonLoyaltyUrl");let a=t.cta,l=`${L}?domain=${t.domain}`,u=t.header,g=t.subHeader,_t=t.destDomain||i(t.url)||t.domain;return{image:{src:t.imageURL||l,style:{backgroundSize:t.imageBackgroundSize}},heading:{value:u},subheading:{value:g,style:{color:"green"}},cta:{value:a},actions:[{type:r,props:{vendorMetaId:t.vendorMetaId,href:t.url,channel:t.channel||"cashback",subExperience:t.subExperience,domain:t.domain,destDomain:_t}},{type:"track"}],throttleDurationMs:t.throttleDurationMS||12096e5,conquestNotificationId:t.id,conquestThrottleGroupId:e?.id,conquestDomainGroupId:o.domainGroup.id,conquestDomainId:o.domain.id,conquestTriggerId:o.trigger.id,conquestTriggerNotificationId:o.triggerNotification.id}};async function gt(o){if(!o)return;let t=document;if(t.deweyParser=mt.default,t.html=document.documentElement.innerHTML,await N.evaluateIdentifierTree(o,t))return!0}var lt=async(o,t,e)=>{let i=await ot({domain:t,throttleGroupId:e});if(i){if(i.startThrottleTime+i.throttleDurationMs>Date.now())return f("page","conquestNotificationThrottled",{type:"notification",runId:o,meta:JSON.stringify({conquestNotificationId:i.conquestNotificationId||null,conquestThrottleGroupId:i.conquestThrottleGroupId||null,conquestTriggerId:i.conquestTriggerId||null,conquestTriggerNotificationId:i.conquestTriggerNotificationId||null,conquestDomainId:i.conquestDomainId||null,conquestDomainGroupId:i.conquestDomainGroupId||null})}),!0;await et({domain:t,throttleGroupId:e})}return!1};async function ht(o){if(v)return;let t=(0,dt.v4)(),e=p();if(k("ext_throttle_before_conquest_notification")&&await lt(t,e))return;let i=null,r=await it(p(),{deweyResult:o,runId:t});if(!(0,m.isEmpty)(r?.notification))i=await vt(r);else return;if(!v&&!await lt(t,e,i.conquestThrottleGroupId)){if(typeof i?.blocksTemplate=="string"&&i.blocksTemplate.length){let{blocksTemplate:a,blocksData:l}=i;v=!0,ft=(await D({appName:"blocksNotification",blankSlate:!0,app:(0,M.jsx)(ct,{content:a,providedData:l,onUnload:It,runId:t})})).unloadApp}else if(i&&!i.error&&(m.default.get(i,"heading.value")||m.default.get(i,"subheading.value")||m.default.get(i,"cta.value"))){if(m.default.get(i,"skipNotification")===!0){f("track","mirageNotificationSkipped");return}i.runId=t,d.set("mirageNotification",i),v=!0,D({appName:"mirageNotification",cssUrl:"mirageNotification.css",app:(0,M.jsx)(S,{})})}}}async function pt(){try{let{siteData:o}=await H(),t=await gt(m.default.get(o,"mirageNotification.identifiers")),e=d.get(["deweyResult"]);e&&t?await ht(e):qt(o)}catch(o){console.log(o)}}function qt(o){let t=m.default.throttle(async e=>{await gt(m.default.get(o,"mirageNotification.identifiers"))&&await ht(e)},1e3);N.emitter.on("result",t)}document.readyState!=="loading"?pt():document.addEventListener("DOMContentLoaded",pt);
