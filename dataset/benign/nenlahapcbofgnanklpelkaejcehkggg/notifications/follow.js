import{a as T}from"../chunks/chunk-57TRHH3E.js";import{a as R}from"../chunks/chunk-6JGDJAZ5.js";import{a as D}from"../chunks/chunk-CQXN2NRJ.js";import"../chunks/chunk-IPZXBZPC.js";import"../chunks/chunk-E2GNLB6L.js";import{a as I}from"../chunks/chunk-UW4IVTWM.js";import{a as P}from"../chunks/chunk-6ILBPYHJ.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-XZWN3GGK.js";import{a as S}from"../chunks/chunk-2Q63MOXU.js";import"../chunks/chunk-DPMK7ZVG.js";import"../chunks/chunk-D3B67B3M.js";import{a as Y}from"../chunks/chunk-H6FSK4DZ.js";import"../chunks/chunk-TYA5STFG.js";import{a as N}from"../chunks/chunk-2GAAOKGQ.js";import{c as v,q as C}from"../chunks/chunk-KJBXKQ52.js";import{h as r,o as d,v as f}from"../chunks/chunk-4XUWKJYA.js";import{F as _,z}from"../chunks/chunk-K2PA57PF.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{b as $,c as g}from"../chunks/chunk-AYDLOBCW.js";import"../chunks/chunk-JENJKWHP.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import"../chunks/chunk-BTBTC4NL.js";import{e as p}from"../chunks/chunk-3GYLW4KZ.js";var A=p($()),x=p(g());var V=p(z()),w=p(Y()),n=p(g());var c=p(g());var F=e=>f("addVote",e);var M=e=>f("getFeedbackData",e);function u(e){return e=e==="video"?"review":e,e==="advice"?e:`${e}s`}async function H(){let e=r.get(["ProductPage","inputData","product"]),t=r.get(["ProductPage","inputData","asin"]),i=r.get(["ProductPage","inputData","feedback"]),o=r.get(["session","id"]),l=e&&e.wbpid?e.wbpid:`amazon.com_${t}`,s=await M({wbpid:l,userId:o,product:e,meta:i});r.set(["ProductPage","feedbackData"],s)}function L(e,t){let i=(t||e).split(".")[0];i==="video"&&(i="review");let o=r.get(["ProductPage","feedbackData"]),l;if(t){let s=c.default.find(o[u(i)],{id:t});l=c.default.find(c.default.get(s,"comments"),{id:e})}else o&&(l=c.default.find(o[u(i)],{id:e}));return{feedback:l,type:i}}function E({feedback:e,updatedFeedback:t,type:i,data:o}){o.parent_id?(r.select(["ProductPage","feedbackData",u(i),{id:o.parent_id}]).set(["comments",{id:o.id}],t),o.parent_id===r.get(["selectedFeedback","id"])&&r.set(["selectedFeedback","comments",{id:o.id}],t)):(r.merge(["ProductPage","feedbackData",u(i),{id:o.id}],t),e.id===r.get(["selectedFeedback","id"])&&r.set(["selectedFeedback"],t))}function j({feedback:e,type:t}){let i=r.get(["ProductPage","feedbackData",u(t)]);i&&(i.push(e),r.set(["ProductPage","feedbackData",u(t)],i),r.commit())}async function b(e){let t=r.get(["session","id"]),{feedback:i,type:o}=L(e.id,e.parent_id);function l(s){return s=c.default.clone(s),s.up_votes=s.up_votes||0,s.down_votes=s.down_votes||0,s.up_votes=e.upVote?s.up_votes+1:s.up_votes,s.down_votes=e.upVote?s.down_votes:s.down_votes+1,s.vote_selection==="up_vote"&&(s.up_votes-=1),s.vote_selection==="down_vote"&&(s.down_votes-=1),s.vote_selection=e.upVote?"up_vote":"down_vote",s}if(i){let s=l(i);E({feedback:i,updatedFeedback:s,type:o,data:e})}else{let s=l(e);j({feedback:s,type:o})}await F(c.default.assign({userId:t},e)),await H()}var O=e=>f("toggleMatchSurvey",e);var a=p(_()),y=class extends V.Component{constructor(...t){super(...t),this.state={title:"Was this a good result?",subtitle:"Your feedback helps other Capital One Shoppers.",hideNotification:!0,showReasons:!1,showComment:!1,selectedReasons:[],reasonText:"",dismiss:!1}}componentDidMount(){d("page","matchSurvey",{view:"matchSurvey",type:"notification",offerSignUp:n.default.get(this.props.view,"offerSignUp"),qualified:n.default.get(this.props.view,"qualified",!1),balance:n.default.get(this.props.view,"balance",0)}),setTimeout(()=>{this.setState({hideNotification:!1})},1e3)}componentWillReceiveProps(t){n.default.get(t,"view.hiddenFromWebApp")&&!n.default.get(this.props,"view.hiddenFromWebApp")&&this.setState({hideNotification:!0})}onChange(t,i){if(i.type==="input")return;let o=this.state.selectedReasons,l=o.indexOf(t);l===-1?o.push(t):o.splice(l,1),this.setState({selectedReasons:o})}onTextUpdate(t){let i=t.target.value;this.setState({reasonText:i})}renderReasons(){let t=["Not the same product","Price is incorrect","Out of stock","Item condition","Bad seller","Other"],i;return this.state.showReasons&&(i=n.default.map(t,(o,l)=>{let s=this.state.selectedReasons.indexOf(o)!==-1;return(0,a.jsxs)("div",{className:"reason",children:[(0,a.jsx)("input",{type:"checkbox",checked:s,onChange:this.onChange.bind(this,o),id:n.default.kebabCase(o)}),(0,a.jsx)("label",{htmlFor:n.default.kebabCase(o),children:(0,a.jsx)("h5",{className:"text",children:o})})]},n.default.kebabCase(o))})),(0,a.jsxs)("div",{className:"reasons-wrapper",children:[i,(0,a.jsx)("textarea",{placeholder:"tell us more",value:this.state.reasonText,onChange:this.onTextUpdate.bind(this)}),(0,a.jsx)("button",{className:"primary-btn-small",onClick:this.onSubmit.bind(this),children:"Submit"})]})}render(){let{hideNotification:t}=this.state,i=this.state.title,o=this.state.subtitle,l=!1,s=!1,m;return this.state.showReasons||this.state.showComment?m=this.renderReasons():this.state.dismiss||this.state.buttonsHidden?m=(0,a.jsx)("div",{className:"thanks-wrapper"}):m=(0,a.jsxs)("div",{className:"button-wrapper",children:[(0,a.jsx)("button",{className:"secondary-btn-small",onClick:this.onYes.bind(this),children:"Yes"}),(0,a.jsx)("button",{className:"secondary-btn-small",onClick:this.onNo.bind(this),children:"No"})]}),(0,a.jsx)("div",{className:t?"disabled follow-page":"follow-page",style:{top:l?"0":"auto",bottom:l?"auto":"0",left:s?"auto":"0",right:s?"0":"auto"},children:(0,a.jsx)(w.Motion,{style:{opacity:(0,w.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,w.spring)(t?l?-100:100:0,{stiffness:180,damping:20})},children:({opacity:q,y:W})=>(0,a.jsxs)("div",{className:"follow-notification",style:{transform:`translate3d(0,${W}%,0)`,opacity:`${q}`},children:[(0,a.jsxs)("header",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(N,{}),(0,a.jsx)(S,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{children:i}),o?(0,a.jsx)("h4",{children:o}):null,m]})]})})})}onYes(){let t=n.default.get(this.props,"view.resultData");b({up_votes:0,down_votes:0,id:`product.${n.default.get(t,"details.product.wbpid")}`,wbpid:n.default.get(t,"run.originResult.product.wbpid"),match_wbpid:n.default.get(t,"details.product.wbpid"),upVote:!0}),this.onNotificationInteraction(),this.setState({match:!0,title:"Thanks!",subtitle:"Your vote helps improve results for everyone on Capital One Shopping.",buttonsHidden:!0}),this.timeout=setTimeout(()=>{this.setState({hideNotification:!0})},2500);let i={match:!0,quoteId:n.default.get(t,"run.id"),matchId:n.default.get(t,"details.id"),notification:!0,mpnBrandMatch:n.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:n.default.get(t,"details.certifiedRefurbished",!1)};d("track","matchSurvey",i)}onNo(){let t=n.default.get(this.props,"view.resultData");b({up_votes:0,down_votes:0,id:`product.${n.default.get(t,"details.product.wbpid")}`,wbpid:n.default.get(t,"run.originResult.product.wbpid"),match_wbpid:n.default.get(t,"details.product.wbpid"),upVote:!1}),this.onNotificationInteraction(),this.setState({match:!1,showReasons:!0,showComment:!0,title:"Uh oh!",subtitle:"What was wrong with this result?"});let i={match:!1,quoteId:n.default.get(t,"run.id"),matchId:n.default.get(t,"details.id"),notification:!0,mpnBrandMatch:n.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:n.default.get(t,"details.certifiedRefurbished",!1)};d("track","matchSurvey",i)}onSubmit(){this.onNotificationInteraction();let t=n.default.get(this.props,"view.resultData"),i={match:this.state.match,quoteId:t.run.id,matchId:t.details.id,notification:!0};this.state.reasonText&&(i.text=this.state.reasonText),this.state.selectedReasons&&this.state.selectedReasons.length&&(i.reason=n.default.get(this.state.selectedReasons,"[0]"),i.reasons=this.state.selectedReasons),d("track","matchSurveyReason",i),this.setState({dismiss:!0,showReasons:!1,showComment:!1,title:"Thanks for helping!",subtitle:"The next Capital One Shopper will benefit from your contribution."}),setTimeout(()=>this.onClosePopup("submit"),3200)}onClosePopup(t){this.onNotificationInteraction(),this.setState({hideNotification:!0}),d("trackClick","dismissMatchSurvey",t)}onNotificationInteraction(){O(n.default.get(this.props,"view.resultData"))}componentWillUnmount(){clearTimeout(this.timeout)}},k=v({view:["followView"],events:["events"],session:["session"]},y);var h=p(_());window.__wb_timing.followRequireAt=performance.now();function G(){return A.default.all([P(),D(),R()]).spread((e,t,i)=>{I(e),r.merge({siteAPIData:t}),r.set("lifetimeSavings",i)})}var B;function X(){B?.()}async function U(){await G();let e=r.get(["followView","resultData"]),t=x.default.get(e,"details.pricing.coupons.length"),i=x.default.get(e,"origin")==="email";B=(await C({appName:"follow",cssUrl:"follow.css",app:(0,h.jsx)(h.Fragment,{children:t||i?(0,h.jsx)(T,{onUnload:X,blocksSlug:"savings-notification"}):(0,h.jsx)(k,{})})})).unloadApp}document.readyState!=="loading"?U():document.addEventListener("DOMContentLoaded",U);
