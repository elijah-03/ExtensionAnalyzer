LavaPack.loadBundle([[2549,{"../fsm.cjs":2531,"../logging.cjs":2538,"../utils.cjs":2562,"./Timer.cjs":2550,"./constants.cjs":2551,"./location/index.cjs":2554,"./registry/index.cjs":2558,"./selectors.cjs":2561,"@metamask/approval-controller":1198,"@metamask/base-controller":1297,"@metamask/permission-controller":2329,"@metamask/rpc-errors":2480,"@metamask/snaps-rpc-methods":2611,"@metamask/snaps-sdk":2667,"@metamask/snaps-utils":2781,"@metamask/utils":2914,"@xstate/fsm":3387,"async-mutex":3702,nanoid:4834,semver:5411},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const l=e("@metamask/approval-controller"),u=e("@metamask/base-controller"),d=e("@metamask/permission-controller"),p=e("@metamask/rpc-errors"),h=e("@metamask/snaps-rpc-methods"),f=e("@metamask/snaps-sdk"),m=e("@metamask/snaps-utils"),g=e("@metamask/utils"),y=e("@xstate/fsm"),b=e("async-mutex"),_=e("nanoid"),v=e("semver"),w=e("./constants.cjs"),S=e("./location/index.cjs"),E=e("./registry/index.cjs"),T=e("./selectors.cjs"),k=e("./Timer.cjs"),P=e("../fsm.cjs"),O=e("../logging.cjs"),M=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const A=new Set(["initialPermissions","id","version","enabled","blocked"]),j={snaps:{},snapStates:{},unencryptedSnapStates:{}};function R(e){return Object.keys(e).reduce((t,n)=>(A.has(n)&&(t[n]=e[n]),t),{})}var I=new WeakMap,C=new WeakMap,N=new WeakMap,x=new WeakMap,L=new WeakMap,D=new WeakMap,U=new WeakMap,$=new WeakMap,G=new WeakMap,F=new WeakMap,H=new WeakMap,q=new WeakMap,B=new WeakMap,V=new WeakMap,Y=new WeakMap,W=new WeakMap,z=new WeakMap,K=new WeakMap,J=new WeakMap,Q=new WeakMap,Z=new WeakMap,X=new WeakSet,ee=new WeakMap;class te extends u.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["endowment:caip25","wallet_snap"],environmentEndowmentPermissions:d=[],excludedPermissions:p={},idleTimeCheckInterval:h=(0,g.inMilliseconds)(5,g.Duration.Second),maxIdleTime:y=(0,g.inMilliseconds)(30,g.Duration.Second),maxRequestTime:b=(0,g.inMilliseconds)(60,g.Duration.Second),fetchFunction:_=globalThis.fetch.bind(undefined),featureFlags:v={},detectSnapLocation:E=S.detectSnapLocation,preinstalledSnaps:T=null,encryptor:k,getMnemonicSeed:P,getFeatureFlags:O=()=>({}),clientCryptography:A,trackEvent:R,ensureOnboardingComplete:te}){var ae,oe,ce;super({messenger:t,metadata:{snapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},unencryptedSnapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},snaps:{includeInStateLogs:e=>Object.values(e).reduce((e,t)=>{const n={...t};return delete n.sourceCode,delete n.auxiliaryFiles,e[t.id]=n,e},{}),persist:e=>Object.values(e).filter(e=>e.status!==m.SnapStatus.Installing).map(e=>({...e,status:m.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:n.controllerName,state:{...j,...l}}),i(oe=this,ce=X),ce.add(oe),s(this,I,void 0),s(this,C,void 0),s(this,N,void 0),s(this,x,void 0),s(this,L,void 0),s(this,D,void 0),s(this,U,void 0),s(this,$,void 0),r(this,"maxRequestTime",void 0),s(this,G,void 0),s(this,F,void 0),s(this,H,void 0),s(this,q,void 0),s(this,B,void 0),s(this,V,void 0),s(this,Y,void 0),s(this,W,void 0),s(this,z,void 0),s(this,K,void 0),s(this,J,void 0),s(this,Q,void 0),s(this,Z,void 0),s(this,ee,(0,M.debouncePersistState)((e,t,n)=>{c(X,this,Qe).call(this,e).stateMutex.runExclusive(async()=>{const r=await c(X,this,be).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=r}):this.update(t=>{t.unencryptedSnapStates[e]=r})}).catch(m.logError)},w.STATE_DEBOUNCE_TIMEOUT)),o(I,this,e),o(C,this,u),o(N,this,d),o(x,this,p),o(L,this,v),o(D,this,_),o(U,this,h),o($,this,y),this.maxRequestTime=b,o(B,this,E),o(G,this,k),o(F,this,P),o(H,this,O),o(q,this,A),o(K,this,T),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(Y,this,new Map),o(V,this,new Map),o(J,this,R),o(Z,this,te),c(X,this,ie).call(this),this.messenger.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(X,this,at).call(this,t,e,m.HandlerType.OnInstall).catch(t=>{(0,m.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,f.getErrorMessage)(t)}`)})}),this.messenger.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{c(X,this,at).call(this,n,e,m.HandlerType.OnUpdate).catch(t=>{(0,m.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,f.getErrorMessage)(t)}`)})}),this.messenger.subscribe("KeyringController:lock",c(X,this,ot).bind(this)),c(X,this,ne).call(this),c(X,this,re).call(this),Object.values((null===(ae=this.state)||void 0===ae?void 0:ae.snaps)??{}).forEach(e=>c(X,this,Ze).call(this,e.id)),a(K,this)&&c(X,this,se).call(this,a(K,this)),o(Q,this,(0,M.throttleTracking)((e,t,n,r)=>{const s=this.messenger.call("SnapsRegistry:getMetadata",e);a(J,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==s?void 0:s.category,success:n,origin:r}})}))}init(){c(X,this,it).call(this,w.METAMASK_ORIGIN,m.HandlerType.OnStart)}async updateRegistry(){await c(X,this,ue).call(this),await this.messenger.call("SnapsRegistry:update");const e=await this.messenger.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));if(await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===E.SnapsRegistryStatus.Blocked?c(X,this,ae).call(this,e,n):c(X,this,oe).call(this,e))),!a(L,this).autoUpdatePreinstalledSnaps)return;await Promise.allSettled(Object.values(this.state.snaps).filter(e=>e.preinstalled).map(async e=>{const t=await c(X,this,Oe).call(this,e.id,"*");if("*"!==t&&(0,g.gtVersion)(t,e.version)){const n=a(B,this).call(this,e.id,{versionRange:t,fetch:a(D,this),allowLocal:!1,useNpmProxy:!0});await c(X,this,Pe).call(this,{origin:l.ORIGIN_METAMASK,snapId:e.id,location:n,versionRange:t,automaticUpdate:!0})}}))}_onUnhandledSnapError(e,t){(0,m.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,m.SnapStatusEvents.Crash).catch(e=>{(0,m.logError)(e)})}_onOutboundRequest(e){const t=c(X,this,Qe).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(X,this,Qe).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){await c(X,this,ue).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(X,this,Ae).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messenger.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,m.SnapStatusEvents.Stop),this.messenger.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=m.SnapStatusEvents.Stop){const n=c(X,this,Je).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:r,resolve:s}=(0,g.createDeferredPromise)();n.stopPromise=r;try{var i;if(this.isRunning(e))null===(i=a(I,this))||void 0===i||i.call(this,e),await c(X,this,he).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&c(X,this,pe).call(this,e,t),s()}}async stopAllSnaps(e=m.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,g.assert)(t!==undefined,`Snap "${e}" not found.`),t}getTruncated(e){const t=this.get(e);return t?R(t):null}getTruncatedExpect(e){return R(this.getExpect(e))}async updateSnapState(e,t,n){const r=c(X,this,Qe).call(this,e);n?r.state=t:r.unencryptedState=t,a(ee,this).call(this,e,t,n)}clearSnapState(e,t){const n=c(X,this,Qe).call(this,e);t?n.state=null:n.unencryptedState=null,a(ee,this).call(this,e,null,t)}async getSnapState(e,t){const n=c(X,this,Qe).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const r=t?n.state:n.unencryptedState;if(r!==undefined)return r;const s=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===s||s===undefined)return null;if(!t){const e=JSON.parse(s);return n.unencryptedState=e,e}const i=await c(X,this,ge).call(this,e,s);return n.state=i,i})}async getSnapFile(e,t,n=f.AuxiliaryFileEncoding.Base64){var r;const s=this.getExpect(e),i=(0,m.normalizeRelative)(t),a=null===(r=s.auxiliaryFiles)||void 0===r||null===(r=r.find(e=>e.path===i))||void 0===r?void 0:r.value;if(!a)return null;const o=await(0,m.encodeAuxiliaryFile)(a,n);return(0,g.assert)(o.length<m.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:r}=n.manifest;return!!r&&(0,v.gte)(r,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>c(X,this,Se).call(this,e)),this.update(e=>{e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),a(V,this).clear(),a(Y,this).clear(),a(K,this)&&c(X,this,se).call(this,a(K,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,g.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),c(X,this,Se).call(this,e),c(X,this,we).call(this,e),a(V,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==m.SnapStatus.Installing&&this.messenger.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,r;const s=this.messenger.call("PermissionController:getPermissions",e),i=null==s||null===(n=s[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(!i)return;if(Boolean(null===(r=i.value)||void 0===r?void 0:r[t])){const n={...i.value};delete n[t],Object.keys(n).length>0?this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,n):this.messenger.call("PermissionController:revokePermissions",{[e]:[h.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,g.assert)(t.every(e=>a(C,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messenger.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(X,this,Qe).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(X,this,Qe).call(this,e);(0,g.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(R)}getRunnableSnaps(){return(0,T.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messenger.call("PermissionController:getPermissions",e)??{})[h.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===m.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),r=this.getTruncated(t);return r&&(null==n?void 0:n.status)!==m.SnapStatus.Installing&&(e[t]=r),e},{})}async installSnaps(e,t){await c(X,this,ue).call(this);const n={},r=Object.keys(t),s=[],i=[];try{for(const[r,{version:o}]of Object.entries(t)){(0,m.assertIsValidSnapId)(r);const[t,l]=(0,m.resolveVersionRange)(o);if(t)throw p.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=a(B,this).call(this,r,{versionRange:l,fetch:a(D,this),allowLocal:a(L,this).allowLocalSnaps,resolveVersion:async e=>a(L,this).requireAllowlist?await c(X,this,Oe).call(this,r,e):e}),d=this.has(r)&&!u.shouldAlwaysReload;if(d&&c(X,this,st).call(this,r,l)){const e=this.getExpect(r);s.push({snapId:r,oldVersion:e.version});let t=c(X,this,Ye).call(this,r);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(X,this,We).call(this,r),t.newVersion=l}else d||i.push(r);n[r]=await c(X,this,Ee).call(this,e,r,u,l)}i.forEach(t=>this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),s.forEach(({snapId:t,oldVersion:n})=>this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),r.forEach(e=>a(Y,this).delete(e))}catch(e){const t=i.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...a(Y,this).keys()],r=s.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await c(X,this,Ke).call(this,r),e}return n}destroy(){super.destroy(),a(W,this)&&clearTimeout(a(W,this)),this.messenger.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.clearEventSubscriptions("SnapController:snapInstalled"),this.messenger.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:r}){await c(X,this,ue).call(this);const s=this.get(e);(0,g.assert)(s,`The Snap "${e}" is not installed. Please install it before invoking it.`),(0,g.assert)(t===w.METAMASK_ORIGIN||(0,m.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const i={jsonrpc:"2.0",id:(0,_.nanoid)(),...r};(0,g.assertIsJsonRpcRequest)(i);const a=h.handlerEndowments[n];(0,g.assert)("string"==typeof a||null===a,"'permissionName' must be either a string or null.");const o=this.messenger.call("PermissionController:getPermissions",e);if(!(null===a||o&&(0,g.hasProperty)(o,a)))throw new Error(`Snap "${e}" is not permitted to use "${a}".`);const l=a?o[a]:undefined;if(a===h.SnapEndowments.Rpc||a===h.SnapEndowments.Keyring){(0,g.assert)(l);const n=this.messenger.call("SubjectMetadataController:getSubjectMetadata",t),r=a===h.SnapEndowments.Rpc?(0,h.getRpcCaveatOrigins)(l):(0,h.getKeyringCaveatOrigins)(l);if((0,g.assert)(r),!(0,m.isOriginAllowed)(r,(null==n?void 0:n.subjectType)??d.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==w.METAMASK_ORIGIN&&w.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!s.enabled)throw new Error(`Snap "${e}" is disabled.`);if(s.status===m.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const u=c(X,this,xe).call(this,l),p=c(X,this,Qe).call(this,e);if(p.stopPromise&&await p.stopPromise,!this.isRunning(e)){p.startPromise||(p.startPromise=this.startSnap(e));try{await p.startPromise}finally{p.startPromise=null}}const f=c(X,this,He).call(this,e,n,i),y=new k.Timer(u);c(X,this,Be).call(this,e,f.id,y);const b=this.messenger.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:f});try{const r=await(0,M.withTimeout)(b,y);if(r===M.hasTimedOut){const t=null!==p.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(X,this,qe).call(this,e,n,r);const s=await c(X,this,Ue).call(this,e,n,f,r);return c(X,this,Ve).call(this,e,f.id,n,t,!0),s}catch(r){c(X,this,Ve).call(this,e,f.id,n,t,!1);const[s,i]=(0,m.unwrapError)(r),a=null!==p.stopPromise||!this.isRunning(e);throw i||(a||(0,m.logError)(`"${e}" crashed due to an unhandled error:`,s),await this.stopSnap(e,m.SnapStatusEvents.Crash)),s}}setClientActive(e){e?c(X,this,it).call(this,w.METAMASK_ORIGIN,m.HandlerType.OnActive):c(X,this,it).call(this,w.METAMASK_ORIGIN,m.HandlerType.OnInactive)}}function ne(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:m.SnapStatus.Installing,states:{[m.SnapStatus.Installing]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e}}},[m.SnapStatus.Updating]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped}},[m.SnapStatus.Running]:{on:{[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped,[m.SnapStatusEvents.Crash]:m.SnapStatus.Crashed}},[m.SnapStatus.Stopped]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}},[m.SnapStatus.Crashed]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}}}};o(z,this,(0,y.createMachine)(t)),(0,P.validateMachine)(a(z,this))}function re(){this.messenger.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messenger.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messenger.registerActionHandler(`${n.controllerName}:updateRegistry`,async()=>this.updateRegistry()),this.messenger.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messenger.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messenger.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messenger.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function se(e){for(const{snapId:n,manifest:r,files:s,removable:i,hidden:a,hideSnapBranding:o}of e){var t;const e=this.get(n),l=e!==undefined,u=l&&(0,g.gtVersion)(r.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const d=new m.VirtualFile({path:m.NpmSnapFileNames.Manifest,value:JSON.stringify(r),result:r}),p=s.map(({path:e,value:t})=>new m.VirtualFile({value:t,path:e})),{filePath:f,iconPath:y}=r.source.location.npm,b=p.find(e=>e.path===f),_=y?p.find(e=>e.path===y):undefined;(0,g.assert)(b,"Source code not provided for preinstalled snap."),(0,g.assert)(!y||y&&_,"Icon not provided for preinstalled snap."),(0,g.assert)(r.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const v=(null===(t=r.source.locales)||void 0===t?void 0:t.map(e=>p.find(t=>t.path===e)))??[],S=(0,m.getValidatedLocalizationFiles)(v.filter(Boolean));(0,g.assert)(v.length===S.length,"Missing localization files for preinstalled snap.");const E={manifest:d,sourceCode:b,svgIcon:_,auxiliaryFiles:[],localizationFiles:S};c(X,this,Re).call(this,{id:n,origin:w.METAMASK_ORIGIN,files:E,removable:i,hidden:a,hideSnapBranding:o,preinstalled:!0});const T=(0,h.processSnapPermissions)(r.initialPermissions);c(X,this,Ie).call(this,T);const{newPermissions:k,unusedPermissions:P}=c(X,this,et).call(this,n,T);c(X,this,rt).call(this,{snapId:n,newPermissions:k,unusedPermissions:P}),r.initialConnections&&c(X,this,_e).call(this,n,(null==e?void 0:e.initialConnections)??null,r.initialConnections),this.update(e=>{e.snaps[n].status=m.SnapStatus.Stopped}),c(X,this,Ze).call(this,n),u?this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,w.METAMASK_ORIGIN,!0):this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),w.METAMASK_ORIGIN,!0)}}function ie(){o(W,this,setTimeout(()=>{c(X,this,de).call(this).catch(e=>{(0,m.logError)(e)}),c(X,this,ie).call(this)},a(U,this)))}async function ae(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,m.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messenger.publish(`${n.controllerName}:snapBlocked`,e,t)}}function oe(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messenger.publish(`${n.controllerName}:snapUnblocked`,e))}async function ce(e,{platformVersion:t,...n}){const r=(await this.messenger.call("SnapsRegistry:get",{[e]:n}))[e];var s;if(r.status===E.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(s=r.reason)||void 0===s?void 0:s.explanation)??""}`);const i=Object.keys(n.permissions).some(e=>!w.ALLOWED_PERMISSIONS.includes(e));if(a(L,this).requireAllowlist&&i&&r.status!==E.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${r.status===E.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(X,this,Ce).call(this,e,t)}function le(){(0,g.assert)(!0!==a(L,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}async function ue(){await a(Z,this).call(this);const e=a(H,this).call(this);(0,g.assert)(!0!==e.disableSnaps,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function de(){const e=[...a(V,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&a($,this)&&(0,g.timeSince)(t.lastRequest)>a($,this)).map(async([e])=>this.stopSnap(e,m.SnapStatusEvents.Stop)))}function pe(e,t){const{interpreter:n}=c(X,this,Qe).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function he(e){await this.messenger.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(X,this,Qe).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messenger.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function fe(e,t=c(X,this,Qe).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function me({snapId:e,salt:t,useCache:n,keyMetadata:r}){const s=c(X,this,Qe).call(this,e);if(c(X,this,fe).call(this,e,s)&&n)return{key:await a(G,this).importKey(s.encryptionKey),salt:s.encryptionSalt};const i=t??a(G,this).generateSalt(),o=await a(F,this).call(this),l=await(0,h.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:a(q,this)}),u=await a(G,this).keyFromPassword(l,i,!0,r),d=await a(G,this).exportKey(u);return n&&(s.encryptionKey=d,s.encryptionSalt=i),{key:u,salt:i}}async function ge(e,t){try{const n=JSON.parse(t),{salt:r,keyMetadata:s}=n,i=c(X,this,fe).call(this,e)||a(G,this).isVaultUpdated(t),{key:o}=await c(X,this,me).call(this,{snapId:e,salt:r,useCache:i,keyMetadata:s??w.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await a(G,this).decryptWithKey(o,n)}catch{throw p.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function ye(e,t){const{key:n,salt:r}=await c(X,this,me).call(this,{snapId:e,useCache:!0}),s=await a(G,this).encryptWithKey(n,t);return s.salt=r,JSON.stringify(s)}async function be(e,t,n){return null===t?null:n?await c(X,this,ye).call(this,e,t):JSON.stringify(t)}function _e(e,t,n){if(t){const r=(0,M.setDiff)(t,n);for(const t of Object.keys(r))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))c(X,this,ve).call(this,t,e)}function ve(e,t){var n,r;const s=this.messenger.call("PermissionController:getPermissions",e),i=null==s||null===(n=s[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(Boolean(null==i||null===(r=i.value)||void 0===r?void 0:r[t]))return;if(i)return void this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,{...i.value,[t]:{}});const a={[h.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:m.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:a,subject:{origin:e}})}function we(e){const t=this.messenger.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function Se(e){this.messenger.call("PermissionController:hasPermissions",e)&&this.messenger.call("PermissionController:revokeAllPermissions",e)}async function Ee(e,t,r,s){const i=this.getTruncated(t);if(i&&!r.shouldAlwaysReload)return(0,g.satisfiesVersionRange)(i.version,s)?i:await c(X,this,Pe).call(this,{origin:e,snapId:t,location:r,versionRange:s});c(X,this,le).call(this);let a=c(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messenger.publish("SnapController:snapInstallStarted",t,e,!1),i&&this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),i&&r.shouldAlwaysReload&&c(X,this,Se).call(this,t);try{const{sourceCode:i}=await c(X,this,Me).call(this,{origin:e,id:t,location:r,versionRange:s});await c(X,this,Ne).call(this,t,a),a=c(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await c(X,this,Ae).call(this,{snapId:t,sourceCode:i});const o=this.getTruncatedExpect(t);return c(X,this,ke).call(this,a.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(r){(0,m.logError)(`Error when adding ${t}.`,r);const s=r instanceof Error?r.message:r.toString();throw c(X,this,ke).call(this,a.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:s}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!1,s),r}}function Te({origin:e,snapId:t,type:n}){const r=(0,_.nanoid)();return{id:r,promise:this.messenger.call("ApprovalController:addRequest",{origin:e,id:r,type:n,requestData:{metadata:{id:r,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function ke(e,t){try{this.messenger.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function Pe({origin:e,snapId:t,location:r,versionRange:s,automaticUpdate:i=!1}){i||c(X,this,le).call(this),await c(X,this,ue).call(this);const a=this.getExpect(t),{preinstalled:o,removable:l,hidden:u,hideSnapBranding:d}=a;if(o&&!i)throw new Error("Preinstalled Snaps cannot be manually updated.");let f=i?null:c(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messenger.publish("SnapController:snapInstallStarted",t,e,!0);const y=a.manifest,b=await(0,M.fetchSnap)(t,r),{sourceCode:_,manifest:v}=b,w=v.result,S=w.version;if(!(0,g.gtVersion)(S,a.version))throw p.rpcErrors.invalidParams(`Snap "${t}@${a.version}" is already installed. Couldn't update to a version inside requested "${s}" range.`);if(!(0,g.satisfiesVersionRange)(S,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${S}" which doesn't satisfy requested version range "${s}".`);await c(X,this,ce).call(this,t,{version:S,checksum:w.source.shasum,permissions:w.initialPermissions,platformVersion:w.platformVersion});const E=(0,h.processSnapPermissions)(w.initialPermissions);c(X,this,Ie).call(this,E);const{newPermissions:T,unusedPermissions:k,approvedPermissions:P}=c(X,this,et).call(this,t,E),{newConnections:O,unusedConnections:A,approvedConnections:j}=c(X,this,nt).call(this,t,y.initialConnections??{},w.initialConnections??{});let R,I;if(f){c(X,this,ke).call(this,f.id,{permissions:T,newVersion:w.version,newPermissions:T,approvedPermissions:P,unusedPermissions:k,newConnections:O,unusedConnections:A,approvedConnections:j,loading:!1});const{permissions:r,...s}=await f.promise;R=r,I=s,f=c(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT})}else(0,g.assert)(i),R=T;this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),c(X,this,pe).call(this,t,m.SnapStatusEvents.Update),c(X,this,Re).call(this,{origin:e,id:t,files:b,removable:l,preinstalled:o,hidden:u,hideSnapBranding:d,isUpdate:!0}),c(X,this,rt).call(this,{snapId:t,unusedPermissions:k,newPermissions:R,requestData:I});const C=y.initialConnections??null,N=w.initialConnections??{};c(X,this,_e).call(this,t,C,N);const x=c(X,this,Ye).call(this,t);x!==undefined&&(x.permissions.revoked=k,x.permissions.granted=R,x.permissions.requestData=I,x.previousInitialConnections=C,x.newInitialConnections=N);const L=_.toString();(0,g.assert)("string"==typeof L&&L.length>0,`Invalid source code for snap "${t}".`);try{await c(X,this,Ae).call(this,{snapId:t,sourceCode:L})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const D=this.getTruncatedExpect(t);return f&&c(X,this,ke).call(this,f.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),D}catch(r){(0,m.logError)(`Error when updating ${t},`,r);const s=r instanceof Error?r.message:r.toString();throw f&&c(X,this,ke).call(this,f.id,{loading:!1,error:s,type:n.SNAP_APPROVAL_UPDATE}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!0,s),r}}async function Oe(e,t){return await this.messenger.call("SnapsRegistry:resolveVersion",e,t)}async function Me(e){const{id:t,location:n,versionRange:r}=e;c(X,this,Ze).call(this,t);const s=c(X,this,Qe).call(this,t);s.installPromise||((0,O.log)(`Adding snap: ${t}`),s.installPromise=(async()=>{const s=await(0,M.fetchSnap)(t,n),i=s.manifest.result;if(!(0,g.satisfiesVersionRange)(i.version,r))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${i.version}" which doesn't satisfy requested version range "${r}".`);await c(X,this,ce).call(this,t,{version:i.version,checksum:i.source.shasum,permissions:i.initialPermissions,platformVersion:i.platformVersion});const o=a(L,this).forcePreinstalledSnaps&&(0,M.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(X,this,Re).call(this,{...e,files:s,id:t,...o})})());try{return await s.installPromise}catch(e){throw s.installPromise=null,e}}async function Ae(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=c(X,this,Qe).call(this,t),r=await this.messenger.call("ExecutionService:executeSnap",{...e,endowments:await c(X,this,je).call(this,t)});return c(X,this,pe).call(this,t,m.SnapStatusEvents.Start),n.lastRequest=Date.now(),r}catch(e){throw await c(X,this,he).call(this,t),e}}async function je(e){let t=[];for(const n of a(N,this))if(this.messenger.call("PermissionController:hasPermission",e,n)){const r=await this.messenger.call("PermissionController:getEndowments",e,n);if(r){if(!Array.isArray(r)||r.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(r)}}const n=[...new Set([...m.DEFAULT_ENDOWMENTS,...t])];return n.length<m.DEFAULT_ENDOWMENTS.length+t.length&&(0,m.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function Re(e){const{id:t,origin:n,files:r,isUpdate:s=!1,removable:i,preinstalled:o,hidden:l,hideSnapBranding:u}=e,{manifest:p,sourceCode:h,svgIcon:f,auxiliaryFiles:y,localizationFiles:b}=r;(0,m.assertIsSnapManifest)(p.result);const{version:_}=p.result,v=h.toString();(0,g.assert)("string"==typeof v&&v.length>0,`Invalid source code for snap "${t}".`);const w=y.map(e=>((0,g.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),S=this.state.snaps[t],E=[...(null==S?void 0:S.versionHistory)??[],{version:_,date:Date.now(),origin:n}],T=b.map(e=>e.result),k={...S,blocked:!1,enabled:!0,removable:i,preinstalled:o,hidden:l,hideSnapBranding:u,id:t,initialConnections:p.result.initialConnections,initialPermissions:p.result.initialPermissions,manifest:p.result,status:a(z,this).config.initial,sourceCode:v,version:_,versionHistory:E,auxiliaryFiles:w,localizationFiles:T};delete k.blockInformation;const{inversePatches:P}=this.update(e=>{e.snaps[t]=k});if(s){const e=c(X,this,Ye).call(this,t);e!==undefined&&(e.statePatches=P)}const{proposedName:O}=(0,m.getLocalizedSnapManifest)(p.result,"en",T);return this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:O,origin:k.id,version:_,svgIcon:(null==f?void 0:f.toString())??null}),{...k,sourceCode:v}}function Ie(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(h.handlerEndowments)));(0,g.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const r=t.reduce((e,t)=>((0,g.hasProperty)(a(x,this),t)&&e.push(a(x,this)[t]),e),[]);(0,g.assert)(0===r.length,`One or more permissions are not allowed:\n${r.join("\n")}`)}function Ce(e,t){if(t!==undefined&&(0,v.gt)(t,(0,m.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,m.getPlatformVersion)()}".`;if(a(L,this).rejectInvalidPlatformVersion)throw new Error(n);(0,m.logWarning)(n)}}async function Ne(e,t){(0,O.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:r,initialConnections:s}=n;try{const i=(0,h.processSnapPermissions)(r);c(X,this,Ie).call(this,i),c(X,this,ke).call(this,t.id,{loading:!1,connections:s??{},permissions:i});const{permissions:a,...o}=await t.promise;c(X,this,rt).call(this,{snapId:e,newPermissions:a,requestData:o}),n.manifest.initialConnections&&c(X,this,_e).call(this,e,null,n.manifest.initialConnections)}finally{c(X,this,Qe).call(this,e).installPromise=null}}function xe(e){return(0,h.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function Le(e,t,n){return this.messenger.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function De(e,t){(0,g.assert)(this.messenger.call("SnapInterfaceController:getInterface",e,t))}async function Ue(e,t,n,r){switch(t){case m.HandlerType.OnTransaction:case m.HandlerType.OnSignature:case m.HandlerType.OnHomePage:case m.HandlerType.OnSettingsPage:{const t=r;if(t&&(0,g.hasProperty)(t,"content")){const{content:n,...r}=t;return{...r,id:await c(X,this,Le).call(this,e,n)}}return r}case m.HandlerType.OnAssetsLookup:return c(X,this,$e).call(this,e,n,r);case m.HandlerType.OnAssetsConversion:return c(X,this,Ge).call(this,n,r);case m.HandlerType.OnAssetsMarketData:return c(X,this,Fe).call(this,n,r);default:return r}}function $e(e,{params:t},{assets:n}){const r=this.messenger.call("PermissionController:getPermissions",e);(0,g.assert)(r);const s=r[h.SnapEndowments.Assets],i=(0,h.getChainIdsCaveat)(s);(0,g.assert)(i);const{assets:a}=t;return{assets:Object.keys(n).reduce((e,t)=>{const r=t;return i.some(e=>r.startsWith(e))&&a.includes(r)&&(e[r]=n[r]),e},{})}}function Ge({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var r;const s=null===(r=t[n.from])||void 0===r?void 0:r[n.to];var i;s&&(e[i=n.from]??(e[i]={}),e[n.from][n.to]=s);return e},{})}}function Fe({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var r;const s=null===(r=t[n.asset])||void 0===r?void 0:r[n.unit];var i;s&&(e[i=n.asset]??(e[i]={}),e[n.asset][n.unit]=s);return e},{})}}function He(e,t,n){if(t===m.HandlerType.OnUserInput){(0,g.assert)(n.params&&(0,g.hasProperty)(n.params,"id"));const t=n.params.id,{context:r}=this.messenger.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:r}}}return n}async function qe(e,t,n){switch(t){case m.HandlerType.OnTransaction:(0,g.assertStruct)(n,m.OnTransactionResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(X,this,De).call(this,e,n.id);break;case m.HandlerType.OnSignature:(0,g.assertStruct)(n,m.OnSignatureResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(X,this,De).call(this,e,n.id);break;case m.HandlerType.OnHomePage:(0,g.assertStruct)(n,m.OnHomePageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(X,this,De).call(this,e,n.id);break;case m.HandlerType.OnSettingsPage:(0,g.assertStruct)(n,m.OnSettingsPageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(X,this,De).call(this,e,n.id);break;case m.HandlerType.OnNameLookup:(0,g.assertStruct)(n,m.OnNameLookupResponseStruct);break;case m.HandlerType.OnAssetsLookup:(0,g.assertStruct)(n,f.OnAssetsLookupResponseStruct);break;case m.HandlerType.OnAssetsConversion:(0,g.assertStruct)(n,m.OnAssetsConversionResponseStruct);break;case m.HandlerType.OnAssetHistoricalPrice:(0,g.assertStruct)(n,m.OnAssetHistoricalPriceResponseStruct);break;case m.HandlerType.OnAssetsMarketData:(0,g.assertStruct)(n,m.OnAssetsMarketDataResponseStruct)}}function Be(e,t,n){const r=c(X,this,Qe).call(this,e);r.pendingInboundRequests.push({requestId:t,timer:n}),r.lastRequest=null}function Ve(e,t,n,r,s){const i=c(X,this,Qe).call(this,e);i.pendingInboundRequests=i.pendingInboundRequests.filter(e=>e.requestId!==t),0===i.pendingInboundRequests.length&&(i.lastRequest=Date.now());const o=this.get(e);if((0,M.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{a(Q,this).call(this,e,n,s,r)}catch(e){(0,m.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,f.getErrorMessage)(e)}`)}}function Ye(e){return a(Y,this).get(e)}function We(e){(0,g.assert)(a(Y,this).get(e)===undefined,`Snap "${e}" rollback snapshot already exists.`),a(Y,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=a(Y,this).get(e);return(0,g.assert)(t!==undefined,`Snapshot creation failed for ${e}.`),t}async function ze(e){var t,n;const r=c(X,this,Ye).call(this,e);if(!r)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,m.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==m.SnapStatus.Stopped&&c(X,this,pe).call(this,e,m.SnapStatusEvents.Stop);const{statePatches:s,permissions:i,previousInitialConnections:o,newInitialConnections:l}=r;null!=s&&s.length&&this.applyPatches(s),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==m.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=m.SnapStatus.Stopped}),c(X,this,rt).call(this,{snapId:e,unusedPermissions:i.granted,newPermissions:i.revoked,requestData:i.requestData}),c(X,this,_e).call(this,e,l??null,o??{});const u=this.getTruncatedExpect(e);this.messenger.publish("SnapController:snapRolledback",u,r.newVersion),a(Y,this).delete(e)}async function Ke(e){for(const t of e)await c(X,this,ze).call(this,t)}function Je(e){return a(V,this).get(e)}function Qe(e){const t=c(X,this,Je).call(this,e);return(0,g.assert)(t!==undefined,`Snap "${e}" runtime data not found`),t}function Ze(e){if(a(V,this).has(e))return;const t=this.get(e),n=(0,y.interpret)(a(z,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??a(z,this).config.initial}),(0,P.forceStrict)(n),a(V,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new b.Mutex,getStateMutex:new b.Mutex})}function Xe(e,t){return Object.keys(e).reduce((n,r)=>{if(a(C,this).includes(r)){var s;const i=(0,g.hasProperty)(w.DYNAMIC_PERMISSION_DEPENDENCIES,r),a=null===(s=w.DYNAMIC_PERMISSION_DEPENDENCIES[r])||void 0===s?void 0:s.some(e=>(0,g.hasProperty)(t,e));i&&!a||(n[r]=e[r])}return n},t)}function et(e,t){const n=this.messenger.call("PermissionController:getPermissions",e)??{},r=c(X,this,Xe).call(this,n,t),s=(0,M.permissionsDiff)(r,n),i=(0,M.permissionsDiff)(n,r);return{newPermissions:s,unusedPermissions:i,approvedPermissions:(0,M.permissionsDiff)(n,i)}}function tt(e,t){var n,r;const s=this.messenger.call("PermissionController:getPermissions",t),i=null==s||null===(n=s[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);return Boolean(null==i||null===(r=i.value)||void 0===r?void 0:r[e])}function nt(e,t,n){const r=Object.keys(t).filter(t=>c(X,this,tt).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),s=(0,M.setDiff)(n,r),i=(0,M.setDiff)(r,n);return{newConnections:s,unusedConnections:i,approvedConnections:(0,M.setDiff)(r,i)}}function rt({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:r}){const s=Object.keys(t);(0,g.isNonEmptyArray)(s)&&this.messenger.call("PermissionController:revokePermissions",{[e]:s}),(0,g.isNonEmptyArray)(Object.keys(n))&&this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:n,subject:{origin:e},requestData:r})}function st(e,t){const n=this.getExpect(e);return!(0,g.satisfiesVersionRange)(n.version,t)&&!(0,g.gtRange)(n.version,t)}function it(e,t){const n=this.getRunnableSnaps();for(const{id:r}of n){this.messenger.call("PermissionController:hasPermission",r,h.SnapEndowments.LifecycleHooks)&&c(X,this,at).call(this,e,r,t).catch(e=>{(0,m.logError)(`Error calling lifecycle hook "${t}" for Snap "${r}": ${(0,f.getErrorMessage)(e)}`)})}}async function at(e,t,n){const r=h.handlerEndowments[n];(0,g.assert)(r,"Lifecycle hook must have an endowment.");this.messenger.call("PermissionController:hasPermission",t,r)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function ot(){for(const e of a(V,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=te}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[255,{loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){r(r=>{n.error&&s.default.debug("Error in RPC response:\n",n),t.isMetamaskInternal||(s.default.info(`RPC (${e.origin}): ${t.method} -> ${n.error?"error":"success"}`),r())})}};var r,s=(r=e("loglevel"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/createLoggerMiddleware.js"}],[2550,{"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const s=e("@metamask/utils");n.Timer=class{constructor(e){r(this,"state",void 0),(0,s.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,s.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,s.assert)("paused"===this.status||"running"===this.status,"Tried to cancel a not running Timer"),this.onFinish(!1)}finish(){(0,s.assert)("finished"!==this.status,"Tried to finish a finished Timer."),this.onFinish(!0)}pause(){(0,s.assert)("running"===this.state.value,"Tried to pause a not running Timer");const{callback:e,start:t,timeout:n,remaining:r}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:r-(Date.now()-t)}}start(e){(0,s.assert)("stopped"===this.state.value,"Tried to start an already running Timer");const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,s.assert)("paused"===this.state.value,"Tried to resume not paused Timer");const{remaining:e,callback:t}=this.state,n=Date.now();let r;e!==Number.POSITIVE_INFINITY&&(r=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:r}}onFinish(e){(0,s.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[2551,{"@metamask/snaps-rpc-methods":2611,"@metamask/snaps-utils":2781},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DYNAMIC_PERMISSION_DEPENDENCIES=n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const r=e("@metamask/snaps-rpc-methods"),s=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",r.SnapEndowments.Cronjob,r.SnapEndowments.HomePage,r.SnapEndowments.LifecycleHooks,r.SnapEndowments.EthereumProvider,r.SnapEndowments.TransactionInsight,r.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([s.HandlerType.OnClientRequest,s.HandlerType.OnSignature,s.HandlerType.OnTransaction,s.HandlerType.OnCronjob,s.HandlerType.OnNameLookup,s.HandlerType.OnHomePage,s.HandlerType.OnSettingsPage,s.HandlerType.OnUserInput,s.HandlerType.OnAssetsLookup,s.HandlerType.OnAssetsConversion,s.HandlerType.OnAssetHistoricalPrice,s.HandlerType.OnAssetsMarketData,s.HandlerType.OnWebSocketEvent]),n.DYNAMIC_PERMISSION_DEPENDENCIES=Object.freeze({"endowment:caip25":["endowment:ethereum-provider"]})}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2552,{"./SnapController.cjs":2549,"./constants.cjs":2551,"./location/index.cjs":2554,"./registry/index.cjs":2558,"./selectors.cjs":2561},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]},s=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./constants.cjs"),n),s(e("./location/index.cjs"),n),s(e("./SnapController.cjs"),n),s(e("./selectors.cjs"),n),s(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2553,{"@metamask/snaps-utils":2781,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const s=e("@metamask/snaps-utils"),i=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){r(this,"cache",new Map),r(this,"validatedManifest",void 0),r(this,"url",void 0),r(this,"fetchFn",void 0),r(this,"fetchOptions",void 0),(0,i.assertStruct)(e.toString(),s.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(s.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),r=(0,s.parseJson)(n),i=new s.VirtualFile({value:n,result:(0,s.createSnapManifest)(r),path:s.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=i,this.manifest()}async fetch(e){const t=(0,s.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const r=this.toCanonical(t).toString(),a=await this.fetchFn(r,this.fetchOptions);if(!a.ok)throw new Error(`Failed to fetch "${r}". Status code: ${a.status}.`);const o=await a.arrayBuffer(),c=new s.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:r}});return(0,i.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,i.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[2554,{"./http.cjs":2553,"./local.cjs":2555,"./location.cjs":2556,"./npm.cjs":2557},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]},s=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./location.cjs"),n),s(e("./npm.cjs"),n),s(e("./local.cjs"),n),s(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2555,{"./http.cjs":2553,"@metamask/snaps-utils":2781,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function s(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const a=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,s,u;r(this,l,void 0),(0,o.assertStruct)(e.toString(),a.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=l,s=this,u=new c.HttpLocation(new URL(e.toString().slice(a.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(i(n,s),u)}async manifest(){return u(await s(l,this).manifest())}async fetch(e){return u(await s(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[2556,{"./http.cjs":2553,"./local.cjs":2555,"./npm.cjs":2557,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const r=e("@metamask/utils"),s=e("./http.cjs"),i=e("./local.cjs"),a=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new a.NpmLocation(c,t);case"local:":return(0,r.assert)(o,new TypeError("Fetching local snaps is disabled.")),new i.LocalLocation(c,t);case"http:":case"https:":return(0,r.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new s.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2557,{"@metamask/snaps-utils":2781,"@metamask/utils":2914,"concat-stream":2565,"get-npm-tarball-url":4240,"readable-stream":2580,"readable-web-to-node-stream":5107,"tar-stream":2584},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){s(e,t),t.set(e,n)}function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n){return e.set(c(e,t),n),n}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.NPM_REGISTRY_PROXY=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=l(e("concat-stream")),h=l(e("get-npm-tarball-url")),f=e("readable-stream"),m=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org"),n.NPM_REGISTRY_PROXY=new URL("https://npm-ota.api.cx.metamask.io");var y=new WeakMap,b=new WeakMap,_=new WeakSet;class v{constructor(e,t={}){var a,o;s(a=this,o=_),o.add(a),i(this,"meta",void 0),r(this,y,void 0),r(this,b,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),p=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,h=t.resolveVersion??(async e=>e);let f;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?f=t.useNpmProxy?n.NPM_REGISTRY_PROXY:n.DEFAULT_NPM_REGISTRY:(f="https://",e.username&&(f+=e.username,e.password&&(f+=`:${e.password}`),f+="@"),f+=e.host,f=new URL(f),(0,d.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${f.toString()}".`))),(0,d.assert)("/"===f.pathname&&""===f.search&&""===f.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let m=e.pathname;m.startsWith("/")&&(m=m.slice(1)),this.meta={requestedRange:p,registry:f,packageName:m,fetch:l,resolveVersion:h}}async manifest(){if(o(y,this))return o(y,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),a(y,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(b,this)||(await c(_,this,w).call(this),(0,d.assert)(o(b,this)!==undefined));const n=o(b,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function w(){(0,d.assert)(o(b,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,r){var s;if(T(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,h.default)(e,t),targetVersion:t};const i=await S(e,n,r),a=Object.keys((null==i?void 0:i.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(a,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==i||null===(s=i.versions)||void 0===s||null===(s=s[o])||void 0===s||null===(s=s.dist)||void 0===s?void 0:s.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const r=new URL(t);r.hostname=this.meta.registry.hostname,r.protocol=this.meta.registry.protocol;const s=await this.fetchNpmTarball(r);a(b,this,s),this.meta.version=n}n.BaseNpmLocation=v,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function S(e,t,n){const r=await n(new URL(e,t).toString(),{headers:{accept:T(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${r.status}.`);const s=await r.json();if(!(0,d.isObject)(s))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return s}function E(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function T(e){const t=e.toString();return t===n.DEFAULT_NPM_REGISTRY.toString()||t===n.NPM_REGISTRY_PROXY.toString()}n.NpmLocation=class extends v{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());(0,d.assert)(404!==t.status,`"${this.meta.packageName}" was not found in the NPM registry`),(0,d.assert)(t.ok&&t.body,`Failed to fetch tarball for package "${this.meta.packageName}"`);const r=t.headers.get("content-length");(0,d.assert)(r,"Snap tarball has invalid content-length");const s=parseInt(r,10);return(0,d.assert)(s<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,r)=>{const s=new Map,i=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const r=(0,g.extract)();let s=0;return r.on("entry",(i,a,o)=>{const{name:c,type:l}=i;if("file"===l){const i=c.replace(k,"");return a.pipe((0,p.default)({encoding:"uint8array"},a=>{try{s+=a.byteLength,(0,d.assert)(s<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const r=new u.VirtualFile({value:a,path:i,data:{canonicalPath:new URL(i,e).toString()}});return(0,d.assert)(!t.has(i),"Malformed tarball, multiple files with the same path."),t.set(i,r),o()}catch(e){return r.destroy(e)}}))}return a.on("end",()=>o()),a.resume()}),r}(E(this.meta.registry,this.meta.packageName),s),a=t.body,o=new DecompressionStream("gzip"),c=a.pipeThrough(o);(0,f.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new m.ReadableWebToNodeStream(e)}(c),i,t=>{t?r(t):e(s)})})}},n.fetchNpmMetadata=S,n.getNpmCanonicalBasePath=E;const k=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2558,{"./json.cjs":2559,"./registry.cjs":2560},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]},s=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./registry.cjs"),n),s(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[2559,{"./registry.cjs":2560,"@metamask/base-controller":1297,"@metamask/snaps-registry":2590,"@metamask/snaps-utils":2781,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){s(e,t),t.set(e,n)}function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("./registry.cjs"),h={database:null,lastUpdated:null,databaseUnavailable:!1};var f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,_=new WeakMap,v=new WeakMap,w=new WeakSet;class S extends c.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:i="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",clientConfig:c,fetchFunction:l=globalThis.fetch.bind(undefined),recentFetchThreshold:u=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:p=!0}){var S,E;super({messenger:e,metadata:{database:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastUpdated:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},databaseUnavailable:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}},name:"SnapsRegistry",state:{...h,...t}}),s(S=this,E=w),E.add(S),r(this,f,void 0),r(this,m,void 0),r(this,g,void 0),r(this,y,void 0),r(this,b,void 0),r(this,_,void 0),r(this,v,void 0),a(f,this,n),a(m,this,i),a(g,this,c),a(y,this,l),a(b,this,u),a(_,this,p),a(v,this,null),this.messenger.registerActionHandler("SnapsRegistry:get",async(...e)=>o(w,this,M).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(w,this,j).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(w,this,A).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:update",async()=>o(w,this,T).call(this))}}function E(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<i(b,this)}async function T(){i(v,this)?await i(v,this):(null===i(v,this)&&a(v,this,o(w,this,k).call(this)),await i(v,this),a(v,this,null))}async function k(){if(!o(w,this,E).call(this))try{const[e,t]=await Promise.all([o(w,this,I).call(this,i(f,this).registry),o(w,this,I).call(this,i(f,this).signature)]);o(w,this,R).call(this,e,t),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function P(){return null===this.state.database&&await o(w,this,T).call(this),this.state.database}async function O(e,t,n=!1){var r,s;const a=await o(w,this,P).call(this),c=null==a?void 0:a.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(c)return{status:p.SnapsRegistryStatus.Blocked,reason:c.reason};const l=null==a?void 0:a.verifiedSnaps[e],u=null==l||null===(r=l.versions)||void 0===r?void 0:r[t.version],h=null==u||null===(s=u.clientVersions)||void 0===s?void 0:s[i(g,this).type],f=!h||(0,d.satisfiesVersionRange)(i(g,this).version,h);return u&&u.checksum===t.checksum&&f?{status:p.SnapsRegistryStatus.Verified}:i(_,this)&&!n?(await o(w,this,T).call(this),o(w,this,O).call(this,e,t,!0)):{status:this.state.databaseUnavailable?p.SnapsRegistryStatus.Unavailable:p.SnapsRegistryStatus.Unverified}}async function M(e){return Object.entries(e).reduce(async(e,[t,n])=>{const r=await o(w,this,O).call(this,t,n),s=await e;return s[t]=r,s},Promise.resolve({}))}async function A(e,t,n=!1){var r;const s=await o(w,this,P).call(this),a=(null==s||null===(r=s.verifiedSnaps[e])||void 0===r?void 0:r.versions)??null;if(!a&&i(_,this)&&!n)return await o(w,this,T).call(this),o(w,this,A).call(this,e,t,!0);if(!a)return t;const c=Object.entries(a).reduce((e,[t,n])=>{var r;const s=null===(r=n.clientVersions)||void 0===r?void 0:r[i(g,this).type];return s&&!(0,d.satisfiesVersionRange)(i(g,this).version,s)||e.push(t),e},[]),l=(0,u.getTargetVersion)(c,t);return l||!i(_,this)||n?l?((0,d.assertIsSemVerRange)(l),l):t:(await o(w,this,T).call(this),o(w,this,A).call(this,e,t,!0))}function j(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}function R(e,t){(0,d.assert)(i(m,this),"No public key provided.");const n=(0,l.verify)({registry:e,signature:JSON.parse(t),publicKey:i(m,this)});(0,d.assert)(n,"Invalid registry signature.")}async function I(e){const t=await i(y,this).call(this,e);if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=S}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[256,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({mainFrameOrigin:e}){return function(t,n,r){t.mainFrameOrigin=e,r()}}}}},{package:"$root$",file:"app/scripts/lib/createMainFrameOriginMiddleware.ts"}],[2560,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(r||(n.SnapsRegistryStatus=r={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[2561,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2562,{"./snaps/Timer.cjs":2550,"@metamask/snaps-sdk":2667,"@metamask/snaps-utils":2781,"fast-deep-equal":4187},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const s=e("@metamask/snaps-sdk"),i=e("@metamask/snaps-utils"),a=r(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let n;const r=new Promise((r,s)=>{e.start(()=>{t===undefined?r():r(t)}),n=s});return r.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},r}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,r])=>(n in t||(e[n]=r),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,r])=>{const s=n in t;return(!s||s&&!(0,a.default)(r.caveats??[],t[n].caveats??[]))&&(e[n]=r),e},{})},n.delay=function(e,t){return c(new o.Timer(e),t)},n.delayWithTimer=c,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const r=c("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,r])}finally{r.cancel()}},n.getSnapFiles=l,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,s.assert)(n.size<i.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:r}=e.result.source.location.npm,a=r?await t.fetch(r):undefined,o=await l(t,e.result.source.files);(0,i.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,i.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:a,auxiliaryFiles:o,localizationFiles:(0,i.getValidatedLocalizationFiles)(c)};return await(0,i.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,s.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(r,s,i)=>{const a=`${r}-${i}`;n.has(a)&&clearTimeout(n.get(a)),n.set(a,setTimeout(()=>{e(r,s,i),n.delete(a)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([i.HandlerType.OnHomePage,i.HandlerType.OnInstall,i.HandlerType.OnNameLookup,i.HandlerType.OnRpcRequest,i.HandlerType.OnSignature,i.HandlerType.OnTransaction,i.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,r=new Map;return(s,i,a,o)=>{const c=`${s}${i}${a}${o}`,l=Date.now(),u=n.get(c)??0,d=[s,i,a,o];if(l-u>=t)return n.set(c,l),void e(...d);const p=r.get(c);null!=p&&p.timer&&clearTimeout(p.timer),n.set(c,l),r.set(c,{args:d,timer:setTimeout(()=>{e(...d),r.delete(c)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2563,{"../snaps/index.cjs":2552,"@metamask/rpc-errors":2480,"@metamask/snaps-utils":2781,"@metamask/utils":2914,nanoid:4834},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){s(e,t),t.set(e,n)}function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("nanoid"),h=e("../snaps/index.cjs"),f="WebSocketService";var m=new WeakMap,g=new WeakMap,y=new WeakSet;function b(e,t){const n=a(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function _(e,t,n){return c(y,this,k).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function v(e,t){a(m,this).call("SnapController:handleRequest",{origin:h.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function w(e,t,n=[]){(0,d.assert)(!c(y,this,_).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const r=new URL(t),{origin:s}=r,i=(0,p.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:h,reject:f}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{h(),c(y,this,v).call(this,e,{type:"open",id:i,origin:s})}),o.addEventListener("close",t=>{a(g,this).delete(i),c(y,this,v).call(this,e,{type:"close",id:i,origin:s,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const m=()=>{f(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",m),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(y,this,v).call(this,e,{type:"message",id:i,origin:s,data:n})}),a(g,this).set(i,{id:i,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",m),i}function S(e,t){const{socket:n}=c(y,this,b).call(this,e,t);n.close()}function E(e){for(const t of c(y,this,k).call(this,e))c(y,this,S).call(this,e,t.id)}async function T(e,t,n){const{socket:r,openPromise:s}=c(y,this,b).call(this,e,t);await s;const i=Array.isArray(n)?new Uint8Array(n):n;r.send(i)}function k(e){return[...a(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;s(t=this,n=y),n.add(t),i(this,"name",f),i(this,"state",null),r(this,m,void 0),r(this,g,void 0),o(m,this,e),o(g,this,new Map),a(m,this).registerActionHandler(`${f}:open`,async(...e)=>c(y,this,w).call(this,...e)),a(m,this).registerActionHandler(`${f}:close`,(...e)=>c(y,this,S).call(this,...e)),a(m,this).registerActionHandler(`${f}:sendMessage`,async(...e)=>c(y,this,T).call(this,...e)),a(m,this).registerActionHandler(`${f}:getAll`,(...e)=>c(y,this,k).call(this,...e)),a(m,this).subscribe("SnapController:snapUpdated",e=>{c(y,this,E).call(this,e.id)}),a(m,this).subscribe("SnapController:snapUninstalled",e=>{c(y,this,E).call(this,e.id)}),a(m,this).subscribe("SnapController:snapInstalled",e=>{c(y,this,E).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[2564,{"./WebSocketService.cjs":2563},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]},s=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2565,{buffer:3880,"buffer-from":3886,inherits:4414,"readable-stream":2580,typedarray:5512},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("readable-stream").Writable,s=e("inherits"),i=e("buffer-from");if("undefined"==typeof Uint8Array)var a=e("typedarray").Uint8Array;else a=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,s=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):s=!0,r.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=s,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,s(o,r),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r];"string"==typeof s||n.isBuffer(s)?t.push(s):c(s)?t.push(i(s)):t.push(i(String(s)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r];n.isBuffer(s)?t.push(s):c(s)?t.push(i(s)):t.push(i(String(s)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=i(e[n])),t+=e[n].length;for(var r=new a(t),s=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)r[s++]=o[c];return r}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[2566,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r={};function s(e,t,n){n||(n=Error);var s=function(e){var n,r;function s(n,r,s){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,s))||this}return r=e,(n=s).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r,s}(n);s.prototype.name=n.name,s.prototype.code=e,r[e]=s}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}s("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),s("ERR_INVALID_ARG_TYPE",function(e,t,n){var r,s,a,o;if("string"==typeof t&&(s="not ",t.substr(!a||a<0?0:+a,s.length)===s)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(r," ").concat(i(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(r," ").concat(i(t,"type"))}return o+=". Received type ".concat(typeof n)},TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=r}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/errors-browser.js"}],[2567,{"./_stream_readable":2569,"./_stream_writable":2571,_process:4888,inherits:4414},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=l;var s=e("./_stream_readable"),i=e("./_stream_writable");e("inherits")(l,s);for(var a=r(i.prototype),o=0;o<a.length;o++){var c=a[o];l.prototype[c]||(l.prototype[c]=i.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_duplex.js"}],[2568,{"./_stream_transform":2570,inherits:4414},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=s;var r=e("./_stream_transform");function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}e("inherits")(s,r),s.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_passthrough.js"}],[2569,{"../errors":2566,"./_stream_duplex":2567,"./internal/streams/async_iterator":2572,"./internal/streams/buffer_list":2573,"./internal/streams/destroy":2574,"./internal/streams/from":2576,"./internal/streams/state":2578,"./internal/streams/stream":2579,_process:4888,buffer:3880,events:4180,inherits:4414,"string_decoder/":5490,util:3832},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r;t.exports=T,T.ReadableState=E;e("events").EventEmitter;var s=function(e,t){return e.listeners(t).length},i=e("./internal/streams/stream"),a=e("buffer").Buffer,o=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,l=e("util");c=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,p,h=e("./internal/streams/buffer_list"),f=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,y=g.ERR_INVALID_ARG_TYPE,b=g.ERR_STREAM_PUSH_AFTER_EOF,_=g.ERR_METHOD_NOT_IMPLEMENTED,v=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(T,i);var w=f.errorOrDestroy,S=["error","close","destroy","pause","resume"];function E(t,n,s){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=n instanceof r),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",s),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function T(t){if(r=r||e("./_stream_duplex"),!(this instanceof T))return new T(t);var n=this instanceof r;this._readableState=new E(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function k(e,t,n,r,s){c("readableAddChunk",t);var i,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?A(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,j(e)))}(e,l);else if(s||(i=function(e,t){var n;r=t,a.isBuffer(r)||r instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t));var r;return n}(l,t)),i)w(e,i);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),r)l.endEmitted?w(e,new v):P(e,l,t,!0);else if(l.ended)w(e,new b);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?P(e,l,t,!1):R(e,l)):P(e,l,t,!1)}else r||(l.reading=!1,R(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function P(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&A(e)),R(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=f.destroy,T.prototype._undestroy=f.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=a.from(e,t),t=""),n=!0),k(this,e,t,!1,n)},T.prototype.unshift=function(e){return k(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var n=new u(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,s="";null!==r;)s+=n.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==s&&this._readableState.buffer.push(s),this._readableState.length=s.length,this};var O=1073741824;function M(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=O?e=O:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function A(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(j,e))}function j(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,L(e)}function R(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(I,e,t))}function I(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function C(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function N(e){c("readable nexttick read 0"),e.read(0)}function x(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function U(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick($,t,e))}function $(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function G(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}T.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):A(this),null;if(0===(e=M(e,t))&&t.ended)return 0===t.length&&U(this),null;var r,s=t.needReadable;return c("need readable",s),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",s=!0),t.ended||t.reading?c("reading or ended",s=!1):s&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=M(n,t))),null===(r=e>0?D(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&U(this)),null!==r&&this.emit("data",r),r},T.prototype._read=function(e){w(this,new _("_read()"))},T.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:g;function o(t,n){c("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",f),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",h),e.removeListener("unpipe",o),r.removeListener("end",l),r.removeListener("end",g),r.removeListener("data",p),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function l(){c("onend"),e.end()}i.endEmitted?n.nextTick(a):r.once("end",a),e.on("unpipe",o);var u=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,L(e))}}(r);e.on("drain",u);var d=!1;function p(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==G(i.pipes,e))&&!d&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function h(t){c("onerror",t),g(),e.removeListener("error",h),0===s(e,"error")&&w(e,t)}function f(){e.removeListener("finish",m),g()}function m(){c("onfinish"),e.removeListener("close",f),g()}function g(){c("unpipe"),r.unpipe(e)}return r.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",f),e.once("finish",m),e.emit("pipe",r),i.flowing||(c("pipe resume"),r.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,s=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<s;i++)r[i].emit("unpipe",this,{hasUnpiped:!1});return this}var a=G(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},T.prototype.on=function(e,t){var r=i.prototype.on.call(this,e,t),s=this._readableState;return"data"===e?(s.readableListening=this.listenerCount("readable")>0,!1!==s.flowing&&this.resume()):"readable"===e&&(s.endEmitted||s.readableListening||(s.readableListening=s.needReadable=!0,s.flowing=!1,s.emittedReadable=!1,c("on readable",s.length,s.reading),s.length?A(this):s.reading||n.nextTick(N,this))),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var r=i.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(C,this),r},T.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(C,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(x,e,t))}(this,e)),e.paused=!1,this},T.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var s in e.on("end",function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(s){(c("wrapped data"),n.decoder&&(s=n.decoder.write(s)),!n.objectMode||null!==s&&s!==undefined)&&((n.objectMode||s&&s.length)&&(t.push(s)||(r=!0,e.pause())))}),e)this[s]===undefined&&"function"==typeof e[s]&&(this[s]=function(t){return function(){return e[t].apply(e,arguments)}}(s));for(var i=0;i<S.length;i++)e.on(S[i],this.emit.bind(this,S[i]));return this._read=function(t){c("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=D,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(t,n){return p===undefined&&(p=e("./internal/streams/from")),p(T,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_readable.js"}],[257,{"./stream-utils":334,"@metamask/rpc-errors":2480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),s=e("./stream-utils");n.default=(e,t)=>async n=>{if(!(0,s.isStreamWritable)(t))return;if(!e[n.method])return void t.write({jsonrpc:"2.0",error:r.rpcErrors.methodNotFound({message:`${n.method} not found`}),id:n.id});let i,a;try{i=await e[n.method](...n.params)}catch(e){a=e}(0,s.isStreamWritable)(t)?a?t.write({jsonrpc:"2.0",error:(0,r.serializeError)(a,{shouldIncludeStack:!0}),id:n.id}):t.write({jsonrpc:"2.0",result:i,id:n.id}):a&&console.error(a)}}}},{package:"$root$",file:"app/scripts/lib/createMetaRPCHandler.js"}],[2570,{"../errors":2566,"./_stream_duplex":2567,inherits:4414},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=u;var r=e("../errors").codes,s=r.ERR_METHOD_NOT_IMPLEMENTED,i=r.ERR_MULTIPLE_CALLBACK,a=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=r.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function l(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush(function(t,n){p(e,t,n)})}function p(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new s("_transform()"))},u.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var s=this._readableState;(r.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,function(e){t(e)})}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_transform.js"}],[2571,{"../errors":2566,"./_stream_duplex":2567,"./internal/streams/destroy":2574,"./internal/streams/state":2578,"./internal/streams/stream":2579,_process:4888,buffer:3880,inherits:4414,"util-deprecate":5550},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var s=r.callback;t.pendingcb--,s(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var s;t.exports=T,T.WritableState=E;var i={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),o=e("buffer").Buffer,c=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,p=e("../errors").codes,h=p.ERR_INVALID_ARG_TYPE,f=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,g=p.ERR_STREAM_CANNOT_PIPE,y=p.ERR_STREAM_DESTROYED,b=p.ERR_STREAM_NULL_VALUES,_=p.ERR_STREAM_WRITE_AFTER_END,v=p.ERR_UNKNOWN_ENCODING,w=u.errorOrDestroy;function S(){}function E(t,i,a){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof a&&(a=i instanceof s),this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,s=r.sync,i=r.writecb;if("function"!=typeof i)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,s,i){--t.pendingcb,r?(n.nextTick(i,s),n.nextTick(j,e,t),e._writableState.errorEmitted=!0,w(e,s)):(i(s),e._writableState.errorEmitted=!0,w(e,s),j(e,t))}(e,r,s,t,i);else{var a=M(r)||e.destroyed;a||r.corked||r.bufferProcessing||!r.bufferedRequest||O(e,r),s?n.nextTick(P,e,r,a,i):P(e,r,a,i)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function T(t){var n=this instanceof(s=s||e("./_stream_duplex"));if(!n&&!l.call(T,this))return new T(t);this._writableState=new E(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function k(e,t,n,r,s,i,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(s,t.onwrite):e._write(s,i,t.onwrite),t.sync=!1}function P(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),j(e,t)}function O(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var s=t.bufferedRequestCount,i=new Array(s),a=t.corkedRequestsFree;a.entry=n;for(var o=0,c=!0;n;)i[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;i.allBuffers=c,k(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,d=n.callback;if(k(e,t,!1,t.objectMode?1:l.length,l,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function M(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final(function(n){t.pendingcb--,n&&w(e,n),t.prefinished=!0,e.emit("prefinish"),j(e,t)})}function j(e,t){var r=M(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(A,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var s=e._readableState;(!s||s.autoDestroy&&s.endEmitted)&&e.destroy()}return r}e("inherits")(T,a),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===T&&(e&&e._writableState instanceof E)}})):l=function(e){return e instanceof this},T.prototype.pipe=function(){w(this,new g)},T.prototype.write=function(e,t,r){var s,i=this._writableState,a=!1,l=!i.objectMode&&(s=e,o.isBuffer(s)||s instanceof c);return l&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(r=t,t=null),l?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=S),i.ending?function(e,t){var r=new _;w(e,r),n.nextTick(t,r)}(this,r):(l||function(e,t,r,s){var i;return null===r?i=new b:"string"==typeof r||t.objectMode||(i=new h("chunk",["string","Buffer"],r)),!i||(w(e,i),n.nextTick(s,i),!1)}(this,i,e,r))&&(i.pendingcb++,a=function(e,t,n,r,s,i){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,r,s);r!==a&&(n=!0,s="buffer",r=a)}var c=t.objectMode?1:r.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:s,isBuf:n,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,c,r,s,i);return l}(this,i,l,e,t,r)),a},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||O(this,e))},T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,n){n(new f("_write()"))},T.prototype._writev=null,T.prototype.end=function(e,t,r){var s=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&e!==undefined&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||function(e,t,r){t.ending=!0,j(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,s,r),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=u.destroy,T.prototype._undestroy=u.undestroy,T.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_writable.js"}],[2572,{"./end-of-stream":2575,_process:4888},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r;function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=e("./end-of-stream"),a=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function f(e){var t=e[a];if(null!==t){var n=e[p].read();null!==n&&(e[u]=null,e[a]=null,e[o]=null,t(h(n,!1)))}}function m(e){n.nextTick(f,e)}var g=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((s(r={get stream(){return this[p]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(h(undefined,!0));if(this[p].destroyed)return new Promise(function(t,r){n.nextTick(function(){e[c]?r(e[c]):t(h(undefined,!0))})});var r,s=this[u];if(s)r=new Promise(function(e,t){return function(n,r){e.then(function(){t[l]?n(h(undefined,!0)):t[d](n,r)},r)}}(s,this));else{var i=this[p].read();if(null!==i)return Promise.resolve(h(i,!1));r=new Promise(this[d])}return this[u]=r,r}},Symbol.asyncIterator,function(){return this}),s(r,"return",function(){var e=this;return new Promise(function(t,n){e[p].destroy(null,function(e){e?n(e):t(h(undefined,!0))})})}),r),g);t.exports=function(e){var t,n=Object.create(y,(s(t={},p,{value:e,writable:!0}),s(t,a,{value:null,writable:!0}),s(t,o,{value:null,writable:!0}),s(t,c,{value:null,writable:!0}),s(t,l,{value:e._readableState.endEmitted,writable:!0}),s(t,d,{value:function(e,t){var r=n[p].read();r?(n[u]=null,n[a]=null,n[o]=null,e(h(r,!1))):(n[a]=e,n[o]=t)},writable:!0}),t));return n[u]=null,i(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[u]=null,n[a]=null,n[o]=null,t(e)),void(n[c]=e)}var r=n[a];null!==r&&(n[u]=null,n[a]=null,n[o]=null,r(h(undefined,!0))),n[l]=!0}),e.on("readable",m.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[2573,{buffer:3880,util:3832},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var c=e("buffer").Buffer,l=e("util").inspect,u=l&&l.custom||"inspect";function d(e,t,n){c.prototype.copy.call(e,t,n)}t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,r;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),n=this.head,r=0;n;)d(n.data,t,r),r+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var s=t.data,i=e>s.length?s.length:e;if(i===s.length?r+=s:r+=s.slice(0,e),0===(e-=i)){i===s.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=s.slice(i));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var s=n.data,i=e>s.length?s.length:e;if(s.copy(t,t.length-e,0,i),0===(e-=i)){i===s.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=s.slice(i));break}++r}return this.length-=r,t}},{key:u,value:function(e,t){return l(this,s(s({},t),{},{depth:0,customInspect:!1}))}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[2574,{_process:4888},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){s(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}t.exports={destroy:function(t,i){var a=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(s,this,t)):e.nextTick(s,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!i&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(r,a):(a._writableState.errorEmitted=!0,e.nextTick(n,a,t)):e.nextTick(n,a,t):i?(e.nextTick(r,a),i(t)):e.nextTick(r,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[2575,{"../../../errors":2566},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function s(){}t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];e.apply(this,r)}}}(i||s);var a=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){o=!1,l=!0,a||i.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){a=!1,d=!0,o||i.call(t)},h=function(e){i.call(t,e)},f=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new r),i.call(t,e)):o&&!l?(t._writableState&&t._writableState.ended||(e=new r),i.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)),t.on("end",p),t.on("finish",u),!1!==n.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[2576,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[2577,{"../../../errors":2566,"./end-of-stream":2575},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;var s=e("../../../errors").codes,i=s.ERR_MISSING_ARGS,a=s.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new i("streams");var p=n.map(function(t,s){var i=s<n.length-1;return function(t,n,s,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var o=!1;t.on("close",function(){o=!0}),r===undefined&&(r=e("./end-of-stream")),r(t,{readable:n,writable:s},function(e){if(e)return i(e);o=!0,i()});var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void i(e||new a("pipe"))}}(t,i,s>0,function(e){u||(u=e),e&&p.forEach(c),i||(p.forEach(c),d(u))})});return n.reduce(l)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[2578,{"../../../errors":2566},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,s){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,s,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new r(s?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/state.js"}],[2579,{events:4180},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[258,{"./middleware/pending":280,"@metamask/eth-json-rpc-middleware":1815,"@metamask/json-rpc-engine":2034},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({version:e,getAccounts:t,processTransaction:n,processTypedMessage:a,processTypedMessageV3:o,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:u,processEncryptionPublicKey:d,getPendingNonce:p,getPendingTransactionByHash:h,processRequestExecutionPermissions:f}){return(0,r.mergeMiddleware)([(0,r.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,s.createWalletMiddleware)({getAccounts:t,processTransaction:n,processTypedMessage:a,processTypedMessageV3:o,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:u,processEncryptionPublicKey:d,processRequestExecutionPermissions:f}),(0,i.createPendingNonceMiddleware)({getPendingNonce:p}),(0,i.createPendingTxMiddleware)({getPendingTransactionByHash:h})])};var r=e("@metamask/json-rpc-engine"),s=e("@metamask/eth-json-rpc-middleware"),i=e("./middleware/pending")}}},{package:"$root$",file:"app/scripts/lib/createMetamaskMiddleware.js"}],[2580,{"./lib/_stream_duplex.js":2567,"./lib/_stream_passthrough.js":2568,"./lib/_stream_readable.js":2569,"./lib/_stream_transform.js":2570,"./lib/_stream_writable.js":2571,"./lib/internal/streams/end-of-stream.js":2575,"./lib/internal/streams/pipeline.js":2577},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/readable-browser.js"}],[2581,{fs:3832},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r={S_IFMT:61440,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960};try{t.exports=e("fs").constants||r}catch{t.exports=r}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/constants.js"}],[2582,{"./headers":2583,b4a:3757,"fast-fifo":4189,streamx:5489},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const{Writable:r,Readable:s,getStreamError:i}=e("streamx"),a=e("fast-fifo"),o=e("b4a"),c=e("./headers"),l=o.alloc(0);class u{constructor(){this.buffered=0,this.shifted=0,this.queue=new a,this._offset=0}push(e){this.buffered+=e.byteLength,this.queue.push(e)}shiftFirst(e){return 0===this._buffered?null:this._next(e)}shift(e){if(e>this.buffered)return null;if(0===e)return l;let t=this._next(e);if(e===t.byteLength)return t;const n=[t];for(;(e-=t.byteLength)>0;)t=this._next(e),n.push(t);return o.concat(n)}_next(e){const t=this.queue.peek(),n=t.byteLength-this._offset;if(e>=n){const e=this._offset?t.subarray(this._offset,t.byteLength):t;return this.queue.shift(),this._offset=0,this.buffered-=n,this.shifted+=n,e}return this.buffered-=e,this.shifted+=e,t.subarray(this._offset,this._offset+=e)}}class d extends s{constructor(e,t,n){super(),this.header=t,this.offset=n,this._parent=e}_read(e){0===this.header.size&&this.push(null),this._parent._stream===this&&this._parent._update(),e(null)}_predestroy(){this._parent.destroy(i(this))}_detach(){this._parent._stream===this&&(this._parent._stream=null,this._parent._missing=f(this.header.size),this._parent._update())}_destroy(e){this._detach(),e(null)}}class p extends r{constructor(e){super(e),e||(e={}),this._buffer=new u,this._offset=0,this._header=null,this._stream=null,this._missing=0,this._longHeader=!1,this._callback=h,this._locked=!1,this._finished=!1,this._pax=null,this._paxGlobal=null,this._gnuLongPath=null,this._gnuLongLinkPath=null,this._filenameEncoding=e.filenameEncoding||"utf-8",this._allowUnknownFormat=!!e.allowUnknownFormat,this._unlockBound=this._unlock.bind(this)}_unlock(e){if(this._locked=!1,e)return this.destroy(e),void this._continueWrite(e);this._update()}_consumeHeader(){if(this._locked)return!1;this._offset=this._buffer.shifted;try{this._header=c.decode(this._buffer.shift(512),this._filenameEncoding,this._allowUnknownFormat)}catch(e){return this._continueWrite(e),!1}if(!this._header)return!0;switch(this._header.type){case"gnu-long-path":case"gnu-long-link-path":case"pax-global-header":case"pax-header":return this._longHeader=!0,this._missing=this._header.size,!0}return this._locked=!0,this._applyLongHeaders(),0===this._header.size||"directory"===this._header.type?(this.emit("entry",this._header,this._createStream(),this._unlockBound),!0):(this._stream=this._createStream(),this._missing=this._header.size,this.emit("entry",this._header,this._stream,this._unlockBound),!0)}_applyLongHeaders(){this._gnuLongPath&&(this._header.name=this._gnuLongPath,this._gnuLongPath=null),this._gnuLongLinkPath&&(this._header.linkname=this._gnuLongLinkPath,this._gnuLongLinkPath=null),this._pax&&(this._pax.path&&(this._header.name=this._pax.path),this._pax.linkpath&&(this._header.linkname=this._pax.linkpath),this._pax.size&&(this._header.size=parseInt(this._pax.size,10)),this._header.pax=this._pax,this._pax=null)}_decodeLongHeader(e){switch(this._header.type){case"gnu-long-path":this._gnuLongPath=c.decodeLongPath(e,this._filenameEncoding);break;case"gnu-long-link-path":this._gnuLongLinkPath=c.decodeLongPath(e,this._filenameEncoding);break;case"pax-global-header":this._paxGlobal=c.decodePax(e);break;case"pax-header":this._pax=null===this._paxGlobal?c.decodePax(e):Object.assign({},this._paxGlobal,c.decodePax(e))}}_consumeLongHeader(){this._longHeader=!1,this._missing=f(this._header.size);const e=this._buffer.shift(this._header.size);try{this._decodeLongHeader(e)}catch(e){return this._continueWrite(e),!1}return!0}_consumeStream(){const e=this._buffer.shiftFirst(this._missing);if(null===e)return!1;this._missing-=e.byteLength;const t=this._stream.push(e);return 0===this._missing?(this._stream.push(null),t&&this._stream._detach(),t&&!1===this._locked):t}_createStream(){return new d(this,this._header,this._offset)}_update(){for(;this._buffer.buffered>0&&!this.destroying;){if(this._missing>0){if(null!==this._stream){if(!1===this._consumeStream())return;continue}if(!0===this._longHeader){if(this._missing>this._buffer.buffered)break;if(!1===this._consumeLongHeader())return!1;continue}const e=this._buffer.shiftFirst(this._missing);null!==e&&(this._missing-=e.byteLength);continue}if(this._buffer.buffered<512)break;if(null!==this._stream||!1===this._consumeHeader())return}this._continueWrite(null)}_continueWrite(e){const t=this._callback;this._callback=h,t(e)}_write(e,t){this._callback=t,this._buffer.push(e),this._update()}_final(e){this._finished=0===this._missing&&0===this._buffer.buffered,e(this._finished?null:new Error("Unexpected end of data"))}_predestroy(){this._continueWrite(null)}_destroy(e){this._stream&&this._stream.destroy(i(this)),e(null)}[Symbol.asyncIterator](){let e=null,t=null,n=null,r=null,s=null;const i=this;return this.on("entry",function(e,i,a){s=a,i.on("error",h),t?(t({value:i,done:!1}),t=n=null):r=i}),this.on("error",t=>{e=t}),this.on("close",function(){if(a(e),!t)return;e?n(e):t({value:undefined,done:!0});t=n=null}),{[Symbol.asyncIterator](){return this},next:()=>new Promise(o),return:()=>c(null),throw:e=>c(e)};function a(e){if(!s)return;const t=s;s=null,t(e)}function o(s,o){return e?o(e):r?(s({value:r,done:!1}),void(r=null)):(t=s,n=o,a(null),void(i._finished&&t&&(t({value:undefined,done:!0}),t=n=null)))}function c(e){return i.destroy(e),a(e),new Promise((t,n)=>{if(i.destroyed)return t({value:undefined,done:!0});i.once("close",function(){e?n(e):t({value:undefined,done:!0})})})}}}function h(){}function f(e){return(e&=511)&&512-e}t.exports=function(e){return new p(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/extract.js"}],[2583,{b4a:3757},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("b4a"),s="0".charCodeAt(0),i=r.from([117,115,116,97,114,0]),a=r.from([s,s]),o=r.from([117,115,116,97,114,32]),c=r.from([32,0]),l=257,u=263;function d(e,t,n,r){for(;n<r;n++)if(e[n]===t)return n;return r}function p(e){let t=256;for(let n=0;n<148;n++)t+=e[n];for(let n=156;n<512;n++)t+=e[n];return t}function h(e,t){return(e=e.toString(8)).length>t?"7777777777777777777".slice(0,t)+" ":"0000000000000000000".slice(0,t-e.length)+e+" "}function f(e,t,n){if(128&(e=e.subarray(t,t+n))[t=0])return function(e){let t;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}const n=[];let r;for(r=e.length-1;r>0;r--){const s=e[r];t?n.push(s):n.push(255-s)}let s=0;const i=n.length;for(r=0;r<i;r++)s+=n[r]*Math.pow(256,r);return t?s:-1*s}(e);{for(;t<e.length&&32===e[t];)t++;const n=(s=d(e,32,t,e.length),i=e.length,a=e.length,"number"!=typeof s?a:(s=~~s)>=i?i:s>=0||(s+=i)>=0?s:0);for(;t<n&&0===e[t];)t++;return n===t?0:parseInt(r.toString(e.subarray(t,n)),8)}var s,i,a}function m(e,t,n,s){return r.toString(e.subarray(t,d(e,0,t,t+n)),s)}function g(e){const t=r.byteLength(e);let n=Math.floor(Math.log(t)/Math.log(10))+1;return t+n>=Math.pow(10,n)&&n++,t+n+e}n.decodeLongPath=function(e,t){return m(e,0,e.length,t)},n.encodePax=function(e){let t="";e.name&&(t+=g(" path="+e.name+"\n")),e.linkname&&(t+=g(" linkpath="+e.linkname+"\n"));const n=e.pax;if(n)for(const e in n)t+=g(" "+e+"="+n[e]+"\n");return r.from(t)},n.decodePax=function(e){const t={};for(;e.length;){let n=0;for(;n<e.length&&32!==e[n];)n++;const s=parseInt(r.toString(e.subarray(0,n)),10);if(!s)return t;const i=r.toString(e.subarray(n+1,s-1)),a=i.indexOf("=");if(-1===a)return t;t[i.slice(0,a)]=i.slice(a+1),e=e.subarray(s)}return t},n.encode=function(e){const t=r.alloc(512);let n=e.name,o="";if(5===e.typeflag&&"/"!==n[n.length-1]&&(n+="/"),r.byteLength(n)!==n.length)return null;for(;r.byteLength(n)>100;){const e=n.indexOf("/");if(-1===e)return null;o+=o?"/"+n.slice(0,e):n.slice(0,e),n=n.slice(e+1)}return r.byteLength(n)>100||r.byteLength(o)>155||e.linkname&&r.byteLength(e.linkname)>100?null:(r.write(t,n),r.write(t,h(4095&e.mode,6),100),r.write(t,h(e.uid,6),108),r.write(t,h(e.gid,6),116),function(e,t,n){e.toString(8).length>11?function(e,t,n){t[n]=128;for(let r=11;r>0;r--)t[n+r]=255&e,e=Math.floor(e/256)}(e,t,n):r.write(t,h(e,11),n)}(e.size,t,124),r.write(t,h(e.mtime.getTime()/1e3|0,11),136),t[156]=s+function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0}(e.type),e.linkname&&r.write(t,e.linkname,157),r.copy(i,t,l),r.copy(a,t,263),e.uname&&r.write(t,e.uname,265),e.gname&&r.write(t,e.gname,297),r.write(t,h(e.devmajor||0,6),329),r.write(t,h(e.devminor||0,6),337),o&&r.write(t,o,345),r.write(t,h(p(t),6),148),t)},n.decode=function(e,t,n){let a=0===e[156]?0:e[156]-s,d=m(e,0,100,t);const h=f(e,100,8),g=f(e,108,8),y=f(e,116,8),b=f(e,124,12),_=f(e,136,12),v=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null}(a),w=0===e[157]?null:m(e,157,100,t),S=m(e,265,32),E=m(e,297,32),T=f(e,329,8),k=f(e,337,8),P=p(e);if(256===P)return null;if(P!==f(e,148,8))throw new Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(function(e){return r.equals(i,e.subarray(l,263))}(e))e[345]&&(d=m(e,345,155,t)+"/"+d);else if(function(e){return r.equals(o,e.subarray(l,263))&&r.equals(c,e.subarray(u,265))}(e));else if(!n)throw new Error("Invalid tar header: unknown format.");return 0===a&&d&&"/"===d[d.length-1]&&(a=5),{name:d,mode:h,uid:g,gid:y,size:b,mtime:new Date(1e3*_),type:v,linkname:w,uname:S,gname:E,devmajor:T,devminor:k,pax:null}}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/headers.js"}],[2584,{"./extract":2582,"./pack":2585},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){n.extract=e("./extract"),n.pack=e("./pack")}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/index.js"}],[2585,{"./constants":2581,"./headers":2583,b4a:3757,streamx:5489},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const{Readable:r,Writable:s,getStreamError:i}=e("streamx"),a=e("b4a"),o=e("./constants"),c=e("./headers"),l=a.alloc(1024);class u extends s{constructor(e,t,n){super({mapWritable:f,eagerOpen:!0}),this.written=0,this.header=t,this._callback=n,this._linkname=null,this._isLinkname="symlink"===t.type&&!t.linkname,this._isVoid="file"!==t.type&&"contiguous-file"!==t.type,this._finished=!1,this._pack=e,this._openCallback=null,null===this._pack._stream?this._pack._stream=this:this._pack._pending.push(this)}_open(e){this._openCallback=e,this._pack._stream===this&&this._continueOpen()}_continuePack(e){if(null===this._callback)return;const t=this._callback;this._callback=null,t(e)}_continueOpen(){null===this._pack._stream&&(this._pack._stream=this);const e=this._openCallback;if(this._openCallback=null,null!==e){if(this._pack.destroying)return e(new Error("pack stream destroyed"));if(this._pack._finalized)return e(new Error("pack stream is already finalized"));this._pack._stream=this,this._isLinkname||this._pack._encode(this.header),this._isVoid&&(this._finish(),this._continuePack(null)),e(null)}}_write(e,t){return this._isLinkname?(this._linkname=this._linkname?a.concat([this._linkname,e]):e,t(null)):this._isVoid?e.byteLength>0?t(new Error("No body allowed for this entry")):t():(this.written+=e.byteLength,this._pack.push(e)?t():void(this._pack._drain=t))}_finish(){this._finished||(this._finished=!0,this._isLinkname&&(this.header.linkname=this._linkname?a.toString(this._linkname,"utf-8"):"",this._pack._encode(this.header)),h(this._pack,this.header.size),this._pack._done(this))}_final(e){if(this.written!==this.header.size)return e(new Error("Size mismatch"));this._finish(),e(null)}_getError(){return i(this)||new Error("tar entry destroyed")}_predestroy(){this._pack.destroy(this._getError())}_destroy(e){this._pack._done(this),this._continuePack(this._finished?null:this._getError()),e()}}class d extends r{constructor(e){super(e),this._drain=p,this._finalized=!1,this._finalizing=!1,this._pending=[],this._stream=null}entry(e,t,n){if(this._finalized||this.destroying)throw new Error("already finalized or destroyed");"function"==typeof t&&(n=t,t=null),n||(n=p),e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&o.S_IFMT){case o.S_IFBLK:return"block-device";case o.S_IFCHR:return"character-device";case o.S_IFDIR:return"directory";case o.S_IFIFO:return"fifo";case o.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?493:420),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=a.from(t));const r=new u(this,e,n);return a.isBuffer(t)?(e.size=t.byteLength,r.write(t),r.end(),r):(r._isVoid,r)}finalize(){this._stream||this._pending.length>0?this._finalizing=!0:this._finalized||(this._finalized=!0,this.push(l),this.push(null))}_done(e){e===this._stream&&(this._stream=null,this._finalizing&&this.finalize(),this._pending.length&&this._pending.shift()._continueOpen())}_encode(e){if(!e.pax){const t=c.encode(e);if(t)return void this.push(t)}this._encodePax(e)}_encodePax(e){const t=c.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),n={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.byteLength,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(c.encode(n)),this.push(t),h(this,t.byteLength),n.size=e.size,n.type=e.type,this.push(c.encode(n))}_doDrain(){const e=this._drain;this._drain=p,e()}_predestroy(){const e=i(this);for(this._stream&&this._stream.destroy(e);this._pending.length;){const t=this._pending.shift();t.destroy(e),t._continueOpen()}this._doDrain()}_read(e){this._doDrain(),e()}}function p(){}function h(e,t){(t&=511)&&e.push(l.subarray(0,512-t))}function f(e){return a.isBuffer(e)?e:a.from(e)}t.exports=function(e){return new d(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/pack.js"}],[259,{loglevel:4643,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({location:e,registerOnboarding:t}){return async function(n,i,a,o){try{if("wallet_registerOnboarding"!==n.method)return void a();n.tabId&&n.tabId!==s.default.tabs.TAB_ID_NONE?await t(e,n.tabId):r.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),i.result=!0,o()}catch(e){o(e)}}};var r=i(e("loglevel")),s=i(e("webextension-polyfill"));function i(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[2590,{"./verify":2591,"@metamask/superstruct":2810,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const i=e("@metamask/superstruct"),a=e("@metamask/utils"),o=(0,i.refine)((0,i.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,i.object)({checksum:a.ChecksumStruct,clientVersions:(0,i.optional)((0,i.object)({extension:(0,i.optional)(a.VersionRangeStruct),mobile:(0,i.optional)(a.VersionRangeStruct)}))});n.AuthorStruct=(0,i.object)({name:(0,i.string)(),website:(0,i.string)()}),n.AuditStruct=(0,i.object)({auditor:(0,i.string)(),report:(0,i.string)()}),n.SupportStruct=(0,i.object)({knowledgeBase:(0,i.optional)((0,i.string)()),faq:(0,i.optional)((0,i.string)()),contact:(0,i.optional)((0,i.string)()),keyRecovery:(0,i.optional)((0,i.string)())}),n.AdditionalSourceCodeStruct=(0,i.object)({name:(0,i.string)(),url:(0,i.string)()}),n.ImagePathStruct=(0,i.pattern)((0,i.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,i.object)({id:o,metadata:(0,i.object)({name:(0,i.string)(),type:(0,i.optional)((0,i.enums)(["account"])),author:(0,i.optional)(n.AuthorStruct),website:(0,i.optional)((0,i.string)()),onboard:(0,i.optional)((0,i.boolean)()),summary:(0,i.optional)((0,i.string)()),description:(0,i.optional)((0,i.string)()),audits:(0,i.optional)((0,i.array)(n.AuditStruct)),category:(0,i.optional)((0,i.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,i.optional)((0,i.array)((0,i.string)())),support:(0,i.optional)(n.SupportStruct),sourceCode:(0,i.optional)((0,i.string)()),hidden:(0,i.optional)((0,i.boolean)()),privateCode:(0,i.optional)((0,i.boolean)()),privacyPolicy:(0,i.optional)((0,i.string)()),termsOfUse:(0,i.optional)((0,i.string)()),additionalSourceCode:(0,i.optional)((0,i.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,i.optional)((0,i.size)((0,i.array)(n.ImagePathStruct),3,3))}),versions:(0,i.record)(a.VersionStruct,c)}),n.BlockReasonStruct=(0,i.object)({explanation:(0,i.optional)((0,i.string)()),url:(0,i.optional)((0,i.string)())}),n.BlockedSnapStruct=(0,i.union)([(0,i.object)({id:o,versionRange:a.VersionRangeStruct,reason:(0,i.optional)(n.BlockReasonStruct)}),(0,i.object)({checksum:a.ChecksumStruct,reason:(0,i.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,i.object)({verifiedSnaps:(0,i.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,i.array)(n.BlockedSnapStruct)}),s(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[2591,{"@metamask/superstruct":2810,"@metamask/utils":2914,"@noble/curves/secp256k1":2955,"@noble/hashes/sha256":2967},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const r=e("@metamask/superstruct"),s=e("@metamask/utils"),i=e("@noble/curves/secp256k1"),a=e("@noble/hashes/sha256");n.SignatureStruct=(0,r.object)({signature:s.StrictHexStruct,curve:(0,r.literal)("secp256k1"),format:(0,r.literal)("DER")}),n.verify=function({registry:e,signature:t,publicKey:r}){(0,s.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,s.hexToBytes)(r);return i.secp256k1.verify((0,s.remove0x)(t.signature),(0,a.sha256)((0,s.stringToBytes)(e)),o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[26,{"../../controllers/network-order":219},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkOrderControllerInit=void 0;var r=e("../../controllers/network-order");n.NetworkOrderControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.NetworkOrderController({messenger:e,state:{orderedNetworkList:[],...t.NetworkOrderController}})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/network-order-controller-init.ts"}],[260,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){t.origin=e.origin,r()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[261,{"../../../shared/constants/app":5598,"@metamask/rpc-errors":2480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SPAM_FILTER_ACTIVATED_ERROR=n.REJECTION_THRESHOLD_IN_MS=n.NUMBER_OF_REJECTIONS_THRESHOLD=n.BLOCKING_THRESHOLD_IN_MS=n.BLOCKABLE_METHODS=void 0,n.default=function({getThrottledOriginState:e,updateThrottledOriginState:t}){return function(n,r,s,p){const{method:h,origin:f}=n;if(!c.has(h)||l.includes(f))return void s();!function(e){if(!e)return!1;const t=Date.now(),{rejections:n,lastRejection:r}=e,s=t-r<=o;return n>=i&&s}(e(f))?s(n=>{if("error"in r&&r.error&&d(r.error)){var s;const i=null===(s=r.error)||void 0===s?void 0:s.data;if("rejectAllApprovals"===(null==i?void 0:i.cause))return void n();const o=e(f)||{rejections:0,lastRejection:0},c=Date.now(),l=c-o.lastRejection<a?o.rejections+1:1;t(f,{rejections:l,lastRejection:c})}else{const n=e(f);Boolean(n)&&t(f,{rejections:0,lastRejection:0})}n()}):p(u)}};var r=e("@metamask/rpc-errors"),s=e("../../../shared/constants/app");const i=n.NUMBER_OF_REJECTIONS_THRESHOLD=3,a=n.REJECTION_THRESHOLD_IN_MS=3e4,o=n.BLOCKING_THRESHOLD_IN_MS=6e4,c=n.BLOCKABLE_METHODS=new Set([s.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN,s.MESSAGE_TYPE.ETH_SEND_TRANSACTION,s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA,s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1,s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3,s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4,s.MESSAGE_TYPE.PERSONAL_SIGN,s.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,s.MESSAGE_TYPE.WALLET_SEND_CALLS,s.MESSAGE_TYPE.WATCH_ASSET]),l=["http://127.0.0.1:8080","http://127.0.0.1:8081","http://127.0.0.1:8082","http://localhost:8080","http://localhost:8081","http://localhost:8082"],u=n.SPAM_FILTER_ACTIVATED_ERROR=r.providerErrors.unauthorized("Request blocked due to spam filter."),d=e=>e.code===r.errorCodes.provider.userRejectedRequest}}},{package:"$root$",file:"app/scripts/lib/createOriginThrottlingMiddleware.ts"}],[262,{"../../../shared/constants/app":5598,"../../../shared/constants/metametrics":5613,"../../../shared/constants/security-provider":5626,"../../../shared/constants/signatures":5627,"../../../shared/constants/transaction":5637,"../../../shared/lib/confirmation.utils":5650,"../../../shared/lib/snaps/snaps":5713,"../../../shared/modules/error":5737,"../../../shared/modules/transaction.utils":5763,"../../../ui/helpers/utils/metrics":6938,"./snap-keyring/metrics":322,"@metamask/controller-utils":1383,"@metamask/rpc-errors":2480,"ethereumjs-util":4138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({rateLimitTimeout:e=3e5,rateLimitSamplePercent:t=.001,globalRateLimitTimeout:n=3e5,globalRateLimitMaxAmount:P=10,getAccountType:O,getDeviceModel:M,getHardwareTypeForMetric:A,snapAndHardwareMessenger:j,appStateController:R,metaMetricsController:I,getHDEntropyIndex:C}){return async function(N,x,L){const{origin:D,method:U,params:$}=N,G=function(e){return[a.MESSAGE_TYPE.WALLET_CREATE_SESSION,a.MESSAGE_TYPE.WALLET_INVOKE_METHOD].includes(e)}(U),F=G?o.MetaMetricsRequestedThrough.MultichainApi:o.MetaMetricsRequestedThrough.EthereumProvider,H=G?o.MetaMetricsEventCategory.MultichainApi:o.MetaMetricsEventCategory.InpageProvider;let q,B=U;var V;U===a.MESSAGE_TYPE.WALLET_INVOKE_METHOD&&(B=null==$||null===(V=$.request)||void 0===V?void 0:V.method,q=null==$?void 0:$.scope);const Y=_[B];let W;switch(Y){case y.TIMEOUT:W=void 0!==T[B];break;case y.NON_RATE_LIMITED:W=!1;break;case y.BLOCKED:W=!0;break;default:case y.RANDOM_SAMPLE:W=Math.random()>=t}const z=P>0&&k>=P,K=!0===I.state.participateInMetaMetrics,J=w[B],Q={api_source:F};let Z;q&&(Q.chain_id_caip=q);const X=(0,m.isSnapPreinstalled)(D),ee=D!==a.ORIGIN_METAMASK&&!X&&!W&&!z&&!0===K;if(ee){var te;const t=J?J.REQUESTED:o.MetaMetricsEventName.ProviderMethodCalled;if(t===o.MetaMetricsEventName.SignatureRequested){var ne,re,se,ie,ae;let e;var oe,ce;if(Q.signature_type=B,Q.hd_entropy_index=C(),(0,i.isValidAddress)(null==N||null===(ne=N.params)||void 0===ne?void 0:ne[1]))e=null==N||null===(oe=N.params)||void 0===oe?void 0:oe[0];else e=null==N||null===(ce=N.params)||void 0===ce?void 0:ce[1];null!==(re=N.securityAlertResponse)&&void 0!==re&&re.providerRequestsCount&&Object.keys(N.securityAlertResponse.providerRequestsCount).forEach(e=>{Q[`ppom_${e}_count`]=N.securityAlertResponse.providerRequestsCount[e]}),Q.security_alert_response=(null===(se=N.securityAlertResponse)||void 0===se?void 0:se.result_type)??l.BlockaidResultType.NotApplicable,Q.security_alert_reason=(null===(ie=N.securityAlertResponse)||void 0===ie?void 0:ie.reason)??l.BlockaidReason.notApplicable,null!==(ae=N.securityAlertResponse)&&void 0!==ae&&ae.description&&(Q.security_alert_description=N.securityAlertResponse.description),(0,f.shouldUseRedesignForSignatures)({approvalType:v[B]})&&(Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.RedesignedConfirmation]);const t=await(0,g.getSnapAndHardwareInfoForMetrics)(O,M,A,j);Object.assign(Q,t);try{if(B===a.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,r.detectSIWE)({data:e});t&&(Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Siwe])}else if(B===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4){const t=(0,c.parseTypedDataMessage)(e);Z={},Q.eip712_primary_type=t.primaryType,Z.eip712_verifyingContract=t.domain.verifyingContract,Z.eip712_domain_version=t.domain.version,Z.eip712_domain_name=t.domain.name,u.PRIMARY_TYPES_PERMIT.includes(t.primaryType)?Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Permit]:u.PRIMARY_TYPES_ORDER.includes(t.primaryType)&&(Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Order])}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else Q.method=B;const s=S[B];if(s&&(Q.params=s($)),null===(te=E[B])||void 0===te||te.call(E,N,undefined,b.REQUESTED,Q),t===o.MetaMetricsEventName.SignatureRequested){!function(e,t,n,r){e.createEventFragment({category:r,initialEvent:o.MetaMetricsEventName.SignatureRequested,successEvent:o.MetaMetricsEventName.SignatureApproved,failureEvent:o.MetaMetricsEventName.SignatureRejected,uniqueIdentifier:(0,h.generateSignatureUniqueId)(t.id),persist:!0,referrer:{url:t.origin},...n})}(I,N,{properties:Q,sensitiveProperties:Z},H)}else I.trackEvent({event:t,category:H,referrer:{url:D},properties:Q});Y===y.TIMEOUT&&(T[B]=setTimeout(()=>{delete T[B]},e)),k+=1,setTimeout(()=>{k-=1},n)}L(async e=>{var t,n,r,i;if(!1===ee||void 0===J)return e();const a=null===(t=x.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.location;let c,l;const u=(0,p.getErrorMessage)(x.error);if((null===(n=x.error)||void 0===n?void 0:n.code)===s.errorCodes.provider.userRejectedRequest?(c=J.REJECTED,l=b.REJECTED):(null===(r=x.error)||void 0===r?void 0:r.code)===s.errorCodes.rpc.internal&&[u,x.error.message].includes("Request rejected by user or snap.")?(c=J.REJECTED,l=b.REJECTED,Q.status=u):(c=J.APPROVED,l=b.APPROVED),!c)return e();if(null===(i=E[B])||void 0===i||i.call(E,N,x,l,Q),J.REQUESTED===o.MetaMetricsEventName.SignatureRequested){const e=await(0,g.getSnapAndHardwareInfoForMetrics)(O,M,A,j);Object.assign(Q,e)}let f={};if(d.SIGNING_METHODS.includes(B)){var m;const e=R.getSignatureSecurityAlertResponse(null===(m=N.securityAlertResponse)||void 0===m?void 0:m.securityAlertId);f=(0,h.getBlockaidMetricsProps)({securityAlertResponse:e})}const y={...Q,...f,location:a};if(c===o.MetaMetricsEventName.SignatureRejected||c===o.MetaMetricsEventName.SignatureApproved){const e={abandoned:c===J.REJECTED},t={properties:{...y,hd_entropy_index:C()},sensitiveProperties:Z};!function(e,t,n,r){const s=(0,h.generateSignatureUniqueId)(t.id);e.updateEventFragment(s,r),e.finalizeEventFragment(s,n)}(I,N,e,t)}else I.trackEvent({event:c,category:H,referrer:{url:D},properties:y});return e()})}};var r=e("@metamask/controller-utils"),s=e("@metamask/rpc-errors"),i=e("ethereumjs-util"),a=e("../../../shared/constants/app"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/modules/transaction.utils"),l=e("../../../shared/constants/security-provider"),u=e("../../../shared/constants/signatures"),d=e("../../../shared/constants/transaction"),p=e("../../../shared/modules/error"),h=e("../../../ui/helpers/utils/metrics"),f=e("../../../shared/lib/confirmation.utils"),m=e("../../../shared/lib/snaps/snaps"),g=e("./snap-keyring/metrics");const y={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},b={REQUESTED:"REQUESTED",APPROVED:"APPROVED",REJECTED:"REJECTED"},_={[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.PERSONAL_SIGN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_DECRYPT]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:y.TIMEOUT,[a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:y.TIMEOUT,[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.SEND_METADATA]:y.BLOCKED,[a.MESSAGE_TYPE.ETH_CHAIN_ID]:y.BLOCKED,[a.MESSAGE_TYPE.ETH_ACCOUNTS]:y.BLOCKED,[a.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:y.BLOCKED,[a.MESSAGE_TYPE.GET_PROVIDER_STATE]:y.BLOCKED,[a.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:y.NON_RATE_LIMITED},v={[a.MESSAGE_TYPE.PERSONAL_SIGN]:r.ApprovalType.PersonalSign,[a.MESSAGE_TYPE.SIGN]:r.ApprovalType.SignTransaction,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:r.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:r.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:r.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:r.ApprovalType.EthSignTypedData},w={[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:o.MetaMetricsEventName.DecryptionApproved,REJECTED:o.MetaMetricsEventName.DecryptionRejected,REQUESTED:o.MetaMetricsEventName.DecryptionRequested},[a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:o.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:o.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:o.MetaMetricsEventName.EncryptionPublicKeyRequested},[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[a.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called}},S={[a.MESSAGE_TYPE.WATCH_ASSET]:({type:e})=>({type:e}),[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e}),[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e})},E={[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:function(e,t,n,r){var s;if(n!==b.REQUESTED)return;const{params:i}=e,a=null==i||null===(s=i[0])||void 0===s||null===(s=s.calls)||void 0===s?void 0:s.length;a&&(r.batch_transaction_count=a)},[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:function(e,t,n,r){if(n===b.REQUESTED){const{params:t}=e,n=(null==t?void 0:t.requiredScopes)||{},s=(null==t?void 0:t.optionalScopes)||{},i=new Set;for(const e of Object.keys(n))i.add(e);for(const e of Object.keys(s))i.add(e);r.chain_id_list=Array.from(i)}else if(n===b.APPROVED){const{result:e}=t,n=Object.keys((null==e?void 0:e.sessionScopes)||{});r.chain_id_list=n}}},T={};let k=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[263,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){t.tabId=e.tabId,r()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[264,{"../../../shared/constants/app":5598,"../../../shared/lib/trace":5718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return async function(e,t,n){const{id:r,method:o}=e,c=i[o];c&&(e.traceContext=await(0,s.trace)({name:c,id:r,tags:a[o]}),await(0,s.trace)({name:s.TraceName.Middleware,id:r,parentContext:e.traceContext})),n()}};var r=e("../../../shared/constants/app"),s=e("../../../shared/lib/trace");const i={[r.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:s.TraceName.Transaction,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:s.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:s.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:s.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:s.TraceName.Signature,[r.MESSAGE_TYPE.PERSONAL_SIGN]:s.TraceName.Signature},a={[r.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:{source:"dapp"}}}}},{package:"$root$",file:"app/scripts/lib/createTracingMiddleware.ts"}],[265,{"./dapp-swap-util":266},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createDappSwapMiddleware=function({fetchQuotes:e,setDappSwapComparisonData:t,getNetworkConfigurationByNetworkClientId:n,dappSwapMetricsFlag:s}){return async(i,a,o)=>{const{securityAlertResponse:c}=i,{securityAlertId:l}=c??{};l&&"eth_sendTransaction"===i.method&&(0,r.getQuotesForConfirmation)({req:i,fetchQuotes:e,setDappSwapComparisonData:t,getNetworkConfigurationByNetworkClientId:n,dappSwapMetricsFlag:s,securityAlertId:l}),o()}};var r=e("./dapp-swap-util")}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-middleware.ts"}],[266,{"../../../../shared/lib/sentry":5711,"../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils":5734,loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesForConfirmation=function({req:e,fetchQuotes:t,setDappSwapComparisonData:n,getNetworkConfigurationByNetworkClientId:r,dappSwapMetricsFlag:u,securityAlertId:d}){let p="";try{const{enabled:h,bridge_quote_fees:f}=u;if(!h||!d)return;const{params:m,origin:g}=e;if(g===o||g===c){const{chainId:o}=r(e.networkClientId)??{},{data:c,from:u}=l(m);if(c&&d&&o){const e=(0,a.parseTransactionData)(c);p=e.commands;const{quotesInput:r,tokenAddresses:l}=(0,a.getDataFromSwap)(o,e.commandBytes,e.inputs);if(r){(0,a.checkValidSingleOrBatchTransaction)(m[0].calls,null==r?void 0:r.srcTokenAddress);const e=(new Date).getTime();t({...r,walletAddress:u,fee:f}).then(t=>{const r=(new Date).getTime();t&&n(d,{quotes:t,latency:r-e,tokenAddresses:l})}).catch(e=>{n(d,{error:`Error fetching bridge quotes: ${e.message}`,commands:p}),s.default.error("Error fetching dapp swap quotes",e),(0,i.captureException)(e)})}}}}catch(e){d&&n(d,{error:`Error fetching bridge quotes: ${e.toString()}`,commands:p}),(0,i.captureException)(`Error fetching bridge quotes: ${e.toString()}`)}};var r,s=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("../../../../shared/lib/sentry"),a=e("../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils");const o="https://app.uniswap.org",c="https://metamask.github.io",l=e=>{if(null==e||!e.length)return{data:undefined,from:undefined,chainId:undefined};const{calls:t,chainId:n,data:r,from:s}=e[0];let i=r;if(null!=t&&t.length){const e=null==t?void 0:t.find(({data:e})=>null==e?void 0:e.startsWith("0x3593564c"));e&&(i=null==e?void 0:e.data)}return{chainId:n,data:i,from:s}}}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-util.ts"}],[267,{"../../../../shared/lib/deep-links/constants":5652,"../../../../shared/lib/deep-links/parse":5654,"../../../../shared/lib/deep-links/routes/route":5664,"../../../../shared/lib/deep-links/verify":5668,"../../../../shared/modules/mv3.utils":5744,events:4180,loglevel:4643,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DeepLinkRouter=void 0;var r=d(e("events")),s=d(e("webextension-polyfill")),i=d(e("loglevel")),a=e("../../../../shared/modules/mv3.utils"),o=e("../../../../shared/lib/deep-links/parse"),c=e("../../../../shared/lib/deep-links/constants"),l=e("../../../../shared/lib/deep-links/routes/route"),u=e("../../../../shared/lib/deep-links/verify");function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=l.DEEP_LINK_ROUTE.replace(/^\//u,"");class f extends r.default{constructor({getExtensionURL:e,getState:t}){super(),p(this,"getExtensionURL",void 0),p(this,"getState",void 0),p(this,"handleBeforeRequest",({tabId:e,url:t})=>e===s.default.tabs.TAB_ID_NONE?{}:this.tryNavigateTo(e,t)),this.getExtensionURL=e,this.getState=t}formatUrlForInterstitialPage(e){return e.pathname+e.search}get404ErrorURL(e){const t=new URLSearchParams({errorCode:"404"});return e&&t.set("u",this.formatUrlForInterstitialPage(e)),this.getExtensionURL(h,t.toString())}async redirectTab(e,t){try{await s.default.tabs.update(e,{url:t})}catch(e){i.default.error("Error redirecting tab:",e),this.emit("error",e)}}install(){s.default.webRequest.onBeforeRequest.addListener(this.handleBeforeRequest,{urls:[`*://*.${c.DEEP_LINK_HOST}/*`],types:["main_frame"]},a.isManifestV3?[]:["blocking"])}uninstall(){s.default.webRequest.onBeforeRequest.removeListener(this.handleBeforeRequest)}async tryNavigateTo(e,t){if(t.length>c.DEEP_LINK_MAX_LENGTH)return i.default.debug("Url is too long, skipping deep link handling"),{};let n;try{const e=new URL(t),r=await(0,o.parse)(e);if(r)if(this.emit("navigate",{url:e,parsed:r}),"redirectTo"in r.destination)n=r.destination.redirectTo.toString();else if(this.canSkipInterstitial(r.signature))n=this.getExtensionURL(r.destination.path,r.destination.query.toString());else{const t=new URLSearchParams({u:this.formatUrlForInterstitialPage(e)});n=this.getExtensionURL(h,t.toString())}else n=this.get404ErrorURL(e)}catch(e){i.default.error("Invalid URL:",t,e),this.emit("error",e),n=this.get404ErrorURL()}return this.redirectTab(e,n),a.isManifestV3?{}:{cancel:!0}}canSkipInterstitial(e){var t;return e===u.VALID&&Boolean(null===(t=this.getState().preferences)||void 0===t?void 0:t.skipDeepLinkInterstitial)}}n.DeepLinkRouter=f}}},{package:"$root$",file:"app/scripts/lib/deep-links/deep-link-router.ts"}],[268,{"../../../../shared/constants/metametrics":5613},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEvent=function({signature:e,url:t}){const n={route:t.pathname,signature:e},i={};for(const[e,r]of t.searchParams.entries())"sig"!==e&&("attributionId"===e?n.attribution_id=r:s.has(e)?n[e]=r:i[e]=r);return{category:r.MetaMetricsEventCategory.DeepLink,event:r.MetaMetricsEventName.DeepLinkUsed,properties:n,sensitiveProperties:i}};var r=e("../../../../shared/constants/metametrics");const s=new Set(["utm_campaign","utm_content","utm_medium","utm_source","utm_term"])}}},{package:"$root$",file:"app/scripts/lib/deep-links/metrics.ts"}],[269,{"@metamask/browser-passworder":1335},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.encryptorFactory=void 0;var r=e("@metamask/browser-passworder");const s=e=>async(t,n,s,i)=>(0,r.encrypt)(t,n,s,i,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,n,s)=>(0,r.encryptWithDetail)(t,n,s,{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>async(t,n,s,i)=>(0,r.keyFromPassword)(t,n,s,i??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,r.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});n.encryptorFactory=e=>({encrypt:s(e),encryptWithKey:r.encryptWithKey,encryptWithDetail:i(e),decrypt:r.decrypt,decryptWithKey:r.decryptWithKey,decryptWithDetail:r.decryptWithDetail,keyFromPassword:a(e),isVaultUpdated:o(e),importKey:r.importKey,exportKey:r.exportKey,generateSalt:r.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[27,{"../../../../shared/constants/metametrics":5613,"@metamask/assets-controllers":1233,"@metamask/bridge-controller":1304},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NftControllerInit=void 0;var r=e("@metamask/assets-controllers"),s=e("@metamask/bridge-controller"),i=e("../../../../shared/constants/metametrics");n.NftControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>({controller:new r.NftController({state:n.NftController,messenger:e,onNftAdded:({address:e,symbol:n,tokenId:r,standard:a,source:o})=>t.call("MetaMetricsController:trackEvent",{event:i.MetaMetricsEventName.NftAdded,category:i.MetaMetricsEventCategory.Wallet,sensitiveProperties:{token_contract_address:e,token_symbol:n??null,token_id:r,token_standard:a,asset_type:s.AssetType.NFT,source:o}})})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-controller-init.ts"}],[270,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[271,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[272,{"./contracts/registry":270,"./contracts/resolver":271,"@ensdomains/content-hash":633,"@ethersproject/contracts":721,"@ethersproject/providers":759,"eth-ens-namehash":4084},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=async function({provider:e,name:t}){const n=r.default.hash(t),l=Number.parseInt(await e.request({method:"net_version"}),10),d=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(l);if(!d)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${l}"`);const p=new i.Web3Provider(e),h=new a.Contract(d,o.default,p),f=await h.resolver(n);if(u(f))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const m=new a.Contract(f,c.default,p),g=await m.supportsInterface("0xbc1c58d1"),y=await m.supportsInterface("0xd8389dc5");if(g){const e=await m.contenthash(n);let t=s.default.decode(e);const r=s.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=s.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(y){const e=await m.content(n);if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var r=l(e("eth-ens-namehash")),s=l(e("@ensdomains/content-hash")),i=e("@ethersproject/providers"),a=e("@ethersproject/contracts"),o=l(e("./contracts/registry")),c=l(e("./contracts/resolver"));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[273,{"../../../../shared/modules/fetch-with-timeout":5739,"./resolver":272,"base32-encode":3765,"base64-js":3766,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:a}){const c=u.map(e=>`*://*.${e}/*`);return i.default.webRequest.onErrorOccurred.addListener(d,{urls:c,types:["main_frame"]}),{remove(){i.default.webRequest.onErrorOccurred.removeListener(d)}};async function d(c){const{tabId:d,url:p}=c;if(-1===d||"0x1"!==t())return;const{hostname:h,pathname:f,search:m,hash:g}=new URL(p),y=h.split("."),b=y[y.length-1];u.includes(b)&&async function({tabId:t,name:c,pathname:u,search:d,fragment:p}){const h=n(),f=a(),m=`https://app.ens.domains/name/${c}`;f&&h&&await i.default.tabs.update(t,{url:"loading.html"});let g=m;0;try{const{type:t,hash:n}=await(0,o.default)({provider:e,name:c});if("ipfs-ns"===t||"ipns-ns"===t){if(""===h)return void(g=null);const e=`https://${n}.${t.slice(0,4)}.${h}${u}${d||""}${p||""}`;try{200===(await l(e,{method:"HEAD"})).status&&(g=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)g=`https://swarm-gateways.net/bzz:/${n}${u}${d||""}${p||""}`;else if("onion"===t||"onion3"===t)g=`http://${n}.onion${u}${d||""}${p||""}`;else if("zeronet"===t)g=`http://127.0.0.1:43110/${n}${u}${d||""}${p||""}`;else if("skynet-ns"===t){const e=n.padEnd(n.length+4-n.length%4,"="),t=s.default.toByteArray(e),i={padding:!1};g=`https://${(0,r.default)(t,"RFC4648-HEX",i).toLowerCase()}.siasky.net${u}${d||""}${p||""}`}}catch(e){console.warn(e)}finally{g&&(f||!f&&g!==m)&&await i.default.tabs.update(t,{url:g})}}({tabId:d,name:h,pathname:f,search:m,fragment:g})}};var r=c(e("base32-encode")),s=c(e("base64-js")),i=c(e("webextension-polyfill")),a=c(e("../../../../shared/modules/fetch-with-timeout")),o=c(e("./resolver"));function c(e){return e&&e.__esModule?e:{default:e}}const l=(0,a.default)(),u=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[274,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){s(e,t),t.set(e,n)}function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionLazyListener=void 0;var o=new WeakMap,c=new WeakMap,l=new WeakSet;function u(e){setTimeout(()=>{for(const[t,n]of i(c,this))for(const[r,{args:s}]of n){const n=`ExtensionLazyListener: Possible memory leak detected. The event "${t}.${r}" has been listened to, but no application code has added a listener after ${e}ms. There are currently ${s.length} buffered calls. If you are a developer of this extension, please ensure that you have added a listener for this event. If you are a user of this extension, please report this warning to the developers of the extension.`;console.warn(n)}},e)}function d(e,t){return i(o,this)[e][t]}n.ExtensionLazyListener=class{constructor(e,t={},n=2e4){var p,h;s(p=this,h=l),h.add(p),r(this,o,void 0),r(this,c,new Map),function(e,t,n){e.set(a(e,t),n)}(o,this,e);for(const[e,n]of Object.entries(t)){const t=new Map;for(const r of n){const n=[],s=(...e)=>{n.push(e)};a(l,this,d).call(this,e,r).addListener(s),t.set(r,{listener:s,args:n})}i(c,this).set(e,t)}a(l,this,u).call(this,n)}addListener(e,t,n){const r=a(l,this,d).call(this,e,t);r.addListener(n);const s=i(c,this).get(e);if(s){const a=s.get(t);if(a){r.removeListener(a.listener),s.delete(t),0===s.size&&i(c,this).delete(e);const{args:o}=a;for(let l=0,{length:u}=o;l<u;l++)try{if(n(...o[l]),!r.hasListener(n)){const n=l+1;n!==u&&(o.splice(0,n),s.set(t,a),i(c,this).set(e,s),r.addListener(a.listener));break}}catch(n){const d=l+1;throw d!==u&&(o.splice(0,d),s.set(t,a),i(c,this).set(e,s),r.addListener(a.listener)),n}}}}once(e,t){return new Promise(n=>{const r=a(l,this,d).call(this,e,t),s=i(c,this).get(e);if(s){const a=s.get(t),o=null==a?void 0:a.args.length;if(o)return n(a.args.shift()),r.removeListener(a.listener),void(1===o&&(s.delete(t),0===s.size&&i(c,this).delete(e)))}const o=(...e)=>{r.removeListener(o),n(e)};r.addListener(o)})}}}}},{package:"$root$",file:"app/scripts/lib/extension-lazy-listener/extension-lazy-listener.ts"}],[275,{"@metamask/snaps-sdk":2667,"@metamask/snaps-utils":2781},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forwardRequestToSnap=async function(e,t,n){const{method:i,params:a,origin:o}=n,{handleRequest:c,snapId:l}=e;if(!l)throw new s.InternalError(`No snapId configured for method ${i}`);if(!o)throw new s.InternalError(`No origin specified for method ${i}`);return await c({snapId:l,origin:o,handler:r.HandlerType.OnRpcRequest,request:{jsonrpc:"2.0",method:i,params:a}})};var r=e("@metamask/snaps-utils"),s=e("@metamask/snaps-sdk")}}},{package:"$root$",file:"app/scripts/lib/forwardRequestToSnap.ts"}],[276,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return s((0,r.cloneDeep)(e),e=>null===e?"null":typeof e)};var r=e("lodash");function s(e={},t){return Object.entries(e).forEach(([n,r])=>{e[n]="object"==typeof r&&null!==r?s(r,t):t(r)}),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[277,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[278,{"@metamask/messenger":2167},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRootMessenger=n.ROOT_MESSENGER_NAMESPACE=void 0;var r=e("@metamask/messenger");const s=n.ROOT_MESSENGER_NAMESPACE="Root";n.getRootMessenger=()=>new r.Messenger({namespace:s})}}},{package:"$root$",file:"app/scripts/lib/messenger.ts"}],[28,{"@metamask/assets-controllers":1233},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NftDetectionControllerInit=void 0;var r=e("@metamask/assets-controllers");n.NftDetectionControllerInit=e=>{const{controllerMessenger:t,getController:n}=e,s=()=>n("NftController");return{controller:new r.NftDetectionController({messenger:t,addNft:(...e)=>s().addNft(...e),getNftState:()=>s().state,disabled:!n("PreferencesController").state.useNftDetection})}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-detection-controller-init.ts"}],[280,{"../util":353,"@metamask/json-rpc-engine":2034},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,r.createAsyncMiddleware)(async(t,n,r)=>{const{method:s,params:i}=t;if("eth_getTransactionCount"!==s)return void r();const[a,o]=i;"pending"===o?n.result=await e(a,t.networkClientId):r()})},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,r.createAsyncMiddleware)(async(t,n,r)=>{const{method:i,params:a}=t;if("eth_getTransactionByHash"!==i)return void r();const[o]=a,c=e(o);c?n.result=(0,s.formatTxMetaForRpcResult)(c):r()})};var r=e("@metamask/json-rpc-engine"),s=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.js"}],[281,{events:4180,loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("events")),s=i(e("loglevel"));function i(e){return e&&e.__esModule?e:{default:e}}class a extends r.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort((e,t)=>e.version-t.version);const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter(function(t){return t.version>e.meta.version});for(const n of t)try{s.default.info(`Running migration ${n.version}...`);const t=await n.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==n.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,s.default.info(`Migration ${n.version} complete`)}catch(t){const r=t.message;return t.message=`MetaMask Migration Error #${n.version}: ${r}`,this.emit("error",t),e}return e}generateInitialState(e){return{data:e,meta:{version:this.defaultVersion}}}}n.default=a}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[283,{"../../../../shared/constants/metametrics":5613,"../../../../shared/lib/network-utils":5708,"../../../../shared/lib/only-keep-host":5709,"./utils":284,"@metamask/utils":2914,loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.onRpcEndpointDegraded=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:s,trackEvent:i}){u(a.MetaMetricsEventName.RpcServiceDegraded,{chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:s,trackEvent:i})},n.onRpcEndpointUnavailable=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:s,trackEvent:i}){u(a.MetaMetricsEventName.RpcServiceUnavailable,{chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:s,trackEvent:i})},n.trackRpcEndpointEvent=u;var r,s=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("@metamask/utils"),a=e("../../../../shared/constants/metametrics"),o=e("../../../../shared/lib/only-keep-host"),c=e("../../../../shared/lib/network-utils"),l=e("./utils");function u(e,{chainId:t,endpointUrl:n,error:r,infuraProjectId:u,trackEvent:d,metaMetricsId:p}){if(!(0,l.shouldCreateRpcServiceEvents)({error:r,metaMetricsId:p}))return;const h={chain_id_caip:`eip155:${(0,i.hexToNumber)(t)}`,rpc_endpoint_url:(0,c.isPublicEndpointUrl)(n,u)?(0,o.onlyKeepHost)(n):"custom",...(0,i.isObject)(r)&&"httpStatus"in r&&(0,i.isValidJson)(r.httpStatus)?{http_status:r.httpStatus}:{}};s.default.debug(`Creating Segment event "${e}" with ${JSON.stringify(h)}`),d({category:a.MetaMetricsEventCategory.Network,event:e,properties:h})}}}},{package:"$root$",file:"app/scripts/lib/network-controller/messenger-action-handlers.ts"}],[284,{"../../../../development/build/constants":586,"@metamask/network-controller":2227,"@metamask/remote-feature-flag-controller":2473},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PRODUCTION_LIKE_ENVIRONMENTS=void 0,n.shouldCreateRpcServiceEvents=function({error:e,metaMetricsId:t}){return(!e||!(0,r.isConnectionError)(e))&&t!==undefined&&null!==t&&function(e){if("production"===undefined)return!1;if(o.includes("production"))return(0,s.generateDeterministicRandomNumber)(e)<a;return!0}(t)};var r=e("@metamask/network-controller"),s=e("@metamask/remote-feature-flag-controller"),i=e("../../../../development/build/constants");const a=.01,o=n.PRODUCTION_LIKE_ENVIRONMENTS=[i.ENVIRONMENT.PRODUCTION,i.ENVIRONMENT.RELEASE_CANDIDATE]}}},{package:"$root$",file:"app/scripts/lib/network-controller/utils.ts"}],[285,{"../../../shared/constants/notifications":5618,"../platforms/extension":571,"@metamask/safe-event-emitter":2482},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var r=a(e("@metamask/safe-event-emitter")),s=a(e("../platforms/extension")),i=e("../../../shared/constants/notifications");function a(e){return e&&e.__esModule?e:{default:e}}const o=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends r.default{constructor(){super(),this.platform=new s.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-i.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:r,screenY:s,outerWidth:a}=window;t=Math.max(s,0),e=Math.max(r+(a-i.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:i.NOTIFICATION_WIDTH,height:i.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find(e=>e&&"popup"===e.type&&e.id===this._popupId):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[286,{"../../../../shared/constants/offscreen-communication":5619,"eth-lattice-keyring":4085},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var r,s=(r=e("eth-lattice-keyring"))&&r.__esModule?r:{default:r},i=e("../../../../shared/constants/offscreen-communication");class a extends s.default{constructor(e={}){super(e)}async _getCreds(){try{const e=this.appName?this.appName:"Unknown",t=`${i.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`;return await new Promise((e,n)=>{chrome.runtime.sendMessage({target:i.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},t=>{t.error&&n(t.error),e(t.result)})})}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=a,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(a,"type",void 0),a.type=s.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[287,{"../../../../shared/constants/offscreen-communication":5619,"@ledgerhq/errors":928},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var r=e("@ledgerhq/errors"),s=e("../../../../shared/constants/offscreen-communication");function i(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var c=new WeakSet;async function l(e,{timeout:t}={}){return new Promise((n,i)=>{let a;t&&(a=setTimeout(()=>{i(new Error("Ledger iframe timeout"))},t)),chrome.runtime.sendMessage({...e,target:s.OffscreenCommunicationTarget.ledgerOffscreen},e=>{if(clearTimeout(a),null!=e&&e.success)n(e.payload||e.success);else{var t;const n=null==e||null===(t=e.payload)||void 0===t?void 0:t.error;if(n&&"number"==typeof n.statusCode&&n.statusCode>0){const e=new r.TransportStatusError(n.statusCode);i(e)}else if(null!=n&&n.message){const e=new Error(n.message,{cause:n});i(e)}else i(new Error("Unknown Ledger error occurred"))}})})}n.LedgerOffscreenBridge=class{constructor(){i(this,c),a(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener(e=>{e.target===s.OffscreenCommunicationTarget.extension&&e.event===s.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)}),Promise.resolve()}destroy(){return Promise.resolve()}getOptions(){return Promise.resolve({})}setOptions(){return Promise.resolve()}attemptMakeApp(){return o(c,this,l).call(this,{action:s.LedgerAction.makeApp},{timeout:4e3})}updateTransportMethod(e){return o(c,this,l).call(this,{action:s.LedgerAction.updateTransport,params:{transportType:e}},{timeout:4e3})}getPublicKey(e){return o(c,this,l).call(this,{action:s.LedgerAction.getPublicKey,params:e})}deviceSignTransaction(e){return o(c,this,l).call(this,{action:s.LedgerAction.signTransaction,params:e})}deviceSignMessage(e){return o(c,this,l).call(this,{action:s.LedgerAction.signPersonalMessage,params:e})}deviceSignTypedData(e){return o(c,this,l).call(this,{action:s.LedgerAction.signTypedData,params:e})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[288,{"../../../../shared/constants/offscreen-communication":5619},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){s(this,"model",void 0),s(this,"minorVersion",void 0)}init(e){return chrome.runtime.onMessage.addListener(e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload.model,this.minorVersion=e.payload.minorVersion)}),new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.init,params:e},()=>{t()})})}dispose(){return new Promise(e=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.dispose},()=>{e()})})}getPublicKey(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.getPublicKey,params:e},e=>{t(e)})})}ethereumSignTransaction(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTransaction,params:e},e=>{t(e)})})}ethereumSignMessage(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signMessage,params:e},e=>{t(e)})})}ethereumSignTypedData(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTypedData,params:e},e=>{t(e)})})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[289,{"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openUpdateTabAndReload=async function(e){try{await s.default.tabs.create({url:"https://metamask.io/updating",active:!0})}catch(e){console.error(e)}await e()};var r,s=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/open-update-tab-and-reload.ts"}],[2891,{"./constants.cjs":2892,"./helpers/Bundler.cjs":2893,"./helpers/PendingUserOperationTracker.cjs":2894,"./helpers/SnapSmartContractAccount.cjs":2895,"./logger.cjs":2897,"./types.cjs":2898,"./utils/gas-fees.cjs":2900,"./utils/gas.cjs":2901,"./utils/transaction.cjs":2902,"./utils/validation.cjs":2903,"@metamask/base-controller":1297,"@metamask/controller-utils":1383,"@metamask/eth-query":1922,"@metamask/rpc-errors":2480,"@metamask/transaction-controller":2868,"@metamask/utils":2914,events:4180,lodash:4635,uuid:5554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,i,a,o,c,l,u,d,p,h,f,m,g,y,b,_,v,w,S,E,T,k,P,O=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},A=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationController=void 0;const j=e("@metamask/base-controller"),R=e("@metamask/controller-utils"),I=A(e("@metamask/eth-query")),C=e("@metamask/rpc-errors"),N=e("@metamask/transaction-controller"),x=e("@metamask/utils"),L=A(e("events")),D=e("lodash"),U=e("uuid"),$=e("./constants.cjs"),G=e("./helpers/Bundler.cjs"),F=e("./helpers/PendingUserOperationTracker.cjs"),H=e("./helpers/SnapSmartContractAccount.cjs"),q=e("./logger.cjs"),B=e("./types.cjs"),V=e("./utils/gas.cjs"),Y=e("./utils/gas-fees.cjs"),W=e("./utils/transaction.cjs"),z=e("./utils/validation.cjs"),K={userOperations:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};class J extends j.BaseController{constructor({entrypoint:e,getGasFeeEstimates:t,messenger:n,state:o}){super({name:"UserOperationController",metadata:K,messenger:n,state:{userOperations:{},...o}}),r.add(this),s.set(this,void 0),i.set(this,void 0),a.set(this,void 0),this.hub=new L.default,O(this,s,e,"f"),O(this,i,t,"f"),O(this,a,new F.PendingUserOperationTracker({getUserOperations:()=>(0,D.cloneDeep)(Object.values(this.state.userOperations)),messenger:n}),"f"),M(this,r,"m",w).call(this)}async addUserOperation(e,t){return(0,z.validateAddUserOperationRequest)(e),(0,z.validateAddUserOperationOptions)(t),await M(this,r,"m",o).call(this,e,t)}async addUserOperationFromTransaction(e,t){(0,z.validateAddUserOperationOptions)(t);const{data:n,from:s,maxFeePerGas:i,maxPriorityFeePerGas:a,to:c,value:l}=e,u={data:""===n?undefined:n,from:s,maxFeePerGas:i,maxPriorityFeePerGas:a,to:c,value:l};return(0,z.validateAddUserOperationRequest)(u),await M(this,r,"m",o).call(this,u,{...t,transaction:e})}startPollingByNetworkClientId(e){return M(this,a,"f").startPolling({networkClientId:e})}}n.UserOperationController=J,s=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakSet,o=async function(e,t){(0,q.projectLogger)("Adding user operation",{request:e,options:t});const{networkClientId:n,origin:s,smartContractAccount:i,swaps:a,transaction:o}=t,{chainId:d,provider:p}=await M(this,r,"m",T).call(this,n),h=await M(this,r,"m",u).call(this,d,s,o,a),f=i??new H.SnapSmartContractAccount(this.messenger),m={chainId:d,metadata:h,options:{...t,smartContractAccount:f},provider:p,request:e,transaction:o},{id:y}=h;let b=!1;const _=(async()=>{try{return await M(this,r,"m",c).call(this,m)}catch(e){if(M(this,r,"m",g).call(this,h,e),b)throw e;return undefined}})(),v=async()=>(b=!0,await _);return{id:y,hash:v,transactionHash:async()=>{await v();const{transactionHash:e}=await M(this,r,"m",l).call(this,h);return e}}},c=async function(e){const{metadata:t,options:n}=e,{requireApproval:s,smartContractAccount:i}=n;let a;try{return await M(this,r,"m",d).call(this,e),await M(this,r,"m",p).call(this,t,i),this.hub.emit("user-operation-added",t),!1!==s&&(a=await M(this,r,"m",h).call(this,e)),await M(this,r,"m",f).call(this,t,i),await M(this,r,"m",m).call(this,t),a?.success(),t.hash}catch(e){throw a?.error(e),e}},l=async function(e){const{id:t,hash:n}=e;return(0,q.projectLogger)("Waiting for confirmation",t,n),new Promise((e,n)=>{this.hub.once(`${t}:confirmed`,t=>{e(t)}),this.hub.once(`${t}:failed`,(e,t)=>{n(t)})})},u=async function(e,t,n,s){const i={actualGasCost:null,actualGasUsed:null,baseFeePerGas:null,bundlerUrl:null,chainId:e,error:null,hash:null,id:(0,U.v1)(),origin:t,status:B.UserOperationStatus.Unapproved,swapsMetadata:s?{approvalTxId:s.approvalTxId??null,destinationTokenAddress:s.destinationTokenAddress??null,destinationTokenAmount:s.destinationTokenAmount??null,destinationTokenDecimals:s.destinationTokenDecimals??null,destinationTokenSymbol:s.destinationTokenSymbol??null,estimatedBaseFee:s.estimatedBaseFee??null,sourceTokenAddress:s.sourceTokenAddress??null,sourceTokenAmount:s.sourceTokenAmount??null,sourceTokenDecimals:s.sourceTokenDecimals??null,sourceTokenSymbol:s.sourceTokenSymbol??null,swapAndSendRecipient:s.swapAndSendRecipient??null,swapMetaData:s.swapMetaData??null,swapTokenValue:s.swapTokenValue??null}:null,time:Date.now(),transactionHash:null,transactionParams:n??null,transactionType:null,userFeeLevel:null,userOperation:M(this,r,"m",y).call(this,n)};return M(this,r,"m",b).call(this,i),(0,q.projectLogger)("Added user operation",i.id),i},d=async function(e){const{chainId:t,metadata:n,options:a,provider:o,request:c,transaction:l}=e,{data:u,from:d,to:p,value:h}=c,{id:f,transactionParams:m,userOperation:g}=n,{smartContractAccount:y}=a;(0,q.projectLogger)("Preparing user operation",{id:f});const _=await M(this,r,"m",E).call(this,l,o,a);n.transactionType=_??null,(0,q.projectLogger)("Determined transaction type",_),await(0,Y.updateGasFees)({getGasFeeEstimates:M(this,i,"f"),metadata:n,originalRequest:c,provider:o,transaction:m??undefined});const v=await y.prepareUserOperation({chainId:t,data:u,from:d,to:p,value:h});(0,z.validatePrepareUserOperationResponse)(v);const{bundler:w,callData:S,dummyPaymasterAndData:T,dummySignature:k,initCode:P,nonce:O,sender:A}=v;g.callData=S,g.initCode=P??$.EMPTY_BYTES,g.nonce=O,g.paymasterAndData=T??$.EMPTY_BYTES,g.sender=A,g.signature=k??$.EMPTY_BYTES,n.bundlerUrl=w,await(0,V.updateGas)(n,v,M(this,s,"f")),M(this,r,"m",b).call(this,n)},p=async function(e,t){const{id:n,userOperation:s,chainId:i}=e;(0,q.projectLogger)("Requesting paymaster data",{id:n});const a=await t.updateUserOperation({userOperation:s,chainId:i});(0,z.validateUpdateUserOperationResponse)(a),s.paymasterAndData=a.paymasterAndData??$.EMPTY_BYTES,a.callGasLimit&&(s.callGasLimit=a.callGasLimit),a.preVerificationGas&&(s.preVerificationGas=a.preVerificationGas),a.verificationGasLimit&&(s.verificationGasLimit=a.verificationGasLimit),M(this,r,"m",b).call(this,e)},h=async function(e){(0,q.projectLogger)("Requesting approval");const{metadata:t}=e,{resultCallbacks:n,value:s}=await M(this,r,"m",S).call(this,t),i=s?.txMeta;return i&&await M(this,r,"m",k).call(this,e,i),t.status=B.UserOperationStatus.Approved,M(this,r,"m",b).call(this,t),n},f=async function(e,t){const{id:n,chainId:s,userOperation:i}=e;(0,q.projectLogger)("Signing user operation",n,i);const a=await t.signUserOperation({userOperation:i,chainId:s});(0,z.validateSignUserOperationResponse)(a);const{signature:o}=a;i.signature=o,(0,q.projectLogger)("Signed user operation",o),e.status=B.UserOperationStatus.Signed,M(this,r,"m",b).call(this,e)},m=async function(e){const{userOperation:t}=e;(0,q.projectLogger)("Submitting user operation",t);const n=new G.Bundler(e.bundlerUrl),i=await n.sendUserOperation(t,M(this,s,"f"));e.hash=i,e.status=B.UserOperationStatus.Submitted,M(this,r,"m",b).call(this,e)},g=function(e,t){const{id:n}=e,s=t;(0,q.projectLogger)("User operation failed",n,t),e.error={name:s.name,message:s.message,stack:s.stack,code:s.code,rpc:s.value},e.status=B.UserOperationStatus.Failed,M(this,r,"m",b).call(this,e),String(s.code)===String(C.errorCodes.provider.userRejectedRequest)&&M(this,r,"m",_).call(this,n)},y=function(e){return{callData:$.EMPTY_BYTES,callGasLimit:$.EMPTY_BYTES,initCode:$.EMPTY_BYTES,maxFeePerGas:e?.maxFeePerGas??$.EMPTY_BYTES,maxPriorityFeePerGas:e?.maxPriorityFeePerGas??$.EMPTY_BYTES,nonce:$.EMPTY_BYTES,paymasterAndData:$.EMPTY_BYTES,preVerificationGas:$.EMPTY_BYTES,sender:$.ADDRESS_ZERO,signature:$.EMPTY_BYTES,verificationGasLimit:$.EMPTY_BYTES}},b=function(e){const{id:t}=e;this.update(n=>{n.userOperations[t]=(0,D.cloneDeep)(e)}),M(this,r,"m",v).call(this,e)},_=function(e){this.update(t=>{delete t.userOperations[e]})},v=function(e){if(!e.transactionParams)return;const t=(0,W.getTransactionMetadata)(e);this.hub.emit("transaction-updated",t)},w=function(){M(this,a,"f").hub.on("user-operation-confirmed",e=>{(0,q.projectLogger)("In listener..."),this.hub.emit("user-operation-confirmed",e),this.hub.emit(`${e.id}:confirmed`,e)}),M(this,a,"f").hub.on("user-operation-failed",(e,t)=>{this.hub.emit("user-operation-failed",e,t),this.hub.emit(`${e.id}:failed`,e,t)}),M(this,a,"f").hub.on("user-operation-updated",e=>{M(this,r,"m",b).call(this,e)})},S=async function(e){const{id:t,origin:n}=e,r=R.ApprovalType.Transaction,s={txId:t};return await this.messenger.call("ApprovalController:addRequest",{id:t,origin:n,type:r,requestData:s,expectsResult:!0},!0)},E=async function(e,t,n){if(!e)return undefined;if(n.type)return n.type;const r=new I.default(t),s=(0,N.determineTransactionType)(e,r);return(await s).type},T=async function(e){const{provider:t,configuration:n}=this.messenger.call("NetworkController:getNetworkClientById",e),{chainId:r}=n;return{provider:t,chainId:r}},k=async function(e,t){(0,q.projectLogger)("Found updated transaction in approval",{updatedTransaction:t});const{metadata:n,request:s}=e,{userOperation:i}=n,a=i.paymasterAndData!==$.EMPTY_BYTES,o=(0,x.add0x)(t.txParams.maxFeePerGas),c=(0,x.add0x)(t.txParams.maxPriorityFeePerGas);let l=!1;const u=i.maxFeePerGas,d=i.maxPriorityFeePerGas,p=u!==o||d!==c,h=a&&o===$.VALUE_ZERO&&c===$.VALUE_ZERO;p&&!h&&((0,q.projectLogger)("Gas fees updated during approval",{previousMaxFeePerGas:u,previousMaxPriorityFeePerGas:d,updatedMaxFeePerGas:o,updatedMaxPriorityFeePerGas:c}),i.maxFeePerGas=o,i.maxPriorityFeePerGas=c,l=a);const f=s.data??$.EMPTY_BYTES,m=t.txParams.data??$.EMPTY_BYTES;f!==m&&((0,q.projectLogger)("Data updated during approval",{previousData:f,updatedData:m}),l=!0);const g=s.value??$.VALUE_ZERO,y=t.txParams.value??$.VALUE_ZERO;if(g!==y&&((0,q.projectLogger)("Value updated during approval",{previousValue:g,updatedValue:y}),l=!0),l){const t={...s,data:m,maxFeePerGas:o,maxPriorityFeePerGas:c,value:y};await M(this,r,"m",P).call(this,{...e,request:t})}},P=async function(e){(0,q.projectLogger)("Regenerating user operation as parameters were updated during approval");const{options:{smartContractAccount:t},metadata:n}=e;await M(this,r,"m",d).call(this,e),await M(this,r,"m",p).call(this,n,t),(0,q.projectLogger)("Regenerated user operation",n.userOperation)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/UserOperationController.cjs"}],[2892,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.VALUE_ZERO=n.ADDRESS_ZERO=n.EMPTY_BYTES=void 0,n.EMPTY_BYTES="0x",n.ADDRESS_ZERO="0x0000000000000000000000000000000000000000",n.VALUE_ZERO="0x0"}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/constants.cjs"}],[2893,{"../logger.cjs":2897},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,i,a=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.Bundler=void 0;const c=e("../logger.cjs"),l=(0,c.createModuleLogger)(c.projectLogger,"bundler");n.Bundler=class{constructor(e){r.add(this),s.set(this,void 0),a(this,s,e,"f")}async estimateUserOperationGas(e,t){l("Estimating gas",{url:o(this,s,"f"),userOperation:e,entrypoint:t});const n=await o(this,r,"m",i).call(this,"eth_estimateUserOperationGas",[e,t]);return l("Estimated gas",{response:n}),n}async getUserOperationReceipt(e){return l("Getting user operation receipt",{url:o(this,s,"f"),hash:e}),await o(this,r,"m",i).call(this,"eth_getUserOperationReceipt",[e])}async sendUserOperation(e,t){l("Sending user operation",{url:o(this,s,"f"),userOperation:e,entrypoint:t});const n=await o(this,r,"m",i).call(this,"eth_sendUserOperation",[e,t]);return l("Sent user operation",n),n}},s=new WeakMap,r=new WeakSet,i=async function(e,t){const n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:e,params:t})},r=await fetch(o(this,s,"f"),n),i=await r.json();if(i.error){const e=new Error(i.error.message||i.error);throw e.code=i.error.code,e}return i.result}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/Bundler.cjs"}],[2894,{"../logger.cjs":2897,"../types.cjs":2898,"./Bundler.cjs":2893,"@metamask/controller-utils":1383,"@metamask/eth-query":1922,"@metamask/polling-controller":2349,"@metamask/utils":2914,events:4180},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,i,a,o,c,l,u,d,p,h,f=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},m=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingUserOperationTracker=void 0;const y=e("@metamask/controller-utils"),b=g(e("@metamask/eth-query")),_=e("@metamask/polling-controller"),v=e("@metamask/utils"),w=g(e("events")),S=e("../logger.cjs"),E=e("../types.cjs"),T=e("./Bundler.cjs"),k=(0,v.createModuleLogger)(S.projectLogger,"pending-user-operations");class P extends((0,_.BlockTrackerPollingControllerOnly)()){constructor({getUserOperations:e,messenger:t}){super(),r.add(this),s.set(this,void 0),i.set(this,void 0),this.hub=new w.default,f(this,s,e,"f"),f(this,i,t,"f")}async _executePoll({networkClientId:e}){try{const{blockTracker:t,configuration:n,provider:s}=this._getNetworkClientById(e);k("Polling",{blockNumber:t.getCurrentBlock(),chainId:n.chainId}),await m(this,r,"m",a).call(this,n.chainId,s)}catch(e){k("Failed to check user operations",e)}}_getNetworkClientById(e){return m(this,i,"f").call("NetworkController:getNetworkClientById",e)}}n.PendingUserOperationTracker=P,s=new WeakMap,i=new WeakMap,r=new WeakSet,a=async function(e,t){const n=m(this,r,"m",u).call(this).filter(t=>t.chainId===e);n.length?(k("Found pending user operations to check",{count:n.length,ids:n.map(e=>e.id)}),await Promise.all(n.map(e=>m(this,r,"m",o).call(this,e,t)))):k("No pending user operations to check")},o=async function(e,t){const{bundlerUrl:n,hash:s,id:i}=e;if(s&&n)try{const a=await m(this,r,"m",p).call(this,s,n),o=a?.success;if(a&&!o)return void m(this,r,"m",l).call(this,e,a);if(o)return void await m(this,r,"m",c).call(this,e,a,t);k("No receipt found for user operation",{id:i,hash:s})}catch(e){k("Failed to check user operation",i,e)}else k("Skipping user operation as missing hash or bundler",i)},c=async function(e,t,n){const{id:s}=e,{actualGasCost:i,actualGasUsed:a,receipt:{blockHash:o,transactionHash:c}}=t;k("User operation confirmed",s,c);const{baseFeePerGas:l}=await(0,y.query)(new b.default(n),"getBlockByHash",[o,!1]);e.actualGasCost=m(this,r,"m",h).call(this,i),e.actualGasUsed=m(this,r,"m",h).call(this,a),e.baseFeePerGas=l,e.status=E.UserOperationStatus.Confirmed,e.transactionHash=c,m(this,r,"m",d).call(this,e),this.hub.emit("user-operation-confirmed",e)},l=function(e,t){const{id:n}=e;k("User operation failed",n),e.status=E.UserOperationStatus.Failed,m(this,r,"m",d).call(this,e),this.hub.emit("user-operation-failed",e,new Error("User operation receipt has failed status"))},u=function(){return m(this,s,"f").call(this).filter(e=>e.status===E.UserOperationStatus.Submitted)},d=function(e){this.hub.emit("user-operation-updated",e)},p=async function(e,t){return new T.Bundler(t).getUserOperationReceipt(e)},h=function(e){return"number"==typeof e?(0,y.toHex)(e):e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/PendingUserOperationTracker.cjs"}],[2895,{"../constants.cjs":2892,"../utils/chain-id.cjs":2899},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapSmartContractAccount=void 0;const a=e("../constants.cjs"),o=e("../utils/chain-id.cjs");n.SnapSmartContractAccount=class{constructor(e){r.set(this,void 0),s(this,r,e,"f")}async prepareUserOperation(e){const{chainId:t,data:n,from:s,to:c,value:l}=e,u=n??a.EMPTY_BYTES,d=c??a.ADDRESS_ZERO,p=l??a.VALUE_ZERO,h=await i(this,r,"f").call("KeyringController:prepareUserOperation",s,[{data:u,to:d,value:p}],{chainId:(0,o.toEip155ChainId)(t)}),{bundlerUrl:f,callData:m,dummyPaymasterAndData:g,dummySignature:y,gasLimits:b,initCode:_,nonce:v}=h;return{bundler:f,callData:m,dummyPaymasterAndData:g,dummySignature:y,gas:b,initCode:_,nonce:v,sender:s}}async updateUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:s}=t,{paymasterAndData:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}=await i(this,r,"f").call("KeyringController:patchUserOperation",s,t,{chainId:(0,o.toEip155ChainId)(n)});return{paymasterAndData:c===a.EMPTY_BYTES?undefined:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}}async signUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:s}=t;return{signature:await i(this,r,"f").call("KeyringController:signUserOperation",s,t,{chainId:(0,o.toEip155ChainId)(n)})}}},r=new WeakMap}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/SnapSmartContractAccount.cjs"}],[2896,{"./UserOperationController.cjs":2891,"./types.cjs":2898},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./UserOperationController.cjs"),n),s(e("./types.cjs"),n)}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/index.cjs"}],[2897,{"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("user-operation-controller")}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/logger.cjs"}],[2898,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationStatus=void 0,function(e){e.Unapproved="unapproved",e.Approved="approved",e.Signed="signed",e.Submitted="submitted",e.Failed="failed",e.Confirmed="confirmed"}(r||(n.UserOperationStatus=r={}))}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/types.cjs"}],[2899,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEip155ChainId=void 0,n.toEip155ChainId=function(e){const t=Number(e);return Number.isInteger(t)?t.toString():e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/chain-id.cjs"}],[29,{"../../lib/util":353,"@metamask/assets-controllers":1233},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRatesControllerInit=void 0;var r=e("@metamask/assets-controllers"),s=e("../../lib/util");n.TokenRatesControllerInit=e=>{const{controllerMessenger:t,initMessenger:n,persistedState:i}=e,a=n.call("PreferencesController:getState"),o=new r.TokenRatesController({messenger:t,state:i.TokenRatesController,tokenPricesService:new r.CodefiTokenPricesServiceV2,disabled:!a.useCurrencyRateCheck});return n.subscribe("PreferencesController:stateChange",(0,s.previousValueComparator)((e,t)=>{const{useCurrencyRateCheck:n}=e,{useCurrencyRateCheck:r}=t;return r&&!n?o.enable():!r&&n&&o.disable(),!0},a)),{controller:o}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/token-rates-controller-init.ts"}],[290,{"../../../shared/lib/promise-with-resolvers":5710,lodash:4635,loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OperationSafener=void 0;var r,s=e("lodash"),i=(r=e("loglevel"))&&r.__esModule?r:{default:r},a=e("../../../shared/lib/promise-with-resolvers");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function l(e,t){return e.get(d(e,t))}function u(e,t,n){return e.set(d(e,t),n),n}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,h=new WeakMap;n.OperationSafener=class{constructor({op:e,wait:t,options:n}){c(this,p,void 0),c(this,h,null),o(this,"evacuate",()=>{if(l(h,this))return i.default.warn("already evacuating"),l(h,this);const e=l(p,this).flush();if(e){const{promise:t,resolve:n}=(0,a.withResolvers)();e.finally(n),u(h,this,t)}else u(h,this,Promise.resolve());return l(h,this)}),o(this,"execute",(...e)=>l(h,this)?(i.default.warn("evacuating, ignoring call to `execute`"),!1):(l(p,this).call(this,...e),!0));const r={mode:"exclusive"};u(p,this,(0,s.debounce)((...t)=>navigator.locks.request("operation-safener-lock",r,()=>e(...t)),t,n))}}}}},{package:"$root$",file:"app/scripts/lib/operation-safener.ts"}],[2900,{"../constants.cjs":2892,"../logger.cjs":2897,"@metamask/controller-utils":1383,"@metamask/eth-query":1922,"@metamask/gas-fee-controller":2010,"@metamask/transaction-controller":2868,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGasFees=void 0;const s=e("@metamask/controller-utils"),i=r(e("@metamask/eth-query")),a=e("@metamask/gas-fee-controller"),o=e("@metamask/transaction-controller"),c=e("@metamask/utils"),l=e("../constants.cjs"),u=e("../logger.cjs"),d=(0,u.createModuleLogger)(u.projectLogger,"gas-fees");function p(e){return(0,s.toHex)((0,s.gweiDecToWEIBN)(e))}function h(e){return!e||e===l.EMPTY_BYTES}n.updateGasFees=async function(e){const{metadata:t,originalRequest:n,transaction:r}=e,{userOperation:l}=t;let u;const f=async()=>(u||(u=await async function(e){const{getGasFeeEstimates:t,provider:n}=e;try{const{gasFeeEstimates:e,gasEstimateType:n}=await t();if(n===a.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:n}={}}=e;if(t&&n){const e={maxFeePerGas:p(n),maxPriorityFeePerGas:p(t)};return d("Using medium values from fee market estimate",e),e}}if(n===a.GAS_ESTIMATE_TYPES.LEGACY){const t=p(e.medium);return d("Using medium value from legacy estimate",t),{maxFeePerGas:t}}if(n===a.GAS_ESTIMATE_TYPES.ETH_GASPRICE){const t=p(e.gasPrice);return d("Using gasPrice from estimate",t),{maxFeePerGas:t}}}catch(e){d("Failed to get estimate",e)}const r=await(0,s.query)(new i.default(n),"gasPrice");if(!r)return{};const o=(0,c.add0x)(r.toString(16));return d("Using gasPrice from network as fallback",o),{maxFeePerGas:o}}(e)),u);l.maxFeePerGas=await async function(e,t,n){const{maxFeePerGas:r,maxPriorityFeePerGas:s}=e,{gasPrice:i}=n??{};if(!h(r))return d("Using maxFeePerGas from request",r),r;if(h(s)&&i)return d("Setting maxFeePerGas to transaction gasPrice",i),i;const{maxFeePerGas:a}=await t();if(!a)throw new Error("Failed to get gas fee estimate for maxFeePerGas");return d("Using maxFeePerGas from estimate",a),a}(n,f,r),l.maxPriorityFeePerGas=await async function(e,t,n,r){const{maxFeePerGas:s,maxPriorityFeePerGas:i}=e,{gasPrice:a}=r??{},{maxFeePerGas:o}=n;if(!h(i))return d("Using maxPriorityFeePerGas from request",i),i;if(h(s)&&a)return d("Setting maxPriorityFeePerGas to transaction gasPrice",a),a;const{maxPriorityFeePerGas:c}=await t();if(c)return d("Using maxPriorityFeePerGas from estimate",c),c;return d("Setting maxPriorityFeePerGas to maxFeePerGas",o),o}(n,f,l,r),t.userFeeLevel=function(e,t,n,r){const{origin:i}=e,{maxFeePerGas:a,maxPriorityFeePerGas:c}=t,{maxFeePerGas:l,maxPriorityFeePerGas:u}=n||{};if(h(a)&&h(c)&&r?.gasPrice)return i===s.ORIGIN_METAMASK?o.UserFeeLevel.CUSTOM:o.UserFeeLevel.DAPP_SUGGESTED;if(h(a)&&h(c)&&l&&u)return o.UserFeeLevel.MEDIUM;if(i===s.ORIGIN_METAMASK)return o.UserFeeLevel.CUSTOM;return o.UserFeeLevel.DAPP_SUGGESTED}(t,n,u,r)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas-fees.cjs"}],[2901,{"../constants.cjs":2892,"../helpers/Bundler.cjs":2893,"../logger.cjs":2897,"@metamask/controller-utils":1383,"@metamask/utils":2914,"bn.js":3819},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGas=void 0;const s=e("@metamask/controller-utils"),i=e("@metamask/utils"),a=r(e("bn.js")),o=e("../constants.cjs"),c=e("../helpers/Bundler.cjs"),l=e("../logger.cjs"),u=(0,l.createModuleLogger)(l.projectLogger,"gas");function d(e){const t=("string"==typeof e?(0,s.hexToBN)(e):new a.default(e)).muln(1.5);return(0,i.add0x)(t.toString(16))}n.updateGas=async function(e,t,n){const{userOperation:r}=e;if(t.gas)return r.callGasLimit=t.gas.callGasLimit,r.preVerificationGas=t.gas.preVerificationGas,r.verificationGasLimit=t.gas.verificationGasLimit,void u("Using gas values from smart contract account",{callGasLimit:r.callGasLimit,preVerificationGas:r.preVerificationGas,verificationGasLimit:r.verificationGasLimit});const s={...r,maxFeePerGas:o.VALUE_ZERO,maxPriorityFeePerGas:o.VALUE_ZERO,callGasLimit:o.VALUE_ZERO,preVerificationGas:o.VALUE_ZERO,verificationGasLimit:"0xF4240"},i=new c.Bundler(e.bundlerUrl),a=await i.estimateUserOperationGas(s,n);r.callGasLimit=d(a.callGasLimit),r.preVerificationGas=d(a.preVerificationGas),r.verificationGasLimit=d(a.verificationGasLimit??a.verificationGas),u("Using buffered gas values from bundler estimate",{callGasLimit:r.callGasLimit,preVerificationGas:r.preVerificationGas,verificationGasLimit:r.verificationGasLimit,multiplier:1.5,estimate:a})}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas.cjs"}],[2902,{"../constants.cjs":2892,"../types.cjs":2898,"@metamask/transaction-controller":2868,"@metamask/utils":2914,"bn.js":3819},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionMetadata=void 0;const s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),a=r(e("bn.js")),o=e("../constants.cjs"),c=e("../types.cjs");n.getTransactionMetadata=function(e){const{actualGasCost:t,actualGasUsed:n,baseFeePerGas:r,chainId:l,error:u,origin:d,transactionHash:p,id:h,swapsMetadata:f,time:m,transactionParams:g,transactionType:y,userFeeLevel:b,userOperation:_}=e;if(!g)return undefined;const v=t&&n?(0,i.add0x)(new a.default((0,i.remove0x)(t),16).div(new a.default((0,i.remove0x)(n),16)).toString(16)):undefined,w=u?{name:u.name,message:u.message,stack:u.stack,code:u.code,rpc:u.rpc}:undefined,S={[c.UserOperationStatus.Unapproved]:s.TransactionStatus.unapproved,[c.UserOperationStatus.Approved]:s.TransactionStatus.approved,[c.UserOperationStatus.Signed]:s.TransactionStatus.signed,[c.UserOperationStatus.Submitted]:s.TransactionStatus.submitted,[c.UserOperationStatus.Confirmed]:s.TransactionStatus.confirmed,[c.UserOperationStatus.Failed]:s.TransactionStatus.failed}[e.status],E=function(...e){const t=new a.default(0);for(const n of e)n&&t.iadd(new a.default((0,i.remove0x)(n),16));return(0,i.add0x)(t.toString(16))}(_.preVerificationGas,_.verificationGasLimit,_.callGasLimit),T=_.paymasterAndData!==o.EMPTY_BYTES,k=T?o.VALUE_ZERO:_.maxFeePerGas,P=T?o.VALUE_ZERO:_.maxPriorityFeePerGas,O=_.nonce===o.EMPTY_BYTES?undefined:_.nonce,M={...g,from:_.sender,gas:E,nonce:O,maxFeePerGas:k,maxPriorityFeePerGas:P};delete M.gasPrice;const A={approvalTxId:f?.approvalTxId??undefined,destinationTokenAddress:f?.destinationTokenAddress??undefined,destinationTokenAmount:f?.destinationTokenAmount??undefined,destinationTokenDecimals:f?.destinationTokenDecimals??undefined,destinationTokenSymbol:f?.destinationTokenSymbol??undefined,estimatedBaseFee:f?.estimatedBaseFee??undefined,sourceTokenAddress:f?.sourceTokenAddress??undefined,sourceTokenAmount:f?.sourceTokenAmount??undefined,sourceTokenDecimals:f?.sourceTokenDecimals??undefined,sourceTokenSymbol:f?.sourceTokenSymbol??undefined,swapAndSendRecipient:f?.swapAndSendRecipient??undefined,swapMetaData:f?.swapMetaData??undefined,swapTokenValue:f?.swapTokenValue??undefined},j=T?s.UserFeeLevel.CUSTOM:b;return{baseFeePerGas:r??undefined,chainId:l,error:w,hash:p??undefined,id:h,isUserOperation:!0,networkClientId:"user-operation",origin:d,status:S,time:m,txParams:M,txReceipt:{effectiveGasPrice:v??undefined,gasUsed:n??undefined},type:y??undefined,userFeeLevel:j,...A}}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/transaction.cjs"}],[2903,{"../constants.cjs":2892,"@metamask/superstruct":2810,"@metamask/transaction-controller":2868,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSignUserOperationResponse=n.validateUpdateUserOperationResponse=n.validatePrepareUserOperationResponse=n.validateAddUserOperationOptions=n.validateAddUserOperationRequest=void 0;const r=e("@metamask/superstruct"),s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),a=e("../constants.cjs");function o(e,t,n){try{(0,r.assert)(e,t,n)}catch(e){const t=e.failures().map(e=>e.path.length?`${e.path.join(".")} - ${e.message}`:e.message).join("\n");throw new Error(`${n}\n${t}`)}}function c(){return(0,r.define)("Hexadecimal String",e=>(0,i.isStrictHexString)(e))}function l(){return(0,r.define)("Hexadecimal String or 0x",e=>(0,i.isStrictHexString)(e)||e===a.EMPTY_BYTES)}n.validateAddUserOperationRequest=function(e){const t=c(),n=l();o(e,(0,r.object)({data:(0,r.optional)(n),from:t,maxFeePerGas:(0,r.optional)(t),maxPriorityFeePerGas:(0,r.optional)(t),to:(0,r.optional)(t),value:(0,r.optional)(t)}),"Invalid request to add user operation")},n.validateAddUserOperationOptions=function(e){o(e,(0,r.object)({networkClientId:(0,r.string)(),origin:(0,r.string)(),requireApproval:(0,r.optional)((0,r.boolean)()),smartContractAccount:(0,r.optional)((0,r.object)({prepareUserOperation:(0,r.func)(),updateUserOperation:(0,r.func)(),signUserOperation:(0,r.func)()})),swaps:(0,r.optional)((0,r.object)({approvalTxId:(0,r.optional)((0,r.string)()),destinationTokenAddress:(0,r.optional)((0,r.string)()),destinationTokenDecimals:(0,r.optional)((0,r.number)()),destinationTokenSymbol:(0,r.optional)((0,r.string)()),estimatedBaseFee:(0,r.optional)((0,r.string)()),sourceTokenSymbol:(0,r.optional)((0,r.string)()),swapMetaData:(0,r.optional)((0,r.object)()),swapTokenValue:(0,r.optional)((0,r.string)()),destinationTokenAmount:(0,r.optional)((0,r.string)()),sourceTokenAddress:(0,r.optional)((0,r.string)()),sourceTokenAmount:(0,r.optional)((0,r.string)()),sourceTokenDecimals:(0,r.optional)((0,r.number)()),swapAndSendRecipient:(0,r.optional)((0,r.string)())})),type:(0,r.optional)((0,r.enums)(Object.values(s.TransactionType)))}),"Invalid options to add user operation")},n.validatePrepareUserOperationResponse=function(e){const t=c(),n=l();o(e,(0,r.refine)((0,r.object)({bundler:(0,r.string)(),callData:t,dummyPaymasterAndData:(0,r.optional)(n),dummySignature:(0,r.optional)(n),gas:(0,r.optional)((0,r.object)({callGasLimit:t,preVerificationGas:t,verificationGasLimit:t})),initCode:(0,r.optional)(n),nonce:t,sender:t}),"ValidPrepareUserOperationResponse",({gas:e,dummySignature:t})=>!!(e||t&&t!==a.EMPTY_BYTES)||"Must specify dummySignature if not specifying gas"),"Invalid response when preparing user operation")},n.validateUpdateUserOperationResponse=function(e){o(e,(0,r.optional)((0,r.object)({paymasterAndData:(0,r.optional)(l()),callGasLimit:(0,r.optional)(l()),preVerificationGas:(0,r.optional)(l()),verificationGasLimit:(0,r.optional)(l())})),"Invalid response when updating user operation")},n.validateSignUserOperationResponse=function(e){const t=c();o(e,(0,r.object)({signature:t}),"Invalid response when signing user operation")}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/validation.cjs"}],[291,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const i=async(e,t,n)=>{const r=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var a=new WeakSet;function o(e){return new Promise((t,n)=>{const r=indexedDB.open(this.storeName,this.dbVersion);r.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},r.onsuccess=n=>{const r=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(r)}})}n.IndexedDBPPOMStorage=class{constructor(e,t){r(this,a),s(this,"storeName",void 0),s(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise((r,s)=>{(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")})(a,this,o).call(this,n).then(n=>{const i=n[e](t);i.onsuccess=async e=>{r(e)},i.onerror=t=>{var n;s(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}}).catch(e=>{s(e)})})}async read(e,t){var n;const r=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await i(e,r,t),r}async write(e,t,n){await i(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map(([e,t])=>({name:e,chainId:t}))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[292,{"../../../../shared/constants/app":5598,"../../../../shared/constants/security-provider":5626,"../../../../shared/constants/transaction":5637,"../../../../shared/lib/trace":5718,"./ppom-util":293,"@metamask/controller-utils":1383},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,u,d,p,h){return async(f,m,g)=>{try{const{securityAlertsEnabled:m}=t.state,{chainId:g}=n.getNetworkConfigurationByNetworkClientId(f.networkClientId)??{};if(!g)throw Error("ChainID not found for networkClientId");if(!m||!l.includes(f.method))return;const y=f.params[0];if("string"==typeof y){const{isSIWEMessage:e}=(0,r.detectSIWE)({data:y});if(e)return}else if(f.method===s.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=y??{},t=d.listAccounts();if(t.some(({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase())))return}const b=(0,c.generateSecurityAlertId)();(0,a.trace)({name:a.TraceName.PPOMValidation,parentContext:f.traceContext},()=>(0,c.validateRequestWithPPOM)({ppomController:e,request:f,securityAlertId:b,chainId:g,updateSecurityAlertResponse:p,getSecurityAlertsConfig:h}));const _={...o.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:b};i.SIGNING_METHODS.includes(f.method)&&u.addSignatureSecurityAlertResponse(_),f.securityAlertResponse=_}catch(e){f.securityAlertResponse=(0,c.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{g()}}};var r=e("@metamask/controller-utils"),s=e("../../../../shared/constants/app"),i=e("../../../../shared/constants/transaction"),a=e("../../../../shared/lib/trace"),o=e("../../../../shared/constants/security-provider"),c=e("./ppom-util");const l=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...i.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[2927,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var s=e.charAt(r),i=s.charCodeAt(0);if(255!==t[i])throw new TypeError(s+" is ambiguous");t[i]=r}var a=e.length,o=e.charAt(0),c=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var n=0;if(" "!==e[n]){for(var r=0,s=0;e[n]===o;)r++,n++;for(var i=(e.length-n)*c+1>>>0,l=new Uint8Array(i);e[n];){var u=t[e.charCodeAt(n)];if(255===u)return;for(var d=0,p=i-1;(0!==u||d<s)&&-1!==p;p--,d++)u+=a*l[p]>>>0,l[p]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=d,n++}if(" "!==e[n]){for(var h=i-s;h!==i&&0===l[h];)h++;for(var f=new Uint8Array(r+(i-h)),m=r;h!==i;)f[m++]=l[h++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,s=0,i=t.length;s!==i&&0===t[s];)s++,n++;for(var c=(i-s)*l+1>>>0,u=new Uint8Array(c);s!==i;){for(var d=t[s],p=0,h=c-1;(0!==d||p<r)&&-1!==h;h--,p++)d+=256*u[h]>>>0,u[h]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");r=p,s++}for(var f=c-r;f!==c&&0===u[f];)f++;for(var m=o.repeat(n);f<c;++f)m+=e.charAt(u[f]);return m},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}}}},{package:"@ensdomains/content-hash>cids>multibase>@multiformats/base-x",file:"node_modules/@multiformats/base-x/src/index.js"}],[293,{"../../../../shared/constants/app":5598,"../../../../shared/constants/security-provider":5626,"../../../../shared/constants/transaction":5637,"../../../../shared/lib/snaps/snaps":5713,"../../../../shared/modules/transaction.utils":5763,"../../../../shared/modules/typed-signature":5764,"./security-alerts-api":295,"@metamask/snaps-utils":2781,"@metamask/transaction-controller":2868,"@metamask/utils":2914,lodash:4635,uuid:5554},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,i.v4)()},n.handlePPOMError=b,n.normalizeSignatureRequest=_,n.updateSecurityAlertResponse=async function({appStateController:e,messenger:t,method:n,securityAlertId:r,securityAlertResponse:s,signatureController:i,transactionController:a}){if(u.SIGNING_METHODS.includes(n)){const n=await async function(e,t,n){const r=e=>Object.values(e.signatureRequests).find(e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t});return new Promise(s=>{const i=r(e.state);if(i)return void s(i);const a=e=>{const t=r(e);t&&(m("Found signature request",t),n.unsubscribe("SignatureController:stateChange",a),s(t))};m("Waiting for signature request",t),n.subscribe("SignatureController:stateChange",a)})}(i,r,t);return e.addSignatureSecurityAlertResponse({...s,securityAlertId:r}),n}const o=await async function(e,t,n){const r=e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t};return new Promise(s=>{const i=e.state.transactions.find(r);if(i)return void s(i);const a=e=>{r(e)&&(m("Found transaction metadata",e),n.unsubscribe("TransactionController:unapprovedTransactionAdded",a),s(e))};m("Waiting for transaction metadata",t),n.subscribe("TransactionController:unapprovedTransactionAdded",a)})}(a,r,t);return a.updateSecurityAlertResponse(o.id,{...s,securityAlertId:r}),o},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:s,updateSecurityAlertResponse:i,getSecurityAlertsConfig:o}){try{const l=function(e,t){let n=(0,a.cloneDeep)(e);n=_(n,t),n=function(e,t){if(e.method!==h.MESSAGE_TYPE.ETH_SEND_TRANSACTION)return e;if(!Array.isArray(e.params)||!e.params[0])return e;const n=e.params[0];n.gas=t.txParams.gas,n.gasPrice=t.txParams.maxFeePerGas??t.txParams.gasPrice,delete n.gasLimit,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.type;const s=(0,r.normalizeTransactionParams)(n);return m("Normalized transaction params",s),{...e,params:[s]}}(n,t);const{delegationMock:s,id:i,jsonrpc:o,method:c,origin:l,params:u}=n;return{delegationMock:s,id:i,jsonrpc:o,method:c,origin:l,params:u}}(t,await i(t.method,n,c.LOADING_SECURITY_ALERT_RESPONSE));m("Normalized request",l);const u=(0,f.isSecurityAlertsAPIEnabled)()?await async function(e,t,n,r){try{return{...await(0,f.validateWithSecurityAlertsAPI)(t,n,r),source:c.SecurityAlertSource.API}}catch(r){return b(r,"Error validating request with security alerts API"),await v(e,n,t)}}(e,s,l,o):await v(e,l,s);await i(t.method,n,u)}catch(e){m("Error",e),await i(t.method,n,b(e,"Error validating JSON RPC using PPOM: "))}};var r=e("@metamask/transaction-controller"),s=e("@metamask/utils"),i=e("uuid"),a=e("lodash"),o=e("@metamask/snaps-utils"),c=e("../../../../shared/constants/security-provider"),l=e("../../../../shared/lib/snaps/snaps"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/modules/typed-signature"),p=e("../../../../shared/modules/transaction.utils"),h=e("../../../../shared/constants/app"),f=e("./security-alerts-api");const m=(0,s.createProjectLogger)("ppom-util"),{sentry:g}=global,y={result_type:c.BlockaidResultType.Errored,reason:c.BlockaidReason.errored};function b(e,t,n=c.SecurityAlertSource.API){const r=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),s=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return n===c.SecurityAlertSource.Local&&(null==g||g.captureException(e)),console.error(t,r),{...y,description:s,source:n}}function _(e,t){var n;if(e.method!==h.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3&&e.method!==h.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4)return e;if(!Array.isArray(e.params)||!e.params[1])return e;const r=(0,p.parseTypedDataMessage)(e.params[1]),s=(0,d.sanitizeMessageRecursively)(r.message,r.types,r.primaryType);let i=e.origin;if(t&&"decodedPermission"in t&&null!==(n=t.decodedPermission)&&void 0!==n&&n.origin){const n=(0,o.isSnapId)(e.origin),r=n&&(0,l.isSnapPreinstalled)(e.origin);n&&r&&(i=t.decodedPermission.origin)}return{...e,origin:i,params:[e.params[0],JSON.stringify({...r,message:s})]}}async function v(e,t,n){try{return{...await e.usePPOM(e=>e.validateJsonRpc(t),n),source:c.SecurityAlertSource.Local}}catch(e){return b(e,"Error validating request with PPOM controller",c.SecurityAlertSource.Local)}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[294,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(r!==undefined)return r;const t=P();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return O(n,e)},n.main=function(){r.main()};const s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&s.decode();let i=null;function a(){return null!==i&&0!==i.byteLength||(i=new Uint8Array(r.memory.buffer)),i}function o(e,t){return e>>>=0,s.decode(a().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let l=c.length;function u(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}function d(e){return c[e]}function p(e){const t=d(e);return function(e){e<132||(c[e]=l,l=e)}(e),t}let h=0;const f="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},m="function"==typeof f.encodeInto?function(e,t){return f.encodeInto(e,t)}:function(e,t){const n=f.encode(e);return t.set(n),{read:e.length,written:n.length}};function g(e,t,n){if(n===undefined){const n=f.encode(e),r=t(n.length,1)>>>0;return a().subarray(r,r+n.length).set(n),h=n.length,r}let r=e.length,s=t(r,1)>>>0;const i=a();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;i[s+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),s=n(s,r,r=o+3*e.length,1)>>>0;const t=a().subarray(s+o,s+r);o+=m(e,t).written}return h=o,s}let y=null;function b(){return null!==y&&0!==y.byteLength||(y=new Int32Array(r.memory.buffer)),y}function _(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=_(e[0]));for(let r=1;r<t;r++)n+=", "+_(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}function v(e,t,n){r.wasm_bindgen__convert__closures__invoke1_mut(e,t,u(n))}function w(e,t){r._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let S=null;function E(e,t){const n=t(4*e.length,4)>>>0,s=(null!==S&&0!==S.byteLength||(S=new Uint32Array(r.memory.buffer)),S);for(let t=0;t<e.length;t++)s[n/4+t]=u(e[t]);return h=e.length,n}function T(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(u(e))}}class k{static __wrap(e){e>>>=0;const t=Object.create(k.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_ppom_free(e)}static new(e,t){const n=E(t,r.__wbindgen_malloc),s=h;return p(r.ppom_new(u(e),n,s))}validateJsonRpc(e){return p(r.ppom_validateJsonRpc(this.__wbg_ptr,u(e)))}static version(){return p(r.ppom_version())}}function P(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return u(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return T(function(e,t,n){return u(d(e).call(d(t),d(n)))},arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return T(function(e,t,n,r){return u(d(e).call(d(t),d(n),d(r)))},arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return u(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return u(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const s=new Promise((e,t)=>{const s=n.a;n.a=0;try{return function(e,t,n,s){r.wasm_bindgen__convert__closures__invoke2_mut(e,t,u(n),u(s))}(s,n.b,e,t)}finally{n.a=s}});return u(s)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return u(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return T(function(e,t){return u(JSON.parse(o(e,t)))},arguments)},e.wbg.__wbg_ppom_new=function(e){return u(k.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return u(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return T(function(e){return u(JSON.stringify(d(e)))},arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return u(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return u(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=p(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const r=function(e,t,n,r){const s={a:e,b:t,cnt:1},i=(...e)=>{s.cnt++;const t=s.a;s.a=0;try{return r(t,s.b,...e)}finally{0===--s.cnt?n(t,s.b):s.a=t}};return i.original=s,i}(e,t,w,v);return u(r)},e.wbg.__wbindgen_debug_string=function(e,t){const n=g(_(d(t)),r.__wbindgen_malloc,r.__wbindgen_realloc),s=h;b()[e/4+1]=s,b()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return u(new Error(o(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return u(r.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){p(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),s="string"==typeof n?n:undefined;var i,a=(i=s)===undefined||null===i?0:g(s,r.__wbindgen_malloc,r.__wbindgen_realloc),o=h;b()[e/4+1]=o,b()[e/4+0]=a},e.wbg.__wbindgen_string_new=function(e,t){return u(o(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e}function O(e,t){return r=e.exports,M.__wbindgen_wasm_module=t,y=null,S=null,i=null,r.__wbindgen_start(),r}async function M(e){if(r!==undefined)return r;const t=P();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:s}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return O(n,s)}n.PPOM=k;n.default=M}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[296,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.qrKeyringBuilderFactory=function(e,t,n){const r=()=>new e({bridge:new t(n)});return r.type=e.type,r}}}},{package:"$root$",file:"app/scripts/lib/qr-keyring-builder-factory.ts"}],[297,{"./handlers":303,"./handlers/wallet-getPermissions":308,"./handlers/wallet-requestPermissions":309,"./handlers/wallet-revokePermissions":310,"@metamask/rpc-errors":2480,"@metamask/snaps-rpc-methods":2611,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMultichainMethodMiddleware=n.createEthAccountsMethodMiddleware=n.createEip1193MethodMiddleware=void 0,n.makeMethodMiddlewareMaker=u;var r=e("@metamask/rpc-errors"),s=e("@metamask/snaps-rpc-methods"),i=e("@metamask/utils"),a=e("./handlers"),o=e("./handlers/wallet-getPermissions"),c=e("./handlers/wallet-requestPermissions"),l=e("./handlers/wallet-revokePermissions");n.createEip1193MethodMiddleware=u([...a.handlers,...a.eip1193OnlyHandlers,o.getPermissionsHandler,c.requestPermissionsHandler,l.revokePermissionsHandler]),n.createEthAccountsMethodMiddleware=u([a.ethAccountsHandler]),n.createMultichainMethodMiddleware=u(a.handlers);function u(e){const t=e.reduce((e,t)=>{for(const n of t.methodNames)e[n]=t;return e},{}),n=new Set(e.flatMap(({hookNames:e})=>Object.getOwnPropertyNames(e)));return e=>{!function(e,t){const n=[];if(t.forEach(t=>{(0,i.hasProperty)(e,t)||n.push(t)}),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const r=Object.getOwnPropertyNames(e).filter(e=>!t.has(e));if(r.length>0)throw new Error(`Received unexpected hooks:\n\n${r.join("\n")}\n`)}(e,n);return async(n,i,a,o)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:l}=c;try{return await t(n,i,a,o,(0,s.selectHooks)(e,l))}catch(e){return o(e instanceof Error?e:r.rpcErrors.internal({data:e}))}}return a()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[2971,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openrpcDocument=void 0,n.openrpcDocument={$schema:"https://meta.json-schema.tools/",$id:"https://meta.open-rpc.org/",title:"openrpcDocument",type:"object",required:["info","methods","openrpc"],additionalProperties:!1,patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}},properties:{openrpc:{title:"openrpc",type:"string",enum:["1.3.2","1.3.1","1.3.0","1.2.6","1.2.5","1.2.4","1.2.3","1.2.2","1.2.1","1.2.0","1.1.12","1.1.11","1.1.10","1.1.9","1.1.8","1.1.7","1.1.6","1.1.5","1.1.4","1.1.3","1.1.2","1.1.1","1.1.0","1.0.0","1.0.0-rc1","1.0.0-rc0"]},info:{$ref:"#/definitions/infoObject"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},methods:{title:"methods",type:"array",additionalItems:!1,items:{title:"methodOrReference",oneOf:[{$ref:"#/definitions/methodObject"},{$ref:"#/definitions/referenceObject"}]}},components:{title:"components",type:"object",properties:{schemas:{title:"schemaComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/JSONSchema"}}},links:{title:"linkComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/linkObject"}}},errors:{title:"errorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/errorObject"}}},examples:{title:"exampleComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/exampleObject"}}},examplePairings:{title:"examplePairingComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/examplePairingObject"}}},contentDescriptors:{title:"contentDescriptorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/contentDescriptorObject"}}},tags:{title:"tagComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/tagObject"}}}}},$schema:{title:"metaSchema",description:"JSON Schema URI (used by some editors)",type:"string",default:"https://meta.open-rpc.org/"}},definitions:{specificationExtension:{title:"specificationExtension"},JSONSchema:{$ref:"https://meta.json-schema.tools"},referenceObject:{title:"referenceObject",type:"object",additionalProperties:!1,required:["$ref"],properties:{$ref:{$ref:"https://meta.json-schema.tools/#/definitions/JSONSchemaObject/properties/$ref"}}},errorObject:{title:"errorObject",type:"object",description:"Defines an application level error.",additionalProperties:!1,required:["code","message"],properties:{code:{title:"errorObjectCode",description:"A Number that indicates the error type that occurred. This MUST be an integer. The error codes from and including -32768 to -32000 are reserved for pre-defined errors. These pre-defined errors SHOULD be assumed to be returned from any JSON-RPC api.",type:"integer"},message:{title:"errorObjectMessage",description:"A String providing a short description of the error. The message SHOULD be limited to a concise single sentence.",type:"string"},data:{title:"errorObjectData",description:"A Primitive or Structured value that contains additional information about the error. This may be omitted. The value of this member is defined by the Server (e.g. detailed error information, nested errors etc.)."}}},licenseObject:{title:"licenseObject",type:"object",additionalProperties:!1,properties:{name:{title:"licenseObjectName",type:"string"},url:{title:"licenseObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},contactObject:{title:"contactObject",type:"object",additionalProperties:!1,properties:{name:{title:"contactObjectName",type:"string"},email:{title:"contactObjectEmail",type:"string"},url:{title:"contactObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},infoObject:{title:"infoObject",type:"object",additionalProperties:!1,required:["title","version"],properties:{title:{title:"infoObjectProperties",type:"string"},description:{title:"infoObjectDescription",type:"string"},termsOfService:{title:"infoObjectTermsOfService",type:"string",format:"uri"},version:{title:"infoObjectVersion",type:"string"},contact:{$ref:"#/definitions/contactObject"},license:{$ref:"#/definitions/licenseObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},serverObject:{title:"serverObject",type:"object",required:["url"],additionalProperties:!1,properties:{url:{title:"serverObjectUrl",type:"string",format:"uri"},name:{title:"serverObjectName",type:"string"},description:{title:"serverObjectDescription",type:"string"},summary:{title:"serverObjectSummary",type:"string"},variables:{title:"serverObjectVariables",type:"object",patternProperties:{"[0-z]+":{title:"serverObjectVariable",type:"object",required:["default"],properties:{default:{title:"serverObjectVariableDefault",type:"string"},description:{title:"serverObjectVariableDescription",type:"string"},enum:{title:"serverObjectVariableEnum",type:"array",items:{title:"serverObjectVariableEnumItem",type:"string"}}}}}}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},linkObject:{title:"linkObject",type:"object",additionalProperties:!1,properties:{name:{title:"linkObjectName",type:"string",minLength:1},summary:{title:"linkObjectSummary",type:"string"},method:{title:"linkObjectMethod",type:"string"},description:{title:"linkObjectDescription",type:"string"},params:{title:"linkObjectParams"},server:{title:"linkObjectServer",$ref:"#/definitions/serverObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},externalDocumentationObject:{title:"externalDocumentationObject",type:"object",additionalProperties:!1,description:"information about external documentation",required:["url"],properties:{description:{title:"externalDocumentationObjectDescription",type:"string"},url:{title:"externalDocumentationObjectUrl",type:"string",format:"uri"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},methodObject:{title:"methodObject",type:"object",required:["name","params"],additionalProperties:!1,properties:{name:{title:"methodObjectName",description:"The cannonical name for the method. The name MUST be unique within the methods array.",type:"string",minLength:1},description:{title:"methodObjectDescription",description:"A verbose explanation of the method behavior. GitHub Flavored Markdown syntax MAY be used for rich text representation.",type:"string"},summary:{title:"methodObjectSummary",description:"A short summary of what the method does.",type:"string"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},tags:{title:"methodObjectTags",type:"array",items:{title:"tagOrReference",oneOf:[{$ref:"#/definitions/tagObject"},{$ref:"#/definitions/referenceObject"}]}},paramStructure:{title:"methodObjectParamStructure",type:"string",description:"Format the server expects the params. Defaults to 'either'.",enum:["by-position","by-name","either"],default:"either"},params:{title:"methodObjectParams",type:"array",items:{title:"contentDescriptorOrReference",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"methodObjectResult",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]},errors:{title:"methodObjectErrors",description:"Defines an application level error.",type:"array",items:{title:"errorOrReference",oneOf:[{$ref:"#/definitions/errorObject"},{$ref:"#/definitions/referenceObject"}]}},links:{title:"methodObjectLinks",type:"array",items:{title:"linkOrReference",oneOf:[{$ref:"#/definitions/linkObject"},{$ref:"#/definitions/referenceObject"}]}},examples:{title:"methodObjectExamples",type:"array",items:{title:"examplePairingOrReference",oneOf:[{$ref:"#/definitions/examplePairingObject"},{$ref:"#/definitions/referenceObject"}]}},deprecated:{title:"methodObjectDeprecated",type:"boolean",default:!1},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},tagObject:{title:"tagObject",type:"object",additionalProperties:!1,required:["name"],properties:{name:{title:"tagObjectName",type:"string",minLength:1},description:{title:"tagObjectDescription",type:"string"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},exampleObject:{title:"exampleObject",type:"object",required:["name","value"],properties:{summary:{title:"exampleObjectSummary",type:"string"},value:{title:"exampleObjectValue"},description:{title:"exampleObjectDescription",type:"string"},name:{title:"exampleObjectName",type:"string",minLength:1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},examplePairingObject:{title:"examplePairingObject",type:"object",required:["name","params"],properties:{name:{title:"examplePairingObjectName",type:"string",minLength:1},description:{title:"examplePairingObjectDescription",type:"string"},params:{title:"examplePairingObjectParams",type:"array",items:{title:"exampleOrReference",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"examplePairingObjectResult",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}}},contentDescriptorObject:{title:"contentDescriptorObject",type:"object",additionalProperties:!1,required:["name","schema"],properties:{name:{title:"contentDescriptorObjectName",type:"string",minLength:1},description:{title:"contentDescriptorObjectDescription",type:"string"},summary:{title:"contentDescriptorObjectSummary",type:"string"},schema:{$ref:"#/definitions/JSONSchema"},required:{title:"contentDescriptorObjectRequired",type:"boolean",default:!1},deprecated:{title:"contentDescriptorObjectDeprecated",type:"boolean",default:!1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}}}},n.default=n.openrpcDocument}}},{package:"@open-rpc/meta-schema",file:"node_modules/@open-rpc/meta-schema/index.js"}],[2972,{"@json-schema-tools/dereferencer":820,"@json-schema-tools/reference-resolver":824,"fast-safe-stringify":4195},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},r.apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentDereferencingError=void 0;var o=a(e("@json-schema-tools/dereferencer")),c=a(e("@json-schema-tools/reference-resolver")),l=a(e("fast-safe-stringify")),u=function(e){this.name="OpenRPCDocumentDereferencingError",this.message="The json schema provided cannot be dereferenced. Received Error: \n ".concat(e)};n.OpenRPCDocumentDereferencingError=u;var d=function(e,t,n){return s(void 0,void 0,void 0,function(){var r,s;return i(this,function(i){switch(i.label){case 0:if((r=e.$ref)===undefined)return[2,e];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.resolve(r,t)];case 2:return[2,i.sent()];case 3:throw s=i.sent(),new u(["unable to eval pointer against OpenRPC Document.","error type: ".concat(s.name),"instance: ".concat(s.instance),"token: ".concat(s.token),"pointer: ".concat(r),"reference object: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},p=function(e,t,n){return s(void 0,void 0,void 0,function(){var r,s,a,o,c,l;return i(this,function(i){switch(i.label){case 0:r=[],s=0,a=e,i.label=1;case 1:return s<a.length?(o=a[s],l=(c=r).push,[4,d(o,t,n)]):[3,4];case 2:l.apply(c,[i.sent()]),i.label=3;case 3:return s++,[3,1];case 4:return[2,r]}})})},h=function(e,t){return s(void 0,void 0,void 0,function(){var n,r,s;return i(this,function(i){switch(i.label){case 0:if(!0===e||!1===e)return[2,Promise.resolve(e)];t!==undefined&&(e.components={schemas:t}),n=new o.default(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.resolve()];case 2:return!0!==(r=i.sent())&&!1!==r&&(delete r.components,delete e.components),[2,r];case 3:throw s=i.sent(),new u(["Unable to parse reference inside of JSONSchema",e.title?"Schema Title: ".concat(e.title):"","error message: ".concat(s.message),"schema in question: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},f=function(e){return s(void 0,void 0,void 0,function(){var t,n,r,s,a,o,c;return i(this,function(i){switch(i.label){case 0:if(e.components===undefined)return[2,Promise.resolve(e)];if(e.components.contentDescriptors===undefined)return[2,Promise.resolve(e)];t=e.components.contentDescriptors,n=Object.keys(t),r={},e.components.schemas&&(r=e.components.schemas),s=0,a=n,i.label=1;case 1:return s<a.length?(o=a[s],c=t[o],[4,h(t[o].schema,r)]):[3,4];case 2:c.schema=i.sent(),i.label=3;case 3:return s++,[3,1];case 4:return[2,e]}})})},m=function(e,t,n){return s(void 0,void 0,void 0,function(){var r,s,a,o,c,l,u,f,m,g,y,b,_,v,w,S,E,T,k,P;return i(this,function(i){switch(i.label){case 0:return r=e,e.$ref===undefined?[3,2]:[4,d({$ref:e.$ref},t,n)];case 1:r=i.sent(),i.label=2;case 2:return r.tags===undefined?[3,4]:(s=r,[4,p(r.tags,t,n)]);case 3:s.tags=i.sent(),i.label=4;case 4:return r.errors===undefined?[3,6]:(a=r,[4,p(r.errors,t,n)]);case 5:a.errors=i.sent(),i.label=6;case 6:return r.links===undefined?[3,8]:(o=r,[4,p(r.links,t,n)]);case 7:o.links=i.sent(),i.label=8;case 8:return r.examples===undefined?[3,14]:(c=r,[4,p(r.examples,t,n)]);case 9:c.examples=i.sent(),l=0,u=r.examples,i.label=10;case 10:return l<u.length?(f=u[l],m=f,[4,p(f.params,t,n)]):[3,14];case 11:return m.params=i.sent(),f.result===undefined?[3,13]:(g=f,[4,d(f.result,t,n)]);case 12:g.result=i.sent(),i.label=13;case 13:return l++,[3,10];case 14:return y=r,[4,p(r.params,t,n)];case 15:return y.params=i.sent(),r.result===undefined?[3,17]:(b=r,[4,d(r.result,t,n)]);case 16:b.result=i.sent(),i.label=17;case 17:_={},t.components&&t.components.schemas&&(_=t.components.schemas),v=r.params,w=0,S=v,i.label=18;case 18:return w<S.length?(E=S[w],T=E,[4,h(E.schema,_)]):[3,21];case 19:T.schema=i.sent(),i.label=20;case 20:return w++,[3,18];case 21:return r.result===undefined?[3,23]:(k=r.result,P=k,[4,h(k.schema,_)]);case 22:P.schema=i.sent(),i.label=23;case 23:return[2,r]}})})};n.default=function(e,t){return void 0===t&&(t=c.default),s(this,void 0,void 0,function(){var n,a,o,c,l,u,d;return i(this,function(p){switch(p.label){case 0:return n=r({},e),[4,(g=n,s(void 0,void 0,void 0,function(){var e,t,n,r,s,a,o;return i(this,function(i){switch(i.label){case 0:if(g.components===undefined)return[2,Promise.resolve(g)];if(g.components.schemas===undefined)return[2,Promise.resolve(g)];e=g.components.schemas,t=Object.keys(e),n=0,r=t,i.label=1;case 1:return n<r.length?(s=r[n],a=e,o=s,[4,h(e[s],e)]):[3,4];case 2:a[o]=i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2,g]}})}))];case 1:return n=p.sent(),[4,f(n)];case 2:n=p.sent(),a=[],o=0,c=n.methods,p.label=3;case 3:return o<c.length?(l=c[o],d=(u=a).push,[4,m(l,n,t)]):[3,6];case 4:d.apply(u,[p.sent()]),p.label=5;case 5:return o++,[3,3];case 6:return n.methods=a,[2,n]}var g})})}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/dereference-document.js"}],[2973,{"./dereference-document":2972,"./validate-open-rpc-document":2974,"@json-schema-tools/reference-resolver":824,"@json-schema-tools/reference-resolver/build/reference-resolver":825,"is-url":4439},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},r.apply(this,arguments)},s=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.makeCustomResolver=void 0;var u=l(e("./dereference-document")),d=a(e("./validate-open-rpc-document")),p=l(e("@json-schema-tools/reference-resolver")),h=e("is-url"),f=l(e("@json-schema-tools/reference-resolver/build/reference-resolver")),m={dereference:!0,validate:!0};n.makeCustomResolver=function(e){return new f.default(e)},n.default=function(e,t){return function(n,s){return void 0===n&&(n="./openrpc.json"),void 0===s&&(s=m),o(this,void 0,void 0,function(){var i,a,o,l;return c(this,function(c){switch(c.label){case 0:return a=r(r({},m),s),"string"==typeof n?[3,1]:(i=n,[3,6]);case 1:return function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(n)?(i=JSON.parse(n),[3,6]):[3,2];case 2:return h(n)?[4,e(n)]:[3,4];case 3:return i=c.sent(),[3,6];case 4:return[4,t(n)];case 5:i=c.sent(),c.label=6;case 6:if(a.validate&&(l=(0,d.default)(i))instanceof d.OpenRPCDocumentValidationError)throw l;return o=i,a.dereference?a.resolver===undefined?[3,8]:[4,(0,u.default)(i,a.resolver)]:[3,10];case 7:return o=c.sent(),[3,10];case 8:return[4,(0,u.default)(i,p.default)];case 9:o=c.sent(),c.label=10;case 10:if(a.validate&&(l=(0,d.default)(o))instanceof d.OpenRPCDocumentValidationError)throw l;return[2,o]}})})}}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/parse-open-rpc-document.js"}],[2974,{"@json-schema-tools/meta-schema":821,"@open-rpc/meta-schema":2971,ajv:3616},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},r.apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentValidationError=void 0;var i=s(e("@open-rpc/meta-schema")),a=s(e("ajv")),o=s(e("@json-schema-tools/meta-schema")),c=function(e){this.name="OpenRPCDocumentDereferencingError",this.message=["Error validating OpenRPC Document against @open-rpc/meta-schema.","The errors found are as follows:",JSON.stringify(e,undefined,"  ")].join("\n")};n.OpenRPCDocumentValidationError=c,n.default=function(e){var t=new a.default;t.addSchema(o.default,"https://meta.json-schema.tools");var n=r({},i.default);delete n.definitions.JSONSchema.$id,delete n.definitions.JSONSchema.$schema,delete n.$schema,delete n.$id;try{t.validate(n,e)}catch(e){throw new Error(["schema-utils-js: Internal Error","-----",e,"-----","If you see this report it: https://github.com/open-rpc/schema-utils-js/issues"].join("\n"))}return!t.errors||new c(t.errors)}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/validate-open-rpc-document.js"}],[298,{"../../../../shared/constants/network":5617,"@metamask/rpc-errors":2480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createUnsupportedMethodMiddleware=function(e=s.UNSUPPORTED_RPC_METHODS){return async function(t,n,s,i){return e.has(t.method)?i(r.rpcErrors.methodNotSupported()):s()}};var r=e("@metamask/rpc-errors"),s=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[299,{"../../../../../shared/constants/app":5598,"../../../../../shared/constants/network":5617,"./ethereum-chain-utils":301,"@metamask/controller-utils":1383,"@metamask/network-controller":2227,"@metamask/rpc-errors":2480,lodash:4635,"uri-js":5528},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var a=s?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(e("uri-js")),s=e("@metamask/controller-utils"),i=e("@metamask/network-controller"),a=e("@metamask/rpc-errors"),o=e("lodash"),c=e("../../../../../shared/constants/app"),l=e("../../../../../shared/constants/network"),u=e("./ethereum-chain-utils");function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const p={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,n,c,{addNetwork:d,updateNetwork:p,getNetworkConfigurationByChainId:h,setActiveNetwork:f,requestUserApproval:m,getCurrentChainIdForDomain:g,getCaveat:y,requestPermittedChainsPermissionIncrementalForOrigin:b,rejectApprovalRequestsForOrigin:_,setTokenNetworkFilter:v,setEnabledNetworks:w,getEnabledNetworks:S}){var E,T;let k;try{k=(0,u.validateAddEthereumChainParams)(e.params[0])}catch(e){return c(e)}const{chainId:P,chainName:O,firstValidBlockExplorerUrl:M,firstValidRPCUrl:A,ticker:j}=k,{origin:R}=e,I=g(R),C=h(P);if(C&&C.chainId===P&&C.nativeCurrency!==j)return c(a.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${j}`}));let N=C,x=null==C?void 0:C.rpcEndpoints.findIndex(({url:e})=>r.equal(e,A)),L=M?null==C?void 0:C.blockExplorerUrls.findIndex(e=>r.equal(e,M)):undefined;const D=!C||x!==C.defaultRpcEndpointIndex||M&&L!==C.defaultBlockExplorerUrlIndex;if(D)try{if(await m({origin:R,type:s.ApprovalType.AddEthereumChain,requestData:{chainId:P,rpcPrefs:{blockExplorerUrl:M},chainName:O,rpcUrl:A,ticker:j}}),C){const e=(0,o.cloneDeep)(C);-1===x&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:A,type:i.RpcEndpointType.Custom,name:O}],x=e.rpcEndpoints.length-1),M&&(-1===L&&(e.blockExplorerUrls=[...e.blockExplorerUrls,M],L=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=L),N=await p(e.chainId,e,I===P?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else{const e=l.FEATURED_RPCS.find(e=>e.chainId===P),t=e?e.rpcEndpoints[e.defaultRpcEndpointIndex]:undefined;N=await d({blockExplorerUrls:M?[M]:[],defaultBlockExplorerUrlIndex:M?0:undefined,chainId:P,defaultRpcEndpointIndex:0,name:O,nativeCurrency:j,rpcEndpoints:[...t?[t]:[],{url:A,name:O,type:i.RpcEndpointType.Custom}]})}}catch(e){return c(e)}const U=null==C||null===(E=C.rpcEndpoints)||void 0===E||null===(E=E[C.defaultRpcEndpointIndex])||void 0===E?void 0:E.networkClientId,$=null===(T=N)||void 0===T||null===(T=T.rpcEndpoints)||void 0===T||null===(T=T[N.defaultRpcEndpointIndex])||void 0===T?void 0:T.networkClientId,G=U??$;return(0,u.switchChain)(t,c,P,G,{isAddFlow:!0,autoApprove:D,setActiveNetwork:f,getCaveat:y,requestPermittedChainsPermissionIncrementalForOrigin:b,rejectApprovalRequestsForOrigin:_,setTokenNetworkFilter:v,setEnabledNetworks:w,getEnabledNetworks:S})},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0}};n.default=p}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[2994,{assert:3876,buffer:3880,"component-type":3947,"join-component":4447},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("component-type"),s=e("join-component"),i=e("assert");t.exports=function(e,t){switch(o(e),t=t||e.type,i(t,"You must pass an event type."),t){case"track":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),i(e.event,'You must pass an "event".')}(e);case"group":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),i(e.groupId,'You must pass a "groupId".')}(e);case"identify":case"page":case"screen":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".')}(e);case"alias":return function(e){i(e.userId,'You must pass a "userId".'),i(e.previousId,'You must pass a "previousId".')}(e);default:i(0,'Invalid event type: "'+t+'"')}};var a={anonymousId:["string","number"],category:"string",context:"object",event:"string",groupId:["string","number"],integrations:"object",name:"string",previousId:["string","number"],timestamp:"date",userId:["string","number"],type:"string"};function o(e){i("object"===r(e),"You must pass a message object.");var t=JSON.stringify(e);for(var o in i(n.byteLength(t,"utf8")<32768,"Your message must be < 32kb."),a){var c=e[o];if(c){var l=a[o];"array"!==r(l)&&(l=[l]);var u="object"===l[0]?"an":"a";i(l.some(function(e){return r(c)===e}),'"'+o+'" must be '+u+" "+s(l,"or")+".")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@segment/loosely-validate-event",file:"node_modules/@segment/loosely-validate-event/index.js"}],[30,{"../../../shared/constants/bridge":5600,"../../../shared/constants/time":5635,"../../../shared/lib/fetch-with-cache":5692,"../../../shared/lib/trace":5718,"../lib/util":353,"@metamask/bridge-controller":1304,"@metamask/controller-utils":1383},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeControllerInit=void 0;var r,s=e("@metamask/bridge-controller"),i=e("@metamask/controller-utils"),a=e("../../../shared/constants/bridge"),o=e("../../../shared/lib/trace"),c=(r=e("../../../shared/lib/fetch-with-cache"))&&r.__esModule?r:{default:r},l=e("../../../shared/constants/time"),u=e("../lib/util");n.BridgeControllerInit=({controllerMessenger:e,initMessenger:t,getController:n})=>{const r=n("TransactionController");return{persistedStateKey:null,memStateKey:null,controller:new s.BridgeController({messenger:e,clientId:s.BridgeClientId.EXTENSION,clientVersion:"13.11.0",getLayer1GasFee:(...e)=>r.getLayer1GasFee(...e),fetchFn:async(e,t)=>{const n=e.toString();if(n.includes("getTokens"))return await(0,c.default)({url:n,fetchOptions:{method:"GET",...t},cacheOptions:{cacheRefreshTime:10*l.MINUTE},functionName:"fetchBridgeTokens"});if(n.includes("spot-prices"))return await(0,c.default)({url:n,fetchOptions:{method:"GET",...t},cacheOptions:{cacheRefreshTime:30*l.SECOND},functionName:"fetchAssetExchangeRates"});if(n.includes("getQuote?"))return await(0,i.handleFetch)(e,{method:"GET",...t});const r=await fetch(e,t);if(!r.ok)throw new i.HttpError(r.status,`Fetch failed with status '${r.status}' for request ${n}`);return r},trackMetaMetricsFn:(e,n)=>{const r=(Date.now()+Math.random()).toString();t.call("MetaMetricsController:trackEvent",{category:s.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,event:e,properties:{...n??{},environmentType:(0,u.getEnvironmentType)(),actionId:r}})},traceFn:(...e)=>(0,o.trace)(...e),config:{customBridgeApiBaseUrl:a.BRIDGE_API_BASE_URL}})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-controller-init.ts"}],[300,{"../../../../../shared/constants/app":5598},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,n,r,{getAccounts:s}){return t.result=s(),r()},hookNames:{getAccounts:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.ts"}],[301,{"../../../../../shared/constants/app":5598,"../../../../../shared/modules/network.utils":5745,"../../util":353,"@metamask/chain-agnostic-permission":1359,"@metamask/controller-utils":1383,"@metamask/rpc-errors":2480,"@metamask/snaps-utils":2781,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.switchChain=async function(e,t,n,s,{origin:l,isAddFlow:u,isSwitchFlow:d,autoApprove:p,setActiveNetwork:h,getCaveat:f,requestPermittedChainsPermissionIncrementalForOrigin:m,setTokenNetworkFilter:g,setEnabledNetworks:y,getEnabledNetworks:b,rejectApprovalRequestsForOrigin:_,requestUserApproval:v,hasApprovalRequestsForOrigin:w,toNetworkConfiguration:S,fromNetworkConfiguration:E}){try{const T=f({target:i.Caip25EndowmentPermissionName,caveatType:i.Caip25CaveatType});if(T){if((0,i.getPermittedEthChainIds)(T.value).includes(n))null==w||!w()||u||p||await v({origin:l,type:r.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:S,fromNetworkConfiguration:E}});else{let e;d&&(e={isSwitchEthereumChain:!0}),await m({chainId:n,autoApprove:p,metadata:e})}}else await m({chainId:n,autoApprove:p});if((0,o.isSnapId)(l)||null==_||_(),await h(s),!(0,o.isSnapId)(l))if(g(n),(0,c.isPrefixedFormattedHexString)(n)){const e=b(a.KnownCaipNamespace.Eip155);Object.keys(e).includes(n)||y(n)}else{const{namespace:e}=(0,a.parseCaipChainId)(n),t=b(e);Object.keys(t).includes(n)||y(n)}return e.result=null,t()}catch(e){return t(e)}},n.validateAddEthereumChainParams=function(e){if(!e||"object"!=typeof e)throw s.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:t,chainName:n,blockExplorerUrls:r,nativeCurrency:i,rpcUrls:a,...o}=e,c=Object.keys(o).filter(e=>!["iconUrls"].includes(e));if(c.length>0)throw s.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${c}`});const p=d(t);if(!a||!Array.isArray(a)||0===a.length)throw s.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${a}`});const h=e=>{const t=(0,u.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},f=a.find(e=>h(e)),m=Array.isArray(r)?r.find(e=>h(e)):null;if(!f)throw s.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${a}`});if("string"!=typeof n||!n)throw s.rpcErrors.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${n}`});const g=n.length>100?n.substring(0,100):n;if(null!==i){if("object"!=typeof i||Array.isArray(i))throw s.rpcErrors.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${i}`});if(18!==i.decimals)throw s.rpcErrors.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${i.decimals}`});if(!i.symbol||"string"!=typeof i.symbol)throw s.rpcErrors.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${i.symbol}`})}const y=(null==i?void 0:i.symbol)||l.UNKNOWN_TICKER_SYMBOL;if(y!==l.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof y||y.length<1||y.length>6))throw s.rpcErrors.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${y}`});return{chainId:p,chainName:g,firstValidBlockExplorerUrl:m,firstValidRPCUrl:f,ticker:y}},n.validateChainId=d,n.validateSwitchEthereumChainParams=function(e){var t;if(null===(t=e.params)||void 0===t||!t[0]||"object"!=typeof e.params[0])throw s.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:n,...r}=e.params[0];if(Object.keys(r).length>0)throw s.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(r)}`});return d(n)};var r=e("@metamask/controller-utils"),s=e("@metamask/rpc-errors"),i=e("@metamask/chain-agnostic-permission"),a=e("@metamask/utils"),o=e("@metamask/snaps-utils"),c=e("../../../../../shared/modules/network.utils"),l=e("../../../../../shared/constants/app"),u=e("../../util");function d(e){const t="string"==typeof e?e.toLowerCase():null;if(!(0,c.isPrefixedFormattedHexString)(t))throw s.rpcErrors.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,c.isSafeChainId)(parseInt(e,16)))throw s.rpcErrors.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[302,{"../../../../../shared/constants/app":5598},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,n,r,{getProviderState:s}){var i;const a=null===(i=e.params)||void 0===i?void 0:i.isInitializingStreamProvider;return t.result={...await s(e.origin,{isInitializingStreamProvider:a})},r()},hookNames:{getProviderState:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.ts"}],[3029,{"@metamask/eth-sig-util":1924,tslib:5509},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.transformTypedData=void 0;const r=e("tslib").__importStar(e("@metamask/eth-sig-util"));function s(e){switch(Object.prototype.toString.call(e)){case"[object Object]":{const t=Object.keys(e).map(t=>[t,s(e[t])]);return Object.fromEntries(t)}case"[object Array]":return e.map(e=>s(e));case"[object BigInt]":return e.toString();default:return e}}n.transformTypedData=(e,t)=>{if(!t)throw new Error("Trezor: Only version 4 of typed data signing is supported");const n=r.SignTypedDataVersion.V4,{types:i,primaryType:a,domain:o,message:c}=r.TypedDataUtils.sanitizeData(e),l=r.TypedDataUtils.hashStruct("EIP712Domain",s(o),i,n).toString("hex");let u=null;return"EIP712Domain"!==a&&(u=r.TypedDataUtils.hashStruct(a,s(c),i,n).toString("hex")),Object.assign({domain_separator_hash:l,message_hash:u},e)},n.default=n.transformTypedData}}},{package:"@metamask/eth-trezor-keyring>@trezor/connect-plugin-ethereum",file:"node_modules/@trezor/connect-plugin-ethereum/lib/index.js"}],[303,{"./add-ethereum-chain":299,"./eth-accounts":300,"./get-provider-state":302,"./log-web3-shim-usage":304,"./request-accounts":305,"./send-metadata":306,"./switch-ethereum-chain":307,"./watch-asset":311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handlers=n.ethAccountsHandler=n.eip1193OnlyHandlers=void 0;var r=d(e("./add-ethereum-chain")),s=d(e("./eth-accounts")),i=d(e("./get-provider-state")),a=d(e("./log-web3-shim-usage")),o=d(e("./request-accounts")),c=d(e("./send-metadata")),l=d(e("./switch-ethereum-chain")),u=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}n.handlers=[r.default,i.default,a.default,c.default,u.default],n.eip1193OnlyHandlers=[l.default,s.default,o.default],n.ethAccountsHandler=s.default}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[304,{"../../../../../shared/constants/app":5598},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,n,r,{getWeb3ShimUsageState:s,setWeb3ShimUsageRecorded:i}){const{origin:a}=e;s(a)===undefined&&i(a);return t.result=!0,r()},hookNames:{getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/log-web3-shim-usage.ts"}],[305,{"../../../../../shared/constants/app":5598,"../../../../../shared/constants/metametrics":5613,"../../util":353,"@metamask/rpc-errors":2480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),s=e("../../../../../shared/constants/app"),i=e("../../../../../shared/constants/metametrics"),a=e("../../util");const o={methodNames:[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,n,o,{getAccounts:l,sendMetrics:u,metamaskState:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p,requestPermissionsForOrigin:h}){const{origin:f}=e??{};if(c.has(f))return t.error=r.rpcErrors.resourceUnavailable(`Already processing ${s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();let m=l(f);if(m.length>0){try{c.add(f),t.result=m,o()}catch(e){o(e)}finally{c.delete(f)}return undefined}try{const e=p();await h(e)}catch(e){return o(e)}if(m=l(f),(0,a.shouldEmitDappViewedEvent)(d.metaMetricsId)){const e=!Object.keys(d.permissionHistory).includes(f);u({event:i.MetaMetricsEventName.DappViewed,category:i.MetaMetricsEventCategory.InpageProvider,referrer:{url:f},properties:{is_first_visit:e,number_of_accounts:new Set(Object.values(d.accountsByChainId).flatMap(e=>Object.keys(e))).size,number_of_accounts_connected:m.length}},{excludeMetaMetricsId:!0})}return t.result=m,o()},hookNames:{getAccounts:!0,sendMetrics:!0,metamaskState:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0,requestPermissionsForOrigin:!0}};n.default=o;const c=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.ts"}],[306,{"../../../../../shared/constants/app":5598,"@metamask/rpc-errors":2480,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),s=e("@metamask/utils");const i={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,n,i,{addSubjectMetadata:a,subjectType:o}){const{origin:c,params:l}=e;if(!(0,s.isObject)(l))return i(r.rpcErrors.invalidParams({data:l}));{const{icon:e=null,name:t=null,...n}=l;a({...n,iconUrl:e,name:t,subjectType:o,origin:c})}return t.result=!0,i()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};n.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.ts"}],[307,{"../../../../../shared/constants/app":5598,"./ethereum-chain-utils":301,"@metamask/rpc-errors":2480,"@metamask/snaps-utils":2781},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),s=e("@metamask/snaps-utils"),i=e("../../../../../shared/constants/app"),a=e("./ethereum-chain-utils");const o={methodNames:[i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,n,o,{getNetworkConfigurationByChainId:c,setActiveNetwork:l,requestUserApproval:u,getCaveat:d,getCurrentChainIdForDomain:p,requestPermittedChainsPermissionIncrementalForOrigin:h,rejectApprovalRequestsForOrigin:f,setTokenNetworkFilter:m,setEnabledNetworks:g,getEnabledNetworks:y,hasApprovalRequestsForOrigin:b}){let _;try{_=(0,a.validateSwitchEthereumChainParams)(e)}catch(e){return o(e)}const{origin:v}=e,w=p(v);if(w===_)return t.result=null,o();const S=c(_),E=null==S?void 0:S.rpcEndpoints[S.defaultRpcEndpointIndex].networkClientId;if(!E)return o(r.providerErrors.custom({code:4902,message:`Unrecognized chain ID "${_}". Try adding the chain using ${i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}));const T=c(w),k=c(_);return(0,a.switchChain)(t,o,_,E,{origin:v,isSwitchFlow:!0,autoApprove:(0,s.isSnapId)(v),setActiveNetwork:l,getCaveat:d,requestPermittedChainsPermissionIncrementalForOrigin:h,rejectApprovalRequestsForOrigin:f,setTokenNetworkFilter:m,setEnabledNetworks:g,getEnabledNetworks:y,requestUserApproval:u,hasApprovalRequestsForOrigin:b,toNetworkConfiguration:k,fromNetworkConfiguration:T})},hookNames:{getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCaveat:!0,getCurrentChainIdForDomain:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0,hasApprovalRequestsForOrigin:!0}};n.default=o}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/switch-ethereum-chain.js"}]],[],{});