LavaPack.loadBundle([[948,{rxjs:5155},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.setEnvUnsafe=r.setEnv=r.changes=r.getEnvDesc=r.isEnvDefault=r.getEnvDefault=r.getEnv=r.getAllEnvs=r.getAllEnvNames=r.getDefinition=void 0;const s=e("rxjs"),n=e=>{if(!Number.isNaN(e))return parseInt(e,10)},a=e=>{if(!Number.isNaN(e))return parseFloat(e)},o=e=>"boolean"==typeof e?e:!("0"===e||"false"===e),i=e=>"string"==typeof e?e:undefined,l=e=>{const t="string"==typeof e?e.split(","):null;if(Array.isArray(t)&&t.length>0)return t},c={ADDRESS_POISONING_FAMILIES:{def:"evm,tron",parser:i,desc:"List of families impacted by the address poisoning attack"},ANALYTICS_CONSOLE:{def:!1,parser:o,desc:"Show tracking overlays on the app UI"},DEBUG_THEME:{def:!1,parser:o,desc:"Show theme debug overlay UI"},API_ICP_ENDPOINT:{def:"https://icp.coin.ledger.com/",parser:i,desc:"Rosetta API for ICP"},API_CASPER_INDEXER_ENDPOINT:{parser:i,def:"https://casper.coin.ledger.com/indexer",desc:"Casper API url indexer"},API_CASPER_NODE_ENDPOINT:{parser:i,def:"https://casper.coin.ledger.com/node/",desc:"Casper API url node"},API_ALGORAND_BLOCKCHAIN_EXPLORER_API_ENDPOINT:{def:"https://algorand.coin.ledger.com",parser:i,desc:"Node API endpoint for algorand"},API_CELO_INDEXER:{def:"https://celo.coin.ledger.com/indexer/",parser:i,desc:"Explorer API for celo"},API_CELO_NODE:{def:"https://celo.coin.ledger.com/archive/",parser:i,desc:"Node endpoint for celo"},COSMOS_GAS_AMPLIFIER:{def:1.3,parser:n,desc:"Cosmos gas estimate multiplier"},API_FILECOIN_ENDPOINT:{parser:i,def:"https://filecoin.coin.ledger.com",desc:"Filecoin API url"},API_STACKS_ENDPOINT:{parser:i,def:"https://stacks.coin.ledger.com",desc:"Stacks API url"},API_POLKADOT_INDEXER:{parser:i,def:"https://polkadot.coin.ledger.com",desc:"Explorer API for polkadot"},API_POLKADOT_SIDECAR:{parser:i,def:"https://polkadot-sidecar.coin.ledger.com",desc:"Polkadot Sidecar API url"},API_POLKADOT_SIDECAR_CREDENTIALS:{parser:i,def:"",desc:"Polkadot Sidecar API credentials"},API_POLKADOT_NODE:{parser:i,def:"https://polkadot-fullnodes.api.live.ledger.com",desc:"Polkadot Node"},ELROND_API_ENDPOINT:{parser:i,def:"https://elrond.coin.ledger.com",desc:"Elrond API url"},ELROND_DELEGATION_API_ENDPOINT:{parser:i,def:"https://delegations-elrond.coin.ledger.com",desc:"Elrond DELEGATION API url"},API_STELLAR_HORIZON:{parser:i,def:"https://stellar.coin.ledger.com",desc:"Stellar Horizon API url"},API_STELLAR_HORIZON_FETCH_LIMIT:{parser:n,def:100,desc:"Limit of operation that Horizon will fetch per page"},API_STELLAR_HORIZON_STATIC_FEE:{def:!1,parser:o,desc:"Static fee for Stellar account"},API_TEZOS_BAKER:{parser:i,def:"https://tezos-bakers.api.live.ledger.com",desc:"bakers API for tezos"},API_TEZOS_BLOCKCHAIN_EXPLORER_API_ENDPOINT:{def:"https://xtz-explorer.api.live.ledger.com/explorer",parser:i,desc:"Ledger explorer API for tezos"},API_TEZOS_TZKT_API:{def:"https://xtz-tzkt-explorer.api.live.ledger.com",parser:i,desc:"tzkt.io explorer"},API_TEZOS_NODE:{def:"https://xtz-node.api.live.ledger.com",parser:i,desc:"node API for tezos (for broadcast only)"},API_TRONGRID_PROXY:{parser:i,def:"https://tron.coin.ledger.com",desc:"proxy url for trongrid API"},API_SOLANA_PROXY:{parser:i,def:"https://solana.coin.ledger.com",desc:"proxy url for solana API"},SOLANA_VALIDATORS_APP_BASE_URL:{parser:i,def:"https://earn.api.live.ledger.com/v0/network/solana/validator-details",desc:"base url for validators.app validator list"},SOLANA_TESTNET_VALIDATORS_APP_BASE_URL:{parser:i,def:"https://validators-solana.coin.ledger.com/api/v1/validators",desc:"base url for testnet validators.app validator list"},SOLANA_TX_CONFIRMATION_TIMEOUT:{def:1e5,parser:n,desc:"solana transaction broadcast confirmation timeout"},API_HEDERA_MIRROR:{def:"https://hedera.coin.ledger.com",parser:i,desc:"mirror node API for Hedera"},API_VECHAIN_THOREST:{def:"https://vechain.coin.ledger.com",parser:i,desc:"Thorest API for VeChain"},BASE_SOCKET_URL:{def:"wss://scriptrunner.api.live.ledger.com/update",parser:i,desc:"Ledger script runner API"},BOT_TIMEOUT_SCAN_ACCOUNTS:{def:6e5,parser:n,desc:"bot's default timeout for scanAccounts"},BOT_SPEC_DEFAULT_TIMEOUT:{def:18e5,parser:n,desc:"define the default value of spec.skipMutationsTimeout (if not overriden by spec)"},BUY_API_BASE:{def:"https://buy.api.live.ledger.com/buy/v1",parser:i,desc:"Buy crypto API base url - version 1"},CARDANO_API_ENDPOINT:{def:"https://cardano.coin.ledger.com/api",parser:i,desc:"Cardano API url"},CARDANO_TESTNET_API_ENDPOINT:{def:"https://testnet-ledger.cardanoscan.io/api",parser:i,desc:"Cardano API url"},ICON_NODE_ENDPOINT:{parser:i,def:"https://icon.coin.ledger.com/api/v3",desc:"ICON RPC url"},ICON_DEBUG_ENDPOINT:{parser:i,def:"https://icon.coin.ledger.com/api/v3d",desc:"ICON debug RPC url"},ICON_INDEXER_ENDPOINT:{parser:i,def:"https://icon.coin.ledger.com/api/v1",desc:"ICON API url"},ICON_TESTNET_NODE_ENDPOINT:{parser:i,def:"https://berlin.net.solidwallet.io/api/v3",desc:"ICON Berlin Testnet API url"},ICON_TESTNET_DEBUG_ENDPOINT:{parser:i,def:"https://berlin.net.solidwallet.io/api/v3d",desc:"ICON Berlin Testnet debug"},ICON_TESTNET_INDEXER_ENDPOINT:{parser:i,def:"https://tracker.berlin.icon.community/api/v1",desc:"ICON Berlin Testnet API url"},COINAPPS:{def:"",parser:i,desc:"(dev feature) defines the folder for speculos mode that contains Nano apps binaries (.elf) in a specific structure: <device>/<firmware>/<appName>/app_<appVersion>.elf"},CRYPTO_ORG_INDEXER:{def:"https://cryptoorg-rpc-indexer.coin.ledger.com",parser:i,desc:"location of the Cronos POS Chain (formerly Crypto.org) indexer API"},CRYPTO_ORG_TESTNET_INDEXER:{def:"https://cronos-pos.org/explorer/croeseid4",parser:i,desc:"location of the Cronos POS Chain (formerly Crypto.org) indexer testnet API"},CRYPTO_ORG_RPC_URL:{def:"https://cryptoorg-rpc-node.coin.ledger.com",parser:i,desc:"location of the Cronos POS Chain (formerly Crypto.org) chain node"},CRYPTO_ORG_TESTNET_RPC_URL:{def:"https://rpc-testnet-croeseid-4.crypto.org",parser:i,desc:"location of the Cronos POS Chain (formerly Crypto.org) chain testnet node"},DEBUG_UTXO_DISPLAY:{def:4,parser:n,desc:"define maximum number of utxos to display in CLI"},DEBUG_HTTP_RESPONSE:{def:!1,parser:o,desc:"includes HTTP response body in logs"},DEVICE_CANCEL_APDU_FLUSH_MECHANISM:{def:!0,parser:o,desc:"enable a mechanism that send a 0x00 apdu to force device to awake from its 'Processing' UI state"},DEVICE_PROXY_URL:{def:"",parser:i,desc:"enable a proxy to use instead of a physical device"},DEVICE_PROXY_MODEL:{def:"nanoS",parser:i,desc:"allow to override the default model of a proxied device"},DISABLE_TRANSACTION_BROADCAST:{def:!1,parser:o,desc:"disable broadcast of transactions"},DISABLE_SYNC_TOKEN:{def:!0,parser:o,desc:"disable a problematic mechanism of our API"},DISABLE_FW_UPDATE_VERSION_CHECK:{def:!1,parser:o,desc:"disable the version check for firmware update eligibility"},EIP1559_MINIMUM_FEES_GATE:{def:!0,parser:o,desc:"prevents the user from doing an EIP1559 transaction with fees too low"},EIP1559_PRIORITY_FEE_LOWER_GATE:{def:.85,parser:a,desc:"minimum priority fee percents allowed compared to network conditions allowed when EIP1559_MINIMUM_FEES_GATE is activated"},EIP1559_BASE_FEE_MULTIPLIER:{def:1.27,parser:a,desc:"mutiplier for the base fee that is composing the maxFeePerGas property"},EXPERIMENTAL_BLE:{def:!1,parser:o,desc:"enable experimental support of Bluetooth"},EXPERIMENTAL_CURRENCIES:{def:"",parser:i,desc:"enable experimental support of currencies (comma separated)"},EXPERIMENTAL_EXPLORERS:{def:!1,parser:o,desc:"enable experimental explorer APIs"},EXPERIMENTAL_LANGUAGES:{def:!1,parser:o,desc:"enable experimental languages"},EXPERIMENTAL_MANAGER:{def:!1,parser:o,desc:"enable an experimental version of Manager"},EXPERIMENTAL_ROI_CALCULATION:{def:!1,parser:o,desc:"enable an experimental version of the portfolio percentage calculation"},EXPERIMENTAL_SEND_MAX:{def:!1,parser:o,desc:"force enabling SEND MAX even if not yet stable"},EXPERIMENTAL_USB:{def:!1,parser:o,desc:"enable an experimental implementation of USB support"},EXPERIMENTAL_SWAP:{def:!1,parser:o,desc:"enable an experimental swap interface"},EXPLORER:{def:"https://explorers.api.live.ledger.com",parser:i,desc:"Ledger generic explorer API"},EXPLORER_STAGING:{def:"https://explorers.api-01.live.ledger-stg.com",parser:i,desc:"Ledger staging explorer API"},EXPLORER_BETA:{def:"https://explorers.api.live.ledger.com",parser:i,desc:"Ledger generic explorer beta API"},EXPLORER_SATSTACK:{def:"http://localhost:20000",parser:i,desc:"Ledger satstack Bitcoin explorer API"},EXPORT_EXCLUDED_LOG_TYPES:{def:"ble-frame",parser:i,desc:"comma-separated list of excluded log types for exported logs"},EXPORT_MAX_LOGS:{def:5e3,parser:n,desc:"maximum logs to keep for export"},DISABLE_APP_VERSION_REQUIREMENTS:{def:!1,parser:o,desc:"force an old application version to be accepted regardless of its version"},FORCE_PROVIDER:{def:1,parser:n,desc:"use a different provider for app store (for developers only)"},FILTER_ZERO_AMOUNT_ERC20_EVENTS:{def:!0,parser:o,desc:"Remove filter of address poisoning"},GET_CALLS_RETRY:{def:2,parser:n,desc:"how many times to retry a GET http call"},GET_CALLS_TIMEOUT:{def:6e4,parser:n,desc:"how much time to timeout a GET http call"},HIDE_EMPTY_TOKEN_ACCOUNTS:{def:!1,parser:o,desc:"hide the sub accounts when they are empty"},KEYCHAIN_OBSERVABLE_RANGE:{def:0,parser:n,desc:"overrides the gap limit specified by BIP44 (default to 20)"},LEDGER_CLIENT_VERSION:{def:"",parser:i,desc:"the 'X-Ledger-Client-Version' HTTP header to use for queries to Ledger APIs"},LEDGER_COUNTERVALUES_API:{def:"https://countervalues.live.ledger.com",parser:i,desc:"Ledger countervalues API"},LEDGER_REST_API_BASE:{def:"https://explorers.api.live.ledger.com",parser:i,desc:"DEPRECATED"},LEGACY_KT_SUPPORT_TO_YOUR_OWN_RISK:{def:!1,parser:o,desc:"enable sending to KT accounts. Not tested."},MANAGER_API_BASE:{def:"https://manager.api.live.ledger.com/api",parser:i,desc:"Ledger Manager API"},MANAGER_DEV_MODE:{def:!1,parser:o,desc:"enable visibility of utility apps in Manager"},MANAGER_INSTALL_DELAY:{def:1e3,parser:n,desc:"defines the time to wait before installing apps to prevent known glitch (<=1.5.5) when chaining installs"},MAPPING_SERVICE:{def:"https://mapping-service.api.ledger.com",parser:i,desc:""},MAX_ACCOUNT_NAME_SIZE:{def:50,parser:n,desc:"maximum size of account names"},MOCK:{def:"",parser:i,desc:"switch the app into a MOCK mode for test purpose, the value will be used as a seed for the rng. Avoid falsy values."},MOCK_COUNTERVALUES:{def:"",parser:i,desc:"switch the countervalues resolution into a MOCK mode for test purpose"},MOCK_APP_UPDATE:{def:!1,parser:o,desc:"Always shows app update in the manager"},MOCK_EXCHANGE_TEST_CONFIG:{def:!1,parser:o,desc:"mock the cryptoassets config and test partner (in the context of app-exchange)"},MOCK_REMOTE_LIVE_MANIFEST:{def:"",parser:i,desc:"mock remote live app manifest"},MOCK_OS_VERSION:{def:"",parser:i,desc:"if defined, overrides the os and version. format: os@version. Example: Windows_NT@6.1.7601"},MOCK_NO_BYPASS:{def:!1,parser:o,desc:"if defined, avoids bypass of the currentDevice in the store."},NFT_CURRENCIES:{def:["avalanche_c_chain","bsc","ethereum","polygon"],parser:l,desc:"set the currencies where NFT is active"},NFT_ETH_METADATA_SERVICE:{def:"https://nft.api.live.ledger.com",parser:i,desc:"service uri used to get the metadata of an nft"},OPERATION_ADDRESSES_LIMIT:{def:100,parser:n,desc:"limit the number of addresses in from/to of operations"},OPERATION_OPTIMISTIC_RETENTION:{def:18e5,parser:n,desc:"timeout to keep an optimistic operation that was broadcasted but not yet visible from the coin implementation or the API"},OPERATION_PAGE_SIZE_INITIAL:{def:100,parser:n,desc:"defines the initial default operation length page to use"},POLKADOT_ELECTION_STATUS_THRESHOLD:{def:25,parser:n,desc:"in blocks - number of blocks before Polkadot election effectively opens to consider it as open and disable all staking features"},SATSTACK:{def:!1,parser:o,desc:"Switch to satstack mode"},SCAN_FOR_INVALID_PATHS:{def:!1,parser:o,desc:"enable searching accounts in exotic derivation paths"},SEED:{def:"",parser:i,desc:"(dev feature) seed to be used by speculos (device simulator)"},SHOW_LEGACY_NEW_ACCOUNT:{def:!1,parser:o,desc:"allow the creation of legacy accounts"},SIMPLE_HASH_API_BASE:{def:"https://simplehash.api.live.ledger.com/api/v0",parser:i,desc:"SimpleHash API base url"},SKIP_ONBOARDING:{def:!1,parser:o,desc:"dev flag to skip onboarding flow"},SPECULOS_API_PORT:{def:0,parser:n,desc:"API port for speculos"},SPECULOS_PID_OFFSET:{def:0,parser:n,desc:"offset to be added to the speculos pid and avoid collision with other instances"},SPECULOS_USE_WEBSOCKET:{def:!1,parser:o,desc:"Use speculos websocket interface instead of Rest API"},SWAP_API_BASE:{def:"https://swap.ledger.com/v5",parser:i,desc:"Swap API base"},SWAP_USER_IP:{def:"",parser:i,desc:"Swap IP"},SWAP_DISABLE_APPS_INSTALL:{def:!1,parser:o,desc:"bypass app checks on Nano for speculos swap tests"},SYNC_ALL_INTERVAL:{def:48e4,parser:n,desc:"delay between successive sync"},SYNC_BOOT_DELAY:{def:2e3,parser:n,desc:"delay before the sync starts"},SYNC_PENDING_INTERVAL:{def:1e4,parser:n,desc:"delay between sync when an operation is still pending"},SYNC_OUTDATED_CONSIDERED_DELAY:{def:6e5,parser:n,desc:"delay until Live consider a sync outdated"},SYNC_MAX_CONCURRENT:{def:4,parser:n,desc:"maximum limit to synchronize accounts concurrently to limit overload"},BOT_MAX_CONCURRENT:{def:10,parser:n,desc:"maximum limit to run bot spec in parallel"},USER_ID:{def:"",parser:i,desc:"unique identifier of app instance. used to derivate dissociated ids for difference purposes (e.g. the firmware update incremental deployment)."},WALLETCONNECT:{def:!1,parser:o,desc:"is walletconnect enabled"},CLOUD_SYNC_API_STAGING:{def:"https://cloud-sync-backend.api.aws.stg.ldg-tech.com",parser:i,desc:"wallet sync api staging base url"},CLOUD_SYNC_API_PROD:{def:"https://cloud-sync.api.live.ledger.com",parser:i,desc:"wallet sync api production base url"},WITH_DEVICE_POLLING_DELAY:{def:500,parser:a,desc:"delay when polling device"},ANNOUNCEMENTS_API_URL:{def:"https://cdn.live.ledger.com/announcements",parser:i,desc:"url used to fetch new announcements"},ANNOUNCEMENTS_API_VERSION:{def:1,parser:n,desc:"version used for the announcements api"},STATUS_API_URL:{def:"https://ledger.statuspage.io/api",parser:i,desc:"url used to fetch ledger status"},STATUS_API_VERSION:{def:2,parser:n,desc:"version used for ledger status api"},TEZOS_MAX_TX_QUERIES:{def:100,parser:n,desc:"safe max on maximum number of queries to synchronize a tezos account"},TRUSTCHAIN_API_STAGING:{def:"https://trustchain-backend.api.aws.stg.ldg-tech.com",parser:i,desc:"Trustchain API Staging"},TRUSTCHAIN_API_PROD:{def:"https://trustchain.api.live.ledger.com",parser:i,desc:"Trustchain API Prod"},PLATFORM_DEBUG:{def:!1,parser:o,desc:"enable visibility of debug apps and tools in Platform Catalog"},PLATFORM_EXPERIMENTAL_APPS:{def:!1,parser:o,desc:"enable visibility of experimental apps and tools in Platform Catalog"},PLATFORM_MANIFEST_API_URL:{def:"https://live-app-catalog.ledger.com/api/v1/apps",parser:i,desc:"url used to fetch platform app manifests"},PLATFORM_LOCAL_MANIFEST_JSON:{def:"",parser:i,desc:'json manifest for a local (test) platform app manifests. How to use: PLATFORM_LOCAL_MANIFEST_JSON="$(cat /path/to/file.json)"'},PLATFORM_GLOBAL_CATALOG_API_URL:{def:"https://cdn.live.ledger.com/platform/catalog/v1/data.json",parser:i,desc:"url used to fetch platform app manifests"},PLATFORM_GLOBAL_CATALOG_STAGING_API_URL:{def:"https://cdn.live.ledger-stg.com/platform/catalog/v1/data.json",parser:i,desc:"url used to fetch platform app manifests (staging)"},PLATFORM_RAMP_CATALOG_API_URL:{def:"https://cdn.live.ledger.com/platform/trade/v1/data.json",parser:i,desc:"url used to fetch platform app manifests"},PLATFORM_RAMP_CATALOG_STAGING_API_URL:{def:"https://cdn.live.ledger-stg.com/platform/trade/v1/data.json",parser:i,desc:"url used to fetch platform app manifests (staging)"},PLATFORM_API_URL:{def:"",parser:i,desc:"url used to fetch platform catalog"},PLATFORM_API_VERSION:{def:1,parser:n,desc:"version used for the platform api"},PLAYWRIGHT_RUN:{def:!1,parser:o,desc:"true when launched for E2E testing"},MARKET_API_URL:{def:"https://proxycg.api.live.ledger.com/api/v3",parser:i,desc:"Market data api"},USE_LEARN_STAGING_URL:{def:!1,parser:o,desc:"use the staging URL for the learn page"},DYNAMIC_CAL_BASE_URL:{def:"https://cdn.live.ledger.com/cryptoassets",parser:i,desc:"bucket S3 of the dynamic cryptoassets list"},CAL_SERVICE_URL:{def:"https://crypto-assets-service.api.ledger.com",parser:i,desc:"Cryptoassets list service url"},FEATURE_FLAGS:{def:"{}",parser:e=>{try{if("string"!=typeof e)throw new Error;return JSON.parse(e)}catch(e){return undefined}},desc:"key value map for feature flags: {[key in FeatureId]?: Feature]}"},PERFORMANCE_CONSOLE:{def:!1,parser:o,desc:"Show a performance overlay on the app UI"},ETHEREUM_STUCK_TRANSACTION_TIMEOUT:{def:3e5,parser:n,desc:"Time after which an optimisc operation is considered stuck"},EVM_REPLACE_TX_LEGACY_GASPRICE_FACTOR:{def:1.3,parser:a,desc:"Replace transaction gasprice factor for legacy evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_REPLACE_TX_EIP1559_MAXFEE_FACTOR:{def:1.3,parser:a,desc:"Replace transaction max fee factor for EIP1559 evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_REPLACE_TX_EIP1559_MAXPRIORITYFEE_FACTOR:{def:1.1,parser:a,desc:"Replace transaction max priority fee factor for EIP1559 evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_FORCE_LEGACY_TRANSACTIONS:{def:!1,parser:o,desc:"Force transaction type 0 on EVM networks"},ENABLE_NETWORK_LOGS:{def:!1,parser:o,desc:"Enable network request and responses logs. Errors are always logged"},CRYPTO_ASSET_SEARCH_KEYS:{def:["ticker","name","keywords"],parser:l,desc:"Fuse search attributes to find a currency according to user input"},VERBOSE:{def:[],parser:l,desc:'Sets up debug console printing of logs. `VERBOSE=1` or `VERBOSE=true`: to print all logs | `VERBOSE="apdu,hw,transport,hid-verbose"` : filtering on a list of log `type` separated by a `,`'},DEFAULT_TRANSACTION_POLLING_INTERVAL:{def:3e4,parser:n,desc:"Default interval to poll for transaction confirmation in speedup/cancel evm flow (in ms)"},LOW_BATTERY_PERCENTAGE:{def:20,parser:n,desc:"Configure the low battery percentage threshold"},LOG_DRAWERS:{def:!1,parser:o,desc:"Enable logs for drawers"}};r.getDefinition=e=>e in c?c[e]:undefined;const d=Object.keys(c).reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:c[t].def}),{}),p=Object.assign({},d);r.getAllEnvNames=()=>Object.keys(c);r.getAllEnvs=()=>Object.assign({},p);r.getEnv=e=>p[e];r.getEnvDefault=e=>d[e];r.isEnvDefault=e=>p[e]===d[e];r.getEnvDesc=e=>c[e].desc,r.changes=new s.Subject;r.setEnv=(e,t)=>{const s=p[e];s!==t&&(p[e]=t,r.changes.next({name:e,value:t,oldValue:s}))};r.setEnvUnsafe=(e,t)=>{const s=(0,r.getDefinition)(e);if(!s)return!1;const{parser:n}=s,a=n(t);return a===undefined||null===a?(console.warn(`Invalid ENV value for ${e}`),!1):((0,r.setEnv)(e,a),!0)}}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/evm-tools>@ledgerhq/live-env",file:"node_modules/@ledgerhq/live-env/lib/env.js"}],[949,{"./env":948},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./env"),r)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/evm-tools>@ledgerhq/live-env",file:"node_modules/@ledgerhq/live-env/lib/index.js"}],[95,{"@metamask/messenger":2167},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getDelegationControllerInitMessenger=function(e){const t=new s.Messenger({namespace:"DelegationControllerInit",parent:e});return e.delegate({messenger:t,events:["TransactionController:transactionStatusUpdated"]}),t},r.getDelegationControllerMessenger=function(e){const t=new s.Messenger({namespace:"DelegationController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:getSelectedAccount","KeyringController:signTypedMessage"],events:["TransactionController:transactionStatusUpdated"]}),t};var s=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/delegation/delegation-controller-messenger.ts"}],[950,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.listen=r.LocalTracer=r.trace=r.log=void 0;let s=0;const n=[];r.log=(e,t,r)=>{const n={type:e,id:String(++s),date:new Date};t&&(n.message=t),r&&(n.data=r),o(n)};r.trace=({type:e,message:t,data:r,context:n})=>{const a={type:e,id:String(++s),date:new Date};t&&(a.message=t),r&&(a.data=r),n&&(a.context=n),o(a)};class a{constructor(e,t){this.type=e,this.context=t}trace(e,t){(0,r.trace)({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new a(e,this.context)}withContext(e){return new a(this.type,e)}withUpdatedContext(e){return new a(this.type,Object.assign(Object.assign({},this.context),e))}}r.LocalTracer=a;function o(e){for(let t=0;t<n.length;t++)try{n[t](e)}catch(e){console.error(e)}}r.listen=e=>(n.push(e),()=>{const t=n.indexOf(e);-1!==t&&(n[t]=n[n.length-1],n.pop())}),"undefined"!=typeof window&&(window.__ledgerLogsListen=r.listen)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/logs",file:"node_modules/@ledgerhq/logs/lib/index.js"}],[96,{"@metamask/messenger":2167},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getEncryptionPublicKeyControllerInitMessenger=function(e){const t=new s.Messenger({namespace:"EncryptionPublicKeyControllerInit",parent:e});return e.delegate({messenger:t,actions:["KeyringController:getEncryptionPublicKey","MetaMetricsController:trackEvent"]}),t},r.getEncryptionPublicKeyControllerMessenger=function(e){const t=new s.Messenger({namespace:"EncryptionPublicKeyController",parent:e});return e.delegate({messenger:t,actions:["ApprovalController:addRequest","ApprovalController:acceptRequest","ApprovalController:rejectRequest"],events:["EncryptionPublicKeyManager:stateChange","EncryptionPublicKeyManager:unapprovedMessage"]}),t};var s=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/encryption-public-key-controller-messenger.ts"}],[97,{"@metamask/messenger":2167},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getEncryptionPublicKeyManagerMessenger=function(e){return new s.Messenger({namespace:"EncryptionPublicKeyManager",parent:e})};var s=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/encryption-public-key-manager-messenger.ts"}],[98,{"@metamask/messenger":2167},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getEnsControllerInitMessenger=function(e){const t=new s.Messenger({namespace:"EnsControllerInit",parent:e});return e.delegate({messenger:t,events:["NetworkController:networkDidChange"]}),t},r.getEnsControllerMessenger=function(e){const t=new s.Messenger({namespace:"EnsController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getState"]}),t};var s=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/ens-controller-messenger.ts"}],[99,{"@metamask/messenger":2167},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getErrorReportingServiceMessenger=function(e){return new s.Messenger({namespace:"ErrorReportingService",parent:e})};var s=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/error-reporting-service-messenger.ts"}],[9,{"../../shared/constants/app":5598,"../../shared/constants/background-liveness-check":5599,"../../shared/constants/errors":5603,"../../shared/constants/infura-project-id":5608,"../../shared/constants/messages":5612,"../../shared/constants/metametrics":5613,"../../shared/constants/offscreen-communication":5619,"../../shared/constants/onboarding":5620,"../../shared/constants/referrals":5624,"../../shared/constants/start-up-errors":5630,"../../shared/lib/get-first-preferred-lang-code":5698,"../../shared/lib/manifestFlags":5700,"../../shared/lib/promise-with-resolvers":5710,"../../shared/modules/browser-runtime.utils":5729,"../../shared/modules/caip-stream":5730,"../../shared/modules/fetch-with-timeout":5739,"../../shared/modules/mv3.utils":5744,"../../shared/modules/object.utils":5746,"../../shared/modules/selectors/networks":5753,"./constants/marketing-site-whitelist":10,"./constants/sentry-state":11,"./constants/snaps":12,"./constants/stream":13,"./first-time-state":240,"./lib/CronjobControllerStorageManager":245,"./lib/createHyperliquidReferralMiddleware":254,"./lib/deep-links/deep-link-router":267,"./lib/deep-links/metrics":268,"./lib/ens-ipfs/setup":273,"./lib/extension-lazy-listener/extension-lazy-listener":274,"./lib/getObjStructure":276,"./lib/migrator":281,"./lib/notification-manager":285,"./lib/safe-reload":313,"./lib/setup-initial-state-hooks":316,"./lib/sidepanel-context-menu":317,"./lib/start-up-errors/start-up-errors":327,"./lib/state-corruption/state-corruption-recovery":328,"./lib/stores/extension-store":330,"./lib/stores/persistence-manager":332,"./lib/stores/read-only-network-store":333,"./lib/stream-utils":334,"./lib/update-remote-feature-flags":352,"./lib/util":353,"./metamask-controller":354,"./migrations":568,"./offscreen":569,"./on-update":570,"./platforms/extension":571,"@metamask/notification-services-controller":2279,"@metamask/utils":2914,"extension-port-stream":4185,loglevel:4643,"readable-stream":5100,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=je,r.setupController=Xe,e("./lib/setup-initial-state-hooks"),e("../../shared/constants/infura-project-id");var s=e("readable-stream"),n=te(e("loglevel")),a=te(e("webextension-polyfill")),o=e("@metamask/utils"),i=e("@metamask/notification-services-controller"),l=e("extension-port-stream"),c=e("../../shared/lib/promise-with-resolvers"),d=e("../../shared/constants/onboarding"),p=e("../../shared/constants/app"),u=e("../../shared/constants/messages"),f=e("../../shared/constants/background-liveness-check"),E=e("../../shared/constants/metametrics"),g=e("../../shared/modules/browser-runtime.utils"),m=e("../../shared/modules/mv3.utils"),_=e("../../shared/modules/object.utils"),h=(e("../../shared/constants/offscreen-communication"),e("../../shared/modules/selectors/networks")),A=e("../../shared/modules/caip-stream"),T=te(e("../../shared/modules/fetch-with-timeout")),I=e("../../shared/constants/errors"),P=te(e("../../shared/lib/get-first-preferred-lang-code")),O=(e("../../shared/lib/manifestFlags"),e("../../shared/constants/start-up-errors")),S=e("../../shared/constants/referrals"),N=e("./lib/state-corruption/state-corruption-recovery"),v=e("./lib/sidepanel-context-menu"),C=e("./lib/stores/persistence-manager"),b=te(e("./lib/stores/extension-store")),R=(te(e("./lib/stores/read-only-network-store")),te(e("./migrations"))),M=te(e("./lib/migrator")),L=e("./lib/update-remote-feature-flags"),y=te(e("./platforms/extension")),w=e("./constants/sentry-state"),D=ee(e("./lib/notification-manager")),k=ee(e("./metamask-controller")),U=te(e("./lib/getObjStructure")),x=te(e("./lib/ens-ipfs/setup")),F=e("./lib/util"),G=e("./offscreen"),V=e("./lib/stream-utils"),B=te(e("./first-time-state")),j=e("./on-update"),Y=e("./constants/marketing-site-whitelist"),K=e("./constants/stream"),H=e("./constants/snaps"),X=e("./lib/extension-lazy-listener/extension-lazy-listener"),q=e("./lib/deep-links/deep-link-router"),z=e("./lib/deep-links/metrics"),W=e("./lib/safe-reload"),$=e("./lib/start-up-errors/start-up-errors"),Z=e("./lib/CronjobControllerStorageManager"),J=e("./lib/createHyperliquidReferralMiddleware");function Q(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Q=function(e){return e?r:t})(e)}function ee(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=Q(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}function te(e){return e&&e.__esModule?e:{default:e}}const re=globalThis.stateHooks.lazyListener??new X.ExtensionLazyListener(a.default),se="#0376C9",ne="#D73847",ae=9,oe=new b.default,ie=new C.PersistenceManager({localStore:oe}),{update:le,requestSafeReload:ce}=(0,W.getRequestSafeReload)(ie);global.stateHooks.getMostRecentPersistedState=()=>ie.mostRecentRetrievedState,global.logEncryptedVault=()=>{ie.logEncryptedVault()};const{sentry:de}=global;let pe={...B.default};const ue={[p.ENVIRONMENT_TYPE_POPUP]:!0,[p.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[p.ENVIRONMENT_TYPE_FULLSCREEN]:!0},fe=["trezor-connect"];n.default.setLevel("info",!1);const Ee=new y.default,ge=new D.default,me=(0,F.getPlatform)()===p.PLATFORM_FIREFOX;let _e=0,he=!1,Ae=!1,Te=!1;const Ie={},Pe={};let Oe;const Se={},Ne={};const ve=new URL("https://metamask.github.io/phishing-warning/v5.1.0/"),Ce=ve.toString();let be,Re,Me;function Le(){const e=(0,c.withResolvers)();be=e.promise,Re=e.resolve,Me=e.reject}re.once("runtime","onInstalled").then(e=>{!async function([e]){if("install"===e.reason)n.default.debug("First install detected"),ze(),Ee.openExtensionInBrowser();else if("update"===e.reason){const{previousVersion:t}=e;if(!t||t===Ee.getVersion())return;await be,(0,j.onUpdate)(Oe,Ee,t,ce)}}(e),async function(){await be,await(0,v.initSidePanelContextMenu)(Oe)}()}),Le();let ye,we,De,ke;const Ue=new N.CorruptionHandler,xe=async e=>{try{e.postMessage({data:{method:f.BACKGROUND_LIVENESS_METHOD},name:"background-liveness"})}catch(e){return void n.default.error("MetaMask - background-liveness check: Failed to message to port",e)}try{await be,ye(e)}catch(r){if(null==de||de.captureException(r),(0,I.isStateCorruptionError)(r))await Ue.handleStateCorruptionError({port:e,error:r,database:ie,repairCallback:async e=>{Le(),(0,N.hasVault)(e)?(await We(e),Oe.onboardingController.setFirstTimeFlowType(d.FirstTimeFlowType.restore)):(await ie.reset(),await We(null))}});else{var t;const s=(0,o.isObject)(r)?{message:r.message??"Unknown error",name:r.name??"UnknownError",stack:r.stack}:{message:String(r),name:"UnknownError",stack:""};(0,$.tryPostMessage)(e,O.DISPLAY_GENERAL_STARTUP_ERROR,{error:s,currentLocale:null===(t=Oe)||void 0===t||null===(t=t.preferencesController)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.currentLocale})}}},Fe=()=>{re.addListener("runtime","onConnect",xe)};function Ge(){const e=(new Date).toISOString();a.default.storage.session.set({timestamp:e})}async function Ve(e){const t=m.isManifestV3?(0,G.createOffscreen)():null,r=await je(e),s=r.data,o=await(0,P.default)();let i;if(m.isManifestV3){var l;if(!1!==(null===(l=s.PreferencesController)||void 0===l?void 0:l.enableMV3TimestampSave)){const e=2e3;Ge(),setInterval(Ge,e)}const e=await a.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);i=(null==e?void 0:e.isFirstMetaMaskControllerSetup)===undefined,await a.default.storage.session.set({isFirstMetaMaskControllerSetup:i})}const c={},d=await async function(){const e=(0,T.default)(),t=H.PREINSTALLED_SNAPS_URLS.map(async t=>{const r=await e(t);if(t.pathname.endsWith(".json.gz")){const e=new DecompressionStream("gzip"),t=r.body.pipeThrough(e);return await new Response(t).json()}return await r.json()});return Promise.all(t)}(),p=new Z.CronjobControllerStorageManager;await p.init(),Xe(s,o,c,i,r.meta,t,d,p),Oe.store.on("update",le),Oe.store.on("error",e=>{n.default.error("MetaMask controller.store error:",e),null==de||de.captureException(e)}),function(e){async function t(e,t){try{const r=await a.default.tabs.get(e);return!(r.url&&r.url.startsWith("https://www.google.com/search")||(await a.default.tabs.update(e,{url:t}),0))}catch(e){return null==de||de.captureException(e),!1}}const r=!m.isManifestV3;a.default.webRequest.onBeforeRequest.addListener(s=>{var n,o,i;if(s.tabId===a.default.tabs.TAB_ID_NONE)return{};const{completedOnboarding:l}=e.onboardingController.state;if(!l)return{};if(!e.preferencesController.state.usePhishDetect)return{};if(s.initiator&&"null"!==s.initiator&&new URL(s.initiator).host===ve.host)return{};const{hostname:c,href:d,searchParams:p}=new URL(s.url);e.phishingController.maybeUpdateState();const u=e.phishingController.isBlockedRequest(s.url);let f,g;if("main_frame"!==s.type&&"sub_frame"!==s.type||(f=e.phishingController.test(s.url)),!(null!==(n=f)&&void 0!==n&&n.result||u.result))return{};let m,_=d;null!==(o=f)&&void 0!==o&&o.result&&u.result?g=`${f.type} and ${u.type}`:null!==(i=f)&&void 0!==i&&i.result?g=f.type:(g=u.type,_=s.initiator);try{m=new URL(_).hostname}catch{m=c,_=d}const h=new URLSearchParams({hostname:m,href:_}),A=new URL(Ce);A.hash=h.toString();const T=A.toString(),I=()=>{me||e.metaMetricsController.trackEvent({event:E.MetaMetricsEventName.PhishingPageDisplayed,category:E.MetaMetricsEventCategory.Phishing,properties:{url:_,referrer:{url:_},reason:g,requestDomain:u.result?c:undefined}},{excludeMetaMetricsId:!0})};return r?"main_frame"===s.type?(I(),{redirectUrl:T}):(t(s.tabId,T).then(e=>{e&&I()}),{cancel:!0}):(t(s.tabId,T).then(e=>{e&&I()}),{})},{urls:["http://*/*","https://*/*","ws://*/*","wss://*/*"]},r?["blocking"]:[])}(Oe),m.isManifestV3||await async function(){let e;try{const t=new URL(Ce);let r,s;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const n=new Promise((e,t)=>{r=e,s=t});e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout(()=>s(new Be),1e3),await n}catch(e){e instanceof Be?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await(async()=>{const e=await a.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then(e=>((0,g.checkForLastErrorAndLog)(),e)).catch(()=>{(0,g.checkForLastErrorAndLog)()});for(const t of e)a.default.tabs.sendMessage(t.id,{name:u.EXTENSION_MESSAGES.READY}).then(()=>{(0,g.checkForLastErrorAndLog)()}).catch(()=>{(0,g.checkForLastErrorAndLog)()})})(),new q.DeepLinkRouter({getExtensionURL:Ee.getExtensionURL,getState:Oe.getState.bind(Oe)}).on("navigate",async({url:e,parsed:t})=>{"redirectTo"in t||await Oe.metaMetricsController.trackEvent((0,z.createEvent)({signature:t.signature,url:e}))}).on("error",e=>null==de?void 0:de.captureException(e)).install()}Fe(),a.default.runtime.onConnectExternal.addListener(async(...e)=>{await be,we(...e)});class Be extends Error{constructor(){super("Timeout failed")}}async function je(e){var t,r;let s;if(e){s={data:{},meta:{}};for(const t of C.backedUpStateKeys)(0,o.hasProperty)(e,t)&&(s.data[t]=e[t]);(0,o.hasProperty)(e,"meta")&&(0,o.isObject)(e.meta)&&(s.meta=e.meta),"number"!=typeof s.meta.version&&(n.default.error("The `backup`'s `meta.version` property was missing during backup restore."),s.meta.version=155)}else{const e=!0;s=await ie.get({validateVault:e})}const a=new M.default({migrations:R.default,defaultVersion:null});a.on("error",e=>{console.warn(e);const t=(0,U.default)(s);de.captureException(e,{extra:{vaultStructure:t}})}),null!==(t=s)&&void 0!==t&&t.data||null!==(r=s)&&void 0!==r&&r.meta||(s=a.generateInitialState(pe));const i=await a.migrateData(s);if(!i)throw new Error("MetaMask - migrator returned undefined");if(!(0,o.isObject)(i.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof i.meta}'`);if("number"!=typeof i.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof i.meta.version}'`);if(!(0,o.isObject)(i.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof i.data}'`);return ie.setMetadata(i.meta),await ie.set(i.data),i}function Ye(e){const{metaMetricsId:t}=Oe.metaMetricsController.state;if(!(0,F.shouldEmitDappViewedEvent)(t))return;const r=Oe.getPermittedAccounts(e).length;if(0===r)return;const s=Oe.controllerMessenger.call("PreferencesController:getState"),n=Object.keys(s.identities).length;Oe.metaMetricsController.trackEvent({event:E.MetaMetricsEventName.DappViewed,category:E.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:n,number_of_accounts_connected:r}},{excludeMetaMetricsId:!0})}function Ke(e){var t,r,s;if(null===(t=e.sender)||void 0===t||!t.tab||null===(r=e.sender)||void 0===r||!r.url||null===(s=e.sender)||void 0===s||null===(s=s.tab)||void 0===s||!s.url)return;const n=e.sender.tab.id,a=new URL(e.sender.url),{origin:o}=a,i=new URL(e.sender.tab.url),{origin:l}=i;Object.keys(Se).includes(n)||(Se[n]=o),n in Ne||(Ne[n]=l);const c=Oe.controllerMessenger.call("PermissionController:hasPermissions",o),d="New Tab"!==e.sender.tab.title;c&&d&&Ye(o)}function He(e){const t=[p.ENVIRONMENT_TYPE_POPUP,p.ENVIRONMENT_TYPE_NOTIFICATION,p.ENVIRONMENT_TYPE_FULLSCREEN];!(Object.values(Ie).some(Boolean)||he||_e>0)&&t.includes(e)&&function(){const{metaMetricsId:e,participateInMetaMetrics:t}=Oe.metaMetricsController.state;(null!==e||t)&&Oe.metaMetricsController.trackEvent({event:E.MetaMetricsEventName.AppOpened,category:E.MetaMetricsEventCategory.App})}()}function Xe(e,t,r,n,o,c,d,u){var f;Oe=new k.default({infuraProjectId:globalThis.INFURA_PROJECT_ID,showUserConfirmation:qe,initState:e,initLangCode:t,platform:Ee,notificationManager:ge,browser:a.default,getRequestAccountTabIds:()=>Pe,getOpenMetamaskTabsIds:()=>Ie,overrides:r,isFirstMetaMaskControllerSetup:n,currentMigrationVersion:o.version,featureFlags:{},offscreenPromise:c,preinstalledSnaps:d,requestSafeReload:ce,cronjobControllerStorageManager:u}),(0,x.default)({getCurrentChainId:()=>(0,h.getCurrentChainId)({metamask:Oe.networkController.state}),getIpfsGateway:Oe.preferencesController.getIpfsGateway.bind(Oe.preferencesController),getUseAddressBarEnsResolution:()=>Oe.preferencesController.state.useAddressBarEnsResolution,provider:Oe.provider}),f=Oe,global.stateHooks.getSentryAppState=function(){const e=f.memStore.getState();return(0,_.maskObject)(e,w.SENTRY_BACKGROUND_STATE)};const g=()=>_e>0||Boolean(Object.keys(Ie).length)||he||Te||!1,T=(e,t)=>{if(!1===e)Oe.onClientClosed();else{if(t===p.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(Ie).length))return;Oe.onEnvironmentTypeClosed(t)}};function I(e,t){return e>t?`${t}+`:String(e)}function P(){const e=O(),t=function(){try{const{isNotificationServicesEnabled:e,isFeatureAnnouncementsEnabled:t}=Oe.notificationServicesController.state,r=Object.values(Oe.notificationServicesController.state.metamaskNotificationsList).filter(e=>e.type===i.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP&&null===e.readDate).length,s=t?Oe.notificationServicesController.state.metamaskNotificationsList.filter(e=>!e.isRead&&e.type===i.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT).length:0,n=e?Oe.notificationServicesController.state.metamaskNotificationsList.filter(e=>!e.isRead&&e.type!==i.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT&&e.type!==i.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP).length:0;return r+s+n}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let r="",s=se;e?r=I(e,ae):t>0&&(r=I(t,ae),s=ne);try{const e={text:r},t={color:s};m.isManifestV3?(a.default.action.setBadgeText(e),a.default.action.setBadgeBackgroundColor(t)):(a.default.browserAction.setBadgeText(e),a.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function O(){try{return Oe.appStateController.waitingForUnlock.length+Oe.approvalController.getTotalApprovalCount()}catch(e){return console.error("Failed to get pending approval count:",e),0}}ye=e=>{var t;const n=e.name;if(fe.includes(e.name))return;let o=!1;const i=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(o=me?ue[n]:(null==i?void 0:i.origin)===`chrome-extension://${a.default.runtime.id}`,o){var c;const t=(null==r||null===(c=r.getPortStream)||void 0===c?void 0:c.call(r,e))||new l.ExtensionPortStream(e),a=function({chunkSize:e}){Oe.metaMetricsController.trackEvent({event:E.MetaMetricsEventName.PortStreamChunked,category:E.MetaMetricsEventCategory.PortStream,properties:{chunkSize:e}})};if(e.onDisconnect.addListener(()=>t.off("message-too-large",a)),t.on("message-too-large",a),Oe.isClientOpen=!0,Oe.setupTrustedCommunication(t,e.sender),He(n),(0,L.updateRemoteFeatureFlags)(Oe),n===p.ENVIRONMENT_TYPE_POPUP&&(_e+=1,(0,s.finished)(t,()=>{_e-=1;const e=g();Oe.isClientOpen=e,T(e,p.ENVIRONMENT_TYPE_POPUP)})),n===p.ENVIRONMENT_TYPE_SIDEPANEL&&(Te=!0,(0,s.finished)(t,()=>{Te=!1;const e=g();Oe.isClientOpen=e,T(e,p.ENVIRONMENT_TYPE_SIDEPANEL)})),n===p.ENVIRONMENT_TYPE_NOTIFICATION&&(he=!0,(0,s.finished)(t,()=>{he=!1;const e=g();Oe.isClientOpen=e,T(e,p.ENVIRONMENT_TYPE_NOTIFICATION)})),n===p.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;Ie[r]=!0,(0,s.finished)(t,()=>{delete Ie[r];const e=g();Oe.isClientOpen=e,T(e,p.ENVIRONMENT_TYPE_FULLSCREEN)})}}else if(i&&i.origin===ve.origin&&i.pathname===ve.pathname){var d;const t=(null==r||null===(d=r.getPortStream)||void 0===d?void 0:d.call(r,e))||new l.ExtensionPortStream(e,{chunkSize:0});Oe.setupPhishingCommunication({connectionStream:t})}else{var u;if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:s}=r;Ke(e),e.onMessage.addListener(e=>{e.data&&e.data.method===p.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(Pe[s]=t)})}if(i&&Y.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some(e=>e===i.origin)){var f;const t=(null==r||null===(f=r.getPortStream)||void 0===f?void 0:f.call(r,e))||new l.ExtensionPortStream(e,{chunkSize:0});Oe.setUpCookieHandlerCommunication({connectionStream:t})}const t=(null==r||null===(u=r.getPortStream)||void 0===u?void 0:u.call(r,e))||new l.ExtensionPortStream(e,{chunkSize:0});if(De(t,e.sender),me||!m.isManifestV3){const r=(0,V.setupMultiplex)(t);r.ignoreStream(K.METAMASK_EIP_1193_PROVIDER),ke(r.createStream(K.METAMASK_CAIP_MULTICHAIN_PROVIDER),e.sender)}}},we=e=>{var t;const s=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new l.ExtensionPortStream(e,{chunkSize:0});if(!e.sender.id){if(fe.includes(e.name))return;Ke(e),ke((0,A.createCaipStream)(s),e.sender)}else De(s,e.sender)},De=(e,t)=>{Oe.setupUntrustedCommunicationEip1193({connectionStream:e,sender:t})},ke=(e,t)=>{Oe.setupUntrustedCommunicationCaip({connectionStream:e,sender:t})},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(ye,De),P(),Oe.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.DECRYPT_MESSAGE_MANAGER_UPDATE_BADGE,P),Oe.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.ENCRYPTION_PUBLIC_KEY_MANAGER_UPDATE_BADGE,P),Oe.signatureController.hub.on(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,P),Oe.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.APP_STATE_UNLOCK_CHANGE,P),Oe.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,P),Oe.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,P),Oe.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,P),ge.on(D.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,({automaticallyClosed:e})=>{e?O()>0&&qe():(Oe.signatureController.rejectUnapproved(E.REJECT_NOTIFICATION_CLOSE_SIG),Oe.decryptMessageController.rejectUnapproved(E.REJECT_NOTIFICATION_CLOSE),Oe.encryptionPublicKeyController.rejectUnapproved(E.REJECT_NOTIFICATION_CLOSE),Oe.rejectAllPendingApprovals()),P()})}async function qe(){const e=await Ee.getActiveTabs(),t=Boolean(e.find(e=>Ie[e.id])),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!Ae&&(r||0===_e)&&!t&&!Te){Ae=!0;try{const e=Oe.appStateController.getCurrentPopupId();await ge.showPopup(e=>Oe.appStateController.setCurrentPopupId(e),e)}finally{Ae=!1}}}const ze=()=>{if(Oe)return Oe.metaMetricsController.updateTraits({[E.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void Oe.metaMetricsController.addEventBeforeMetricsOptIn({category:E.MetaMetricsEventCategory.App,event:E.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout(()=>{ze()},500)};a.default.runtime.onUpdateAvailable.addListener(async function(){await be,n.default.debug("An update is available"),Oe.appStateController.setIsUpdateAvailable(!0)});(async()=>{var e;if("true"===(null===(e=!1)?void 0:e.toString())&&null!==a.default&&void 0!==a.default&&a.default.sidePanel)try{var t,r,s;await be;const e=(null===(t=Oe)||void 0===t||null===(t=t.preferencesController)||void 0===t||null===(t=t.state)||void 0===t||null===(t=t.preferences)||void 0===t?void 0:t.useSidePanelAsDefault)??!1;null!==a.default&&void 0!==a.default&&null!==(r=a.default.sidePanel)&&void 0!==r&&r.setPanelBehavior&&await a.default.sidePanel.setPanelBehavior({openPanelOnActionClick:e}),null===(s=Oe)||void 0===s||null===(s=s.controllerMessenger)||void 0===s||s.subscribe("RemoteFeatureFlagController:stateChange",e=>{var t;var r;!1===(null==e||null===(t=e.remoteFeatureFlags)||void 0===t?void 0:t.extensionUxSidepanel)&&(null===(r=Oe)||void 0===r||null===(r=r.preferencesController)||void 0===r||r.setUseSidePanelAsDefault(!1))})}catch(e){console.error("Error setting side panel behavior:",e)}})();async function We(e){a.default.tabs.onActivated.addListener(e=>{if(Oe){const{tabId:t}=e,r=Se[t],s=Ne[t];r&&Oe.permissionController.state.subjects[r]!==undefined&&Ye(r),s===S.HYPERLIQUID_ORIGIN&&Oe.permissionController.state.subjects[s]!==undefined&&Oe.handleHyperliquidReferral(t,J.HyperliquidPermissionTriggerType.OnNavigateConnectedTab).catch(e=>{n.default.error("Failed to handle Hyperliquid referral after navigation to connected tab: ",e)})}});try{await Ve(e),ie.cleanUpMostRecentRetrievedState(),n.default.info("MetaMask initialization complete."),Re()}catch(e){n.default.error(e),Me(e)}}(async()=>{var e;if("true"===(null===(e=!1)?void 0:e.toString())&&null!==a.default&&void 0!==a.default&&a.default.sidePanel)try{var t;await be,null===(t=Oe)||void 0===t||null===(t=t.controllerMessenger)||void 0===t||t.subscribe("PreferencesController:stateChange",e=>{var t,r;const s=(null==e||null===(t=e.preferences)||void 0===t?void 0:t.useSidePanelAsDefault)??!1;null!==a.default&&void 0!==a.default&&null!==(r=a.default.sidePanel)&&void 0!==r&&r.setPanelBehavior&&a.default.sidePanel.setPanelBehavior({openPanelOnActionClick:s}).catch(e=>console.error("Error updating panel behavior:",e))})}catch(e){console.error("Error setting up preference listener:",e)}})(),a.default.tabs.onActivated.addListener(async({tabId:e})=>{if(await be,!Oe)return{};try{const t=await a.default.tabs.get(e),{id:r,title:s,url:n,favIconUrl:o}=t;if(!n)return{};const{origin:i,protocol:l,host:c,href:d}=new URL(n);if(!i||"null"===i||i.startsWith("chrome-extension://")||i.startsWith("moz-extension://"))return{};Oe.appStateController.setAppActiveTab({id:r,title:s,origin:i,protocol:l,url:n,host:c,href:d,favIconUrl:o}),Oe.subjectMetadataController.addSubjectMetadata({origin:i,name:s||c||i,iconUrl:o||null,subjectType:"website"})}catch(e){console.log("Error in tabs.onActivated listener:",e.message)}return{}}),a.default.tabs.onUpdated.addListener(async e=>{if(await be,!Oe)return{};try{const t=await a.default.tabs.get(e),{id:r,title:s,url:n,favIconUrl:o}=t;if(!n)return{};const{origin:i,protocol:l,host:c,href:d}=new URL(n);if(!i||"null"===i||i.startsWith("chrome-extension://")||i.startsWith("moz-extension://"))return{};Oe.appStateController.setAppActiveTab({id:r,title:s,origin:i,protocol:l,url:n,host:c,href:d,favIconUrl:o}),Oe.subjectMetadataController.addSubjectMetadata({origin:i,name:s||c||i,iconUrl:o||null,subjectType:"website"})}catch(e){console.log("Error in tabs.onUpdated listener:",e.message)}return{}}),We(null)}}},{package:"$root$",file:"app/scripts/background.js"}]],[9],{});