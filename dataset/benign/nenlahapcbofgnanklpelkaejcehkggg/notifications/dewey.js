import{a as F}from"../chunks/chunk-XADZVW2N.js";import{a as R,b as C}from"../chunks/chunk-N2ICXIKO.js";import"../chunks/chunk-JDXM4SX2.js";import{a as L}from"../chunks/chunk-CQXN2NRJ.js";import{a as K}from"../chunks/chunk-UW4IVTWM.js";import{a as A}from"../chunks/chunk-6ILBPYHJ.js";import{a as M,m as N,n as q}from"../chunks/chunk-V32PIZDK.js";import{a as V}from"../chunks/chunk-3SM435XU.js";import"../chunks/chunk-5MNKLLPH.js";import"../chunks/chunk-IQFNOK3G.js";import"../chunks/chunk-WJZEHHRO.js";import"../chunks/chunk-HPSGHK7L.js";import"../chunks/chunk-GXPO46BF.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-XZWN3GGK.js";import"../chunks/chunk-2Q63MOXU.js";import"../chunks/chunk-DPMK7ZVG.js";import"../chunks/chunk-D3B67B3M.js";import"../chunks/chunk-H6FSK4DZ.js";import"../chunks/chunk-TYA5STFG.js";import"../chunks/chunk-2GAAOKGQ.js";import{p as x}from"../chunks/chunk-KJBXKQ52.js";import{a as k,b as _,g as P,h as g,n as u,o as S,q as U,v as O}from"../chunks/chunk-4XUWKJYA.js";import"../chunks/chunk-VWGTEQCV.js";import"../chunks/chunk-54ERVKKM.js";import"../chunks/chunk-VM2OHO33.js";import"../chunks/chunk-74K3EJN3.js";import"../chunks/chunk-W7K6NY26.js";import"../chunks/chunk-QWQLNDJC.js";import"../chunks/chunk-WXGZPSEB.js";import"../chunks/chunk-K2PA57PF.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{c as E}from"../chunks/chunk-AYDLOBCW.js";import{a as f,c as H}from"../chunks/chunk-JENJKWHP.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-WO6N5TBT.js";import"../chunks/chunk-BTBTC4NL.js";import{e as D}from"../chunks/chunk-3GYLW4KZ.js";var v=D(U()),i=D(E());var p=D(E());H();var z=(e,o,t)=>V("deweyPriceComparisonWithoutNotif",{priceComparisonKey:e,product:o,pageData:t});var w,T,W=250,Y=2500;function j(e){return e.url}async function G(e){let o=e?.pageTypeBehaviors,s=(Array.isArray(o?.notifPlacementSelectors)?o.notifPlacementSelectors:[]).map(({value:n})=>n);return{runOptions:{input:{}},buttonShouldMountInline:!!s.length,findElementToInsertAfter:()=>{for(let n of s){let r=document.querySelector(n);if(r)return r}},showNotification:o?.showNotification,priceThresholdCents:o?.deweyPCThreshold||Y}}function J(e,o){return e.price?M(e.price,o,"disable_universal_price_run")?!1:{priceComparisonKey:j(e)}:(f("Dewey PC - unable to retrieve the origin product price."),!1)}function B(e){try{T||(T=p.default.debounce(Q,W)),T(e)}catch(o){f(o)}}async function Q(e){try{if(!(!F()&&u("dewey_price_comparison")&&p.default.get(e,"pageTypeBehaviors.deweyPC",!1))||p.default.get(e,"domain")==="amazon.com")return;let t=p.default.cloneDeep(p.default.get(e,"pageData.products[0]",{}));t.vendor=p.default.get(e,"domain"),t.price=t.list_price,t.mpn=t.manufacturer_number,delete t.list_price,delete t.manufacturer_number;let s=e.pageType,n=await G(e),r=J(t,n?.priceThresholdCents);if(!n?.showNotification)return u("dewey_price_comparison_silent")&&r&&z(r.priceComparisonKey,t,{pageViewId:g.get("pageViewId"),pageType:s});if(!r){w="",x(N);return}let{priceComparisonKey:a}=r;if(a===w){f(`*** Skipping dewey price comparison already in progress for request - ${a} ***`);return}f(`*** Starting dewey price comparison. Request - ${a} ***`),w=a,n.runOptions.input.product=t,p.default.set(n.runOptions.input,"meta.conquestOrigin",!0),p.default.set(n.runOptions.input,"meta.simpleOriginPricing",!0),p.default.set(n.runOptions.input,"deweyPC",!0);let c=n.findElementToInsertAfter(),m=u("retail_pc_non_amazon_best_result");await q({insertAfterElement:c,removeExistingApp:!0,additionalClass:m?"best-deal":""},{...n.runOptions,buttonNotMountedInline:n.buttonShouldMountInline&&!c,pageType:s,isFloatingNotif:u("price_comparison_floating_notif_non_amz"),isBestDealNotif:m,runCompleteCb:()=>{w&&w===a&&(w="",f(`*** Request - ${a} - completed ***`,"*** Active Dewey price comparison was reset. ***"))}})}catch(o){f(o)}}var I=e=>(B(e),O("deweyResult",e));window.__wb_timing.deweyRequireAt=performance.now();async function X(){await Promise.all([A(),L()]).then(([e,o])=>{K(e),g.merge({siteAPIData:o})}),u("ext_instant_init_notifs")||document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b)}async function b(){let e=g.get("siteAPIData"),o=i.default.get(e,"tld");_(o),e=await Z(e)||e;let t=i.default.cloneDeep(e);t.document=document,function(l){let a=l.fn.find;l.fn.find=function(c){return c===":self"?this:a.call(this,c)}}(v.default),t.document.deweyParser=v.default,t.document.html=document.documentElement.innerHTML,i.default.set(t,"siteData.tld",t.tld),C.setDefaultConfig(t);let s=u("log_all_dewey"),n=new Date,r=new Set(i.default.map(i.default.get(e,"siteData.tigger.coupons")||i.default.get(e,"siteData.roo.coupons")||[],"code"));C.emitter.on("result",async l=>{let a=l?.pageType,c=!1,m=await R(l);if(m.callSource==="internal"&&(g.set(["deweyResult"],m),I(m),a||s)){let d=new Date-n,y=i.default.cloneDeep(m);y&&y.pageData&&y.pageData.meta&&(y.pageData.meta=[y.pageData.meta]);let $=!c&&a!=="sponsoredProductsPage"?void 0:{anonymized:c,skipAllowlistCheck:a==="sponsoredProductsPage",skipSendingPageContextData:a==="sponsoredProductsPage"};S("track","deweyResult",i.default.assign({},y,{flags:i.default.get(e,"siteData.flags"),logAllDewey:s,totalTimeElapsed:d,deweyAttempt:C.startAttempt,emailId:g.get("emailId")}),$)}i.default.get(m,"pageData.coupons.length")&&i.default.forEach(m.pageData.coupons,d=>{r.has(d)||(S("track","codeApplied",{code:d,currentLocation:i.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),r.add(d))})}),C.start()}async function h(e,o){return await P({message:"getPlatformIdentifiers",platformForIdentifiers:e,platformPageTypeForIdentifiers:o})}async function Z(e){let o=i.default.get(e,"siteData.coupons.type"),[t,s=k()]=await Promise.all([P({message:"getPlatform"}),P({message:"getPlatformDomain"})]);if(t&&s){_(s),e=i.default.has(e,"siteData.tigger")?e:{...e,siteData:{...e.siteData,tigger:{}}},e.siteData.tigger[`${t.toLowerCase()}`]=!0,e.siteData.pageTypesV2=e.siteData.pageTypesV2||{};let{cartPage:n,checkoutPage:r,confirmationPage:l}=e.siteData.pageTypesV2;new Set(["Magento","WooCommerce","BigCommerce","Squarespace"]).has(t)?(t==="Magento"&&(e.siteData.pageTypesV2.cartPage=n||await h(t,"cartPage")),e.siteData.pageTypesV2.checkoutPage=r||await h(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=l||await h(t,"confirmationPage")):(e.siteData.pageTypesV2.checkoutPage=await h(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=await h(t,"confirmationPage"));let c=await h(t,"roo");return c&&o!=="roo"&&(e.siteData.roo=c),e}}X();
