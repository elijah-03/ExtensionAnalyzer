import{a as k}from"../../../../chunks/chunk-U4SHFVNS.js";import{a as S,c as L}from"../../../../chunks/chunk-E335IO74.js";import{a as y}from"../../../../chunks/chunk-VCPNQHGQ.js";import{a as p}from"../../../../chunks/chunk-LRFMKSKN.js";import{a as R}from"../../../../chunks/chunk-BCG2KUGW.js";import{h as T,o as f}from"../../../../chunks/chunk-4XUWKJYA.js";import"../../../../chunks/chunk-VM2OHO33.js";import"../../../../chunks/chunk-QWQLNDJC.js";import"../../../../chunks/chunk-AYDLOBCW.js";import"../../../../chunks/chunk-JENJKWHP.js";import"../../../../chunks/chunk-53OM6ECF.js";import"../../../../chunks/chunk-PDIOZR2P.js";import"../../../../chunks/chunk-BTBTC4NL.js";import"../../../../chunks/chunk-3GYLW4KZ.js";async function l(e,t={}){let n=await $();f("track",e,{...t,competitor:"pie",url:location.href,detectedExtensions:n})}function U(e){return/%s/.test(e)&&(e=e.replace(/%/,"% ")),/blocked\d/.test(e)&&(e=e.replace("blocked","blocked ")),e}function s(e,t,n){let o=t?.textContent?.trim()?.replace(/[\t\n\r\s]+/gm," ");l("pieNotification",{name:e,ctaText:U(o),...n})}function d(e){return e?.textContent?.trim()?.replace(/[\t\n\r\s]+/gm," ")||""}function b(e,t){return[...e].find(n=>t.test(n.innerHTML))}function P(e){return b(e,/Apply Coupons/i)}function A(e){return b(e,/activate up|cash back/i)}function M(e){return b(e,/rewards/i)}function N(e){return b(e,/pie shopping/i)}function w(e){let t=e.textContent?.trim();return t||(t=e.getAttribute("aria-label")||""),!t&&e.localName==="img"&&(t=e.src),t||(t=e.querySelector("img")?.src||""),t||""}function x(e,t,n=5){let o=e,r=0;for(t=t.toLowerCase();o&&r<n;){if(o.localName===t||o.getAttribute("type")===t)return o;o=o.parentElement,r++}return null}async function O(e){let t=`chrome-extension://${e}/assets/page/suppressAlert.js`;try{if((await fetch(t,{method:"GET"})).ok)return!0}catch{}return!1}var C;async function _(){return C===void 0&&(C=await O("jpkfgepcmmchgfbjblnodjhldacghenp")),C}var E;async function G(){return E===void 0&&(E=await O("nfadicbbecgbdbgbibgflooojfbolpgk")),E}async function $(){let e=await _(),t=await G();return e&&t?"shopping|adblock":e?"adblock":t?"shopping":"unknown"}var m;async function z(){let e=m?.querySelector('#root > div[class*="pie-notification-"]:empty');if(m){let t=m.querySelector('#root > div[class*="pie-notification-"] div[class*="pie-notification-"]'),n=[...m.querySelectorAll('#root > div[class*="pie-notification-"] div[class*="pie-notification-"]')].find(o=>{if(typeof o.textContent=="string")return/%[\n.\s]*.+saved/i.test(o.textContent)});n&&!e?s("adBlocked",n):t&&!e&&s("oval",t)}}async function J(){p(()=>{let t=[...document.querySelectorAll('div[style^="all: initial !important;"]')].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(n);return o&&o?.querySelector('style[data-emotion="pie-notification-global"]')&&o?.querySelector('div[class*="pie-notification-"]')});if(t)return t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t)},async e=>{m=e,z()})}async function q(){try{J()}catch{}}var v;async function K(){if(v){let e=[...v.querySelectorAll("p")].find(t=>{if(typeof t.textContent=="string")return/rewards/i.test(t.textContent)});e&&s("adUnblocked",e)}}async function Q(){p(()=>{let t=[...document.querySelectorAll("div")].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(n);return o&&o?.querySelector("#modal_container")});if(t)return t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t)},async e=>{v=e,K()})}async function B(){try{document.querySelector("#pie_logo")&&Q()}catch{}}function H(e){e?.addEventListener("click",t=>{let n=t.target,o=d(e);if(x(n,"button"))return;let i=x(n,"a");if(i){let u=w(i),g=i.getAttribute("href")||"";l("cNotificationClick",{name:"genericClick",label:u,bodyText:g});return}let c=w(n);c&&l("cNotificationClick",{name:"genericClick",label:c,bodyText:o})},!0)}var a,h,X=()=>{try{h&&(h=void 0);let e=a?.querySelectorAll("#root button");return e?.length&&e}catch{return!1}};function Y(e){if(/cash back/i.test(e.innerHTML))return e?.textContent}function I(e){y({action:"endSavingsCheck",comp:"pie"});let t=e.savings&&typeof e.savings=="number"?+e.savings:null,n=typeof h=="number"&&Date.now()-h;f("track","pieTryCouponsResult",{savings:t,cashbackRate:e?.rewards||null,coupons:e?.coupons||[],runTime:n,url:location.href}),L("pie","coupons",()=>T.set(["warnAboutStandDown"],!0))}function Z(){p(X,e=>{let t=P(e);if(t){s("coupon",t,{bodyText:d(a)});let i=t.textContent||void 0,c=k(i);t.addEventListener("click",()=>{h=Date.now(),t&&l("pieTryCoupons",{url:location.href,ctaText:i,cashbackRate:c}),y({action:"initSavingsCheck",comp:"pie"}),S(F,4e4,500,I)})}let n=A(e);if(n){s("cashback",n,{bodyText:d(a)});let i=n.textContent||void 0,c=k(i);n.addEventListener("click",()=>{n&&l("pieActivate",{url:location.href,ctaText:i,cashbackRate:c})})}let o=M(e);if(o){let i=o.textContent||void 0,u=a?.querySelector("#root svg #Vector")?.parentElement?.parentElement,j=u?.parentElement?.nextElementSibling?.querySelector("div")?.textContent||void 0;s("placement",o,{header:j,bodyText:d(a)}),o.addEventListener("click",()=>{if(o){let V=u?.nextElementSibling?.textContent||void 0;l("pieActivate",{name:"placement",ctaText:i,cashbackRate:V})}})}let r=N(e);if(r){let i=r.textContent||void 0;s("addShopping",r,{bodyText:d(a)}),r.addEventListener("click",()=>{r&&l("cNotificationClick",{name:"addShopping",ctaText:i})})}if(!t&&!n&&!o&&!r){let i=e[0],c=i.textContent||void 0;s("unknown",i,{bodyText:d(a),header:i?.parentElement?.querySelector("h2")?.textContent||void 0}),i.addEventListener("click",()=>{i&&l("cNotificationClick",{name:"unknown",ctaText:c,bodyText:d(a)})})}})}async function D(){S(F,4e4,500,I);try{p(()=>{let t=[...document.querySelectorAll('div[style^="all: initial !important;"]')].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(n);return o&&o?.querySelector('style[data-emotion="pie-global"]')&&o?.querySelector('#root > div[class^="pie-"]:not([class^="pie-notification-"])')});if(t)return t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t)},async e=>{a=e,Z(),H(a)})}catch{}}var ee=[()=>{try{if(a){let e=[],t=/Continue to Checkout/i;if(a.innerHTML.match(t)){let o=[...a.querySelectorAll("span")].find(g=>g?.textContent?.includes("Cash Back")),r;o&&(r=Y(o));let i=a?.querySelector('svg[fill="currentColor"]')?.nextElementSibling,c=i?.textContent,u=i?.parentElement?.nextElementSibling?.textContent;return c&&e.push(c),{foundModal:!0,savings:u?R(u):void 0,rewards:r,coupons:e}}}}catch{}return!1}];function F(){let e=!1;return ee.forEach(t=>{let n=t();if(n&&n.foundModal){e=n;return}}),e}function W(){new RegExp("https://(www\\.)?pie.org").test(location.href)&&(te(),ne())}function te(){let e=location.href;setInterval(()=>{location.href!==e&&(chrome.runtime.sendMessage({type:"pageView",url:location.href,referrer:document.referrer,title:document.title}),e=location.href)},500)}function ne(){document.addEventListener("click",e=>{let n=e.target,o=0,r=5;for(;n&&o<r&&!(n.localName==="button"||n.getAttribute("type")==="button");)n=n.parentElement,o++;if(!n||o>=r)return;let i=n.textContent?.trim();i||(i=n.getAttribute("aria-label")||""),!i&&n.localName==="img"&&(i=n.src),i||(i=n.querySelector("img")?.src||""),f("track","cPageClick",{label:i})},!0)}W();D();B();q();
