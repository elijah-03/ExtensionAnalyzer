"use strict";const{Filter:Filter,ActiveFilter:ActiveFilter}=require("filterClasses"),{FilterNotifier:FilterNotifier}=require("filterNotifier"),{FilterStorage:FilterStorage}=require("filterStorage"),{IO:IO}=require("io"),{Prefs:Prefs}=require("prefs"),{SpecialSubscription:SpecialSubscription}=require("subscriptionClasses");Promise.all([FilterNotifier.once("load"),Prefs.untilLoaded]).then((()=>{if(Prefs.data_cleanup_done)return;if(FilterStorage.firstRun)return void(Prefs.data_cleanup_done=!0);let e=[];for(let r in Filter.knownFilters){let i=Filter.knownFilters[r];if(i instanceof ActiveFilter){if(i.disabled){i.disabled=!1;for(let e of i.subscriptions)if(e instanceof SpecialSubscription)for(;;){let r=e.filters.indexOf(i);if(r<0)break;let t=Filter.fromText("! "+i.text);FilterStorage.removeFilter(i,e,r),FilterStorage.addFilter(t,e,r)}}(i.hitCount||i.lastHit)&&e.push(i)}}FilterStorage.resetHitCounts(e);let r=[];for(let e=1;e<100;e++)r.push(`file:patterns-backup${e}.ini`);browser.storage.local.remove(r).then((()=>{Prefs.data_cleanup_done=!0}))}));