"use strict";const{require:require}=ext.backgroundPage.getWindow(),{Filter:Filter}=require("filterClasses"),{FilterStorage:FilterStorage}=require("filterStorage"),{Prefs:Prefs}=require("prefs"),{checkWhitelisted:checkWhitelisted}=require("whitelisting"),{getDecodedHostname:getDecodedHostname}=require("url");let page=null;function onLoad(){ext.pages.query({active:!0,lastFocusedWindow:!0},(e=>{page=e[0],!page||"http:"!=page.url.protocol&&"https:"!=page.url.protocol?document.body.classList.add("local"):require("filterComposer").isPageReady(page)||(document.body.classList.add("nohtml"),require("messaging").getPort(window).on("composer.ready",((e,t)=>{t.page.id==page.id&&document.body.classList.remove("nohtml")}))),page&&(checkWhitelisted(page)&&document.body.classList.add("disabled"),page.sendMessage({type:"composer.content.getState"},(e=>{e&&e.active&&document.body.classList.add("clickhide-active")})))})),document.getElementById("enabled").addEventListener("click",toggleEnabled,!1),document.getElementById("clickhide").addEventListener("click",activateClickHide,!1),document.getElementById("clickhide-cancel").addEventListener("click",cancelClickHide,!1),document.getElementById("options").addEventListener("click",(()=>{ext.showOptions()}),!1);for(let e of document.getElementsByClassName("collapse"))e.addEventListener("click",toggleCollapse,!1),Prefs[e.dataset.option]||document.getElementById(e.dataset.collapsable).classList.add("collapsed")}function toggleEnabled(){if(document.body.classList.toggle("disabled")){let e=getDecodedHostname(page.url).replace(/^www\./,""),t=Filter.fromText("@@||"+e+"^$document");t.subscriptions.length&&t.disabled?t.disabled=!1:(t.disabled=!1,FilterStorage.addFilter(t))}else{let e=checkWhitelisted(page);for(;e;)FilterStorage.removeFilter(e),e.subscriptions.length&&(e.disabled=!0),e=checkWhitelisted(page)}}function activateClickHide(){document.body.classList.add("clickhide-active"),page.sendMessage({type:"composer.content.startPickingElement"}),activateClickHide.timeout=window.setTimeout(ext.closePopup,5e3)}function cancelClickHide(){activateClickHide.timeout&&(window.clearTimeout(activateClickHide.timeout),activateClickHide.timeout=null),document.body.classList.remove("clickhide-active"),page.sendMessage({type:"composer.content.finished"})}function toggleCollapse(e){let t=e.currentTarget;Prefs[t.dataset.option]=!Prefs[t.dataset.option],t.parentNode.classList.toggle("collapsed")}document.addEventListener("DOMContentLoaded",onLoad,!1);