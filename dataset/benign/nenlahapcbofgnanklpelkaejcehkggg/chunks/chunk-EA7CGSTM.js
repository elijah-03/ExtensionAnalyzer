import{a as T}from"./chunk-AGWLSUX4.js";import{c as b,d as O,e as S}from"./chunk-E2GNLB6L.js";import{b as U,f as r,i as q}from"./chunk-VGEMM5MB.js";import{b as h}from"./chunk-GXPO46BF.js";import{a as y,c as _}from"./chunk-XZWN3GGK.js";import{a as x,b as f,e as D}from"./chunk-DPMK7ZVG.js";import{q as N}from"./chunk-KJBXKQ52.js";import{h as a,n as v,o as m,v as c}from"./chunk-4XUWKJYA.js";import{F as k}from"./chunk-K2PA57PF.js";import{c as g}from"./chunk-AYDLOBCW.js";import{a as A,c as F}from"./chunk-JENJKWHP.js";import{e as p}from"./chunk-3GYLW4KZ.js";var P=p(g());F();U();q();var R=t=>c("confirmEmailAddress",t);var I=t=>c("emailCreateAccount",t);var B=t=>c("postCheckoutCreateAccount",t);var V=p(g());function C(t){let e;if(t&&t.responseText)try{e=V.default.get(JSON.parse(t.responseText),"error")}catch{e=null}return e}async function ce(t){try{return await R(t)}catch(e){return{error:C(e)||"There was an error"}}}async function d(t){try{return await I(t)}catch(e){return{error:C(e)||"There was an error"}}}async function se(t){try{return await B(t)}catch(e){return{error:C(e)||"There was an error"}}}var L=p(k()),E;async function J(t,e){switch(b(t,e),t.type){case f.Destroy:a.set("emailCreateAccountVisible",!1);break;case f.NotificationShow:m("track","extEmailCreateAccount",{action:"seen"});break;case f.NotificationDismiss:await d({message:"dismiss"}),m("track","extEmailCreateAccount",{action:"dismissed"}),a.set("emailCreateAccountVisible",!1);break;case f.Custom:t.eventName==="onCreateAccountClick"?(await d({message:"clickedCreateAccount"}),m("track","extEmailCreateAccount",{action:"clicked"})):t.eventName==="onSignInClick"&&(await d({message:"clickedSignIn"}),m("track","extEmailCreateAccount",{action:"signIn"})),a.set("emailCreateAccountVisible",!1),e?.();break}}function K(t){let e=t||a.get(["cashback","reward"]);if(!e)return"Rewards";let n=e.categories||e.estimated?"up to ":"";if(e.type==="percentage")return`${n} ${e.amount/100}% Rewards`;let s=e.tiers?.length?e.tiers[e.tiers.length-1].reward.value:e.amount,o=e.tiers?.length?e.tiers[e.tiers.length-1].spendCents||e.tiers[e.tiers.length-1].spend_cents:e.threshold,i=e.type==="threshold"&&o?h(o,{currency:e.amountCurrency||e.currency}):"",l=e.type==="threshold"&&o?` when you spend ${i}`:"",u=h(s,{currency:e.amountCurrency||e.currency});return`${n+u} Rewards${l}`}async function W(t,e=!1){if(await z(e)){A("*** emailCreateAccount: showing notification");let s=y("email-create-account-block-notification"),o=v("should_use_blocks_service")&&s?await _(s):void 0;if(!o)return;let i=K(t),{user:l,host:u}=await S(),M={rootEl:"div",logLevel:void 0};E?.(),E=(await N({appName:"emailCreateAccountNotification",blankSlate:!0,app:(0,L.jsx)(D,{client:x.DESKTOP_WEB,config:M,content:o,data:{rewardsText:i},host:u,user:l,onEvent:$=>J($,E),onRequest:O})})).unloadApp,a.set("emailCreateAccountVisible",!0)}}async function Y(){let t=await d({message:"getEvents"}),e=P.default.chain(t).pickBy(u=>new Date().valueOf()-new Date(u).valueOf()<2592e6).value(),n=r.clickedSignIn in e&&new Date().valueOf()-new Date(e[r.clickedSignIn]).valueOf()<864e5;if(r.clickedCreateAccount in e&&new Date().valueOf()-new Date(e[r.clickedCreateAccount]).valueOf()<864e5||n)return!0;let o=r.seenEmailCreateAccount1 in e&&r.seenEmailCreateAccount2 in e&&r.seenEmailCreateAccount3 in e,i=new Date(Math.max(new Date(e[r.seenEmailCreateAccount1]||0).valueOf(),new Date(e[r.seenEmailCreateAccount2]||0).valueOf(),new Date(e[r.seenEmailCreateAccount3]||0).valueOf())),l=i&&new Date().valueOf()-i.valueOf()<864e5;return!!(o||l)}async function z(t=!1){A("*** emailCreateAccount: evaluating...");let e=a.get("emailCreateAccountVisible");return T()||e?!1:t?!0:!await Y()}export{ce as a,se as b,W as c,z as d};
