var originalCustomFilters;function cleanCustomFilter(t){var e;backgroundPage.adblockIsPaused()&&((e=t.indexOf("@@"))>=0&&t.splice(e,1),(e=t.indexOf("@@^$document"))>=0&&t.splice(e,1));return t}function onFilterChange(t,e,i,l){if("save"===t&&!0===$("#txtFiltersAdvanced").prop("disabled")){var r=backgroundPage.getUserFilters();r&&r.length&&(originalCustomFilters=cleanCustomFilter(r),$("#txtFiltersAdvanced").val(originalCustomFilters.join("\n")))}}$((function(){$("#tutorlink").attr("href",Utils.getDocLink("filterdoc"));var t=function(){var t="exclude_filters";chrome.storage.local.get(t,(function(t){t.exclude_filters&&($("#txtExcludeFiltersAdvanced").val(t.exclude_filters),$("#divExcludeFilters").show())}))};function e(t){$("#txtFiltersAdvanced").val(t+"\n"+$("#txtFiltersAdvanced").val()),l(),$(".addControls").slideUp()}function i(t){return(t=t.trim().replace(/[\ \,\;\|]+\~?/g,"|~"))&&"~"!=t[0]&&(t="~"+t),t}function l(){var t=$("#txtFiltersAdvanced").val(),e=t.split("\n"),i="";$("#messagecustom").html(i),$("#messagecustom").hide();for(var l=0;!i&&l<e.length;l++){if((n=(n=e[l]).trim()).length>0)(r=parseFilter(n)).error&&(i=translate("customfilterserrormessage",[n,r.error]))}if(i)$("#messagecustom").html(i),$("#messagecustom").show();else{backgroundPage.adblockIsPaused()&&(e.push("@@"),e.push("@@^$document"));for(l=0;l<e.length;l++){if((n=(n=e[l]).trim()).length>0)(r=parseFilter(n)).filter&&FilterStorage.addFilter(r.filter)}if(originalCustomFilters)for(l=0;l<originalCustomFilters.length;l++){var r,n=originalCustomFilters[l];if(-1===e.indexOf(n))if((n=n.trim()).length>0)(r=parseFilter(n)).filter&&FilterStorage.removeFilter(r.filter)}originalCustomFilters=e,function(t){for(var e=t.split("\n"),i={},l=[],r=0;r<e.length;r++){var n=e[r];if(l.indexOf(n)<0&&n.indexOf("##")>-1){l.push(n);var s=n.split("##")[0];i[s]=(i[s]||0)+1}}backgroundPage.updateCustomFilterCountMap(i)}(t),$("#divAddNewFilter").slideDown(),$("#txtFiltersAdvanced").prop("disabled",!0),$("#spanSaveButton").hide(),$("#btnEditAdvancedFilters").show()}}t(),chrome.storage.local.get("custom_filters_errors",(function(t){t.custom_filters_errors&&($("#txtMigrationErrorMessage").val(t.custom_filters_errors),$("#migrationErrorMessageDiv").show(),$("#btnDeleteMigrationErrorMessage").click((function(){chrome.storage.local.remove("custom_filters_errors"),$("#migrationErrorMessageDiv").hide()})))})),$("#txtBlacklist").focus((function(){var t=$("#txtFiltersAdvanced").val().match(/^@@\*\$document,domain\=(~.*)$/m);t&&""==$(this).val()&&$(this).val(t[1])})),$("#btnAddUserFilter").click((function(){var t=$("#txtUserFilterCss").val().trim(),i=$("#txtUserFilterDomain").val().trim();e(".*"==i||"*"==i||""==i?"##"+t:i+"##"+t),$(this).closest(".entryTable").find("input[type='text']").val(""),$(this).prop("disabled",!0)})),$("#btnAddExcludeFilter").click((function(){var t=$("#txtUnblock").val().trim();/^\/.*\/$/.test(t)&&(t+="*"),e("@@"+t+"$document"),$(this).closest(".entryTable").find("input[type='text']").val(""),$(this).prop("disabled",!0)})),$("#btnAddBlacklist").click((function(){var t=i($("#txtBlacklist").val()),r=$("#txtFiltersAdvanced").val().trim()+"\n";r=r.replace(/^@@\*\$document,domain\=~.*\n/m,"").trim(),$("#txtFiltersAdvanced").val(r),t?e("@@*$document,domain="+t):l(),$("#btnAddBlacklist").prop("disabled",!0)})),$("#btnAddUrlBlock").click((function(){var t=$("#txtBlockUrl").val().trim(),i=$("#txtBlockUrlDomain").val().trim();"*"==i&&(i=""),/^\/.*\/$/.test(t)&&(t+="*"),e(""==i?t:t+"$domain="+i),$(this).closest(".entryTable").find("input[type='text']").val(""),$(this).prop("disabled",!0)})),$("#txtBlacklist").bind("input",(function(){var t=i($("#txtBlacklist").val());t&&(t="@@*$document,domain="+t);var e="";$("#messageBlacklist").text(e),$("#messageBlacklist").hide();var l=parseFilter(t);if(l.error)return $("#btnAddBlacklist").prop("disabled",!0),e=translate("customfilterserrormessage",[$("#txtBlacklist").val(),l.error]),$("#messageBlacklist").text(e),void $("#messageBlacklist").show();$("#btnAddBlacklist").prop("disabled",!1)})),$("#divUrlBlock input[type='text']").bind("input",(function(){var t=$("#txtBlockUrl").val().trim(),e=$("#txtBlockUrlDomain").val().trim();"*"==e&&(e=""),e&&(e="$domain="+e);var i=parseFilter(t+e);$("#btnAddUrlBlock").prop("disabled",!!i.error||null)})),$("#divCssBlock input[type='text']").bind("input",(function(){var t=$("#txtUserFilterCss").val().trim(),e=$("#txtUserFilterDomain").val().trim();"*"==e&&(e="");var i=parseFilter(e+"##"+t);$("#btnAddUserFilter").prop("disabled",!!i.error||null)})),$("#divExcludeBlock input[type='text']").bind("input",(function(){var t=$("#txtUnblock").val().trim(),e=parseFilter("@@"+t+"$document");t&&!isSelectorFilter(t)||(e.error=!0),$("#btnAddExcludeFilter").prop("disabled",!!e.error||null)})),$(".entryTable input[type='text']").keypress((function(t){var e=$(this).closest(".entryTable").find("input[type='button']");13!==t.keyCode||e.prop("disabled")||(t.preventDefault(),e.click())})),$("a.controlsLink").click((function(){event.preventDefault();var t=$(this).closest("div").find(".addControls");$(".addControls").not(t).slideUp(),t.slideToggle()})),$("#btnEditAdvancedFilters").click((function(){$("#divAddNewFilter").slideUp(),$(".addControls").slideUp(),$("#txtFiltersAdvanced").prop("disabled",!1),$("#spanSaveButton").show(),$("#btnEditAdvancedFilters").hide(),$("#txtFiltersAdvanced").focus()})),$("#btnEditExcludeAdvancedFilters").click((function(){$("#divAddNewFilter").slideUp(),$(".addControls").slideUp(),$("#txtExcludeFiltersAdvanced").removeAttr("disabled"),$("#spanSaveExcludeButton").show(),$("#btnEditExcludeAdvancedFilters").hide(),$("#txtExcludeFiltersAdvanced").focus()})),$("#btnSaveAdvancedFilters").click(l),$("#btnSaveExcludeAdvancedFilters").click((function(){var e=$("#txtExcludeFiltersAdvanced").val();backgroundPage.ExcludeFilter.setExcludeFilters(e),$("#divAddNewFilter").slideDown(),$("#txtExcludeFiltersAdvanced").attr("disabled","disabled"),$("#spanSaveExcludeButton").hide(),$("#btnEditExcludeAdvancedFilters").show(),t()}));var r=backgroundPage.getUserFilters();r&&r.length&&(originalCustomFilters=cleanCustomFilter(r),$("#txtFiltersAdvanced").val(originalCustomFilters.join("\n"))),optionalSettings&&optionalSettings.show_advanced_options&&!optionalSettings.safari_content_blocking&&$("#divExcludeFilters").show(),optionalSettings&&optionalSettings.safari_content_blocking&&$("#safariwarning").text(translate("contentblockingwarning")).show(),FilterNotifier.addListener(onFilterChange)}));