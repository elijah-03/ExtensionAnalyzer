import{a as de,b as pe,c as S,d as N,e as fe,f as G,g as I,h as O,i as k,j as Q,k as Y,l as U,m as X,n as ye}from"../../chunks/chunk-PU2BTBHE.js";import{D as Z,L as v,S as we,c as he,h as y,n as g}from"../../chunks/chunk-2PV5HFH3.js";import"../../chunks/chunk-JDXM4SX2.js";import{a as ue}from"../../chunks/chunk-UW4IVTWM.js";import{a as me}from"../../chunks/chunk-6ILBPYHJ.js";import"../../chunks/chunk-IYAFYZRF.js";import"../../chunks/chunk-F2BE3OL5.js";import{a as se}from"../../chunks/chunk-2Q63MOXU.js";import{b as ae,c as ce,e as le}from"../../chunks/chunk-D3B67B3M.js";import{a as j}from"../../chunks/chunk-2GAAOKGQ.js";import{q}from"../../chunks/chunk-KJBXKQ52.js";import{n as J,o as F}from"../../chunks/chunk-4XUWKJYA.js";import{c as K,s as He}from"../../chunks/chunk-QWQLNDJC.js";import{E as H,F as D,G as A,H as ie,z as W}from"../../chunks/chunk-K2PA57PF.js";import"../../chunks/chunk-ECXCPAF6.js";import"../../chunks/chunk-CBPLEXH3.js";import{c as oe,d as De}from"../../chunks/chunk-AYDLOBCW.js";import"../../chunks/chunk-JENJKWHP.js";import"../../chunks/chunk-53OM6ECF.js";import"../../chunks/chunk-KUOYBGP4.js";import"../../chunks/chunk-PDIOZR2P.js";import"../../chunks/chunk-WO6N5TBT.js";import"../../chunks/chunk-BTBTC4NL.js";import{e as x}from"../../chunks/chunk-3GYLW4KZ.js";var Me=x(W());ie();var Pe=x(oe());var E=x(W());He();var _e=x(oe()),xe=x(De());ie();var V=x(W());function $(){let[t,i]=(0,V.useState)({width:window.innerWidth,height:window.innerHeight});return(0,V.useEffect)(()=>{function s(){i({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]),t}var ge=x(W());var b=x(D());function ee({getValue:t,hidden:i,wrapperClass:s,children:d,domains:m=[]}){let[l,c]=(0,ge.useState)(!0),e=()=>{c(!1),i()},n=()=>{U(m)};return l?(0,b.jsxs)("div",{className:le(["flex flex-col w-fit justify-center items-start px-4 pt-2 pb-4 border-solid border border-border bg-blue-50",s]),children:[(0,b.jsxs)("div",{className:"flex flex-row h-[50px] items-center justify-start w-full",children:[(0,b.jsx)("div",{className:"flex w-[174px]",children:(0,b.jsx)(j,{showFullLogo:!0,className:"m-0"})}),(0,b.jsxs)("div",{className:"flex flex-row justify-between grow pl-6 border-border border-solid border-l",children:[(0,b.jsx)("div",{className:"font-semibold text-base",children:t("title")}),(0,b.jsx)(ce,{className:"close-icon w-4 h-4 pl-[4px] mr-[7px] cursor-pointer text-neutralsecondary",onClick:e})]})]}),d,(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("span",{className:"font-light italic text-neutralsecondary",children:[t("info_tooltip_content")," ",(0,b.jsx)("span",{className:"italic underline cursor-pointer",onClick:n,children:t("info_tooltip_content_link_text")})]})})]}):null}var r=x(D()),Ee=2,be=30,te=300;function Ae(t){let i=[];return Object.keys(t).forEach(s=>{let d=t[s];d&&typeof d=="object"&&(d.relevant??[]).forEach(l=>{l.link&&i.push({title:l.title||l.description||"",url:l.link.replace("&utm_source=chatgpt.com","").replace("?utm_source=chatgpt.com&","?").replace("?utm_source=chatgpt.com",""),key:l[de]})})}),i}function Fe({offers:t}){let[i]=(0,E.useState)(t),{getValue:s,getRichText:d}=H(Z.AI_SEARCH_CGPT),m=t.map(e=>e.tld);(0,E.useEffect)(()=>{v({name:"cgpt_impression",type:y,subType:g}),setTimeout(()=>{let e=document.querySelector(s("scrollContainer"));e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},500)},[]);let l=(e,n)=>{v({name:"cgpt_click",type:y,subType:g,redirect:!0,label:e.displayName,carouselPosition:n,rewardAmount:e.rewardsRate,meta:e}),window.open(e.href,"_blank","noopener,noreferrer")},c=()=>{let e=K(new Date,{minutes:60}).getTime();X({componentName:"cgpt",throttleValue:e}),v({name:"cgpt_dismiss",type:y,subType:g,redirect:!1,label:"x"})};return i.length<Ee?null:(0,r.jsx)("div",{className:"flex flex-col w-full",children:(0,r.jsx)(ee,{getValue:s,hidden:c,wrapperClass:"w-full",domains:m,children:(0,r.jsx)("div",{className:"w-full overflow-hidden overflow-x-scroll",children:(0,r.jsx)("div",{className:"flex flex-row align-start space-x-4 py-2",children:i.map((e,n)=>(0,r.jsxs)("div",{className:"flex flex-col justify-start items-center border-solid border border-border min-w-[192px] bg-white cursor-pointer hover:border-4 hover:border-primary",onClick:()=>l(e,n),children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-[180px] h-[142px]",children:(0,r.jsx)("img",{className:"max-w-full max-h-full object-contain",src:Y(e.tld)})}),(0,r.jsxs)("div",{className:"w-full text-base self-start space-y border-solid border-t border-gray-150 pt-2 px-2",children:[(0,r.jsx)("div",{children:(0,r.jsx)(A,{items:d({itemName:e.rewardHasPrefix?"prefixed_rewards_text":"rewards_text",parseValues:{displayReward:e.displayReward}})})}),(0,r.jsx)("div",{className:"max-w-[142px] line-clamp-2 h-12",children:(0,r.jsx)(A,{items:d({itemName:"description",parseValues:{merchant:e.displayName}})})})]})]},e.key))})})})})}function Ge({offers:t,chatWidth:i}){let{getValue:s,getRichText:d}=H(Z.AI_SEARCH_CGPT_UR_EMBEDDED),{getSequence:m}=H("llm_scraper_cpt"),l=Q(m,"sidePanel"),[c,e]=(0,E.useState)(!1),[n,T]=(0,E.useState)(0),[h,L]=(0,E.useState)(0),C=$(),R=(0,E.useRef)(document.querySelector(s("headerQuery")));(0,E.useEffect)(()=>{v({name:"cgpt_ur_impression",type:y,subType:g})},[]);function w(){let a=R.current?.clientHeight||0;T(a);let z=((R.current?.clientWidth||0)-i)/2-be;L(z)}(0,E.useEffect)(()=>{c||w()},[C,c]),(0,E.useEffect)(()=>{c||!h||h<te&&(v({name:"cgpt_ur_width_holdout",type:y,subType:g,redirect:!1}),e(!0))},[h,c]),(0,E.useEffect)(()=>{if(!c){let a=setInterval(()=>{let _=window.document.querySelector(l.query);w(),_&&(v({name:"cgpt_ur_auto_dismiss",type:y,subType:g,redirect:!1,label:"sidePanelShown"}),e(!0))},300);return()=>{clearInterval(a)}}},[c]);let u=()=>{e(!0);let a=K(new Date,{minutes:60}).getTime();X({componentName:"cgpt",throttleValue:a}),v({name:"cgpt_ur_dismiss",type:y,subType:g,redirect:!1,label:"x"})},p=(a,_)=>{v({name:"cgpt_ur_click",type:y,subType:g,redirect:!0,label:a.displayName,carouselPosition:_,rewardAmount:a.rewardsRate,meta:a}),window.open(a.href,"_blank","noopener,noreferrer")};function P(){let a=t.map(_=>_.tld);U(a)}let M=a=>{a==="view_terms"&&P()};return c?null:(0,r.jsx)("div",{className:"fixed",style:{zIndex:2147483647,top:n+15,width:h,right:15},children:(0,r.jsxs)("div",{className:"flex flex-col w-full p-2",children:[(0,r.jsxs)("div",{className:"flex flex-row w-full",children:[(0,r.jsx)(j,{showFullLogo:!0}),(0,r.jsx)("span",{className:"my-auto ml-auto",children:(0,r.jsx)(se,{width:25,height:25,small:!0,onClick:u})})]}),(0,r.jsx)("span",{className:"text-lg font-semibold my-2",children:s("header")}),(0,r.jsx)("div",{className:"w-full",children:t.map((a,_)=>(0,r.jsxs)("div",{className:"flex flex-row w-full h-[80px] justify-start items-center cursor-pointer border border-solid border-gray-150 hover:border-primary hover:border-4 my-2 px-2",onClick:()=>p(a,_),children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-[60px] h-[48px]",children:(0,r.jsx)("img",{className:"max-w-full max-h-full object-contain",src:Y(a.tld)})}),(0,r.jsxs)("div",{className:"flex flex-col flex-1 text-base ml-4 my-auto",children:[(0,r.jsx)(A,{items:d({itemName:"description",parseValues:{merchant:a.displayName}})}),(0,r.jsx)(A,{items:d({itemName:a.rewardHasPrefix?"prefixed_rewards_text":"rewards_text",parseValues:{displayReward:a.displayReward}})})]}),(0,r.jsx)(ae,{className:"text-blue-500 h-8 w-8 mr-2"})]},a.key))}),(0,r.jsx)(A,{onClick:M,items:d({itemName:"exclusions"})})]})})}async function ne(t,i,s){if(await we("cgpt"))return;let m=Ae(t);if(m.length>0){let{offers:l}=await ye(m,"ai_search"),c=_e.default.chain(l).uniqBy("tld").orderBy("rewardsRate","desc").take(4).value();if(c.forEach(e=>{e.href=e.href.replace(he,(0,xe.v4)())}),c.length>=Ee){v({name:"cgpt_available_products",type:y,subType:g,meta:c});let e=window.matchMedia("(prefers-color-scheme: dark)").matches;if(!e){let n=window.document.querySelector(s),h=window.document.querySelector("header#page-header")?.clientWidth||0,L=(h-(i?.clientWidth||0))/2-be,C=!n&&L>=te;v({name:C?"cgpt_offers_ur_width_met":"cgpt_offers_ur_width_not_met",type:y,subType:g,meta:{showingSidePanel:!!n,headerWidth:h,offerWidth:L,hasEnoughWidth:L>=te}})}e?v({name:"cgpt_dm_holdout",type:y,subType:g}):J("ext_prcs_ais")?await q({appName:"ai_search_cgpt",app:(0,r.jsx)(Fe,{offers:c}),mountClass:"max-w-96 mx-auto",insertAfterElement:i.parentNode,positionOnTop:!1}):J("ext_prcs_ais_ern")?await q({appName:"ai_search_cgpt_ern",app:(0,r.jsx)(Ge,{offers:c,chatWidth:i.clientWidth})}):v({name:"cgpt_holdout",type:y,subType:g})}else v({name:"cgpt_dm_min_offer_miss",type:y,subType:g,meta:{offerCount:c.length}})}}async function Te(t,i){let s=0,d=!1,m=k(i,"containerElements"),l=k(i,"sidePanelElements"),c=k(i,"popoverElements"),e={query:t("popoverQuery"),propScrape:{}},n=Q(i,"sidePanel"),T={containerQuery:t("containerQuery"),responseQuery:t("responseQuery")},h=function(){e._el_.isConnected&&P()},L=Pe.default.debounce(h,500,{maxWait:1e3}),C=new MutationObserver(L),R={attributes:!0,childList:!0,subtree:!0,characterData:!0};function w(o,f){f.disconnect(),f.observe(o,R)}function u(){let o={};for(let f in c)o[f]=pe(e._el_,c[f].propScrape);return o}function p(o){F("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify({chatGPTMode:!0,hasTermCheck:G(),...o})},{anonymized:!0,skipAllowlistCheck:!0})}function P(){let o=u();p({eventType:"popoverCycled",result:o})}function M(){let o=u();p({eventType:"popoverOpened",result:o})}async function a(o){if(!n._el_)return;N([l]);let f=await S(n._el_,l);await I(l);let B=O(l);f&&p({eventType:"sidePanel",buttonInfo:o,result:B})}function _(o){clearInterval(o.interval),o.interval=0,o.runTime=0}let z=o=>{n.interval&&_(n),n._el_=window.document.querySelector(n.query),n.interval=setInterval(()=>{let f=n._el_?.querySelector(n.loadingIndicator);n.runTime+=n.runInterval,(!f||n.runTime>=n.runLimit)&&(_(n),setTimeout(()=>{a(o)},n.runInterval))},n.runInterval)};async function Ne(o,f){o==="nonLinkButton"&&z(f)}async function Ie(o,f){N([m]);let B=await S(o,m,Ne);await I(m);let re=O(m);B&&(p({eventType:"newResponse",...re}),ne(re,f,n.query))}async function Oe(){let o=window.document.querySelectorAll(T.containerQuery);if(o.length>s){s=o.length;let f=window.document.querySelectorAll(T.responseQuery);await Ie(f[f.length-1],o[s-1])}}async function Re(){if(d)return;let o=window.document.querySelectorAll(e.query);o.length>0&&e._el_!==o[0]&&(e._el_=o[0],w(o[0],C),M())}n._el_=window.document.querySelector(n.query),setInterval(()=>{Oe(),Re()},500)}async function Le(t,i){let s=0,d=t("containerQuery"),m=k(i,"containerElements");async function l(e){N([m]);let n=await S(e,m);await I(m);let T=O(m);n&&F("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify({geminiMode:!0,hasTermCheck:G(),result:T})},{anonymized:!0,skipAllowlistCheck:!0})}async function c(){let e=window.document.querySelectorAll(d);e.length>s&&(s=e.length,setTimeout(async()=>{await l(e[e.length-1])},2e3))}setInterval(()=>{c()},1e3)}async function ke(t,i){let s=0,d=new Set([""]),m=k(i,"containerElements"),l=k(i,"searchPaneElements"),c=t("containerQuery"),e=t("searchPaneQuery"),n=t("googleHeaderQuery"),T=t("AIModeText"),h={searchLink:{prefix:"/search?",count:0},viewerLink:{prefix:"/viewer/",count:0}};function L(w){Object.keys(w).forEach(u=>{Object.keys(h).forEach(p=>{w[u].foundLinks&&w[u].foundLinks.length>0&&(h[p].count+=w[u].foundLinks.filter(P=>P.startsWith(h[p].prefix)).length)})})}async function C(w,u,p){N([u]);let P=await S(w,u);L(u),await I(u);let M={googleAIMode:!0,newSearchContainer:p,newSearchPaneOpen:!p,hasTermCheck:G(),result:O(u)};Object.keys(h).forEach(a=>{let _=h[a];M[a]=_.count}),P&&F("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify(M)},{anonymized:!0,skipAllowlistCheck:!0})}async function R(){let w=Array.from(window.document.querySelectorAll(n));if(w.length>0&&w.find(u=>u.innerText===T)){let u=window.document.querySelectorAll(c),p=window.document.querySelectorAll(e),P=p.length>0?p[p.length-1].getAttribute("id")??"":"",M=u.length>s,a=!d.has(P);M?(s=u.length,setTimeout(async()=>{C(u[u.length-1],m,!0)},2e3)):a&&(d.add(P),setTimeout(async()=>{C(p[p.length-1],l,!1)},2e3))}}setInterval(()=>{R()},1e3)}var Se=x(D());async function qe(){let t=await me();ue(t)}function We({type:t}){let{getValue:i,getSequence:s}=H(je(t));return(0,Me.useEffect)(()=>{t===1?Le(i,s):t===0?Te(i,s):t===2&&ke(i,s)},[]),null}function je(t){return t===1?"llm_scraper_gemini":t===0?"llm_scraper_cpt":t===2?"llm_scraper_gaim":""}async function Qe(t){await q({appName:"AIScraper",blankSlate:!0,app:(0,Se.jsx)(We,{type:t})})}async function Ce(){try{let t=fe();t!==3&&(await qe(),await Qe(t))}catch(t){console.error(t)}}document.readyState!=="loading"?Ce():document.addEventListener("DOMContentLoaded",Ce);
