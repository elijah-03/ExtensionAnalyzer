LavaPack.loadBundle([[308,{"../../../../../shared/constants/permissions":5621,"../../../controllers/permissions":224,"@metamask/chain-agnostic-permission":1359,"@metamask/permission-controller":2329},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getPermissionsHandler=void 0;var n=e("@metamask/permission-controller"),o=e("@metamask/chain-agnostic-permission"),i=e("../../../controllers/permissions"),a=e("../../../../../shared/constants/permissions");r.getPermissionsHandler={methodNames:[n.MethodNames.GetPermissions],implementation:async function(e,t,r,n,{getPermissionsForOrigin:s,getAccounts:l}){var c;const d={...s()},u=d[o.Caip25EndowmentPermissionName],h=null==u||null===(c=u.caveats)||void 0===c||null===(c=c.find(({type:e})=>e===o.Caip25CaveatType))||void 0===c?void 0:c.value;if(delete d[o.Caip25EndowmentPermissionName],h){const e=l();e.length>0&&(d[a.RestrictedMethods.eth_accounts]={...u,parentCapability:a.RestrictedMethods.eth_accounts,caveats:[{type:a.CaveatTypes.restrictReturnedAccounts,value:e}]});const t=(0,o.getPermittedEthChainIds)(h);t.length>0&&(d[i.PermissionNames.permittedChains]={...u,parentCapability:i.PermissionNames.permittedChains,caveats:[{type:a.CaveatTypes.restrictNetworkSwitching,value:t}]})}return t.result=Object.values(d),n()},hookNames:{getPermissionsForOrigin:!0,getAccounts:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-getPermissions.ts"}],[309,{"../../../../../shared/constants/permissions":5621,"../../../controllers/permissions":224,"@metamask/chain-agnostic-permission":1359,"@metamask/controller-utils":1383,"@metamask/permission-controller":2329,lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.requestPermissionsHandler=void 0;var n=e("lodash"),o=e("@metamask/controller-utils"),i=e("@metamask/permission-controller"),a=e("@metamask/chain-agnostic-permission"),s=e("../../../../../shared/constants/permissions"),l=e("../../../controllers/permissions");r.requestPermissionsHandler={methodNames:[i.MethodNames.RequestPermissions],implementation:async function(e,t,r,c,{getAccounts:d,requestPermissionsForOrigin:u,getCaip25PermissionFromLegacyPermissionsForOrigin:h}){const{params:p}=e;if(!Array.isArray(p)||!(0,o.isPlainObject)(p[0]))return c((0,i.invalidParams)({data:{request:e}}));let[m]=p;delete m[a.Caip25EndowmentPermissionName];const g=(0,n.pick)(m,[s.RestrictedMethods.eth_accounts,l.PermissionNames.permittedChains]);delete m[s.RestrictedMethods.eth_accounts],delete m[l.PermissionNames.permittedChains];const f=Object.keys(g).length>0;if(f){const e=h(g);m={...m,...e}}let y={};const[v]=await u(m);if(y={...v},f){var C;const e=y[a.Caip25EndowmentPermissionName];if(!e)throw new Error(`could not find ${a.Caip25EndowmentPermissionName} permission.`);const t=null===(C=e.caveats)||void 0===C||null===(C=C.find(({type:e})=>e===a.Caip25CaveatType))||void 0===C?void 0:C.value;if(!t)throw new Error(`could not find ${a.Caip25CaveatType} in granted ${a.Caip25EndowmentPermissionName} permission.`);delete y[a.Caip25EndowmentPermissionName];const r=d(origin);y[s.RestrictedMethods.eth_accounts]={...e,parentCapability:s.RestrictedMethods.eth_accounts,caveats:[{type:s.CaveatTypes.restrictReturnedAccounts,value:r}]};const n=(0,a.getPermittedEthChainIds)(t);n.length>0&&(y[l.PermissionNames.permittedChains]={...e,parentCapability:l.PermissionNames.permittedChains,caveats:[{type:s.CaveatTypes.restrictNetworkSwitching,value:n}]})}return t.result=Object.values(y).filter(e=>e!==undefined),c()},hookNames:{getAccounts:!0,requestPermissionsForOrigin:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-requestPermissions.ts"}],[31,{"../../../shared/constants/bridge":5600,"../../../shared/lib/trace":5718,"@metamask/bridge-status-controller":1325,"@metamask/controller-utils":1383},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.BridgeStatusControllerInit=void 0;var n=e("@metamask/bridge-status-controller"),o=e("@metamask/controller-utils"),i=e("../../../shared/lib/trace"),a=e("../../../shared/constants/bridge");r.BridgeStatusControllerInit=({controllerMessenger:e,persistedState:t,getController:r})=>{const s=r("TransactionController");return{controller:new n.BridgeStatusController({messenger:e,state:t.BridgeStatusController,fetchFn:async(e,t)=>await(0,o.handleFetch)(e,{method:"GET",...t}),addTransactionFn:(...e)=>s.addTransaction(...e),addTransactionBatchFn:(...e)=>s.addTransactionBatch(...e),estimateGasFeeFn:(...e)=>s.estimateGasFee(...e),updateTransactionFn:(...e)=>s.updateTransaction(...e),config:{customBridgeApiBaseUrl:a.BRIDGE_API_BASE_URL},traceFn:(...e)=>(0,i.trace)(...e)})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-status-controller-init.ts"}],[310,{"../../../../../shared/constants/permissions":5621,"../../../controllers/permissions":224,"@metamask/chain-agnostic-permission":1359,"@metamask/permission-controller":2329,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.revokePermissionsHandler=void 0;var n=e("@metamask/permission-controller"),o=e("@metamask/utils"),i=e("@metamask/chain-agnostic-permission"),a=e("../../../../../shared/constants/permissions"),s=e("../../../controllers/permissions");r.revokePermissionsHandler={methodNames:[n.MethodNames.RevokePermissions],implementation:function(e,t,r,l,{revokePermissionsForOrigin:c,rejectApprovalRequestsForOrigin:d}){const{params:u}=e,h=null==u?void 0:u[0];if(!h)return l((0,n.invalidParams)({data:{request:e}}));const p=Object.keys(h).filter(e=>e!==i.Caip25EndowmentPermissionName);if(!(0,o.isNonEmptyArray)(p))return l((0,n.invalidParams)({data:{request:e}}));const m=[a.RestrictedMethods.eth_accounts,s.PermissionNames.permittedChains],g=p.filter(e=>!m.includes(e));g.length!==p.length&&g.push(i.Caip25EndowmentPermissionName);return c(g),d(),t.result=null,l()},hookNames:{revokePermissionsForOrigin:!0,rejectApprovalRequestsForOrigin:!0,updateCaveat:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-revokePermissions.ts"}],[311,{"../../../../../shared/constants/app":5598,"@metamask/controller-utils":1383,"@metamask/rpc-errors":2480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/rpc-errors"),o=e("@metamask/controller-utils"),i=e("../../../../../shared/constants/app");const a={methodNames:[i.MESSAGE_TYPE.WATCH_ASSET,i.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,r,i,{handleWatchAssetRequest:a}){try{const{params:{options:r,type:s},origin:l,networkClientId:c}=e,{tokenId:d}=r;return[o.ERC721,o.ERC1155].includes(s)&&d!==undefined&&"string"!=typeof d?i(n.rpcErrors.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof d}'`})):(await a({asset:r,type:s,origin:l??"",networkClientId:c??""}),t.result=!0,i())}catch(e){return i(e)}},hookNames:{handleWatchAssetRequest:!0}};r.default=a}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.ts"}],[312,{"./createMethodMiddleware":297,"./createUnsupportedMethodMiddleware":298},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./createMethodMiddleware");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))});var o=e("./createUnsupportedMethodMiddleware");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}}))})}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}],[313,{"./operation-safener":290,loglevel:4643,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getRequestSafeReload=function(e){const t=new i.OperationSafener({op:async t=>{try{await e.set(t)}catch(e){o.default.error("MetaMask - Persistence failed",e),null==s||s.captureException(e)}},wait:1e3});return{update:async(...e)=>t.execute(...e),requestSafeReload:async()=>{await t.evacuate(),n.default.runtime.reload()}}};var n=a(e("webextension-polyfill")),o=a(e("loglevel")),i=e("./operation-safener");function a(e){return e&&e.__esModule?e:{default:e}}const{sentry:s}=global}}},{package:"$root$",file:"app/scripts/lib/safe-reload.ts"}],[314,{"../util":353,"@segment/loosely-validate-event":2994,buffer:3880,"is-retry-allowed":4432,lodash:4635,"remove-trailing-slash":5131,timers:3882},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=c(e("remove-trailing-slash")),i=c(e("@segment/loosely-validate-event")),a=e("lodash"),s=c(e("is-retry-allowed")),l=e("../util");function c(e){return e&&e.__esModule?e:{default:e}}const d=()=>({});r.default=class{constructor(e,t={}){this.writeKey=e,this.host=(0,o.default)(t.host||"https://api.segment.io"),this.flushInterval=t.flushInterval||1e4,this.flushAt=t.flushAt||Math.max(t.flushAt,1)||20,this.queue=[],this.path="/v1/batch",this.maxQueueSize=460800,this.flushed=!1,this.retryCount=3,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:!0})}_validate(e,t){(0,i.default)(e,t)}_message(e,t,r){return this._validate(t,e),this.enqueue(e,t,r),this}identify(e,t){return this._message("identify",e,t)}track(e,t){return this._message("track",e,t)}page(e,t){return this._message("page",e,t)}enqueue(e,t,r=d){if(!this.enable)return void n(r);const o={...t,type:e};if(o.context={...o.context,library:{name:"analytics-node"}},o.timestamp||(o.timestamp=new Date),o.messageId||(o.messageId=(0,l.generateRandomId)()),o.anonymousId&&!(0,a.isString)(o.anonymousId)&&(o.anonymousId=JSON.stringify(o.anonymousId)),o.userId&&!(0,a.isString)(o.userId)&&(o.userId=JSON.stringify(o.userId)),this.queue.push({message:o,callback:r}),!this.flushed)return this.flushed=!0,void this.flush();const i=this.queue.length>=this.flushAt,s=this.queue.reduce((e,t)=>e+JSON.stringify(t).length,0)>=this.maxQueueSize;(i||s)&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}flush(e=d){if(!this.enable)return n(e),Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return n(e),Promise.resolve();const r=this.queue.splice(0,this.flushAt),o=r.map(e=>e.callback),i={batch:r.map(e=>e.message),timestamp:new Date,sentAt:new Date},a={Authorization:`Basic ${t.from(this.writeKey,"utf8").toString("base64")}`};return this._sendRequest(`${this.host}${this.path}`,{method:"POST",body:JSON.stringify(i),headers:a},t=>{n(()=>{o.forEach(e=>e(t,i)),e(t,i)})},0)}_retryRequest(e,t,r,n){const o=100*Math.pow(2,n);setTimeout(()=>{this._sendRequest(e,t,r,n+1)},o)}async _sendRequest(e,t,r,n){return fetch(e,t).then(async o=>{if(o.ok)r();else if(this._isErrorRetryable({response:o})&&n<=this.retryCount)this._retryRequest(e,t,r,n);else{const e=new Error(o.statusText);r(e)}}).catch(o=>{this._isErrorRetryable(o)&&n<=this.retryCount?this._retryRequest(e,t,r,n):r(o)})}_isErrorRetryable(e){return!!function(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,s.default)(e)}(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("buffer").Buffer,e("timers").setImmediate)}}},{package:"$root$",file:"app/scripts/lib/segment/analytics.js"}],[315,{"../../../../shared/constants/time":5635,"./analytics":314},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var n,o=e("../../../../shared/constants/time"),i=(n=e("./analytics"))&&n.__esModule?n:{default:n};const a="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP",s=undefined,l=5*o.SECOND,c=(e=s)=>{const t={queue:[],flush(){t.queue.forEach(([e,t])=>{t()}),t.queue=[]},track(r,n=()=>undefined){t.queue.push([r,n]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};r.createSegmentMock=c;r.segment=a?new i.default(a,{host:null,flushAt:s,flushInterval:l}):c(s)}}},{package:"$root$",file:"app/scripts/lib/segment/index.js"}],[317,{"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.initSidePanelContextMenu=async function(e){var t,r,n;const a=o.default;if(!o.default.contextMenus||!a.sidePanel||"true"!==(null===(t=!1)?void 0:t.toString()))return;const s=e=>{var t;return!1!==(null==e||null===(t=e.remoteFeatureFlags)||void 0===t?void 0:t.extensionUxSidepanel)},l=()=>{o.default.contextMenus.create({id:i,title:"MetaMask Sidepanel",contexts:["all"]})};s(null==e||null===(r=e.remoteFeatureFlagController)||void 0===r?void 0:r.state)&&l();o.default.contextMenus.onClicked.addListener((e,t)=>{var r;e.menuItemId===i&&null!=t&&t.windowId&&(null===(r=a.sidePanel)||void 0===r||r.open({windowId:t.windowId}))}),null==e||null===(n=e.controllerMessenger)||void 0===n||n.subscribe("RemoteFeatureFlagController:stateChange",e=>{s(e)?l():o.default.contextMenus.remove(i)})};var n,o=(n=e("webextension-polyfill"))&&n.__esModule?n:{default:n};const i="openSidePanel"}}},{package:"$root$",file:"app/scripts/lib/sidepanel-context-menu.ts"}],[318,{"../../../../shared/lib/trace":5718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.addPersonalMessage=async function({signatureParams:e,signatureController:t}){return o(e,t,"newUnsignedPersonalMessage")},r.addTypedMessage=async function({signatureParams:e,signatureController:t}){return o(e,t,"newUnsignedTypedMessage")};var n=e("../../../../shared/lib/trace");async function o(e,t,r){const[,o]=e,{id:i}=o,a=null==i?void 0:i.toString();(0,n.endTrace)({name:n.TraceName.Middleware,id:a});const s=await t[r](...e);return(0,n.endTrace)({name:n.TraceName.Signature,id:a}),s}}}},{package:"$root$",file:"app/scripts/lib/signature/util.ts"}],[319,{"../../../../shared/constants/app":5598,"../../../../shared/constants/smartTransactions":5628,"../../../../shared/modules/conversion.utils":5732,"../../../../shared/modules/selectors":5751,"../../../../shared/modules/transaction.utils":5763,"@metamask/smart-transactions-controller":2523,"@metamask/transaction-controller":2868,loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSmartTransactionCommonParams=function(e,t){const r=function(e){return{metamask:e}}(e),n=(0,d.getIsSmartTransaction)(r,t),o=(0,d.getFeatureFlagsByChainId)(r,t),i=(0,d.isHardwareWallet)(r);return{isSmartTransaction:n,featureFlags:o,isHardwareWalletAccount:i}},r.submitSmartTransactionHook=r.submitBatchSmartTransactionHook=void 0;var n,o=e("@metamask/smart-transactions-controller"),i=e("@metamask/transaction-controller"),a=(n=e("loglevel"))&&n.__esModule?n:{default:n},s=e("../../../../shared/constants/app"),l=e("../../../../shared/constants/smartTransactions"),c=e("../../../../shared/modules/conversion.utils"),d=e("../../../../shared/modules/selectors"),u=e("../../../../shared/modules/transaction.utils");function h(e,t,r){p(e,t),t.set(e,r)}function p(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t){return e.get(f(e,t))}function g(e,t,r){return e.set(f(e,t),r),r}function f(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var y=new WeakMap,v=new WeakMap,C=new WeakMap,b=new WeakMap,w=new WeakMap,S=new WeakMap,k=new WeakMap,T=new WeakMap,A=new WeakMap,M=new WeakMap,E=new WeakMap,P=new WeakMap,I=new WeakMap,_=new WeakMap,R=new WeakSet;class N{constructor(e){!function(e,t){p(e,t),t.add(e)}(this,R),h(this,y,void 0),h(this,v,void 0),h(this,C,void 0),h(this,b,void 0),h(this,w,void 0),h(this,S,void 0),h(this,k,void 0),h(this,T,void 0),h(this,A,void 0),h(this,M,void 0),h(this,E,void 0),h(this,P,void 0),h(this,I,void 0),h(this,_,void 0);const{transactionMeta:t,signedTransactionInHex:r,smartTransactionsController:n,transactionController:o,isSmartTransaction:a,controllerMessenger:l,featureFlags:c,transactions:d}=e;g(v,this,""),g(y,this,!1),g(M,this,t),g(E,this,r),g(T,this,n),g(A,this,o),g(k,this,a),g(b,this,l),g(w,this,c),g(S,this,t.origin!==s.ORIGIN_METAMASK),g(C,this,t.chainId),g(I,this,t.txParams),g(P,this,d),g(_,this,Boolean(t.type!==i.TransactionType.bridge&&t.type!==i.TransactionType.shieldSubscriptionApprove||m(P,this)&&m(P,this).length>0))}async submit(){const e=!!m(M,this).type&&[i.TransactionType.swapAndSend,i.TransactionType.swapApproval,i.TransactionType.bridgeApproval].includes(m(M,this).type),t={transactionHash:undefined};if(!m(k,this)||e||(0,u.isLegacyTransaction)(m(M,this)))return t;let r;if(m(_,this)&&await f(R,this,D).call(this),!m(E,this)||!m(M,this).isGasFeeSponsored)try{r=await m(T,this).getFees({...m(I,this),chainId:m(C,this)},undefined,{networkClientId:m(M,this).networkClientId})}catch(e){return a.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",e),f(R,this,B).call(this),t}try{var n;const e=await f(R,this,K).call(this,{getFeesResponse:r}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");await f(R,this,x).call(this,t);let o;if(o=(null===(n=m(w,this))||void 0===n||null===(n=n.smartTransactions)||void 0===n?void 0:n.extensionReturnTxHashAsap)&&null!=e&&e.txHash?e.txHash:await f(R,this,$).call(this,{uuid:t}),null===o)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:o}}catch(e){throw a.default.error("Error in smart transaction publish hook",e),f(R,this,B).call(this),e}}async submitBatch(){if(!m(k,this))throw new Error("submitBatch: Smart Transaction is required for batch submissions");m(_,this)&&await f(R,this,D).call(this);try{var e,t;const r=await f(R,this,K).call(this),n=null==r?void 0:r.uuid;if(!n)throw new Error("submitBatch: No smart transaction UUID");let o;await f(R,this,x).call(this,n),o=null!=r&&r.txHashes?{results:r.txHashes.map(e=>({transactionHash:e}))}:{results:[]};if((null===(e=m(w,this))||void 0===e||null===(e=e.smartTransactions)||void 0===e?void 0:e.extensionReturnTxHashAsapBatch)&&(null===(t=o)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.length)>0)return o;if(null===await f(R,this,$).call(this,{uuid:n}))throw new Error("submitBatch: Transaction does not have a transaction hash, there was a problem");return o}catch(e){throw a.default.error("submitBatch: Error in smart transaction publish batch hook",e),f(R,this,B).call(this),e}}}async function F(e){try{await m(b,this).call("ApprovalController:endFlow",{id:e})}catch(e){}}async function O(e){try{await f(R,this,F).call(this,e),await m(b,this).call("ApprovalController:acceptRequest",e),G._=""}catch(e){a.default.error("Error ending existing approval flow",e)}}async function D(){G._&&await f(R,this,O).call(this,G._);const{id:e}=await m(b,this).call("ApprovalController:startFlow");g(v,this,e),G._=e}async function x(e){m(_,this)&&(f(R,this,j).call(this,{uuid:e}),f(R,this,U).call(this,{uuid:e}))}function B(){m(_,this)&&!m(y,this)&&(g(y,this,!0),f(R,this,F).call(this,m(v,this)),G._===m(v,this)&&(G._=""))}function j({uuid:e}){const t=()=>{f(R,this,B).call(this)};m(b,this).call("ApprovalController:addRequest",{id:m(v,this),origin:origin,type:s.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:o.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e,chainId:m(C,this)},isDapp:m(S,this),txId:m(M,this).id}},!0).then(t,t)}async function L({smartTransaction:e}){return await m(b,this).call("ApprovalController:updateRequestState",{id:m(v,this),requestState:{smartTransaction:e,isDapp:m(S,this),txId:m(M,this).id}})}async function U({uuid:e}){m(b,this).subscribe("SmartTransactionsController:smartTransaction",async t=>{if(t.uuid===e){const{status:e}=t;if(!e||e===o.SmartTransactionStatuses.PENDING)return;m(y,this)||await f(R,this,L).call(this,{smartTransaction:t})}})}function $({uuid:e}){return new Promise(t=>{m(b,this).subscribe("SmartTransactionsController:smartTransaction",async r=>{if(r.uuid===e){const{status:e,statusMetadata:n}=r;if(!e||e===o.SmartTransactionStatuses.PENDING)return;a.default.debug("Smart Transaction: ",r),null!=n&&n.minedHash?(a.default.debug("Smart Transaction - Received tx hash: ",null==n?void 0:n.minedHash),t(n.minedHash)):t(null)}})})}async function K({getFeesResponse:e}={}){let t=[];if(m(P,this)&&Array.isArray(m(P,this))&&m(P,this).length>0)t=m(P,this).filter(e=>null==e?void 0:e.signedTx).map(e=>e.signedTx);else if(m(E,this))t=[m(E,this)];else if(e){var r;t=await f(R,this,H).call(this,(null===(r=e.tradeTxFees)||void 0===r?void 0:r.fees)??[],!1)}return await m(T,this).submitSignedTransactions({signedTransactions:t,signedCanceledTransactions:[],txParams:m(I,this),transactionMeta:m(M,this),networkClientId:m(M,this).networkClientId})}function q(e,t){if(!m(I,this))throw new Error("Transaction params are required");const r={...m(I,this),maxFeePerGas:`0x${(0,c.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,c.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,c.decimalToHex)(l.CANCEL_GAS_LIMIT_DEC)}`:m(I,this).gas};return t&&(r.to=r.from,r.data="0x"),r}async function H(e,t){if(!m(I,this)||!m(C,this))throw new Error("Transaction params and chainId are required");const r=e.map(e=>f(R,this,q).call(this,e,t)).map(e=>({...e,chainId:e.chainId||m(C,this)}));return await m(A,this).approveTransactionsWithSameNonce(r,{hasNonce:!0})}var G={_:""};r.submitSmartTransactionHook=e=>new N(e).submit();r.submitBatchSmartTransactionHook=e=>new N(e).submitBatch()}}},{package:"$root$",file:"app/scripts/lib/smart-transaction/smart-transactions.ts"}],[32,{"@metamask/claims-controller":1378},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ClaimsControllerInit=void 0;var n=e("@metamask/claims-controller");r.ClaimsControllerInit=e=>{const{controllerMessenger:t,persistedState:r}=e;return{controller:new n.ClaimsController({messenger:t,state:r.ClaimsController})}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-controller-init.ts"}],[320,{"./snap-keyring":323,"./utils":324},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getAccountsBySnapId",{enumerable:!0,get:function(){return o.getAccountsBySnapId}}),Object.defineProperty(r,"snapKeyringBuilder",{enumerable:!0,get:function(){return n.snapKeyringBuilder}});var n=e("./snap-keyring"),o=e("./utils")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[321,{"@metamask/keyring-api":2100,"@metamask/permission-controller":2329},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isProtocolAllowed=d,r.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return a;if(i.includes(t))return l;const r=e.getSubjectMetadata(t);return(null==r?void 0:r.subjectType)===o.SubjectType.Website&&d(t)?s:[]}};var n=e("@metamask/keyring-api"),o=e("@metamask/permission-controller");const i=["https://app.metamask.io"],a=[n.KeyringRpcMethod.ListAccounts,n.KeyringRpcMethod.GetAccount,n.KeyringRpcMethod.FilterAccountChains,n.KeyringRpcMethod.DeleteAccount,n.KeyringRpcMethod.ListRequests,n.KeyringRpcMethod.GetRequest,n.KeyringRpcMethod.SubmitRequest,n.KeyringRpcMethod.RejectRequest],s=[n.KeyringRpcMethod.ListAccounts,n.KeyringRpcMethod.GetAccount,n.KeyringRpcMethod.CreateAccount,n.KeyringRpcMethod.FilterAccountChains,n.KeyringRpcMethod.UpdateAccount,n.KeyringRpcMethod.DeleteAccount,n.KeyringRpcMethod.ExportAccount,n.KeyringRpcMethod.ListRequests,n.KeyringRpcMethod.GetRequest,n.KeyringRpcMethod.ApproveRequest,n.KeyringRpcMethod.RejectRequest],l=[n.KeyringRpcMethod.ListAccounts,n.KeyringRpcMethod.GetAccount,n.KeyringRpcMethod.GetAccountBalances,n.KeyringRpcMethod.SubmitRequest],c=["https:"];function d(e){try{const t=new URL(e);return c.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/keyring-snaps-permissions.ts"}],[322,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapAndHardwareInfoForMetrics=async function(e,t,r,n){var o,i,a;if(!n)return{};const s=n.call("AccountsController:getSelectedAccount"),l=s.address;let c;var d;null!==(o=s.metadata.snap)&&void 0!==o&&o.id&&(c=n.call("SnapController:get",null===(d=s.metadata.snap)||void 0===d?void 0:d.id));let u={};const{isUnlocked:h}=n.call("KeyringController:getState");h&&(u={account_type:await e(l),device_model:await t(l),account_hardware_type:await r(l)});return{...u,account_snap_type:null===(i=c)||void 0===i?void 0:i.id,account_snap_version:null===(a=c)||void 0===a?void 0:a.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[323,{"../../../../shared/constants/app":5598,"../../../../shared/constants/metametrics":5613,"../../../../shared/lib/accounts":5642,"../../../../shared/lib/accounts/snaps":5644,"../../../../shared/lib/multichain-accounts/remote-feature-flag":5702,"../../../../shared/lib/snaps/snaps":5713,"../../../../shared/lib/translate":5723,"../../../../ui/components/component-library/icon":6324,"./utils/isBlockedUrl":325,"./utils/showResult":326,"@metamask/eth-snap-keyring":1955,"@metamask/snaps-utils":2781,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.showAccountCreationDialog=S,r.showAccountNameSuggestionDialog=k,r.snapKeyringBuilder=function(e,t){const r=()=>new o.SnapKeyring({messenger:e,callbacks:new I(e,t)});return r.state=null,r.type=o.SnapKeyring.type,r};var n,o=e("@metamask/eth-snap-keyring"),i=(n=e("webextension-polyfill"))&&n.__esModule?n:{default:n},a=e("@metamask/snaps-utils"),s=e("../../../../shared/constants/metametrics"),l=e("../../../../shared/constants/app"),c=e("../../../../shared/lib/translate"),d=e("../../../../ui/components/component-library/icon"),u=e("../../../../shared/lib/accounts"),h=e("../../../../shared/lib/snaps/snaps"),p=e("../../../../shared/lib/accounts/snaps"),m=e("../../../../shared/lib/multichain-accounts/remote-feature-flag"),g=e("./utils/isBlockedUrl"),f=e("./utils/showResult");function y(e,t,r){v(e,t),t.set(e,r)}function v(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function C(e,t){return e.get(w(e,t))}function b(e,t,r){return e.set(w(e,t),r),r}function w(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}async function S(e,t){try{return Boolean(await t.call("ApprovalController:addRequest",{origin:e,type:l.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0))}catch(e){throw new Error(`Error occurred while showing account creation dialog.\n${e}`)}}async function k(e,t,r){try{return await t.call("ApprovalController:addRequest",{origin:e,type:l.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showNameSnapAccount,requestData:{snapSuggestedAccountName:r}},!0)}catch(e){throw new Error(`Error occurred while showing name account dialog.\n${e}`)}}var T=new WeakMap,A=new WeakMap,M=new WeakMap,E=new WeakMap,P=new WeakSet;class I{constructor(e,{trackEvent:t,persistKeyringHelper:r,removeAccountHelper:n}){!function(e,t){v(e,t),t.add(e)}(this,P),y(this,T,void 0),y(this,A,void 0),y(this,M,void 0),y(this,E,void 0),b(T,this,e),b(A,this,t),b(M,this,r),b(E,this,n)}async addressExists(e){return(await C(T,this).call("KeyringController:getAccounts")).includes(e.toLowerCase())}async redirectUser(e,t,r){if(t.length>0||r.length>0){const n=await(0,g.isBlockedUrl)(t,async()=>await C(T,this).call("PhishingController:maybeUpdateState"),e=>C(T,this).call("PhishingController:testOrigin",e)),o=await C(T,this).call("ApprovalController:addRequest",{origin:e,requestData:{url:t,message:r,isBlockedUrl:n},type:l.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(o)&&t.length>0?i.default.tabs.create({url:t}):console.log("User refused snap account redirection to:",t)}else console.log("Error occurred when redirecting snap account. url or message must be defined")}async saveState(){await C(M,this).call(this)}async addAccount(e,t,r,n,i="",{displayConfirmation:s,displayAccountNameSuggestion:l,setSelectedAccount:c}=(0,o.getDefaultInternalOptions)()){(0,a.assertIsValidSnapId)(t);const d=(0,h.isSnapPreinstalled)(t);let u=d&&(0,p.isMultichainWalletSnap)(t);const m=u||d&&!s,g=u||d&&!l,f=u||d&&!c,y=m&&g,{accountName:v}=await w(P,this,F).call(this,{snapId:t,skipConfirmationDialog:m,skipAccountNameSuggestionDialog:g,skipApprovalFlow:y,accountNameSuggestion:u?"":i,handleUserInput:r});w(P,this,D).call(this,{address:e,snapId:t,skipConfirmationDialog:m,skipSetSelectedAccountStep:f,skipApprovalFlow:y,accountName:v,onceSaved:n,defaultAccountNameChosen:Boolean(i)&&v===i})}async removeAccount(e,t,r){(0,a.assertIsValidSnapId)(t);const n=(0,p.getSnapName)(t,C(T,this)),{id:o}=C(T,this).call("ApprovalController:startFlow"),i="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-remove-an-account-from-your-metamask-wallet/",u=e=>{C(A,this).call(this,{event:e,category:s.MetaMetricsEventCategory.Accounts,properties:{account_type:s.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:n}})};let h=!1;try{if(h=Boolean(await C(T,this).call("ApprovalController:addRequest",{origin:t,type:l.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:e}},!0)),!h)throw await r(h),new Error("User denied account removal");try{await C(E,this).call(this,e),await r(h),await C(M,this).call(this),u(s.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,f.showError)(C(T,this),t,{icon:d.IconName.UserCircleRemove,title:(0,c.t)("snapAccountRemoved")},{message:(0,c.t)("snapAccountRemovedDescription"),learnMoreLink:i}),u(s.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(e){const r=e.message;throw await(0,f.showError)(C(T,this),t,{icon:d.IconName.UserCircleRemove,title:(0,c.t)("snapAccountRemovalFailed")},{message:(0,c.t)("snapAccountRemovalFailedDescription",n),learnMoreLink:i,error:r}),u(s.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${r}`)}}finally{h&&u(s.MetaMetricsEventName.AccountRemoved),C(T,this).call("ApprovalController:endFlow",{id:o})}}}async function _(e){const{id:t}=C(T,this).call("ApprovalController:startFlow");try{return await e(t)}finally{C(T,this).call("ApprovalController:endFlow",{id:t})}}async function R(e,t){const{success:r,name:n}=await k(e,C(T,this),t);return{success:r,accountName:n}}async function N(e){const t=await C(T,this).call("AccountsController:listMultichainAccounts");return{success:!0,accountName:(0,u.getUniqueAccountName)(t,e)}}async function F({snapId:e,skipConfirmationDialog:t,skipAccountNameSuggestionDialog:r,skipApprovalFlow:n,handleUserInput:o,accountNameSuggestion:i}){if(n){const{success:e,accountName:t}=await w(P,this,N).call(this,i);if(await o(e),!e)throw new Error("User denied account creation");return{accountName:t}}return await w(P,this,_).call(this,async n=>{{const r=t||await S(e,C(T,this));if(!r)throw await o(r),new Error("User denied account creation")}{const{success:t,accountName:n}=r?await w(P,this,N).call(this,i):await w(P,this,R).call(this,e,i);if(await o(t),!t)throw new Error("User denied account creation");return{accountName:n}}})}function O(){var e;const t=C(T,this).call("RemoteFeatureFlagController:getState"),r=null==t||null===(e=t.remoteFeatureFlags)||void 0===e?void 0:e.enableMultichainAccountsState2;return(0,m.isMultichainAccountsFeatureEnabled)(r,m.FEATURE_VERSION_2)}async function D({address:e,snapId:t,skipConfirmationDialog:r,skipSetSelectedAccountStep:n,skipApprovalFlow:o,onceSaved:i,accountName:a,defaultAccountNameChosen:l}){const u="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-add-accounts-in-your-wallet/",h=(0,p.getSnapName)(t,C(T,this)),m=e=>{C(A,this).call(this,{event:e,category:s.MetaMetricsEventCategory.Accounts,properties:{account_type:s.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:h,...e===s.MetaMetricsEventName.AccountAdded&&{is_suggested_name:l}}})},g=async()=>{try{const o=await i;n||C(T,this).call("AccountsController:setSelectedAccount",o),w(P,this,O).call(this)||a&&C(T,this).call("AccountsController:setAccountName",o,a),r||(m(s.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,f.showSuccess)(C(T,this),t,{icon:d.IconName.UserCircleAdd,title:(0,c.t)("snapAccountCreated")},{message:(0,c.t)("snapAccountCreatedDescription"),address:e,learnMoreLink:u}),m(s.MetaMetricsEventName.AddSnapAccountSuccessClicked)),m(s.MetaMetricsEventName.AccountAdded)}catch(e){const r=e.message;await(0,f.showError)(C(T,this),t,{icon:d.IconName.UserCircleAdd,title:(0,c.t)("snapAccountCreationFailed")},{message:(0,c.t)("snapAccountCreationFailedDescription",h),learnMoreLink:u,error:r}),console.error("Error occurred while creating snap account:",r)}};o?await g():await w(P,this,_).call(this,g)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[324,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getAccountsBySnapId=void 0;r.getAccountsBySnapId=async(e,t)=>{const r=await e();return await r.getAccountsBySnapId(t)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils.ts"}],[325,{"../keyring-snaps-permissions":321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isBlockedUrl=void 0;var n=e("../keyring-snaps-permissions");r.isBlockedUrl=async(e,t,r)=>{try{return!(0,n.isProtocolAllowed)(e)||(await t(),r(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[326,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.showSuccess=r.showError=void 0;const n=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});r.showError=(e,t,r,o)=>e.call("ApprovalController:showError",{header:[n(t)],title:r.title,icon:r.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:o}});r.showSuccess=(e,t,r,o)=>e.call("ApprovalController:showSuccess",{header:[n(t)],title:r.title,icon:r.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:o}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[327,{loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.tryPostMessage=function(e,t,r){const n={data:{method:t,params:r}};try{return e.postMessage(n),!0}catch(e){return o.default.error("MetaMask - Failed to message to port",e,n),!1}};var n,o=(n=e("loglevel"))&&n.__esModule?n:{default:n}}}},{package:"$root$",file:"app/scripts/lib/start-up-errors/start-up-errors.ts"}],[328,{"../../../../shared/constants/start-up-errors":5630,"../../../../shared/constants/state-corruption":5631,"../start-up-errors/start-up-errors":327,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.CorruptionHandler=void 0,r.hasVault=l;var n=e("@metamask/utils"),o=e("../../../../shared/constants/state-corruption"),i=e("../start-up-errors/start-up-errors"),a=e("../../../../shared/constants/start-up-errors");function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){if((0,n.isObject)(e)&&(0,n.hasProperty)(e,"KeyringController")){const t=e.KeyringController;if((0,n.isObject)(t)&&(0,n.hasProperty)(t,"vault"))return Boolean(t.vault)}return!1}r.CorruptionHandler=class{constructor(){s(this,"connectedPorts",new Set)}async handleStateCorruptionError({port:e,error:t,database:r,repairCallback:s}){const{connectedPorts:c}=this,d=await async function(e,t){let r=(0,n.isObject)(e)&&(0,n.hasProperty)(e,"backup")&&null!==e.backup?e.backup:null;if(!r)try{r=await t.getBackup()??null}catch{r=null}return r}(t,r),u=function(e){if((0,n.isObject)(e)&&(0,n.hasProperty)(e,"PreferencesController")){const t=e.PreferencesController;if((0,n.isObject)(t)&&(0,n.hasProperty)(t,"currentLocale")&&"string"==typeof t.currentLocale)return t.currentLocale}return null}(d),h=Boolean(l(d));return(0,i.tryPostMessage)(e,o.METHOD_DISPLAY_STATE_CORRUPTION_ERROR,{error:{message:t.message,name:t.name,stack:t.stack},currentLocale:u,hasBackup:h})?new Promise((t,r)=>{c.add(e),e.onDisconnect.addListener(function(){c.delete(e),t()}),e.onMessage.addListener(async function e(n){var l;if((null==n||null===(l=n.data)||void 0===l?void 0:l.method)===o.METHOD_REPAIR_DATABASE){c.forEach(t=>t.onMessage.removeListener(e));try{await async function(e){return await navigator.locks.request("repairDatabase",{ifAvailable:!0},async function(t){return null!==t&&(await e(),!0)})}(async function(){try{await s(d)}finally{c.forEach(e=>{(0,i.tryPostMessage)(e,a.RELOAD_WINDOW)})}}),t()}catch(e){r(e)}}})}):Promise.resolve()}}}}},{package:"$root$",file:"app/scripts/lib/state-corruption/state-corruption-recovery.ts"}],[329,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.sanitizePatches=function(e){return e.filter(e=>{if(o.includes(e.path[0]))return!1;for(const t of i)if(a(e,t))return!1;return!0})},r.sanitizeUIState=function(e){const t={...e};for(const e of o)delete t[e];return function(e){const t=e.snaps;if(!t)return;e.snaps=Object.values(t).reduce((e,t)=>(e[t.id]=function(e){const t={...e};return delete t.sourceCode,delete t.auxiliaryFiles,t}(t),e),{})}(t),function(e){const t=e.srpSessionData;if(!t)return;e.srpSessionData=Object.entries(t).reduce((e,[t,r])=>{const n={...r.token};return delete n.accessToken,e[t]={...r,token:n},e},{})}(t),function(e){const t=e.nodeAuthTokens;t&&(e.nodeAuthTokens=t.map(e=>{const t={...e};return delete t.authToken,t}));const r=e.socialBackupsMetadata;r&&(e.socialBackupsMetadata=r.map(e=>{const t={...e};return delete t.hash,t}))}(t),t};var n=e("lodash");const o=["encryptionKey","encryptionSalt","vault","c2DomainBlocklistLastFetched","hotlistLastFetched","phishingLists","stalelistLastFetched","whitelist","whitelistPaths","accessToken","encryptedKeyringEncryptionKey","encryptedSeedlessEncryptionKey","metadataAccessToken","refreshToken","revokeToken","vaultEncryptionKey","vaultEncryptionSalt","snapStates","unencryptedSnapStates"],i=[["nodeAuthTokens",!0,"authToken"],["snaps",!0,"auxiliaryFiles"],["snaps",!0,"sourceCode"],["socialBackupsMetadata",!0,"hash"],["srpSessionData",!0,"token","accessToken"]];function a(e,t){for(let r=0;r<t.length;r++){const o=t[r],i=r===t.length-1,a=r===e.path.length-1;if(!(e.path[r]===o||!0===o&&e.path[r]!==undefined))return!1;if(i)return!0;if(a&&!l(e.value))return!1;if(a){const o=t.slice(r+1);return e.value=(0,n.cloneDeep)(e.value),s(e.value,o),!1}}return!1}function s(e,t,r=0){const n=t[r],o=r===t.length-1;if(o&&!0!==n&&n in e&&!Array.isArray(e))return void delete e[n];if(o)return;let i=[];!0===n?i=Object.values(e):Array.isArray(e)||(i=[e[n]]);const a=i.filter(l);for(const e of a)s(e,t,r+1)}function l(e){return"object"==typeof e&&null!==e&&e!==undefined}}}},{package:"$root$",file:"app/scripts/lib/state-utils.ts"}],[33,{"../../../../shared/modules/shield/config":5756,"@metamask/claims-controller":1378},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ClaimsServiceInit=void 0;var n=e("@metamask/claims-controller"),o=e("../../../../shared/modules/shield/config");r.ClaimsServiceInit=e=>{const{controllerMessenger:t}=e,{claimsEnv:r}=(0,o.loadShieldConfig)();return{controller:new n.ClaimsService({messenger:t,env:r,fetchFunction:fetch.bind(globalThis)}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-service-init.ts"}],[335,{"../../../../../shared/lib/delegation":5686,"../../../../../shared/lib/delegation/delegation":5683,"@metamask/transaction-controller":2868,"@metamask/utils":2914,"bignumber.js":3768},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.enforceSimulations=async function({messenger:e,transactionMeta:t,useRealSignature:r=!1}){l("Enforcing simulations",{transactionMeta:t,useRealSignature:r});const{chainId:i,simulationData:u={tokenBalanceChanges:[]},txParams:h}=t,p=h.from,m=(0,o.hexToNumber)(i),g=(0,a.getDeleGatorEnvironment)(m),f=g.DelegationManager,y=function(e,t){const r=e.call("AppStateController:getState"),n=r.enforcedSimulationsSlippage;return r.enforcedSimulationsSlippageForTransactions[t]??n}(e,t.id),v=function({accountAddress:e,environment:t,simulationData:r,slippage:o}){const i=function(e,t,r,o){const i=(0,a.createCaveatBuilder)(t),{nativeBalanceChange:s,tokenBalanceChanges:c=[]}=r;if(s){const{difference:t,isDecrease:r}=s,n=d(t,o,r);l("Caveat - Native Balance Change",{enforceDecrease:r,recipient:e,delta:BigInt(t),slippage:o,deltaWithSlippage:n}),i.addCaveat("nativeBalanceChange",r,e,n)}for(const t of c){const{difference:r,isDecrease:a,address:s,standard:c,id:u}=t,h=BigInt(r),p=d(r,o,a),m=u?BigInt(u):0n;switch(l("Caveat - Token Balance Change",{enforceDecrease:a,token:s,recipient:e,delta:h,slippage:o,deltaWithSlippage:p}),c){case n.SimulationTokenStandard.erc20:i.addCaveat("erc20BalanceChange",a,s,e,p);break;case n.SimulationTokenStandard.erc721:i.addCaveat("erc721BalanceChange",a,s,e,h);break;case n.SimulationTokenStandard.erc1155:i.addCaveat("erc1155BalanceChange",a,s,e,m,h);break;default:l("Unsupported token standard",c)}}return i.build()}(e,t,r,o);l("Caveats",i);const s=(0,a.createDelegation)({from:e,to:e,caveats:i});return s}({accountAddress:p,environment:g,simulationData:u,slippage:y});l("Delegation",v);let C=c;r&&(l("Signing delegation"),C=await e.call("DelegationController:signDelegation",{chainId:i,delegation:v}));l("Delegation signature",C);const b=function({transaction:e,delegation:t}){const r=[[t]],n=[a.SINGLE_DEFAULT_MODE],o=[[{target:e.to,callData:e.data??"0x",value:e.value?BigInt(e.value):0n}]];return(0,s.encodeRedeemDelegations)({delegations:r,modes:n,executions:o})}({transaction:h,delegation:{...v,signature:C}});return l("Data",b),{updateTransaction:e=>{e.txParams.data=b,e.txParams.to=f,e.txParams.value="0x0"}}};var n=e("@metamask/transaction-controller"),o=e("@metamask/utils"),i=e("bignumber.js"),a=e("../../../../../shared/lib/delegation"),s=e("../../../../../shared/lib/delegation/delegation");const l=(0,o.createProjectLogger)("enforced-simulations"),c="0x2261a7810ed3e9cde160895909e138e2f68adb2da86fcf98ea0840701df107721fb369ab9b52550ea98832c09f8185284aca4c94bd345e867a4f4461868dd7751b";function d(e,t,r){const n=new i.BigNumber(e),o=(100+(r?t:-t))/100;return BigInt(n.mul(o).toFixed(0))}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/enforced-simulations.ts"}],[336,{"./enforced-simulations":335,"@metamask/transaction-controller":2868,"@metamask/utils":2914,lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.applyTransactionContainers=l,r.applyTransactionContainersExisting=async function({containerTypes:e,transactionId:t,messenger:r,updateEditableParams:n}){const i=(await r.call("TransactionController:getState")).transactions.find(e=>e.id===t);if(!i)throw new Error(`Transaction with ID ${t} not found.`);const{updateTransaction:a}=await l({isApproved:!1,messenger:r,transactionMeta:i,types:e}),s=(0,o.cloneDeep)(i);a(s),n(t,{containerTypes:e,data:s.txParams.data,gas:s.txParams.gas,to:s.txParams.to,value:s.txParams.value})};var n=e("@metamask/transaction-controller"),o=e("lodash"),i=e("@metamask/utils"),a=e("./enforced-simulations");const s=(0,i.createProjectLogger)("transaction-containers");async function l({isApproved:e,messenger:t,transactionMeta:r,types:i}){const{txParamsOriginal:l}=r,c=(0,o.cloneDeep)(r);if(l&&(c.txParams=(0,o.cloneDeep)(l)),i.includes(n.TransactionContainerType.EnforcedSimulations)){const{updateTransaction:r}=await(0,a.enforceSimulations)({messenger:t,transactionMeta:c,useRealSignature:e});r(c)}let d;if(!e){const{gas:e}=await t.call("TransactionController:estimateGas",c.txParams,c.networkClientId,{ignoreDelegationSignatures:!0});s("Estimated gas",e),d=e}return{updateTransaction:e=>{e.containerTypes=i,e.txParams=(0,o.cloneDeep)(c.txParams),d&&(e.txParams.gas=d)}}}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/util.ts"}],[337,{"../../../../../shared/lib/four-byte":5693,"@ethersproject/abi":698,"@metamask/utils":2914,"ethereumjs-util":4138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.decodeTransactionDataWithFourByte=async function(e){const t=e.slice(0,10),r=await(0,a.getMethodFrom4Byte)(t);if(!r)return undefined;const i=r.split("(")[0],u=function(e){let t=e.slice(e.indexOf("(")+1,-1);const r=[];for(;t.includes("(");){const e=d(t);if(!e)break;r.push(e.value),t=`${t.slice(0,e.start)}${r.length-1}#${t.slice(e.end+1)}`}return c(t,r)}(r);s("Generated inputs",u);const h=(0,n.addHexPrefix)(e.slice(10)),p=o.Interface.getAbiCoder().decode(u,h),m=u.map((e,t)=>l(e,t,p));return{name:i,params:m}};var n=e("ethereumjs-util"),o=e("@ethersproject/abi"),i=e("@metamask/utils"),a=e("../../../../../shared/lib/four-byte");const s=(0,i.createProjectLogger)("four-byte");function l(e,t,r){var n;const o=r[t],{type:i,name:a}=e;let s=null===(n=e.components)||void 0===n?void 0:n.map((e,t)=>l(e,t,o));if(i.endsWith("[]")){const t=i.slice(0,-2);s=o.map((r,n)=>{const i=`Item ${n+1}`;return l({...e,name:i,type:t},n,o)})}return{name:a,type:i,value:o,children:s}}function c(e,t){return e.split(",").map(e=>{const r=e.split("#"),n=r.length>1?parseInt(r[0],10):undefined;return{type:n===undefined?e:`tuple${r[1]??""}`,components:n===undefined?undefined:c(t[n],t)}})}function d(e){let t=-1;for(let r=0;r<e.length;r++)if("("===e[r])t=r;else if(")"===e[r]&&-1!==t)return{start:t,end:r,value:e.slice(t+1,r)};return undefined}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/four-byte.ts"}],[338,{"ethereumjs-util":4138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getContractProxyAddress=async function(e,t){const r=(await Promise.all(o.map(r=>t.request({method:"eth_getStorageAt",params:[e,r,"latest"]})))).find(e=>(0,n.stripHexPrefix)(e)!==i);return r&&(0,n.addHexPrefix)(r.slice(26))};var n=e("ethereumjs-util");const o=["0x7050c9e0f4ca769c69bd3a8ef740bc37934f8e2c036e5a723fd8ee048ed3f8c3","0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc"],i="0".padEnd(64,"0")}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/proxy.ts"}],[3387,{"./types.js":3388},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./types.js");const o={type:"xstate.init"},i="xstate.assign";function a(e){return e===undefined?[]:[].concat(e)}function s(e,t){return"string"==typeof(e="string"==typeof e&&t&&t[e]?t[e]:e)?{type:e}:"function"==typeof e?{type:e.name,exec:e}:e}function l(e){return t=>e===t}function c(e){return"string"==typeof e?{type:e}:e}function d(e,t){return{value:e,context:t,actions:[],changed:!1,matches:l(e)}}function u(e,t,r){let n=t,o=!1;return[e.filter(e=>{if(e.type===i){o=!0;let t=Object.assign({},n);return"function"==typeof e.assignment?t=e.assignment(n,r):Object.keys(e.assignment).forEach(o=>{t[o]="function"==typeof e.assignment[o]?e.assignment[o](n,r):e.assignment[o]}),n=t,!1}return!0}),n,o]}const h=(e,t)=>e.actions.forEach(({exec:r})=>r&&r(e.context,t));Object.defineProperty(r,"InterpreterStatus",{enumerable:!0,get:function(){return n.InterpreterStatus}}),r.assign=function(e){return{type:i,assignment:e}},r.createMachine=function(e,t={}){const[r,n]=u(a(e.states[e.initial].entry).map(e=>s(e,t.actions)),e.context,o),i={config:e,_options:t,initialState:{value:e.initial,actions:r,context:n,matches:l(e.initial)},transition:(t,r)=>{const{value:n,context:o}="string"==typeof t?{value:t,context:e.context}:t,h=c(r),p=e.states[n];if(p.on){const t=a(p.on[h.type]);for(const r of t){if(r===undefined)return d(n,o);const{target:t,actions:c=[],cond:m=()=>!0}="string"==typeof r?{target:r}:r,g=t===undefined,f=null!=t?t:n,y=e.states[f];if(m(o,h)){const e=(g?a(c):[].concat(p.exit,c,y.entry).filter(e=>e)).map(e=>s(e,i._options.actions)),[r,d,m]=u(e,o,h),f=null!=t?t:n;return{value:f,context:d,actions:r,changed:t!==n||r.length>0||m,matches:l(f)}}}}return d(n,o)}};return i},r.interpret=function(e){let t=e.initialState,r=n.InterpreterStatus.NotStarted;const i=new Set,a={_machine:e,send:o=>{r===n.InterpreterStatus.Running&&(t=e.transition(t,o),h(t,c(o)),i.forEach(e=>e(t)))},subscribe:e=>(i.add(e),e(t),{unsubscribe:()=>i.delete(e)}),start:i=>{if(i){const r="object"==typeof i?i:{context:e.config.context,value:i};t={value:r.value,actions:[],context:r.context,matches:l(r.value)}}else t=e.initialState;return r=n.InterpreterStatus.Running,h(t,o),a},stop:()=>(r=n.InterpreterStatus.Stopped,i.clear(),a),get state(){return t},get status(){return r}};return a}}}},{package:"@metamask/snaps-controllers>@xstate/fsm",file:"node_modules/@xstate/fsm/lib/index.js"}],[3388,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n;Object.defineProperty(r,"__esModule",{value:!0}),r.InterpreterStatus=void 0,(n=r.InterpreterStatus||(r.InterpreterStatus={}))[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped"}}},{package:"@metamask/snaps-controllers>@xstate/fsm",file:"node_modules/@xstate/fsm/lib/types.js"}],[339,{"@ethersproject/abi":698,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.decodeTransactionDataWithSourcify=async function(e,t,r){var s,l;const c=await async function(e,t){var r;const n=await async function(e,t){const r=parseInt(t,16),n=await fetch(`https://sourcify.dev/server/files/any/${r}/${e}`);if(!n.ok)throw new Error("Failed to fetch Sourcify files");return n.json()}(e,t),o=null===(r=n.files)||void 0===r?void 0:r.find(e=>e.name.includes("metadata.json"));if(!o)throw new Error("Metadata not found");return JSON.parse(o.content)}(t,r);o("Retrieved Sourcify metadata",{contractAddress:t,chainId:r,metadata:c});const{abi:d}=c.output,u=new n.Interface(d),h=e.slice(0,10);let p;try{p=u.getFunction(h)}catch(e){}if(!p)return o("Failed to find function in ABI",h,d),undefined;const{name:m,inputs:g}=p,f=a(m,g),y=null===(s=c.output.userdoc)||void 0===s?void 0:s.methods[f],v=null===(l=c.output.devdoc)||void 0===l?void 0:l.methods[f],C=(null==y?void 0:y.notice)??(null==v?void 0:v.details);o("Extracted NatSpec",{signature:f,userDoc:y,devDoc:v});const b=u.decodeFunctionData(h,e),w=g.map((e,t)=>i(e,t,b,y,v));return{name:m,description:C,params:w}};var n=e("@ethersproject/abi");const o=(0,e("@metamask/utils").createProjectLogger)("sourcify");function i(e,t,r,n,o){var a,s;const{name:l,type:c,components:d}=e,u=(null==n||null===(a=n.params)||void 0===a?void 0:a[l])??(null==o||null===(s=o.params)||void 0===s?void 0:s[l]),h=r[t];let p=null==d?void 0:d.map((e,t)=>i(e,t,h,{},{}));if(c.endsWith("[]")){const t=c.slice(0,-2);p=h.map((r,n)=>{const o=`Item ${n+1}`;return i({...e,name:o,type:t},n,h,{},{})})}return{name:l,description:u,type:c,value:h,children:p}}function a(e,t){return`${e??""}(${t.map(e=>{var t;return null!==(t=e.components)&&void 0!==t&&t.length?`${a(undefined,e.components)}${e.type.endsWith("[]")?"[]":""}`:e.type}).join(",")})`}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/sourcify.ts"}],[34,{"./claims-controller-init":32,"./claims-service-init":33},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ClaimsControllerInit",{enumerable:!0,get:function(){return n.ClaimsControllerInit}}),Object.defineProperty(r,"ClaimsServiceInit",{enumerable:!0,get:function(){return o.ClaimsServiceInit}});var n=e("./claims-controller-init"),o=e("./claims-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/claims/index.ts"}],[340,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.UNISWAP_ROUTER_COMMANDS=void 0;r.UNISWAP_ROUTER_COMMANDS={0:{name:"V3_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},1:{name:"V3_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},2:{name:"PERMIT2_TRANSFER_FROM",params:[{type:"address",description:"The token to fetch from Permit2",name:"token"},{type:"address",description:"The recipient of the tokens fetched",name:"recipient"},{type:"uint256",description:"The amount of token to fetch",name:"amount"}]},3:{name:"PERMIT2_PERMIT_BATCH",params:[{type:"bytes",description:"A PermitBatch struct outlining all of the Permit2 permits to execute.",name:"batch"},{type:"bytes",description:"The signature to provide to Permit2",name:"data"}]},4:{name:"SWEEP",params:[{type:"address",description:"The ERC20 token to sweep (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amountMin"}]},5:{name:"TRANSFER",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The amount to transfer",name:"value"}]},6:{name:"PAY_PORTION",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"In basis points, the percentage of the contracts balance to transfer",name:"bips"}]},8:{name:"V2_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},9:{name:"V2_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},10:{name:"PERMIT2_PERMIT",params:[{type:"bytes",description:"A PermitSingle struct outlining the Permit2 permit to execute",name:"permitSingle"},{type:"bytes",description:"The signature to provide to Permit2",name:"signature"}]},11:{name:"WRAP_ETH",params:[{type:"address",description:"The recipient of the WETH",name:"recipient"},{type:"uint256",description:"The amount of ETH to wrap",name:"amountMin"}]},12:{name:"UNWRAP_WETH",params:[{type:"address",description:"The recipient of the ETH",name:"recipient"},{type:"uint256",description:"The minimum required ETH to receive from the unwrapping",name:"amountMin"}]},13:{name:"PERMIT2_TRANSFER_FROM_BATCH",params:[{type:"bytes",description:"An array of AllowanceTransferDetails structs that each describe a Permit2 transfer to perform",name:"batchDetails"}]},16:{name:"SEAPORT",params:[{type:"uint256",description:"The ETH value to forward to the Seaport contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Seaport contract",name:"data"}]},17:{name:"LOOKS_RARE_721",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},18:{name:"NFTX",params:[{type:"uint256",description:"The ETH value to forward to the NFTX contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFTX contract",name:"data"}]},19:{name:"CRYPTOPUNKS",params:[{type:"uint256",description:"The PunkID to purchase",name:"punkId"},{type:"address",description:"The recipient for the cryptopunk",name:"recipient"},{type:"uint256",description:"The ETH value to forward to the Cryptopunks contract",name:"value"}]},20:{name:"LOOKS_RARE_1155",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},21:{name:"OWNER_CHECK_721",params:[{type:"address",description:"The required owner of the ERC721",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},22:{name:"OWNER_CHECK_1155",params:[{type:"address",description:"The required owner of the ERC1155",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The minimum required amount of the ERC1155",name:"minBalance"}]},23:{name:"SWEEP_ERC721",params:[{type:"address",description:"The ERC721 token address to transfer",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The token ID to transfer",name:"id"}]},24:{name:"X2Y2_721",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},25:{name:"SUDOSWAP",params:[{type:"uint256",description:"The ETH value to forward to the Sudoswap contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Sudoswap contract",name:"data"}]},26:{name:"NFT20",params:[{type:"uint256",description:"The ETH value to forward to the NFT20 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFT20 contract",name:"data"}]},27:{name:"X2Y2_1155",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},28:{name:"FOUNDATION",params:[{type:"uint256",description:"The ETH value to forward to the Foundation contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Foundation contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},29:{name:"SWEEP_ERC1155",params:[{type:"address",description:"The ERC1155 token address to sweep",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The token ID to sweep",name:"id"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amount"}]}}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap-commands.ts"}],[341,{"../../../../../shared/constants/network":5617,"../../../../../shared/modules/decoding":5735,"./uniswap-commands":340,"@ethersproject/abi":698},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES=void 0,r.decodeUniswapRouterTransactionData=function({transactionData:e,contractAddress:t,chainId:r}){const i=s[r];if(null==i||!i.map(e=>e.toLowerCase()).includes(t.toLowerCase()))return undefined;const c=new n.Interface(l);let d;try{d=c.parseTransaction({data:e})}catch(e){return undefined}const u=d.args.commands,h=d.args.inputs;return u.slice(2).match(/.{1,2}/gu).map((e,t)=>function(e,t){const r=parseInt(e,16),i=31&r,s=a.UNISWAP_ROUTER_COMMANDS[String(i)];if(!s)return undefined;const l=s.params.map(e=>e.type),c=n.Interface.getAbiCoder().decode(l,t),{name:d}=s,u=s.params.map((e,t)=>{const{name:r,type:n,description:i}=e,a=c[t];return{name:r,type:n,value:"path"===r?(0,o.decodeCommandV3Path)(a):a,description:i}});return{name:d,params:u}}(e,h[t])).filter(e=>e!==undefined)};var n=e("@ethersproject/abi"),o=e("../../../../../shared/modules/decoding"),i=e("../../../../../shared/constants/network"),a=e("./uniswap-commands");const s=r.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES={[i.CHAIN_IDS.ARBITRUM]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x5E325eDA8064b456f4781070C0738d849c824258"],[i.CHAIN_IDS.AVALANCHE]:["0x82635AF6146972cD6601161c4472ffe97237D292","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[i.CHAIN_IDS.BASE]:["0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[i.CHAIN_IDS.BSC]:["0x5Dc88340E1c5c6366864Ee415d6034cadd1A9897","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[i.CHAIN_IDS.MAINNET]:["0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[i.CHAIN_IDS.OPTIMISM]:["0xb555edF5dcF85f42cEeF1f3630a52A108E55A654","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8"],[i.CHAIN_IDS.POLYGON]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0x643770E279d5D0733F21d6DC03A8efbABf3255B4","0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2"],[i.CHAIN_IDS.SEPOLIA]:["0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"]},l=[{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"},{name:"deadline",type:"uint256"}],name:"execute",type:"function"},{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}],name:"execute",type:"function"}]}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap.ts"}],[342,{"../../../../../shared/types/transaction-decode":5767,"./four-byte":337,"./proxy":338,"./sourcify":339,"./uniswap":341,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.decodeTransactionData=async function({transactionData:e,contractAddress:t,chainId:r,provider:n}){c("Decoding transaction data",{transactionData:e,contractAddress:t,chainId:r});const u=(0,i.decodeUniswapRouterTransactionData)({transactionData:e,contractAddress:t,chainId:r});if(u)return c("Decoded with Uniswap commands",u),{data:d(u),source:o.DecodedTransactionDataSource.Uniswap};const h=await(0,s.getContractProxyAddress)(t,n);h&&c("Retrieved proxy implementation address",h);const p=h??t,m=(0,a.decodeTransactionDataWithSourcify)(e,p,r),g=(0,l.decodeTransactionDataWithFourByte)(e),[f,y]=await Promise.allSettled([m,g]);if("fulfilled"===f.status&&f.value)return c("Decoded data with Sourcify",f.value),{data:d([f.value]),source:o.DecodedTransactionDataSource.Sourcify};if(c("Failed to decode data with Sourcify",f),"fulfilled"===y.status&&y.value)return c("Decoded data with 4Byte",y.value),{data:d([y.value]),source:o.DecodedTransactionDataSource.FourByte};return c("Failed to decode data with 4Byte",y),undefined};var n=e("@metamask/utils"),o=e("../../../../../shared/types/transaction-decode"),i=e("./uniswap"),a=e("./sourcify"),s=e("./proxy"),l=e("./four-byte");const c=(0,n.createProjectLogger)("transaction-decode");function d(e){return e.map(e=>function(e){return{...e,params:e.params.map(e=>u(e))}}(e))}function u(e){var t;return{...e,value:h(e.value),children:null===(t=e.children)||void 0===t?void 0:t.map(e=>u(e))}}function h(e){const t=e._hex;return t?BigInt(t).toString():e}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/util.ts"}],[343,{"../../../../../shared/lib/delegation":5686,"../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder":5677,"../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder":5679,"../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder":5682,"../../../../../shared/lib/delegation/delegation":5683,"../../../../../shared/lib/eip7702-support-utils":5688,"../transaction-relay":347,"../util":348,"@ethersproject/abi":698,"@metamask/controller-utils":1383,"@metamask/metamask-eth-abis":2172,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.Delegation7702PublishHook=void 0;var n=e("@ethersproject/abi"),o=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),a=e("@metamask/controller-utils"),s=e("../../../../../shared/lib/delegation"),l=e("../../../../../shared/lib/eip7702-support-utils"),c=e("../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder"),d=e("../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder"),u=e("../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder"),h=e("../../../../../shared/lib/delegation/delegation"),p=e("../transaction-relay"),m=e("../util");function g(e,t,r){f(e,t),t.set(e,r)}function f(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t){return e.get(C(e,t))}function v(e,t,r){return e.set(C(e,t),r),r}function C(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}const b={transactionHash:undefined},w=(0,i.createProjectLogger)("delegation-7702-publish-hook");var S=new WeakMap,k=new WeakMap,T=new WeakMap,A=new WeakSet;async function M(e,t){try{return await C(A,this,E).call(this,e,t)}catch(e){throw w("Error",e),e}}async function E(e,t){const{chainId:r,gasFeeTokens:n,selectedGasFeeToken:o,txParams:i}=e,{from:a}=i,c=await y(S,this).call(this,{address:a,chainIds:[r]}),d=(0,l.findAtomicBatchSupportForChain)(c,r),{isSupported:u,delegationAddress:m,upgradeContractAddress:g}=(0,l.checkEip7702Support)(d);if(!u)return w("Skipping as EIP-7702 is not supported",{from:a,chainId:r}),b;const f=e.isGasFeeIncluded,v=Boolean(e.isGasFeeSponsored);if(!(o&&null!=n&&n.length||f||v))return w("Skipping as no selected gas fee token"),b;const k=f||v?undefined:null==n?void 0:n.find(e=>e.tokenAddress.toLowerCase()===(null==o?void 0:o.toLowerCase()));if(!k&&!f&&!v)throw new Error("Selected gas fee token not found");const T=(0,s.getDeleGatorEnvironment)(parseInt(e.chainId,16)),M=T.DelegationManager,E=!f&&!e.isGasFeeSponsored;if(E&&(!k||k===undefined))throw new Error("Gas fee token not found");const _=await C(A,this,P).call(this,T,e,k,E),R=[E?s.BATCH_DEFAULT_MODE:s.SINGLE_DEFAULT_MODE],F=C(A,this,I).call(this,e,k,E),O={chainId:r,data:(0,h.encodeRedeemDelegations)({delegations:_,modes:R,executions:F}),to:M};m||(O.authorizationList=await C(A,this,N).call(this,e,g??undefined)),w("Relay request",O);const{uuid:D}=await(0,p.submitRelayTransaction)(O),{transactionHash:x,status:B}=await(0,p.waitForRelayResult)({chainId:r,uuid:D,interval:1e3});if(B!==p.RelayStatus.Success)throw new Error(`Transaction relay error - ${B}`);return{transactionHash:x}}async function P(e,t,r,n){const o=C(A,this,_).call(this,e,t,r,n);w("Signing delegation");const i=await y(k,this).call("DelegationController:signDelegation",{chainId:t.chainId,delegation:o});w("Delegation signature",i);return[[{...o,signature:i}]]}function I(e,t,r){const{txParams:n}=e,{data:o,to:i,value:a}=n,s=C(A,this,D).call(this,o),l={target:i,value:BigInt(a??"0x0"),callData:s};if(!r)return[[l]];if(!t)throw new Error("Selected gas fee token not found");return[[l,{target:t.tokenAddress,value:BigInt("0x0"),callData:C(A,this,F).call(this,t.recipient,t.amount)}]]}function _(e,t,r,n){const o=C(A,this,R).call(this,e,t,r,n);w("Caveats",o);const i=(0,s.createDelegation)({from:t.txParams.from,to:h.ANY_BENEFICIARY,caveats:o});return w("Delegation",i),i}function R(e,t,r,n){const o=(0,s.createCaveatBuilder)(e),{txParams:i}=t,{to:a,value:l,data:h}=i,p=C(A,this,D).call(this,h);if(n&&r!==undefined){const{tokenAddress:e,recipient:t,amount:n}=r;a!==undefined&&o.addCaveat(u.specificActionERC20TransferBatch,e,t,n,a,l??"0x0",p)}else a!==undefined&&o.addCaveat(c.exactExecution,a,l??"0x0",p);return o.addCaveat(d.limitedCalls,1),o.build()}async function N(e,t){const{chainId:r,txParams:n,networkClientId:o}=e,{from:i,nonce:a}=n,s=await y(T,this).call(this,i,o),l=a??s;if(w("Including authorization as not upgraded"),!t)throw new Error("Upgrade contract address not found");const c=await y(k,this).call("KeyringController:signEip7702Authorization",{chainId:parseInt(r,16),contractAddress:t,from:i,nonce:parseInt(l,16)}),{r:d,s:u,yParity:h}=C(A,this,O).call(this,c);return w("Authorization signature",{authorizationSignature:c,r:d,s:u,yParity:h}),[{address:t,chainId:r,nonce:l,r:d,s:u,yParity:h}]}function F(e,t){return new n.Interface(o.abiERC20).encodeFunctionData("transfer",[e,t])}function O(e){const t=(0,m.stripSingleLeadingZero)(e.slice(0,66)),r=(0,m.stripSingleLeadingZero)((0,i.add0x)(e.slice(66,130))),n=parseInt(e.slice(130,132),16);return{r:t,s:r,yParity:(0,a.toHex)(n-27==0?0:1)}}function D(e){if("string"!=typeof e||0===e.length)return"0x";const t="0x"===e.slice(0,2).toLowerCase(),r=e.toLowerCase(),n=t?`0x${r.slice(2)}`:`0x${r}`,o=n.slice(2);return 0===o.length?"0x":o.length%2!=0?C(A,this,D).call(this,`0x0${o}`):n}r.Delegation7702PublishHook=class{constructor({isAtomicBatchSupported:e,messenger:t,getNextNonce:r}){var n,o;f(n=this,o=A),o.add(n),g(this,S,void 0),g(this,k,void 0),g(this,T,void 0),v(S,this,e),v(k,this,t),v(T,this,r)}getHook(){return C(A,this,M).bind(this)}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/delegation-7702-publish.ts"}],[344,{"../containers/util":336,"@metamask/controller-utils":1383,"@metamask/transaction-controller":2868,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.EnforceSimulationHook=void 0;e("@metamask/transaction-controller");var n=e("@metamask/utils");e("@metamask/controller-utils"),e("../containers/util");function o(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(a(e,t))}function a(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}const s=(0,n.createProjectLogger)("enforce-simulation-hook");var l=new WeakMap,c=new WeakSet;async function d(e,t){const{transactionMeta:r}=t,{isFinal:n}=e,{containerTypes:o,delegationAddress:a,id:c,origin:d,simulationData:u,txParamsOriginal:h}=r,p=i(l,this).call("AppStateController:getState");(null==p?void 0:p.enableEnforcedSimulationsForTransactions[c])??(null==p||p.enableEnforcedSimulations);return s("Skipping as enforced simulations are disabled"),{skipSimulation:!1}}r.EnforceSimulationHook=class{constructor({messenger:e}){var t,r;o(t=this,r=c),r.add(t),function(e,t,r){o(e,t),t.set(e,r)}(this,l,void 0),function(e,t,r){e.set(a(e,t),r)}(l,this,e)}getAfterSimulateHook(){return a(c,this,d).bind(this,{})}getBeforeSignHook(){return a(c,this,d).bind(this,{isFinal:!0})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/enforce-simulation-hook.ts"}],[345,{"../../../../shared/constants/app":5598,"../../../../shared/constants/gas":5606,"../../../../shared/constants/metametrics":5613,"../../../../shared/constants/transaction":5637,"../../../../shared/lib/confirmation.utils":5650,"../../../../shared/lib/transactions-controller-utils":5720,"../../../../shared/modules/Numeric":5727,"../../../../shared/modules/conversion.utils":5732,"../../../../shared/modules/gas.utils":5740,"../../../../shared/modules/metametrics":5743,"../../../../shared/modules/transaction.utils":5763,"../../../../ui/helpers/utils/metrics":6938,"../snap-keyring/metrics":322,"../util":353,"@metamask/transaction-controller":2868,"@metamask/utils":2914,"bignumber.js":3768,"ethereumjs-util":4138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.handleTransactionSubmitted=r.handleTransactionRejected=r.handleTransactionFailed=r.handleTransactionDropped=r.handleTransactionConfirmed=r.handleTransactionApproved=r.handleTransactionAdded=r.handlePostTransactionBalanceUpdate=r.createTransactionEventFragmentWithTxId=r.METRICS_STATUS_FAILED=void 0;var n=e("bignumber.js"),o=e("ethereumjs-util"),i=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("../../../../shared/constants/app"),l=e("../../../../shared/constants/gas"),c=e("../../../../shared/constants/metametrics"),d=e("../../../../shared/constants/transaction"),u=e("../../../../shared/lib/transactions-controller-utils"),h=e("../../../../shared/modules/conversion.utils"),p=e("../../../../shared/modules/metametrics"),m=e("../../../../shared/modules/transaction.utils"),g=e("../../../../ui/helpers/utils/metrics"),f=e("../snap-keyring/metrics"),y=e("../../../../shared/lib/confirmation.utils"),v=e("../../../../shared/modules/gas.utils"),C=e("../../../../shared/modules/Numeric"),b=e("../util");const w=(0,a.createProjectLogger)("transaction-metrics"),S=r.METRICS_STATUS_FAILED="failed on-chain",k=[i.TransactionType.bridge,i.TransactionType.bridgeApproval,i.TransactionType.contractInteraction,i.TransactionType.tokenMethodApprove,i.TransactionType.tokenMethodIncreaseAllowance,i.TransactionType.tokenMethodSafeTransferFrom,i.TransactionType.tokenMethodSetApprovalForAll,i.TransactionType.tokenMethodTransfer,i.TransactionType.tokenMethodTransferFrom,i.TransactionType.swap,i.TransactionType.swapAndSend,i.TransactionType.swapApproval];var T=function(e){return e.swap="mm_swap",e.bridge="mm_bridge",e}(T||{});r.handleTransactionAdded=async(e,t)=>{if(!t.transactionMeta)return;const{properties:r,sensitiveProperties:n}=await P({transactionEventPayload:t,transactionMetricsRequest:e});A({eventName:d.TransactionMetaMetricsEvent.added,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:r,sensitiveProperties:n}})};r.handleTransactionApproved=async(e,t)=>{t.transactionMeta&&await M({eventName:d.TransactionMetaMetricsEvent.approved,transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionFailed=async(e,t)=>{if(!t.transactionMeta)return;const r={};t.error&&(r.error=t.error),await M({eventName:d.TransactionMetaMetricsEvent.finalized,extraParams:r,transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionConfirmed=async(e,t)=>{if(0===Object.keys(t).length)return;const r={},n={...t},{txReceipt:o}=n;r.gas_used=null==o?void 0:o.gasUsed,r.block_number=(null==o?void 0:o.blockNumber)&&(0,h.hexToDecimal)(o.blockNumber);const{submittedTime:i,blockTimestamp:a}=n;i&&(r.completion_time=function(e){return Math.round((Date.now()-e)/1e3).toString()}(i)),i&&a&&(r.completion_time_onchain=function(e,t){const r=2,n=Number((0,h.hexToDecimal)(t))-e/1e3;return(Math.round(n*10**r)/10**r).toString()}(i,a)),"0x0"===(null==o?void 0:o.status)&&(r.status=S),await M({eventName:d.TransactionMetaMetricsEvent.finalized,extraParams:r,transactionEventPayload:{actionId:n.actionId,transactionMeta:n},transactionMetricsRequest:e})};r.handleTransactionDropped=async(e,t)=>{if(!t.transactionMeta)return;await M({eventName:d.TransactionMetaMetricsEvent.finalized,extraParams:{dropped:!0},transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionRejected=async(e,t)=>{t.transactionMeta&&await M({eventName:d.TransactionMetaMetricsEvent.rejected,transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionSubmitted=async(e,t)=>{if(!t.transactionMeta)return;const{properties:r,sensitiveProperties:n}=await P({transactionEventPayload:t,transactionMetricsRequest:e});A({eventName:d.TransactionMetaMetricsEvent.submitted,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:r,sensitiveProperties:n}})};r.createTransactionEventFragmentWithTxId=async(e,{transactionId:t,actionId:r})=>{const n={...e.getTransaction(t),actionId:r},{properties:o,sensitiveProperties:i}=await P({transactionEventPayload:{transactionMeta:n},transactionMetricsRequest:e});A({eventName:d.TransactionMetaMetricsEvent.approved,transactionEventPayload:{actionId:n.actionId,transactionMeta:n},transactionMetricsRequest:e,payload:{properties:o,sensitiveProperties:i}})};function A({eventName:e,transactionEventPayload:{transactionMeta:t,actionId:r},transactionMetricsRequest:n,payload:o}){if(function(e,t,r){const n=E(t,r.id);return void 0!==e(n)}(n.getEventFragmentById,e,t)&&e!==d.TransactionMetaMetricsEvent.submitted)return;const i=E(e,t.id);switch(e){case d.TransactionMetaMetricsEvent.added:n.createEventFragment({category:c.MetaMetricsEventCategory.Transactions,initialEvent:d.TransactionMetaMetricsEvent.added,successEvent:d.TransactionMetaMetricsEvent.approved,failureEvent:d.TransactionMetaMetricsEvent.rejected,properties:o.properties,sensitiveProperties:o.sensitiveProperties,actionId:r,uniqueIdentifier:i,persist:!0});break;case d.TransactionMetaMetricsEvent.approved:case d.TransactionMetaMetricsEvent.rejected:n.createEventFragment({category:c.MetaMetricsEventCategory.Transactions,successEvent:d.TransactionMetaMetricsEvent.approved,failureEvent:d.TransactionMetaMetricsEvent.rejected,properties:o.properties,sensitiveProperties:o.sensitiveProperties,actionId:r,uniqueIdentifier:i,persist:!0});break;case d.TransactionMetaMetricsEvent.submitted:n.createEventFragment({category:c.MetaMetricsEventCategory.Transactions,initialEvent:d.TransactionMetaMetricsEvent.submitted,successEvent:d.TransactionMetaMetricsEvent.finalized,properties:o.properties,sensitiveProperties:o.sensitiveProperties,actionId:r,uniqueIdentifier:i,persist:!0});break;case d.TransactionMetaMetricsEvent.finalized:n.createEventFragment({category:c.MetaMetricsEventCategory.Transactions,successEvent:d.TransactionMetaMetricsEvent.finalized,properties:o.properties,sensitiveProperties:o.sensitiveProperties,actionId:r,uniqueIdentifier:i,persist:!0})}}async function M({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r,extraParams:n={}}){const{properties:o,sensitiveProperties:i}=await P({transactionEventPayload:t,transactionMetricsRequest:r,extraParams:n});A({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r,payload:{properties:o,sensitiveProperties:i}}),function({eventName:e,transactionEventPayload:{transactionMeta:t},transactionMetricsRequest:r,payload:n}){const o=E(e,t.id);switch(e){case d.TransactionMetaMetricsEvent.approved:case d.TransactionMetaMetricsEvent.rejected:case d.TransactionMetaMetricsEvent.finalized:r.updateEventFragment(o,{properties:n.properties,sensitiveProperties:n.sensitiveProperties})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r,payload:{properties:o,sensitiveProperties:i}}),function({eventName:e,transactionMetricsRequest:t,transactionEventPayload:{transactionMeta:r}}){const n=E(e,r.id);switch(e){case d.TransactionMetaMetricsEvent.approved:case d.TransactionMetaMetricsEvent.finalized:t.finalizeEventFragment(n);break;case d.TransactionMetaMetricsEvent.rejected:t.finalizeEventFragment(n,{abandoned:!0})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r})}function E(e,t){return`transaction-${e===d.TransactionMetaMetricsEvent.finalized||e===d.TransactionMetaMetricsEvent.submitted?"submitted":"added"}-${t}`}async function P({transactionEventPayload:{transactionMeta:e},transactionMetricsRequest:t,extraParams:r={}}){var S;const{type:T,time:A,status:M,chainId:E,origin:P,txParams:{gasPrice:_,gas:R,maxFeePerGas:N,maxPriorityFeePerGas:F,estimateSuggested:O,estimateUsed:D},defaultGasEstimates:x,originalType:B,replacedById:j,customTokenAmount:L,dappProposedTokenAmount:U,currentTokenBalance:$,originalApprovalAmount:K,finalApprovalAmount:q,securityProviderResponse:H,simulationFails:G,id:W,userFeeLevel:V}=e,z=P===s.ORIGIN_METAMASK?"user":"dapp",Q="dappSuggested"===V?"dapp_proposed":V,{assetType:Y,tokenStandard:J}=await(0,m.determineTransactionAssetType)(e,t.provider,t.getTokenStandardAndDetails);let X;if(e.txParams.data){const r=await t.getMethodData(e.txParams.data);X=null==r?void 0:r.name}const Z={};if((0,m.isEIP1559Transaction)(e)?(Z.max_fee_per_gas=N,Z.max_priority_fee_per_gas=F):(Z.gas_price=_,Z.default_estimate=c.MetaMetricsEventTransactionEstimateType.DefaultEstimate),x){var ee,te;const{estimateType:r}=x;if(r){var re,ne;Z.default_estimate=r===l.PriorityLevels.dAppSuggested?c.MetaMetricsEventTransactionEstimateType.DappProposed:r;let n=null===(re=e.defaultGasEstimates)||void 0===re?void 0:re.maxFeePerGas,o=null===(ne=e.defaultGasEstimates)||void 0===ne?void 0:ne.maxPriorityFeePerGas;if([l.GasRecommendations.low,l.GasRecommendations.medium,l.GasRecommendations.high].includes(r)){var oe,ie;const{gasFeeEstimates:e}=await t.getEIP1559GasFeeEstimates();var ae,se;if(null!=e&&null!==(oe=e[r])&&void 0!==oe&&oe.suggestedMaxFeePerGas)n=null===(ae=e[r])||void 0===ae?void 0:ae.suggestedMaxFeePerGas,Z.default_max_fee_per_gas=n;if(null!=e&&null!==(ie=e[r])&&void 0!==ie&&ie.suggestedMaxPriorityFeePerGas)o=null===(se=e[r])||void 0===se?void 0:se.suggestedMaxPriorityFeePerGas,Z.default_max_priority_fee_per_gas=o}}null!==(ee=e.defaultGasEstimates)&&void 0!==ee&&ee.gas&&(Z.default_gas=e.defaultGasEstimates.gas),null!==(te=e.defaultGasEstimates)&&void 0!==te&&te.gasPrice&&(Z.default_gas_price=e.defaultGasEstimates.gasPrice)}O&&(Z.estimate_suggested=O),D&&(Z.estimate_used=D),null!=r&&r.gas_used&&(Z.gas_used=r.gas_used);const le=function(e){const t={};for(const r in e)(0,o.isHexString)(e[r])?t[r]=(0,h.hexWEIToDecGWEI)(e[r]):t[r]=e[r];return t}(Z);let ce="0";e.txParams.maxFeePerGas&&(ce="2");const de="Approve";let ue,he,pe,me,ge,fe;const{transactionType:ye,isContractInteraction:ve}=function(e,t){const r=e&&k.includes(e);if([i.TransactionType.swapAndSend,i.TransactionType.cancel,i.TransactionType.deployContract,i.TransactionType.gasPayment,i.TransactionType.batch,i.TransactionType.shieldSubscriptionApprove].includes(e))return{transactionType:e,isContractInteraction:r};if(e===i.TransactionType.retry&&t)return{transactionType:t,isContractInteraction:r};if(r){const t=I(e);return t?{transactionType:t,isContractInteraction:!0}:{transactionType:i.TransactionType.contractInteraction,isContractInteraction:!0}}return{transactionType:i.TransactionType.simpleSend,isContractInteraction:!1}}(T,B);var Ce,be;ve&&(he=X,ge=null===(Ce=e.txParams)||void 0===Ce?void 0:Ce.to,fe=null===(be=e.txParams)||void 0===be||null===(be=be.data)||void 0===be?void 0:be.slice(0,10),he===de&&J===d.TokenStandard.ERC20&&("0"===U||"0"===L?ue=d.TransactionApprovalAmountType.revoke:L&&L!==U?ue=d.TransactionApprovalAmountType.custom:U&&(ue=d.TransactionApprovalAmountType.dappProposed),pe=function(e,t,r){if(e===d.TransactionApprovalAmountType.custom&&t&&r)return`${new n.BigNumber(t,10).div(r,10).times(100).round(2)}`;return null}(ue,K,q),me=function(e,t,r){if((e===d.TransactionApprovalAmountType.custom||e===d.TransactionApprovalAmountType.dappProposed)&&t&&r)return`${new n.BigNumber(t,16).div(r,10).times(100).round(2)}`;return null}(ue,U,$)));const we=t.getTransaction(j),Se={RETRY:i.TransactionType.retry,CANCEL:i.TransactionType.cancel,SAME_NONCE:"other"};let ke;null!=r&&r.dropped&&(ke=Se.SAME_NONCE,(null==we?void 0:we.type)===i.TransactionType.cancel?ke=Se.CANCEL:(null==we?void 0:we.type)===i.TransactionType.retry&&(ke=Se.RETRY));const Te=[];let Ae=null;1===(null==H?void 0:H.flagAsDangerous)?Te.push(c.MetaMetricsEventUiCustomization.FlaggedAsMalicious):2===(null==H?void 0:H.flagAsDangerous)&&Te.push(c.MetaMetricsEventUiCustomization.FlaggedAsSafetyUnknown);const Me=(0,g.getBlockaidMetricsProps)(e);(null==Me||null===(S=Me.ui_customizations)||void 0===S?void 0:S.length)>0&&Te.push(...Me.ui_customizations),G&&Te.push(c.MetaMetricsEventUiCustomization.GasEstimationFailed);(0,y.shouldUseRedesignForTransactions)({transactionMetadataType:e.type})&&(Te.push(c.MetaMetricsEventUiCustomization.RedesignedConfirmation),Ae=t.getIsConfirmationAdvancedDetailsOpen());const Ee=(0,p.getSmartTransactionMetricsProperties)(t,e),Pe=(0,g.getSwapAndSendMetricsProps)(e),Ie={hd_entropy_index:t.getHDEntropyIndex()};let _e;try{_e=await t.getAccountType(t.getSelectedAddress())}catch(e){_e="error",w("Error getting account type for transaction metrics:",e)}let Re={chain_id:E,referrer:P,source:z,status:M,network:`${parseInt(E,16)}`,eip_1559_version:ce,gas_edit_type:"none",gas_edit_attempted:"none",gas_estimation_failed:Boolean(G),account_type:_e,device_model:await t.getDeviceModel(t.getSelectedAddress()),asset_type:Y,token_standard:J,transaction_type:ye,transaction_speed_up:T===i.TransactionType.retry,transaction_internal_id:W,gas_fee_selected:Q,...Me,ui_customizations:Te.length>0?Te:null,transaction_advanced_view:Ae,transaction_contract_method:he?[he]:[],...Ee,...Pe,...Ie};const Ne=await(0,f.getSnapAndHardwareInfoForMetrics)(t.getAccountType,t.getDeviceModel,t.getHardwareTypeForMetric,t.snapAndHardwareMessenger);var Fe,Oe;(Object.assign(Re,Ne),he===de||I(T))&&(Re={...Re,simulation_receiving_assets_total_value:Re.simulation_receiving_assets_total_value??(null==e||null===(Fe=e.assetsFiatValues)||void 0===Fe?void 0:Fe.receiving),simulation_sending_assets_total_value:Re.simulation_sending_assets_total_value??(null==e||null===(Oe=e.assetsFiatValues)||void 0===Oe?void 0:Oe.sending),transaction_approval_amount_type:ue});let De={transaction_envelope_type:(0,m.isEIP1559Transaction)(e)?u.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:u.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:A,gas_limit:R,transaction_replaced:ke,transaction_contract_address:ge?[ge]:[],transaction_contract_method_4byte:fe,...r,...le};if(he===de&&(De={...De,transaction_approval_amount_vs_balance_ratio:me,transaction_approval_amount_vs_proposed_ratio:pe}),await async function(e,t,r,n){const o=origin&&origin!==s.ORIGIN_METAMASK,{delegationAddress:a,nestedTransactions:l,txParams:c}=e,{authorizationList:u}=c,h=Boolean(null==l?void 0:l.length),p=Boolean(null==u?void 0:u.length);o&&(r.api_method=h?s.MESSAGE_TYPE.WALLET_SEND_CALLS:s.MESSAGE_TYPE.ETH_SEND_TRANSACTION);h&&(r.batch_transaction_count=null==l?void 0:l.length,r.batch_transaction_method="eip7702",r.transaction_contract_method=await async function(e,t){const r=e.filter(e=>k.includes(e.type)&&e.data).map(e=>e.data),n=await Promise.all(r.map(e=>t(e)));return n.map(e=>null==e?void 0:e.name).filter(e=>null==e?void 0:e.length)}(l??[],t),n.transaction_contract_address=null==l?void 0:l.filter(e=>{var t;return k.includes(e.type)&&(null===(t=e.to)||void 0===t?void 0:t.length)}).map(e=>e.to));if(e.status===i.TransactionStatus.rejected){const{error:t}=e;r.eip7702_upgrade_rejection=p&&t.code===d.EIP5792ErrorCode.RejectedUpgrade}r.eip7702_upgrade_transaction=p,n.account_eip7702_upgraded=a}(e,t.getMethodData,Re,De),function(e,t,r,n){var o;const{gasFeeTokens:i,selectedGasFeeToken:s}=e;t.gas_payment_tokens_available=null==i?void 0:i.map(e=>e.symbol),t.gas_paid_with=null==i||null===(o=i.find(e=>e.tokenAddress.toLowerCase()===(null==s?void 0:s.toLowerCase())))||void 0===o?void 0:o.symbol,(null==s?void 0:s.toLowerCase())===d.NATIVE_TOKEN_ADDRESS&&(t.gas_paid_with="pre-funded_ETH");t.gas_insufficient_native_asset=function(e,t){const{chainId:r,txParams:n}=e,{from:o,gas:i,gasPrice:s,maxFeePerGas:l,value:c}=n,d=t(o,r),u=(0,v.getMaximumGasTotalInHexWei)({gasLimit:i,gasPrice:s,maxFeePerGas:l}),p=(0,a.add0x)((0,h.addHexes)(u,c??"0x0"));return new C.Numeric(p,16).greaterThan(new C.Numeric(d,16))}(e,n)}(e,Re,0,t.getAccountBalance),M===i.TransactionStatus.submitted||M===i.TransactionStatus.confirmed){const r=t.getNetworkRpcUrl(e.chainId),n=(0,b.extractRpcDomain)(r);Re.rpc_domain=n}return{properties:Re,sensitiveProperties:De}}function I(e){return e===i.TransactionType.swap?T.swap:e===i.TransactionType.bridge?T.bridge:null}r.handlePostTransactionBalanceUpdate=async({getParticipateInMetrics:e,trackEvent:t,getHDEntropyIndex:r},{transactionMeta:o,approvalTransactionMeta:i})=>{var a;if(e()&&o.swapMetaData)if("0x0"===(null===(a=o.txReceipt)||void 0===a?void 0:a.status))t({event:c.MetaMetricsEventName.SwapFailed,category:c.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...o.swapMetaData},properties:{hd_entropy_index:r()}});else{var s;const e=(0,u.getSwapsTokensReceivedFromTxMeta)(o.destinationTokenSymbol,o,o.destinationTokenAddress,o.txParams.from,o.destinationTokenDecimals,i,o.chainId),a=e?`${new n.BigNumber(e,10).div(o.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,l=null!==(s=o.txReceipt)&&void 0!==s&&s.gasUsed&&o.swapMetaData.estimated_gas?`${new n.BigNumber(o.txReceipt.gasUsed,16).div(o.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,d=function(e,t){var r,o;let i="0x0";null!=t&&t.txReceipt&&(i=(0,u.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice));const a=(0,u.calcGasTotal)(null===(r=e.txReceipt)||void 0===r?void 0:r.gasUsed,null===(o=e.txReceipt)||void 0===o?void 0:o.effectiveGasPrice),s=new n.BigNumber(a,16).plus(i,16).toString(16);return{approvalGasCostInEth:Number((0,h.hexWEIToDecETH)(i)),tradeGasCostInEth:Number((0,h.hexWEIToDecETH)(a)),tradeAndApprovalGasCostInEth:Number((0,h.hexWEIToDecETH)(s))}}(o,i);t({event:c.MetaMetricsEventName.SwapCompleted,category:c.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...o.swapMetaData,token_to_amount_received:e,quote_vs_executionRatio:a,estimated_vs_used_gasRatio:l,approval_gas_cost_in_eth:d.approvalGasCostInEth,trade_gas_cost_in_eth:d.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:d.tradeAndApprovalGasCostInEth,token_to_amount:o.swapMetaData.token_to_amount.toString(10)},properties:{hd_entropy_index:r()}})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/metrics.ts"}],[346,{"../../../../shared/modules/conversion.utils":5732,"../../../../shared/modules/fetch-with-timeout":5739},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.buildUrl=d,r.getSendBundleSupportedChains=async function(e){const t=await l();return e.reduce((e,r)=>{const n=(0,o.hexToDecimal)(r),i=t[n];return e[r]=(null==i?void 0:i.sendBundle)??!1,e},{})},r.getSentinelNetworkFlags=c,r.isSendBundleSupported=async function(e){const t=await c(e);if(null==t||!t.sendBundle)return!1;return!0};var n,o=e("../../../../shared/modules/conversion.utils"),i=(n=e("../../../../shared/modules/fetch-with-timeout"))&&n.__esModule?n:{default:n};const a="https://tx-sentinel-{0}.api.cx.metamask.io/",s="networks";async function l(){const e=`${d("ethereum-mainnet")}${s}`;return(await(0,i.default)()(e)).json()}async function c(e){const t=(0,o.hexToDecimal)(e);return(await l())[t]}function d(e){return a.replace("{0}",e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/sentinel-api.ts"}],[347,{"../../../../shared/modules/fetch-with-timeout":5739,"../../../../shared/modules/rpc.utils":5748,"./sentinel-api":346,"@metamask/utils":2914},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.RelayStatus=r.RELAY_RPC_METHOD=void 0,r.isRelaySupported=async function(e){return Boolean(await u(e))},r.submitRelayTransaction=async function(e){const{chainId:t}=e,r=await u(t);if(!r)throw new Error(`Chain not supported by transaction relay - ${t}`);l("Request",r,e);const n=await(0,i.jsonRpcRequest)(r,d,[e]);return l("Response",n),n},r.waitForRelayResult=async function(e){const{chainId:t,interval:r,uuid:n}=e,o=await u(t);if(!o)throw new Error(`Chain not supported by transaction relay - ${t}`);const i=`${o}smart-transactions/${n}`;return new Promise((e,t)=>{const n=setInterval(async()=>{try{const t=await async function(e){l("Polling request",e);const t=await(0,a.default)()(e);if(l("Polling response",t),!t.ok){const e=await t.text();throw new Error(`Failed to fetch relay transaction status: ${t.status} - ${e}`)}const r=await t.json(),n=null==r?void 0:r.transactions[0],{hash:o,status:i}=n||{};return{status:i,transactionHash:o}}(i);t.status!==c.Pending&&(clearInterval(n),e(t))}catch(e){clearInterval(n),t(e)}},r)})};var n,o=e("@metamask/utils"),i=e("../../../../shared/modules/rpc.utils"),a=(n=e("../../../../shared/modules/fetch-with-timeout"))&&n.__esModule?n:{default:n},s=e("./sentinel-api");const l=(0,o.createProjectLogger)("transaction-relay");let c=r.RelayStatus=function(e){return e.Pending="PENDING",e.Success="VALIDATED",e}({});const d=r.RELAY_RPC_METHOD="eth_sendRelayTransaction";async function u(e){const t=await(0,s.getSentinelNetworkFlags)(e);return null!=t&&t.relayTransactions?(0,s.buildUrl)(t.network):(l("Chain is not supported",e),undefined)}}}},{package:"$root$",file:"app/scripts/lib/transaction/transaction-relay.ts"}],[348,{"../../../../shared/constants/app":5598,"../../../../shared/constants/security-provider":5626,"../../../../shared/lib/trace":5718,"../../../../shared/lib/trust-signals":5724,"../ppom/ppom-util":293,"../trust-signals/security-alerts-api":349,"@metamask/keyring-api":2100,"ethereumjs-util":4138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.addDappTransaction=async function(e){const{dappRequest:t}=e,{id:r,method:n,origin:o}=t,{securityAlertResponse:i,traceContext:a}=t,l={actionId:r,method:n,origin:o,requireApproval:!0,securityAlertResponse:i};(0,s.endTrace)({name:s.TraceName.Middleware,id:r});const{waitForHash:c}=await u({...e,transactionOptions:{...l,traceContext:a}}),d=await c();return(0,s.endTrace)({name:s.TraceName.Transaction,id:r}),d},r.addTransaction=async function(e){await async function(e){const{chainId:t,ppomController:r,securityAlertsEnabled:n,transactionOptions:o,transactionParams:s,updateSecurityAlertResponse:u,internalAccounts:h,getSecurityAlertsConfig:p}=e;!function(e){const{getSecurityAlertResponse:t,addSecurityAlertResponse:r,securityAlertsEnabled:n,transactionOptions:o,transactionParams:i,chainId:a}=e,{origin:s}=o;if(s!==l.ORIGIN_METAMASK||!n)return;const{to:u}=i;if("string"!=typeof u)return;const h=(0,d.mapChainIdToSupportedEVMChain)(a);if(!h)return;const p=e=>t(e),m=(e,t)=>r(e,t);(0,c.scanAddressAndAddToCache)(u,p,m,h).catch(e=>{console.error("[scanAddressForTrustSignals] error scanning address for trust signals:",e)})}(e);const{type:m}=o,g=a.SECURITY_PROVIDER_EXCLUDED_TRANSACTION_TYPES.includes(m);if(!n||g)return;if(h.some(({address:e})=>{var t;return e.toLowerCase()===(null===(t=s.to)||void 0===t?void 0:t.toLowerCase())}))return;try{const{from:n,to:l,value:c,data:d}=s,{actionId:h,origin:m}=o,g={method:"eth_sendTransaction",id:h??"",origin:m??"",params:[{from:n,to:l??"",value:c??"",data:d??""}],jsonrpc:"2.0"},f=(0,i.generateSecurityAlertId)();(0,i.validateRequestWithPPOM)({ppomController:r,request:g,securityAlertId:f,chainId:t,updateSecurityAlertResponse:u,getSecurityAlertsConfig:p});const y={...a.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:f};e.transactionOptions.securityAlertResponse=y}catch(e){(0,i.handlePPOMError)(e,"Error validating JSON RPC using PPOM: ")}}(e);const{transactionMeta:t,waitForHash:r}=await u(e);if(!e.waitForSubmit)return r().catch(()=>{}),t;const n=await r();return function(e,t){return t.state.transactions.find(t=>t.hash===e)}(n,e.transactionController)},r.getTransactionById=h,r.stripSingleLeadingZero=function(e){if(!e.startsWith("0x0")||e.length<=3)return e;return`0x${e.slice(3)}`};var n=e("@metamask/keyring-api"),o=e("ethereumjs-util"),i=e("../ppom/ppom-util"),a=e("../../../../shared/constants/security-provider"),s=e("../../../../shared/lib/trace"),l=e("../../../../shared/constants/app"),c=e("../trust-signals/security-alerts-api"),d=e("../../../../shared/lib/trust-signals");async function u(e){const{selectedAccount:t}=e;return t.type===n.EthAccountType.Erc4337?async function(e){var t;const{networkClientId:r,transactionController:n,transactionOptions:i,transactionParams:a,userOperationController:s}=e,{maxFeePerGas:l,maxPriorityFeePerGas:c}=a,{origin:d,requireApproval:u,type:p}=i,m={...a,maxFeePerGas:(0,o.addHexPrefix)(l),maxPriorityFeePerGas:(0,o.addHexPrefix)(c)},g=null==i||null===(t=i.swaps)||void 0===t?void 0:t.meta;null!=g&&g.type&&delete g.type;const f={networkClientId:r,origin:d,requireApproval:u,swaps:g,type:p},y=await s.addUserOperationFromTransaction(m,f);s.startPollingByNetworkClientId(r);return{transactionMeta:h(y.id,n),waitForHash:y.transactionHash}}(e):async function(e){const{transactionController:t,transactionOptions:r,transactionParams:n,networkClientId:o}=e,{result:i,transactionMeta:a}=await t.addTransaction(n,{...r,networkClientId:o});return{transactionMeta:a,waitForHash:()=>i}}(e)}function h(e,t){return t.state.transactions.find(t=>t.id===e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/util.ts"}],[349,{"../../../../shared/constants/time":5635,"../../../../shared/lib/trust-signals":5724,"../../../../shared/modules/fetch-with-timeout":5739},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.scanAddress=c,r.scanAddressAndAddToCache=async function(e,t,r,n){const o=(0,a.createCacheKey)(n,e),i=t(o);if(i)return i;const s={result_type:a.ResultType.Loading,label:""};r(o,s);try{const t=await c(n,e);return r(o,t),t}catch(e){throw r(o,{result_type:a.ResultType.ErrorResult,label:""}),e}};var n,o=e("../../../../shared/constants/time"),i=(n=e("../../../../shared/modules/fetch-with-timeout"))&&n.__esModule?n:{default:n},a=e("../../../../shared/lib/trust-signals");const s=5*o.SECOND,l="address/evm/scan";async function c(e,t){const r="https://security-alerts.api.cx.metamask.io";const n=`${r}/${l}`,o={chain:e,address:t},a=await(0,i.default)(s)(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await a.json()}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/security-alerts-api.ts"}],[35,{"@metamask/address-book-controller":1193},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.AddressBookControllerInit=void 0;var n=e("@metamask/address-book-controller");r.AddressBookControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new n.AddressBookController({messenger:e,state:t.AddressBookController})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/address-book-controller-init.ts"}],[350,{"../../../../shared/constants/signatures":5627,"../../../../shared/lib/trust-signals":5724,"../../../../shared/modules/transaction.utils":5763,"../ppom/security-alerts-api":295,"./security-alerts-api":349,"./trust-signals-util":351},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createTrustSignalsMiddleware=function(e,t,r,d,u){return async(h,p,m)=>{try{if(!(0,l.isSecurityAlertsEnabledByUser)(d)||!(0,i.isSecurityAlertsAPIEnabled)())return;(0,l.isEthSendTransaction)(h)?(!function(e,t,r){if(!(0,l.hasValidTransactionParams)(e))return;const{to:o,data:i}=e.params[0],{chainId:c}=r.getNetworkConfigurationByNetworkClientId(e.networkClientId)??{};if(!c)return void console.error("ChainID not found for networkClientId");const d=(0,a.mapChainIdToSupportedEVMChain)(c);if(!d)return void console.error("Unsupported chainId:",c);if((0,s.scanAddressAndAddToCache)(o,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,d).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for transaction:",e)}),i&&"string"==typeof i){const e=(0,n.parseApprovalTransactionData)(i),r=null==e?void 0:e.spender;r&&(0,s.scanAddressAndAddToCache)(r,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,d).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning spender address for approval:",e)})}}(h,t,e),c(h,r)):(0,l.isEthSignTypedData)(h)?(!function(e,t,r){var i;if(!(0,l.hasValidTypedDataParams)(e))return;const c=(0,n.parseTypedDataMessage)("string"==typeof e.params[1]?e.params[1]:JSON.stringify(e.params[1])),d=null===(i=c.domain)||void 0===i?void 0:i.verifyingContract;if(!d)return;const{chainId:u}=r.getNetworkConfigurationByNetworkClientId(e.networkClientId)??{};if(!u)return void console.error("ChainID not found for networkClientId");const h=(0,a.mapChainIdToSupportedEVMChain)(u);if(!h)return void console.error("Unsupported chainId:",u);(0,s.scanAddressAndAddToCache)(d,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,h).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for signature:",e)});const{primaryType:p}=c;if(!p)return;if(o.PRIMARY_TYPES_PERMIT.includes(p)){var m;const e=null===(m=c.message)||void 0===m?void 0:m.spender;e&&(0,s.scanAddressAndAddToCache)(e,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,h).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning spender address for permit:",e)})}}(h,t,e),c(h,r)):((0,l.isConnected)(h,u)||(0,l.connectScreenHasBeenPrompted)(h))&&c(h,r)}catch(e){console.error("[createTrustSignalsMiddleware] error: ",e)}finally{m()}}};var n=e("../../../../shared/modules/transaction.utils"),o=e("../../../../shared/constants/signatures"),i=e("../ppom/security-alerts-api"),a=e("../../../../shared/lib/trust-signals"),s=e("./security-alerts-api"),l=e("./trust-signals-util");function c(e,t){e.origin&&t.scanUrl(e.origin).catch(e=>{console.error("[createTrustSignalsMiddleware] error:",e)})}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-middleware.ts"}],[351,{"../../../../shared/constants/app":5598,"../../../../shared/lib/trust-signals":5724,"../../../../shared/modules/selectors/networks":5753},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.connectScreenHasBeenPrompted=function(e){return e.method===o.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS||e.method===o.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS},r.getChainId=function(e){var t;const r=null===(t=(0,n.getProviderConfig)({metamask:e.state}))||void 0===t?void 0:t.chainId;if(!r)throw new Error("Chain ID not found");return(0,i.mapChainIdToSupportedEVMChain)(r)},r.hasValidTransactionParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||0===e.params.length)return!1;const t=e.params[0];return"object"==typeof t&&null!==t&&"to"in t},r.hasValidTypedDataParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||e.params.length<2)return!1;return e.params[1]!==undefined&&null!==e.params[1]},r.isConnected=function(e,t){if(!e.origin||e.method!==o.MESSAGE_TYPE.ETH_ACCOUNTS)return!1;const r=t(e.origin);return Array.isArray(r)&&r.length>0},r.isEthSendTransaction=function(e){return e.method===o.MESSAGE_TYPE.ETH_SEND_TRANSACTION},r.isEthSignTypedData=function(e){return e.method===o.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA||e.method===o.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1||e.method===o.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3||e.method===o.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4},r.isSecurityAlertsEnabledByUser=function(e){const{securityAlertsEnabled:t}=e.state;return t};var n=e("../../../../shared/modules/selectors/networks"),o=e("../../../../shared/constants/app"),i=e("../../../../shared/lib/trust-signals")}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-util.ts"}],[352,{loglevel:4643},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.updateRemoteFeatureFlags=async function(e){try{const t=e.remoteFeatureFlagController;await t.updateRemoteFeatureFlags()}catch(e){o.default.error("Error initializing remote feature flags:",e)}};var n,o=(n=e("loglevel"))&&n.__esModule?n:{default:n}}}},{package:"$root$",file:"app/scripts/lib/update-remote-feature-flags.ts"}],[354,{"../../shared/constants/app":5598,"../../shared/constants/bridge":5600,"../../shared/constants/hardware-wallets":5607,"../../shared/constants/keyring":5609,"../../shared/constants/metametrics":5613,"../../shared/constants/multichain/networks":5616,"../../shared/constants/network":5617,"../../shared/constants/onboarding":5620,"../../shared/constants/permissions":5621,"../../shared/constants/referrals":5624,"../../shared/constants/time":5635,"../../shared/constants/tokens":5636,"../../shared/constants/transaction":5637,"../../shared/lib/accounts":5642,"../../shared/lib/accounts/bitcoin-wallet-snap":5641,"../../shared/lib/accounts/solana-wallet-snap":5645,"../../shared/lib/accounts/tron-wallet-snap":5646,"../../shared/lib/delegation/delegation":5683,"../../shared/lib/eip7702-support-utils":5688,"../../shared/lib/eip7702-utils":5689,"../../shared/lib/fetch-with-cache":5692,"../../shared/lib/metamask-controller-utils":5701,"../../shared/lib/multichain-accounts/remote-feature-flag":5702,"../../shared/lib/sentry":5711,"../../shared/lib/shield":5712,"../../shared/lib/snaps/snaps":5713,"../../shared/lib/storage-helpers":5714,"../../shared/lib/token-util":5717,"../../shared/lib/trace":5718,"../../shared/lib/transactions-controller-utils":5720,"../../shared/lib/translate":5723,"../../shared/modules/environment":5736,"../../shared/modules/hexstring-utils":5741,"../../shared/modules/mv3.utils":5744,"../../shared/modules/network.utils":5745,"../../shared/modules/selectors":5751,"../../shared/modules/selectors/multichain":5752,"../../shared/modules/selectors/networks":5753,"../../shared/modules/shield":5757,"../../shared/modules/string-utils":5761,"../../shared/modules/transaction.utils":5763,"./constants/stream":13,"./controller-init/account-order-controller-init":14,"./controller-init/account-tracker-controller-init":15,"./controller-init/accounts-controller-init":16,"./controller-init/accounts/account-tree-controller-init":17,"./controller-init/accounts/snap-keyring-builder-init":18,"./controller-init/alert-controller-init":19,"./controller-init/announcement-controller-init":20,"./controller-init/app-metadata-controller-init":21,"./controller-init/app-state-controller-init":22,"./controller-init/assets":24,"./controller-init/assets/network-enablement-controller-init":25,"./controller-init/bridge-controller-init":30,"./controller-init/bridge-status-controller-init":31,"./controller-init/claims":34,"./controller-init/confirmations/address-book-controller-init":35,"./controller-init/confirmations/approval-controller-init":36,"./controller-init/confirmations/decrypt-message-controller-init":37,"./controller-init/confirmations/decrypt-message-manager-init":38,"./controller-init/confirmations/encryption-public-key-controller-init":39,"./controller-init/confirmations/encryption-public-key-message-manager-init":40,"./controller-init/confirmations/ens-controller-init":41,"./controller-init/confirmations/gas-fee-controller-init":42,"./controller-init/confirmations/name-controller-init":43,"./controller-init/confirmations/ppom-controller-init":44,"./controller-init/confirmations/signature-controller-init":45,"./controller-init/confirmations/transaction-controller-init":46,"./controller-init/confirmations/user-operation-controller-init":47,"./controller-init/core-backend":50,"./controller-init/currency-rate-controller-init":51,"./controller-init/defi-positions/defi-positions-controller-init":52,"./controller-init/delegation/delegation-controller-init":53,"./controller-init/error-reporting-service-init":54,"./controller-init/gator-permissions/gator-permissions-controller-init":55,"./controller-init/identity/authentication-controller-init":56,"./controller-init/identity/user-storage-controller-init":57,"./controller-init/institutional-snap/institutional-snap-controller-init":59,"./controller-init/keyring-controller-init":60,"./controller-init/logging-controller-init":61,"./controller-init/metametrics-controller-init":160,"./controller-init/metametrics-data-deletion-controller-init":161,"./controller-init/multichain":162,"./controller-init/multichain/multichain-account-service-init":163,"./controller-init/network-controller-init":170,"./controller-init/notifications/notification-services-controller-init":171,"./controller-init/notifications/notification-services-push-controller-init":172,"./controller-init/onboarding-controller-init":173,"./controller-init/permission-controller-init":174,"./controller-init/permission-log-controller-init":175,"./controller-init/phishing-controller-init":176,"./controller-init/preferences-controller-init":177,"./controller-init/rates-controller-init":178,"./controller-init/remote-feature-flag-controller-init":179,"./controller-init/rewards-controller-init":180,"./controller-init/rewards-data-service-init":181,"./controller-init/seedless-onboarding":182,"./controller-init/selected-network-controller-init":185,"./controller-init/shield/shield-controller-init":186,"./controller-init/smart-transactions/smart-transactions-controller-init":187,"./controller-init/snaps":190,"./controller-init/subject-metadata-controller-init":199,"./controller-init/subscription":200,"./controller-init/swaps-controller-init":203,"./controller-init/token-balances-controller-init":204,"./controller-init/token-detection-controller-init":205,"./controller-init/token-list-controller-init":206,"./controller-init/tokens-controller-init":207,"./controller-init/utils":209,"./controllers/permissions":224,"./controllers/preferences-controller":228,"./detect-multiple-instances":239,"./lib/AccountIdentitiesPetnamesBridge":242,"./lib/AddressBookPetnamesBridge":243,"./lib/ComposableObservableStore":244,"./lib/PatchStore":246,"./lib/WalletFundsObtainedMonitor":248,"./lib/approval/utils":250,"./lib/backup":251,"./lib/createDupeReqFilterStream":252,"./lib/createEvmMethodsToNonEvmAccountReqFilterMiddleware":253,"./lib/createHyperliquidReferralMiddleware":254,"./lib/createLoggerMiddleware":255,"./lib/createMainFrameOriginMiddleware":256,"./lib/createMetaRPCHandler":257,"./lib/createMetamaskMiddleware":258,"./lib/createOnboardingMiddleware":259,"./lib/createOriginMiddleware":260,"./lib/createOriginThrottlingMiddleware":261,"./lib/createRPCMethodTrackingMiddleware":262,"./lib/createTabIdMiddleware":263,"./lib/createTracingMiddleware":264,"./lib/dapp-swap/dapp-swap-middleware":265,"./lib/dapp-swap/dapp-swap-util":266,"./lib/forwardRequestToSnap":275,"./lib/messenger":278,"./lib/open-update-tab-and-reload":289,"./lib/ppom/ppom-middleware":292,"./lib/ppom/ppom-util":293,"./lib/rpc-method-middleware":312,"./lib/signature/util":318,"./lib/snap-keyring":320,"./lib/snap-keyring/keyring-snaps-permissions":321,"./lib/state-utils":329,"./lib/stream-utils":334,"./lib/transaction/containers/util":336,"./lib/transaction/decode/util":342,"./lib/transaction/metrics":345,"./lib/transaction/sentinel-api":346,"./lib/transaction/transaction-relay":347,"./lib/transaction/util":348,"./lib/trust-signals/trust-signals-middleware":350,"./lib/util":353,"@ethersproject/abi":698,"@metamask/approval-controller":1198,"@metamask/bridge-controller":1304,"@metamask/bridge-status-controller":1325,"@metamask/chain-agnostic-permission":1359,"@metamask/controller-utils":1383,"@metamask/eip-5792-middleware":1775,"@metamask/eip-7702-internal-rpc-middleware":1782,"@metamask/eth-json-rpc-filters":1801,"@metamask/eth-json-rpc-filters/subscriptionManager":1803,"@metamask/eth-json-rpc-middleware":1815,"@metamask/eth-ledger-bridge-keyring":1833,"@metamask/eth-qr-keyring":1842,"@metamask/eth-sig-util":1924,"@metamask/eth-trezor-keyring":1987,"@metamask/json-rpc-engine":2034,"@metamask/json-rpc-middleware-stream":2038,"@metamask/keyring-api":2100,"@metamask/keyring-controller":2110,"@metamask/messenger":2167,"@metamask/metamask-eth-abis":2172,"@metamask/multichain-api-middleware":2196,"@metamask/notification-services-controller/notification-services":2248,"@metamask/obs-store":2307,"@metamask/obs-store/dist/asStream":2306,"@metamask/permission-controller":2329,"@metamask/rpc-errors":2480,"@metamask/scure-bip39/dist/wordlists/english":2484,"@metamask/seedless-onboarding-controller":2500,"@metamask/selected-network-controller":2505,"@metamask/snaps-rpc-methods":2611,"@metamask/snaps-utils":2781,"@metamask/subscription-controller":2806,"@metamask/transaction-controller":2868,"@metamask/utils":2914,"await-semaphore":3706,buffer:3880,"eth-chainlist":4080,"eth-lattice-keyring":4085,events:4180,lodash:4635,loglevel:4643,nanoid:4834,"readable-stream":5100,"webextension-polyfill":5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var n=Br(e("events")),o=e("readable-stream"),i=Br(e("webextension-polyfill")),a=e("@metamask/json-rpc-engine"),s=e("@metamask/json-rpc-middleware-stream"),l=e("@metamask/obs-store"),c=e("@metamask/obs-store/dist/asStream"),d=e("@metamask/eth-json-rpc-middleware"),u=e("lodash"),h=e("@metamask/keyring-controller"),p=Br(e("@metamask/eth-json-rpc-filters")),m=Br(e("@metamask/eth-json-rpc-filters/subscriptionManager")),g=e("@metamask/rpc-errors"),f=e("await-semaphore"),y=Br(e("loglevel")),v=e("@metamask/eth-trezor-keyring"),C=e("@metamask/eth-ledger-bridge-keyring"),b=Br(e("eth-lattice-keyring")),w=e("eth-chainlist"),S=e("@metamask/eth-qr-keyring"),k=e("nanoid"),T=e("@metamask/approval-controller"),A=e("@metamask/messenger"),M=e("@metamask/permission-controller"),E=e("@metamask/selected-network-controller"),P=e("@metamask/snaps-rpc-methods"),I=e("@metamask/controller-utils"),_=e("@metamask/scure-bip39/dist/wordlists/english"),R=e("@metamask/bridge-controller"),N=e("@metamask/transaction-controller"),F=e("@ethersproject/abi"),O=e("@metamask/metamask-eth-abis"),D=e("@metamask/keyring-api"),x=e("@metamask/utils"),B=e("@metamask/eth-sig-util"),j=e("@metamask/notification-services-controller/notification-services"),L=e("@metamask/multichain-api-middleware"),U=e("@metamask/eip-5792-middleware"),$=e("@metamask/eip-7702-internal-rpc-middleware"),K=e("@metamask/chain-agnostic-permission"),q=e("@metamask/bridge-status-controller"),H=e("@metamask/seedless-onboarding-controller"),G=e("@metamask/subscription-controller"),W=e("@metamask/snaps-utils"),V=e("../../shared/lib/eip7702-support-utils"),z=e("../../shared/lib/eip7702-utils"),Q=e("../../shared/lib/multichain-accounts/remote-feature-flag"),Y=e("../../shared/lib/sentry"),J=e("../../shared/constants/transaction"),X=e("../../shared/constants/network"),Z=e("../../shared/constants/hardware-wallets"),ee=e("../../shared/constants/keyring"),te=e("../../shared/constants/permissions"),re=e("../../shared/constants/time"),ne=e("../../shared/constants/app"),oe=e("../../shared/constants/metametrics"),ie=e("../../shared/lib/storage-helpers"),ae=e("../../shared/lib/token-util"),se=e("../../shared/modules/string-utils"),le=e("../../shared/modules/transaction.utils"),ce=e("../../shared/constants/tokens"),de=e("../../shared/lib/metamask-controller-utils"),ue=e("../../shared/modules/mv3.utils"),he=e("../../shared/modules/network.utils"),pe=e("../../shared/modules/selectors"),me=e("../../shared/lib/transactions-controller-utils"),ge=e("../../shared/modules/selectors/networks"),fe=e("../../shared/modules/selectors/multichain"),ye=e("../../shared/lib/trace"),ve=Br(e("../../shared/lib/fetch-with-cache")),Ce=e("../../shared/constants/multichain/networks"),be=e("../../shared/constants/bridge"),we=e("../../shared/lib/accounts"),Se=e("../../shared/lib/accounts/bitcoin-wallet-snap"),ke=e("../../shared/lib/accounts/solana-wallet-snap"),Te=e("../../shared/lib/accounts/tron-wallet-snap"),Ae=e("../../shared/constants/onboarding"),Me=e("../../shared/lib/translate"),Ee=e("../../shared/modules/environment"),Pe=e("../../shared/lib/snaps/snaps"),Ie=e("../../shared/modules/hexstring-utils"),_e=e("../../shared/modules/shield"),Re=e("../../shared/constants/referrals"),Ne=e("../../shared/lib/shield"),Fe=e("./lib/transaction/metrics"),Oe=e("./lib/snap-keyring/keyring-snaps-permissions"),De=e("./lib/AddressBookPetnamesBridge"),xe=e("./lib/AccountIdentitiesPetnamesBridge"),Be=e("./lib/WalletFundsObtainedMonitor"),je=e("./lib/ppom/ppom-middleware"),Le=e("./lib/dapp-swap/dapp-swap-middleware"),Ue=e("./lib/trust-signals/trust-signals-middleware"),$e=e("./detect-multiple-instances"),Ke=Br(e("./lib/ComposableObservableStore")),qe=Br(e("./lib/createDupeReqFilterStream")),He=Br(e("./lib/createLoggerMiddleware")),Ge=e("./lib/rpc-method-middleware"),We=Br(e("./lib/createOriginMiddleware")),Ve=Br(e("./lib/createMainFrameOriginMiddleware")),ze=Br(e("./lib/createTabIdMiddleware")),Qe=Br(e("./lib/createOnboardingMiddleware")),Ye=e("./lib/stream-utils"),Je=e("./controllers/preferences-controller"),Xe=Br(e("./lib/backup")),Ze=Br(e("./lib/createMetaRPCHandler")),et=e("./lib/util"),tt=Br(e("./lib/createMetamaskMiddleware")),rt=e("./lib/createHyperliquidReferralMiddleware"),nt=e("./controllers/permissions"),ot=Br(e("./lib/createRPCMethodTrackingMiddleware")),it=e("./lib/snap-keyring"),at=e("./lib/transaction/util"),st=e("./lib/signature/util"),lt=e("./constants/stream"),ct=e("./lib/ppom/ppom-util"),dt=Br(e("./lib/createEvmMethodsToNonEvmAccountReqFilterMiddleware")),ut=e("./lib/transaction/decode/util"),ht=Br(e("./lib/createTracingMiddleware")),pt=Br(e("./lib/createOriginThrottlingMiddleware")),mt=e("./lib/PatchStore"),gt=e("./lib/state-utils"),ft=e("./lib/approval/utils"),yt=e("./controller-init/institutional-snap/institutional-snap-controller-init"),vt=e("./controller-init/multichain"),Ct=e("./controller-init/assets"),bt=e("./controller-init/confirmations/transaction-controller-init"),wt=e("./controller-init/confirmations/ppom-controller-init"),St=e("./controller-init/smart-transactions/smart-transactions-controller-init"),kt=e("./controller-init/utils"),Tt=e("./controller-init/snaps"),At=e("./controller-init/core-backend"),Mt=e("./controller-init/identity/authentication-controller-init"),Et=e("./controller-init/identity/user-storage-controller-init"),Pt=e("./controller-init/defi-positions/defi-positions-controller-init"),It=e("./controller-init/notifications/notification-services-controller-init"),_t=e("./controller-init/notifications/notification-services-push-controller-init"),Rt=e("./controller-init/delegation/delegation-controller-init"),Nt=e("./lib/transaction/transaction-relay"),Ft=e("./lib/open-update-tab-and-reload"),Ot=e("./controller-init/accounts/account-tree-controller-init"),Dt=e("./controller-init/multichain/multichain-account-service-init"),xt=e("./controller-init/seedless-onboarding"),Bt=e("./lib/transaction/containers/util"),jt=e("./lib/transaction/sentinel-api"),Lt=e("./controller-init/shield/shield-controller-init"),Ut=e("./controller-init/gator-permissions/gator-permissions-controller-init"),$t=e("./lib/forwardRequestToSnap"),Kt=e("./controller-init/metametrics-controller-init"),qt=e("./controller-init/token-list-controller-init"),Ht=e("./controller-init/token-detection-controller-init"),Gt=e("./controller-init/tokens-controller-init"),Wt=e("./controller-init/token-balances-controller-init"),Vt=e("./controller-init/rates-controller-init"),zt=e("./controller-init/currency-rate-controller-init"),Qt=e("./controller-init/confirmations/ens-controller-init"),Yt=e("./controller-init/confirmations/name-controller-init"),Jt=e("./controller-init/confirmations/gas-fee-controller-init"),Xt=e("./controller-init/selected-network-controller-init"),Zt=e("./controller-init/subscription"),er=e("./controller-init/account-tracker-controller-init"),tr=e("./controller-init/onboarding-controller-init"),rr=e("./controller-init/remote-feature-flag-controller-init"),nr=e("./controller-init/swaps-controller-init"),or=e("./controller-init/bridge-controller-init"),ir=e("./controller-init/bridge-status-controller-init"),ar=e("./controller-init/preferences-controller-init"),sr=e("./controller-init/app-state-controller-init"),lr=e("./controller-init/permission-controller-init"),cr=e("./controller-init/subject-metadata-controller-init"),dr=e("./controller-init/assets/network-enablement-controller-init"),ur=e("./controller-init/keyring-controller-init"),hr=e("./controller-init/accounts/snap-keyring-builder-init"),pr=e("./controller-init/permission-log-controller-init"),mr=e("./controller-init/network-controller-init"),gr=e("./controller-init/announcement-controller-init"),fr=e("./controller-init/account-order-controller-init"),yr=e("./controller-init/accounts-controller-init"),vr=e("./controller-init/phishing-controller-init"),Cr=e("./controller-init/alert-controller-init"),br=e("./controller-init/metametrics-data-deletion-controller-init"),wr=e("./controller-init/logging-controller-init"),Sr=e("./controller-init/app-metadata-controller-init"),kr=e("./controller-init/error-reporting-service-init"),Tr=e("./controller-init/confirmations/approval-controller-init"),Ar=e("./controller-init/confirmations/address-book-controller-init"),Mr=e("./controller-init/confirmations/decrypt-message-manager-init"),Er=e("./controller-init/confirmations/decrypt-message-controller-init"),Pr=e("./controller-init/confirmations/encryption-public-key-controller-init"),Ir=e("./controller-init/confirmations/encryption-public-key-message-manager-init"),_r=e("./controller-init/confirmations/signature-controller-init"),Rr=e("./controller-init/confirmations/user-operation-controller-init"),Nr=e("./controller-init/rewards-data-service-init"),Fr=e("./controller-init/rewards-controller-init"),Or=e("./lib/messenger"),Dr=e("./controller-init/claims"),xr=e("./lib/dapp-swap/dapp-swap-util");function Br(e){return e&&e.__esModule?e:{default:e}}function jr(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(jr=function(e){return e?r:t})(e)}function Lr(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function Ur(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $r(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",DECRYPT_MESSAGE_MANAGER_UPDATE_BADGE:"DecryptMessageManager:updateBadge",ENCRYPTION_PUBLIC_KEY_MANAGER_UPDATE_BADGE:"EncryptionPublicKeyManager:updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange",APP_STATE_UNLOCK_CHANGE:"AppStateController:unlockChange",METAMASK_NOTIFICATIONS_LIST_UPDATED:"NotificationServicesController:notificationsListUpdated",METAMASK_NOTIFICATIONS_MARK_AS_READ:"NotificationServicesController:markNotificationsAsRead"};const Kr="eip-1193",qr="caip-multichain";var Hr=new WeakSet;class Gr extends n.default{constructor(e){super(),Lr(this,Hr),Ur(this,"handleWatchAssetRequest",({asset:e,type:t,origin:r,networkClientId:n})=>{switch(t){case I.ERC20:return this.tokensController.watchAsset({asset:e,type:t,networkClientId:n});case I.ERC721:case I.ERC1155:return this.nftController.watchNft(e,t,r,n);default:throw new Error(`Asset type ${t} not supported`)}}),Ur(this,"removePermissionsFor",e=>{try{this.permissionController.revokePermissions(e)}catch(e){if(!(e instanceof M.PermissionsRequestNotFoundError))throw e}}),Ur(this,"updateCaveat",(e,t,r,n)=>{try{this.controllerMessenger.call("PermissionController:updateCaveat",e,t,r,n)}catch(e){if(!(e instanceof M.PermissionsRequestNotFoundError))throw e}}),Ur(this,"updateNetworksList",e=>{try{this.networkOrderController.updateNetworksList(e)}catch(e){throw y.default.error(e.message),e}}),Ur(this,"updateAccountsList",e=>{try{this.accountOrderController.updateAccountsList(e)}catch(e){throw y.default.error(e.message),e}}),Ur(this,"setEnabledNetworks",async e=>{try{this.networkEnablementController.enableNetwork(e)}catch(e){throw y.default.error(e.message),e}await this.lookupSelectedNetworks()}),Ur(this,"setEnabledAllPopularNetworks",async()=>{try{this.networkEnablementController.enableAllPopularNetworks()}catch(e){throw y.default.error(e.message),e}await this.lookupSelectedNetworks()}),Ur(this,"updateHiddenAccountsList",e=>{try{this.accountOrderController.updateHiddenAccountsList(e)}catch(e){throw y.default.error(e.message),e}}),Ur(this,"rejectPermissionsRequest",e=>{try{this.permissionController.rejectPermissionsRequest(e)}catch(e){if(!(e instanceof M.PermissionsRequestNotFoundError))throw e}}),Ur(this,"acceptPermissionsRequest",e=>{try{this.permissionController.acceptPermissionsRequest(e)}catch(e){if(!(e instanceof M.PermissionsRequestNotFoundError))throw e}}),Ur(this,"resolvePendingApproval",async(e,t,r)=>{try{await this.approvalController.accept(e,t,r)}catch(e){if(!(e instanceof T.ApprovalRequestNotFoundError))throw e}}),Ur(this,"rejectPendingApproval",(e,t)=>{try{this.approvalController.reject(e,new g.JsonRpcError(t.code,t.message,t.data))}catch(e){if(!(e instanceof T.ApprovalRequestNotFoundError))throw e}});const{isFirstMetaMaskControllerSetup:t,controllerMessenger:r=(0,Or.getRootMessenger)()}=e;this.defaultMaxListeners=20,this.sendUpdate=(0,u.debounce)(this.privateSendUpdate.bind(this),200*re.MILLISECOND),this.opts=e,this.requestSafeReload=e.requestSafeReload??(()=>Promise.resolve()),this.extension=e.browser,this.platform=e.platform,this.notificationManager=e.notificationManager;const n=e.initState||{},o="13.11.0";this.recordFirstTimeInfo(n),this.featureFlags=e.featureFlags,this.activeControllerConnections=0,this.offscreenPromise=e.offscreenPromise??Promise.resolve(),this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.initializeChainlist(),this.controllerMessenger=r,this.currentMigrationVersion=e.currentMigrationVersion,this.store=new Ke.default({state:n,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new f.Mutex,this.seedlessOperationMutex=new f.Mutex,this.extension.runtime.onInstalled.addListener(e=>{e.reason}),this.multichainSubscriptionManager=new L.MultichainSubscriptionManager({getNetworkClientById:this.controllerMessenger.call.bind(this.controllerMessenger,"NetworkController:getNetworkClientById"),findNetworkClientIdByChainId:this.controllerMessenger.call.bind(this.controllerMessenger,"NetworkController:findNetworkClientIdByChainId")}),this.multichainMiddlewareManager=new L.MultichainMiddlewareManager,this.deprecatedNetworkVersions={},this.on("controllerConnectionChanged",e=>{const{completedOnboarding:t}=this.onboardingController.state;e>0&&t?this.triggerNetworkrequests():this.stopNetworkRequests()}),this.on("controllerConnectionChanged",e=>{const{completedOnboarding:t}=this.onboardingController.state;e>0&&t&&this.appStateController.state.canTrackWalletFundsObtained&&this.walletFundsObtainedMonitor.setupMonitoring()});const i={ApprovalController:Tr.ApprovalControllerInit,LoggingController:wr.LoggingControllerInit,ErrorReportingService:kr.ErrorReportingServiceInit,AppMetadataController:Sr.AppMetadataControllerInit,PreferencesController:ar.PreferencesControllerInit,SnapKeyringBuilder:hr.SnapKeyringBuilderInit,KeyringController:ur.KeyringControllerInit,AccountsController:yr.AccountsControllerInit,AddressBookController:Ar.AddressBookControllerInit,AlertController:Cr.AlertControllerInit,DecryptMessageManager:Mr.DecryptMessageManagerInit,DecryptMessageController:Er.DecryptMessageControllerInit,EncryptionPublicKeyManager:Ir.EncryptionPublicKeyManagerInit,EncryptionPublicKeyController:Pr.EncryptionPublicKeyControllerInit,SignatureController:_r.SignatureControllerInit,PermissionController:lr.PermissionControllerInit,PermissionLogController:pr.PermissionLogControllerInit,SubjectMetadataController:cr.SubjectMetadataControllerInit,AppStateController:sr.AppStateControllerInit,OnboardingController:tr.OnboardingControllerInit,RemoteFeatureFlagController:rr.RemoteFeatureFlagControllerInit,NetworkController:mr.NetworkControllerInit,MetaMetricsController:Kt.MetaMetricsControllerInit,MetaMetricsDataDeletionController:br.MetaMetricsDataDeletionControllerInit,GasFeeController:Jt.GasFeeControllerInit,UserOperationController:Rr.UserOperationControllerInit,ExecutionService:Tt.ExecutionServiceInit,InstitutionalSnapController:yt.InstitutionalSnapControllerInit,RateLimitController:Tt.RateLimitControllerInit,SnapsRegistry:Tt.SnapsRegistryInit,CronjobController:Tt.CronjobControllerInit,SelectedNetworkController:Xt.SelectedNetworkControllerInit,SnapController:Tt.SnapControllerInit,SnapInsightsController:Tt.SnapInsightsControllerInit,SnapInterfaceController:Tt.SnapInterfaceControllerInit,WebSocketService:Tt.WebSocketServiceInit,BackendWebSocketService:At.BackendWebSocketServiceInit,AccountActivityService:At.AccountActivityServiceInit,PPOMController:wt.PPOMControllerInit,PhishingController:vr.PhishingControllerInit,AccountTrackerController:er.AccountTrackerControllerInit,TransactionController:bt.TransactionControllerInit,SmartTransactionsController:St.SmartTransactionsControllerInit,SwapsController:nr.SwapsControllerInit,BridgeController:or.BridgeControllerInit,BridgeStatusController:ir.BridgeStatusControllerInit,NftController:Ct.NftControllerInit,AssetsContractController:Ct.AssetsContractControllerInit,NftDetectionController:Ct.NftDetectionControllerInit,CurrencyRateController:zt.CurrencyRateControllerInit,RatesController:Vt.RatesControllerInit,TokenListController:qt.TokenListControllerInit,TokenDetectionController:Ht.TokenDetectionControllerInit,TokensController:Gt.TokensControllerInit,TokenBalancesController:Wt.TokenBalancesControllerInit,TokenRatesController:Ct.TokenRatesControllerInit,AccountOrderController:fr.AccountOrderControllerInit,AccountTreeController:Ot.AccountTreeControllerInit,MultichainAssetsController:vt.MultichainAssetsControllerInit,MultichainAssetsRatesController:vt.MultichainAssetsRatesControllerInit,MultichainBalancesController:vt.MultichainBalancesControllerInit,MultichainTransactionsController:vt.MultichainTransactionsControllerInit,MultichainAccountService:Dt.MultichainAccountServiceInit,MultichainRouter:Tt.MultichainRouterInit,MultichainNetworkController:vt.MultichainNetworkControllerInit,AuthenticationController:Mt.AuthenticationControllerInit,UserStorageController:Et.UserStorageControllerInit,NotificationServicesController:It.NotificationServicesControllerInit,NotificationServicesPushController:_t.NotificationServicesPushControllerInit,DeFiPositionsController:Pt.DeFiPositionsControllerInit,DelegationController:Rt.DelegationControllerInit,OAuthService:xt.OAuthServiceInit,SeedlessOnboardingController:xt.SeedlessOnboardingControllerInit,SubscriptionController:Zt.SubscriptionControllerInit,SubscriptionService:Zt.SubscriptionServiceInit,NetworkOrderController:Ct.NetworkOrderControllerInit,ShieldController:Lt.ShieldControllerInit,ClaimsController:Dr.ClaimsControllerInit,ClaimsService:Dr.ClaimsServiceInit,GatorPermissionsController:Ut.GatorPermissionsControllerInit,SnapsNameProvider:Tt.SnapsNameProviderInit,EnsController:Qt.EnsControllerInit,NameController:Yt.NameControllerInit,NetworkEnablementController:dr.NetworkEnablementControllerInit,AnnouncementController:gr.AnnouncementControllerInit,RewardsDataService:Nr.RewardsDataServiceInit,RewardsController:Fr.RewardsControllerInit},{controllerApi:s,controllerMemState:l,controllerPersistedState:c,controllersByName:d}=$r(Hr,this,Qr).call(this,{initFunctions:i,initState:n});this.controllerApi=s,this.controllerMemState=l,this.controllerPersistedState=c,this.controllersByName=d,this.approvalController=d.ApprovalController,this.loggingController=d.LoggingController,this.appMetadataController=d.AppMetadataController,this.preferencesController=d.PreferencesController,this.keyringController=d.KeyringController,this.accountsController=d.AccountsController,this.addressBookController=d.AddressBookController,this.alertController=d.AlertController,this.decryptMessageController=d.DecryptMessageController,this.encryptionPublicKeyController=d.EncryptionPublicKeyController,this.signatureController=d.SignatureController,this.permissionController=d.PermissionController,this.permissionLogController=d.PermissionLogController,this.subjectMetadataController=d.SubjectMetadataController,this.appStateController=d.AppStateController,this.networkController=d.NetworkController,this.metaMetricsController=d.MetaMetricsController,this.metaMetricsDataDeletionController=d.MetaMetricsDataDeletionController,this.remoteFeatureFlagController=d.RemoteFeatureFlagController,this.gasFeeController=d.GasFeeController,this.userOperationController=d.UserOperationController,this.cronjobController=d.CronjobController,this.rateLimitController=d.RateLimitController,this.selectedNetworkController=d.SelectedNetworkController,this.snapController=d.SnapController,this.snapInsightsController=d.SnapInsightsController,this.snapInterfaceController=d.SnapInterfaceController,this.snapsRegistry=d.SnapsRegistry,this.ppomController=d.PPOMController,this.phishingController=d.PhishingController,this.onboardingController=d.OnboardingController,this.accountTrackerController=d.AccountTrackerController,this.txController=d.TransactionController,this.smartTransactionsController=d.SmartTransactionsController,this.swapsController=d.SwapsController,this.bridgeController=d.BridgeController,this.bridgeStatusController=d.BridgeStatusController,this.backendWebSocketService=d.BackendWebSocketService,this.accountActivityService=d.AccountActivityService,this.nftController=d.NftController,this.nftDetectionController=d.NftDetectionController,this.assetsContractController=d.AssetsContractController,this.multichainAssetsController=d.MultichainAssetsController,this.multichainBalancesController=d.MultichainBalancesController,this.multichainTransactionsController=d.MultichainTransactionsController,this.multichainAssetsRatesController=d.MultichainAssetsRatesController,this.multichainAccountService=d.MultichainAccountService,this.tokenBalancesController=d.TokenBalancesController,this.tokenListController=d.TokenListController,this.tokenDetectionController=d.TokenDetectionController,this.tokensController=d.TokensController,this.tokenRatesController=d.TokenRatesController,this.currencyRateController=d.CurrencyRateController,this.multichainNetworkController=d.MultichainNetworkController,this.multichainRatesController=d.RatesController,this.authenticationController=d.AuthenticationController,this.userStorageController=d.UserStorageController,this.delegationController=d.DelegationController,this.notificationServicesController=d.NotificationServicesController,this.notificationServicesPushController=d.NotificationServicesPushController,this.deFiPositionsController=d.DeFiPositionsController,this.accountTreeController=d.AccountTreeController,this.oauthService=d.OAuthService,this.subscriptionService=d.SubscriptionService,this.seedlessOnboardingController=d.SeedlessOnboardingController,this.subscriptionController=d.SubscriptionController,this.networkOrderController=d.NetworkOrderController,this.networkEnablementController=d.NetworkEnablementController,this.shieldController=d.ShieldController,this.gatorPermissionsController=d.GatorPermissionsController,this.ensController=d.EnsController,this.nameController=d.NameController,this.announcementController=d.AnnouncementController,this.accountOrderController=d.AccountOrderController,this.rewardsController=d.RewardsController,this.claimsController=d.ClaimsController,this.claimsService=d.ClaimsService,this.backup=new Xe.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,accountsController:this.accountsController,networkController:this.networkController,trackMetaMetricsEvent:this.controllerMessenger.call.bind(this.controllerMessenger,"MetaMetricsController:trackEvent")}),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker,this.on("update",e=>{this.metaMetricsController.handleMetaMaskStateUpdate(e)}),this.controllerMessenger.subscribe("KeyringController:unlock",()=>this._onUnlock()),this.controllerMessenger.subscribe("KeyringController:lock",()=>this._onLock()),this.controllerMessenger.subscribe("SubscriptionController:stateChange",e=>{(0,Ne.getIsShieldSubscriptionActive)(e.subscriptions)?(this.claimsController.fetchClaimsConfigurations().catch(e=>{y.default.error("Error fetching claims configurations",e)}),(0,_e.updatePreferencesAndMetricsForShieldSubscription)(this.metaMetricsController,this.preferencesController),this.shieldController.start()):this.shieldController.stop()});const h=new A.Messenger({namespace:"PetnamesBridge",parent:this.controllerMessenger});this.controllerMessenger.delegate({messenger:h,events:["NameController:stateChange","AccountsController:stateChange","AddressBookController:stateChange"],actions:["AccountsController:listAccounts"]}),new De.AddressBookPetnamesBridge({addressBookController:this.addressBookController,nameController:this.nameController,messenger:h}).init(),new xe.AccountIdentitiesPetnamesBridge({nameController:this.nameController,messenger:h}).init();const p=new A.Messenger({namespace:"WalletFundsObtainedMonitor",parent:this.controllerMessenger});this.controllerMessenger.delegate({messenger:p,events:["NotificationServicesController:notificationsListUpdated"],actions:["MetaMetricsController:trackEvent","AppStateController:setCanTrackWalletFundsObtained","OnboardingController:getState","NotificationServicesController:getState","TokenBalancesController:getState","MultichainBalancesController:getState"]}),this.walletFundsObtainedMonitor=new Be.WalletFundsObtainedMonitor({messenger:p}),this.getSecurityAlertsConfig=async e=>(0,_e.getShieldGatewayConfig)(()=>this.controllerMessenger.call("AuthenticationController:getBearerToken"),()=>this.controllerMessenger.call("SubscriptionController:getSubscriptionByProduct",G.PRODUCT_TYPES.SHIELD),e),this.notificationServicesController.init(),this.snapController.init(),this.cronjobController.init(),this.controllerMessenger.subscribe("TransactionController:transactionStatusUpdated",({transactionMeta:e})=>{this._onFinishedTransaction(e)}),this.controllerMessenger.subscribe("TransactionController:transactionSubmitted",({transactionMeta:e})=>{this._onShieldSubscriptionApprovalTransaction(e).catch(e=>{console.error("Error onShieldSubscriptionApprovalTransaction",e)})}),this.controllerMessenger.subscribe("OnboardingController:stateChange",(0,et.previousValueComparator)(async(e,t)=>{const{completedOnboarding:r}=e,{completedOnboarding:n,firstTimeFlowType:o}=t;if(!r&&n){const{address:e}=this.accountsController.getSelectedAccount();this.isMultichainAccountsFeatureState2Enabled()&&(await this.getSnapKeyring(),await this.accountTreeController.syncWithUserStorageAtLeastOnce()),o===Ae.FirstTimeFlowType.socialImport?await this._importAccountsWithBalances():this.isMultichainAccountsFeatureState2Enabled()?await this.discoverAndCreateAccounts():await this._addAccountsWithBalance(),this.postOnboardingInitialization(),this.triggerNetworkrequests(),await this.tokenDetectionController.detectTokens({selectedAddress:e})}},this.onboardingController.state));const m=({origin:e})=>{if(e===ne.ORIGIN_METAMASK){const e=this.accountsController.getSelectedAccount().address;return e?[e]:[]}return this.getPermittedAccounts(e)};this.eip5792Middleware=(0,a.createScaffoldMiddleware)({wallet_getCapabilities:(0,a.createAsyncMiddleware)(async(e,t)=>(0,U.walletGetCapabilities)(e,t,{getAccounts:m,getCapabilities:U.getCapabilities.bind(null,{getDismissSmartAccountSuggestionEnabled:()=>this.preferencesController.state.preferences.dismissSmartAccountSuggestionEnabled,getIsSmartTransaction:e=>(0,pe.getIsSmartTransaction)(this._getMetaMaskState(),e),isAtomicBatchSupported:this.txController.isAtomicBatchSupported.bind(this.txController),isRelaySupported:Nt.isRelaySupported,getSendBundleSupportedChains:jt.getSendBundleSupportedChains,isAuxiliaryFundsSupported:e=>be.ALLOWED_BRIDGE_CHAIN_IDS.includes(e)},this.controllerMessenger)})),wallet_sendCalls:(0,a.createAsyncMiddleware)(async(e,t)=>await(0,U.walletSendCalls)(e,t,{getAccounts:m,processSendCalls:U.processSendCalls.bind(null,{addTransaction:this.txController.addTransaction.bind(this.txController),addTransactionBatch:this.txController.addTransactionBatch.bind(this.txController),getDismissSmartAccountSuggestionEnabled:()=>this.preferencesController.state.preferences.dismissSmartAccountSuggestionEnabled,isAtomicBatchSupported:this.txController.isAtomicBatchSupported.bind(this.txController),validateSecurity:(t,r,n)=>{var o;return(0,xr.getQuotesForConfirmation)({req:e,fetchQuotes:this.controllerMessenger.call.bind(this.controllerMessenger,`${R.BRIDGE_CONTROLLER_NAME}:${R.BridgeBackgroundAction.FETCH_QUOTES}`),setDappSwapComparisonData:this.appStateController.setDappSwapComparisonData.bind(this.appStateController),getNetworkConfigurationByNetworkClientId:this.networkController.getNetworkConfigurationByNetworkClientId.bind(this.networkController),dappSwapMetricsFlag:null===(o=this.remoteFeatureFlagController)||void 0===o||null===(o=o.state)||void 0===o||null===(o=o.remoteFeatureFlags)||void 0===o?void 0:o.dappSwapMetrics,securityAlertId:t}),(0,ct.validateRequestWithPPOM)({chainId:n,ppomController:this.ppomController,request:r,securityAlertId:t,updateSecurityAlertResponse:this.updateSecurityAlertResponse.bind(this),getSecurityAlertsConfig:this.getSecurityAlertsConfig.bind(this)})},isAuxiliaryFundsSupported:e=>be.ALLOWED_BRIDGE_CHAIN_IDS.includes(e)},this.controllerMessenger)})),wallet_getCallsStatus:(0,a.createAsyncMiddleware)(async(e,t)=>(0,U.walletGetCallsStatus)(e,t,{getCallsStatus:U.getCallsStatus.bind(null,this.controllerMessenger)}))}),this.eip7702Middleware=(0,a.createScaffoldMiddleware)({wallet_upgradeAccount:(0,a.createAsyncMiddleware)(async(e,t)=>{await(0,$.walletUpgradeAccount)(e,t,{upgradeAccount:this.upgradeAccount.bind(this),getCurrentChainIdForDomain:this.getCurrentChainIdForDomain.bind(this),isEip7702Supported:this.isEip7702Supported.bind(this),getPermittedAccountsForOrigin:async()=>m({origin:e.origin})})}),wallet_getAccountUpgradeStatus:(0,a.createAsyncMiddleware)(async(e,t)=>{await(0,$.walletGetAccountUpgradeStatus)(e,t,{getCurrentChainIdForDomain:this.getCurrentChainIdForDomain.bind(this),getCode:this.getCode.bind(this),getSelectedNetworkClientIdForChain:this.getSelectedNetworkClientIdForChain.bind(this),getPermittedAccountsForOrigin:async()=>m({origin:e.origin}),isEip7702Supported:this.isEip7702Supported.bind(this)})})}),this.metamaskMiddleware=(0,tt.default)({static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${o}`},version:o,getAccounts:m,processTransaction:(e,t)=>(0,at.addDappTransaction)(this.getAddTransactionRequest({transactionParams:e,dappRequest:t})),processTypedMessage:(...e)=>(0,st.addTypedMessage)({signatureController:this.signatureController,signatureParams:e}),processTypedMessageV3:(...e)=>(0,st.addTypedMessage)({signatureController:this.signatureController,signatureParams:e}),processTypedMessageV4:(...e)=>(0,st.addTypedMessage)({signatureController:this.signatureController,signatureParams:e}),processPersonalMessage:(...e)=>(0,st.addPersonalMessage)({signatureController:this.signatureController,signatureParams:e}),processEncryptionPublicKey:this.encryptionPublicKeyController.newRequestEncryptionPublicKey.bind(this.encryptionPublicKeyController),processDecryptMessage:this.decryptMessageController.newRequestDecryptMessage.bind(this.decryptMessageController),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.state.transactions.find(t=>t.hash===e&&t.status===N.TransactionStatus.submitted),processRequestExecutionPermissions:(0,Ee.isGatorPermissionsFeatureEnabled)()?$t.forwardRequestToSnap.bind(null,{snapId:"npm:@metamask/permissions-kernel-snap",handleRequest:this.handleSnapRequest.bind(this)}):undefined}),this.on("update",e=>this._onStateUpdate(e));const v={AccountTracker:this.accountTrackerController,TokenRatesController:this.tokenRatesController,DecryptMessageController:this.decryptMessageController,EncryptionPublicKeyController:this.encryptionPublicKeyController,SignatureController:this.signatureController,SwapsController:this.swapsController,BridgeController:this.bridgeController,BridgeStatusController:this.bridgeStatusController,EnsController:this.ensController,ApprovalController:this.approvalController};this.store.updateStructure({AccountsController:this.accountsController,AppStateController:this.appStateController,AppMetadataController:this.appMetadataController,KeyringController:this.keyringController,PreferencesController:this.preferencesController,MetaMetricsController:this.metaMetricsController,MetaMetricsDataDeletionController:this.metaMetricsDataDeletionController,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,MultichainNetworkController:this.multichainNetworkController,NetworkController:this.networkController,AlertController:this.alertController,OnboardingController:this.onboardingController,SeedlessOnboardingController:this.seedlessOnboardingController,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController,SubjectMetadataController:this.subjectMetadataController,AnnouncementController:this.announcementController,NetworkOrderController:this.networkOrderController,NetworkEnablementController:this.networkEnablementController,AccountOrderController:this.accountOrderController,GasFeeController:this.gasFeeController,GatorPermissionsController:this.gatorPermissionsController,TokenListController:this.tokenListController,TokensController:this.tokensController,TokenBalancesController:this.tokenBalancesController,SmartTransactionsController:this.smartTransactionsController,NftController:this.nftController,PhishingController:this.phishingController,SelectedNetworkController:this.selectedNetworkController,LoggingController:this.loggingController,MultichainRatesController:this.multichainRatesController,NameController:this.nameController,UserOperationController:this.userOperationController,AuthenticationController:this.authenticationController,UserStorageController:this.userStorageController,NotificationServicesController:this.notificationServicesController,NotificationServicesPushController:this.notificationServicesPushController,RemoteFeatureFlagController:this.remoteFeatureFlagController,DeFiPositionsController:this.deFiPositionsController,...v,...c}),this.memStore=new Ke.default({config:{AccountsController:this.accountsController,AppStateController:this.appStateController,AppMetadataController:this.appMetadataController,MultichainAssetsController:this.multichainAssetsController,MultichainBalancesController:this.multichainBalancesController,MultichainTransactionsController:this.multichainTransactionsController,MultichainAssetsRatesController:this.multichainAssetsRatesController,TokenRatesController:this.tokenRatesController,MultichainNetworkController:this.multichainNetworkController,NetworkController:this.networkController,KeyringController:this.keyringController,PreferencesController:this.preferencesController,MetaMetricsController:this.metaMetricsController,MetaMetricsDataDeletionController:this.metaMetricsDataDeletionController,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController,OnboardingController:this.onboardingController,SeedlessOnboardingController:this.seedlessOnboardingController,SubscriptionController:this.subscriptionController,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController,SubjectMetadataController:this.subjectMetadataController,AnnouncementController:this.announcementController,NetworkOrderController:this.networkOrderController,NetworkEnablementController:this.networkEnablementController,AccountOrderController:this.accountOrderController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,TokenBalancesController:this.tokenBalancesController,SmartTransactionsController:this.smartTransactionsController,NftController:this.nftController,SelectedNetworkController:this.selectedNetworkController,LoggingController:this.loggingController,MultichainRatesController:this.multichainRatesController,SnapController:this.snapController,CronjobController:this.cronjobController,SnapsRegistry:this.snapsRegistry,SnapInterfaceController:this.snapInterfaceController,SnapInsightsController:this.snapInsightsController,NameController:this.nameController,UserOperationController:this.userOperationController,AuthenticationController:this.authenticationController,UserStorageController:this.userStorageController,NotificationServicesController:this.notificationServicesController,NotificationServicesPushController:this.notificationServicesPushController,RemoteFeatureFlagController:this.remoteFeatureFlagController,DeFiPositionsController:this.deFiPositionsController,PhishingController:this.phishingController,ShieldController:this.shieldController,ClaimsController:this.claimsController,ClaimsService:this.claimsService,...v,...l},controllerMessenger:this.controllerMessenger});const C=[this.decryptMessageController.resetState.bind(this.decryptMessageController),this.encryptionPublicKeyController.resetState.bind(this.encryptionPublicKeyController),this.signatureController.resetState.bind(this.signatureController),this.swapsController.resetState.bind(this.swapsController),this.bridgeController.resetState.bind(this.bridgeController),this.ensController.resetState.bind(this.ensController),this.approvalController.clear.bind(this.approvalController)];ue.isManifestV3?!0===t&&(this.resetStates(C),this.extension.storage.session.set({isFirstMetaMaskControllerSetup:!1})):this.resetStates(C);!this.isUnlocked()&&this.onboardingController.state.completedOnboarding,this._startUISync(),this.extension.runtime.getPlatformInfo().then(({os:e})=>{this.appStateController.setBrowserEnvironment(e,this.extension.runtime.getBrowserInfo===undefined?"chrome":"firefox")}),this.setupControllerEventSubscriptions(),this.setupMultichainDataAndSubscriptions(),this.publicConfigStore=this.createPublicConfigStore(),this.extension.runtime.onMessageExternal.addListener($e.onMessageReceived),(0,$e.checkForMultipleVersionsRunning)(),this.onboardingController.state.completedOnboarding&&this.postOnboardingInitialization()}getCurrentChainIdForDomain(e){const t=this.selectedNetworkController.getNetworkClientIdForDomain(e),r=this.networkController.getNetworkConfigurationByNetworkClientId(t);return r?r.chainId:(y.default.warn(`No network configuration found for clientId: ${t}`),undefined)}getSelectedNetworkClientIdForChain(e){const t=this.networkController.getNetworkConfigurationByChainId(e);if(!t)return null;const{rpcEndpoints:r,defaultRpcEndpointIndex:n}=t;return!r||n===undefined||n<0||n>=r.length?null:r[n].networkClientId}getInfuraFeatureFlags(){(0,ve.default)({url:"https://bridge.api.cx.metamask.io/featureFlags",cacheRefreshTime:20*re.MINUTE}).then(this.onFeatureFlagResponseReceived).catch(e=>{y.default.warn("Feature flag endpoint is unreachable",e)})}onFeatureFlagResponseReceived(e){const{multiChainAssets:t={}}=e,{pollInterval:r}=t;r>0&&this.tokenBalancesController.setIntervalLength(r*re.SECOND)}isMultichainAccountsFeatureState2Enabled(){var e;const t=null===(e=this.remoteFeatureFlagController)||void 0===e||null===(e=e.state)||void 0===e||null===(e=e.remoteFeatureFlags)||void 0===e?void 0:e.enableMultichainAccountsState2;return(0,Q.isMultichainAccountsFeatureEnabled)(t,Q.FEATURE_VERSION_2)}postOnboardingInitialization(){const{usePhishDetect:e}=this.preferencesController.state;if(e&&this.phishingController.maybeUpdateState(),(0,et.getBooleanFlag)("true")||Object.values(this.snapController.state.snaps).some(e=>!e.preinstalled))try{this.snapController.updateRegistry()}catch{}}async lookupSelectedNetworks(){const e=(0,fe.selectAllEnabledNetworkClientIds)(this._getMetaMaskState());await Promise.allSettled([this.networkController.lookupNetwork(),...e.map(async e=>await this.networkController.lookupNetwork(e))])}triggerNetworkrequests(){this.tokenDetectionController.enable(),this.getInfuraFeatureFlags(),(0,D.isEvmAccountType)(this.accountsController.getSelectedMultichainAccount().type)||this.multichainRatesController.start()}stopNetworkRequests(){this.txController.stopIncomingTransactionPolling(),this.tokenDetectionController.disable(),this.multichainRatesController.stop()}resetStates(e){e.forEach(e=>{try{e()}catch(e){console.error(e)}})}async getSnapKeyring(){let[e]=this.keyringController.getKeyringsByType(ee.KeyringType.snap);return e||(await this.keyringController.addNewKeyring(ee.KeyringType.snap),[e]=this.keyringController.getKeyringsByType(ee.KeyringType.snap)),e}getSnapKeyringIfAvailable(){if(this.keyringController.isUnlocked()){const[e]=this.keyringController.getKeyringsByType(ee.KeyringType.snap);return e}return undefined}async forwardSelectedAccountGroupToSnapKeyring(e,t){if(e&&t){const r=this.accountTreeController.getAccountGroupObject(t);if(r){r.accounts.some(e=>{const t=this.accountsController.getAccount(e);return Boolean(t)&&!(0,D.isEvmAccountType)(t.type)})&&await e.setSelectedAccounts(r.accounts)}}}trackInsightSnapView(e){this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.InsightSnapViewed,category:oe.MetaMetricsEventCategory.Snaps,properties:{snap_id:e}})}_getSnapMetadata(e){var t;return null===(t=this.snapsRegistry.state.database)||void 0===t||null===(t=t.verifiedSnaps)||void 0===t||null===(t=t[e])||void 0===t?void 0:t.metadata}async handleSnapRequest(e){return await this.controllerMessenger.call("SnapController:handleRequest",e)}setupControllerEventSubscriptions(){let e,t;try{var r;t=null===(r=this.accountsController.getSelectedMultichainAccount(Ce.MultichainNetworks.SOLANA))||void 0===r?void 0:r.address}catch{}this.controllerMessenger.subscribe("PreferencesController:stateChange",(0,et.previousValueComparator)(async(e,t)=>{const{currentLocale:r}=t;await(0,Me.updateCurrentLocale)(r)},this.preferencesController.state)),this.controllerMessenger.subscribe(`${this.accountsController.name}:selectedAccountChange`,async t=>{t.address&&t.address!==e&&(e=t.address,await this._onAccountChange(t.address))}),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,async(e,t)=>{const r=(0,nt.diffMap)(e,t);for(const[e,t]of r.entries())this._notifyAccountsChange(e,t)},nt.getPermittedAccountsByOrigin),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,async(e,t)=>{const r=(0,nt.getChangedAuthorizations)(e,t),n=(0,nt.getRemovedAuthorizations)(e,t);for(const[e,t]of n.entries()){const r=(0,K.getSessionScopes)(t,{getNonEvmSupportedMethods:this.getNonEvmSupportedMethods.bind(this)});Object.entries(r).forEach(([t,r])=>{r.notifications.includes("eth_subscription")&&r.methods.includes("eth_subscribe")&&this.removeMultichainApiEthSubscriptionMiddleware({scope:t,origin:e})})}for(const[e,t]of r.entries()){const r=(0,K.getSessionScopes)(t,{getNonEvmSupportedMethods:this.getNonEvmSupportedMethods.bind(this)});Object.entries(r).forEach(([t,r])=>{r.notifications.includes("eth_subscription")&&r.methods.includes("eth_subscribe")?Object.values(this.connections[e]??{}).forEach(({tabId:r})=>{this.addMultichainApiEthSubscriptionMiddleware({scope:t,origin:e,tabId:r})}):this.removeMultichainApiEthSubscriptionMiddleware({scope:t,origin:e})}),this._notifyAuthorizationChange(e,t)}},nt.getAuthorizedScopesByOrigin),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,async(e,t)=>{(0,u.uniq)([...t.keys(),...e.keys()]).forEach(r=>{var n,o;const i=t.get(r),a=e.get(r),s=Boolean(null==i||null===(n=i.sessionProperties)||void 0===n?void 0:n[K.KnownSessionProperties.SolanaAccountChangedNotifications]),l=Boolean(null==a||null===(o=a.sessionProperties)||void 0===o?void 0:o[K.KnownSessionProperties.SolanaAccountChangedNotifications]);if(!s&&!l)return;const c=(i?(0,K.getPermittedAccountsForScopes)(i,[Ce.MultichainNetworks.SOLANA,Ce.MultichainNetworks.SOLANA_DEVNET,Ce.MultichainNetworks.SOLANA_TESTNET]):[]).map(e=>{const{address:t}=(0,x.parseCaipAccountId)(e);return t}),d=(0,u.uniq)(c),[h]=this.sortMultichainAccountsByLastSelected(d),p=(a?(0,K.getPermittedAccountsForScopes)(a,[Ce.MultichainNetworks.SOLANA,Ce.MultichainNetworks.SOLANA_DEVNET,Ce.MultichainNetworks.SOLANA_TESTNET]):[]).map(e=>{const{address:t}=(0,x.parseCaipAccountId)(e);return t}),m=(0,u.uniq)(p),[g]=this.sortMultichainAccountsByLastSelected(m);h!==g&&this._notifySolanaAccountChange(r,g?[g]:[])})},nt.getAuthorizedScopesByOrigin),this.controllerMessenger.subscribe(`${this.accountsController.name}:selectedAccountChange`,async e=>{if(e.type===D.SolAccountType.DataAccount&&e.address!==t){t=e.address;const r=(0,nt.getOriginsWithSessionProperty)(this.permissionController.state,K.KnownSessionProperties.SolanaAccountChangedNotifications),n=(0,nt.getPermittedAccountsForScopesByOrigin)(this.permissionController.state,[Ce.MultichainNetworks.SOLANA,Ce.MultichainNetworks.SOLANA_DEVNET,Ce.MultichainNetworks.SOLANA_TESTNET]);if(n.size>0)for(const[t,o]of n.entries()){o.map(e=>{const{address:t}=(0,x.parseCaipAccountId)(e);return t}).includes(e.address)&&r[t]&&this._notifySolanaAccountChange(t,[e.address])}}}),this.controllerMessenger.subscribe(`${this.accountTreeController.name}:selectedAccountGroupChange`,e=>{this.forwardSelectedAccountGroupToSnapKeyring(this.getSnapKeyringIfAvailable(),e);const[r]=this.accountTreeController.getAccountsFromSelectedAccountGroup({scopes:[D.SolScope.Mainnet]});if(r&&r.type===D.SolAccountType.DataAccount&&r.address!==t){t=r.address;const e=(0,nt.getOriginsWithSessionProperty)(this.permissionController.state,K.KnownSessionProperties.SolanaAccountChangedNotifications),n=(0,nt.getPermittedAccountsForScopesByOrigin)(this.permissionController.state,[Ce.MultichainNetworks.SOLANA,Ce.MultichainNetworks.SOLANA_DEVNET,Ce.MultichainNetworks.SOLANA_TESTNET]);if(n.size>0)for(const[t,o]of n.entries()){o.map(e=>{const{address:t}=(0,x.parseCaipAccountId)(e);return t}).includes(r.address)&&e[t]&&this._notifySolanaAccountChange(t,[r.address])}}}),this.controllerMessenger.subscribe(`${this.multichainAccountService.name}:multichainAccountGroupUpdated`,e=>{this.accountTreeController.getSelectedAccountGroup()===e.id&&this.forwardSelectedAccountGroupToSnapKeyring(this.getSnapKeyringIfAvailable(),e.id)}),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,async(e,t)=>{const r=(0,nt.diffMap)(e,t);for(const[e,t]of r.entries()){const r=this.selectedNetworkController.getNetworkClientIdForDomain(e),n=this.networkController.getNetworkConfigurationByNetworkClientId(r);if(!n){y.default.warn(`No network configuration found for clientId: ${r}`);continue}const{chainId:o}=n;if(t.length>0&&!t.includes(o)){const r=this.networkController.findNetworkClientIdByChainId(t[0]);(0,W.isSnapId)(e)||this.networkController.setActiveNetwork(r),this.selectedNetworkController.setNetworkClientIdForDomain(e,r)}}},nt.getPermittedChainsByOrigin),this.controllerMessenger.subscribe("NetworkController:networkRemoved",({chainId:e})=>{const t=(0,x.toCaipChainId)("eip155",(0,x.hexToBigInt)(e).toString(10));this.removeAllScopePermissions(t)}),this.controllerMessenger.subscribe(`${this.snapController.name}:snapInstallStarted`,(e,t,r)=>{var n;const o=null===(n=this._getSnapMetadata(e))||void 0===n?void 0:n.category;this.metaMetricsController.trackEvent({event:r?oe.MetaMetricsEventName.SnapUpdateStarted:oe.MetaMetricsEventName.SnapInstallStarted,category:oe.MetaMetricsEventCategory.Snaps,properties:{snap_id:e,origin:t,snap_category:o}})}),this.controllerMessenger.subscribe(`${this.snapController.name}:snapInstallFailed`,(e,t,r,n)=>{var o;const i=n.includes("User rejected the request."),a=r?oe.MetaMetricsEventName.SnapUpdateFailed:oe.MetaMetricsEventName.SnapInstallFailed,s=r?oe.MetaMetricsEventName.SnapUpdateRejected:oe.MetaMetricsEventName.SnapInstallRejected,l=null===(o=this._getSnapMetadata(e))||void 0===o?void 0:o.category;this.metaMetricsController.trackEvent({event:i?s:a,category:oe.MetaMetricsEventCategory.Snaps,properties:{snap_id:e,origin:t,snap_category:l}})}),this.controllerMessenger.subscribe(`${this.snapController.name}:snapInstalled`,(e,t,r)=>{var n;if(r)return;const o=e.id,i=null===(n=this._getSnapMetadata(o))||void 0===n?void 0:n.category;this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.SnapInstalled,category:oe.MetaMetricsEventCategory.Snaps,properties:{snap_id:o,version:e.version,origin:t,snap_category:i}})}),this.controllerMessenger.subscribe(`${this.snapController.name}:snapUpdated`,(e,t,r,n)=>{var o;if(n)return;const i=e.id,a=null===(o=this._getSnapMetadata(i))||void 0===o?void 0:o.category;this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.SnapUpdated,category:oe.MetaMetricsEventCategory.Snaps,properties:{snap_id:i,old_version:t,new_version:e.version,origin:r,snap_category:a}})}),this.controllerMessenger.subscribe(`${this.snapController.name}:snapTerminated`,e=>{const t=Object.values(this.approvalController.state.pendingApprovals).filter(t=>t.origin===e.id&&t.type.startsWith(te.RestrictedMethods.snap_dialog));for(const e of t)this.approvalController.reject(e.id,new Error("Snap was terminated."))}),this.controllerMessenger.subscribe(`${this.snapController.name}:snapUninstalled`,e=>{var t;const r=this.notificationServicesController.getNotificationsByType(j.TRIGGER_TYPES.SNAP).filter(t=>t.data.origin===e.id).map(e=>e.id);this.notificationServicesController.deleteNotificationsById(r);const n=e.id,o=null===(t=this._getSnapMetadata(n))||void 0===t?void 0:t.category;this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.SnapUninstalled,category:oe.MetaMetricsEventCategory.Snaps,properties:{snap_id:n,version:e.version,snap_category:o}})})}setupMultichainDataAndSubscriptions(){this.controllerMessenger.subscribe("AccountsController:selectedAccountChange",e=>{0===this.activeControllerConnections||(0,D.isEvmAccountType)(e.type)?this.multichainRatesController.stop():this.multichainRatesController.start()}),this.controllerMessenger.subscribe("CurrencyRateController:stateChange",({currentCurrency:e})=>{e!==this.multichainRatesController.state.fiatCurrency&&this.multichainRatesController.setFiatCurrency(e)})}addMultichainApiEthSubscriptionMiddleware({scope:e,origin:t,tabId:r}){const n=this.multichainSubscriptionManager.subscribe({scope:e,origin:t,tabId:r});this.multichainMiddlewareManager.addMiddleware({scope:e,origin:t,tabId:r,middleware:n.middleware})}removeMultichainApiEthSubscriptionMiddleware({scope:e,origin:t}){this.multichainMiddlewareManager.removeMiddlewareByScopeAndOrigin(e,t),this.multichainSubscriptionManager.unsubscribeByScopeAndOrigin(e,t)}createPublicConfigStore(){const e=new l.ObservableStore,t=async({isUnlocked:e})=>{const{chainId:t,networkVersion:r,isConnected:n}=await this.getProviderNetworkState();return{isUnlocked:e,chainId:t,networkVersion:n?r:"loading"}},r=async r=>{var n;(null===(n=r.networksMetadata[r.selectedNetworkClientId])||void 0===n?void 0:n.status)===X.NetworkStatus.Available&&e.putState(await t(r))};return this.on("update",r),r(this.getState()),e}async getProviderState(e,{isInitializingStreamProvider:t=!1}={}){const r=await this.getProviderNetworkState({origin:e,isInitializingStreamProvider:t}),n={};if(ue.isManifestV3){var o;const{chrome:e}=globalThis;n.extensionId=null==e||null===(o=e.runtime)||void 0===o?void 0:o.id}return{isUnlocked:!0,accounts:this.getPermittedAccounts(e),...n,...r}}async getProviderNetworkState({origin:e=E.METAMASK_DOMAIN,isInitializingStreamProvider:t=!1}={}){const r=this.controllerMessenger.call("SelectedNetworkController:getNetworkClientIdForDomain",e),n=this.controllerMessenger.call("NetworkController:getNetworkClientById",r),{chainId:o}=n.configuration,{completedOnboarding:i}=this.onboardingController.state;let a=this.deprecatedNetworkVersions[r];if(a===undefined&&i&&!t){try{const e=await n.provider.request({method:"net_version"});a=(0,he.convertNetworkId)(e)}catch(e){console.error(e),a=null}this.deprecatedNetworkVersions[r]=a}const s=this.networkController.state.networksMetadata[r];return{chainId:o,networkVersion:a??"loading",isConnected:(null==s?void 0:s.status)===X.NetworkStatus.Available}}getState(){const{vault:e}=this.keyringController.state,t=Boolean(e),r=this.memStore.getFlatState();return{isInitialized:t,...(0,gt.sanitizeUIState)(r)}}async _addNetworkAndSetActive(e){var t;const r=await this.networkController.addNetwork(e),{networkClientId:n}=(null==r||null===(t=r.rpcEndpoints)||void 0===t?void 0:t[r.defaultRpcEndpointIndex])??{};return await this.networkController.setActiveNetwork(n),r}getApi(){const{accountsController:e,addressBookController:t,alertController:r,appStateController:n,nftController:o,nftDetectionController:i,currencyRateController:a,tokenBalancesController:s,tokenDetectionController:l,ensController:c,tokenListController:d,gasFeeController:u,gatorPermissionsController:h,metaMetricsController:p,networkController:m,multichainNetworkController:g,announcementController:f,onboardingController:y,permissionController:v,preferencesController:C,tokensController:b,smartTransactionsController:w,txController:S,backup:k,approvalController:T,phishingController:A,tokenRatesController:M,authenticationController:E,userStorageController:P,notificationServicesController:I,notificationServicesPushController:_,deFiPositionsController:N,multichainAssetsRatesController:F}=this;return{getState:this.getState.bind(this),setCurrentCurrency:a.setCurrentCurrency.bind(a),setUseBlockie:C.setUseBlockie.bind(C),setAvatarType:e=>C.setPreference("avatarType",e),setUsePhishDetect:C.setUsePhishDetect.bind(C),setUseMultiAccountBalanceChecker:C.setUseMultiAccountBalanceChecker.bind(C),setUseSafeChainsListValidation:C.setUseSafeChainsListValidation.bind(C),setUseTokenDetection:C.setUseTokenDetection.bind(C),setUseNftDetection:C.setUseNftDetection.bind(C),setUse4ByteResolution:C.setUse4ByteResolution.bind(C),setUseCurrencyRateCheck:C.setUseCurrencyRateCheck.bind(C),setOpenSeaEnabled:C.setOpenSeaEnabled.bind(C),getProviderConfig:()=>(0,ge.getProviderConfig)({metamask:this.networkController.state}),grantPermissionsIncremental:this.permissionController.grantPermissionsIncremental.bind(this.permissionController),grantPermissions:this.permissionController.grantPermissions.bind(this.permissionController),setSecurityAlertsEnabled:C.setSecurityAlertsEnabled.bind(C),setAddSnapAccountEnabled:C.setAddSnapAccountEnabled.bind(C),setUseExternalNameSources:C.setUseExternalNameSources.bind(C),setUseTransactionSimulations:C.setUseTransactionSimulations.bind(C),setIpfsGateway:C.setIpfsGateway.bind(C),setIsIpfsGatewayEnabled:C.setIsIpfsGatewayEnabled.bind(C),setUseAddressBarEnsResolution:C.setUseAddressBarEnsResolution.bind(C),setParticipateInMetaMetrics:p.setParticipateInMetaMetrics.bind(p),setDataCollectionForMarketing:p.setDataCollectionForMarketing.bind(p),setMarketingCampaignCookieId:p.setMarketingCampaignCookieId.bind(p),setCurrentLocale:C.setCurrentLocale.bind(C),setServiceWorkerKeepAlivePreference:C.setServiceWorkerKeepAlivePreference.bind(C),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),getRequestAccountTabIds:this.getRequestAccountTabIds,getOpenMetamaskTabsIds:this.getOpenMetamaskTabsIds,markNotificationPopupAsAutomaticallyClosed:()=>this.notificationManager.markAsAutomaticallyClosed(),getCode:this.getCode.bind(this),addNewAccount:this.addNewAccount.bind(this),getSeedPhrase:this.getSeedPhrase.bind(this),resetAccount:this.resetAccount.bind(this),removeAccount:this.removeAccount.bind(this),importAccountWithStrategy:this.importAccountWithStrategy.bind(this),getNextAvailableAccountName:e.getNextAvailableAccountName.bind(e),getAccountsBySnapId:e=>(0,it.getAccountsBySnapId)(this.getSnapKeyring.bind(this),e),checkIsSeedlessPasswordOutdated:this.checkIsSeedlessPasswordOutdated.bind(this),syncPasswordAndUnlockWallet:this.syncPasswordAndUnlockWallet.bind(this),subscriptionsStartPolling:this.subscriptionController.startPolling.bind(this.subscriptionController),getSubscriptionsEligibilities:this.subscriptionController.getSubscriptionsEligibilities.bind(this.subscriptionController),assignUserToCohort:this.subscriptionController.assignUserToCohort.bind(this.subscriptionController),getSubscriptions:this.subscriptionController.getSubscriptions.bind(this.subscriptionController),getSubscriptionPricing:this.subscriptionController.getPricing.bind(this.subscriptionController),cacheLastSelectedPaymentMethod:this.subscriptionController.cacheLastSelectedPaymentMethod.bind(this.subscriptionController),getSubscriptionCryptoApprovalAmount:this.subscriptionController.getCryptoApproveTransactionParams.bind(this.subscriptionController),cancelSubscription:this.subscriptionController.cancelSubscription.bind(this.subscriptionController),unCancelSubscription:this.subscriptionController.unCancelSubscription.bind(this.subscriptionController),getSubscriptionBillingPortalUrl:this.subscriptionController.getBillingPortalUrl.bind(this.subscriptionController),startSubscriptionWithCard:this.subscriptionService.startSubscriptionWithCard.bind(this.subscriptionService),updateSubscriptionCardPaymentMethod:this.subscriptionService.updateSubscriptionCardPaymentMethod.bind(this.subscriptionService),startSubscriptionWithCrypto:this.subscriptionController.startSubscriptionWithCrypto.bind(this.subscriptionController),updateSubscriptionCryptoPaymentMethod:this.subscriptionService.updateSubscriptionCryptoPaymentMethod.bind(this.subscriptionService),submitSubscriptionUserEvents:this.subscriptionController.submitUserEvent.bind(this.subscriptionController),getRewardsCandidateSubscriptionId:this.rewardsController.getCandidateSubscriptionId.bind(this.rewardsController),getRewardsSeasonMetadata:this.rewardsController.getSeasonMetadata.bind(this.rewardsController),getRewardsSeasonStatus:this.rewardsController.getSeasonStatus.bind(this.rewardsController),getRewardsHasAccountOptedIn:this.rewardsController.getHasAccountOptedIn.bind(this.rewardsController),estimateRewardsPoints:this.rewardsController.estimatePoints.bind(this.rewardsController),validateRewardsReferralCode:this.rewardsController.validateReferralCode.bind(this.rewardsController),getRewardsGeoMetadata:this.rewardsController.getRewardsGeoMetadata.bind(this.rewardsController),rewardsOptIn:this.rewardsController.optIn.bind(this.rewardsController),rewardsIsOptInSupported:this.rewardsController.isOptInSupported.bind(this.rewardsController),rewardsGetOptInStatus:this.rewardsController.getOptInStatus.bind(this.rewardsController),rewardsLinkAccountsToSubscriptionCandidate:this.rewardsController.linkAccountsToSubscriptionCandidate.bind(this.rewardsController),getSubmitClaimConfig:this.claimsController.getSubmitClaimConfig.bind(this.claimsController),generateClaimSignature:this.claimsController.generateClaimSignature.bind(this.claimsController),getClaims:this.claimsController.getClaims.bind(this.claimsController),connectHardware:this.connectHardware.bind(this),forgetDevice:this.forgetDevice.bind(this),checkHardwareStatus:this.checkHardwareStatus.bind(this),unlockHardwareWalletAccount:this.unlockHardwareWalletAccount.bind(this),attemptLedgerTransportCreation:this.attemptLedgerTransportCreation.bind(this),completeQrCodeScan:n.completeQrCodeScan.bind(n),cancelQrCodeScan:n.cancelQrCodeScan.bind(n),submitPassword:this.submitPassword.bind(this),verifyPassword:this.verifyPassword.bind(this),setActiveNetwork:async e=>await this.multichainNetworkController.setActiveNetwork(e),findNetworkClientIdByChainId:this.networkController.findNetworkClientIdByChainId.bind(this.networkController),getNetworksWithTransactionActivityByAccounts:this.multichainNetworkController.getNetworksWithTransactionActivityByAccounts.bind(this.multichainNetworkController),setActiveNetworkConfigurationId:e=>{this.networkController.setActiveNetwork(e)},setNetworkClientIdForDomain:(e,t)=>this.selectedNetworkController.setNetworkClientIdForDomain(e,t),rollbackToPreviousProvider:m.rollbackToPreviousProvider.bind(m),addNetwork:this._addNetworkAndSetActive.bind(this),updateNetwork:this.networkController.updateNetwork.bind(this.networkController),removeNetwork:this.multichainNetworkController.removeNetwork.bind(this.multichainNetworkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getNetworkConfigurationByNetworkClientId:this.networkController.getNetworkConfigurationByNetworkClientId.bind(this.networkController),setSelectedAddress:e=>{const t=this.accountsController.getAccountByAddress(e);if(!t)throw new Error(`No account found for address: ${e}`);this.accountsController.setSelectedAccount(t.id)},toggleExternalServices:this.toggleExternalServices.bind(this),addToken:b.addToken.bind(b),updateTokenType:b.updateTokenType.bind(b),setFeatureFlag:C.setFeatureFlag.bind(C),setPreference:C.setPreference.bind(C),addKnownMethodData:C.addKnownMethodData.bind(C),setDismissSeedBackUpReminder:C.setDismissSeedBackUpReminder.bind(C),setOverrideContentSecurityPolicyHeader:C.setOverrideContentSecurityPolicyHeader.bind(C),setAdvancedGasFee:C.setAdvancedGasFee.bind(C),setTheme:C.setTheme.bind(C),setSnapsAddSnapAccountModalDismissed:C.setSnapsAddSnapAccountModalDismissed.bind(C),setManageInstitutionalWallets:C.setManageInstitutionalWallets.bind(C),setSelectedInternalAccount:e=>{this.accountsController.getAccount(e)&&this.accountsController.setSelectedAccount(e)},setAccountName:e.setAccountName.bind(e),setAccountLabel:(e,t)=>{const r=this.accountsController.getAccountByAddress(e);if(r===undefined)throw new Error(`No account found for address: ${e}`);this.accountsController.setAccountName(r.id,t)},setSelectedMultichainAccount:e=>{this.accountTreeController.setSelectedAccountGroup(e)},setAccountGroupName:(e,t)=>{this.accountTreeController.setAccountGroupName(e,t)},setAccountGroupPinned:this.accountTreeController.setAccountGroupPinned.bind(this.accountTreeController),setAccountGroupHidden:this.accountTreeController.setAccountGroupHidden.bind(this.accountTreeController),syncAccountTreeWithUserStorage:async()=>{await this.getSnapKeyring(),await this.accountTreeController.syncWithUserStorage()},createNextMultichainAccountGroup:async e=>{await this.multichainAccountService.createNextMultichainAccountGroup({entropySource:e})},alignMultichainWallets:async()=>{this.multichainAccountService&&await this.multichainAccountService.alignWallets()},getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),getTokenSymbol:this.getTokenSymbol.bind(this),getTokenStandardAndDetailsByChain:this.getTokenStandardAndDetailsByChain.bind(this),getERC1155BalanceOf:this.assetsContractController.getERC1155BalanceOf.bind(this.assetsContractController),addNft:o.addNft.bind(o),addNftVerifyOwnership:o.addNftVerifyOwnership.bind(o),removeAndIgnoreNft:o.removeAndIgnoreNft.bind(o),removeNft:o.removeNft.bind(o),checkAndUpdateAllNftsOwnershipStatus:o.checkAndUpdateAllNftsOwnershipStatus.bind(o),checkAndUpdateSingleNftOwnershipStatus:o.checkAndUpdateSingleNftOwnershipStatus.bind(o),getNFTContractInfo:o.getNFTContractInfo.bind(o),isNftOwner:o.isNftOwner.bind(o),setAddressBook:t.set.bind(t),removeFromAddressBook:t.delete.bind(t),setLastActiveTime:n.setLastActiveTime.bind(n),setCurrentExtensionPopupId:n.setCurrentExtensionPopupId.bind(n),setBrowserEnvironment:n.setBrowserEnvironment.bind(n),setDefaultHomeActiveTabName:n.setDefaultHomeActiveTabName.bind(n),setConnectedStatusPopoverHasBeenShown:n.setConnectedStatusPopoverHasBeenShown.bind(n),setRecoveryPhraseReminderHasBeenShown:n.setRecoveryPhraseReminderHasBeenShown.bind(n),setRecoveryPhraseReminderLastShown:n.setRecoveryPhraseReminderLastShown.bind(n),setTermsOfUseLastAgreed:n.setTermsOfUseLastAgreed.bind(n),setSurveyLinkLastClickedOrClosed:n.setSurveyLinkLastClickedOrClosed.bind(n),setOnboardingDate:n.setOnboardingDate.bind(n),setLastViewedUserSurvey:n.setLastViewedUserSurvey.bind(n),setRampCardClosed:n.setRampCardClosed.bind(n),setNewPrivacyPolicyToastClickedOrClosed:n.setNewPrivacyPolicyToastClickedOrClosed.bind(n),setNewPrivacyPolicyToastShownDate:n.setNewPrivacyPolicyToastShownDate.bind(n),setSnapsInstallPrivacyWarningShownStatus:n.setSnapsInstallPrivacyWarningShownStatus.bind(n),setOutdatedBrowserWarningLastShown:n.setOutdatedBrowserWarningLastShown.bind(n),setIsUpdateAvailable:n.setIsUpdateAvailable.bind(n),setUpdateModalLastDismissedAt:n.setUpdateModalLastDismissedAt.bind(n),setLastUpdatedAt:n.setLastUpdatedAt.bind(n),setShowTestnetMessageInDropdown:n.setShowTestnetMessageInDropdown.bind(n),setShowBetaHeader:n.setShowBetaHeader.bind(n),setShowPermissionsTour:n.setShowPermissionsTour.bind(n),setShowAccountBanner:n.setShowAccountBanner.bind(n),setProductTour:n.setProductTour.bind(n),setShowNetworkBanner:n.setShowNetworkBanner.bind(n),updateNftDropDownState:n.updateNftDropDownState.bind(n),getLastInteractedConfirmationInfo:n.getLastInteractedConfirmationInfo.bind(n),deleteDappSwapComparisonData:n.deleteDappSwapComparisonData.bind(n),setLastInteractedConfirmationInfo:n.setLastInteractedConfirmationInfo.bind(n),updateSlides:n.updateSlides.bind(n),removeSlide:n.removeSlide.bind(n),setEnableEnforcedSimulations:n.setEnableEnforcedSimulations.bind(n),setEnableEnforcedSimulationsForTransaction:n.setEnableEnforcedSimulationsForTransaction.bind(n),setEnforcedSimulationsSlippageForTransaction:n.setEnforcedSimulationsSlippageForTransaction.bind(n),setHasShownMultichainAccountsIntroModal:n.setHasShownMultichainAccountsIntroModal.bind(n),updateNetworkConnectionBanner:n.updateNetworkConnectionBanner.bind(n),setShowShieldEntryModalOnce:n.setShowShieldEntryModalOnce.bind(n),setPendingShieldCohort:n.setPendingShieldCohort.bind(n),setShieldPausedToastLastClickedOrClosed:n.setShieldPausedToastLastClickedOrClosed.bind(n),setShieldEndingToastLastClickedOrClosed:n.setShieldEndingToastLastClickedOrClosed.bind(n),setAppActiveTab:n.setAppActiveTab.bind(n),setDefaultSubscriptionPaymentOptions:n.setDefaultSubscriptionPaymentOptions.bind(n),setShieldSubscriptionMetricsProps:n.setShieldSubscriptionMetricsProps.bind(n),tryReverseResolveAddress:c.reverseResolveAddress.bind(c),startOAuthLogin:this.oauthService.startOAuthLogin.bind(this.oauthService),setMarketingConsent:this.oauthService.setMarketingConsent.bind(this.oauthService),getMarketingConsent:this.oauthService.getMarketingConsent.bind(this.oauthService),authenticate:this.seedlessOnboardingController.authenticate.bind(this.seedlessOnboardingController),resetOAuthLoginState:this.seedlessOnboardingController.clearState.bind(this.seedlessOnboardingController),createSeedPhraseBackup:this.createSeedPhraseBackup.bind(this),storeKeyringEncryptionKey:this.seedlessOnboardingController.storeKeyringEncryptionKey.bind(this.seedlessOnboardingController),restoreSocialBackupAndGetSeedPhrase:this.restoreSocialBackupAndGetSeedPhrase.bind(this),syncSeedPhrases:this.syncSeedPhrases.bind(this),changePassword:this.changePassword.bind(this),getIsSeedlessOnboardingUserAuthenticated:this.seedlessOnboardingController.getIsUserAuthenticated.bind(this.seedlessOnboardingController),fetchAndUpdateGatorPermissions:h.fetchAndUpdateGatorPermissions.bind(h),addPendingRevocation:h.addPendingRevocation.bind(h),submitRevocation:h.submitRevocation.bind(h),checkDelegationDisabled:this.checkDelegationDisabled.bind(this),setLocked:this.setLocked.bind(this),createNewVaultAndKeychain:this.createNewVaultAndKeychain.bind(this),createNewVaultAndRestore:this.createNewVaultAndRestore.bind(this),generateNewMnemonicAndAddToVault:this.generateNewMnemonicAndAddToVault.bind(this),importMnemonicToVault:this.importMnemonicToVault.bind(this),exportAccount:this.exportAccount.bind(this),updateTransaction:S.updateTransaction.bind(S),approveTransactionsWithSameNonce:S.approveTransactionsWithSameNonce.bind(S),createCancelTransaction:this.createCancelTransaction.bind(this),createSpeedUpTransaction:this.createSpeedUpTransaction.bind(this),estimateGas:this.estimateGas.bind(this),estimateGasFee:S.estimateGasFee.bind(S),getNextNonce:this.getNextNonce.bind(this),addTransaction:(e,t)=>(0,at.addTransaction)(this.getAddTransactionRequest({transactionParams:e,transactionOptions:t,waitForSubmit:!1})),addTransactionAndWaitForPublish:(e,t)=>(0,at.addTransaction)(this.getAddTransactionRequest({transactionParams:e,transactionOptions:t,waitForSubmit:!0})),createTransactionEventFragment:Fe.createTransactionEventFragmentWithTxId.bind(null,this.getTransactionMetricsRequest()),setTransactionActive:S.setTransactionActive.bind(S),decryptMessage:this.decryptMessageController.decryptMessage.bind(this.decryptMessageController),decryptMessageInline:this.decryptMessageController.decryptMessageInline.bind(this.decryptMessageController),cancelDecryptMessage:this.decryptMessageController.cancelDecryptMessage.bind(this.decryptMessageController),encryptionPublicKey:this.encryptionPublicKeyController.encryptionPublicKey.bind(this.encryptionPublicKeyController),cancelEncryptionPublicKey:this.encryptionPublicKeyController.cancelEncryptionPublicKey.bind(this.encryptionPublicKeyController),setSeedPhraseBackedUp:y.setSeedPhraseBackedUp.bind(y),completeOnboarding:y.completeOnboarding.bind(y),setFirstTimeFlowType:y.setFirstTimeFlowType.bind(y),setAlertEnabledness:r.setAlertEnabledness.bind(r),setUnconnectedAccountAlertShown:r.setUnconnectedAccountAlertShown.bind(r),setWeb3ShimUsageAlertDismissed:r.setWeb3ShimUsageAlertDismissed.bind(r),removePermissionsFor:this.removePermissionsFor,approvePermissionsRequest:this.acceptPermissionsRequest,rejectPermissionsRequest:this.rejectPermissionsRequest,...(0,nt.getPermissionBackgroundApiMethods)({permissionController:v,approvalController:T,accountsController:e,networkController:m,multichainNetworkController:g}),disableSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:disable"),enableSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:enable"),updateSnap:(e,t)=>(this.controllerMessenger.call("SnapController:install",e,t),null),removeSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:remove"),handleSnapRequest:this.handleSnapRequest.bind(this),revokeDynamicSnapPermissions:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:revokeDynamicPermissions"),disconnectOriginFromSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:disconnectOrigin"),updateNetworksList:this.updateNetworksList.bind(this),updateAccountsList:this.updateAccountsList.bind(this),setEnabledNetworks:this.setEnabledNetworks.bind(this),setEnabledAllPopularNetworks:this.setEnabledAllPopularNetworks.bind(this),updateHiddenAccountsList:this.updateHiddenAccountsList.bind(this),getPhishingResult:async e=>(await A.maybeUpdateState(),A.test(e)),deleteInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:deleteInterface"),updateInterfaceState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:updateInterfaceState"),fetchAndSetQuotes:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:fetchAndSetQuotes"),setSelectedQuoteAggId:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSelectedQuoteAggId"),resetSwapsState:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:resetSwapsState"),setSwapsTokens:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsTokens"),clearSwapsQuotes:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:clearSwapsQuotes"),setApproveTxId:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setApproveTxId"),setTradeTxId:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setTradeTxId"),setSwapsTxGasPrice:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsTxGasPrice"),setSwapsTxGasLimit:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsTxGasLimit"),setSwapsTxMaxFeePerGas:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsTxMaxFeePerGas"),setSwapsTxMaxFeePriorityPerGas:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsTxMaxFeePriorityPerGas"),safeRefetchQuotes:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:safeRefetchQuotes"),stopPollingForQuotes:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:stopPollingForQuotes"),setBackgroundSwapRouteState:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setBackgroundSwapRouteState"),resetPostFetchState:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:resetPostFetchState"),setSwapsErrorKey:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsErrorKey"),setInitialGasEstimate:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setInitialGasEstimate"),setCustomApproveTxData:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setCustomApproveTxData"),setSwapsLiveness:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsLiveness"),setSwapsFeatureFlags:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsFeatureFlags"),setSwapsUserFeeLevel:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsUserFeeLevel"),setSwapsQuotesPollingLimitEnabled:this.controllerMessenger.call.bind(this.controllerMessenger,"SwapsController:setSwapsQuotesPollingLimitEnabled"),[R.BridgeBackgroundAction.RESET_STATE]:this.controllerMessenger.call.bind(this.controllerMessenger,`${R.BRIDGE_CONTROLLER_NAME}:${R.BridgeBackgroundAction.RESET_STATE}`),[R.BridgeUserAction.UPDATE_QUOTE_PARAMS]:this.controllerMessenger.call.bind(this.controllerMessenger,`${R.BRIDGE_CONTROLLER_NAME}:${R.BridgeUserAction.UPDATE_QUOTE_PARAMS}`),[R.BridgeBackgroundAction.TRACK_METAMETRICS_EVENT]:this.controllerMessenger.call.bind(this.controllerMessenger,`${R.BRIDGE_CONTROLLER_NAME}:${R.BridgeBackgroundAction.TRACK_METAMETRICS_EVENT}`),[R.BridgeBackgroundAction.FETCH_QUOTES]:this.controllerMessenger.call.bind(this.controllerMessenger,`${R.BRIDGE_CONTROLLER_NAME}:${R.BridgeBackgroundAction.FETCH_QUOTES}`),[q.BridgeStatusAction.SUBMIT_TX]:this.controllerMessenger.call.bind(this.controllerMessenger,`${q.BRIDGE_STATUS_CONTROLLER_NAME}:${q.BridgeStatusAction.SUBMIT_TX}`),fetchSmartTransactionFees:w.getFees.bind(w),clearSmartTransactionFees:w.clearFees.bind(w),submitSignedTransactions:w.submitSignedTransactions.bind(w),cancelSmartTransaction:w.cancelSmartTransaction.bind(w),fetchSmartTransactionsLiveness:w.fetchLiveness.bind(w),updateSmartTransaction:w.updateSmartTransaction.bind(w),setStatusRefreshInterval:w.setStatusRefreshInterval.bind(w),trackMetaMetricsEvent:p.trackEvent.bind(p),trackMetaMetricsPage:p.trackPage.bind(p),createEventFragment:p.createEventFragment.bind(p),updateEventFragment:p.updateEventFragment.bind(p),finalizeEventFragment:p.finalizeEventFragment.bind(p),trackInsightSnapView:this.trackInsightSnapView.bind(this),updateMetaMetricsTraits:p.updateTraits.bind(p),addEventBeforeMetricsOptIn:p.addEventBeforeMetricsOptIn.bind(p),bufferedTrace:p.bufferedTrace.bind(p),bufferedEndTrace:p.bufferedEndTrace.bind(p),rejectAllPendingApprovals:this.rejectAllPendingApprovals.bind(this),rejectPendingApproval:this.rejectPendingApproval,requestUserApproval:T.addAndShowApprovalRequest.bind(T),resolvePendingApproval:this.resolvePendingApproval,resetViewedNotifications:f.resetViewed.bind(f),updateViewedNotifications:f.updateViewed.bind(f),currencyRateStartPolling:a.startPolling.bind(a),currencyRateStopPollingByPollingToken:a.stopPollingByPollingToken.bind(a),multichainAssetsRatesStartPolling:F.startPolling.bind(F),multichainAssetsRatesStopPollingByPollingToken:F.stopPollingByPollingToken.bind(F),tokenRatesStartPolling:M.startPolling.bind(M),tokenRatesStopPollingByPollingToken:M.stopPollingByPollingToken.bind(M),tokenDetectionStartPolling:l.startPolling.bind(l),tokenDetectionStopPollingByPollingToken:l.stopPollingByPollingToken.bind(l),tokenListStartPolling:d.startPolling.bind(d),tokenListStopPollingByPollingToken:d.stopPollingByPollingToken.bind(d),tokenBalancesStartPolling:s.startPolling.bind(s),tokenBalancesStopPollingByPollingToken:s.stopPollingByPollingToken.bind(s),updateBalances:s.updateBalances.bind(s),deFiStartPolling:N.startPolling.bind(N),deFiStopPolling:N.stopPollingByPollingToken.bind(N),gasFeeStartPolling:u.startPolling.bind(u),gasFeeStopPollingByPollingToken:u.stopPollingByPollingToken.bind(u),getGasFeeTimeEstimate:u.getTimeEstimate.bind(u),addPollingTokenToAppState:n.addPollingToken.bind(n),removePollingTokenFromAppState:n.removePollingToken.bind(n),updateThrottledOriginState:n.updateThrottledOriginState.bind(n),backupUserData:k.backupUserData.bind(k),restoreUserData:k.restoreUserData.bind(k),detectTokens:l.detectTokens.bind(l),fetchHistoricalPricesForAsset:(...e)=>this.multichainAssetsRatesController.fetchHistoricalPricesForAsset(...e),detectNfts:i.detectNfts.bind(i),addDetectedTokens:b.addDetectedTokens.bind(b),addImportedTokens:b.addTokens.bind(b),ignoreTokens:b.ignoreTokens.bind(b),getBalancesInSingleCall:(...e)=>this.assetsContractController.getBalancesInSingleCall(...e),performSignIn:E.performSignIn.bind(E),performSignOut:E.performSignOut.bind(E),getUserProfileLineage:E.getUserProfileLineage.bind(E),getBearerToken:E.getBearerToken.bind(E),setIsBackupAndSyncFeatureEnabled:P.setIsBackupAndSyncFeatureEnabled.bind(P),deleteAccountSyncingDataFromUserStorage:P.performDeleteStorageAllFeatureEntries.bind(P),syncContactsWithUserStorage:P.syncContactsWithUserStorage.bind(P),checkAccountsPresence:I.checkAccountsPresence.bind(I),createOnChainTriggers:I.createOnChainTriggers.bind(I),disableAccounts:I.disableAccounts.bind(I),enableAccounts:I.enableAccounts.bind(I),fetchAndUpdateMetamaskNotifications:I.fetchAndUpdateMetamaskNotifications.bind(I),deleteNotificationsById:I.deleteNotificationsById.bind(I),getNotificationsByType:I.getNotificationsByType.bind(I),markMetamaskNotificationsAsRead:I.markMetamaskNotificationsAsRead.bind(I),setFeatureAnnouncementsEnabled:I.setFeatureAnnouncementsEnabled.bind(I),enablePushNotifications:_.enablePushNotifications.bind(_),disablePushNotifications:_.disablePushNotifications.bind(_),enableMetamaskNotifications:I.enableMetamaskNotifications.bind(I),disableMetamaskNotifications:I.disableNotificationServices.bind(I),throwTestError:this.throwTestError.bind(this),captureTestError:this.captureTestError.bind(this),updateProposedNames:this.nameController.updateProposedNames.bind(this.nameController),setName:this.nameController.setName.bind(this.nameController),createSnapAccount:async(e,t,r)=>{const n=await this.getSnapKeyring();return await n.createAccount(e,t,r)},multichainAddAssets:(e,t)=>this.multichainAssetsController.addAssets(e,t),multichainIgnoreAssets:(e,t)=>this.multichainAssetsController.ignoreAssets(e,t),multichainUpdateBalance:e=>this.multichainBalancesController.updateBalance(e),multichainUpdateTransactions:e=>this.multichainTransactionsController.updateTransactionsForAccount(e),decodeTransactionData:e=>(0,ut.decodeTransactionData)({...e,provider:this.provider}),createMetaMetricsDataDeletionTask:this.metaMetricsDataDeletionController.createMetaMetricsDataDeletionTask.bind(this.metaMetricsDataDeletionController),updateDataDeletionTaskStatus:this.metaMetricsDataDeletionController.updateDataDeletionTaskStatus.bind(this.metaMetricsDataDeletionController),endTrace:ye.endTrace,isRelaySupported:Nt.isRelaySupported,isSendBundleSupported:jt.isSendBundleSupported,openUpdateTabAndReload:()=>(0,Ft.openUpdateTabAndReload)(this.requestSafeReload.bind(this)),requestSafeReload:this.requestSafeReload.bind(this),applyTransactionContainersExisting:(e,t)=>(0,Bt.applyTransactionContainersExisting)({containerTypes:t,messenger:this.controllerMessenger,transactionId:e,updateEditableParams:this.txController.updateEditableParams.bind(this.txController)}),lookupSelectedNetworks:this.lookupSelectedNetworks.bind(this),resetWallet:this.resetWallet.bind(this)}}rejectOriginPendingApprovals(e){(0,ft.rejectOriginApprovals)({approvalController:this.approvalController,deleteInterface:e=>this.controllerMessenger.call("SnapInterfaceController:deleteInterface",e),origin:e})}async resetWallet(){this.seedlessOnboardingController.clearState(),this.onboardingController.resetOnboarding(),this.appStateController.setIsWalletResetInProgress(!0)}async exportAccount(e,t){return await this.verifyPassword(t),this.keyringController.exportAccount(t,e)}async getTokenStandardAndDetails(e,t,r){var n,o,i,a;const s=$r(Hr,this,Vr).call(this),{tokensChainsCache:l}=this.tokenListController.state,c=(null==l||null===(n=l[s])||void 0===n?void 0:n.data)||{},{allTokens:d}=this.tokensController.state,u=(null==d||null===(o=d[s])||void 0===o?void 0:o[t])||[],h={...ce.STATIC_MAINNET_TOKEN_LIST[null==e?void 0:e.toLowerCase()]||{},...c[null==e?void 0:e.toLowerCase()]||{},...u.find(({address:t})=>(0,se.isEqualCaseInsensitive)(t,e))||{}},p=(0,se.isEqualCaseInsensitive)(h.standard,J.TokenStandard.ERC20)||!0===h.erc20,m=!(r||(0,se.isEqualCaseInsensitive)(h.standard,J.TokenStandard.ERC1155)||(0,se.isEqualCaseInsensitive)(h.standard,J.TokenStandard.ERC721)||h.erc721),g=h.decimals!==undefined&&h.symbol;let f;if(p||m&&g)try{const r=t?await(0,ae.fetchTokenBalance)(e,t,this.provider):undefined;f={address:e,balance:r,standard:J.TokenStandard.ERC20,decimals:h.decimals,symbol:h.symbol}}catch(e){y.default.warn(`Failed to get token balance. Error: ${e}`)}if(f===undefined)try{f=await this.assetsContractController.getTokenStandardAndDetails(e,t,r)}catch(e){y.default.warn(`Failed to get token standard and details. Error: ${e}`)}if(f){if((0,se.isEqualCaseInsensitive)(f.standard,J.TokenStandard.ERC1155))try{const n=await(0,ae.fetchERC1155Balance)(e,t,r,this.provider),o=null!=n&&n._hex?parseInt(n._hex,16).toString():null;f={...f,balance:o}}catch(e){y.default.warn("Failed to get token balance. Error:",e)}}return{...f,decimals:null===(i=f)||void 0===i||null===(i=i.decimals)||void 0===i?void 0:i.toString(10),balance:null===(a=f)||void 0===a||null===(a=a.balance)||void 0===a?void 0:a.toString(10)}}async getTokenStandardAndDetailsByChain(e,t,r,n){var o,i,a,s;const{tokensChainsCache:l}=this.tokenListController.state,c=(null==l||null===(o=l[n])||void 0===o?void 0:o.data)||{},{allTokens:d}=this.tokensController.state,u=this.accountsController.getSelectedAccount(),h=(null==d||null===(i=d[n])||void 0===i?void 0:i[u.address])||[];let p={};n===X.CHAIN_IDS.MAINNET&&(p=ce.STATIC_MAINNET_TOKEN_LIST[null==e?void 0:e.toLowerCase()]||{});const m=c[null==e?void 0:e.toLowerCase()]||{},g=h.find(({address:t})=>(0,se.isEqualCaseInsensitive)(t,e))||{},f={...p,...m,...g},v=(0,se.isEqualCaseInsensitive)(f.standard,J.TokenStandard.ERC20)||!0===f.erc20,C=!(r||(0,se.isEqualCaseInsensitive)(f.standard,J.TokenStandard.ERC1155)||(0,se.isEqualCaseInsensitive)(f.standard,J.TokenStandard.ERC721)||f.erc721),b=f.decimals!==undefined&&f.symbol;let w;if(v||C&&b)try{let r=0;$r(Hr,this,Vr).call(this)===n&&(r=await(0,ae.fetchTokenBalance)(e,t,this.provider)),w={address:e,balance:r,standard:J.TokenStandard.ERC20,decimals:f.decimals,symbol:f.symbol}}catch(e){y.default.warn(`Failed to get token balance. Error: ${e}`)}if(w===undefined)try{var S,k;const o=null===(S=this.networkController)||void 0===S||null===(S=S.state)||void 0===S||null===(S=S.networkConfigurationsByChainId)||void 0===S||null===(S=S[n])||void 0===S||null===(S=S.rpcEndpoints[null===(k=this.networkController)||void 0===k||null===(k=k.state)||void 0===k||null===(k=k.networkConfigurationsByChainId)||void 0===k||null===(k=k[n])||void 0===k?void 0:k.defaultRpcEndpointIndex])||void 0===S?void 0:S.networkClientId;w=await this.assetsContractController.getTokenStandardAndDetails(e,t,r,o)}catch(e){y.default.warn(`Failed to get token standard and details. Error: ${e}`)}if(w){if((0,se.isEqualCaseInsensitive)(w.standard,J.TokenStandard.ERC1155))try{const n=await(0,ae.fetchERC1155Balance)(e,t,r,this.provider),o=null!=n&&n._hex?parseInt(n._hex,16).toString():null;w={...w,balance:o}}catch(e){y.default.warn("Failed to get token balance. Error:",e)}}return{...w,decimals:null===(a=w)||void 0===a||null===(a=a.decimals)||void 0===a?void 0:a.toString(10),balance:null===(s=w)||void 0===s||null===(s=s.balance)||void 0===s?void 0:s.toString(10)}}async getTokenSymbol(e){try{const t=await this.assetsContractController.getTokenStandardAndDetails(e);return null==t?void 0:t.symbol}catch(e){return null}}async createSeedPhraseBackup(e,r,n){let o=!1;try{var i,a;null===(i=(a=this.metaMetricsController).bufferedTrace)||void 0===i||i.call(a,{name:ye.TraceName.OnboardingCreateKeyAndBackupSrp,op:ye.TraceOperation.OnboardingSecurityOp});const s=t.from(r),l=this._convertMnemonicToWordlistIndices(s);await this.seedlessOnboardingController.createToprfKeyAndBackupSeedPhrase(e,l,n),o=!0,await this.syncKeyringEncryptionKey()}catch(e){var s,l,c,d;const t=e instanceof Error?e.message:"Unknown error";throw null===(s=(l=this.metaMetricsController).bufferedTrace)||void 0===s||s.call(l,{name:ye.TraceName.OnboardingCreateKeyAndBackupSrpError,op:ye.TraceOperation.OnboardingError,tags:{errorMessage:t}}),null===(c=(d=this.metaMetricsController).bufferedEndTrace)||void 0===c||c.call(d,{name:ye.TraceName.OnboardingCreateKeyAndBackupSrpError}),y.default.error("[createSeedPhraseBackup] error",e),e}finally{var u,h;null===(u=(h=this.metaMetricsController).bufferedEndTrace)||void 0===u||u.call(h,{name:ye.TraceName.OnboardingCreateKeyAndBackupSrp,data:{success:o}})}}async fetchAllSecretData(e){let t=!1;try{var r,n;null===(r=(n=this.metaMetricsController).bufferedTrace)||void 0===r||r.call(n,{name:ye.TraceName.OnboardingFetchSrps,op:ye.TraceOperation.OnboardingSecurityOp});const o=await this.seedlessOnboardingController.fetchAllSecretData(e);return t=!0,o}catch(e){var o,i,a,s;const t=e instanceof Error?e.message:"Unknown error";throw null===(o=(i=this.metaMetricsController).bufferedTrace)||void 0===o||o.call(i,{name:ye.TraceName.OnboardingFetchSrpsError,op:ye.TraceOperation.OnboardingError,tags:{errorMessage:t}}),null===(a=(s=this.metaMetricsController).bufferedEndTrace)||void 0===a||a.call(s,{name:ye.TraceName.OnboardingFetchSrpsError}),e}finally{var l,c;null===(l=(c=this.metaMetricsController).bufferedEndTrace)||void 0===l||l.call(c,{name:ye.TraceName.OnboardingFetchSrps,data:{success:t}})}}async syncPasswordAndUnlockWallet(e){const t=this.onboardingController.getIsSocialLoginFlow();let r=!1;if(t)try{r=await this.seedlessOnboardingController.checkIsPasswordOutdated({skipCache:!1})}catch(e){y.default.error("error while checking if password is outdated",e)}if(!t||!r)return await this.submitPassword(e),void(t&&this.seedlessOnboardingController.renewRefreshToken(e).catch(e=>{y.default.error("error while revoking seedless refresh token",e)}).finally(()=>{this.seedlessOnboardingController.revokePendingRefreshTokens().catch(e=>{y.default.error("error while revoking pending refresh tokens",e)})}));const n=await this.seedlessOperationMutex.acquire();try{const t=await this.keyringController.verifyPassword(e).then(()=>!0).catch(e=>{if(e.message.includes("Incorrect password"))return!1;throw y.default.error("error while verifying keyring password",e.message),e});await this.seedlessOnboardingController.submitGlobalPassword({globalPassword:e,maxKeyChainLength:20}).catch(e=>{if(y.default.error(`error while submitting global password: ${e.message}`),e instanceof H.RecoveryError){if((null==e?void 0:e.message)===H.SeedlessOnboardingControllerErrorMessage.IncorrectPassword&&t)throw new Error(H.SeedlessOnboardingControllerErrorMessage.OutdatedPassword);throw new g.JsonRpcError(-32603,e.message,e.data)}throw e});const r=await this.seedlessOnboardingController.loadKeyringEncryptionKey();await this.submitEncryptionKey(r);let n=!1;try{var o,i;await this.seedlessOnboardingController.syncLatestGlobalPassword({globalPassword:e}),null===(o=(i=this.metaMetricsController).bufferedTrace)||void 0===o||o.call(i,{name:ye.TraceName.OnboardingResetPassword,op:ye.TraceOperation.OnboardingSecurityOp}),await this.keyringController.changePassword(e),n=!0,await this.syncKeyringEncryptionKey(),await this.seedlessOnboardingController.checkIsPasswordOutdated({skipCache:!0}),this.seedlessOnboardingController.renewRefreshToken(e).catch(e=>{y.default.error("error while revoking seedless refresh token",e)}).finally(()=>{this.seedlessOnboardingController.revokePendingRefreshTokens().catch(e=>{y.default.error("error while revoking pending refresh tokens",e)})})}catch(e){var a,s,l,c;const t=e instanceof Error?e.message:"Unknown error";throw null===(a=(s=this.metaMetricsController).bufferedTrace)||void 0===a||a.call(s,{name:ye.TraceName.OnboardingResetPasswordError,op:ye.TraceOperation.OnboardingError,tags:{errorMessage:t}}),null===(l=(c=this.metaMetricsController).bufferedEndTrace)||void 0===l||l.call(c,{name:ye.TraceName.OnboardingResetPasswordError}),await this.setLocked({skipSeedlessOperationLock:!0}),e}finally{var d,u;null===(d=(u=this.metaMetricsController).bufferedEndTrace)||void 0===d||d.call(u,{name:ye.TraceName.OnboardingResetPassword,data:{success:n}})}}finally{n()}}async syncKeyringEncryptionKey(){const e=await this.keyringController.exportEncryptionKey();await this.seedlessOnboardingController.storeKeyringEncryptionKey(e)}async checkIsSeedlessPasswordOutdated(e=!1){const t=this.onboardingController.getIsSocialLoginFlow(),{completedOnboarding:r}=this.onboardingController.state;if(!t||!r)return!1;return await this.seedlessOnboardingController.checkIsPasswordOutdated({skipCache:e})}async syncSeedPhrases(){if(!this.onboardingController.getIsSocialLoginFlow())throw new Error("Syncing seed phrases is only available for social login flow");const[e,...r]=await this.fetchAllSecretData();if(!e)throw new Error("No root SRP found");for(const e of r){if(!this.seedlessOnboardingController.getSecretDataBackupState(e.data,e.type)){if(e.type===H.SecretType.PrivateKey){await this.importAccountWithStrategy("privateKey",[(0,x.bytesToHex)(e.data)],{shouldCreateSocialBackup:!1,shouldSelectAccount:!1});continue}const r=this._convertEnglishWordlistIndicesToCodepoints(e.data),n=t.from(r).toString("utf8");await this.importMnemonicToVault(n,{shouldCreateSocialBackup:!1,shouldSelectAccount:!1,shouldImportSolanaAccount:!0})}}}async addNewSeedPhraseBackup(e,r,n=!0){const o=t.from(e,"utf8"),i=this._convertMnemonicToWordlistIndices(o);if(n){const e=await this.seedlessOperationMutex.acquire();let t=!1;try{var a,s;null===(a=(s=this.metaMetricsController).bufferedTrace)||void 0===a||a.call(s,{name:ye.TraceName.OnboardingAddSrp,op:ye.TraceOperation.OnboardingSecurityOp}),await this.seedlessOnboardingController.addNewSecretData(i,H.SecretType.Mnemonic,{keyringId:r}),t=!0}catch(e){var l,c,d,u;const t=e instanceof Error?e.message:"Unknown error";throw null===(l=(c=this.metaMetricsController).bufferedTrace)||void 0===l||l.call(c,{name:ye.TraceName.OnboardingAddSrpError,op:ye.TraceOperation.OnboardingError,tags:{errorMessage:t}}),null===(d=(u=this.metaMetricsController).bufferedEndTrace)||void 0===d||d.call(u,{name:ye.TraceName.OnboardingAddSrpError}),e}finally{var h,p;null===(h=(p=this.metaMetricsController).bufferedEndTrace)||void 0===h||h.call(p,{name:ye.TraceName.OnboardingAddSrp,data:{success:t}}),e()}}else this.seedlessOnboardingController.updateBackupMetadataState({keyringId:r,data:i,type:H.SecretType.Mnemonic})}async changePassword(e,t){const r=await this.seedlessOperationMutex.acquire(),n=this.onboardingController.getIsSocialLoginFlow();try{if(await this.keyringController.changePassword(e),n)try{await this.seedlessOnboardingController.changePassword(e,t);const r=await this.keyringController.exportEncryptionKey();await this.seedlessOnboardingController.storeKeyringEncryptionKey(r)}catch(e){y.default.error("error while changing seedless-onboarding password",e),y.default.error("reverting keyring password change"),await this.keyringController.changePassword(t);const r=await this.keyringController.exportEncryptionKey();throw await this.seedlessOnboardingController.storeKeyringEncryptionKey(r),e}}catch(e){throw y.default.error("error while changing password",e),e}finally{r()}}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire(),r=this.appStateController.getIsWalletResetInProgress();try{r&&(this.permissionController.clearState(),await this.snapController.clearState(),this.accountTreeController.clearState(),this.accountOrderController.updateHiddenAccountsList([]),this.txController.clearUnapprovedTransactions()),await this.keyringController.createNewVaultAndKeychain(e),this.appStateController.setIsWalletResetInProgress(!1);const t=this.keyringController.state.keyrings[0];return await this.accountsController.updateAccounts(),this.accountTreeController.reinit(),await this.forwardSelectedAccountGroupToSnapKeyring(await this.getSnapKeyring(),this.accountTreeController.getSelectedAccountGroup()),t}finally{t()}}getDiscoveryCountByProvider(e){const t={Bitcoin:0,Solana:0,Tron:0},r=Object.values(D.SolAccountType),n=Object.values(D.BtcAccountType),o=Object.values(D.TrxAccountType);for(const i of e)r.includes(i.type)&&(t.Solana+=1),n.includes(i.type)&&(t.Bitcoin+=1),o.includes(i.type)&&(t.Tron+=1);return t}async discoverAndCreateAccounts(e){try{var t;const r=e||(null===(t=this.keyringController.state.keyrings[0])||void 0===t?void 0:t.metadata.id);if(!r)throw new Error("No keyring id to discover accounts for");await this.getSnapKeyring();const n=this.controllerMessenger.call("MultichainAccountService:getMultichainAccountWallet",{entropySource:r}),o=await n.discoverAccounts();return this.getDiscoveryCountByProvider(o)}catch(e){return y.default.warn(`Failed to add accounts with balance. ${e}`),{Bitcoin:0,Solana:0,Tron:0}}}async importMnemonicToVault(e,r={shouldCreateSocialBackup:!0,shouldSelectAccount:!0,shouldImportSolanaAccount:!0}){const{shouldCreateSocialBackup:n,shouldSelectAccount:o,shouldImportSolanaAccount:i}=r,a=await this.createVaultMutex.acquire();try{if(this.keyringController.getKeyringsByType(h.KeyringTypes.hd).some(r=>t.from(this._convertEnglishWordlistIndicesToCodepoints(r.mnemonic)).toString("utf8")===e))throw new Error("This Secret Recovery Phrase has already been imported.");const{id:r}=await this.keyringController.addNewKeyring(h.KeyringTypes.hd,{mnemonic:e,numberOfAccounts:1}),[a]=await this.keyringController.withKeyring({id:r},async({keyring:e})=>e.getAccounts());if(this.onboardingController.getIsSocialLoginFlow())try{await this.addNewSeedPhraseBackup(e,r,n)}catch(e){throw await this.keyringController.removeAccount(a),e}if(o){const e=this.accountsController.getAccountByAddress(a);this.accountsController.setSelectedAccount(e.id)}(async()=>{var e,t;let n;this.isMultichainAccountsFeatureState2Enabled()&&await this.accountTreeController.syncWithUserStorage(),n=this.isMultichainAccountsFeatureState2Enabled()&&i?await this.discoverAndCreateAccounts(r):await this._addAccountsWithBalance(r,i);const o=this.getHDEntropyIndex();this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.ImportSecretRecoveryPhrase,properties:{status:"completed",hd_entropy_index:o,number_of_solana_accounts_discovered:null===(e=n)||void 0===e?void 0:e.Solana,number_of_bitcoin_accounts_discovered:null===(t=n)||void 0===t?void 0:t.Bitcoin}})})()}finally{a()}}async restoreSeedPhrasesToVault(e){if(!this.onboardingController.getIsSocialLoginFlow())return;const r=!1,n=!1;for(const o of e){if(this.seedlessOnboardingController.getSecretDataBackupState(o.data,o.type))continue;if(o.type===H.SecretType.PrivateKey){await this.importAccountWithStrategy("privateKey",[(0,x.bytesToHex)(o.data)],{shouldCreateSocialBackup:r,shouldSelectAccount:n});continue}const e=this._convertEnglishWordlistIndicesToCodepoints(o.data),i=t.from(e).toString("utf8");await this.importMnemonicToVault(i,{shouldCreateSocialBackup:r,shouldSelectAccount:n,shouldImportSolanaAccount:false})}}async restoreSocialBackupAndGetSeedPhrase(e){try{const[r,...n]=await this.fetchAllSecretData(e),o=this._convertEnglishWordlistIndicesToCodepoints(r.data),i=t.from(o).toString("utf8"),a=Array.from(t.from(i,"utf8").values());return await this.createNewVaultAndRestore(e,a),n.length>0&&await this.restoreSeedPhrasesToVault(n),i}catch(e){if(e instanceof H.RecoveryError)throw new g.JsonRpcError(-32603,e.message,e.data);throw e}}async generateNewMnemonicAndAddToVault(){const e=await this.createVaultMutex.acquire();try{const{id:e}=await this.keyringController.addNewKeyring(h.KeyringTypes.hd),[t]=await this.keyringController.withKeyring({id:e},async({keyring:e})=>e.getAccounts()),r=this.accountsController.getAccountByAddress(t);return this.accountsController.setSelectedAccount(r.id),t}finally{e()}}async createNewVaultAndRestore(e,r){const n=await this.createVaultMutex.acquire();try{const{completedOnboarding:n}=this.onboardingController.state,o=t.from(r);this.permissionController.clearState(),await this.snapController.clearState(),this.accountTreeController.clearState(),this.accountOrderController.updateHiddenAccountsList([]),this.txController.clearUnapprovedTransactions(),n&&this.tokenDetectionController.enable();const i=this._convertMnemonicToWordlistIndices(o);if(await this.keyringController.createNewVaultAndRestore(e,i),this.appStateController.setIsWalletResetInProgress(!1),await this.accountsController.updateAccounts(),await this.multichainAccountService.init(),this.accountTreeController.reinit(),await this.forwardSelectedAccountGroupToSnapKeyring(await this.getSnapKeyring(),this.accountTreeController.getSelectedAccountGroup()),n&&(this.isMultichainAccountsFeatureState2Enabled()?(await this.getSnapKeyring(),await this.accountTreeController.syncWithUserStorageAtLeastOnce(),await this.discoverAndCreateAccounts()):await this._addAccountsWithBalance()),(0,Ee.getIsSeedlessOnboardingFeatureEnabled)()){if(this.onboardingController.getIsSocialLoginFlow()){const e=this.keyringController.state.keyrings[0].metadata.id;this.seedlessOnboardingController.updateBackupMetadataState({keyringId:e,data:i,type:H.SecretType.Mnemonic}),await this.syncKeyringEncryptionKey()}}}finally{n()}}async _getMultichainWalletSnapClient(e){const t=await this.getSnapKeyring(),r=this.controllerMessenger;return new we.MultichainWalletSnapClient(e,t,r)}async _addAccountsWithBalance(e,t=!0){try{const o=$r(Hr,this,Vr).call(this),i=e?{id:e}:{type:h.KeyringTypes.hd},{accounts:a,entropySource:s}=await this.keyringController.withKeyring(i,async({keyring:e,metadata:t})=>({accounts:await e.getAccounts(),entropySource:t.id}));let l=a[a.length-1];for(let e=a.length;;e++){if("0x0"===await this.getBalance(l,this.provider)){var r,n;await this.tokenDetectionController.detectTokens({chainIds:[o],selectedAddress:l});const t=null===(r=this.tokensController.state.allTokens)||void 0===r||null===(r=r[o])||void 0===r?void 0:r[l],i=null===(n=this.tokensController.state.allDetectedTokens)||void 0===n||null===(n=n[o])||void 0===n?void 0:n[l];if(0===((null==t?void 0:t.length)??0)&&0===((null==i?void 0:i.length)??0)){1!==e&&await this.removeAccount(l);break}}l=await this.keyringController.withKeyring(i,async({keyring:e})=>{const[t]=await e.addAccounts(1);return t})}const c={Bitcoin:0,Solana:0,Tron:0},d=await this._getMultichainWalletSnapClient(Se.BITCOIN_WALLET_SNAP_ID),u=D.BtcScope.Mainnet,p=await d.discoverAccounts(s,u);if(c.Bitcoin=p.length,0===p.length&&await this._addSnapAccount(s,d,{scope:u,synchronize:!1}),t){const e=await this._getMultichainWalletSnapClient(ke.SOLANA_WALLET_SNAP_ID),t=D.SolScope.Mainnet,r=await e.discoverAccounts(s,t);c.Solana=r.length,0===r.length&&await this._addSnapAccount(s,e,{scope:t})}const m=await this._getMultichainWalletSnapClient(Te.TRON_WALLET_SNAP_ID),g=D.TrxScope.Mainnet,f=await m.discoverAccounts(s,g);return c.Tron=f.length,0===f.length&&await this._addSnapAccount(s,m,{scope:g}),c}catch(e){return y.default.warn(`Failed to add accounts with balance. Error: ${e}`),{Bitcoin:0,Solana:0,Tron:0}}}async _importAccountsWithBalances(){const{keyrings:e}=this.keyringController.state;for(const{metadata:t}of e){await this.keyringController.withKeyring({id:t.id},async({keyring:e})=>e.type===h.KeyringTypes.hd)&&(this.isMultichainAccountsFeatureState2Enabled()?(await this.getSnapKeyring(),await this.accountTreeController.syncWithUserStorageAtLeastOnce(),await this.discoverAndCreateAccounts(t.id)):await this._addAccountsWithBalance(t.id,true))}}async _addSnapAccount(e,t,r={}){let n=e;try{if(!n){n=await this.keyringController.withKeyring({type:h.KeyringTypes.hd},async({metadata:e})=>e.id)}return await t.createAccount({...r,entropySource:n},{displayConfirmation:!1,displayAccountNameSuggestion:!1,setSelectedAccount:!1})}catch(e){return y.default.warn(`Failed to add Snap account. Error: ${e}`),(0,Y.captureException)(e),null}}_convertMnemonicToWordlistIndices(e){const t=e.toString().split(" ").map(e=>_.wordlist.indexOf(e));return new Uint8Array(new Uint16Array(t).buffer)}_convertEnglishWordlistIndicesToCodepoints(e){return t.from(Array.from(new Uint16Array(e.buffer)).map(e=>_.wordlist[e]).join(" "))}async getBalance(e,t){const r=this.accountTrackerController.state.accountsByChainId[$r(Hr,this,Vr).call(this)],n=null==r?void 0:r[(0,Ie.toChecksumHexAddress)(e)];if(n&&n.balance)return n.balance;try{return await t.request({method:"eth_getBalance",params:[e,"latest"]})||"0x0"}catch(e){throw y.default.error(e),e}}async submitPassword(e){await this.submitPasswordOrEncryptionKey({password:e})}async submitEncryptionKey(e){await this.submitPasswordOrEncryptionKey({encryptionKey:e})}async submitPasswordOrEncryptionKey({password:e,encryptionKey:t}){const r=this.onboardingController.getIsSocialLoginFlow();await this.offscreenPromise,t?await this.keyringController.submitEncryptionKey(t):(await this.keyringController.submitPassword(e),r&&await this.seedlessOnboardingController.submitPassword(e));try{await this.blockTracker.checkForLatestBlock()}catch(e){y.default.error("Error while unlocking extension.",e)}if(await this.accountsController.updateAccounts(),await this.multichainAccountService.init(),this.accountTreeController.init(),await this.forwardSelectedAccountGroupToSnapKeyring(await this.getSnapKeyring(),this.accountTreeController.getSelectedAccountGroup()),this.isMultichainAccountsFeatureState2Enabled()){(async()=>{await this.multichainAccountService.resyncAccounts(),await this.multichainAccountService.alignWallets()})()}}async _loginUser(e){try{await this.submitPassword(e)}finally{this._startUISync()}}_startUISync(){this.emit("startUISync"),this.startUISync=!0,this.memStore.subscribe(this.sendUpdate.bind(this))}async submitEncryptionKeyFromSessionStorage(){try{const{loginToken:e,loginSalt:t}=await this.extension.storage.session.get(["loginToken","loginSalt"]);if(e&&t){const{vault:r}=this.keyringController.state;if(JSON.parse(r).salt!==t)return console.warn("submitEncryptionKey: Stored salt and vault salt do not match"),void await this.clearLoginArtifacts();await this.keyringController.submitEncryptionKey(e,t)}}catch(e){throw await this.clearLoginArtifacts(),e}}async clearLoginArtifacts(){await this.extension.storage.session.remove(["loginToken","loginSalt"])}async verifyPassword(e){await this.keyringController.verifyPassword(e)}getPrimaryKeyringMnemonic(){const[e]=this.keyringController.getKeyringsByType(ee.KeyringType.hdKeyTree);if(!e.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return e.mnemonic}getPrimaryKeyringMnemonicSeed(){const[e]=this.keyringController.getKeyringsByType(ee.KeyringType.hdKeyTree);if(!e.seed)throw new Error("Primary keyring mnemonic unavailable.");return e.seed}async attemptLedgerTransportCreation(){return await $r(Hr,this,Wr).call(this,{name:Z.HardwareDeviceNames.ledger},async e=>e.attemptMakeApp())}async connectHardware(e,t,r){return $r(Hr,this,Wr).call(this,{name:e,hdPath:r},async e=>{let r=[];switch(t){case-1:r=await e.getPreviousPage();break;case 1:r=await e.getNextPage();break;default:r=await e.getFirstPage()}return r})}async checkHardwareStatus(e,t){return $r(Hr,this,Wr).call(this,{name:e,hdPath:t},async e=>e.isUnlocked())}async getHardwareTypeForMetric(e){return await this.keyringController.withKeyring({address:e},({keyring:e})=>Z.HardwareKeyringType[e.type])}async forgetDevice(e){return $r(Hr,this,Wr).call(this,{name:e},async e=>{for(const t of await e.getAccounts())this._onAccountRemoved(t);return e.forgetDevice(),!0})}async getAccountType(e){switch(await this.keyringController.getAccountKeyringType(e)){case ee.KeyringType.trezor:case ee.KeyringType.oneKey:case ee.KeyringType.lattice:case ee.KeyringType.qr:case ee.KeyringType.ledger:return"hardware";case ee.KeyringType.imported:return"imported";case ee.KeyringType.snap:return"snap";default:return"MetaMask"}}async getDeviceModel(e){return this.keyringController.withKeyring({address:e},async({keyring:e})=>{switch(e.type){case ee.KeyringType.trezor:case ee.KeyringType.oneKey:return e.getModel();case ee.KeyringType.qr:return e.getName();case ee.KeyringType.ledger:return Z.HardwareDeviceNames.ledger;case ee.KeyringType.lattice:return Z.HardwareDeviceNames.lattice;default:return undefined}})}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,n){const{address:o}=await $r(Hr,this,Wr).call(this,{name:t,hdPath:r},async r=>{r.setAccountToUnlock(e);const[o]=await r.addAccounts(1);return{address:(0,B.normalize)(o),label:this.getAccountLabel(t===Z.HardwareDeviceNames.qr?r.getName():t,e,n)}});this.preferencesController.setSelectedAddress(o);const i=this.accountsController.listAccounts(),{identities:a}=this.preferencesController.state;return{unlockedAccount:o,identities:a,accounts:i}}async addNewAccount(e,t){const r=await this.keyringController.getAccounts(),n=t?{id:t}:{type:h.KeyringTypes.hd},o=await this.keyringController.withKeyring(n,async({keyring:t})=>{if(t.type!==h.KeyringTypes.hd)throw new Error("Cannot add account to non-HD keyring");const n=await t.getAccounts();if(e&&e!==n.length){if(e>n.length)throw new Error("Account out of sequence");const t=n[e];if(!t)throw new Error(`Can't find account at index ${e}`);return t}const[o]=await t.addAccounts(1);if(r.includes(o))throw await t.removeAccount(o),new Error(`Cannot add duplicate ${o} account`);return o});return r.includes(o)||this.preferencesController.setSelectedAddress(o),o}async getSeedPhrase(e,t){return this._convertEnglishWordlistIndicesToCodepoints(await this.keyringController.exportSeedPhrase(e,t))}async resetAccount(){const e=this.accountsController.getSelectedAccount().address,t=$r(Hr,this,Vr).call(this);return this.txController.wipeTransactions({address:e,chainId:t}),this.smartTransactionsController.wipeSmartTransactions({address:e,ignoreNetwork:!1}),this.bridgeStatusController.wipeBridgeStatus({address:e,ignoreNetwork:!1}),this.networkController.resetConnection(),e}captureKeyringTypesWithMissingIdentities(e=[],t=[]){const r=t.filter(t=>!e.some(e=>e.address.toLowerCase()===t.toLowerCase())).map(e=>this.keyringController.getAccountKeyringType(e)),n=e.length,o=this.accountTrackerController.state.accountsByChainId[$r(Hr,this,Vr).call(this)],i=Object.keys(o||{}).length;(0,Y.captureException)(new Error(`Attempt to get permission specifications failed because their were ${t.length} accounts, but ${n} identities, and the ${r} keyrings included accounts with missing identities. Meanwhile, there are ${i} accounts in the account tracker.`))}sortEvmAccountsByLastSelected(e){const t=this.accountsController.listAccounts();return this.sortAddressesWithInternalAccounts(e,t)}sortMultichainAccountsByLastSelected(e){const t=this.accountsController.listMultichainAccounts();return this.sortAddressesWithInternalAccounts(e,t)}sortAddressesWithInternalAccounts(e,t){return e.sort((r,n)=>{const o=t.find(e=>e.address.toLowerCase()===r.toLowerCase()),i=t.find(e=>e.address.toLowerCase()===n.toLowerCase());if(!o)throw this.captureKeyringTypesWithMissingIdentities(t,e),new Error(`Missing identity for address: "${r}".`);if(!i)throw this.captureKeyringTypesWithMissingIdentities(t,e),new Error(`Missing identity for address: "${n}".`);return o.metadata.lastSelected===i.metadata.lastSelected?0:o.metadata.lastSelected===undefined?1:i.metadata.lastSelected===undefined?-1:i.metadata.lastSelected-o.metadata.lastSelected})}getPermittedAccounts(e){let t;try{t=this.permissionController.getCaveat(e,K.Caip25EndowmentPermissionName,K.Caip25CaveatType)}catch(e){if(e instanceof M.PermissionDoesNotExistError)return[];throw e}const r=(0,K.getEthAccounts)(t.value);return this.sortEvmAccountsByLastSelected(r)}async handleHyperliquidReferral(e,t){var r;if(!(null===(r=this.remoteFeatureFlagController)||void 0===r||null===(r=r.state)||void 0===r||null===(r=r.remoteFeatureFlags)||void 0===r?void 0:r.extensionUxDefiReferral))return;const n=this.getPermittedAccounts(Re.HYPERLIQUID_ORIGIN);if(0===n.length)return;if(this.approvalController.has({origin:Re.HYPERLIQUID_ORIGIN,type:ne.HYPERLIQUID_APPROVAL_TYPE}))return;const o=n[0],i=this.preferencesController.state.referrals.hyperliquid,a=i[o],s=Object.keys(i).filter(e=>i[e]===Je.ReferralStatus.Declined),l=a===undefined,c=a===Je.ReferralStatus.Approved;if(l)try{this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.ReferralViewed,category:oe.MetaMetricsEventCategory.Referrals,properties:{url:Re.HYPERLIQUID_ORIGIN,trigger_type:t}});const r=await this.approvalController.add({origin:Re.HYPERLIQUID_ORIGIN,type:ne.HYPERLIQUID_APPROVAL_TYPE,requestData:{selectedAddress:o},shouldShowRequest:t===rt.HyperliquidPermissionTriggerType.NewConnection});null!=r&&r.approved?(this._handleHyperliquidApprovedAccount(o,n,s),await this._handleHyperliquidReferralRedirect(e,o)):this.preferencesController.addReferralDeclinedAccount(o),this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.ReferralConfirmButtonClicked,category:oe.MetaMetricsEventCategory.Referrals,properties:{opt_in:Boolean(null==r?void 0:r.approved)}})}catch(e){if(e.code===g.errorCodes.provider.userRejectedRequest)return;throw e}c&&await this._handleHyperliquidReferralRedirect(e,o)}async _handleHyperliquidReferralRedirect(e,t){await this._updateHyperliquidReferralUrl(e),this.preferencesController.addReferralPassedAccount(t)}_handleHyperliquidApprovedAccount(e,t,r){0===r.length?this.preferencesController.setAccountsReferralApproved(t):(this.preferencesController.addReferralApprovedAccount(e),t.forEach(e=>{r.includes(e)&&this.preferencesController.removeReferralDeclinedAccount(e)}))}async _updateHyperliquidReferralUrl(e){try{const{url:t}=await i.default.tabs.get(e),{search:r}=new URL(t||""),n=`${Re.HYPERLIQUID_ORIGIN}/join/${Re.METAMASK_REFERRAL_CODE}${r}`;await i.default.tabs.update(e,{url:n})}catch(e){y.default.error("Failed to update URL to Hyperliquid referral page: ",e)}}removeAllScopePermissions(e){this.permissionController.updatePermissionsByCaveat(K.Caip25CaveatType,t=>K.Caip25CaveatMutators[K.Caip25CaveatType].removeScope(t,e))}removeAllAccountPermissions(e){this.permissionController.updatePermissionsByCaveat(K.Caip25CaveatType,t=>K.Caip25CaveatMutators[K.Caip25CaveatType].removeAccount(t,e))}async removeAccount(e){return this._onAccountRemoved(e),await this.keyringController.removeAccount(e),e}async importAccountWithStrategy(e,t,r={shouldCreateSocialBackup:!0,shouldSelectAccount:!0}){const{shouldCreateSocialBackup:n,shouldSelectAccount:o}=r,i=await this.keyringController.importAccountWithStrategy(e,t);if(this.onboardingController.getIsSocialLoginFlow()){const{id:e,privateKey:t}=await this.keyringController.withKeyring({address:i},async({keyring:e,metadata:t})=>{const r=await e.exportAccount(i);return{id:t.id,privateKey:r}});try{await this.addNewPrivateKeyBackup(t,e,n)}catch(e){throw await this.keyringController.removeAccount(i),e}}o&&this.preferencesController.setSelectedAddress(i)}async addNewPrivateKeyBackup(e,t,r=!0){const n=(0,x.hexToBytes)((0,x.add0x)(e));if(r){const e=await this.seedlessOperationMutex.acquire();try{await this.seedlessOnboardingController.addNewSecretData(n,H.SecretType.PrivateKey,{keyringId:t})}catch(e){throw y.default.error("Error adding new private key backup",e),e}finally{e()}}else this.seedlessOnboardingController.updateBackupMetadataState({keyringId:t,data:n,type:H.SecretType.PrivateKey})}async requestPermissionApproval(e,t,r={}){const n=(0,k.nanoid)();return this.approvalController.addAndShowApprovalRequest({id:n,origin:e,requestData:{metadata:{id:n,origin:e},permissions:t,...r},type:M.MethodNames.RequestPermissions})}async requestApprovalPermittedChainsPermission(e,t){const r=(0,K.setPermittedEthChainIds)({requiredScopes:{},optionalScopes:{},sessionProperties:{},isMultichainOrigin:!1},[t]);await this.permissionController.requestPermissionsIncremental({origin:e},{[K.Caip25EndowmentPermissionName]:{caveats:[{type:K.Caip25CaveatType,value:r}]}})}getNonEvmSupportedMethods(e){return this.controllerMessenger.call("MultichainRouter:getSupportedMethods",e)}notifySolanaAccountChangedForCurrentAccount(e){var t;let r;try{r=this.permissionController.getCaveat(e,K.Caip25EndowmentPermissionName,K.Caip25CaveatType)}catch{}if(!r)return;const n=null===(t=r.value.sessionProperties)||void 0===t?void 0:t[K.KnownSessionProperties.SolanaAccountChangedNotifications],o=(0,K.getSessionScopes)(r.value,{getNonEvmSupportedMethods:this.getNonEvmSupportedMethods.bind(this)}),i=o[Ce.MultichainNetworks.SOLANA]||o[Ce.MultichainNetworks.SOLANA_DEVNET]||o[Ce.MultichainNetworks.SOLANA_TESTNET];if(n&&i){const{accounts:t}=i,r=t.map(e=>{const{address:t}=(0,x.parseCaipAccountId)(e);return t}),[n]=this.sortMultichainAccountsByLastSelected(r);n&&this._notifySolanaAccountChange(e,[n])}}getAddTransactionRequest({transactionParams:e,transactionOptions:t,dappRequest:r,...n}){var o;const i=(null==r?void 0:r.networkClientId)??(null==t?void 0:t.networkClientId),{chainId:a}=this.networkController.getNetworkConfigurationByNetworkClientId(i);return{internalAccounts:this.accountsController.listAccounts(),dappRequest:r,networkClientId:i,selectedAccount:this.accountsController.getAccountByAddress(e.from),transactionController:this.txController,transactionOptions:t,transactionParams:e,userOperationController:this.userOperationController,chainId:a,ppomController:this.ppomController,securityAlertsEnabled:null===(o=this.preferencesController.state)||void 0===o?void 0:o.securityAlertsEnabled,updateSecurityAlertResponse:this.updateSecurityAlertResponse.bind(this),getSecurityAlertResponse:this.appStateController.getAddressSecurityAlertResponse.bind(this.appStateController),addSecurityAlertResponse:this.appStateController.addAddressSecurityAlertResponse.bind(this.appStateController),getSecurityAlertsConfig:this.getSecurityAlertsConfig.bind(this),...n}}async createCancelTransaction(e,t,r){await this.txController.stopTransaction(e,t,r);return this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.speedUpTransaction(e,t,r);return this.getState()}async estimateGas(e){return new Promise((t,r)=>{this.provider.request({method:"eth_estimateGas",params:[e]}).then(e=>t(e.toString(16))).catch(e=>r(e))})}async updateSecurityAlertResponse(e,t,r){return await(0,ct.updateSecurityAlertResponse)({appStateController:this.appStateController,messenger:this.controllerMessenger,method:e,securityAlertId:t,securityAlertResponse:r,signatureController:this.signatureController,transactionController:this.txController})}getHDEntropyIndex(){const e=this.accountsController.getSelectedAccount(),t=this.keyringController.state.keyrings.filter(e=>e.type===h.KeyringTypes.hd).findIndex(t=>t.accounts.includes(e.address));return-1===t?undefined:t}markPasswordForgotten(){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate()}unMarkPasswordForgotten(){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate()}setupUntrustedCommunicationEip1193({connectionStream:e,sender:t,subjectType:r}){if(t.url&&this.onboardingController.state.completedOnboarding&&this.preferencesController.state.usePhishDetect){const{hostname:r}=new URL(t.url);this.phishingController.maybeUpdateState();const n=this.phishingController.test(t.url);if(null!=n&&n.result)return this.sendPhishingWarning(e,r),void this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.PhishingPageDisplayed,category:oe.MetaMetricsEventCategory.Phishing,properties:{url:r}})}let n;n=r||(t.id&&t.id!==this.extension.runtime.id?M.SubjectType.Extension:M.SubjectType.Website);const o=(0,Ye.setupMultiplex)(e);o.ignoreStream(lt.METAMASK_CAIP_MULTICHAIN_PROVIDER),this.setupProviderConnectionEip1193(o.createStream(lt.METAMASK_EIP_1193_PROVIDER),t,n),t.url&&this.setupPublicConfig(o.createStream("publicConfig"))}setupUntrustedCommunicationCaip({connectionStream:e,sender:t,subjectType:r}){let n;n=r||(t.id&&t.id!==this.extension.runtime.id?M.SubjectType.Extension:M.SubjectType.Website),this.setupProviderConnectionCaip(e,t,n)}setupTrustedCommunication(e,t){const r=(0,Ye.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnectionEip1193(r.createStream("provider"),t,M.SubjectType.Internal)}setupPhishingCommunication({connectionStream:e}){const{usePhishDetect:t}=this.preferencesController.state;if(!t)return;const r=(0,Ye.setupMultiplex)(e).createStream("metamask-phishing-safelist");r.on("data",(0,Ze.default)({safelistPhishingDomain:this.safelistPhishingDomain.bind(this),backToSafetyPhishingWarning:this.backToSafetyPhishingWarning.bind(this)},r))}setUpCookieHandlerCommunication({connectionStream:e}){const{metaMetricsId:t,dataCollectionForMarketing:r,participateInMetaMetrics:n}=this.metaMetricsController.state;if(t&&r&&n){const t=(0,Ye.setupMultiplex)(e).createStream(lt.METAMASK_COOKIE_HANDLER);t.on("data",(0,Ze.default)({getCookieFromMarketingPage:this.getCookieFromMarketingPage.bind(this)},t))}}getCookieFromMarketingPage(e){const{ga_client_id:t}=e;this.metaMetricsController.setMarketingCampaignCookieId(t)}sendPhishingWarning(e,t){(0,Ye.setupMultiplex)(e).createStream("phishing").write({hostname:t})}setupControllerConnection(e){const t=new mt.PatchStore(this.memStore);let r=!1;const n=()=>{if(!(0,Ye.isStreamWritable)(e)||!r)return;const n=t.flushPendingPatches();e.write({jsonrpc:"2.0",method:"sendUpdate",params:[n]})},i={...this.getApi(),...this.controllerApi,startPatches:()=>{r=!0,n()},getStatePatches:()=>t.flushPendingPatches()};this.on("update",n),this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,Ze.default)(i,e));const a=()=>{(0,Ye.isStreamWritable)(e)&&e.write({jsonrpc:"2.0",method:"startUISync"})};this.startUISync?a():this.once("startUISync",a);const s=()=>{e.mmFinished||(this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.mmFinished=!0,this.removeListener("update",n),t.destroy())};e.mmFinished=!1,(0,o.finished)(e,s),e.once("close",s),e.once("end",s)}setupProviderConnectionEip1193(e,t,r){let n,i;n=r===M.SubjectType.Internal?ne.ORIGIN_METAMASK:r===M.SubjectType.Snap?t.snapId:new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:n,extensionId:t.id,subjectType:M.SubjectType.Extension}),t.tab&&t.tab.id&&(i=t.tab.id);let a=n;t.tab&&t.tab.url&&(a=new URL(t.tab.url).origin);const l=this.setupProviderEngineEip1193({origin:n,sender:t,subjectType:r,tabId:i,mainFrameOrigin:a}),c=(0,qe.default)(),d=(0,s.createEngineStream)({engine:l}),u=this.addConnection(n,{tabId:i,apiType:Kr,engine:l});(0,o.pipeline)(e,c,d,e,e=>{var t;l.destroy(),u&&this.removeConnection(n,u),!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||y.default.error(e)}),r!==M.SubjectType.Internal&&this._notifyChainChangeForConnection({engine:l},n)}setupProviderConnectionCaip(e,t,r){let n,i;n=r===M.SubjectType.Internal?ne.ORIGIN_METAMASK:r===M.SubjectType.Snap?t.snapId:new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:n,extensionId:t.id,subjectType:M.SubjectType.Extension}),t.tab&&t.tab.id&&(i=t.tab.id);const a=this.setupProviderEngineCaip({origin:n,sender:t,subjectType:r,tabId:i}),l=(0,qe.default)(),c=(0,s.createEngineStream)({engine:a}),d=this.addConnection(n,{tabId:i,apiType:qr,engine:a});setTimeout(()=>this.notifySolanaAccountChangedForCurrentAccount(n),500),(0,o.pipeline)(e,l,c,e,e=>{var t;a.destroy(),d&&this.removeConnection(n,d),!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||y.default.error(e)})}setupCommonMiddlewareHooks(e){return{addSubjectMetadata:this.subjectMetadataController.addSubjectMetadata.bind(this.subjectMetadataController),getProviderState:this.getProviderState.bind(this),handleWatchAssetRequest:this.handleWatchAssetRequest.bind(this),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),getCaveat:({target:t,caveatType:r})=>{try{return this.permissionController.getCaveat(e,t,r)}catch(e){if(!(e instanceof M.PermissionDoesNotExistError))throw e}return undefined},requestPermittedChainsPermissionIncrementalForOrigin:t=>(0,K.requestPermittedChainsPermissionIncremental)({...t,origin:e,hooks:{requestPermissionsIncremental:this.permissionController.requestPermissionsIncremental.bind(this.permissionController),grantPermissionsIncremental:this.permissionController.grantPermissionsIncremental.bind(this.permissionController)}}),addNetwork:this._addNetworkAndSetActive.bind(this),updateNetwork:this.networkController.updateNetwork.bind(this.networkController),setActiveNetwork:async t=>{this.permissionController.hasPermission(e,K.Caip25EndowmentPermissionName)?this.selectedNetworkController.setNetworkClientIdForDomain(e,t):await this.networkController.setActiveNetwork(t)},getNetworkConfigurationByChainId:this.networkController.getNetworkConfigurationByChainId.bind(this.networkController),setTokenNetworkFilter:e=>{const{tokenNetworkFilter:t}=this.preferencesController.getPreferences();e&&1===Object.keys(t).length&&this.preferencesController.setPreference("tokenNetworkFilter",{[e]:!0})},setEnabledNetworks:e=>{this.networkEnablementController.enableNetwork(e)},getEnabledNetworks:e=>this.networkEnablementController.state.enabledNetworkMap[e]||{},getCurrentChainIdForDomain:this.getCurrentChainIdForDomain.bind(this),getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController),rejectApprovalRequestsForOrigin:()=>this.rejectOriginPendingApprovals(e)}}setupProviderEngineEip1193({origin:e,subjectType:t,sender:r,tabId:n,mainFrameOrigin:o}){var i;const s=new a.JsonRpcEngine;s.push((0,We.default)({origin:e})),o&&s.push((0,Ve.default)({mainFrameOrigin:o})),s.push((0,E.createSelectedNetworkMiddleware)(this.controllerMessenger));const l=this.selectedNetworkController.getProviderAndBlockTracker(e),c=(0,p.default)(l),u=(0,m.default)(l);u.events.on("notification",e=>s.emit("notification",e)),n&&s.push((0,ze.default)({tabId:n})),s.push((0,He.default)({origin:e})),s.push(this.permissionLogController.createMiddleware()),s.push((0,ht.default)()),s.push((0,pt.default)({getThrottledOriginState:this.appStateController.getThrottledOriginState.bind(this.appStateController),updateThrottledOriginState:this.appStateController.updateThrottledOriginState.bind(this.appStateController)})),s.push((0,je.createPPOMMiddleware)(this.ppomController,this.preferencesController,this.networkController,this.appStateController,this.accountsController,this.updateSecurityAlertResponse.bind(this),this.getSecurityAlertsConfig.bind(this))),s.push((0,Le.createDappSwapMiddleware)({fetchQuotes:this.controllerMessenger.call.bind(this.controllerMessenger,`${R.BRIDGE_CONTROLLER_NAME}:${R.BridgeBackgroundAction.FETCH_QUOTES}`),setDappSwapComparisonData:this.appStateController.setDappSwapComparisonData.bind(this.appStateController),getNetworkConfigurationByNetworkClientId:this.networkController.getNetworkConfigurationByNetworkClientId.bind(this.networkController),dappSwapMetricsFlag:null===(i=this.remoteFeatureFlagController)||void 0===i||null===(i=i.state)||void 0===i||null===(i=i.remoteFeatureFlags)||void 0===i?void 0:i.dappSwapMetrics})),s.push((0,Ue.createTrustSignalsMiddleware)(this.networkController,this.appStateController,this.phishingController,this.preferencesController,this.getPermittedAccounts.bind(this)));const g=new A.Messenger({namespace:"SnapAndHardwareMessenger",parent:this.controllerMessenger});this.controllerMessenger.delegate({messenger:g,actions:["KeyringController:getKeyringForAccount","KeyringController:getState","SnapController:get","AccountsController:getSelectedAccount"]}),s.push((0,ot.default)({getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getHDEntropyIndex:this.getHDEntropyIndex.bind(this),getHardwareTypeForMetric:this.getHardwareTypeForMetric.bind(this),snapAndHardwareMessenger:g,appStateController:this.appStateController,metaMetricsController:this.metaMetricsController})),s.push((0,Ge.createUnsupportedMethodMiddleware)()),t===M.SubjectType.Snap&&(0,Pe.isSnapPreinstalled)(e)&&s.push((0,P.createPreinstalledSnapsMiddleware)({getPermissions:this.permissionController.getPermissions.bind(this.permissionController,e),getAllEvmAccounts:()=>this.controllerMessenger.call("AccountsController:listAccounts").map(e=>e.address),grantPermissions:t=>this.controllerMessenger.call("PermissionController:grantPermissions",{approvedPermissions:t,subject:{origin:e}})})),s.push((0,Ge.createEthAccountsMethodMiddleware)({getAccounts:this.getPermittedAccounts.bind(this,e)})),t!==M.SubjectType.Internal&&(s.push(this.permissionController.createPermissionMiddleware({origin:e})),s.push((0,rt.createHyperliquidReferralMiddleware)(this.handleHyperliquidReferral.bind(this)))),t===M.SubjectType.Website&&s.push((0,Qe.default)({location:r.url,registerOnboarding:this.onboardingController.registerOnboarding}));const f=new A.Messenger({namespace:"EvmMethodsToNonEvmAccountFilterMessenger",parent:this.controllerMessenger});return this.controllerMessenger.delegate({messenger:f,actions:["AccountsController:getSelectedAccount"]}),s.push((0,dt.default)({messenger:f})),s.push((0,Ge.createEip1193MethodMiddleware)({subjectType:t,...this.setupCommonMiddlewareHooks(e),metamaskState:this.getState(),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAccounts:this.getPermittedAccounts.bind(this,e),getCaip25PermissionFromLegacyPermissionsForOrigin:e=>(0,K.getCaip25PermissionFromLegacyPermissions)(e),getPermissionsForOrigin:this.permissionController.getPermissions.bind(this.permissionController,e),requestPermissionsForOrigin:t=>this.permissionController.requestPermissions({origin:e},t,{metadata:{isEip1193Request:!0}}),revokePermissionsForOrigin:t=>{try{this.permissionController.revokePermissions({[e]:t})}catch(e){console.log(e)}},updateCaveat:this.permissionController.updateCaveat.bind(this.permissionController,e),hasApprovalRequestsForOrigin:()=>this.approvalController.has({origin:e})})),s.push((0,P.createSnapsMethodMiddleware)(t===M.SubjectType.Snap,{clearSnapState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:clearSnapState",e),getUnlockPromise:this.controllerMessenger.call.bind(this.controllerMessenger,"AppStateController:getUnlockPromise"),getSnaps:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getPermitted",e),requestPermissions:async t=>await this.permissionController.requestPermissions({origin:e},t),getPermissions:this.permissionController.getPermissions.bind(this.permissionController,e),getSnapFile:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getFile",e),getSnapState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getSnapState",e),updateSnapState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:updateSnapState",e),installSnaps:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:install",e),invokeSnap:this.permissionController.executeRestrictedMethod.bind(this.permissionController,e,te.RestrictedMethods.wallet_snap),getIsLocked:()=>{const{isUnlocked:e}=this.controllerMessenger.call("KeyringController:getState");return!e},getIsActive:()=>{const{isUnlocked:e}=this.controllerMessenger.call("KeyringController:getState");return this._isClientOpen&&e},getVersion:()=>"13.11.0",getInterfaceState:(...t)=>this.controllerMessenger.call("SnapInterfaceController:getInterface",e,...t).state,getInterfaceContext:(...t)=>this.controllerMessenger.call("SnapInterfaceController:getInterface",e,...t).context,createInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:createInterface",e),updateInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:updateInterface",e),resolveInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:resolveInterface",e),getSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:get"),trackError:e=>{var t,r;return null===(t=global.sentry)||void 0===t||null===(r=t.captureException)||void 0===r?void 0:r.call(t,e)},trackEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAllSnaps:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getAll"),openWebSocket:this.controllerMessenger.call.bind(this.controllerMessenger,"WebSocketService:open",e),closeWebSocket:this.controllerMessenger.call.bind(this.controllerMessenger,"WebSocketService:close",e),getWebSockets:this.controllerMessenger.call.bind(this.controllerMessenger,"WebSocketService:getAll",e),sendWebSocketMessage:this.controllerMessenger.call.bind(this.controllerMessenger,"WebSocketService:sendMessage",e),getCurrencyRate:e=>{const t=this.multichainRatesController.state.rates[e],{fiatCurrency:r}=this.multichainRatesController.state;return t?{...t,currency:r}:undefined},getEntropySources:()=>this.controllerMessenger.call("KeyringController:getState").keyrings.map((e,t)=>e.type===h.KeyringTypes.hd?{id:e.metadata.id,name:e.metadata.name,type:"mnemonic",primary:0===t}:null).filter(Boolean),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),scheduleBackgroundEvent:t=>this.controllerMessenger.call("CronjobController:schedule",{...t,snapId:e}),cancelBackgroundEvent:this.controllerMessenger.call.bind(this.controllerMessenger,"CronjobController:cancel",e),getBackgroundEvents:this.controllerMessenger.call.bind(this.controllerMessenger,"CronjobController:get",e),getNetworkConfigurationByChainId:this.controllerMessenger.call.bind(this.controllerMessenger,"NetworkController:getNetworkConfigurationByChainId"),getNetworkClientById:this.controllerMessenger.call.bind(this.controllerMessenger,"NetworkController:getNetworkClientById"),startTrace:e=>{const{_isStandaloneSpan:t,...r}=(0,ye.trace)(e);return r},endTrace:ye.endTrace,handleSnapRpcRequest:t=>this.handleSnapRequest({...t,origin:e}),getAllowedKeyringMethods:(0,Oe.keyringSnapPermissionsBuilder)(this.subjectMetadataController,e)})),s.push(c),s.push(u.middleware),s.push(this.metamaskMiddleware),s.push(this.eip5792Middleware),t===M.SubjectType.Snap&&(0,Pe.isSnapPreinstalled)(e)&&s.push(this.eip7702Middleware),s.push((0,d.providerAsMiddleware)(l.provider)),s}setupProviderEngineCaip({origin:e,sender:t,subjectType:r,tabId:n}){const o=new a.JsonRpcEngine;o.push((0,We.default)({origin:e})),n&&o.push((0,ze.default)({tabId:n})),o.push((0,He.default)({origin:e})),o.push((e,t,r,n)=>[ne.MESSAGE_TYPE.WALLET_CREATE_SESSION,ne.MESSAGE_TYPE.WALLET_INVOKE_METHOD,ne.MESSAGE_TYPE.WALLET_GET_SESSION,ne.MESSAGE_TYPE.WALLET_REVOKE_SESSION].includes(e.method)?r():n(g.rpcErrors.methodNotFound({data:{method:e.method}})));const i=new A.Messenger({namespace:"SnapAndHardwareMessenger",parent:this.controllerMessenger});this.controllerMessenger.delegate({messenger:i,actions:["KeyringController:getKeyringForAccount","KeyringController:getState","SnapController:get","AccountsController:getSelectedAccount"]}),o.push((0,ot.default)({getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getHDEntropyIndex:this.getHDEntropyIndex.bind(this),getHardwareTypeForMetric:this.getHardwareTypeForMetric.bind(this),snapAndHardwareMessenger:i,appStateController:this.appStateController,metaMetricsController:this.metaMetricsController})),o.push(L.multichainMethodCallValidatorMiddleware);const s=(0,Ge.makeMethodMiddlewareMaker)([L.walletRevokeSession,L.walletGetSession,L.walletInvokeMethod,L.walletCreateSession]);o.push(s({findNetworkClientIdByChainId:this.networkController.findNetworkClientIdByChainId.bind(this.networkController),listAccounts:this.accountsController.listAccounts.bind(this.accountsController),requestPermissionsForOrigin:(t,r={})=>this.permissionController.requestPermissions({origin:e},t,r),getCaveatForOrigin:this.permissionController.getCaveat.bind(this.permissionController,e),updateCaveat:this.permissionController.updateCaveat.bind(this.permissionController,e),getSelectedNetworkClientId:()=>this.networkController.state.selectedNetworkClientId,revokePermissionForOrigin:this.permissionController.revokePermission.bind(this.permissionController,e),getNonEvmSupportedMethods:this.getNonEvmSupportedMethods.bind(this),isNonEvmScopeSupported:this.controllerMessenger.call.bind(this.controllerMessenger,"MultichainRouter:isSupportedScope"),handleNonEvmRequestForOrigin:t=>this.controllerMessenger.call("MultichainRouter:handleRequest",{...t,origin:e}),getNonEvmAccountAddresses:this.controllerMessenger.call.bind(this.controllerMessenger,"MultichainRouter:getSupportedAccounts"),trackSessionCreatedEvent:e=>this.metaMetricsController.trackEvent({event:oe.MetaMetricsEventName.PermissionsRequested,properties:{api_source:oe.MetaMetricsRequestedThrough.MultichainApi,method:ne.MESSAGE_TYPE.WALLET_CREATE_SESSION,chain_id_list:(0,K.getAllScopesFromCaip25CaveatValue)(e)}})})),o.push((0,Ge.createUnsupportedMethodMiddleware)(new Set([...X.UNSUPPORTED_RPC_METHODS,"eth_requestAccounts","eth_accounts"]))),r===M.SubjectType.Website&&o.push((0,Qe.default)({location:t.url,registerOnboarding:this.onboardingController.registerOnboarding})),o.push((0,Ge.createMultichainMethodMiddleware)({subjectType:r,...this.setupCommonMiddlewareHooks(e)})),o.push(this.metamaskMiddleware),o.push(this.eip5792Middleware);try{const t=this.permissionController.getCaveat(e,K.Caip25EndowmentPermissionName,K.Caip25CaveatType),r=(0,K.getSessionScopes)(t.value,{getNonEvmSupportedMethods:this.getNonEvmSupportedMethods.bind(this)});Object.entries(r).forEach(([t,r])=>{r.notifications.includes("eth_subscription")&&r.methods.includes("eth_subscribe")&&this.addMultichainApiEthSubscriptionMiddleware({scope:t,origin:e,tabId:n})})}catch(e){}return this.multichainSubscriptionManager.on("notification",(t,r,i)=>{e===t&&n===r&&o.emit("notification",i)}),o.push(this.multichainMiddlewareManager.generateMultichainMiddlewareForOriginAndTabId(e,n)),o.push(async(e,t,r,n)=>{const{provider:o}=this.networkController.getNetworkClientById(e.networkClientId);return t.result=await o.request(e),n()}),o}setupPublicConfig(e){const t=(0,c.storeAsStream)(this.publicConfigStore);(0,o.pipeline)(t,e,e=>{var r;t.destroy(),!e||null!==(r=e.message)&&void 0!==r&&r.match("Premature close")||y.default.error(e)})}addConnection(e,{tabId:t,apiType:r,engine:n}){if(e===ne.ORIGIN_METAMASK)return null;this.connections[e]||(this.connections[e]={});const o=(0,k.nanoid)();return this.connections[e][o]={tabId:t,apiType:r,engine:n},o}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}removeAllConnections(e){const t=this.connections[e];t&&Object.keys(t).forEach(t=>{this.removeConnection(e,t)})}notifyConnections(e,t,r){const n=this.connections[e];n&&Object.values(n).forEach(e=>{r&&e.apiType!==r||e.engine&&e.engine.emit("notification",t)})}notifyAllConnections(e,t){const r="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach(e=>{Object.values(this.connections[e]).forEach(async n=>{if(!t||n.apiType===t)try{this.notifyConnection(n,await r(e))}catch(e){console.error(e)}})})}notifyConnection(e,t){try{e.engine&&e.engine.emit("notification",t)}catch(e){console.error(e)}}_onUnlock(){this.unMarkPasswordForgotten(),this.emit("unlock")}_onLock(){this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this._notifyChainChange()}_onAccountRemoved(e){this.removeAllAccountPermissions(e)}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.state.isUnlocked}getExternalPendingTransactions(e){return this.smartTransactionsController.getTransactions({addressFrom:e,status:"pending"})}async initializeChainlist(){const e=`cachedFetch:${X.CHAIN_SPEC_URL}`,{cachedResponse:t}=await(0,ie.getStorageItem)(e)||{};t||await(0,ie.setStorageItem)(e,{cachedResponse:(0,w.rawChainData)(),cachedTime:0}),await(0,et.initializeRpcProviderDomains)()}async getPendingNonce(e,t){const{nonceDetails:r,releaseLock:n}=await this.txController.getNonceLock(e,t),o=r.params.highestSuggested;return n(),o}async getNextNonce(e,t){const r=await this.txController.getNonceLock(e,t);return r.releaseLock(),r.nextNonce}throwTestError(e){setTimeout(()=>{const t=new Error(e);throw t.name="TestError",t})}captureTestError(e){setTimeout(()=>{const t=new Error(e);t.name="TestError",(0,Y.captureException)(t)})}getTransactionMetricsRequest(){var e;const t={createEventFragment:this.controllerMessenger.call.bind(this.controllerMessenger,"MetaMetricsController:createEventFragment"),finalizeEventFragment:this.controllerMessenger.call.bind(this.controllerMessenger,"MetaMetricsController:finalizeEventFragment"),getEventFragmentById:this.controllerMessenger.call.bind(this.controllerMessenger,"MetaMetricsController:getEventFragmentById"),getParticipateInMetrics:()=>this.controllerMessenger.call("MetaMetricsController:getState").participateInMetaMetrics,trackEvent:this.controllerMessenger.call.bind(this.controllerMessenger,"MetaMetricsController:trackEvent"),updateEventFragment:this.controllerMessenger.call.bind(this.controllerMessenger,"MetaMetricsController:updateEventFragment"),getAccountBalance:(e,t)=>{var r;return null===(r=this.accountTrackerController.state.accountsByChainId)||void 0===r||null===(r=r[t])||void 0===r||null===(r=r[(0,Ie.toChecksumHexAddress)(e)])||void 0===r?void 0:r.balance},getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getHardwareTypeForMetric:this.getHardwareTypeForMetric.bind(this),getEIP1559GasFeeEstimates:(...e)=>this.gasFeeController.fetchGasFeeEstimates(...e),getSelectedAddress:()=>this.accountsController.getSelectedAccount().address,getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),getTransaction:e=>this.txController.state.transactions.find(t=>t.id===e),getIsSmartTransaction:e=>(0,pe.getIsSmartTransaction)(this._getMetaMaskState(),e),getSmartTransactionByMinedTxHash:e=>this.smartTransactionsController.getSmartTransactionByMinedTxHash(e),getMethodData:e=>{if(!e)return null;const{knownMethodData:t,use4ByteResolution:r}=this.preferencesController.state,n=(0,et.addHexPrefix)(e);return(0,et.getMethodDataName)(t,r,n,this.preferencesController.addKnownMethodData.bind(this.preferencesController),this.provider)},getIsConfirmationAdvancedDetailsOpen:()=>this.preferencesController.state.preferences.showConfirmationAdvancedDetails,getHDEntropyIndex:this.getHDEntropyIndex.bind(this),getNetworkRpcUrl:e=>{try{var t;const n=this.networkController.findNetworkClientIdByChainId(e),o=this.networkController.getNetworkConfigurationByNetworkClientId(n);if(o.rpcUrl)return o.rpcUrl;if((null===(t=o.rpcEndpoints)||void 0===t?void 0:t.length)>0){var r;const e=o.defaultRpcEndpointIndex||0;return(null===(r=o.rpcEndpoints[e])||void 0===r?void 0:r.url)||o.rpcEndpoints[0].url}return"unknown"}catch(e){return console.error("Error getting RPC URL:",e),"unknown"}}},r=new A.Messenger({namespace:"SnapAndHardwareMessenger",parent:this.controllerMessenger});return this.controllerMessenger.delegate({messenger:r,actions:["KeyringController:getKeyringForAccount","KeyringController:getState","SnapController:get","AccountsController:getSelectedAccount"]}),{...t,snapAndHardwareMessenger:r,provider:null===(e=this.controllerMessenger.call("NetworkController:getSelectedNetworkClient"))||void 0===e?void 0:e.provider}}toggleExternalServices(e){this.preferencesController.toggleExternalServices(e),this.tokenListController.updatePreventPollingOnNetworkRestart(!e),e?(this.tokenDetectionController.enable(),this.gasFeeController.enableNonRPCGasFeeApis()):(this.tokenDetectionController.disable(),this.gasFeeController.disableNonRPCGasFeeApis())}async setLedgerTransportPreference(e){const t=window.navigator.hid?Z.LedgerTransportTypes.webhid:Z.LedgerTransportTypes.u2f;return null!=e&&e.updateTransportMethod?e.updateTransportMethod(t).catch(e=>{throw e}):undefined}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t="13.11.0";e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e;const{isUnlocked:t}=this.controllerMessenger.call("KeyringController:getState");t&&this.controllerMessenger.call("SnapController:setClientActive",e),e?this.controllerMessenger.call("BackendWebSocketService:connect"):this.controllerMessenger.call("BackendWebSocketService:disconnect")}onClientClosed(){try{this.gasFeeController.stopAllPolling(),this.currencyRateController.stopAllPolling(),this.tokenRatesController.stopAllPolling(),this.tokenDetectionController.stopAllPolling(),this.tokenListController.stopAllPolling(),this.tokenBalancesController.stopAllPolling(),this.appStateController.clearPollingTokens(),this.accountTrackerController.stopAllPolling(),this.deFiPositionsController.stopAllPolling()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=ne.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.state[t].forEach(e=>{this.gasFeeController.stopPollingByPollingToken(e),this.currencyRateController.stopPollingByPollingToken(e),this.tokenRatesController.stopPollingByPollingToken(e),this.tokenDetectionController.stopPollingByPollingToken(e),this.tokenListController.stopPollingByPollingToken(e),this.tokenBalancesController.stopPollingByPollingToken(e),this.accountTrackerController.stopPollingByPollingToken(e),this.appStateController.removePollingToken(e,t)})}safelistPhishingDomain(e){return(0,et.getPlatform)()===ne.PLATFORM_FIREFOX||this.metaMetricsController.trackEvent({category:oe.MetaMetricsEventCategory.Phishing,event:oe.MetaMetricsEventName.ProceedAnywayClicked,properties:{url:e,referrer:{url:e}}},{excludeMetaMetricsId:!0}),this.phishingController.bypass(e)}async backToSafetyPhishingWarning(){this.metaMetricsController.trackEvent({category:oe.MetaMetricsEventCategory.Navigation,event:oe.MetaMetricsEventName.PortfolioLinkClicked,properties:{location:"phishing_page",text:"Back to safety"}}),await this.platform.switchToAnotherURL(undefined,"https://app.metamask.io/?metamaskEntry=phishing_page_portfolio_button")}async setLocked(e={skipSeedlessOperationLock:!1}){const{skipSeedlessOperationLock:t}=e,r=this.onboardingController.getIsSocialLoginFlow();let n;r&&!t&&(n=await this.seedlessOperationMutex.acquire());try{r&&await this.seedlessOnboardingController.setLocked(),await this.keyringController.setLocked()}catch(e){throw y.default.error("Error setting locked state",e),e}finally{n&&n()}}rejectAllPendingApprovals(){(0,ft.rejectAllApprovals)({approvalController:this.approvalController,deleteInterface:e=>this.controllerMessenger.call("SnapInterfaceController:deleteInterface",e)})}async getCode(e,t){const{provider:r}=this.networkController.getNetworkClientById(t);return await r.request({method:"eth_getCode",params:[e]})}async _onAccountChange(e){const t=(0,nt.getPermittedAccountsByOrigin)(this.permissionController.state);for(const[r,n]of t.entries())n.includes(e)&&this._notifyAccountsChange(r,n)}_notifyAccountsChange(e,t){this.notifyConnections(e,{method:nt.NOTIFICATION_NAMES.accountsChanged,params:t.length<2?t:this.getPermittedAccounts(e)},Kr),this.permissionLogController.updateAccountsHistory(e,t)}async _notifyAuthorizationChange(e,t){this.notifyConnections(e,{method:L.MultichainApiNotifications.sessionChanged,params:{sessionScopes:(0,K.getSessionScopes)(t,{getNonEvmSupportedMethods:this.getNonEvmSupportedMethods.bind(this)})}},qr)}async _notifySolanaAccountChange(e,t){this.notifyConnections(e,{method:L.MultichainApiNotifications.walletNotify,params:{scope:Ce.MultichainNetworks.SOLANA,notification:{method:nt.NOTIFICATION_NAMES.accountsChanged,params:t}}},qr)}async _notifyChainChange(){this.notifyAllConnections(async e=>({method:nt.NOTIFICATION_NAMES.chainChanged,params:await this.getProviderNetworkState({origin:e})}),Kr)}async _notifyChainChangeForConnection(e,t){this.notifyConnection(e,{method:nt.NOTIFICATION_NAMES.chainChanged,params:await this.getProviderNetworkState({origin:t})})}async _onShieldSubscriptionApprovalTransaction(e){const{isGasFeeSponsored:t,chainId:r}=e,n=await(0,jt.isSendBundleSupported)(r),o=t&&n;try{this.subscriptionService.trackSubscriptionRequestEvent("started",e,{has_sufficient_crypto_balance:!0}),await this.subscriptionController.submitShieldSubscriptionCryptoApproval(e,o);const t=[N.TransactionType.simpleSend,N.TransactionType.tokenMethodTransfer,N.TransactionType.swap,N.TransactionType.swapAndSend].includes(e.type),{pendingShieldCohort:r}=this.appStateController.state;t&&!r&&this.appStateController.setPendingShieldCohort(G.COHORT_NAMES.POST_TX,e.type),this.subscriptionService.trackSubscriptionRequestEvent("completed",e,{gas_sponsored:o})}catch(t){throw y.default.error("Error on Shield subscription approval transaction",t),this.subscriptionService.trackSubscriptionRequestEvent("failed",e,{error_message:t.message}),t}}async _onFinishedTransaction(e){if(![N.TransactionStatus.confirmed,N.TransactionStatus.failed].includes(e.status))return;const t=performance.now(),r=(0,ye.trace)({name:ye.TraceName.OnFinishedTransaction,startTime:performance.timeOrigin});(0,ye.trace)({name:ye.TraceName.OnFinishedTransaction,startTime:performance.timeOrigin,parentContext:r,data:{transactionMeta:e}}),await this._createTransactionNotifcation(e),await this._updateNFTOwnership(e),this._trackTransactionFailure(e),await this.tokenBalancesController.updateBalances({chainIds:[e.chainId]}),(0,ye.endTrace)({name:ye.TraceName.OnFinishedTransaction,timestamp:performance.timeOrigin+t})}async _createTransactionNotifcation(e){const{chainId:t}=e;let r={};if(t){var n,o;const e=null===(n=this.networkController.state.networkConfigurationsByChainId)||void 0===n?void 0:n[t];r={blockExplorerUrl:null==e||null===(o=e.blockExplorerUrls)||void 0===o?void 0:o[null==e?void 0:e.defaultBlockExplorerUrlIndex]}}try{await this.platform.showTransactionNotification(e,r)}catch(e){y.default.error("Failed to create transaction notification",e)}}async _updateNFTOwnership(e){var t,r;const{type:n,txParams:o,chainId:i,txReceipt:a}=e,s=this.accountsController.getSelectedAccount().address,{allNfts:l}=this.nftController.state,c=null==a?void 0:a.logs,d=n===N.TransactionType.contractInteraction&&c,u=(n===N.TransactionType.tokenMethodTransferFrom||n===N.TransactionType.tokenMethodSafeTransferFrom)&&o!==undefined;if(!d&&!u)return;const h=null===(t=this.networkController)||void 0===t||null===(t=t.state)||void 0===t||null===(t=t.networkConfigurationsByChainId)||void 0===t||null===(t=t[i])||void 0===t||null===(t=t.rpcEndpoints[null===(r=this.networkController)||void 0===r||null===(r=r.state)||void 0===r||null===(r=r.networkConfigurationsByChainId)||void 0===r||null===(r=r[i])||void 0===r?void 0:r.defaultRpcEndpointIndex])||void 0===t?void 0:t.networkClientId;if(u){var p;const{data:e,to:t,from:r}=o,n=(0,le.parseStandardTokenTransactionData)(e),a=(0,ae.getTokenIdParam)(n)??(0,de.getTokenValueParam)(n),s=null==l||null===(p=l[r])||void 0===p||null===(p=p[i])||void 0===p?void 0:p.find(({address:e,tokenId:r})=>(0,se.isEqualCaseInsensitive)(e,t)&&r===a);s&&this.nftController.checkAndUpdateSingleNftOwnershipStatus(s,!1,h,{userAddress:r})}else{const e=c.map(e=>{const t=e.topics&&e.topics[0]===me.TRANSFER_SINFLE_LOG_TOPIC_HASH,r=e.topics&&e.topics[0]===me.TOKEN_TRANSFER_LOG_TOPIC_HASH;let n;return t&&(n=e.topics&&e.topics[3]&&e.topics[3].match(null==s?void 0:s.slice(2))),r&&(n=e.topics&&e.topics[2]&&e.topics[2].match(null==s?void 0:s.slice(2))),{isERC1155NftTransfer:t,isERC721NftTransfer:r,isTransferToSelectedAddress:n,...e}});if(0!==e.length){const t=[];e.forEach(e=>{if(e.isTransferToSelectedAddress&&(e.isERC1155NftTransfer||e.isERC721NftTransfer)){let r;r=e.isERC1155NftTransfer?new F.Interface(O.abiERC1155):new F.Interface(O.abiERC721);try{const n=r.parseLog({data:e.data,topics:e.topics});t.push({contract:e.address,...n})}catch(e){}}});const r=[],n=[];t.forEach(e=>{var t;const o=(0,ae.getTokenIdParam)(e),a=null==l||null===(t=l[s])||void 0===t||null===(t=t[i])||void 0===t?void 0:t.find(({address:t,tokenId:r})=>(0,se.isEqualCaseInsensitive)(t,e.contract)&&r===o);a?r.push(a):n.push({tokenId:o,...e})});const o=r.map(async e=>this.nftController.checkAndUpdateSingleNftOwnershipStatus(e,!1,h,{selectedAddress:s}));await Promise.allSettled(o);const a=n.map(async e=>this.nftController.addNft(e.contract,e.tokenId,h));await Promise.allSettled(a)}}}_trackTransactionFailure(e){var t,r;const{txReceipt:n}=e,o=this.getState(),{allTokens:i}=this.tokensController.state,a=this.accountsController.getSelectedAccount(),s=(null==i||null===(t=i[e.chainId])||void 0===t?void 0:t[a.address])||[];n&&"0x0"===n.status&&this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:oe.MetaMetricsEventCategory.Background,properties:{action:"Transactions",errorMessage:null===(r=e.simulationFails)||void 0===r?void 0:r.reason,numberOfTokens:s.length,numberOfAccounts:Object.keys(o.accounts).length}},{matomoEvent:!0})}_getMetaMaskState(){return{metamask:this.getState()}}async checkDelegationDisabled(t,r,n){const{encodeDisabledDelegationsCheck:o,decodeDisabledDelegationsResult:i}=await Promise.resolve().then(()=>function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=jr(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(e("../../shared/lib/delegation/delegation"))),a=o({delegationHash:r}),s=this.networkController.getNetworkClientById(n);return i(await s.provider.request({method:"eth_call",params:[{to:t,data:a},"latest"]}))}async upgradeAccount(e,t,r){const n=this.networkController.findNetworkClientIdByChainId((0,I.toHex)(r));return(0,z.createEIP7702UpgradeTransaction)({address:e,upgradeContractAddress:t,networkClientId:n},async(e,t)=>await(0,at.addTransaction)(this.getAddTransactionRequest({transactionParams:e,transactionOptions:{...t,origin:"metamask",requireApproval:!0},waitForSubmit:!0})))}async isEip7702Supported(e){const{address:t,chainId:r}=e,n=t,o=await this.txController.isAtomicBatchSupported({address:n,chainIds:[r]}),i=(0,V.findAtomicBatchSupportForChain)(o,r),{isSupported:a,upgradeContractAddress:s}=(0,V.checkEip7702Support)(i);return{isSupported:a,upgradeContractAddress:s}}}async function Wr(e,t){var r,n,o,i,a;const s=null===(r=this.opts.overrides)||void 0===r?void 0:r.keyrings;let l=null;switch(e.name){case Z.HardwareDeviceNames.trezor:l=(null==s||null===(n=s.trezor)||void 0===n?void 0:n.type)||v.TrezorKeyring.type;break;case Z.HardwareDeviceNames.oneKey:l=(null==s||null===(o=s.oneKey)||void 0===o?void 0:o.type)||(null===v.OneKeyKeyring||void 0===v.OneKeyKeyring?void 0:v.OneKeyKeyring.type);break;case Z.HardwareDeviceNames.ledger:l=(null==s||null===(i=s.ledger)||void 0===i?void 0:i.type)||C.LedgerKeyring.type;break;case Z.HardwareDeviceNames.qr:l=S.QrKeyring.type;break;case Z.HardwareDeviceNames.lattice:l=(null==s||null===(a=s.lattice)||void 0===a?void 0:a.type)||b.default.type;break;default:throw new Error("MetamaskController:#withKeyringForDevice - Unknown device")}return this.keyringController.withKeyring({type:l},async({keyring:r})=>{if(e.hdPath&&r.setHdPath&&r.setHdPath(e.hdPath),e.name===Z.HardwareDeviceNames.lattice&&(r.appName="MetaMask"),e.name===Z.HardwareDeviceNames.ledger&&await this.setLedgerTransportPreference(r),e.name===Z.HardwareDeviceNames.trezor||e.name===Z.HardwareDeviceNames.oneKey){const e=r.getModel();this.appStateController.setTrezorModel(e)}return r.network=(0,ge.getProviderConfig)({metamask:this.networkController.state}).type,await t(r)},{createIfMissing:!0})}function Vr(){const e=$r(Hr,this,zr).call(this);return this.networkController.getNetworkClientById(e).configuration.chainId}function zr(){return this.networkController.state.selectedNetworkClientId}function Qr({existingControllers:e,initFunctions:t,initState:r}){var n;const o={currentMigrationVersion:this.opts.currentMigrationVersion,encryptor:this.opts.encryptor,extension:this.extension,platform:this.platform,getCronjobControllerStorageManager:()=>this.opts.cronjobControllerStorageManager,getFlatState:this.getState.bind(this),getPermittedAccounts:this.getPermittedAccounts.bind(this),getTransactionMetricsRequest:this.getTransactionMetricsRequest.bind(this),getUIState:this.getState.bind(this),infuraProjectId:this.opts.infuraProjectId,initLangCode:this.opts.initLangCode,keyringOverrides:null===(n=this.opts.overrides)||void 0===n?void 0:n.keyrings,offscreenPromise:this.offscreenPromise,preinstalledSnaps:this.opts.preinstalledSnaps,persistedState:r,removeAccount:this.removeAccount.bind(this),removeAllConnections:this.removeAllConnections.bind(this),setupUntrustedCommunicationEip1193:this.setupUntrustedCommunicationEip1193.bind(this),setLocked:this.setLocked.bind(this),showNotification:this.platform._showNotification,showUserConfirmation:this.opts.showUserConfirmation,getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getHardwareTypeForMetric:this.getHardwareTypeForMetric.bind(this),trace:ye.trace};return(0,kt.initControllers)({baseControllerMessenger:this.controllerMessenger,existingControllers:e,initFunctions:t,initRequest:o})}r.default=Gr}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/metamask-controller.js"}],[355,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:2,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/002.js"}],[356,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:3,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=3;try{"https://rawtestrpc.metamask.io/"===t.data.config.provider.rpcTarget&&(t.data.config.provider.rpcTarget="https://testrpc.metamask.io/")}catch(e){}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/003.js"}],[357,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:4,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=4;try{if("rpc"!==t.data.config.provider.type)return Promise.resolve(t);switch(t.data.config.provider.rpcTarget){case"https://testrpc.metamask.io/":t.data.config.provider={type:"testnet"};break;case"https://rpc.metamask.io/":t.data.config.provider={type:"mainnet"}}}catch(e){}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/004.js"}],[358,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:5,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=5;try{const e=function(e){const{config:t}=e,r={...e,KeyringController:{vault:e.vault,selectedAccount:t.selectedAccount,walletNicknames:e.walletNicknames}};return delete r.vault,delete r.walletNicknames,delete r.config.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #5${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/005.js"}],[359,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:6,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r={...e,PreferencesController:{selectedAddress:t.selectedAccount}};return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/006.js"}],[36,{"../../../../shared/constants/app":5598,"@metamask/approval-controller":1198,"@metamask/controller-utils":1383},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ApprovalControllerInit=void 0;var n=e("@metamask/approval-controller"),o=e("@metamask/controller-utils"),i=e("../../../../shared/constants/app");r.ApprovalControllerInit=({controllerMessenger:e,showUserConfirmation:t})=>({persistedStateKey:null,memStateKey:null,controller:new n.ApprovalController({messenger:e,showApprovalRequest:t,typesExcludedFromRateLimiting:[o.ApprovalType.PersonalSign,o.ApprovalType.EthSignTypedData,o.ApprovalType.Transaction,o.ApprovalType.WatchAsset,o.ApprovalType.EthGetEncryptionPublicKey,o.ApprovalType.EthDecrypt,i.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage]})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/approval-controller-init.ts"}],[360,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:7,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t={...e,TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}};return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/007.js"}],[361,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:8,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=8;try{const e=function(e){const t={...e,NoticeController:{noticesList:e.noticesList||[]}};return delete t.noticesList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #8${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/008.js"}],[3616,{"./cache":3617,"./compile":3621,"./compile/async":3618,"./compile/error_classes":3619,"./compile/formats":3620,"./compile/resolve":3622,"./compile/rules":3623,"./compile/schema_obj":3624,"./compile/util":3626,"./data":3627,"./keyword":3655,"./refs/data.json":3656,"./refs/json-schema-draft-07.json":3657,"fast-json-stable-stringify":4194},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./compile"),o=e("./compile/resolve"),i=e("./cache"),a=e("./compile/schema_obj"),s=e("fast-json-stable-stringify"),l=e("./compile/formats"),c=e("./compile/rules"),d=e("./data"),u=e("./compile/util");t.exports=y,y.prototype.validate=function(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=this._addSchema(e);r=n.validate||this._compile(n)}var o=r(t);!0!==r.$async&&(this.errors=r.errors);return o},y.prototype.compile=function(e,t){var r=this._addSchema(e,undefined,t);return r.validate||this._compile(r)},y.prototype.addSchema=function(e,t,r,n){if(Array.isArray(e)){for(var i=0;i<e.length;i++)this.addSchema(e[i],undefined,r,n);return this}var a=this._getId(e);if(a!==undefined&&"string"!=typeof a)throw new Error("schema id must be string");return k(this,t=o.normalizeId(t||a)),this._schemas[t]=this._addSchema(e,r,n,!0),this},y.prototype.addMetaSchema=function(e,t,r){return this.addSchema(e,t,r,!0),this},y.prototype.validateSchema=function(e,t){var r=e.$schema;if(r!==undefined&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||function(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema(m)?m:undefined,e._opts.defaultMeta}(this)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var n=this.validate(r,e);if(!n&&t){var o="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(o);this.logger.error(o)}return n},y.prototype.getSchema=function(e){var t=v(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var r=o.schema.call(e,{schema:{}},t);if(r){var i=r.schema,s=r.root,l=r.baseId,c=n.call(e,i,s,undefined,l);return e._fragments[t]=new a({ref:t,fragment:!0,schema:i,root:s,baseId:l,validate:c}),c}}(this,e)}},y.prototype.removeSchema=function(e){if(e instanceof RegExp)return C(this,this._schemas,e),C(this,this._refs,e),this;switch(typeof e){case"undefined":return C(this,this._schemas),C(this,this._refs),this._cache.clear(),this;case"string":var t=v(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var r=this._opts.serialize,n=r?r(e):e;this._cache.del(n);var i=this._getId(e);i&&(i=o.normalizeId(i),delete this._schemas[i],delete this._refs[i])}return this},y.prototype.addFormat=function(e,t){"string"==typeof t&&(t=new RegExp(t));return this._formats[e]=t,this},y.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var r=(t=t||{}).separator===undefined?", ":t.separator,n=t.dataVar===undefined?"data":t.dataVar,o="",i=0;i<e.length;i++){var a=e[i];a&&(o+=n+a.dataPath+" "+a.message+r)}return o.slice(0,-r.length)},y.prototype._addSchema=function(e,t,r,n){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var i=this._opts.serialize,s=i?i(e):e,l=this._cache.get(s);if(l)return l;n=n||!1!==this._opts.addUsedSchema;var c=o.normalizeId(this._getId(e));c&&n&&k(this,c);var d,u=!1!==this._opts.validateSchema&&!t;u&&!(d=c&&c==o.normalizeId(e.$schema))&&this.validateSchema(e,!0);var h=o.ids.call(this,e),p=new a({id:c,schema:e,localRefs:h,cacheKey:s,meta:r});"#"!=c[0]&&n&&(this._refs[c]=p);this._cache.put(s,p),u&&d&&this.validateSchema(e,!0);return p},y.prototype._compile=function(e,t){if(e.compiling)return e.validate=i,i.schema=e.schema,i.errors=null,i.root=t||i,!0===e.schema.$async&&(i.$async=!0),i;var r,o;e.compiling=!0,e.meta&&(r=this._opts,this._opts=this._metaOpts);try{o=n.call(this,e.schema,t,e.localRefs)}catch(t){throw delete e.validate,t}finally{e.compiling=!1,e.meta&&(this._opts=r)}return e.validate=o,e.refs=o.refs,e.refVal=o.refVal,e.root=o.root,o;function i(){var t=e.validate,r=t.apply(this,arguments);return i.errors=t.errors,r}},y.prototype.compileAsync=e("./compile/async");var h=e("./keyword");y.prototype.addKeyword=h.add,y.prototype.getKeyword=h.get,y.prototype.removeKeyword=h.remove,y.prototype.validateKeyword=h.validate;var p=e("./compile/error_classes");y.ValidationError=p.Validation,y.MissingRefError=p.MissingRef,y.$dataMetaSchema=d;var m="http://json-schema.org/draft-07/schema",g=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],f=["/properties"];function y(t){if(!(this instanceof y))return new y(t);t=this._opts=u.copy(t)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:T,warn:T,error:T};else{if(t===undefined&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=l(t.format),this._cache=t.cache||new i,this._loadingSchemas={},this._compilations=[],this.RULES=c(),this._getId=function(e){switch(e.schemaId){case"auto":return S;case"id":return b;default:return w}}(t),t.loopRequired=t.loopRequired||Infinity,"property"==t.errorDataPath&&(t._errorDataPathProperty=!0),t.serialize===undefined&&(t.serialize=s),this._metaOpts=function(e){for(var t=u.copy(e._opts),r=0;r<g.length;r++)delete t[g[r]];return t}(this),t.formats&&function(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}(this),t.keywords&&function(e){for(var t in e._opts.keywords){var r=e._opts.keywords[t];e.addKeyword(t,r)}}(this),function(t){var r;t._opts.$data&&(r=e("./refs/data.json"),t.addMetaSchema(r,r.$id,!0));if(!1===t._opts.meta)return;var n=e("./refs/json-schema-draft-07.json");t._opts.$data&&(n=d(n,f));t.addMetaSchema(n,m,!0),t._refs["http://json-schema.org/schema"]=m}(this),"object"==typeof t.meta&&this.addMetaSchema(t.meta),t.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),function(e){var t=e._opts.schemas;if(!t)return;if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}(this)}function v(e,t){return t=o.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function C(e,t,r){for(var n in t){var o=t[n];o.meta||r&&!r.test(n)||(e._cache.del(o.cacheKey),delete t[n])}}function b(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function w(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function S(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function k(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function T(){}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/ajv.js"}],[3617,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=t.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/cache.js"}],[3618,{"./error_classes":3619},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./error_classes").MissingRef;t.exports=function e(t,r,o){var i=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof r&&(o=r,r=undefined);var a=s(t).then(function(){var e=i._addSchema(t,undefined,r);return e.validate||l(e)});o&&a.then(function(e){o(null,e)},o);return a;function s(t){var r=t.$schema;return r&&!i.getSchema(r)?e.call(i,{$ref:r},!0):Promise.resolve()}function l(e){try{return i._compile(e)}catch(t){if(t instanceof n)return function(t){var n=t.missingSchema;if(c(n))throw new Error("Schema "+n+" is loaded but "+t.missingRef+" cannot be resolved");var o=i._loadingSchemas[n];o||(o=i._loadingSchemas[n]=i._opts.loadSchema(n)).then(a,a);return o.then(function(e){if(!c(n))return s(e).then(function(){c(n)||i.addSchema(e,n,undefined,r)})}).then(function(){return l(e)});function a(){delete i._loadingSchemas[n]}function c(e){return i._refs[e]||i._schemas[e]}}(t);throw t}}}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/async.js"}],[3619,{"./resolve":3622},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./resolve");function o(e,t,r){this.message=r||o.message(e,t),this.missingRef=n.url(e,t),this.missingSchema=n.normalizeId(n.fullPath(this.missingRef))}function i(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}t.exports={Validation:i(function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}),MissingRef:i(o)},o.message=function(e,t){return"can't resolve reference "+t+" from id "+e}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/error_classes.js"}],[362,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:9,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=9;try{const e=function(e){const t=(0,n.merge)({},e,{CurrencyController:{currentCurrency:e.currentFiat||e.fiatCurrency||"USD",conversionRate:e.conversionRate,conversionDate:e.conversionDate}});return delete t.currentFiat,delete t.fiatCurrency,delete t.conversionRate,delete t.conversionDate,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #9${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/009.js"}],[3620,{"./util":3626},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./util"),o=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,i=[0,31,28,31,30,31,30,31,31,30,31,30,31],a=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,s=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,l=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,c=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,d=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,u=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,h=/^(?:\/(?:[^~/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,m=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function g(e){return e="full"==e?"full":"fast",n.copy(g[e])}function f(e){var t=e.match(o);if(!t)return!1;var r=+t[1],n=+t[2],a=+t[3];return n>=1&&n<=12&&a>=1&&a<=(2==n&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(r)?29:i[n])}function y(e,t){var r=e.match(a);if(!r)return!1;var n=r[1],o=r[2],i=r[3],s=r[5];return(n<=23&&o<=59&&i<=59||23==n&&59==o&&60==i)&&(!t||s)}t.exports=g,g.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":c,url:d,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:s,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:w,uuid:u,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":m},g.full={date:f,time:y,"date-time":function(e){var t=e.split(v);return 2==t.length&&f(t[0])&&y(t[1],!0)},uri:function(e){return C.test(e)&&l.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":c,url:d,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:s,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:w,uuid:u,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":m};var v=/t|\s/i;var C=/\/|:/;var b=/[^\\]\\Z/;function w(e){if(b.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/formats.js"}],[3621,{"../dotjs/validate":3654,"./error_classes":3619,"./resolve":3622,"./util":3626,"fast-deep-equal":4187,"fast-json-stable-stringify":4194},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./resolve"),o=e("./util"),i=e("./error_classes"),a=e("fast-json-stable-stringify"),s=e("../dotjs/validate"),l=o.ucs2length,c=e("fast-deep-equal"),d=i.Validation;function u(e,t,r){var n=p.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}function h(e,t,r){var n=p.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}function p(e,t,r){for(var n=0;n<this._compilations.length;n++){var o=this._compilations[n];if(o.schema==e&&o.root==t&&o.baseId==r)return n}return-1}function m(e,t){return"var pattern"+e+" = new RegExp("+o.toQuotedString(t[e])+");"}function g(e){return"var default"+e+" = defaults["+e+"];"}function f(e,t){return t[e]===undefined?"":"var refVal"+e+" = refVal["+e+"];"}function y(e){return"var customRule"+e+" = customRules["+e+"];"}function v(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}t.exports=function e(t,r,p,C){var b=this,w=this._opts,S=[undefined],k={},T=[],A={},M=[],E={},P=[];r=r||{schema:t,refVal:S,refs:k};var I=u.call(this,t,r,C),_=this._compilations[I.index];if(I.compiling)return _.callValidate=function e(){var t=_.validate,r=t.apply(this,arguments);return e.errors=t.errors,r};var R=this._formats,N=this.RULES;try{var F=D(t,r,p,C);_.validate=F;var O=_.callValidate;return O&&(O.schema=F.schema,O.errors=null,O.refs=F.refs,O.refVal=F.refVal,O.root=F.root,O.$async=F.$async,w.sourceCode&&(O.source=F.source)),F}finally{h.call(this,t,r,C)}function D(t,a,u,h){var p=!a||a&&a.schema==t;if(a.schema!=r.schema)return e.call(b,t,a,u,h);var C,A=!0===t.$async,E=s({isTop:!0,schema:t,isRoot:p,baseId:h,root:a,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:i.MissingRef,RULES:N,validate:s,util:o,resolve:n,resolveRef:x,usePattern:L,useDefault:U,useCustomRule:$,opts:w,formats:R,logger:b.logger,self:b});E=v(S,f)+v(T,m)+v(M,g)+v(P,y)+E,w.processCode&&(E=w.processCode(E,t));try{C=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",E)(b,N,R,r,S,M,P,c,l,d),S[0]=C}catch(e){throw b.logger.error("Error compiling schema, function code:",E),e}return C.schema=t,C.errors=null,C.refs=k,C.refVal=S,C.root=p?C:a,A&&(C.$async=!0),!0===w.sourceCode&&(C.source={code:E,patterns:T,defaults:M}),C}function x(t,o,i){o=n.url(t,o);var a,s,l=k[o];if(l!==undefined)return j(a=S[l],s="refVal["+l+"]");if(!i&&r.refs){var c=r.refs[o];if(c!==undefined)return j(a=r.refVal[c],s=B(o,a))}s=B(o);var d=n.call(b,D,r,o);if(d===undefined){var u=p&&p[o];u&&(d=n.inlineRef(u,w.inlineRefs)?u:e.call(b,u,r,p,t))}if(d!==undefined)return function(e,t){var r=k[e];S[r]=t}(o,d),j(d,s);!function(e){delete k[e]}(o)}function B(e,t){var r=S.length;return S[r]=t,k[e]=r,"refVal"+r}function j(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function L(e){var t=A[e];return t===undefined&&(t=A[e]=T.length,T[t]=e),"pattern"+t}function U(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return o.toQuotedString(e);case"object":if(null===e)return"null";var t=a(e),r=E[t];return r===undefined&&(r=E[t]=M.length,M[r]=e),"default"+r}}function $(e,t,r,n){if(!1!==b._opts.validateSchema){var o=e.definition.dependencies;if(o&&!o.every(function(e){return Object.prototype.hasOwnProperty.call(r,e)}))throw new Error("parent schema must have all required keywords: "+o.join(","));var i=e.definition.validateSchema;if(i)if(!i(t)){var a="keyword schema is invalid: "+b.errorsText(i.errors);if("log"!=b._opts.validateSchema)throw new Error(a);b.logger.error(a)}}var s,l=e.definition.compile,c=e.definition.inline,d=e.definition.macro;if(l)s=l.call(b,t,r,n);else if(d)s=d.call(b,t,r,n),!1!==w.validateSchema&&b.validateSchema(s,!0);else if(c)s=c.call(b,n,e.keyword,t,r);else if(!(s=e.definition.validate))return;if(s===undefined)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var u=P.length;return P[u]=s,{code:"customRule"+u,validate:s}}}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/index.js"}],[3622,{"./schema_obj":3624,"./util":3626,"fast-deep-equal":4187,"json-schema-traverse":3658,"uri-js":5528},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("uri-js"),o=e("fast-deep-equal"),i=e("./util"),a=e("./schema_obj"),s=e("json-schema-traverse");function l(e,t,r){var n=this._refs[r];if("string"==typeof n){if(!this._refs[n])return l.call(this,e,t,n);n=this._refs[n]}if((n=n||this._schemas[r])instanceof a)return m(n.schema,this._opts.inlineRefs)?n.schema:n.validate||this._compile(n);var o,i,s,d=c.call(this,t,r);return d&&(o=d.schema,t=d.root,s=d.baseId),o instanceof a?i=o.validate||e.call(this,o.schema,t,undefined,s):o!==undefined&&(i=m(o,this._opts.inlineRefs)?o:e.call(this,o,t,undefined,s)),i}function c(e,t){var r=n.parse(t),o=v(r),i=y(this._getId(e.schema));if(0===Object.keys(e.schema).length||o!==i){var s=b(o),l=this._refs[s];if("string"==typeof l)return d.call(this,e,l,r);if(l instanceof a)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[s])instanceof a))return;if(l.validate||this._compile(l),s==b(t))return{schema:l,root:e,baseId:i};e=l}if(!e.schema)return;i=y(this._getId(e.schema))}return h.call(this,r,i,e.schema,e)}function d(e,t,r){var n=c.call(this,e,t);if(n){var o=n.schema,i=n.baseId;e=n.root;var a=this._getId(o);return a&&(i=w(i,a)),h.call(this,r,i,o,e)}}t.exports=l,l.normalizeId=b,l.fullPath=y,l.url=w,l.ids=function(e){var t=b(this._getId(e)),r={"":t},a={"":y(t,!1)},l={},c=this;return s(e,{allKeys:!0},function(e,t,s,d,u,h,p){if(""!==t){var m=c._getId(e),g=r[d],f=a[d]+"/"+u;if(p!==undefined&&(f+="/"+("number"==typeof p?p:i.escapeFragment(p))),"string"==typeof m){m=g=b(g?n.resolve(g,m):m);var y=c._refs[m];if("string"==typeof y&&(y=c._refs[y]),y&&y.schema){if(!o(e,y.schema))throw new Error('id "'+m+'" resolves to more than one schema')}else if(m!=b(f))if("#"==m[0]){if(l[m]&&!o(e,l[m]))throw new Error('id "'+m+'" resolves to more than one schema');l[m]=e}else c._refs[m]=f}r[t]=g,a[t]=f}}),l},l.inlineRef=m,l.schema=c;var u=i.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function h(e,t,r,n){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var o=e.fragment.split("/"),a=1;a<o.length;a++){var s=o[a];if(s){if((r=r[s=i.unescapeFragment(s)])===undefined)break;var l;if(!u[s]&&((l=this._getId(r))&&(t=w(t,l)),r.$ref)){var d=w(t,r.$ref),h=c.call(this,n,d);h&&(r=h.schema,n=h.root,t=h.baseId)}}}return r!==undefined&&r!==n.schema?{schema:r,root:n,baseId:t}:void 0}}var p=i.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function m(e,t){return!1!==t&&(t===undefined||!0===t?g(e):t?f(e)<=t:void 0)}function g(e){var t;if(Array.isArray(e)){for(var r=0;r<e.length;r++)if("object"==typeof(t=e[r])&&!g(t))return!1}else for(var n in e){if("$ref"==n)return!1;if("object"==typeof(t=e[n])&&!g(t))return!1}return!0}function f(e){var t,r=0;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"==typeof(t=e[n])&&(r+=f(t)),r==Infinity)return Infinity}else for(var o in e){if("$ref"==o)return Infinity;if(p[o])r++;else if("object"==typeof(t=e[o])&&(r+=f(t)+1),r==Infinity)return Infinity}return r}function y(e,t){return!1!==t&&(e=b(e)),v(n.parse(e))}function v(e){return n.serialize(e).split("#")[0]+"#"}var C=/#\/?$/;function b(e){return e?e.replace(C,""):""}function w(e,t){return t=b(t),n.resolve(e,t)}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/resolve.js"}],[3623,{"../dotjs":3643,"./util":3626},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("../dotjs"),o=e("./util").toHash;t.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=o(t),e.types=o(["number","integer","string","array","object","boolean","null"]),e.forEach(function(r){r.rules=r.rules.map(function(r){var o;if("object"==typeof r){var i=Object.keys(r)[0];o=r[i],r=i,o.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:n[r],implements:o}}),e.all.$comment={keyword:"$comment",code:n.$comment},r.type&&(e.types[r.type]=r)}),e.keywords=o(t.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/rules.js"}],[3624,{"./util":3626},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./util");t.exports=function(e){n.copy(e,this)}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/schema_obj.js"}],[3625,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e){for(var t,r=0,n=e.length,o=0;o<n;)r++,(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<n&&56320==(64512&(t=e.charCodeAt(o)))&&o++;return r}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/ucs2length.js"}],[3626,{"./ucs2length":3625,"fast-deep-equal":4187},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){function n(e,t,r,n){var o=n?" !== ":" === ",i=n?" || ":" && ",a=n?"!":"",s=n?"":"!";switch(e){case"null":return t+o+"null";case"array":return a+"Array.isArray("+t+")";case"object":return"("+a+t+i+"typeof "+t+o+'"object"'+i+s+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+o+'"number"'+i+s+"("+t+" % 1)"+i+t+o+t+(r?i+a+"isFinite("+t+")":"")+")";case"number":return"(typeof "+t+o+'"'+e+'"'+(r?i+a+"isFinite("+t+")":"")+")";default:return"typeof "+t+o+'"'+e+'"'}}t.exports={copy:function(e,t){for(var r in t=t||{},e)t[r]=e[r];return t},checkDataType:n,checkDataTypes:function(e,t,r){if(1===e.length)return n(e[0],t,r,!0);var o="",a=i(e);for(var s in a.array&&a.object&&(o=a.null?"(":"(!"+t+" || ",o+="typeof "+t+' !== "object")',delete a.null,delete a.array,delete a.object),a.number&&delete a.integer,a)o+=(o?" && ":"")+n(s,t,r,!0);return o},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var i=t[n];(o[i]||"array"===e&&"array"===i)&&(r[r.length]=i)}if(r.length)return r}else{if(o[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:i,getProperty:l,escapeQuotes:c,equal:e("fast-deep-equal"),ucs2length:e("./ucs2length"),varOccurences:function(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0},varReplace:function(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0},schemaHasRulesExcept:function(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var n in e)if(n!=r&&t[n])return!0},schemaUnknownRules:function(e,t){if("boolean"==typeof e)return;for(var r in e)if(!t[r])return r},toQuotedString:d,getPathExpr:function(e,t,r,n){return p(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,r){var n=d(r?"/"+m(t):l(t));return p(e,n)},getData:function(e,t,r){var n,o,i,a;if(""===e)return"rootData";if("/"==e[0]){if(!u.test(e))throw new Error("Invalid JSON-pointer: "+e);o=e,i="rootData"}else{if(!(a=e.match(h)))throw new Error("Invalid JSON-pointer: "+e);if(n=+a[1],"#"==(o=a[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(i="data"+(t-n||""),!o)return i}for(var s=i,c=o.split("/"),d=0;d<c.length;d++){var p=c[d];p&&(s+=" && "+(i+=l(g(p))))}return s},unescapeFragment:function(e){return g(decodeURIComponent(e))},unescapeJsonPointer:g,escapeFragment:function(e){return encodeURIComponent(m(e))},escapeJsonPointer:m};var o=i(["string","number","integer","boolean","null"]);function i(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}var a=/^[a-z$_][a-z$_0-9]*$/i,s=/'|\\/g;function l(e){return"number"==typeof e?"["+e+"]":a.test(e)?"."+e:"['"+c(e)+"']"}function c(e){return e.replace(s,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function d(e){return"'"+c(e)+"'"}var u=/^\/(?:[^~]|~0|~1)*$/,h=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function p(e,t){return'""'==e?t:(e+" + "+t).replace(/([^\\])' \+ '/g,"$1")}function m(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function g(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/compile/util.js"}],[3627,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];t.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var o,i=t[r].split("/"),a=e;for(o=1;o<i.length;o++)a=a[i[o]];for(o=0;o<n.length;o++){var s=n[o],l=a[s];l&&(a[s]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return e}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/data.js"}],[3628,{"./refs/json-schema-draft-07.json":3657},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=e("./refs/json-schema-draft-07.json");t.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:n.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:n.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/definition_schema.js"}],[3629,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(a||""),h=e.opts.$data&&s&&s.$data;h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maximum"==t,m=p?"exclusiveMaximum":"exclusiveMinimum",g=e.schema[m],f=e.opts.$data&&g&&g.$data,y=p?"<":">",v=p?">":"<",C=undefined;if(!h&&"number"!=typeof s&&s!==undefined)throw new Error(t+" must be number");if(!f&&g!==undefined&&"number"!=typeof g&&"boolean"!=typeof g)throw new Error(m+" must be number or boolean");if(f){var b=e.util.getData(g.$data,a,e.dataPathArr),w="exclusive"+i,S="exclType"+i,k="exclIsNumber"+i,T="' + "+(E="op"+i)+" + '";o+=" var schemaExcl"+i+" = "+b+"; ",o+=" var "+w+"; var "+S+" = typeof "+(b="schemaExcl"+i)+"; if ("+S+" != 'boolean' && "+S+" != 'undefined' && "+S+" != 'number') { ";var A;C=m;(A=A||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(C||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(o+=" , message: '"+m+" should be boolean' "),e.opts.verbose&&(o+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),o+=" } "):o+=" {} ";var M=o;o=A.pop(),!e.compositeRule&&d?e.async?o+=" throw new ValidationError(["+M+"]); ":o+=" validate.errors = ["+M+"]; return false; ":o+=" var err = "+M+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+=" } else if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" "+S+" == 'number' ? ( ("+w+" = "+n+" === undefined || "+b+" "+y+"= "+n+") ? "+u+" "+v+"= "+b+" : "+u+" "+v+" "+n+" ) : ( ("+w+" = "+b+" === true) ? "+u+" "+v+"= "+n+" : "+u+" "+v+" "+n+" ) || "+u+" !== "+u+") { var op"+i+" = "+w+" ? '"+y+"' : '"+y+"='; ",s===undefined&&(C=m,c=e.errSchemaPath+"/"+m,n=b,h=f)}else{T=y;if((k="number"==typeof g)&&h){var E="'"+T+"'";o+=" if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" ( "+n+" === undefined || "+g+" "+y+"= "+n+" ? "+u+" "+v+"= "+g+" : "+u+" "+v+" "+n+" ) || "+u+" !== "+u+") { "}else{k&&s===undefined?(w=!0,C=m,c=e.errSchemaPath+"/"+m,n=g,v+="="):(k&&(n=Math[p?"min":"max"](g,s)),g===(!k||n)?(w=!0,C=m,c=e.errSchemaPath+"/"+m,v+="="):(w=!1,T+="="));E="'"+T+"'";o+=" if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" "+u+" "+v+" "+n+" || "+u+" !== "+u+") { "}}C=C||t,(A=A||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(C||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { comparison: "+E+", limit: "+n+", exclusive: "+w+" } ",!1!==e.opts.messages&&(o+=" , message: 'should be "+T+" ",o+=h?"' + "+n:n+"'"),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),o+=" } "):o+=" {} ";M=o;return o=A.pop(),!e.compositeRule&&d?e.async?o+=" throw new ValidationError(["+M+"]); ":o+=" validate.errors = ["+M+"]; return false; ":o+=" var err = "+M+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+=" } ",d&&(o+=" else { "),o}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/_limit.js"}],[363,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:10,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=10;try{const e=function(e){const t=(0,n.merge)({},e,{ShapeShiftController:{shapeShiftTxList:e.shapeShiftTxList||[]}});return delete t.shapeShiftTxList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #10${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/010.js"}],[3630,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(a||""),h=e.opts.$data&&s&&s.$data;if(h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s,!h&&"number"!=typeof s)throw new Error(t+" must be number");o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" "+u+".length "+("maxItems"==t?">":"<")+" "+n+") { ";var p=t,m=m||[];m.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(p||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT have ",o+="maxItems"==t?"more":"fewer",o+=" than ",o+=h?"' + "+n+" + '":""+s,o+=" items' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),o+=" } "):o+=" {} ";var g=o;return o=m.pop(),!e.compositeRule&&d?e.async?o+=" throw new ValidationError(["+g+"]); ":o+=" validate.errors = ["+g+"]; return false; ":o+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",d&&(o+=" else { "),o}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/_limitItems.js"}],[3631,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(a||""),h=e.opts.$data&&s&&s.$data;if(h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s,!h&&"number"!=typeof s)throw new Error(t+" must be number");var p="maxLength"==t?">":"<";o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),!1===e.opts.unicode?o+=" "+u+".length ":o+=" ucs2length("+u+") ",o+=" "+p+" "+n+") { ";var m=t,g=g||[];g.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(m||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT be ",o+="maxLength"==t?"longer":"shorter",o+=" than ",o+=h?"' + "+n+" + '":""+s,o+=" characters' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),o+=" } "):o+=" {} ";var f=o;return o=g.pop(),!e.compositeRule&&d?e.async?o+=" throw new ValidationError(["+f+"]); ":o+=" validate.errors = ["+f+"]; return false; ":o+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",d&&(o+=" else { "),o}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/_limitLength.js"}],[3632,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n,o=" ",i=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(a||""),h=e.opts.$data&&s&&s.$data;if(h?(o+=" var schema"+i+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+i):n=s,!h&&"number"!=typeof s)throw new Error(t+" must be number");o+="if ( ",h&&(o+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),o+=" Object.keys("+u+").length "+("maxProperties"==t?">":"<")+" "+n+") { ";var p=t,m=m||[];m.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(p||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(o+=" , message: 'should NOT have ",o+="maxProperties"==t?"more":"fewer",o+=" than ",o+=h?"' + "+n+" + '":""+s,o+=" properties' "),e.opts.verbose&&(o+=" , schema:  ",o+=h?"validate.schema"+l:""+s,o+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),o+=" } "):o+=" {} ";var g=o;return o=m.pop(),!e.compositeRule&&d?e.async?o+=" throw new ValidationError(["+g+"]); ":o+=" validate.errors = ["+g+"]; return false; ":o+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",o+="} ",d&&(o+=" else { "),o}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/_limitProperties.js"}],[3633,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.schema[t],i=e.schemaPath+e.util.getProperty(t),a=e.errSchemaPath+"/"+t,s=!e.opts.allErrors,l=e.util.copy(e),c="";l.level++;var d="valid"+l.level,u=l.baseId,h=!0,p=o;if(p)for(var m,g=-1,f=p.length-1;g<f;)m=p[g+=1],(e.opts.strictKeywords?"object"==typeof m&&Object.keys(m).length>0||!1===m:e.util.schemaHasRules(m,e.RULES.all))&&(h=!1,l.schema=m,l.schemaPath=i+"["+g+"]",l.errSchemaPath=a+"/"+g,n+="  "+e.validate(l)+" ",l.baseId=u,s&&(n+=" if ("+d+") { ",c+="}"));return s&&(n+=h?" if (true) { ":" "+c.slice(0,-1)+" "),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/allOf.js"}],[3634,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||""),u="valid"+o,h="errs__"+o,p=e.util.copy(e),m="";p.level++;var g="valid"+p.level,f=a.every(function(t){return e.opts.strictKeywords?"object"==typeof t&&Object.keys(t).length>0||!1===t:e.util.schemaHasRules(t,e.RULES.all)});if(f){var y=p.baseId;n+=" var "+h+" = errors; var "+u+" = false;  ";var v=e.compositeRule;e.compositeRule=p.compositeRule=!0;var C=a;if(C)for(var b,w=-1,S=C.length-1;w<S;)b=C[w+=1],p.schema=b,p.schemaPath=s+"["+w+"]",p.errSchemaPath=l+"/"+w,n+="  "+e.validate(p)+" ",p.baseId=y,n+=" "+u+" = "+u+" || "+g+"; if (!"+u+") { ",m+="}";e.compositeRule=p.compositeRule=v,n+=" "+m+" if (!"+u+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&c&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } ")}else c&&(n+=" if (true) { ");return n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/anyOf.js"}],[3635,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.schema[t],i=e.errSchemaPath+"/"+t,a=(e.opts.allErrors,e.util.toQuotedString(o));return!0===e.opts.$comment?n+=" console.log("+a+");":"function"==typeof e.opts.$comment&&(n+=" self._opts.$comment("+a+", "+e.util.toQuotedString(i)+", validate.root.schema);"),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/comment.js"}],[3636,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||""),u="valid"+o,h=e.opts.$data&&a&&a.$data;h&&(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; "),h||(n+=" var schema"+o+" = validate.schema"+s+";"),n+="var "+u+" = equal("+d+", schema"+o+"); if (!"+u+") {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+o+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to constant' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ";var m=n;return n=p.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",c&&(n+=" else { "),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/const.js"}],[3637,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||""),u="valid"+o,h="errs__"+o,p=e.util.copy(e);p.level++;var m="valid"+p.level,g="i"+o,f=p.dataLevel=e.dataLevel+1,y="data"+f,v=e.baseId,C=e.opts.strictKeywords?"object"==typeof a&&Object.keys(a).length>0||!1===a:e.util.schemaHasRules(a,e.RULES.all);if(n+="var "+h+" = errors;var "+u+";",C){var b=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=a,p.schemaPath=s,p.errSchemaPath=l,n+=" var "+m+" = false; for (var "+g+" = 0; "+g+" < "+d+".length; "+g+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var w=d+"["+g+"]";p.dataPathArr[f]=g;var S=e.validate(p);p.baseId=v,e.util.varOccurences(S,y)<2?n+=" "+e.util.varReplace(S,y,w)+" ":n+=" var "+y+" = "+w+"; "+S+" ",n+=" if ("+m+") break; }  ",e.compositeRule=p.compositeRule=b,n+="  if (!"+m+") {"}else n+=" if ("+d+".length == 0) {";var k=k||[];k.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should contain a valid item' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ";var T=n;return n=k.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+T+"]); ":n+=" validate.errors = ["+T+"]; return false; ":n+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ",C&&(n+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(n+=" } "),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/contains.js"}],[3638,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n,o,i=" ",a=e.level,s=e.dataLevel,l=e.schema[t],c=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,h="data"+(s||""),p="valid"+a,m="errs__"+a,g=e.opts.$data&&l&&l.$data;g?(i+=" var schema"+a+" = "+e.util.getData(l.$data,s,e.dataPathArr)+"; ",o="schema"+a):o=l;var f,y,v,C,b,w=this,S="definition"+a,k=w.definition,T="";if(g&&k.$data){b="keywordValidate"+a;var A=k.validateSchema;i+=" var "+S+" = RULES.custom['"+t+"'].definition; var "+b+" = "+S+".validate;"}else{if(!(C=e.useCustomRule(w,l,e.schema,e)))return;o="validate.schema"+c,b=C.code,f=k.compile,y=k.inline,v=k.macro}var M=b+".errors",E="i"+a,P="ruleErr"+a,I=k.async;if(I&&!e.async)throw new Error("async keyword in sync schema");if(y||v||(i+=M+" = null;"),i+="var "+m+" = errors;var "+p+";",g&&k.$data&&(T+="}",i+=" if ("+o+" === undefined) { "+p+" = true; } else { ",A&&(T+="}",i+=" "+p+" = "+S+".validateSchema("+o+"); if ("+p+") { ")),y)k.statements?i+=" "+C.validate+" ":i+=" "+p+" = "+C.validate+"; ";else if(v){var _=e.util.copy(e);T="";_.level++;var R="valid"+_.level;_.schema=C.validate,_.schemaPath="";var N=e.compositeRule;e.compositeRule=_.compositeRule=!0;var F=e.validate(_).replace(/validate\.schema/g,b);e.compositeRule=_.compositeRule=N,i+=" "+F}else{(B=B||[]).push(i),i="",i+="  "+b+".call( ",e.opts.passContext?i+="this":i+="self",f||!1===k.schema?i+=" , "+h+" ":i+=" , "+o+" , "+h+" , validate.schema"+e.schemaPath+" ",i+=" , (dataPath || '')",'""'!=e.errorPath&&(i+=" + "+e.errorPath);var O=s?"data"+(s-1||""):"parentData",D=s?e.dataPathArr[s]:"parentDataProperty",x=i+=" , "+O+" , "+D+" , rootData )  ";i=B.pop(),!1===k.errors?(i+=" "+p+" = ",I&&(i+="await "),i+=x+"; "):i+=I?" var "+(M="customErrors"+a)+" = null; try { "+p+" = await "+x+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+M+" = e.errors; else throw e; } ":" "+M+" = null; "+p+" = "+x+"; "}if(k.modifying&&(i+=" if ("+O+") "+h+" = "+O+"["+D+"];"),i+=""+T,k.valid)u&&(i+=" if (true) { ");else{var B;i+=" if ( ",k.valid===undefined?(i+=" !",i+=v?""+R:""+p):i+=" "+!k.valid+" ",i+=") { ",n=w.keyword,(B=B||[]).push(i),i="",(B=B||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { keyword: '"+w.keyword+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should pass \""+w.keyword+"\" keyword validation' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var j=i;i=B.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+j+"]); ":i+=" validate.errors = ["+j+"]; return false; ":i+=" var err = "+j+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var L=i;i=B.pop(),y?k.errors?"full"!=k.errors&&(i+="  for (var "+E+"="+m+"; "+E+"<errors; "+E+"++) { var "+P+" = vErrors["+E+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+P+".schemaPath === undefined) { "+P+'.schemaPath = "'+d+'"; } ',e.opts.verbose&&(i+=" "+P+".schema = "+o+"; "+P+".data = "+h+"; "),i+=" } "):!1===k.errors?i+=" "+L+" ":(i+=" if ("+m+" == errors) { "+L+" } else {  for (var "+E+"="+m+"; "+E+"<errors; "+E+"++) { var "+P+" = vErrors["+E+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+P+".schemaPath === undefined) { "+P+'.schemaPath = "'+d+'"; } ',e.opts.verbose&&(i+=" "+P+".schema = "+o+"; "+P+".data = "+h+"; "),i+=" } } "):v?(i+="   var err =   ",!1!==e.createErrors?(i+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { keyword: '"+w.keyword+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should pass \""+w.keyword+"\" keyword validation' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; ")):!1===k.errors?i+=" "+L+" ":(i+=" if (Array.isArray("+M+")) { if (vErrors === null) vErrors = "+M+"; else vErrors = vErrors.concat("+M+"); errors = vErrors.length;  for (var "+E+"="+m+"; "+E+"<errors; "+E+"++) { var "+P+" = vErrors["+E+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+";  "+P+'.schemaPath = "'+d+'";  ',e.opts.verbose&&(i+=" "+P+".schema = "+o+"; "+P+".data = "+h+"; "),i+=" } } else { "+L+" } "),i+=" } ",u&&(i+=" else { ")}return i}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/custom.js"}],[3639,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||""),u="errs__"+o,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,g={},f={},y=e.opts.ownProperties;for(w in a)if("__proto__"!=w){var v=a[w],C=Array.isArray(v)?f:g;C[w]=v}n+="var "+u+" = errors;";var b=e.errorPath;for(var w in n+="var missing"+o+";",f)if((C=f[w]).length){if(n+=" if ( "+d+e.util.getProperty(w)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(w)+"') "),c){n+=" && ( ";var S=C;if(S)for(var k=-1,T=S.length-1;k<T;){_=S[k+=1],k&&(n+=" || "),n+=" ( ( "+(O=d+(F=e.util.getProperty(_)))+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(_)+"') "),n+=") && (missing"+o+" = "+e.util.toQuotedString(e.opts.jsonPointers?_:F)+") ) "}n+=")) {  ";var A="missing"+o,M="' + "+A+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(b,A,!0):b+" + "+A);var E=E||[];E.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(w)+"', missingProperty: '"+M+"', depsCount: "+C.length+", deps: '"+e.util.escapeQuotes(1==C.length?C[0]:C.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",1==C.length?n+="property "+e.util.escapeQuotes(C[0]):n+="properties "+e.util.escapeQuotes(C.join(", ")),n+=" when property "+e.util.escapeQuotes(w)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ";var P=n;n=E.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+P+"]); ":n+=" validate.errors = ["+P+"]; return false; ":n+=" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{n+=" ) { ";var I=C;if(I)for(var _,R=-1,N=I.length-1;R<N;){_=I[R+=1];var F=e.util.getProperty(_),O=(M=e.util.escapeQuotes(_),d+F);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(b,_,e.opts.jsonPointers)),n+=" if ( "+O+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(_)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(w)+"', missingProperty: '"+M+"', depsCount: "+C.length+", deps: '"+e.util.escapeQuotes(1==C.length?C[0]:C.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",1==C.length?n+="property "+e.util.escapeQuotes(C[0]):n+="properties "+e.util.escapeQuotes(C.join(", ")),n+=" when property "+e.util.escapeQuotes(w)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}n+=" }   ",c&&(p+="}",n+=" else { ")}e.errorPath=b;var D=h.baseId;for(var w in g){v=g[w];(e.opts.strictKeywords?"object"==typeof v&&Object.keys(v).length>0||!1===v:e.util.schemaHasRules(v,e.RULES.all))&&(n+=" "+m+" = true; if ( "+d+e.util.getProperty(w)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(w)+"') "),n+=") { ",h.schema=v,h.schemaPath=s+e.util.getProperty(w),h.errSchemaPath=l+"/"+e.util.escapeFragment(w),n+="  "+e.validate(h)+" ",h.baseId=D,n+=" }  ",c&&(n+=" if ("+m+") { ",p+="}"))}return c&&(n+="   "+p+" if ("+u+" == errors) {"),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/dependencies.js"}],[364,{lodash:4635},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:11,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=11;try{const e=function(e){const t=e;return delete t.TOSHash,delete t.isDisclaimerConfirmed,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #11${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/011.js"}],[3640,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||""),u="valid"+o,h=e.opts.$data&&a&&a.$data;h&&(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; ");var p="i"+o,m="schema"+o;h||(n+=" var "+m+" = validate.schema"+s+";"),n+="var "+u+";",h&&(n+=" if (schema"+o+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+o+")) "+u+" = false; else {"),n+=u+" = false;for (var "+p+"=0; "+p+"<"+m+".length; "+p+"++) if (equal("+d+", "+m+"["+p+"])) { "+u+" = true; break; }",h&&(n+="  }  "),n+=" if (!"+u+") {   ";var g=g||[];g.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+o+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ";var f=n;return n=g.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+f+"]); ":n+=" validate.errors = ["+f+"]; return false; ":n+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",c&&(n+=" else { "),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/enum.js"}],[3641,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||"");if(!1===e.opts.format)return c&&(n+=" if (true) { "),n;var u,h=e.opts.$data&&a&&a.$data;h?(n+=" var schema"+o+" = "+e.util.getData(a.$data,i,e.dataPathArr)+"; ",u="schema"+o):u=a;var p=e.opts.unknownFormats,m=Array.isArray(p);if(h){n+=" var "+(g="format"+o)+" = formats["+u+"]; var "+(f="isObject"+o)+" = typeof "+g+" == 'object' && !("+g+" instanceof RegExp) && "+g+".validate; var "+(y="formatType"+o)+" = "+f+" && "+g+".type || 'string'; if ("+f+") { ",e.async&&(n+=" var async"+o+" = "+g+".async; "),n+=" "+g+" = "+g+".validate; } if (  ",h&&(n+=" ("+u+" !== undefined && typeof "+u+" != 'string') || "),n+=" (","ignore"!=p&&(n+=" ("+u+" && !"+g+" ",m&&(n+=" && self._opts.unknownFormats.indexOf("+u+") == -1 "),n+=") || "),n+=" ("+g+" && "+y+" == '"+r+"' && !(typeof "+g+" == 'function' ? ",e.async?n+=" (async"+o+" ? await "+g+"("+d+") : "+g+"("+d+")) ":n+=" "+g+"("+d+") ",n+=" : "+g+".test("+d+"))))) {"}else{var g;if(!(g=e.formats[a])){if("ignore"==p)return e.logger.warn('unknown format "'+a+'" ignored in schema at path "'+e.errSchemaPath+'"'),c&&(n+=" if (true) { "),n;if(m&&p.indexOf(a)>=0)return c&&(n+=" if (true) { "),n;throw new Error('unknown format "'+a+'" is used in schema at path "'+e.errSchemaPath+'"')}var f,y=(f="object"==typeof g&&!(g instanceof RegExp)&&g.validate)&&g.type||"string";if(f){var v=!0===g.async;g=g.validate}if(y!=r)return c&&(n+=" if (true) { "),n;if(v){if(!e.async)throw new Error("async format in sync schema");n+=" if (!(await "+(C="formats"+e.util.getProperty(a)+".validate")+"("+d+"))) { "}else{n+=" if (! ";var C="formats"+e.util.getProperty(a);f&&(C+=".validate"),n+="function"==typeof g?" "+C+"("+d+") ":" "+C+".test("+d+") ",n+=") { "}}var b=b||[];b.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",n+=h?""+u:""+e.util.toQuotedString(a),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match format \"",n+=h?"' + "+u+" + '":""+e.util.escapeQuotes(a),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=h?"validate.schema"+s:""+e.util.toQuotedString(a),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ";var w=n;return n=b.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+w+"]); ":n+=" validate.errors = ["+w+"]; return false; ":n+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",c&&(n+=" else { "),n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/format.js"}],[3642,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=" ",o=e.level,i=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(i||""),u="valid"+o,h="errs__"+o,p=e.util.copy(e);p.level++;var m="valid"+p.level,g=e.schema.then,f=e.schema.else,y=g!==undefined&&(e.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0||!1===g:e.util.schemaHasRules(g,e.RULES.all)),v=f!==undefined&&(e.opts.strictKeywords?"object"==typeof f&&Object.keys(f).length>0||!1===f:e.util.schemaHasRules(f,e.RULES.all)),C=p.baseId;if(y||v){var b;p.createErrors=!1,p.schema=a,p.schemaPath=s,p.errSchemaPath=l,n+=" var "+h+" = errors; var "+u+" = true;  ";var w=e.compositeRule;e.compositeRule=p.compositeRule=!0,n+="  "+e.validate(p)+" ",p.baseId=C,p.createErrors=!0,n+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=p.compositeRule=w,y?(n+=" if ("+m+") {  ",p.schema=e.schema.then,p.schemaPath=e.schemaPath+".then",p.errSchemaPath=e.errSchemaPath+"/then",n+="  "+e.validate(p)+" ",p.baseId=C,n+=" "+u+" = "+m+"; ",y&&v?n+=" var "+(b="ifClause"+o)+" = 'then'; ":b="'then'",n+=" } ",v&&(n+=" else { ")):n+=" if (!"+m+") { ",v&&(p.schema=e.schema.else,p.schemaPath=e.schemaPath+".else",p.errSchemaPath=e.errSchemaPath+"/else",n+="  "+e.validate(p)+" ",p.baseId=C,n+=" "+u+" = "+m+"; ",y&&v?n+=" var "+(b="ifClause"+o)+" = 'else'; ":b="'else'",n+=" } "),n+=" if (!"+u+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+b+" } ",!1!==e.opts.messages&&(n+=" , message: 'should match \"' + "+b+" + '\" schema' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&c&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+=" }   ",c&&(n+=" else { ")}else c&&(n+=" if (true) { ");return n}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/if.js"}],[3643,{"./_limit":3629,"./_limitItems":3630,"./_limitLength":3631,"./_limitProperties":3632,"./allOf":3633,"./anyOf":3634,"./comment":3635,"./const":3636,"./contains":3637,"./dependencies":3639,"./enum":3640,"./format":3641,"./if":3642,"./items":3644,"./multipleOf":3645,"./not":3646,"./oneOf":3647,"./pattern":3648,"./properties":3649,"./propertyNames":3650,"./ref":3651,"./required":3652,"./uniqueItems":3653,"./validate":3654},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports={$ref:e("./ref"),allOf:e("./allOf"),anyOf:e("./anyOf"),$comment:e("./comment"),const:e("./const"),contains:e("./contains"),dependencies:e("./dependencies"),enum:e("./enum"),format:e("./format"),if:e("./if"),items:e("./items"),maximum:e("./_limit"),minimum:e("./_limit"),maxItems:e("./_limitItems"),minItems:e("./_limitItems"),maxLength:e("./_limitLength"),minLength:e("./_limitLength"),maxProperties:e("./_limitProperties"),minProperties:e("./_limitProperties"),multipleOf:e("./multipleOf"),not:e("./not"),oneOf:e("./oneOf"),pattern:e("./pattern"),properties:e("./properties"),propertyNames:e("./propertyNames"),required:e("./required"),uniqueItems:e("./uniqueItems"),validate:e("./validate")}}}},{package:"eslint>ajv",file:"node_modules/ajv/lib/dotjs/index.js"}]],[],{});