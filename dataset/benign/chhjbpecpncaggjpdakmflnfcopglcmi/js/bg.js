/*! For license information please see bg.js.LICENSE.txt */
var source;try{(()=>{var e,t,n={7059:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,i="millisecond",r="second",s="minute",a="hour",o="day",c="week",u="month",l="quarter",h="year",d="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},y={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+v(i,2,"0")+":"+v(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,u),s=n-r<0,a=t.clone().add(i+(s?-1:1),u);return+(-(i+(n-r)/(s?r-a:a-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:h,w:c,d:o,D:d,h:a,m:s,s:r,ms:i,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",w={};w[b]=m;var E="$isDayjsObject",A=function(e){return e instanceof _||!(!e||!e[E])},x=function e(t,n,i){var r;if(!t)return b;if("string"==typeof t){var s=t.toLowerCase();w[s]&&(r=s),n&&(w[s]=n,r=s);var a=t.split("-");if(!r&&a.length>1)return e(a[0])}else{var o=t.name;w[o]=t,r=o}return!i&&r&&(b=r),r||!i&&b},T=function(e,t){if(A(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new _(n)},S=y;S.l=x,S.i=A,S.w=function(e,t){return T(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var _=function(){function m(e){this.$L=x(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[E]=!0}var v=m.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(p);if(i){var r=i[2]-1||0,s=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,s)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,s)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return S},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(e,t){var n=T(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return T(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<T(e)},v.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,i=!!S.u(t)||t,l=S.p(e),f=function(e,t){var r=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return i?r:r.endOf(o)},p=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,m=this.$M,v=this.$D,y="set"+(this.$u?"UTC":"");switch(l){case h:return i?f(1,0):f(31,11);case u:return i?f(1,m):f(0,m+1);case c:var b=this.$locale().weekStart||0,w=(g<b?g+7:g)-b;return f(i?v-w:v+(6-w),m);case o:case d:return p(y+"Hours",0);case a:return p(y+"Minutes",1);case s:return p(y+"Seconds",2);case r:return p(y+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=S.p(e),l="set"+(this.$u?"UTC":""),f=(n={},n[o]=l+"Date",n[d]=l+"Date",n[u]=l+"Month",n[h]=l+"FullYear",n[a]=l+"Hours",n[s]=l+"Minutes",n[r]=l+"Seconds",n[i]=l+"Milliseconds",n)[c],p=c===o?this.$D+(t-this.$W):t;if(c===u||c===h){var g=this.clone().set(d,1);g.$d[f](p),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[S.p(e)]()},v.add=function(i,l){var d,f=this;i=Number(i);var p=S.p(l),g=function(e){var t=T(f);return S.w(t.date(t.date()+Math.round(e*i)),f)};if(p===u)return this.set(u,this.$M+i);if(p===h)return this.set(h,this.$y+i);if(p===o)return g(1);if(p===c)return g(7);var m=(d={},d[s]=t,d[a]=n,d[r]=e,d)[p]||1,v=this.$d.getTime()+i*m;return S.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=S.z(this),s=this.$H,a=this.$m,o=this.$M,c=n.weekdays,u=n.months,l=n.meridiem,h=function(e,n,r,s){return e&&(e[n]||e(t,i))||r[n].slice(0,s)},d=function(e){return S.s(s%12||12,e,"0")},p=l||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i};return i.replace(g,(function(e,i){return i||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return S.s(t.$y,4,"0");case"M":return o+1;case"MM":return S.s(o+1,2,"0");case"MMM":return h(n.monthsShort,o,u,3);case"MMMM":return h(u,o);case"D":return t.$D;case"DD":return S.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return h(n.weekdaysMin,t.$W,c,2);case"ddd":return h(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(s);case"HH":return S.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return p(s,a,!0);case"A":return p(s,a,!1);case"m":return String(a);case"mm":return S.s(a,2,"0");case"s":return String(t.$s);case"ss":return S.s(t.$s,2,"0");case"SSS":return S.s(t.$ms,3,"0");case"Z":return r}return null}(e)||r.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(i,d,f){var p,g=this,m=S.p(d),v=T(i),y=(v.utcOffset()-this.utcOffset())*t,b=this-v,w=function(){return S.m(g,v)};switch(m){case h:p=w()/12;break;case u:p=w();break;case l:p=w()/3;break;case c:p=(b-y)/6048e5;break;case o:p=(b-y)/864e5;break;case a:p=b/n;break;case s:p=b/t;break;case r:p=b/e;break;default:p=b}return f?p:S.a(p)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return w[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=x(e,t,!0);return i&&(n.$L=i),n},v.clone=function(){return S.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},m}(),k=_.prototype;return T.prototype=k,[["$ms",i],["$s",r],["$m",s],["$H",a],["$W",o],["$M",u],["$y",h],["$D",d]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),T.extend=function(e,t){return e.$i||(e(t,_,T),e.$i=!0),T},T.locale=x,T.isDayjs=A,T.unix=function(e){return T(1e3*e)},T.en=w[b],T.Ls=w,T.p={},T}()},9964:e=>{var t,n,i=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var o,c=[],u=!1,l=-1;function h(){u&&o&&(u=!1,o.length?c=o.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=a(h);u=!0;for(var t=c.length;t;){for(o=c,c=[];++l<t;)o&&o[l].run();l=-1,t=c.length}o=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},21812:(e,t,n)=>{"use strict";t.J=void 0;var i=n(22073);function r(e){try{return decodeURIComponent(e)}catch(t){return e}}t.J=function(e){if(!e)return i.BLANK_URL;var t,n,s=r(e.trim());do{t=(s=r(s=(n=s,n.replace(i.ctrlCharactersRegex,"").replace(i.htmlEntitiesRegex,(function(e,t){return String.fromCharCode(t)}))).replace(i.htmlCtrlEntityRegex,"").replace(i.ctrlCharactersRegex,"").replace(i.whitespaceEscapeCharsRegex,"").trim())).match(i.ctrlCharactersRegex)||s.match(i.htmlEntitiesRegex)||s.match(i.htmlCtrlEntityRegex)||s.match(i.whitespaceEscapeCharsRegex)}while(t&&t.length>0);var a=s;if(!a)return i.BLANK_URL;if(function(e){return i.relativeFirstCharacters.indexOf(e[0])>-1}(a))return a;var o=a.trimStart(),c=o.match(i.urlSchemeRegex);if(!c)return a;var u=c[0].toLowerCase().trim();if(i.invalidProtocolRegex.test(u))return i.BLANK_URL;var l=o.replace(/\\/g,"/");if("mailto:"===u||u.includes("://"))return l;if("http:"===u||"https:"===u){if(!function(e){return URL.canParse(e)}(l))return i.BLANK_URL;var h=new URL(l);return h.protocol=h.protocol.toLowerCase(),h.hostname=h.hostname.toLowerCase(),h.toString()}return l}},22073:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BLANK_URL=t.relativeFirstCharacters=t.whitespaceEscapeCharsRegex=t.urlSchemeRegex=t.ctrlCharactersRegex=t.htmlCtrlEntityRegex=t.htmlEntitiesRegex=t.invalidProtocolRegex=void 0,t.invalidProtocolRegex=/^([^\w]*)(javascript|data|vbscript)/im,t.htmlEntitiesRegex=/&#(\w+)(^\w|;)?/g,t.htmlCtrlEntityRegex=/&(newline|tab);/gi,t.ctrlCharactersRegex=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,t.urlSchemeRegex=/^.+(:|&colon;)/gim,t.whitespaceEscapeCharsRegex=/(\\|%5[cC])((%(6[eE]|72|74))|[nrt])/g,t.relativeFirstCharacters=[".","/"],t.BLANK_URL="about:blank"},30457:function(e,t){var n,i,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[e],n=function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",n=e=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(n).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class i extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const r=e=>e&&"object"==typeof e&&"function"==typeof e.then,s=(t,n)=>(...i)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||i.length<=1&&!1!==n.singleCallbackArg?t.resolve(i[0]):t.resolve(i)},a=e=>1==e?"argument":"arguments",o=(e,t)=>function(n,...i){if(i.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${a(t.minArgs)} for ${e}(), got ${i.length}`);if(i.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${a(t.maxArgs)} for ${e}(), got ${i.length}`);return new Promise(((r,a)=>{if(t.fallbackToNoCallback)try{n[e](...i,s({resolve:r,reject:a},t))}catch(s){n[e](...i),t.fallbackToNoCallback=!1,t.noCallback=!0,r()}else t.noCallback?(n[e](...i),r()):n[e](...i,s({resolve:r,reject:a},t))}))},c=(e,t,n)=>new Proxy(t,{apply:(t,i,r)=>n.call(i,e,...r)});let u=Function.call.bind(Object.prototype.hasOwnProperty);const l=(e,t={},n={})=>{let i=Object.create(null),r={has:(t,n)=>n in e||n in i,get(r,s,a){if(s in i)return i[s];if(!(s in e))return;let h=e[s];if("function"==typeof h)if("function"==typeof t[s])h=c(e,e[s],t[s]);else if(u(n,s)){let t=o(s,n[s]);h=c(e,e[s],t)}else h=h.bind(e);else if("object"==typeof h&&null!==h&&(u(t,s)||u(n,s)))h=l(h,t[s],n[s]);else{if(!u(n,"*"))return Object.defineProperty(i,s,{configurable:!0,enumerable:!0,get:()=>e[s],set(t){e[s]=t}}),h;h=l(h,t[s],n["*"])}return i[s]=h,h},set:(t,n,r,s)=>(n in i?i[n]=r:e[n]=r,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(i,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(i,t)},s=Object.create(e);return new Proxy(s,r)},h=e=>({addListener(t,n,...i){t.addListener(e.get(n),...i)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),d=new i((e=>"function"!=typeof e?e:function(t){const n=l(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)})),f=new i((e=>"function"!=typeof e?e:function(t,n,i){let s,a,o=!1,c=new Promise((e=>{s=function(t){o=!0,e(t)}}));try{a=e(t,n,s)}catch(e){a=Promise.reject(e)}const u=!0!==a&&r(a);if(!0!==a&&!u&&!o)return!1;const l=e=>{e.then((e=>{i(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",i({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{}))};return l(u?a:c),!0})),p=({reject:n,resolve:i},r)=>{e.runtime.lastError?e.runtime.lastError.message===t?i():n(new Error(e.runtime.lastError.message)):r&&r.__mozWebExtensionPolyfillReject__?n(new Error(r.message)):i(r)},g=(e,t,n,...i)=>{if(i.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${a(t.minArgs)} for ${e}(), got ${i.length}`);if(i.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${a(t.maxArgs)} for ${e}(), got ${i.length}`);return new Promise(((e,t)=>{const r=p.bind(null,{resolve:e,reject:t});i.push(r),n.sendMessage(...i)}))},m={devtools:{network:{onRequestFinished:h(d)}},runtime:{onMessage:h(f),onMessageExternal:h(f),sendMessage:g.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:g.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},v={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":v},services:{"*":v},websites:{"*":v}},l(e,m,n)};e.exports=n(chrome)}},void 0===(r="function"==typeof n?n.apply(t,i):n)||(e.exports=r)},31761:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=t},36337:(e,t,n)=>{var i,r,s;s="object"==typeof self&&self.self===self&&self||"object"==typeof n.g&&n.g.global===n.g&&n.g,i=[n(45091),n(79602),t],r=function(e,t,n){s.Backbone=function(e,t,n,i){var r=e.Backbone,s=Array.prototype.slice;t.VERSION="1.6.1",t.$=i,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a,o=t.Events={},c=/\s+/,u=function(e,t,i,r,s){var a,o=0;if(i&&"object"==typeof i){void 0!==r&&"context"in s&&void 0===s.context&&(s.context=r);for(a=n.keys(i);o<a.length;o++)t=u(e,t,a[o],i[a[o]],s)}else if(i&&c.test(i))for(a=i.split(c);o<a.length;o++)t=e(t,a[o],r,s);else t=e(t,i,r,s);return t};o.on=function(e,t,n){return this._events=u(l,this._events||{},e,t,{context:n,ctx:this,listening:a}),a&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1),this},o.listenTo=function(e,t,i){if(!e)return this;var r=e._listenId||(e._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=a=s[r];o||(this._listenId||(this._listenId=n.uniqueId("l")),o=a=s[r]=new m(this,e));var c=h(e,t,i,this);if(a=void 0,c)throw c;return o.interop&&o.on(t,i),this};var l=function(e,t,n,i){if(n){var r=e[t]||(e[t]=[]),s=i.context,a=i.ctx,o=i.listening;o&&o.count++,r.push({callback:n,context:s,ctx:s||a,listening:o})}return e},h=function(e,t,n,i){try{e.on(t,n,i)}catch(e){return e}};o.off=function(e,t,n){return this._events?(this._events=u(d,this._events,e,t,{context:n,listeners:this._listeners}),this):this},o.stopListening=function(e,t,i){var r=this._listeningTo;if(!r)return this;for(var s=e?[e._listenId]:n.keys(r),a=0;a<s.length;a++){var o=r[s[a]];if(!o)break;o.obj.off(t,i,this),o.interop&&o.off(t,i)}return n.isEmpty(r)&&(this._listeningTo=void 0),this};var d=function(e,t,i,r){if(e){var s,a=r.context,o=r.listeners,c=0;if(t||a||i){for(s=t?[t]:n.keys(e);c<s.length;c++){var u=e[t=s[c]];if(!u)break;for(var l=[],h=0;h<u.length;h++){var d=u[h];if(i&&i!==d.callback&&i!==d.callback._callback||a&&a!==d.context)l.push(d);else{var f=d.listening;f&&f.off(t,i)}}l.length?e[t]=l:delete e[t]}return e}for(s=n.keys(o);c<s.length;c++)o[s[c]].cleanup()}};o.once=function(e,t,n){var i=u(f,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(i,t,n)},o.listenToOnce=function(e,t,n){var i=u(f,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,i)};var f=function(e,t,i,r){if(i){var s=e[t]=n.once((function(){r(t,s),i.apply(this,arguments)}));s._callback=i}return e};o.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),n=Array(t),i=0;i<t;i++)n[i]=arguments[i+1];return u(p,this._events,e,void 0,n),this};var p=function(e,t,n,i){if(e){var r=e[t],s=e.all;r&&s&&(s=s.slice()),r&&g(r,i),s&&g(s,[t].concat(i))}return e},g=function(e,t){var n,i=-1,r=e.length,s=t[0],a=t[1],o=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s,a);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s,a,o);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t);return}},m=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};m.prototype.on=o.on,m.prototype.off=function(e,t){var n;this.interop?(this._events=u(d,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},m.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},o.bind=o.on,o.unbind=o.off,n.extend(t,o);var v=t.Model=function(e,t){var i=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{});var r=n.result(this,"defaults");i=n.defaults(n.extend({},r,i),r),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(v.prototype,o,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,i){if(null==e)return this;var r;if("object"==typeof e?(r=e,i=t):(r={})[e]=t,i||(i={}),!this._validate(r,i))return!1;var s=i.unset,a=i.silent,o=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={});var u=this.attributes,l=this.changed,h=this._previousAttributes;for(var d in r)t=r[d],n.isEqual(u[d],t)||o.push(d),n.isEqual(h[d],t)?delete l[d]:l[d]=t,s?delete u[d]:u[d]=t;if(this.idAttribute in r){var f=this.id;this.id=this.get(this.idAttribute),this.id!==f&&this.trigger("changeId",this,f,i)}if(!a){o.length&&(this._pending=i);for(var p=0;p<o.length;p++)this.trigger("change:"+o[p],this,u[o[p]],i)}if(c)return this;if(!a)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n.clone(this.changed);var t,i=this._changing?this._previousAttributes:this.attributes,r={};for(var s in e){var a=e[s];n.isEqual(i[s],a)||(r[s]=a,t=!0)}return!!t&&r},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=n.extend({parse:!0},e);var t=this,i=e.success;return e.success=function(n){var r=e.parse?t.parse(n,e):n;if(!t.set(r,e))return!1;i&&i.call(e.context,t,n,e),t.trigger("sync",t,n,e)},K(this,e),this.sync("read",this,e)},save:function(e,t,i){var r;null==e||"object"==typeof e?(r=e,i=t):(r={})[e]=t;var s=(i=n.extend({validate:!0,parse:!0},i)).wait;if(r&&!s){if(!this.set(r,i))return!1}else if(!this._validate(r,i))return!1;var a=this,o=i.success,c=this.attributes;i.success=function(e){a.attributes=c;var t=i.parse?a.parse(e,i):e;if(s&&(t=n.extend({},r,t)),t&&!a.set(t,i))return!1;o&&o.call(i.context,a,e,i),a.trigger("sync",a,e,i)},K(this,i),r&&s&&(this.attributes=n.extend({},c,r));var u=this.isNew()?"create":i.patch?"patch":"update";"patch"!==u||i.attrs||(i.attrs=r);var l=this.sync(u,this,i);return this.attributes=c,l},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,r=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){r&&s(),i&&i.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var a=!1;return this.isNew()?n.defer(e.success):(K(this,e),a=this.sync("delete",this,e)),r||s(),a},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||z();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1)}});var y=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},b={add:!0,remove:!0,merge:!0},w={add:!0,remove:!1},E=function(e,t,n){n=Math.min(Math.max(n,0),e.length);var i,r=Array(e.length-n),s=t.length;for(i=0;i<r.length;i++)r[i]=e[i+n];for(i=0;i<s;i++)e[i+n]=t[i];for(i=0;i<r.length;i++)e[i+s+n]=r[i]};n.extend(y.prototype,o,{model:v,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,w))},remove:function(e,t){t=n.extend({},t);var i=!n.isArray(e);e=i?[e]:e.slice();var r=this._removeModels(e,t);return!t.silent&&r.length&&(t.changes={added:[],merged:[],removed:r},this.trigger("update",this,t)),i?r[0]:r},set:function(e,t){if(null!=e){(t=n.extend({},b,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var i=!n.isArray(e);e=i?[e]:e.slice();var r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var s,a,o=[],c=[],u=[],l=[],h={},d=t.add,f=t.merge,p=t.remove,g=!1,m=this.comparator&&null==r&&!1!==t.sort,v=n.isString(this.comparator)?this.comparator:null;for(a=0;a<e.length;a++){s=e[a];var y=this.get(s);if(y){if(f&&s!==y){var w=this._isModel(s)?s.attributes:s;t.parse&&(w=y.parse(w,t)),y.set(w,t),u.push(y),m&&!g&&(g=y.hasChanged(v))}h[y.cid]||(h[y.cid]=!0,o.push(y)),e[a]=y}else d&&(s=e[a]=this._prepareModel(s,t))&&(c.push(s),this._addReference(s,t),h[s.cid]=!0,o.push(s))}if(p){for(a=0;a<this.length;a++)h[(s=this.models[a]).cid]||l.push(s);l.length&&this._removeModels(l,t)}var A=!1,x=!m&&d&&p;if(o.length&&x?(A=this.length!==o.length||n.some(this.models,(function(e,t){return e!==o[t]})),this.models.length=0,E(this.models,o,0),this.length=this.models.length):c.length&&(m&&(g=!0),E(this.models,c,null==r?this.length:r),this.length=this.models.length),g&&this.sort({silent:!0}),!t.silent){for(a=0;a<c.length;a++)null!=r&&(t.index=r+a),(s=c[a]).trigger("add",s,this,t);(g||A)&&this.trigger("sort",this,t),(c.length||l.length||u.length)&&(t.changes={added:c,removed:l,merged:u},this.trigger("update",this,t))}return i?e[0]:e}},reset:function(e,t){t=t?n.clone(t):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var i=t.length;return n.isFunction(t)&&(t=t.bind(this)),1===i||n.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=n.extend({parse:!0},e)).success,i=this;return e.success=function(n){var r=e.reset?"reset":"set";i[r](n,e),t&&t.call(e.context,i,n,e),i.trigger("sync",i,n,e)},K(this,e),this.sync("read",this,e)},create:function(e,t){var i=(t=t?n.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;i||this.add(e,t);var r=this,s=t.success;return t.success=function(e,t,n){i&&(e.off("error",r._forwardPristineError,r),r.add(e,n)),s&&s.call(n.context,e,t,n)},i&&e.once("error",this._forwardPristineError,this),e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new x(this,T)},keys:function(){return new x(this,S)},entries:function(){return new x(this,_)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?n.clone(t):{}).collection=this,(i=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,i.validationError,t),!1):i);var i},_removeModels:function(e,t){for(var n=[],i=0;i<e.length;i++){var r=this.get(e[i]);if(r){var s=this.indexOf(r);this.models.splice(s,1),this.length--,delete this._byId[r.cid];var a=this.modelId(r.attributes,r.idAttribute);null!=a&&delete this._byId[a],t.silent||(t.index=s,r.trigger("remove",r,this,t)),n.push(r),this._removeReference(r,t)}}return e.length>0&&!t.silent&&delete t.index,n},_isModel:function(e){return e instanceof v},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes,e.idAttribute);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var n=this.modelId(e.attributes,e.idAttribute);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,i),"changeId"===e){var r=this.modelId(t.previousAttributes(),t.idAttribute),s=this.modelId(t.attributes,t.idAttribute);null!=r&&delete this._byId[r],null!=s&&(this._byId[s]=t)}}this.trigger.apply(this,arguments)},_forwardPristineError:function(e,t,n){this.has(e)||this._onModelEvent("error",e,t,n)}});var A="function"==typeof Symbol&&Symbol.iterator;A&&(y.prototype[A]=y.prototype.values);var x=function(e,t){this._collection=e,this._kind=t,this._index=0},T=1,S=2,_=3;A&&(x.prototype[A]=function(){return this}),x.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===T)e=t;else{var n=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===S?n:[n,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var k=t.View=function(e){this.cid=n.uniqueId("view"),this.preinitialize.apply(this,arguments),n.extend(this,n.pick(e,C)),this._ensureElement(),this.initialize.apply(this,arguments)},I=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];n.extend(k.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=n.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var i=e[t];if(n.isFunction(i)||(i=this[i]),i){var r=t.match(I);this.delegate(r[1],r[2],i.bind(this))}}return this},delegate:function(e,t,n){return this.$el.on(e+".delegateEvents"+this.cid,t,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){return this.$el.off(e+".delegateEvents"+this.cid,t,n),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var D=function(e,t,n,i){switch(t){case 1:return function(){return e[n](this[i])};case 2:return function(t){return e[n](this[i],t)};case 3:return function(t,r){return e[n](this[i],B(t,this),r)};case 4:return function(t,r,s){return e[n](this[i],B(t,this),r,s)};default:return function(){var t=s.call(arguments);return t.unshift(this[i]),e[n].apply(e,t)}}},P=function(e,t,i,r){n.each(i,(function(n,i){t[i]&&(e.prototype[i]=D(t,n,i,r))}))},B=function(e,t){return n.isFunction(e)?e:n.isObject(e)&&!t._isModel(e)?M(e):n.isString(e)?function(t){return t.get(e)}:e},M=function(e){var t=n.matches(e);return function(e){return t(e.attributes)}},R={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},N={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};n.each([[y,R,"models"],[v,N,"attributes"]],(function(e){var t=e[0],i=e[1],r=e[2];t.mixin=function(e){var i=n.reduce(n.functions(e),(function(e,t){return e[t]=0,e}),{});P(t,e,i,r)},P(t,n,i,r)})),t.sync=function(e,i,r){var s=O[e];n.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:s,dataType:"json"};if(r.url||(a.url=n.result(i,"url")||z()),null!=r.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){a.type="POST",r.emulateJSON&&(a.data._method=s);var o=r.beforeSend;r.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",s),o)return o.apply(this,arguments)}}"GET"===a.type||r.emulateJSON||(a.processData=!1);var c=r.error;r.error=function(e,t,n){r.textStatus=t,r.errorThrown=n,c&&c.call(r.context,e,t,n)};var u=r.xhr=t.ajax(n.extend(a,r));return i.trigger("request",i,u,r),u};var O={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var L=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},j=/\((.*?)\)/g,U=/(\(\?)?:\w+/g,F=/\*\w+/g,$=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(L.prototype,o,{preinitialize:function(){},initialize:function(){},route:function(e,i,r){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var s=this;return t.history.route(e,(function(n){var a=s._extractParameters(e,n);!1!==s.execute(r,a,i)&&(s.trigger.apply(s,["route:"+i].concat(a)),s.trigger("route",i,a),t.history.trigger("route",s,i,a))})),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace($,"\\$&").replace(j,"(?:$1)?").replace(U,(function(e,t){return t?e:"([^/?]+)"})).replace(F,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,(function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null}))}});var q=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,W=/^\/+|\/+$/g,V=/#.*$/;q.started=!1,n.extend(q.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(H,"")},start:function(e){if(q.started)throw new Error("Backbone.history has already been started");if(q.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._trailingSlash=this.options.trailingSlash,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(W,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,r=i.insertBefore(this.iframe,i.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),q.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!this.matchRoot()&&this.notfound();this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),n.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0}))||this.notfound()):this.notfound()},notfound:function(){return this.trigger("notfound"),!1},navigate:function(e,t){if(!q.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var n=this.root;this._trailingSlash||""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+e;e=e.replace(V,"");var r=this.decodeFragment(e);if(this.fragment!==r){if(this.fragment=r,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;t.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new q;var G=function(e,t){var i,r=this;return i=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,t),i.prototype=n.create(r.prototype,e),i.prototype.constructor=i,i.__super__=r.prototype,i};v.extend=y.extend=L.extend=k.extend=q.extend=G;var z=function(){throw new Error('A "url" property or function must be specified')},K=function(e,t){var n=t.error;t.error=function(i){n&&n.call(t.context,e,i,t),e.trigger("error",e,i,t)}};return t._debug=function(){return{root:e,_:n}},t}(s,n,e,t)}.apply(t,i),void 0===r||(e.exports=r)},38761:function(e,t){!function(){var n={version:"0.4.1",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},i=Array.prototype.map,r=Array.isArray,s=Object.prototype.toString;function a(e){return!!(""===e||e&&e.charCodeAt&&e.substr)}function o(e){return r?r(e):"[object Array]"===s.call(e)}function c(e){return e&&"[object Object]"===s.call(e)}function u(e,t){var n;for(n in e=e||{},t=t||{})t.hasOwnProperty(n)&&null==e[n]&&(e[n]=t[n]);return e}function l(e,t,n){var r,s,a=[];if(!e)return a;if(i&&e.map===i)return e.map(t,n);for(r=0,s=e.length;r<s;r++)a[r]=t.call(n,e[r],r,e);return a}function h(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function d(e){var t=n.settings.currency.format;return"function"==typeof e&&(e=e()),a(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:e&&e.pos&&e.pos.match("%v")?e:a(t)?n.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t}var f=n.unformat=n.parse=function(e,t){if(o(e))return l(e,(function(e){return f(e,t)}));if("number"==typeof(e=e||0))return e;t=t||n.settings.number.decimal;var i=new RegExp("[^0-9-"+t+"]",["g"]),r=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(i,"").replace(t,"."));return isNaN(r)?0:r},p=n.toFixed=function(e,t){t=h(t,n.settings.number.precision);var i=Math.pow(10,t);return(Math.round(n.unformat(e)*i)/i).toFixed(t)},g=n.formatNumber=n.format=function(e,t,i,r){if(o(e))return l(e,(function(e){return g(e,t,i,r)}));e=f(e);var s=u(c(t)?t:{precision:t,thousand:i,decimal:r},n.settings.number),a=h(s.precision),d=e<0?"-":"",m=parseInt(p(Math.abs(e||0),a),10)+"",v=m.length>3?m.length%3:0;return d+(v?m.substr(0,v)+s.thousand:"")+m.substr(v).replace(/(\d{3})(?=\d)/g,"$1"+s.thousand)+(a?s.decimal+p(Math.abs(e),a).split(".")[1]:"")},m=n.formatMoney=function(e,t,i,r,s,a){if(o(e))return l(e,(function(e){return m(e,t,i,r,s,a)}));e=f(e);var p=u(c(t)?t:{symbol:t,precision:i,thousand:r,decimal:s,format:a},n.settings.currency),v=d(p.format);return(e>0?v.pos:e<0?v.neg:v.zero).replace("%s",p.symbol).replace("%v",g(Math.abs(e),h(p.precision),p.thousand,p.decimal))};n.formatColumn=function(e,t,i,r,s,p){if(!e)return[];var m=u(c(t)?t:{symbol:t,precision:i,thousand:r,decimal:s,format:p},n.settings.currency),v=d(m.format),y=v.pos.indexOf("%s")<v.pos.indexOf("%v"),b=0,w=l(e,(function(e,t){if(o(e))return n.formatColumn(e,m);var i=((e=f(e))>0?v.pos:e<0?v.neg:v.zero).replace("%s",m.symbol).replace("%v",g(Math.abs(e),h(m.precision),m.thousand,m.decimal));return i.length>b&&(b=i.length),i}));return l(w,(function(e,t){return a(e)&&e.length<b?y?e.replace(m.symbol,m.symbol+new Array(b-e.length+1).join(" ")):new Array(b-e.length+1).join(" ")+e:e}))},e.exports&&(t=e.exports=n),t.accounting=n}()},41169:(e,t,n)=>{var i,r,s,a,o;i=n(59957),r=n(31761).utf8,s=n(68872),a=n(31761).bin,(o=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?a.stringToBytes(e):r.stringToBytes(e):s(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var n=i.bytesToWords(e),c=8*e.length,u=1732584193,l=-271733879,h=-1732584194,d=271733878,f=0;f<n.length;f++)n[f]=16711935&(n[f]<<8|n[f]>>>24)|4278255360&(n[f]<<24|n[f]>>>8);n[c>>>5]|=128<<c%32,n[14+(c+64>>>9<<4)]=c;var p=o._ff,g=o._gg,m=o._hh,v=o._ii;for(f=0;f<n.length;f+=16){var y=u,b=l,w=h,E=d;u=p(u,l,h,d,n[f+0],7,-680876936),d=p(d,u,l,h,n[f+1],12,-389564586),h=p(h,d,u,l,n[f+2],17,606105819),l=p(l,h,d,u,n[f+3],22,-1044525330),u=p(u,l,h,d,n[f+4],7,-176418897),d=p(d,u,l,h,n[f+5],12,1200080426),h=p(h,d,u,l,n[f+6],17,-1473231341),l=p(l,h,d,u,n[f+7],22,-45705983),u=p(u,l,h,d,n[f+8],7,1770035416),d=p(d,u,l,h,n[f+9],12,-1958414417),h=p(h,d,u,l,n[f+10],17,-42063),l=p(l,h,d,u,n[f+11],22,-1990404162),u=p(u,l,h,d,n[f+12],7,1804603682),d=p(d,u,l,h,n[f+13],12,-40341101),h=p(h,d,u,l,n[f+14],17,-1502002290),u=g(u,l=p(l,h,d,u,n[f+15],22,1236535329),h,d,n[f+1],5,-165796510),d=g(d,u,l,h,n[f+6],9,-1069501632),h=g(h,d,u,l,n[f+11],14,643717713),l=g(l,h,d,u,n[f+0],20,-373897302),u=g(u,l,h,d,n[f+5],5,-701558691),d=g(d,u,l,h,n[f+10],9,38016083),h=g(h,d,u,l,n[f+15],14,-660478335),l=g(l,h,d,u,n[f+4],20,-405537848),u=g(u,l,h,d,n[f+9],5,568446438),d=g(d,u,l,h,n[f+14],9,-1019803690),h=g(h,d,u,l,n[f+3],14,-187363961),l=g(l,h,d,u,n[f+8],20,1163531501),u=g(u,l,h,d,n[f+13],5,-1444681467),d=g(d,u,l,h,n[f+2],9,-51403784),h=g(h,d,u,l,n[f+7],14,1735328473),u=m(u,l=g(l,h,d,u,n[f+12],20,-1926607734),h,d,n[f+5],4,-378558),d=m(d,u,l,h,n[f+8],11,-2022574463),h=m(h,d,u,l,n[f+11],16,1839030562),l=m(l,h,d,u,n[f+14],23,-35309556),u=m(u,l,h,d,n[f+1],4,-1530992060),d=m(d,u,l,h,n[f+4],11,1272893353),h=m(h,d,u,l,n[f+7],16,-155497632),l=m(l,h,d,u,n[f+10],23,-1094730640),u=m(u,l,h,d,n[f+13],4,681279174),d=m(d,u,l,h,n[f+0],11,-358537222),h=m(h,d,u,l,n[f+3],16,-722521979),l=m(l,h,d,u,n[f+6],23,76029189),u=m(u,l,h,d,n[f+9],4,-640364487),d=m(d,u,l,h,n[f+12],11,-421815835),h=m(h,d,u,l,n[f+15],16,530742520),u=v(u,l=m(l,h,d,u,n[f+2],23,-995338651),h,d,n[f+0],6,-198630844),d=v(d,u,l,h,n[f+7],10,1126891415),h=v(h,d,u,l,n[f+14],15,-1416354905),l=v(l,h,d,u,n[f+5],21,-57434055),u=v(u,l,h,d,n[f+12],6,1700485571),d=v(d,u,l,h,n[f+3],10,-1894986606),h=v(h,d,u,l,n[f+10],15,-1051523),l=v(l,h,d,u,n[f+1],21,-2054922799),u=v(u,l,h,d,n[f+8],6,1873313359),d=v(d,u,l,h,n[f+15],10,-30611744),h=v(h,d,u,l,n[f+6],15,-1560198380),l=v(l,h,d,u,n[f+13],21,1309151649),u=v(u,l,h,d,n[f+4],6,-145523070),d=v(d,u,l,h,n[f+11],10,-1120210379),h=v(h,d,u,l,n[f+2],15,718787259),l=v(l,h,d,u,n[f+9],21,-343485551),u=u+y>>>0,l=l+b>>>0,h=h+w>>>0,d=d+E>>>0}return i.endian([u,l,h,d])})._ff=function(e,t,n,i,r,s,a){var o=e+(t&n|~t&i)+(r>>>0)+a;return(o<<s|o>>>32-s)+t},o._gg=function(e,t,n,i,r,s,a){var o=e+(t&i|n&~i)+(r>>>0)+a;return(o<<s|o>>>32-s)+t},o._hh=function(e,t,n,i,r,s,a){var o=e+(t^n^i)+(r>>>0)+a;return(o<<s|o>>>32-s)+t},o._ii=function(e,t,n,i,r,s,a){var o=e+(n^(t|~i))+(r>>>0)+a;return(o<<s|o>>>32-s)+t},o._blocksize=16,o._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=i.wordsToBytes(o(e,t));return t&&t.asBytes?n:t&&t.asString?a.bytesToString(n):i.bytesToHex(n)}},45091:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VERSION:()=>r,after:()=>Rt,all:()=>en,allKeys:()=>me,any:()=>tn,assign:()=>Re,before:()=>Nt,bind:()=>At,bindAll:()=>St,chain:()=>yt,chunk:()=>jn,clone:()=>je,collect:()=>Kt,compact:()=>kn,compose:()=>Mt,constant:()=>Z,contains:()=>nn,countBy:()=>vn,create:()=>Le,debounce:()=>Dt,default:()=>Hn,defaults:()=>Ne,defer:()=>It,delay:()=>kt,detect:()=>Vt,difference:()=>Cn,drop:()=>Sn,each:()=>zt,escape:()=>at,every:()=>en,extend:()=>Me,extendOwn:()=>Re,filter:()=>Zt,find:()=>Vt,findIndex:()=>Ut,findKey:()=>Lt,findLastIndex:()=>Ft,findWhere:()=>Gt,first:()=>Tn,flatten:()=>In,foldl:()=>Yt,foldr:()=>Xt,forEach:()=>zt,functions:()=>Pe,get:()=>He,groupBy:()=>gn,has:()=>We,head:()=>Tn,identity:()=>Ve,include:()=>nn,includes:()=>nn,indexBy:()=>mn,indexOf:()=>Ht,initial:()=>xn,inject:()=>Yt,intersection:()=>Mn,invert:()=>De,invoke:()=>rn,isArguments:()=>J,isArray:()=>G,isArrayBuffer:()=>L,isBoolean:()=>I,isDataView:()=>V,isDate:()=>M,isElement:()=>C,isEmpty:()=>ce,isEqual:()=>ge,isError:()=>N,isFinite:()=>Y,isFunction:()=>F,isMap:()=>Te,isMatch:()=>ue,isNaN:()=>X,isNull:()=>_,isNumber:()=>B,isObject:()=>S,isRegExp:()=>R,isSet:()=>_e,isString:()=>P,isSymbol:()=>O,isTypedArray:()=>re,isUndefined:()=>k,isWeakMap:()=>Se,isWeakSet:()=>ke,iteratee:()=>Ye,keys:()=>oe,last:()=>_n,lastIndexOf:()=>Wt,map:()=>Kt,mapObject:()=>Ze,matcher:()=>Ge,matches:()=>Ge,max:()=>on,memoize:()=>_t,methods:()=>Pe,min:()=>cn,mixin:()=>Fn,negate:()=>Bt,noop:()=>Qe,now:()=>it,object:()=>On,omit:()=>An,once:()=>Ot,pairs:()=>Ce,partial:()=>Et,partition:()=>yn,pick:()=>En,pluck:()=>sn,property:()=>ze,propertyOf:()=>et,random:()=>nt,range:()=>Ln,reduce:()=>Yt,reduceRight:()=>Xt,reject:()=>Qt,rest:()=>Sn,restArguments:()=>T,result:()=>gt,sample:()=>hn,select:()=>Zt,shuffle:()=>dn,size:()=>bn,some:()=>tn,sortBy:()=>fn,sortedIndex:()=>$t,tail:()=>Sn,take:()=>Tn,tap:()=>Ue,template:()=>pt,templateSettings:()=>ct,throttle:()=>Ct,times:()=>tt,toArray:()=>ln,toPath:()=>Fe,transpose:()=>Rn,unescape:()=>ot,union:()=>Bn,uniq:()=>Pn,unique:()=>Pn,uniqueId:()=>vt,unzip:()=>Rn,values:()=>Ie,where:()=>an,without:()=>Dn,wrap:()=>Pt,zip:()=>Nn});var i={};n.r(i),n.d(i,{VERSION:()=>r,after:()=>Rt,all:()=>en,allKeys:()=>me,any:()=>tn,assign:()=>Re,before:()=>Nt,bind:()=>At,bindAll:()=>St,chain:()=>yt,chunk:()=>jn,clone:()=>je,collect:()=>Kt,compact:()=>kn,compose:()=>Mt,constant:()=>Z,contains:()=>nn,countBy:()=>vn,create:()=>Le,debounce:()=>Dt,default:()=>$n,defaults:()=>Ne,defer:()=>It,delay:()=>kt,detect:()=>Vt,difference:()=>Cn,drop:()=>Sn,each:()=>zt,escape:()=>at,every:()=>en,extend:()=>Me,extendOwn:()=>Re,filter:()=>Zt,find:()=>Vt,findIndex:()=>Ut,findKey:()=>Lt,findLastIndex:()=>Ft,findWhere:()=>Gt,first:()=>Tn,flatten:()=>In,foldl:()=>Yt,foldr:()=>Xt,forEach:()=>zt,functions:()=>Pe,get:()=>He,groupBy:()=>gn,has:()=>We,head:()=>Tn,identity:()=>Ve,include:()=>nn,includes:()=>nn,indexBy:()=>mn,indexOf:()=>Ht,initial:()=>xn,inject:()=>Yt,intersection:()=>Mn,invert:()=>De,invoke:()=>rn,isArguments:()=>J,isArray:()=>G,isArrayBuffer:()=>L,isBoolean:()=>I,isDataView:()=>V,isDate:()=>M,isElement:()=>C,isEmpty:()=>ce,isEqual:()=>ge,isError:()=>N,isFinite:()=>Y,isFunction:()=>F,isMap:()=>Te,isMatch:()=>ue,isNaN:()=>X,isNull:()=>_,isNumber:()=>B,isObject:()=>S,isRegExp:()=>R,isSet:()=>_e,isString:()=>P,isSymbol:()=>O,isTypedArray:()=>re,isUndefined:()=>k,isWeakMap:()=>Se,isWeakSet:()=>ke,iteratee:()=>Ye,keys:()=>oe,last:()=>_n,lastIndexOf:()=>Wt,map:()=>Kt,mapObject:()=>Ze,matcher:()=>Ge,matches:()=>Ge,max:()=>on,memoize:()=>_t,methods:()=>Pe,min:()=>cn,mixin:()=>Fn,negate:()=>Bt,noop:()=>Qe,now:()=>it,object:()=>On,omit:()=>An,once:()=>Ot,pairs:()=>Ce,partial:()=>Et,partition:()=>yn,pick:()=>En,pluck:()=>sn,property:()=>ze,propertyOf:()=>et,random:()=>nt,range:()=>Ln,reduce:()=>Yt,reduceRight:()=>Xt,reject:()=>Qt,rest:()=>Sn,restArguments:()=>T,result:()=>gt,sample:()=>hn,select:()=>Zt,shuffle:()=>dn,size:()=>bn,some:()=>tn,sortBy:()=>fn,sortedIndex:()=>$t,tail:()=>Sn,take:()=>Tn,tap:()=>Ue,template:()=>pt,templateSettings:()=>ct,throttle:()=>Ct,times:()=>tt,toArray:()=>ln,toPath:()=>Fe,transpose:()=>Rn,unescape:()=>ot,union:()=>Bn,uniq:()=>Pn,unique:()=>Pn,uniqueId:()=>vt,unzip:()=>Rn,values:()=>Ie,where:()=>an,without:()=>Dn,wrap:()=>Pt,zip:()=>Nn});var r="1.13.7",s="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},a=Array.prototype,o=Object.prototype,c="undefined"!=typeof Symbol?Symbol.prototype:null,u=a.push,l=a.slice,h=o.toString,d=o.hasOwnProperty,f="undefined"!=typeof ArrayBuffer,p="undefined"!=typeof DataView,g=Array.isArray,m=Object.keys,v=Object.create,y=f&&ArrayBuffer.isView,b=isNaN,w=isFinite,E=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],x=Math.pow(2,53)-1;function T(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i);case 2:return e.call(this,arguments[0],arguments[1],i)}var s=Array(t+1);for(r=0;r<t;r++)s[r]=arguments[r];return s[t]=i,e.apply(this,s)}}function S(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function _(e){return null===e}function k(e){return void 0===e}function I(e){return!0===e||!1===e||"[object Boolean]"===h.call(e)}function C(e){return!(!e||1!==e.nodeType)}function D(e){var t="[object "+e+"]";return function(e){return h.call(e)===t}}const P=D("String"),B=D("Number"),M=D("Date"),R=D("RegExp"),N=D("Error"),O=D("Symbol"),L=D("ArrayBuffer");var j=D("Function"),U=s.document&&s.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof U&&(j=function(e){return"function"==typeof e||!1});const F=j,$=D("Object");var q=p&&(!/\[native code\]/.test(String(DataView))||$(new DataView(new ArrayBuffer(8)))),H="undefined"!=typeof Map&&$(new Map),W=D("DataView");const V=q?function(e){return null!=e&&F(e.getInt8)&&L(e.buffer)}:W,G=g||D("Array");function z(e,t){return null!=e&&d.call(e,t)}var K=D("Arguments");!function(){K(arguments)||(K=function(e){return z(e,"callee")})}();const J=K;function Y(e){return!O(e)&&w(e)&&!isNaN(parseFloat(e))}function X(e){return B(e)&&b(e)}function Z(e){return function(){return e}}function Q(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=x}}function ee(e){return function(t){return null==t?void 0:t[e]}}const te=ee("byteLength"),ne=Q(te);var ie=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;const re=f?function(e){return y?y(e)&&!V(e):ne(e)&&ie.test(h.call(e))}:Z(!1),se=ee("length");function ae(e,t){t=function(e){for(var t={},n=e.length,i=0;i<n;++i)t[e[i]]=!0;return{contains:function(e){return!0===t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=A.length,i=e.constructor,r=F(i)&&i.prototype||o,s="constructor";for(z(e,s)&&!t.contains(s)&&t.push(s);n--;)(s=A[n])in e&&e[s]!==r[s]&&!t.contains(s)&&t.push(s)}function oe(e){if(!S(e))return[];if(m)return m(e);var t=[];for(var n in e)z(e,n)&&t.push(n);return E&&ae(e,t),t}function ce(e){if(null==e)return!0;var t=se(e);return"number"==typeof t&&(G(e)||P(e)||J(e))?0===t:0===se(oe(e))}function ue(e,t){var n=oe(t),i=n.length;if(null==e)return!i;for(var r=Object(e),s=0;s<i;s++){var a=n[s];if(t[a]!==r[a]||!(a in r))return!1}return!0}function le(e){return e instanceof le?e:this instanceof le?void(this._wrapped=e):new le(e)}function he(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,te(e))}le.VERSION=r,le.prototype.value=function(){return this._wrapped},le.prototype.valueOf=le.prototype.toJSON=le.prototype.value,le.prototype.toString=function(){return String(this._wrapped)};var de="[object DataView]";function fe(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var r=typeof e;return("function"===r||"object"===r||"object"==typeof t)&&pe(e,t,n,i)}function pe(e,t,n,i){e instanceof le&&(e=e._wrapped),t instanceof le&&(t=t._wrapped);var r=h.call(e);if(r!==h.call(t))return!1;if(q&&"[object Object]"==r&&V(e)){if(!V(t))return!1;r=de}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return c.valueOf.call(e)===c.valueOf.call(t);case"[object ArrayBuffer]":case de:return pe(he(e),he(t),n,i)}var s="[object Array]"===r;if(!s&&re(e)){if(te(e)!==te(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,o=t.constructor;if(a!==o&&!(F(a)&&a instanceof a&&F(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return i[u]===t;if(n.push(e),i.push(t),s){if((u=e.length)!==t.length)return!1;for(;u--;)if(!fe(e[u],t[u],n,i))return!1}else{var l,d=oe(e);if(u=d.length,oe(t).length!==u)return!1;for(;u--;)if(!z(t,l=d[u])||!fe(e[l],t[l],n,i))return!1}return n.pop(),i.pop(),!0}function ge(e,t){return fe(e,t)}function me(e){if(!S(e))return[];var t=[];for(var n in e)t.push(n);return E&&ae(e,t),t}function ve(e){var t=se(e);return function(n){if(null==n)return!1;var i=me(n);if(se(i))return!1;for(var r=0;r<t;r++)if(!F(n[e[r]]))return!1;return e!==Ae||!F(n[ye])}}var ye="forEach",be=["clear","delete"],we=["get","has","set"],Ee=be.concat(ye,we),Ae=be.concat(we),xe=["add"].concat(be,ye,"has");const Te=H?ve(Ee):D("Map"),Se=H?ve(Ae):D("WeakMap"),_e=H?ve(xe):D("Set"),ke=D("WeakSet");function Ie(e){for(var t=oe(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=e[t[r]];return i}function Ce(e){for(var t=oe(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=[t[r],e[t[r]]];return i}function De(e){for(var t={},n=oe(e),i=0,r=n.length;i<r;i++)t[e[n[i]]]=n[i];return t}function Pe(e){var t=[];for(var n in e)F(e[n])&&t.push(n);return t.sort()}function Be(e,t){return function(n){var i=arguments.length;if(t&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var s=arguments[r],a=e(s),o=a.length,c=0;c<o;c++){var u=a[c];t&&void 0!==n[u]||(n[u]=s[u])}return n}}const Me=Be(me),Re=Be(oe),Ne=Be(me,!0);function Oe(e){if(!S(e))return{};if(v)return v(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Le(e,t){var n=Oe(e);return t&&Re(n,t),n}function je(e){return S(e)?G(e)?e.slice():Me({},e):e}function Ue(e,t){return t(e),e}function Fe(e){return G(e)?e:[e]}function $e(e){return le.toPath(e)}function qe(e,t){for(var n=t.length,i=0;i<n;i++){if(null==e)return;e=e[t[i]]}return n?e:void 0}function He(e,t,n){var i=qe(e,$e(t));return k(i)?n:i}function We(e,t){for(var n=(t=$e(t)).length,i=0;i<n;i++){var r=t[i];if(!z(e,r))return!1;e=e[r]}return!!n}function Ve(e){return e}function Ge(e){return e=Re({},e),function(t){return ue(t,e)}}function ze(e){return e=$e(e),function(t){return qe(t,e)}}function Ke(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,s){return e.call(t,n,i,r,s)}}return function(){return e.apply(t,arguments)}}function Je(e,t,n){return null==e?Ve:F(e)?Ke(e,t,n):S(e)&&!G(e)?Ge(e):ze(e)}function Ye(e,t){return Je(e,t,1/0)}function Xe(e,t,n){return le.iteratee!==Ye?le.iteratee(e,t):Je(e,t,n)}function Ze(e,t,n){t=Xe(t,n);for(var i=oe(e),r=i.length,s={},a=0;a<r;a++){var o=i[a];s[o]=t(e[o],o,e)}return s}function Qe(){}function et(e){return null==e?Qe:function(t){return He(e,t)}}function tt(e,t,n){var i=Array(Math.max(0,e));t=Ke(t,n,1);for(var r=0;r<e;r++)i[r]=t(r);return i}function nt(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}le.toPath=Fe,le.iteratee=Ye;const it=Date.now||function(){return(new Date).getTime()};function rt(e){var t=function(t){return e[t]},n="(?:"+oe(e).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(r,t):e}}const st={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},at=rt(st),ot=rt(De(st)),ct=le.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ut=/(.)^/,lt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},ht=/\\|'|\r|\n|\u2028|\u2029/g;function dt(e){return"\\"+lt[e]}var ft=/^\s*(\w|\$)+\s*$/;function pt(e,t,n){!t&&n&&(t=n),t=Ne({},t,le.templateSettings);var i=RegExp([(t.escape||ut).source,(t.interpolate||ut).source,(t.evaluate||ut).source].join("|")+"|$","g"),r=0,s="__p+='";e.replace(i,(function(t,n,i,a,o){return s+=e.slice(r,o).replace(ht,dt),r=o+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(s+="';\n"+a+"\n__p+='"),t})),s+="';\n";var a,o=t.variable;if(o){if(!ft.test(o))throw new Error("variable is not a bare identifier: "+o)}else s="with(obj||{}){\n"+s+"}\n",o="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{a=new Function(o,"_",s)}catch(e){throw e.source=s,e}var c=function(e){return a.call(this,e,le)};return c.source="function("+o+"){\n"+s+"}",c}function gt(e,t,n){var i=(t=$e(t)).length;if(!i)return F(n)?n.call(e):n;for(var r=0;r<i;r++){var s=null==e?void 0:e[t[r]];void 0===s&&(s=n,r=i),e=F(s)?s.call(e):s}return e}var mt=0;function vt(e){var t=++mt+"";return e?e+t:t}function yt(e){var t=le(e);return t._chain=!0,t}function bt(e,t,n,i,r){if(!(i instanceof t))return e.apply(n,r);var s=Oe(e.prototype),a=e.apply(s,r);return S(a)?a:s}var wt=T((function(e,t){var n=wt.placeholder,i=function(){for(var r=0,s=t.length,a=Array(s),o=0;o<s;o++)a[o]=t[o]===n?arguments[r++]:t[o];for(;r<arguments.length;)a.push(arguments[r++]);return bt(e,i,this,this,a)};return i}));wt.placeholder=le;const Et=wt,At=T((function(e,t,n){if(!F(e))throw new TypeError("Bind must be called on a function");var i=T((function(r){return bt(e,i,t,this,n.concat(r))}));return i})),xt=Q(se);function Tt(e,t,n,i){if(i=i||[],t||0===t){if(t<=0)return i.concat(e)}else t=1/0;for(var r=i.length,s=0,a=se(e);s<a;s++){var o=e[s];if(xt(o)&&(G(o)||J(o)))if(t>1)Tt(o,t-1,n,i),r=i.length;else for(var c=0,u=o.length;c<u;)i[r++]=o[c++];else n||(i[r++]=o)}return i}const St=T((function(e,t){var n=(t=Tt(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=t[n];e[i]=At(e[i],e)}return e}));function _t(e,t){var n=function(i){var r=n.cache,s=""+(t?t.apply(this,arguments):i);return z(r,s)||(r[s]=e.apply(this,arguments)),r[s]};return n.cache={},n}const kt=T((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),It=Et(kt,le,1);function Ct(e,t,n){var i,r,s,a,o=0;n||(n={});var c=function(){o=!1===n.leading?0:it(),i=null,a=e.apply(r,s),i||(r=s=null)},u=function(){var u=it();o||!1!==n.leading||(o=u);var l=t-(u-o);return r=this,s=arguments,l<=0||l>t?(i&&(clearTimeout(i),i=null),o=u,a=e.apply(r,s),i||(r=s=null)):i||!1===n.trailing||(i=setTimeout(c,l)),a};return u.cancel=function(){clearTimeout(i),o=0,i=r=s=null},u}function Dt(e,t,n){var i,r,s,a,o,c=function(){var u=it()-r;t>u?i=setTimeout(c,t-u):(i=null,n||(a=e.apply(o,s)),i||(s=o=null))},u=T((function(u){return o=this,s=u,r=it(),i||(i=setTimeout(c,t),n&&(a=e.apply(o,s))),a}));return u.cancel=function(){clearTimeout(i),i=s=o=null},u}function Pt(e,t){return Et(t,e)}function Bt(e){return function(){return!e.apply(this,arguments)}}function Mt(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}}function Rt(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function Nt(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}const Ot=Et(Nt,2);function Lt(e,t,n){t=Xe(t,n);for(var i,r=oe(e),s=0,a=r.length;s<a;s++)if(t(e[i=r[s]],i,e))return i}function jt(e){return function(t,n,i){n=Xe(n,i);for(var r=se(t),s=e>0?0:r-1;s>=0&&s<r;s+=e)if(n(t[s],s,t))return s;return-1}}const Ut=jt(1),Ft=jt(-1);function $t(e,t,n,i){for(var r=(n=Xe(n,i,1))(t),s=0,a=se(e);s<a;){var o=Math.floor((s+a)/2);n(e[o])<r?s=o+1:a=o}return s}function qt(e,t,n){return function(i,r,s){var a=0,o=se(i);if("number"==typeof s)e>0?a=s>=0?s:Math.max(s+o,a):o=s>=0?Math.min(s+1,o):s+o+1;else if(n&&s&&o)return i[s=n(i,r)]===r?s:-1;if(r!=r)return(s=t(l.call(i,a,o),X))>=0?s+a:-1;for(s=e>0?a:o-1;s>=0&&s<o;s+=e)if(i[s]===r)return s;return-1}}const Ht=qt(1,Ut,$t),Wt=qt(-1,Ft);function Vt(e,t,n){var i=(xt(e)?Ut:Lt)(e,t,n);if(void 0!==i&&-1!==i)return e[i]}function Gt(e,t){return Vt(e,Ge(t))}function zt(e,t,n){var i,r;if(t=Ke(t,n),xt(e))for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else{var s=oe(e);for(i=0,r=s.length;i<r;i++)t(e[s[i]],s[i],e)}return e}function Kt(e,t,n){t=Xe(t,n);for(var i=!xt(e)&&oe(e),r=(i||e).length,s=Array(r),a=0;a<r;a++){var o=i?i[a]:a;s[a]=t(e[o],o,e)}return s}function Jt(e){return function(t,n,i,r){var s=arguments.length>=3;return function(t,n,i,r){var s=!xt(t)&&oe(t),a=(s||t).length,o=e>0?0:a-1;for(r||(i=t[s?s[o]:o],o+=e);o>=0&&o<a;o+=e){var c=s?s[o]:o;i=n(i,t[c],c,t)}return i}(t,Ke(n,r,4),i,s)}}const Yt=Jt(1),Xt=Jt(-1);function Zt(e,t,n){var i=[];return t=Xe(t,n),zt(e,(function(e,n,r){t(e,n,r)&&i.push(e)})),i}function Qt(e,t,n){return Zt(e,Bt(Xe(t)),n)}function en(e,t,n){t=Xe(t,n);for(var i=!xt(e)&&oe(e),r=(i||e).length,s=0;s<r;s++){var a=i?i[s]:s;if(!t(e[a],a,e))return!1}return!0}function tn(e,t,n){t=Xe(t,n);for(var i=!xt(e)&&oe(e),r=(i||e).length,s=0;s<r;s++){var a=i?i[s]:s;if(t(e[a],a,e))return!0}return!1}function nn(e,t,n,i){return xt(e)||(e=Ie(e)),("number"!=typeof n||i)&&(n=0),Ht(e,t,n)>=0}const rn=T((function(e,t,n){var i,r;return F(t)?r=t:(t=$e(t),i=t.slice(0,-1),t=t[t.length-1]),Kt(e,(function(e){var s=r;if(!s){if(i&&i.length&&(e=qe(e,i)),null==e)return;s=e[t]}return null==s?s:s.apply(e,n)}))}));function sn(e,t){return Kt(e,ze(t))}function an(e,t){return Zt(e,Ge(t))}function on(e,t,n){var i,r,s=-1/0,a=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var o=0,c=(e=xt(e)?e:Ie(e)).length;o<c;o++)null!=(i=e[o])&&i>s&&(s=i);else t=Xe(t,n),zt(e,(function(e,n,i){((r=t(e,n,i))>a||r===-1/0&&s===-1/0)&&(s=e,a=r)}));return s}function cn(e,t,n){var i,r,s=1/0,a=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var o=0,c=(e=xt(e)?e:Ie(e)).length;o<c;o++)null!=(i=e[o])&&i<s&&(s=i);else t=Xe(t,n),zt(e,(function(e,n,i){((r=t(e,n,i))<a||r===1/0&&s===1/0)&&(s=e,a=r)}));return s}var un=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ln(e){return e?G(e)?l.call(e):P(e)?e.match(un):xt(e)?Kt(e,Ve):Ie(e):[]}function hn(e,t,n){if(null==t||n)return xt(e)||(e=Ie(e)),e[nt(e.length-1)];var i=ln(e),r=se(i);t=Math.max(Math.min(t,r),0);for(var s=r-1,a=0;a<t;a++){var o=nt(a,s),c=i[a];i[a]=i[o],i[o]=c}return i.slice(0,t)}function dn(e){return hn(e,1/0)}function fn(e,t,n){var i=0;return t=Xe(t,n),sn(Kt(e,(function(e,n,r){return{value:e,index:i++,criteria:t(e,n,r)}})).sort((function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index})),"value")}function pn(e,t){return function(n,i,r){var s=t?[[],[]]:{};return i=Xe(i,r),zt(n,(function(t,r){var a=i(t,r,n);e(s,t,a)})),s}}const gn=pn((function(e,t,n){z(e,n)?e[n].push(t):e[n]=[t]})),mn=pn((function(e,t,n){e[n]=t})),vn=pn((function(e,t,n){z(e,n)?e[n]++:e[n]=1})),yn=pn((function(e,t,n){e[n?0:1].push(t)}),!0);function bn(e){return null==e?0:xt(e)?e.length:oe(e).length}function wn(e,t,n){return t in n}const En=T((function(e,t){var n={},i=t[0];if(null==e)return n;F(i)?(t.length>1&&(i=Ke(i,t[1])),t=me(e)):(i=wn,t=Tt(t,!1,!1),e=Object(e));for(var r=0,s=t.length;r<s;r++){var a=t[r],o=e[a];i(o,a,e)&&(n[a]=o)}return n})),An=T((function(e,t){var n,i=t[0];return F(i)?(i=Bt(i),t.length>1&&(n=t[1])):(t=Kt(Tt(t,!1,!1),String),i=function(e,n){return!nn(t,n)}),En(e,i,n)}));function xn(e,t,n){return l.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function Tn(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:xn(e,e.length-t)}function Sn(e,t,n){return l.call(e,null==t||n?1:t)}function _n(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:Sn(e,Math.max(0,e.length-t))}function kn(e){return Zt(e,Boolean)}function In(e,t){return Tt(e,t,!1)}const Cn=T((function(e,t){return t=Tt(t,!0,!0),Zt(e,(function(e){return!nn(t,e)}))})),Dn=T((function(e,t){return Cn(e,t)}));function Pn(e,t,n,i){I(t)||(i=n,n=t,t=!1),null!=n&&(n=Xe(n,i));for(var r=[],s=[],a=0,o=se(e);a<o;a++){var c=e[a],u=n?n(c,a,e):c;t&&!n?(a&&s===u||r.push(c),s=u):n?nn(s,u)||(s.push(u),r.push(c)):nn(r,c)||r.push(c)}return r}const Bn=T((function(e){return Pn(Tt(e,!0,!0))}));function Mn(e){for(var t=[],n=arguments.length,i=0,r=se(e);i<r;i++){var s=e[i];if(!nn(t,s)){var a;for(a=1;a<n&&nn(arguments[a],s);a++);a===n&&t.push(s)}}return t}function Rn(e){for(var t=e&&on(e,se).length||0,n=Array(t),i=0;i<t;i++)n[i]=sn(e,i);return n}const Nn=T(Rn);function On(e,t){for(var n={},i=0,r=se(e);i<r;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n}function Ln(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),s=0;s<i;s++,e+=n)r[s]=e;return r}function jn(e,t){if(null==t||t<1)return[];for(var n=[],i=0,r=e.length;i<r;)n.push(l.call(e,i,i+=t));return n}function Un(e,t){return e._chain?le(t).chain():t}function Fn(e){return zt(Pe(e),(function(t){var n=le[t]=e[t];le.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),Un(this,n.apply(le,e))}})),le}zt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=a[e];le.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),Un(this,n)}})),zt(["concat","join","slice"],(function(e){var t=a[e];le.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Un(this,e)}}));const $n=le;var qn=Fn(i);qn._=qn;const Hn=qn},59957:e=>{var t,n;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,i=0;n<e.length;n++,i+=8)t[i>>>5]|=e[n]<<24-i%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],i=0;i<e.length;i+=3)for(var r=e[i]<<16|e[i+1]<<8|e[i+2],s=0;s<4;s++)8*i+6*s<=8*e.length?n.push(t.charAt(r>>>6*(3-s)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],i=0,r=0;i<e.length;r=++i%4)0!=r&&n.push((t.indexOf(e.charAt(i-1))&Math.pow(2,-2*r+8)-1)<<2*r|t.indexOf(e.charAt(i))>>>6-2*r);return n}},e.exports=n},64785:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}(e,r,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,n,i){var r,s,a;if(o(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]),void 0===a)a=s[t]=n,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=c(e))>0&&a.length>r&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,console&&console.warn}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,l=p(c,u);for(n=0;n<u;++n)i(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,s,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},68872:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},79602:function(e,t){var n;!function(t,n){"use strict";"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,(function(i,r){"use strict";var s=[],a=Object.getPrototypeOf,o=s.slice,c=s.flat?function(e){return s.flat.call(e)}:function(e){return s.concat.apply([],e)},u=s.push,l=s.indexOf,h={},d=h.toString,f=h.hasOwnProperty,p=f.toString,g=p.call(Object),m={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},b=i.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function E(e,t,n){var i,r,s=(n=n||b).createElement("script");if(s.text=e,t)for(i in w)(r=t[i]||t.getAttribute&&t.getAttribute(i))&&s.setAttribute(i,r);n.head.appendChild(s).parentNode.removeChild(s)}function A(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[d.call(e)]||"object":typeof e}var x="3.7.1",T=/HTML$/i,S=function(e,t){return new S.fn.init(e,t)};function _(e){var t=!!e&&"length"in e&&e.length,n=A(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function k(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}S.fn=S.prototype={jquery:x,constructor:S,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(e){return this.pushStack(S.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(S.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:s.sort,splice:s.splice},S.extend=S.fn.extend=function(){var e,t,n,i,r,s,a=arguments[0]||{},o=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[o]||{},o++),"object"==typeof a||v(a)||(a={}),o===c&&(a=this,o--);o<c;o++)if(null!=(e=arguments[o]))for(t in e)i=e[t],"__proto__"!==t&&a!==i&&(u&&i&&(S.isPlainObject(i)||(r=Array.isArray(i)))?(n=a[t],s=r&&!Array.isArray(n)?[]:r||S.isPlainObject(n)?n:{},r=!1,a[t]=S.extend(u,s,i)):void 0!==i&&(a[t]=i));return a},S.extend({expando:"jQuery"+(x+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==d.call(e))&&(!(t=a(e))||"function"==typeof(n=f.call(t,"constructor")&&t.constructor)&&p.call(n)===g)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){E(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(_(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},text:function(e){var t,n="",i=0,r=e.nodeType;if(!r)for(;t=e[i++];)n+=S.text(t);return 1===r||11===r?e.textContent:9===r?e.documentElement.textContent:3===r||4===r?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(_(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:l.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!T.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;i<n;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i=[],r=0,s=e.length,a=!n;r<s;r++)!t(e[r],r)!==a&&i.push(e[r]);return i},map:function(e,t,n){var i,r,s=0,a=[];if(_(e))for(i=e.length;s<i;s++)null!=(r=t(e[s],s,n))&&a.push(r);else for(s in e)null!=(r=t(e[s],s,n))&&a.push(r);return c(a)},guid:1,support:m}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=s[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){h["[object "+t+"]"]=t.toLowerCase()}));var I=s.pop,C=s.sort,D=s.splice,P="[\\x20\\t\\r\\n\\f]",B=new RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g");S.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var M=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function R(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}S.escapeSelector=function(e){return(e+"").replace(M,R)};var N=b,O=u;!function(){var e,t,n,r,a,c,u,h,d,p,g=O,v=S.expando,y=0,b=0,w=ee(),E=ee(),A=ee(),x=ee(),T=function(e,t){return e===t&&(a=!0),0},_="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="(?:\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",R="\\["+P+"*("+M+")(?:"+P+"*([*^$|!~]?=)"+P+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+P+"*\\]",L=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",j=new RegExp(P+"+","g"),U=new RegExp("^"+P+"*,"+P+"*"),F=new RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),$=new RegExp(P+"|>"),q=new RegExp(L),H=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+L),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:new RegExp("^(?:"+_+")$","i"),needsContext:new RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},V=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,K=/[+~]/,J=new RegExp("\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\([^\\r\\n\\f])","g"),Y=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},X=function(){ce()},Z=de((function(e){return!0===e.disabled&&k(e,"fieldset")}),{dir:"parentNode",next:"legend"});try{g.apply(s=o.call(N.childNodes),N.childNodes),s[N.childNodes.length].nodeType}catch(e){g={apply:function(e,t){O.apply(e,o.call(t))},call:function(e){O.apply(e,o.call(arguments,1))}}}function Q(e,t,n,i){var r,s,a,o,u,l,f,p=t&&t.ownerDocument,y=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==y&&9!==y&&11!==y)return n;if(!i&&(ce(t),t=t||c,h)){if(11!==y&&(u=z.exec(e)))if(r=u[1]){if(9===y){if(!(a=t.getElementById(r)))return n;if(a.id===r)return g.call(n,a),n}else if(p&&(a=p.getElementById(r))&&Q.contains(t,a)&&a.id===r)return g.call(n,a),n}else{if(u[2])return g.apply(n,t.getElementsByTagName(e)),n;if((r=u[3])&&t.getElementsByClassName)return g.apply(n,t.getElementsByClassName(r)),n}if(!(x[e+" "]||d&&d.test(e))){if(f=e,p=t,1===y&&($.test(e)||F.test(e))){for((p=K.test(e)&&oe(t.parentNode)||t)==t&&m.scope||((o=t.getAttribute("id"))?o=S.escapeSelector(o):t.setAttribute("id",o=v)),s=(l=le(e)).length;s--;)l[s]=(o?"#"+o:":scope")+" "+he(l[s]);f=l.join(",")}try{return g.apply(n,p.querySelectorAll(f)),n}catch(t){x(e,!0)}finally{o===v&&t.removeAttribute("id")}}}return ye(e.replace(B,"$1"),t,n,i)}function ee(){var e=[];return function n(i,r){return e.push(i+" ")>t.cacheLength&&delete n[e.shift()],n[i+" "]=r}}function te(e){return e[v]=!0,e}function ne(e){var t=c.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ie(e){return function(t){return k(t,"input")&&t.type===e}}function re(e){return function(t){return(k(t,"input")||k(t,"button"))&&t.type===e}}function se(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Z(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ae(e){return te((function(t){return t=+t,te((function(n,i){for(var r,s=e([],n.length,t),a=s.length;a--;)n[r=s[a]]&&(n[r]=!(i[r]=n[r]))}))}))}function oe(e){return e&&void 0!==e.getElementsByTagName&&e}function ce(e){var n,i=e?e.ownerDocument||e:N;return i!=c&&9===i.nodeType&&i.documentElement?(u=(c=i).documentElement,h=!S.isXMLDoc(c),p=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,u.msMatchesSelector&&N!=c&&(n=c.defaultView)&&n.top!==n&&n.addEventListener("unload",X),m.getById=ne((function(e){return u.appendChild(e).id=S.expando,!c.getElementsByName||!c.getElementsByName(S.expando).length})),m.disconnectedMatch=ne((function(e){return p.call(e,"*")})),m.scope=ne((function(){return c.querySelectorAll(":scope")})),m.cssHas=ne((function(){try{return c.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),m.getById?(t.filter.ID=function(e){var t=e.replace(J,Y);return function(e){return e.getAttribute("id")===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&h){var n=t.getElementById(e);return n?[n]:[]}}):(t.filter.ID=function(e){var t=e.replace(J,Y);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&h){var n,i,r,s=t.getElementById(e);if(s){if((n=s.getAttributeNode("id"))&&n.value===e)return[s];for(r=t.getElementsByName(e),i=0;s=r[i++];)if((n=s.getAttributeNode("id"))&&n.value===e)return[s]}return[]}}),t.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},t.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&h)return t.getElementsByClassName(e)},d=[],ne((function(e){var t;u.appendChild(e).innerHTML="<a id='"+v+"' href='' disabled='disabled'></a><select id='"+v+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+P+"*(?:value|"+_+")"),e.querySelectorAll("[id~="+v+"-]").length||d.push("~="),e.querySelectorAll("a#"+v+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=c.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),u.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=c.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+P+"*name"+P+"*="+P+"*(?:''|\"\")")})),m.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),T=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!m.sortDetached&&t.compareDocumentPosition(e)===n?e===c||e.ownerDocument==N&&Q.contains(N,e)?-1:t===c||t.ownerDocument==N&&Q.contains(N,t)?1:r?l.call(r,e)-l.call(r,t):0:4&n?-1:1)},c):c}for(e in Q.matches=function(e,t){return Q(e,null,null,t)},Q.matchesSelector=function(e,t){if(ce(e),h&&!x[t+" "]&&(!d||!d.test(t)))try{var n=p.call(e,t);if(n||m.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){x(t,!0)}return Q(t,c,null,[e]).length>0},Q.contains=function(e,t){return(e.ownerDocument||e)!=c&&ce(e),S.contains(e,t)},Q.attr=function(e,n){(e.ownerDocument||e)!=c&&ce(e);var i=t.attrHandle[n.toLowerCase()],r=i&&f.call(t.attrHandle,n.toLowerCase())?i(e,n,!h):void 0;return void 0!==r?r:e.getAttribute(n)},Q.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},S.uniqueSort=function(e){var t,n=[],i=0,s=0;if(a=!m.sortStable,r=!m.sortStable&&o.call(e,0),C.call(e,T),a){for(;t=e[s++];)t===e[s]&&(i=n.push(s));for(;i--;)D.call(e,n[i],1)}return r=null,e},S.fn.uniqueSort=function(){return this.pushStack(S.uniqueSort(o.apply(this)))},t=S.expr={cacheLength:50,createPseudo:te,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(J,Y),e[3]=(e[3]||e[4]||e[5]||"").replace(J,Y),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||Q.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&Q.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return W.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&q.test(n)&&(t=le(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(J,Y).toLowerCase();return"*"===e?function(){return!0}:function(e){return k(e,t)}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&w(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(i){var r=Q.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r.replace(j," ")+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var s="nth"!==e.slice(0,3),a="last"!==e.slice(-4),o="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,c){var u,l,h,d,f,p=s!==a?"nextSibling":"previousSibling",g=t.parentNode,m=o&&t.nodeName.toLowerCase(),b=!c&&!o,w=!1;if(g){if(s){for(;p;){for(h=t;h=h[p];)if(o?k(h,m):1===h.nodeType)return!1;f=p="only"===e&&!f&&"nextSibling"}return!0}if(f=[a?g.firstChild:g.lastChild],a&&b){for(w=(d=(u=(l=g[v]||(g[v]={}))[e]||[])[0]===y&&u[1])&&u[2],h=d&&g.childNodes[d];h=++d&&h&&h[p]||(w=d=0)||f.pop();)if(1===h.nodeType&&++w&&h===t){l[e]=[y,d,w];break}}else if(b&&(w=d=(u=(l=t[v]||(t[v]={}))[e]||[])[0]===y&&u[1]),!1===w)for(;(h=++d&&h&&h[p]||(w=d=0)||f.pop())&&(!(o?k(h,m):1===h.nodeType)||!++w||(b&&((l=h[v]||(h[v]={}))[e]=[y,w]),h!==t)););return(w-=r)===i||w%i==0&&w/i>=0}}},PSEUDO:function(e,n){var i,r=t.pseudos[e]||t.setFilters[e.toLowerCase()]||Q.error("unsupported pseudo: "+e);return r[v]?r(n):r.length>1?(i=[e,e,"",n],t.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,t){for(var i,s=r(e,n),a=s.length;a--;)e[i=l.call(e,s[a])]=!(t[i]=s[a])})):function(e){return r(e,0,i)}):r}},pseudos:{not:te((function(e){var t=[],n=[],i=ve(e.replace(B,"$1"));return i[v]?te((function(e,t,n,r){for(var s,a=i(e,null,r,[]),o=e.length;o--;)(s=a[o])&&(e[o]=!(t[o]=s))})):function(e,r,s){return t[0]=e,i(t,null,s,n),t[0]=null,!n.pop()}})),has:te((function(e){return function(t){return Q(e,t).length>0}})),contains:te((function(e){return e=e.replace(J,Y),function(t){return(t.textContent||S.text(t)).indexOf(e)>-1}})),lang:te((function(e){return H.test(e||"")||Q.error("unsupported lang: "+e),e=e.replace(J,Y).toLowerCase(),function(t){var n;do{if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===u},focus:function(e){return e===function(){try{return c.activeElement}catch(e){}}()&&c.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:se(!1),disabled:se(!0),checked:function(e){return k(e,"input")&&!!e.checked||k(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!t.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return V.test(e.nodeName)},button:function(e){return k(e,"input")&&"button"===e.type||k(e,"button")},text:function(e){var t;return k(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ae((function(){return[0]})),last:ae((function(e,t){return[t-1]})),eq:ae((function(e,t,n){return[n<0?n+t:n]})),even:ae((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:ae((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:ae((function(e,t,n){var i;for(i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:ae((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}},t.pseudos.nth=t.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[e]=ie(e);for(e in{submit:!0,reset:!0})t.pseudos[e]=re(e);function ue(){}function le(e,n){var i,r,s,a,o,c,u,l=E[e+" "];if(l)return n?0:l.slice(0);for(o=e,c=[],u=t.preFilter;o;){for(a in i&&!(r=U.exec(o))||(r&&(o=o.slice(r[0].length)||o),c.push(s=[])),i=!1,(r=F.exec(o))&&(i=r.shift(),s.push({value:i,type:r[0].replace(B," ")}),o=o.slice(i.length)),t.filter)!(r=W[a].exec(o))||u[a]&&!(r=u[a](r))||(i=r.shift(),s.push({value:i,type:a,matches:r}),o=o.slice(i.length));if(!i)break}return n?o.length:o?Q.error(e):E(e,c).slice(0)}function he(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function de(e,t,n){var i=t.dir,r=t.next,s=r||i,a=n&&"parentNode"===s,o=b++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||a)return e(t,n,r);return!1}:function(t,n,c){var u,l,h=[y,o];if(c){for(;t=t[i];)if((1===t.nodeType||a)&&e(t,n,c))return!0}else for(;t=t[i];)if(1===t.nodeType||a)if(l=t[v]||(t[v]={}),r&&k(t,r))t=t[i]||t;else{if((u=l[s])&&u[0]===y&&u[1]===o)return h[2]=u[2];if(l[s]=h,h[2]=e(t,n,c))return!0}return!1}}function fe(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function pe(e,t,n,i,r){for(var s,a=[],o=0,c=e.length,u=null!=t;o<c;o++)(s=e[o])&&(n&&!n(s,i,r)||(a.push(s),u&&t.push(o)));return a}function ge(e,t,n,i,r,s){return i&&!i[v]&&(i=ge(i)),r&&!r[v]&&(r=ge(r,s)),te((function(s,a,o,c){var u,h,d,f,p=[],m=[],v=a.length,y=s||function(e,t,n){for(var i=0,r=t.length;i<r;i++)Q(e,t[i],n);return n}(t||"*",o.nodeType?[o]:o,[]),b=!e||!s&&t?y:pe(y,p,e,o,c);if(n?n(b,f=r||(s?e:v||i)?[]:a,o,c):f=b,i)for(u=pe(f,m),i(u,[],o,c),h=u.length;h--;)(d=u[h])&&(f[m[h]]=!(b[m[h]]=d));if(s){if(r||e){if(r){for(u=[],h=f.length;h--;)(d=f[h])&&u.push(b[h]=d);r(null,f=[],u,c)}for(h=f.length;h--;)(d=f[h])&&(u=r?l.call(s,d):p[h])>-1&&(s[u]=!(a[u]=d))}}else f=pe(f===a?f.splice(v,f.length):f),r?r(null,a,f,c):g.apply(a,f)}))}function me(e){for(var i,r,s,a=e.length,o=t.relative[e[0].type],c=o||t.relative[" "],u=o?1:0,h=de((function(e){return e===i}),c,!0),d=de((function(e){return l.call(i,e)>-1}),c,!0),f=[function(e,t,r){var s=!o&&(r||t!=n)||((i=t).nodeType?h(e,t,r):d(e,t,r));return i=null,s}];u<a;u++)if(r=t.relative[e[u].type])f=[de(fe(f),r)];else{if((r=t.filter[e[u].type].apply(null,e[u].matches))[v]){for(s=++u;s<a&&!t.relative[e[s].type];s++);return ge(u>1&&fe(f),u>1&&he(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(B,"$1"),r,u<s&&me(e.slice(u,s)),s<a&&me(e=e.slice(s)),s<a&&he(e))}f.push(r)}return fe(f)}function ve(e,i){var r,s=[],a=[],o=A[e+" "];if(!o){for(i||(i=le(e)),r=i.length;r--;)(o=me(i[r]))[v]?s.push(o):a.push(o);o=A(e,function(e,i){var r=i.length>0,s=e.length>0,a=function(a,o,u,l,d){var f,p,m,v=0,b="0",w=a&&[],E=[],A=n,x=a||s&&t.find.TAG("*",d),T=y+=null==A?1:Math.random()||.1,_=x.length;for(d&&(n=o==c||o||d);b!==_&&null!=(f=x[b]);b++){if(s&&f){for(p=0,o||f.ownerDocument==c||(ce(f),u=!h);m=e[p++];)if(m(f,o||c,u)){g.call(l,f);break}d&&(y=T)}r&&((f=!m&&f)&&v--,a&&w.push(f))}if(v+=b,r&&b!==v){for(p=0;m=i[p++];)m(w,E,o,u);if(a){if(v>0)for(;b--;)w[b]||E[b]||(E[b]=I.call(l));E=pe(E)}g.apply(l,E),d&&!a&&E.length>0&&v+i.length>1&&S.uniqueSort(l)}return d&&(y=T,n=A),w};return r?te(a):a}(a,s)),o.selector=e}return o}function ye(e,n,i,r){var s,a,o,c,u,l="function"==typeof e&&e,d=!r&&le(e=l.selector||e);if(i=i||[],1===d.length){if((a=d[0]=d[0].slice(0)).length>2&&"ID"===(o=a[0]).type&&9===n.nodeType&&h&&t.relative[a[1].type]){if(!(n=(t.find.ID(o.matches[0].replace(J,Y),n)||[])[0]))return i;l&&(n=n.parentNode),e=e.slice(a.shift().value.length)}for(s=W.needsContext.test(e)?0:a.length;s--&&(o=a[s],!t.relative[c=o.type]);)if((u=t.find[c])&&(r=u(o.matches[0].replace(J,Y),K.test(a[0].type)&&oe(n.parentNode)||n))){if(a.splice(s,1),!(e=r.length&&he(a)))return g.apply(i,r),i;break}}return(l||ve(e,d))(r,n,!h,i,!n||K.test(e)&&oe(n.parentNode)||n),i}ue.prototype=t.filters=t.pseudos,t.setFilters=new ue,m.sortStable=v.split("").sort(T).join("")===v,ce(),m.sortDetached=ne((function(e){return 1&e.compareDocumentPosition(c.createElement("fieldset"))})),S.find=Q,S.expr[":"]=S.expr.pseudos,S.unique=S.uniqueSort,Q.compile=ve,Q.select=ye,Q.setDocument=ce,Q.tokenize=le,Q.escape=S.escapeSelector,Q.getText=S.text,Q.isXML=S.isXMLDoc,Q.selectors=S.expr,Q.support=S.support,Q.uniqueSort=S.uniqueSort}();var L=function(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&S(e).is(n))break;i.push(e)}return i},j=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},U=S.expr.match.needsContext,F=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function $(e,t,n){return v(t)?S.grep(e,(function(e,i){return!!t.call(e,i,e)!==n})):t.nodeType?S.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?S.grep(e,(function(e){return l.call(t,e)>-1!==n})):S.filter(t,e,n)}S.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?S.find.matchesSelector(i,e)?[i]:[]:S.find.matches(e,S.grep(t,(function(e){return 1===e.nodeType})))},S.fn.extend({find:function(e){var t,n,i=this.length,r=this;if("string"!=typeof e)return this.pushStack(S(e).filter((function(){for(t=0;t<i;t++)if(S.contains(r[t],this))return!0})));for(n=this.pushStack([]),t=0;t<i;t++)S.find(e,r[t],n);return i>1?S.uniqueSort(n):n},filter:function(e){return this.pushStack($(this,e||[],!1))},not:function(e){return this.pushStack($(this,e||[],!0))},is:function(e){return!!$(this,"string"==typeof e&&U.test(e)?S(e):e||[],!1).length}});var q,H=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var i,r;if(!e)return this;if(n=n||q,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:H.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:b,!0)),F.test(i[1])&&S.isPlainObject(t))for(i in t)v(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(r=b.getElementById(i[2]))&&(this[0]=r,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,q=S(b);var W=/^(?:parents|prev(?:Until|All))/,V={children:!0,contents:!0,next:!0,prev:!0};function G(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0}))},closest:function(e,t){var n,i=0,r=this.length,s=[],a="string"!=typeof e&&S(e);if(!U.test(e))for(;i<r;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&S.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?S.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?l.call(S(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return L(e,"parentNode")},parentsUntil:function(e,t,n){return L(e,"parentNode",n)},next:function(e){return G(e,"nextSibling")},prev:function(e){return G(e,"previousSibling")},nextAll:function(e){return L(e,"nextSibling")},prevAll:function(e){return L(e,"previousSibling")},nextUntil:function(e,t,n){return L(e,"nextSibling",n)},prevUntil:function(e,t,n){return L(e,"previousSibling",n)},siblings:function(e){return j((e.parentNode||{}).firstChild,e)},children:function(e){return j(e.firstChild)},contents:function(e){return null!=e.contentDocument&&a(e.contentDocument)?e.contentDocument:(k(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},(function(e,t){S.fn[e]=function(n,i){var r=S.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=S.filter(i,r)),this.length>1&&(V[e]||S.uniqueSort(r),W.test(e)&&r.reverse()),this.pushStack(r)}}));var z=/[^\x20\t\r\n\f]+/g;function K(e){return e}function J(e){throw e}function Y(e,t,n,i){var r;try{e&&v(r=e.promise)?r.call(e).done(t).fail(n):e&&v(r=e.then)?r.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return S.each(e.match(z)||[],(function(e,n){t[n]=!0})),t}(e):S.extend({},e);var t,n,i,r,s=[],a=[],o=-1,c=function(){for(r=r||e.once,i=t=!0;a.length;o=-1)for(n=a.shift();++o<s.length;)!1===s[o].apply(n[0],n[1])&&e.stopOnFalse&&(o=s.length,n=!1);e.memory||(n=!1),t=!1,r&&(s=n?[]:"")},u={add:function(){return s&&(n&&!t&&(o=s.length-1,a.push(n)),function t(n){S.each(n,(function(n,i){v(i)?e.unique&&u.has(i)||s.push(i):i&&i.length&&"string"!==A(i)&&t(i)}))}(arguments),n&&!t&&c()),this},remove:function(){return S.each(arguments,(function(e,t){for(var n;(n=S.inArray(t,s,n))>-1;)s.splice(n,1),n<=o&&o--})),this},has:function(e){return e?S.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=a=[],s=n="",this},disabled:function(){return!s},lock:function(){return r=a=[],n||t||(s=n=""),this},locked:function(){return!!r},fireWith:function(e,n){return r||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||c()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},S.extend({Deferred:function(e){var t=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],n="pending",r={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return S.Deferred((function(n){S.each(t,(function(t,i){var r=v(e[i[4]])&&e[i[4]];s[i[1]]((function(){var e=r&&r.apply(this,arguments);e&&v(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,r?[e]:arguments)}))})),e=null})).promise()},then:function(e,n,r){var s=0;function a(e,t,n,r){return function(){var o=this,c=arguments,u=function(){var i,u;if(!(e<s)){if((i=n.apply(o,c))===t.promise())throw new TypeError("Thenable self-resolution");u=i&&("object"==typeof i||"function"==typeof i)&&i.then,v(u)?r?u.call(i,a(s,t,K,r),a(s,t,J,r)):(s++,u.call(i,a(s,t,K,r),a(s,t,J,r),a(s,t,K,t.notifyWith))):(n!==K&&(o=void 0,c=[i]),(r||t.resolveWith)(o,c))}},l=r?u:function(){try{u()}catch(i){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(i,l.error),e+1>=s&&(n!==J&&(o=void 0,c=[i]),t.rejectWith(o,c))}};e?l():(S.Deferred.getErrorHook?l.error=S.Deferred.getErrorHook():S.Deferred.getStackHook&&(l.error=S.Deferred.getStackHook()),i.setTimeout(l))}}return S.Deferred((function(i){t[0][3].add(a(0,i,v(r)?r:K,i.notifyWith)),t[1][3].add(a(0,i,v(e)?e:K)),t[2][3].add(a(0,i,v(n)?n:J))})).promise()},promise:function(e){return null!=e?S.extend(e,r):r}},s={};return S.each(t,(function(e,i){var a=i[2],o=i[5];r[i[1]]=a.add,o&&a.add((function(){n=o}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),a.add(i[3].fire),s[i[0]]=function(){return s[i[0]+"With"](this===s?void 0:this,arguments),this},s[i[0]+"With"]=a.fireWith})),r.promise(s),e&&e.call(s,s),s},when:function(e){var t=arguments.length,n=t,i=Array(n),r=o.call(arguments),s=S.Deferred(),a=function(e){return function(n){i[e]=this,r[e]=arguments.length>1?o.call(arguments):n,--t||s.resolveWith(i,r)}};if(t<=1&&(Y(e,s.done(a(n)).resolve,s.reject,!t),"pending"===s.state()||v(r[n]&&r[n].then)))return s.then();for(;n--;)Y(r[n],a(n),s.reject);return s.promise()}});var X=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&X.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){i.setTimeout((function(){throw e}))};var Z=S.Deferred();function Q(){b.removeEventListener("DOMContentLoaded",Q),i.removeEventListener("load",Q),S.ready()}S.fn.ready=function(e){return Z.then(e).catch((function(e){S.readyException(e)})),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0,!0!==e&&--S.readyWait>0||Z.resolveWith(b,[S]))}}),S.ready.then=Z.then,"complete"===b.readyState||"loading"!==b.readyState&&!b.documentElement.doScroll?i.setTimeout(S.ready):(b.addEventListener("DOMContentLoaded",Q),i.addEventListener("load",Q));var ee=function(e,t,n,i,r,s,a){var o=0,c=e.length,u=null==n;if("object"===A(n))for(o in r=!0,n)ee(e,t,o,n[o],!0,s,a);else if(void 0!==i&&(r=!0,v(i)||(a=!0),u&&(a?(t.call(e,i),t=null):(u=t,t=function(e,t,n){return u.call(S(e),n)})),t))for(;o<c;o++)t(e[o],n,a?i:i.call(e[o],o,t(e[o],n)));return r?e:u?t.call(e):c?t(e[0],n):s},te=/^-ms-/,ne=/-([a-z])/g;function ie(e,t){return t.toUpperCase()}function re(e){return e.replace(te,"ms-").replace(ne,ie)}var se=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function ae(){this.expando=S.expando+ae.uid++}ae.uid=1,ae.prototype={cache:function(e){var t=e[this.expando];return t||(t={},se(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,r=this.cache(e);if("string"==typeof t)r[re(t)]=n;else for(i in t)r[re(i)]=t[i];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][re(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(re):(t=re(t))in i?[t]:t.match(z)||[]).length;for(;n--;)delete i[t[n]]}(void 0===t||S.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var oe=new ae,ce=new ae,ue=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,le=/[A-Z]/g;function he(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(le,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ue.test(e)?JSON.parse(e):e)}(n)}catch(e){}ce.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return ce.hasData(e)||oe.hasData(e)},data:function(e,t,n){return ce.access(e,t,n)},removeData:function(e,t){ce.remove(e,t)},_data:function(e,t,n){return oe.access(e,t,n)},_removeData:function(e,t){oe.remove(e,t)}}),S.fn.extend({data:function(e,t){var n,i,r,s=this[0],a=s&&s.attributes;if(void 0===e){if(this.length&&(r=ce.get(s),1===s.nodeType&&!oe.get(s,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(i=a[n].name).indexOf("data-")&&(i=re(i.slice(5)),he(s,i,r[i]));oe.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each((function(){ce.set(this,e)})):ee(this,(function(t){var n;if(s&&void 0===t)return void 0!==(n=ce.get(s,e))||void 0!==(n=he(s,e))?n:void 0;this.each((function(){ce.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){ce.remove(this,e)}))}}),S.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=oe.get(e,t),n&&(!i||Array.isArray(n)?i=oe.access(e,t,S.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),i=n.length,r=n.shift(),s=S._queueHooks(e,t);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete s.stop,r.call(e,(function(){S.dequeue(e,t)}),s)),!i&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return oe.get(e,n)||oe.access(e,n,{empty:S.Callbacks("once memory").add((function(){oe.remove(e,[t+"queue",n])}))})}}),S.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?S.queue(this[0],e):void 0===t?this:this.each((function(){var n=S.queue(this,e,t);S._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&S.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){S.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,r=S.Deferred(),s=this,a=this.length,o=function(){--i||r.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=oe.get(s[a],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(o));return o(),r.promise(t)}});var de=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,fe=new RegExp("^(?:([+-])=|)("+de+")([a-z%]*)$","i"),pe=["Top","Right","Bottom","Left"],ge=b.documentElement,me=function(e){return S.contains(e.ownerDocument,e)},ve={composed:!0};ge.getRootNode&&(me=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(ve)===e.ownerDocument});var ye=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&me(e)&&"none"===S.css(e,"display")};function be(e,t,n,i){var r,s,a=20,o=i?function(){return i.cur()}:function(){return S.css(e,t,"")},c=o(),u=n&&n[3]||(S.cssNumber[t]?"":"px"),l=e.nodeType&&(S.cssNumber[t]||"px"!==u&&+c)&&fe.exec(S.css(e,t));if(l&&l[3]!==u){for(c/=2,u=u||l[3],l=+c||1;a--;)S.style(e,t,l+u),(1-s)*(1-(s=o()/c||.5))<=0&&(a=0),l/=s;l*=2,S.style(e,t,l+u),n=n||[]}return n&&(l=+l||+c||0,r=n[1]?l+(n[1]+1)*n[2]:+n[2],i&&(i.unit=u,i.start=l,i.end=r)),r}var we={};function Ee(e){var t,n=e.ownerDocument,i=e.nodeName,r=we[i];return r||(t=n.body.appendChild(n.createElement(i)),r=S.css(t,"display"),t.parentNode.removeChild(t),"none"===r&&(r="block"),we[i]=r,r)}function Ae(e,t){for(var n,i,r=[],s=0,a=e.length;s<a;s++)(i=e[s]).style&&(n=i.style.display,t?("none"===n&&(r[s]=oe.get(i,"display")||null,r[s]||(i.style.display="")),""===i.style.display&&ye(i)&&(r[s]=Ee(i))):"none"!==n&&(r[s]="none",oe.set(i,"display",n)));for(s=0;s<a;s++)null!=r[s]&&(e[s].style.display=r[s]);return e}S.fn.extend({show:function(){return Ae(this,!0)},hide:function(){return Ae(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ye(this)?S(this).show():S(this).hide()}))}});var xe,Te,Se=/^(?:checkbox|radio)$/i,_e=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ke=/^$|^module$|\/(?:java|ecma)script/i;xe=b.createDocumentFragment().appendChild(b.createElement("div")),(Te=b.createElement("input")).setAttribute("type","radio"),Te.setAttribute("checked","checked"),Te.setAttribute("name","t"),xe.appendChild(Te),m.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML="<option></option>",m.option=!!xe.lastChild;var Ie={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Ce(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&k(e,t)?S.merge([e],n):n}function De(e,t){for(var n=0,i=e.length;n<i;n++)oe.set(e[n],"globalEval",!t||oe.get(t[n],"globalEval"))}Ie.tbody=Ie.tfoot=Ie.colgroup=Ie.caption=Ie.thead,Ie.th=Ie.td,m.option||(Ie.optgroup=Ie.option=[1,"<select multiple='multiple'>","</select>"]);var Pe=/<|&#?\w+;/;function Be(e,t,n,i,r){for(var s,a,o,c,u,l,h=t.createDocumentFragment(),d=[],f=0,p=e.length;f<p;f++)if((s=e[f])||0===s)if("object"===A(s))S.merge(d,s.nodeType?[s]:s);else if(Pe.test(s)){for(a=a||h.appendChild(t.createElement("div")),o=(_e.exec(s)||["",""])[1].toLowerCase(),c=Ie[o]||Ie._default,a.innerHTML=c[1]+S.htmlPrefilter(s)+c[2],l=c[0];l--;)a=a.lastChild;S.merge(d,a.childNodes),(a=h.firstChild).textContent=""}else d.push(t.createTextNode(s));for(h.textContent="",f=0;s=d[f++];)if(i&&S.inArray(s,i)>-1)r&&r.push(s);else if(u=me(s),a=Ce(h.appendChild(s),"script"),u&&De(a),n)for(l=0;s=a[l++];)ke.test(s.type||"")&&n.push(s);return h}var Me=/^([^.]*)(?:\.(.+)|)/;function Re(){return!0}function Ne(){return!1}function Oe(e,t,n,i,r,s){var a,o;if("object"==typeof t){for(o in"string"!=typeof n&&(i=i||n,n=void 0),t)Oe(e,o,n,i,t[o],s);return e}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=Ne;else if(!r)return e;return 1===s&&(a=r,r=function(e){return S().off(e),a.apply(this,arguments)},r.guid=a.guid||(a.guid=S.guid++)),e.each((function(){S.event.add(this,t,r,i,n)}))}function Le(e,t,n){n?(oe.set(e,t,!1),S.event.add(e,t,{namespace:!1,handler:function(e){var n,i=oe.get(this,t);if(1&e.isTrigger&&this[t]){if(i)(S.event.special[t]||{}).delegateType&&e.stopPropagation();else if(i=o.call(arguments),oe.set(this,t,i),this[t](),n=oe.get(this,t),oe.set(this,t,!1),i!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else i&&(oe.set(this,t,S.event.trigger(i[0],i.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Re)}})):void 0===oe.get(e,t)&&S.event.add(e,t,Re)}S.event={global:{},add:function(e,t,n,i,r){var s,a,o,c,u,l,h,d,f,p,g,m=oe.get(e);if(se(e))for(n.handler&&(n=(s=n).handler,r=s.selector),r&&S.find.matchesSelector(ge,r),n.guid||(n.guid=S.guid++),(c=m.events)||(c=m.events=Object.create(null)),(a=m.handle)||(a=m.handle=function(t){return void 0!==S&&S.event.triggered!==t.type?S.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(z)||[""]).length;u--;)f=g=(o=Me.exec(t[u])||[])[1],p=(o[2]||"").split(".").sort(),f&&(h=S.event.special[f]||{},f=(r?h.delegateType:h.bindType)||f,h=S.event.special[f]||{},l=S.extend({type:f,origType:g,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&S.expr.match.needsContext.test(r),namespace:p.join(".")},s),(d=c[f])||((d=c[f]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,i,p,a)||e.addEventListener&&e.addEventListener(f,a)),h.add&&(h.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,l):d.push(l),S.event.global[f]=!0)},remove:function(e,t,n,i,r){var s,a,o,c,u,l,h,d,f,p,g,m=oe.hasData(e)&&oe.get(e);if(m&&(c=m.events)){for(u=(t=(t||"").match(z)||[""]).length;u--;)if(f=g=(o=Me.exec(t[u])||[])[1],p=(o[2]||"").split(".").sort(),f){for(h=S.event.special[f]||{},d=c[f=(i?h.delegateType:h.bindType)||f]||[],o=o[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=d.length;s--;)l=d[s],!r&&g!==l.origType||n&&n.guid!==l.guid||o&&!o.test(l.namespace)||i&&i!==l.selector&&("**"!==i||!l.selector)||(d.splice(s,1),l.selector&&d.delegateCount--,h.remove&&h.remove.call(e,l));a&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,p,m.handle)||S.removeEvent(e,f,m.handle),delete c[f])}else for(f in c)S.event.remove(e,f+t[u],n,i,!0);S.isEmptyObject(c)&&oe.remove(e,"handle events")}},dispatch:function(e){var t,n,i,r,s,a,o=new Array(arguments.length),c=S.event.fix(e),u=(oe.get(this,"events")||Object.create(null))[c.type]||[],l=S.event.special[c.type]||{};for(o[0]=c,t=1;t<arguments.length;t++)o[t]=arguments[t];if(c.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,c)){for(a=S.event.handlers.call(this,c,u),t=0;(r=a[t++])&&!c.isPropagationStopped();)for(c.currentTarget=r.elem,n=0;(s=r.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==s.namespace&&!c.rnamespace.test(s.namespace)||(c.handleObj=s,c.data=s.data,void 0!==(i=((S.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,o))&&!1===(c.result=i)&&(c.preventDefault(),c.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,i,r,s,a,o=[],c=t.delegateCount,u=e.target;if(c&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(s=[],a={},n=0;n<c;n++)void 0===a[r=(i=t[n]).selector+" "]&&(a[r]=i.needsContext?S(r,this).index(u)>-1:S.find(r,this,null,[u]).length),a[r]&&s.push(i);s.length&&o.push({elem:u,handlers:s})}return u=this,c<t.length&&o.push({elem:u,handlers:t.slice(c)}),o},addProp:function(e,t){Object.defineProperty(S.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return Se.test(t.type)&&t.click&&k(t,"input")&&Le(t,"click",!0),!1},trigger:function(e){var t=this||e;return Se.test(t.type)&&t.click&&k(t,"input")&&Le(t,"click"),!0},_default:function(e){var t=e.target;return Se.test(t.type)&&t.click&&k(t,"input")&&oe.get(t,"click")||k(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Re:Ne,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Ne,isPropagationStopped:Ne,isImmediatePropagationStopped:Ne,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Re,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Re,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Re,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},(function(e,t){function n(e){if(b.documentMode){var n=oe.get(this,"handle"),i=S.event.fix(e);i.type="focusin"===e.type?"focus":"blur",i.isSimulated=!0,n(e),i.target===i.currentTarget&&n(i)}else S.event.simulate(t,e.target,S.event.fix(e))}S.event.special[e]={setup:function(){var i;if(Le(this,e,!0),!b.documentMode)return!1;(i=oe.get(this,t))||this.addEventListener(t,n),oe.set(this,t,(i||0)+1)},trigger:function(){return Le(this,e),!0},teardown:function(){var e;if(!b.documentMode)return!1;(e=oe.get(this,t)-1)?oe.set(this,t,e):(this.removeEventListener(t,n),oe.remove(this,t))},_default:function(t){return oe.get(t.target,e)},delegateType:t},S.event.special[t]={setup:function(){var i=this.ownerDocument||this.document||this,r=b.documentMode?this:i,s=oe.get(r,t);s||(b.documentMode?this.addEventListener(t,n):i.addEventListener(e,n,!0)),oe.set(r,t,(s||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,r=b.documentMode?this:i,s=oe.get(r,t)-1;s?oe.set(r,t,s):(b.documentMode?this.removeEventListener(t,n):i.removeEventListener(e,n,!0),oe.remove(r,t))}}})),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){S.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=e.relatedTarget,r=e.handleObj;return i&&(i===this||S.contains(this,i))||(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}})),S.fn.extend({on:function(e,t,n,i){return Oe(this,e,t,n,i)},one:function(e,t,n,i){return Oe(this,e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,S(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ne),this.each((function(){S.event.remove(this,e,n,t)}))}});var je=/<script|<style|<link/i,Ue=/checked\s*(?:[^=]|=\s*.checked.)/i,Fe=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function $e(e,t){return k(e,"table")&&k(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function qe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function He(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function We(e,t){var n,i,r,s,a,o;if(1===t.nodeType){if(oe.hasData(e)&&(o=oe.get(e).events))for(r in oe.remove(t,"handle events"),o)for(n=0,i=o[r].length;n<i;n++)S.event.add(t,r,o[r][n]);ce.hasData(e)&&(s=ce.access(e),a=S.extend({},s),ce.set(t,a))}}function Ve(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Se.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Ge(e,t,n,i){t=c(t);var r,s,a,o,u,l,h=0,d=e.length,f=d-1,p=t[0],g=v(p);if(g||d>1&&"string"==typeof p&&!m.checkClone&&Ue.test(p))return e.each((function(r){var s=e.eq(r);g&&(t[0]=p.call(this,r,s.html())),Ge(s,t,n,i)}));if(d&&(s=(r=Be(t,e[0].ownerDocument,!1,e,i)).firstChild,1===r.childNodes.length&&(r=s),s||i)){for(o=(a=S.map(Ce(r,"script"),qe)).length;h<d;h++)u=r,h!==f&&(u=S.clone(u,!0,!0),o&&S.merge(a,Ce(u,"script"))),n.call(e[h],u,h);if(o)for(l=a[a.length-1].ownerDocument,S.map(a,He),h=0;h<o;h++)u=a[h],ke.test(u.type||"")&&!oe.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):E(u.textContent.replace(Fe,""),u,l))}return e}function ze(e,t,n){for(var i,r=t?S.filter(t,e):e,s=0;null!=(i=r[s]);s++)n||1!==i.nodeType||S.cleanData(Ce(i)),i.parentNode&&(n&&me(i)&&De(Ce(i,"script")),i.parentNode.removeChild(i));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var i,r,s,a,o=e.cloneNode(!0),c=me(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=Ce(o),i=0,r=(s=Ce(e)).length;i<r;i++)Ve(s[i],a[i]);if(t)if(n)for(s=s||Ce(e),a=a||Ce(o),i=0,r=s.length;i<r;i++)We(s[i],a[i]);else We(e,o);return(a=Ce(o,"script")).length>0&&De(a,!c&&Ce(e,"script")),o},cleanData:function(e){for(var t,n,i,r=S.event.special,s=0;void 0!==(n=e[s]);s++)if(se(n)){if(t=n[oe.expando]){if(t.events)for(i in t.events)r[i]?S.event.remove(n,i):S.removeEvent(n,i,t.handle);n[oe.expando]=void 0}n[ce.expando]&&(n[ce.expando]=void 0)}}}),S.fn.extend({detach:function(e){return ze(this,e,!0)},remove:function(e){return ze(this,e)},text:function(e){return ee(this,(function(e){return void 0===e?S.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Ge(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||$e(this,e).appendChild(e)}))},prepend:function(){return Ge(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=$e(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Ge(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Ge(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(Ce(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return S.clone(this,e,t)}))},html:function(e){return ee(this,(function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!je.test(e)&&!Ie[(_e.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(Ce(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Ge(this,arguments,(function(t){var n=this.parentNode;S.inArray(this,e)<0&&(S.cleanData(Ce(this)),n&&n.replaceChild(t,this))}),e)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){S.fn[e]=function(e){for(var n,i=[],r=S(e),s=r.length-1,a=0;a<=s;a++)n=a===s?this:this.clone(!0),S(r[a])[t](n),u.apply(i,n.get());return this.pushStack(i)}}));var Ke=new RegExp("^("+de+")(?!px)[a-z%]+$","i"),Je=/^--/,Ye=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)},Xe=function(e,t,n){var i,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];for(r in i=n.call(e),t)e.style[r]=s[r];return i},Ze=new RegExp(pe.join("|"),"i");function Qe(e,t,n){var i,r,s,a,o=Je.test(t),c=e.style;return(n=n||Ye(e))&&(a=n.getPropertyValue(t)||n[t],o&&a&&(a=a.replace(B,"$1")||void 0),""!==a||me(e)||(a=S.style(e,t)),!m.pixelBoxStyles()&&Ke.test(a)&&Ze.test(t)&&(i=c.width,r=c.minWidth,s=c.maxWidth,c.minWidth=c.maxWidth=c.width=a,a=n.width,c.width=i,c.minWidth=r,c.maxWidth=s)),void 0!==a?a+"":a}function et(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ge.appendChild(u).appendChild(l);var e=i.getComputedStyle(l);n="1%"!==e.top,c=12===t(e.marginLeft),l.style.right="60%",a=36===t(e.right),r=36===t(e.width),l.style.position="absolute",s=12===t(l.offsetWidth/3),ge.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,s,a,o,c,u=b.createElement("div"),l=b.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(m,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),c},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,t,n,r;return null==o&&(e=b.createElement("table"),t=b.createElement("tr"),n=b.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",ge.appendChild(e).appendChild(t).appendChild(n),r=i.getComputedStyle(t),o=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,ge.removeChild(e)),o}}))}();var tt=["Webkit","Moz","ms"],nt=b.createElement("div").style,it={};function rt(e){var t=S.cssProps[e]||it[e];return t||(e in nt?e:it[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=tt.length;n--;)if((e=tt[n]+t)in nt)return e}(e)||e)}var st=/^(none|table(?!-c[ea]).+)/,at={position:"absolute",visibility:"hidden",display:"block"},ot={letterSpacing:"0",fontWeight:"400"};function ct(e,t,n){var i=fe.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function ut(e,t,n,i,r,s){var a="width"===t?1:0,o=0,c=0,u=0;if(n===(i?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+pe[a],!0,r)),i?("content"===n&&(c-=S.css(e,"padding"+pe[a],!0,r)),"margin"!==n&&(c-=S.css(e,"border"+pe[a]+"Width",!0,r))):(c+=S.css(e,"padding"+pe[a],!0,r),"padding"!==n?c+=S.css(e,"border"+pe[a]+"Width",!0,r):o+=S.css(e,"border"+pe[a]+"Width",!0,r));return!i&&s>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-c-o-.5))||0),c+u}function lt(e,t,n){var i=Ye(e),r=(!m.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=r,a=Qe(e,t,i),o="offset"+t[0].toUpperCase()+t.slice(1);if(Ke.test(a)){if(!n)return a;a="auto"}return(!m.boxSizingReliable()&&r||!m.reliableTrDimensions()&&k(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,i))&&e.getClientRects().length&&(r="border-box"===S.css(e,"boxSizing",!1,i),(s=o in e)&&(a=e[o])),(a=parseFloat(a)||0)+ut(e,t,n||(r?"border":"content"),s,i,a)+"px"}function ht(e,t,n,i,r){return new ht.prototype.init(e,t,n,i,r)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Qe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,s,a,o=re(t),c=Je.test(t),u=e.style;if(c||(t=rt(o)),a=S.cssHooks[t]||S.cssHooks[o],void 0===n)return a&&"get"in a&&void 0!==(r=a.get(e,!1,i))?r:u[t];"string"===(s=typeof n)&&(r=fe.exec(n))&&r[1]&&(n=be(e,t,r),s="number"),null!=n&&n==n&&("number"!==s||c||(n+=r&&r[3]||(S.cssNumber[o]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,i))||(c?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,i){var r,s,a,o=re(t);return Je.test(t)||(t=rt(o)),(a=S.cssHooks[t]||S.cssHooks[o])&&"get"in a&&(r=a.get(e,!0,n)),void 0===r&&(r=Qe(e,t,i)),"normal"===r&&t in ot&&(r=ot[t]),""===n||n?(s=parseFloat(r),!0===n||isFinite(s)?s||0:r):r}}),S.each(["height","width"],(function(e,t){S.cssHooks[t]={get:function(e,n,i){if(n)return!st.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?lt(e,t,i):Xe(e,at,(function(){return lt(e,t,i)}))},set:function(e,n,i){var r,s=Ye(e),a=!m.scrollboxSize()&&"absolute"===s.position,o=(a||i)&&"border-box"===S.css(e,"boxSizing",!1,s),c=i?ut(e,t,i,o,s):0;return o&&a&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(s[t])-ut(e,t,"border",!1,s)-.5)),c&&(r=fe.exec(n))&&"px"!==(r[3]||"px")&&(e.style[t]=n,n=S.css(e,t)),ct(0,n,c)}}})),S.cssHooks.marginLeft=et(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Qe(e,"marginLeft"))||e.getBoundingClientRect().left-Xe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),S.each({margin:"",padding:"",border:"Width"},(function(e,t){S.cssHooks[e+t]={expand:function(n){for(var i=0,r={},s="string"==typeof n?n.split(" "):[n];i<4;i++)r[e+pe[i]+t]=s[i]||s[i-2]||s[0];return r}},"margin"!==e&&(S.cssHooks[e+t].set=ct)})),S.fn.extend({css:function(e,t){return ee(this,(function(e,t,n){var i,r,s={},a=0;if(Array.isArray(t)){for(i=Ye(e),r=t.length;a<r;a++)s[t[a]]=S.css(e,t[a],!1,i);return s}return void 0!==n?S.style(e,t,n):S.css(e,t)}),e,t,arguments.length>1)}}),S.Tween=ht,ht.prototype={constructor:ht,init:function(e,t,n,i,r,s){this.elem=e,this.prop=n,this.easing=r||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=s||(S.cssNumber[n]?"":"px")},cur:function(){var e=ht.propHooks[this.prop];return e&&e.get?e.get(this):ht.propHooks._default.get(this)},run:function(e){var t,n=ht.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ht.propHooks._default.set(this),this}},ht.prototype.init.prototype=ht.prototype,ht.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[rt(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}},ht.propHooks.scrollTop=ht.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=ht.prototype.init,S.fx.step={};var dt,ft,pt=/^(?:toggle|show|hide)$/,gt=/queueHooks$/;function mt(){ft&&(!1===b.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(mt):i.setTimeout(mt,S.fx.interval),S.fx.tick())}function vt(){return i.setTimeout((function(){dt=void 0})),dt=Date.now()}function yt(e,t){var n,i=0,r={height:e};for(t=t?1:0;i<4;i+=2-t)r["margin"+(n=pe[i])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function bt(e,t,n){for(var i,r=(wt.tweeners[t]||[]).concat(wt.tweeners["*"]),s=0,a=r.length;s<a;s++)if(i=r[s].call(n,t,e))return i}function wt(e,t,n){var i,r,s=0,a=wt.prefilters.length,o=S.Deferred().always((function(){delete c.elem})),c=function(){if(r)return!1;for(var t=dt||vt(),n=Math.max(0,u.startTime+u.duration-t),i=1-(n/u.duration||0),s=0,a=u.tweens.length;s<a;s++)u.tweens[s].run(i);return o.notifyWith(e,[u,i,n]),i<1&&a?n:(a||o.notifyWith(e,[u,1,0]),o.resolveWith(e,[u]),!1)},u=o.promise({elem:e,props:S.extend({},t),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},n),originalProperties:t,originalOptions:n,startTime:dt||vt(),duration:n.duration,tweens:[],createTween:function(t,n){var i=S.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(i),i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(r)return this;for(r=!0;n<i;n++)u.tweens[n].run(1);return t?(o.notifyWith(e,[u,1,0]),o.resolveWith(e,[u,t])):o.rejectWith(e,[u,t]),this}}),l=u.props;for(!function(e,t){var n,i,r,s,a;for(n in e)if(r=t[i=re(n)],s=e[n],Array.isArray(s)&&(r=s[1],s=e[n]=s[0]),n!==i&&(e[i]=s,delete e[n]),(a=S.cssHooks[i])&&"expand"in a)for(n in s=a.expand(s),delete e[i],s)n in e||(e[n]=s[n],t[n]=r);else t[i]=r}(l,u.opts.specialEasing);s<a;s++)if(i=wt.prefilters[s].call(u,e,l,u.opts))return v(i.stop)&&(S._queueHooks(u.elem,u.opts.queue).stop=i.stop.bind(i)),i;return S.map(l,bt,u),v(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),S.fx.timer(S.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u}S.Animation=S.extend(wt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return be(n.elem,e,fe.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(z);for(var n,i=0,r=e.length;i<r;i++)n=e[i],wt.tweeners[n]=wt.tweeners[n]||[],wt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,r,s,a,o,c,u,l,h="width"in t||"height"in t,d=this,f={},p=e.style,g=e.nodeType&&ye(e),m=oe.get(e,"fxshow");for(i in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,o=a.empty.fire,a.empty.fire=function(){a.unqueued||o()}),a.unqueued++,d.always((function(){d.always((function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()}))}))),t)if(r=t[i],pt.test(r)){if(delete t[i],s=s||"toggle"===r,r===(g?"hide":"show")){if("show"!==r||!m||void 0===m[i])continue;g=!0}f[i]=m&&m[i]||S.style(e,i)}if((c=!S.isEmptyObject(t))||!S.isEmptyObject(f))for(i in h&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(u=m&&m.display)&&(u=oe.get(e,"display")),"none"===(l=S.css(e,"display"))&&(u?l=u:(Ae([e],!0),u=e.style.display||u,l=S.css(e,"display"),Ae([e]))),("inline"===l||"inline-block"===l&&null!=u)&&"none"===S.css(e,"float")&&(c||(d.done((function(){p.display=u})),null==u&&(l=p.display,u="none"===l?"":l)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",d.always((function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}))),c=!1,f)c||(m?"hidden"in m&&(g=m.hidden):m=oe.access(e,"fxshow",{display:u}),s&&(m.hidden=!g),g&&Ae([e],!0),d.done((function(){for(i in g||Ae([e]),oe.remove(e,"fxshow"),f)S.style(e,i,f[i])}))),c=bt(g?m[i]:0,i,d),i in m||(m[i]=c.start,g&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?wt.prefilters.unshift(e):wt.prefilters.push(e)}}),S.speed=function(e,t,n){var i=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return S.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in S.fx.speeds?i.duration=S.fx.speeds[i.duration]:i.duration=S.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){v(i.old)&&i.old.call(this),i.queue&&S.dequeue(this,i.queue)},i},S.fn.extend({fadeTo:function(e,t,n,i){return this.filter(ye).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=S.isEmptyObject(e),s=S.speed(t,n,i),a=function(){var t=wt(this,S.extend({},e),s);(r||oe.get(this,"finish"))&&t.stop(!0)};return a.finish=a,r||!1===s.queue?this.each(a):this.queue(s.queue,a)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,r=null!=e&&e+"queueHooks",s=S.timers,a=oe.get(this);if(r)a[r]&&a[r].stop&&i(a[r]);else for(r in a)a[r]&&a[r].stop&&gt.test(r)&&i(a[r]);for(r=s.length;r--;)s[r].elem!==this||null!=e&&s[r].queue!==e||(s[r].anim.stop(n),t=!1,s.splice(r,1));!t&&n||S.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=oe.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],s=S.timers,a=i?i.length:0;for(n.finish=!0,S.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<a;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish}))}}),S.each(["toggle","show","hide"],(function(e,t){var n=S.fn[t];S.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(yt(t,!0),e,i,r)}})),S.each({slideDown:yt("show"),slideUp:yt("hide"),slideToggle:yt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){S.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}})),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(dt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),dt=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){ft||(ft=!0,mt())},S.fx.stop=function(){ft=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(e,t){return e=S.fx&&S.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,n){var r=i.setTimeout(t,e);n.stop=function(){i.clearTimeout(r)}}))},function(){var e=b.createElement("input"),t=b.createElement("select").appendChild(b.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=b.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var Et,At=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return ee(this,S.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){S.removeAttr(this,e)}))}}),S.extend({attr:function(e,t,n){var i,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?S.prop(e,t,n):(1===s&&S.isXMLDoc(e)||(r=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?Et:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):r&&"get"in r&&null!==(i=r.get(e,t))?i:null==(i=S.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&k(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,i=0,r=t&&t.match(z);if(r&&1===e.nodeType)for(;n=r[i++];)e.removeAttribute(n)}}),Et={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=At[t]||S.find.attr;At[t]=function(e,t,i){var r,s,a=t.toLowerCase();return i||(s=At[a],At[a]=r,r=null!=n(e,t,i)?a:null,At[a]=s),r}}));var xt=/^(?:input|select|textarea|button)$/i,Tt=/^(?:a|area)$/i;function St(e){return(e.match(z)||[]).join(" ")}function _t(e){return e.getAttribute&&e.getAttribute("class")||""}function kt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(z)||[]}S.fn.extend({prop:function(e,t){return ee(this,S.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[S.propFix[e]||e]}))}}),S.extend({prop:function(e,t,n){var i,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&S.isXMLDoc(e)||(t=S.propFix[t]||t,r=S.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):xt.test(e.nodeName)||Tt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){S.propFix[this.toLowerCase()]=this})),S.fn.extend({addClass:function(e){var t,n,i,r,s,a;return v(e)?this.each((function(t){S(this).addClass(e.call(this,t,_t(this)))})):(t=kt(e)).length?this.each((function(){if(i=_t(this),n=1===this.nodeType&&" "+St(i)+" "){for(s=0;s<t.length;s++)r=t[s],n.indexOf(" "+r+" ")<0&&(n+=r+" ");a=St(n),i!==a&&this.setAttribute("class",a)}})):this},removeClass:function(e){var t,n,i,r,s,a;return v(e)?this.each((function(t){S(this).removeClass(e.call(this,t,_t(this)))})):arguments.length?(t=kt(e)).length?this.each((function(){if(i=_t(this),n=1===this.nodeType&&" "+St(i)+" "){for(s=0;s<t.length;s++)for(r=t[s];n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");a=St(n),i!==a&&this.setAttribute("class",a)}})):this:this.attr("class","")},toggleClass:function(e,t){var n,i,r,s,a=typeof e,o="string"===a||Array.isArray(e);return v(e)?this.each((function(n){S(this).toggleClass(e.call(this,n,_t(this),t),t)})):"boolean"==typeof t&&o?t?this.addClass(e):this.removeClass(e):(n=kt(e),this.each((function(){if(o)for(s=S(this),r=0;r<n.length;r++)i=n[r],s.hasClass(i)?s.removeClass(i):s.addClass(i);else void 0!==e&&"boolean"!==a||((i=_t(this))&&oe.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===e?"":oe.get(this,"__className__")||""))})))},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+St(_t(n))+" ").indexOf(t)>-1)return!0;return!1}});var It=/\r/g;S.fn.extend({val:function(e){var t,n,i,r=this[0];return arguments.length?(i=v(e),this.each((function(n){var r;1===this.nodeType&&(null==(r=i?e.call(this,n,S(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=S.map(r,(function(e){return null==e?"":e+""}))),(t=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))}))):r?(t=S.valHooks[r.type]||S.valHooks[r.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(r,"value"))?n:"string"==typeof(n=r.value)?n.replace(It,""):null==n?"":n:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:St(S.text(e))}},select:{get:function(e){var t,n,i,r=e.options,s=e.selectedIndex,a="select-one"===e.type,o=a?null:[],c=a?s+1:r.length;for(i=s<0?c:a?s:0;i<c;i++)if(((n=r[i]).selected||i===s)&&!n.disabled&&(!n.parentNode.disabled||!k(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;o.push(t)}return o},set:function(e,t){for(var n,i,r=e.options,s=S.makeArray(t),a=r.length;a--;)((i=r[a]).selected=S.inArray(S.valHooks.option.get(i),s)>-1)&&(n=!0);return n||(e.selectedIndex=-1),s}}}}),S.each(["radio","checkbox"],(function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=S.inArray(S(e).val(),t)>-1}},m.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}));var Ct=i.location,Dt={guid:Date.now()},Pt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Bt=/^(?:focusinfocus|focusoutblur)$/,Mt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var s,a,o,c,u,l,h,d,p=[n||b],g=f.call(e,"type")?e.type:e,m=f.call(e,"namespace")?e.namespace.split("."):[];if(a=d=o=n=n||b,3!==n.nodeType&&8!==n.nodeType&&!Bt.test(g+S.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),u=g.indexOf(":")<0&&"on"+g,(e=e[S.expando]?e:new S.Event(g,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),h=S.event.special[g]||{},r||!h.trigger||!1!==h.trigger.apply(n,t))){if(!r&&!h.noBubble&&!y(n)){for(c=h.delegateType||g,Bt.test(c+g)||(a=a.parentNode);a;a=a.parentNode)p.push(a),o=a;o===(n.ownerDocument||b)&&p.push(o.defaultView||o.parentWindow||i)}for(s=0;(a=p[s++])&&!e.isPropagationStopped();)d=a,e.type=s>1?c:h.bindType||g,(l=(oe.get(a,"events")||Object.create(null))[e.type]&&oe.get(a,"handle"))&&l.apply(a,t),(l=u&&a[u])&&l.apply&&se(a)&&(e.result=l.apply(a,t),!1===e.result&&e.preventDefault());return e.type=g,r||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(p.pop(),t)||!se(n)||u&&v(n[g])&&!y(n)&&((o=n[u])&&(n[u]=null),S.event.triggered=g,e.isPropagationStopped()&&d.addEventListener(g,Mt),n[g](),e.isPropagationStopped()&&d.removeEventListener(g,Mt),S.event.triggered=void 0,o&&(n[u]=o)),e.result}},simulate:function(e,t,n){var i=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(i,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each((function(){S.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}});var Rt=/\[\]$/,Nt=/\r?\n/g,Ot=/^(?:submit|button|image|reset|file)$/i,Lt=/^(?:input|select|textarea|keygen)/i;function jt(e,t,n,i){var r;if(Array.isArray(t))S.each(t,(function(t,r){n||Rt.test(e)?i(e,r):jt(e+"["+("object"==typeof r&&null!=r?t:"")+"]",r,n,i)}));else if(n||"object"!==A(t))i(e,t);else for(r in t)jt(e+"["+r+"]",t[r],n,i)}S.param=function(e,t){var n,i=[],r=function(e,t){var n=v(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,(function(){r(this.name,this.value)}));else for(n in e)jt(n,e[n],t,r);return i.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&Lt.test(this.nodeName)&&!Ot.test(e)&&(this.checked||!Se.test(e))})).map((function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,(function(e){return{name:t.name,value:e.replace(Nt,"\r\n")}})):{name:t.name,value:n.replace(Nt,"\r\n")}})).get()}});var Ut=/%20/g,Ft=/#.*$/,$t=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ht=/^(?:GET|HEAD)$/,Wt=/^\/\//,Vt={},Gt={},zt="*/".concat("*"),Kt=b.createElement("a");function Jt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,s=t.toLowerCase().match(z)||[];if(v(n))for(;i=s[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function Yt(e,t,n,i){var r={},s=e===Gt;function a(o){var c;return r[o]=!0,S.each(e[o]||[],(function(e,o){var u=o(t,n,i);return"string"!=typeof u||s||r[u]?s?!(c=u):void 0:(t.dataTypes.unshift(u),a(u),!1)})),c}return a(t.dataTypes[0])||!r["*"]&&a("*")}function Xt(e,t){var n,i,r=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i||(i={}))[n]=t[n]);return i&&S.extend(!0,e,i),e}Kt.href=Ct.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Xt(Xt(e,S.ajaxSettings),t):Xt(S.ajaxSettings,e)},ajaxPrefilter:Jt(Vt),ajaxTransport:Jt(Gt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,s,a,o,c,u,l,h,d,f=S.ajaxSetup({},t),p=f.context||f,g=f.context&&(p.nodeType||p.jquery)?S(p):S.event,m=S.Deferred(),v=S.Callbacks("once memory"),y=f.statusCode||{},w={},E={},A="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(u){if(!a)for(a={};t=qt.exec(s);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?s:null},setRequestHeader:function(e,t){return null==u&&(e=E[e.toLowerCase()]=E[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==u&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)x.always(e[x.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||A;return n&&n.abort(t),T(0,t),this}};if(m.promise(x),f.url=((e||f.url||Ct.href)+"").replace(Wt,Ct.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(z)||[""],null==f.crossDomain){c=b.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Kt.protocol+"//"+Kt.host!=c.protocol+"//"+c.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=S.param(f.data,f.traditional)),Yt(Vt,f,t,x),u)return x;for(h in(l=S.event&&f.global)&&0==S.active++&&S.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Ht.test(f.type),r=f.url.replace(Ft,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Ut,"+")):(d=f.url.slice(r.length),f.data&&(f.processData||"string"==typeof f.data)&&(r+=(Pt.test(r)?"&":"?")+f.data,delete f.data),!1===f.cache&&(r=r.replace($t,"$1"),d=(Pt.test(r)?"&":"?")+"_="+Dt.guid+++d),f.url=r+d),f.ifModified&&(S.lastModified[r]&&x.setRequestHeader("If-Modified-Since",S.lastModified[r]),S.etag[r]&&x.setRequestHeader("If-None-Match",S.etag[r])),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&x.setRequestHeader("Content-Type",f.contentType),x.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+zt+"; q=0.01":""):f.accepts["*"]),f.headers)x.setRequestHeader(h,f.headers[h]);if(f.beforeSend&&(!1===f.beforeSend.call(p,x,f)||u))return x.abort();if(A="abort",v.add(f.complete),x.done(f.success),x.fail(f.error),n=Yt(Gt,f,t,x)){if(x.readyState=1,l&&g.trigger("ajaxSend",[x,f]),u)return x;f.async&&f.timeout>0&&(o=i.setTimeout((function(){x.abort("timeout")}),f.timeout));try{u=!1,n.send(w,T)}catch(e){if(u)throw e;T(-1,e)}}else T(-1,"No Transport");function T(e,t,a,c){var h,d,b,w,E,A=t;u||(u=!0,o&&i.clearTimeout(o),n=void 0,s=c||"",x.readyState=e>0?4:0,h=e>=200&&e<300||304===e,a&&(w=function(e,t,n){for(var i,r,s,a,o=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in o)if(o[r]&&o[r].test(i)){c.unshift(r);break}if(c[0]in n)s=c[0];else{for(r in n){if(!c[0]||e.converters[r+" "+c[0]]){s=r;break}a||(a=r)}s=s||a}if(s)return s!==c[0]&&c.unshift(s),n[s]}(f,x,a)),!h&&S.inArray("script",f.dataTypes)>-1&&S.inArray("json",f.dataTypes)<0&&(f.converters["text script"]=function(){}),w=function(e,t,n,i){var r,s,a,o,c,u={},l=e.dataTypes.slice();if(l[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(s=l.shift();s;)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!c&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=s,s=l.shift())if("*"===s)s=c;else if("*"!==c&&c!==s){if(!(a=u[c+" "+s]||u["* "+s]))for(r in u)if((o=r.split(" "))[1]===s&&(a=u[c+" "+o[0]]||u["* "+o[0]])){!0===a?a=u[r]:!0!==u[r]&&(s=o[0],l.unshift(o[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+c+" to "+s}}}return{state:"success",data:t}}(f,w,x,h),h?(f.ifModified&&((E=x.getResponseHeader("Last-Modified"))&&(S.lastModified[r]=E),(E=x.getResponseHeader("etag"))&&(S.etag[r]=E)),204===e||"HEAD"===f.type?A="nocontent":304===e?A="notmodified":(A=w.state,d=w.data,h=!(b=w.error))):(b=A,!e&&A||(A="error",e<0&&(e=0))),x.status=e,x.statusText=(t||A)+"",h?m.resolveWith(p,[d,A,x]):m.rejectWith(p,[x,A,b]),x.statusCode(y),y=void 0,l&&g.trigger(h?"ajaxSuccess":"ajaxError",[x,f,h?d:b]),v.fireWith(p,[x,A]),l&&(g.trigger("ajaxComplete",[x,f]),--S.active||S.event.trigger("ajaxStop")))}return x},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],(function(e,t){S[t]=function(e,n,i,r){return v(n)&&(r=r||i,i=n,n=void 0),S.ajax(S.extend({url:e,type:t,dataType:r,data:n,success:i},S.isPlainObject(e)&&e))}})),S.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){S(this).wrapInner(e.call(this,t))})):this.each((function(){var t=S(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(n){S(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){S(this).replaceWith(this.childNodes)})),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Zt={0:200,1223:204},Qt=S.ajaxSettings.xhr();m.cors=!!Qt&&"withCredentials"in Qt,m.ajax=Qt=!!Qt,S.ajaxTransport((function(e){var t,n;if(m.cors||Qt&&!e.crossDomain)return{send:function(r,s){var a,o=e.xhr();if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)o[a]=e.xhrFields[a];for(a in e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)o.setRequestHeader(a,r[a]);t=function(e){return function(){t&&(t=n=o.onload=o.onerror=o.onabort=o.ontimeout=o.onreadystatechange=null,"abort"===e?o.abort():"error"===e?"number"!=typeof o.status?s(0,"error"):s(o.status,o.statusText):s(Zt[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=t(),n=o.onerror=o.ontimeout=t("error"),void 0!==o.onabort?o.onabort=n:o.onreadystatechange=function(){4===o.readyState&&i.setTimeout((function(){t&&n()}))},t=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),S.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),S.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(i,r){t=S("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&r("error"===e.type?404:200,e.type)}),b.head.appendChild(t[0])},abort:function(){n&&n()}}}));var en,tn=[],nn=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tn.pop()||S.expando+"_"+Dt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",(function(e,t,n){var r,s,a,o=!1!==e.jsonp&&(nn.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&nn.test(e.data)&&"data");if(o||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(nn,"$1"+r):!1!==e.jsonp&&(e.url+=(Pt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return a||S.error(r+" was not called"),a[0]},e.dataTypes[0]="json",s=i[r],i[r]=function(){a=arguments},n.always((function(){void 0===s?S(i).removeProp(r):i[r]=s,e[r]&&(e.jsonpCallback=t.jsonpCallback,tn.push(r)),a&&v(s)&&s(a[0]),a=s=void 0})),"script"})),m.createHTMLDocument=((en=b.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===en.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((i=(t=b.implementation.createHTMLDocument("")).createElement("base")).href=b.location.href,t.head.appendChild(i)):t=b),s=!n&&[],(r=F.exec(e))?[t.createElement(r[1])]:(r=Be([e],t,s),s&&s.length&&S(s).remove(),S.merge([],r.childNodes)));var i,r,s},S.fn.load=function(e,t,n){var i,r,s,a=this,o=e.indexOf(" ");return o>-1&&(i=St(e.slice(o)),e=e.slice(0,o)),v(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),a.length>0&&S.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done((function(e){s=arguments,a.html(i?S("<div>").append(S.parseHTML(e)).find(i):e)})).always(n&&function(e,t){a.each((function(){n.apply(this,s||[e.responseText,t,e])}))}),this},S.expr.pseudos.animated=function(e){return S.grep(S.timers,(function(t){return e===t.elem})).length},S.offset={setOffset:function(e,t,n){var i,r,s,a,o,c,u=S.css(e,"position"),l=S(e),h={};"static"===u&&(e.style.position="relative"),o=l.offset(),s=S.css(e,"top"),c=S.css(e,"left"),("absolute"===u||"fixed"===u)&&(s+c).indexOf("auto")>-1?(a=(i=l.position()).top,r=i.left):(a=parseFloat(s)||0,r=parseFloat(c)||0),v(t)&&(t=t.call(e,n,S.extend({},o))),null!=t.top&&(h.top=t.top-o.top+a),null!=t.left&&(h.left=t.left-o.left+r),"using"in t?t.using.call(e,h):l.css(h)}},S.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){S.offset.setOffset(this,e,t)}));var t,n,i=this[0];return i?i.getClientRects().length?(t=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],r={top:0,left:0};if("fixed"===S.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((r=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),r.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-S.css(i,"marginTop",!0),left:t.left-r.left-S.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===S.css(e,"position");)e=e.offsetParent;return e||ge}))}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;S.fn[e]=function(i){return ee(this,(function(e,i,r){var s;if(y(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===r)return s?s[t]:e[i];s?s.scrollTo(n?s.pageXOffset:r,n?r:s.pageYOffset):e[i]=r}),e,i,arguments.length)}})),S.each(["top","left"],(function(e,t){S.cssHooks[t]=et(m.pixelPosition,(function(e,n){if(n)return n=Qe(e,t),Ke.test(n)?S(e).position()[t]+"px":n}))})),S.each({Height:"height",Width:"width"},(function(e,t){S.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,i){S.fn[i]=function(r,s){var a=arguments.length&&(n||"boolean"!=typeof r),o=n||(!0===r||!0===s?"margin":"border");return ee(this,(function(t,n,r){var s;return y(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===r?S.css(t,n,o):S.style(t,n,r,o)}),t,a?r:void 0,a)}}))})),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){S.fn[t]=function(e){return this.on(t,e)}})),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){S.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var rn=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,i,r;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return i=o.call(arguments,2),r=function(){return e.apply(t||this,i.concat(o.call(arguments)))},r.guid=e.guid=e.guid||S.guid++,r},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=k,S.isFunction=v,S.isWindow=y,S.camelCase=re,S.type=A,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(rn,"$1")},void 0===(n=function(){return S}.apply(t,[]))||(e.exports=n);var sn=i.jQuery,an=i.$;return S.noConflict=function(e){return i.$===S&&(i.$=an),e&&i.jQuery===S&&(i.jQuery=sn),S},void 0===r&&(i.jQuery=i.$=S),S}))},80614:(e,t)=>{(()=>{var e={"./src/MessagingSDK.ts":(e,t,n)=>{"use strict";n.r(t),n.d(t,{AppType:()=>y,INSTALLATION_ID_LOCAL_STORAGE_KEY:()=>x,MessagingSDK:()=>_,PIPELINE:()=>w});var i=n("./node_modules/uuid/dist/esm-browser/v4.js"),r=n("./node_modules/throttle-debounce/esm/index.js"),s=n("./node_modules/ua-parser-js/src/ua-parser.js"),a=n("./src/utils.ts"),o=n("./src/Store.ts"),c=["server_session_id"];function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(){d=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var s=t&&t.prototype instanceof b?t:b,a=Object.create(s.prototype),o=new B(i||[]);return r(a,"_invoke",{value:I(e,n,o)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",g="suspendedYield",m="executing",v="completed",y={};function b(){}function w(){}function E(){}var A={};l(A,a,(function(){return this}));var x=Object.getPrototypeOf,T=x&&x(x(M([])));T&&T!==n&&i.call(T,a)&&(A=T);var S=E.prototype=b.prototype=Object.create(A);function _(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(r,s,a,o){var c=f(e[r],e,s);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==u(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,o)}))}o(c.arg)}var s;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return s=s?s.then(r,r):r()}})}function I(t,n,i){var r=p;return function(s,a){if(r===m)throw Error("Generator is already running");if(r===v){if("throw"===s)throw a;return{value:e,done:!0}}for(i.method=s,i.arg=a;;){var o=i.delegate;if(o){var c=C(o,i);if(c){if(c===y)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===p)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var u=f(t,n,i);if("normal"===u.type){if(r=i.done?v:g,u.arg===y)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(r=v,i.method="throw",i.arg=u.arg)}}}function C(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),y;var s=f(r,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,y;var a=s.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function M(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(u(t)+" is not iterable")}return w.prototype=E,r(S,"constructor",{value:E,configurable:!0}),r(E,"constructor",{value:w,configurable:!0}),w.displayName=l(E,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,l(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},_(k.prototype),l(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,i,r,s){void 0===s&&(s=Promise);var a=new k(h(e,n,i,r),s);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(S),l(S,c,"Generator"),l(S,a,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=M,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return o.type="throw",o.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;P(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:M(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),y}},t}function f(e,t,n,i,r,s,a){try{var o=e[s](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,r)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var s=e.apply(t,n);function a(e){f(s,i,r,a,o,"next",e)}function o(e){f(s,i,r,a,o,"throw",e)}a(void 0)}))}}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,v(i.key),i)}}function m(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=u(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}var y=function(e){return e.Web="WEB",e.Extension="BROWSER_EXTENSION",e.Lib="LIB",e}({}),b=[408,429,500,502,503,504,507],w="holistic",E="messaging-sdk",A="msgError",x="RAKUTEN_INSTALLATION_ID",T="{regionId}";function S(e){return e.startsWith(E)}var _=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"config",void 0),m(this,"member",void 0),m(this,"timer",void 0),m(this,"uaParser",void 0),m(this,"isFlushInProgress",void 0),m(this,"isRetrying",void 0),m(this,"isFlushingTempStore",void 0),m(this,"throttleFlush",void 0),m(this,"started",!1),m(this,"window",void 0),m(this,"serverSessionId",void 0),m(this,"store",void 0),m(this,"tempMessageStore",[]),m(this,"clientAgent",void 0),m(this,"isPrivateBrowserSession",void 0),m(this,"errorLogger",(function(e){var n,i,r,s;null!==(n=t.window)&&void 0!==n&&null!==(n=n.DD_LOGS)&&void 0!==n&&null!==(n=n.logger)&&void 0!==n&&n.error?null===(i=t.window)||void 0===i||null===(i=i.DD_LOGS)||void 0===i||null===(i=i.logger)||void 0===i||null===(r=i.error)||void 0===r||r.call(i,A,{error:e},e):null===(s=console)||void 0===s||s.error(A,e)})),this.store=new o.default("rakuten",E),this.sendMessagesToMessageGateway=this.sendMessagesToMessageGateway.bind(this),this.flush=this.flush.bind(this),this.throttleFlush=(0,r.throttle)(1e3,this.flush)},t=[{key:"init",value:(P=p(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setConfig(t),this.clientAgent="".concat(this.config.hostApp.name,"/").concat(this.config.hostApp.version," (").concat(this.config.hostApp.type,") ").concat("messaging-sdk-js","/").concat("2.1.0"," (").concat(y.Lib,")"),this.window=(0,a.getWindow)(),this.uaParser=new s.UAParser(null===(n=this.window)||void 0===n||null===(n=n.navigator)||void 0===n?void 0:n.userAgent),e.next=6,(0,a.detectPrivateBrowserSession)();case 6:return this.isPrivateBrowserSession=e.sent,this.started=!0,e.next=10,this.flushTempStore();case 10:this.throttleFlush(),this.restartTimer();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"setRegion",value:function(e){this.config&&(this.config.regionId=e)}},{key:"setMember",value:function(e){if(e){var t=e.server_session_id,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,c);this.member=h({},n),this.serverSessionId=t}}},{key:"setConfig",value:function(e){var t=e;if(!e)throw new Error("Config missing when initializing MessagingSdk. Please `messagingSdkInstance.init(config)` with a valid Config");if(!e.invalidMessagesHandler)throw new Error("invalidMessagesHandler callback for rendering message failures must be supplied in the Config when `messagingSdkInstance.init(config)`");if(e.errorMessageLogger&&(this.errorLogger=e.errorMessageLogger),!e.networkConfig.regions)for(var n in t.networkConfig.regions={},e.networkConfig)if(n in e.networkConfig&&"genericRegionApiPath"!==n&&"regions"!==n){var i=e.networkConfig[n];i&&"object"===u(i)&&(t.networkConfig.regions[n]=i)}this.config=t}},{key:"apiUri",get:function(){var e,t=this.config,n=t.regionId,i=t.networkConfig,r=i.genericRegionApiPath,s=i.regions[n].messageGatewayBaseURL;return e=null!=r&&r.includes(T)?r.replace(T,n):"/message/v2/regions/{regionId}/messages/batch".replace(T,n),"".concat(s).concat(e)}},{key:"getDefaultPageProperties",value:function(){var e,t,n,i=new URL(null!==(e=null===(t=this.window)||void 0===t?void 0:t.location.href)&&void 0!==e?e:""),r=(0,a.getParentPath)(i.pathname),s=(0,a.getSearchParams)(),o=Object.fromEntries(s);return{url:i.href,host:i.host,path:i.pathname,title:null===(n=self.document)||void 0===n?void 0:n.title,parent_path:r,query_params:o}}},{key:"createMessage",value:function(e){var t,n,r=(0,i.default)(),s=null!==(t=e.visit_id)&&void 0!==t?t:this.getVisitID(),a=this.member,o=e.serverContext,c=this.started?this.getClientContext(e):null,u=e.schema_id,l=e.type,d=e.data,f=e.parentMessageId,p=Intl.DateTimeFormat().resolvedOptions().timeZone,g=(new Date).getTime(),m=null!==(n=null==e?void 0:e.sourceTimestampMillis)&&void 0!==n?n:g,v=this.started?this.config.hostApp:void 0,y=this.started?this.config.regionId:void 0,b=e.integration_data||void 0;return s||this.errorLogger("Visit ID is not found"),h({id:r,visit_id:s,member:a,server_context:o,client_context:c,schema_id:u,type:l,data:d,parentMessageId:f,source_time_zone:p,source_created_at_millis:g,source_timestamp_millis:m,issuer:v,region_id:y,integration_data:b},!this.started&&{partialMessage:e})}},{key:"getClientContext",value:function(e){var t,n,i,r={device:this.getDevice(),experiments:null==e?void 0:e.experiments,locale:null===(t=this.window)||void 0===t||null===(t=t.navigator)||void 0===t?void 0:t.language,server_session_id:null==this?void 0:this.serverSessionId,origin:this.getOrigin(e),referrer:null===(n=self.document)||void 0===n?void 0:n.referrer,installation_id:null!==(i=e.installation_id)&&void 0!==i?i:this.installationId};return(0,a.mergeWith)(r,e.clientContext)}},{key:"getOrigin",value:function(e){var t,n,i=this.config.hostApp,r=(0,a.getOS)(this.uaParser),s=null===(t=this.window)||void 0===t||null===(t=t.navigator)||void 0===t?void 0:t.userAgent,o=null!==(n=null==e?void 0:e.page)&&void 0!==n?n:{};return{app:i,os:r,user_agent:s,page:h(h({},this.getDefaultPageProperties()),{},{type:this.config.page_type},o),screen:null==e?void 0:e.screen,component:null==e?void 0:e.component,is_private_browsing_enabled:this.isPrivateBrowserSession}}},{key:"getDevice",value:function(){var e=this.uaParser.getDevice();return{model:e.model,manufacturer:e.vendor,form_factor:(0,a.getDeviceType)(e.type)}}},{key:"flushIfBatchSizeReached",value:(D=p(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentValidMessageCount();case 2:t=e.sent,this.config&&t>=this.getBatchSize()&&this.started&&!this.isFlushingTempStore&&this.throttleFlush();case 4:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"flushMessage",value:(C=p(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendMessagesToMessageGateway([t]);case 2:if(null==(n=e.sent)||!n.ok){e.next=11;break}return e.prev=4,e.next=7,this.removeMessagesFromStorageByKeys([t.id]);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:this.restartTimer();case 12:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e){return C.apply(this,arguments)})},{key:"send",value:(I=p(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.createMessage(t),this.started)try{this.store.set((i=n.id,"".concat(E,"-").concat(i)),n),this.flushIfBatchSizeReached()}catch(e){this.flushMessage(n)}else this.tempMessageStore.push(n);case 2:case"end":return e.stop()}var i}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"sendMessagesToMessageGateway",value:(k=p(d().mark((function e(t){var n,i,r,s,o,c,u,l,h,f,p,g,m,v=this,y=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.length>1&&void 0!==y[1]?y[1]:0,e.prev=1,this.stopTimer(),e.next=5,(0,a.postData)(this.apiUri,{messages:t},this.clientAgent);case 5:if(r=e.sent,null===(i=r)||void 0===i||!i.ok){e.next=27;break}if(!(o=null===(s=r.headers.get("content-type"))||void 0===s?void 0:s.includes("application/json"))){e.next=25;break}if(e.prev=9,!o){e.next=16;break}return e.next=13,r.json();case 13:e.t0=e.sent,e.next=17;break;case 16:e.t0=null;case 17:u=e.t0,l=null===(c=u.data)||void 0===c?void 0:c.map((function(e){var n,i,r=t.find((function(t){return t.id===(null==e?void 0:e.message_id)}));return v.config.invalidMessagesHandler||null===(n=(i=v.config).invalidMessageHandler)||void 0===n||n.call(i,r,e),{message:r,messageValidationError:e}})),this.config.invalidMessagesHandler(l),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(9),this.errorLogger(e.t1);case 25:e.next=38;break;case 27:if(p=null===(h=r)||void 0===h?void 0:h.status,g=null===(f=r)||void 0===f||null===(f=f.headers)||void 0===f?void 0:f.get("retry-after"),!(b.includes(p)&&n<10)){e.next=37;break}return this.isRetrying=!0,this.stopTimer(),m=g?parseInt(g,10):5,e.next=36,new Promise((function(e,i){setTimeout((function(){v.sendMessagesToMessageGateway(t,n+1).then((function(t){e(t)})).catch((function(e){return i(e)}))}),Math.pow(2,n)*m*1e3)}));case 36:r=e.sent;case 37:this.errorLogger(r);case 38:return e.abrupt("return",r);case 41:return e.prev=41,e.t2=e.catch(1),this.errorLogger(e.t2),e.abrupt("return",void 0);case 45:return e.prev=45,0===n&&(this.isRetrying=!1),e.finish(45);case 48:case"end":return e.stop()}}),e,this,[[1,41,45,48],[9,22]])}))),function(e){return k.apply(this,arguments)})},{key:"restartTimer",value:function(){var e=this;this.stopTimer(),this.timer=setInterval((function(){e.throttleFlush()}),this.regionNetworkConfig.lingerDuration)}},{key:"stopTimer",value:function(){this.timer&&clearInterval(this.timer)}},{key:"flushTempStore",value:(_=p(d().mark((function e(){var t,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.tempMessageStore.length>0)){e.next=13;break}return this.isFlushingTempStore=!0,t=this.updateMessages(this.tempMessageStore),e.prev=3,e.next=6,this.sendMessagesToMessageGateway(t);case 6:null!=(n=e.sent)&&n.ok&&(this.tempMessageStore=[]),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:this.isFlushingTempStore=!1;case 13:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return _.apply(this,arguments)})},{key:"flush",value:(w=p(d().mark((function e(){var t,n,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.started){e.next=21;break}if(this.isFlushInProgress||this.isRetrying){e.next=20;break}return this.isFlushInProgress=!0,e.next=6,this.flushTempStore();case 6:return e.next=8,this.getBatchedValidMessageKeys();case 8:if(!((t=e.sent).length>0)){e.next=20;break}return e.next=12,this.store.getMany(t);case 12:return n=e.sent,e.next=15,this.sendMessagesToMessageGateway(n);case 15:if(!(null!=(i=e.sent)&&i.ok||i&&!b.includes(i.status))){e.next=19;break}return e.next=19,this.removeMessagesFromStorageByKeys(t);case 19:this.restartTimer();case 20:this.isFlushInProgress=!1;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),this.errorLogger(e.t0);case 26:case"end":return e.stop()}}),e,this,[[0,23]])}))),function(){return w.apply(this,arguments)})},{key:"updateMessages",value:function(e){var t=this,n=[];return e.forEach((function(e){var i=h(h({},e),{},{issuer:t.config.hostApp,member:t.member,region_id:t.config.regionId});if(!i.client_context){var r=t.getClientContext(e.partialMessage);delete i.partialMessage,i.client_context=r}n.push(i)})),n}},{key:"removeMessagesFromStorageByKeys",value:function(e){return this.store.delMany(e)}},{key:"getCurrentValidMessages",value:(v=p(d().mark((function e(){var t,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.keys();case 2:return t=e.sent,n=t.filter((function(e){return"string"==typeof e&&S(e)})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getCurrentValidMessageCount",value:(f=p(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentValidMessages();case 2:return t=e.sent,e.abrupt("return",t.length);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getBatchSize",value:function(){var e;return null!==(e=this.regionNetworkConfig.batchSize)&&void 0!==e?e:25}},{key:"getBatchedValidMessageKeys",value:(l=p(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentValidMessages();case 2:return t=e.sent,e.abrupt("return",t.slice(0,this.getBatchSize()));case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"regionNetworkConfig",get:function(){return this.config.networkConfig.regions[this.config.regionId]}},{key:"installationId",get:function(){if(!(0,a.isBrowser)())return null;try{var e=localStorage.getItem(x);if(e)return e;var t=(0,i.default)();return this.installationId=t,t}catch(e){return this.errorLogger(e),null}},set:function(e){if((0,a.isBrowser)())try{localStorage.setItem(x,e||"")}catch(e){this.errorLogger(e)}}},{key:"getVisitID",value:function(){if(!(0,a.isBrowser)())return null;try{return localStorage.getItem("RAKUTEN_VISIT_ID")}catch(e){return this.errorLogger(e),null}}}],t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,l,f,v,w,_,k,I,C,D,P}();m(_,"pipeline",w)},"./src/Store.ts":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var i=n("./node_modules/idb-keyval/dist/index.js"),r=n("./src/utils.ts");function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}var c=function(){return e=function e(t,n){var s,a,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=this,c=void 0,(a=o(a="idbStore"))in s?Object.defineProperty(s,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[a]=c;var u=(0,r.getWindow)();u&&"indexedDB"in u&&(this.idbStore=i.createStore(t,n))},(t=[{key:"set",value:function(e,t){return i.set(e,t,this.idbStore)}},{key:"values",value:function(){return i.values(this.idbStore)}},{key:"keys",value:function(){return i.keys(this.idbStore)}},{key:"getMany",value:function(e){return i.getMany(e,this.idbStore)}},{key:"delMany",value:function(e){return i.delMany(e,this.idbStore)}}])&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()},"./src/utils.ts":(e,t,n)=>{"use strict";n.r(t),n.d(t,{DeviceType:()=>h,detectPrivateBrowserSession:()=>E,getDeviceType:()=>b,getOS:()=>w,getParentPath:()=>f,getSearchParams:()=>v,getWindow:()=>y,isArray:()=>x,isBrowser:()=>d,isObject:()=>T,mergeWith:()=>_,postData:()=>g});var i=n("./node_modules/detectincognitojs/dist/detectIncognito.esm.js");function r(){r=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function d(e,t,n,i){var r=t&&t.prototype instanceof b?t:b,a=Object.create(r.prototype),o=new B(i||[]);return s(a,"_invoke",{value:I(e,n,o)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p="suspendedStart",g="suspendedYield",m="executing",v="completed",y={};function b(){}function w(){}function E(){}var A={};h(A,c,(function(){return this}));var x=Object.getPrototypeOf,T=x&&x(x(M([])));T&&T!==n&&i.call(T,c)&&(A=T);var S=E.prototype=b.prototype=Object.create(A);function _(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(r,s,o,c){var u=f(e[r],e,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==a(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,c)}),(function(e){n("throw",e,o,c)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,c)}))}c(u.arg)}var r;s(this,"_invoke",{value:function(e,i){function s(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(s,s):s()}})}function I(t,n,i){var r=p;return function(s,a){if(r===m)throw Error("Generator is already running");if(r===v){if("throw"===s)throw a;return{value:e,done:!0}}for(i.method=s,i.arg=a;;){var o=i.delegate;if(o){var c=C(o,i);if(c){if(c===y)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===p)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var u=f(t,n,i);if("normal"===u.type){if(r=i.done?v:g,u.arg===y)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(r=v,i.method="throw",i.arg=u.arg)}}}function C(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),y;var s=f(r,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,y;var a=s.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function M(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(a(t)+" is not iterable")}return w.prototype=E,s(S,"constructor",{value:E,configurable:!0}),s(E,"constructor",{value:w,configurable:!0}),w.displayName=h(E,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,h(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},_(k.prototype),h(k.prototype,u,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,i,r,s){void 0===s&&(s=Promise);var a=new k(d(e,n,i,r),s);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(S),h(S,l,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=M,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return o.type="throw",o.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;P(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:M(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),y}},t}function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t,n,i,r,s,a){try{var o=e[s](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,r)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var s=e.apply(t,n);function a(e){o(s,i,r,a,c,"next",e)}function c(e){o(s,i,r,a,c,"throw",e)}a(void 0)}))}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,s,a,o=[],c=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=s.call(n)).done)&&(o.push(i.value),o.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var h=function(e){return e.Mobile="mobile",e.Desktop="desktop",e.Tablet="tablet",e}({});function d(){return"undefined"!=typeof window}function f(e){var t=function(e){return e.replace(/\/+$/,"").substring(0,e.lastIndexOf("/"))}(e),n=u(t.split("/"),2)[1];return n?"/".concat(n,"/"):void 0}function p(e){throw new Error("Parameter ".concat(e," is required"))}function g(){return m.apply(this,arguments)}function m(){return m=c(r().mark((function e(){var t,n,i,s,a,o,c,u,l,h=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,n=new Array(t),i=0;i<t;i++)n[i]=h[i];return s=n[0],a=void 0===s?p("url"):s,o=n[1],c=void 0===o?p("data"):o,u=n[2],l=void 0===u?p("clientAgent"):u,e.abrupt("return",fetch(a,{method:"POST",mode:"cors",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/json","client-ts":(new Date).getTime().toString(),"client-agent":l},body:JSON.stringify(c)}));case 3:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function v(){var e=new URL(decodeURIComponent(self.location.href));return new URLSearchParams(e.search)}function y(){return"undefined"!=typeof self?self:void 0}function b(e){return e===h.Mobile||e===h.Tablet?e:h.Desktop}function w(e){var t=e.getOS();return null==t||!t.name||null!=t&&t.version?t.name&&t.version?{name:t.name,version:t.version}:void 0:{name:t.name,version:"UNKNOWN"}}function E(){return A.apply(this,arguments)}function A(){return(A=c(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,i.detectIncognito)().then((function(e){return e.isPrivate}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function x(e){return Array.isArray(e)}function T(e){var t=a(e);return null!=e&&("object"===t||"function"===t)&&!x(e)}function S(e,t){if(null==t)return e;for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];if(void 0!==t[r]&&"__proto__"!==r)if(!T(e[r])&&T(t[r]))Object.assign(e,s({},r,t[r]));else if(e[r]&&T(t[r]))S(e[r],t[r]);else if(Array.isArray(t[r])&&Array.isArray(e[r]))for(var a=0;a<t[r].length;a++)T(e[r][a])&&T(t[r][a])?S(e[r][a],t[r][a]):e[r][a]=t[r][a];else Object.assign(e,s({},r,t[r]))}return e}function _(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,s=n;r<s.length;r++){S(e,s[r])}return e}},"./node_modules/detectincognitojs/dist/detectIncognito.esm.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u,detectIncognito:()=>l});var i={d:(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},r={};i.d(r,{A:()=>c,k:()=>o});var s=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))},a=function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};function o(){return s(this,void 0,Promise,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e,t){var n,i,r="Unknown";function s(t){e({isPrivate:t,browserName:r})}function a(e){return e===eval.toString().length}void 0!==(i=navigator.vendor)&&0===i.indexOf("Apple")&&a(37)?(r="Safari",void 0!==navigator.maxTouchPoints?function(){var e=String(Math.random());try{window.indexedDB.open(e,1).onupgradeneeded=function(t){var n,i,r=null===(n=t.target)||void 0===n?void 0:n.result;try{r.createObjectStore("test",{autoIncrement:!0}).put(new Blob),s(!1)}catch(e){var a=e;return e instanceof Error&&(a=null!==(i=e.message)&&void 0!==i?i:e),"string"!=typeof a?void s(!1):void s(a.includes("BlobURLs are not yet supported"))}finally{r.close(),window.indexedDB.deleteDatabase(e)}}}catch(e){s(!1)}}():function(){var e=window.openDatabase,t=window.localStorage;try{e(null,null,null,null)}catch(e){return void s(!0)}try{t.setItem("test","1"),t.removeItem("test")}catch(e){return void s(!0)}s(!1)}()):function(){var e=navigator.vendor;return void 0!==e&&0===e.indexOf("Google")&&a(33)}()?(n=navigator.userAgent,r=n.match(/Chrome/)?void 0!==navigator.brave?"Brave":n.match(/Edg/)?"Edge":n.match(/OPR/)?"Opera":"Chrome":"Chromium",void 0!==self.Promise&&void 0!==self.Promise.allSettled?navigator.webkitTemporaryStorage.queryUsageAndQuota((function(e,t){var n;s(Math.round(t/1048576)<2*Math.round((void 0!==(n=window).performance&&void 0!==n.performance.memory&&void 0!==n.performance.memory.jsHeapSizeLimit?performance.memory.jsHeapSizeLimit:1073741824)/1048576))}),(function(e){t(new Error("detectIncognito somehow failed to query storage quota: "+e.message))})):(0,window.webkitRequestFileSystem)(0,1,(function(){s(!1)}),(function(){s(!0)}))):void 0!==document.documentElement&&void 0!==document.documentElement.style.MozAppearance&&a(37)?(r="Firefox",s(void 0===navigator.serviceWorker)):void 0!==navigator.msSaveBlob&&a(39)?(r="Internet Explorer",s(void 0===window.indexedDB)):t(new Error("detectIncognito cannot determine the browser"))}))];case 1:return[2,e.sent()]}}))}))}"undefined"!=typeof window&&(window.detectIncognito=o);const c=o;var u=r.A,l=r.k},"./node_modules/ua-parser-js/src/ua-parser.js":function(e,t,n){var i;!function(r,s){"use strict";var a="function",o="undefined",c="object",u="string",l="major",h="model",d="name",f="type",p="vendor",g="version",m="architecture",v="console",y="mobile",b="tablet",w="smarttv",E="wearable",A="embedded",x="Amazon",T="Apple",S="ASUS",_="BlackBerry",k="Browser",I="Chrome",C="Firefox",D="Google",P="Honor",B="Huawei",M="LG",R="Microsoft",N="Motorola",O="Nvidia",L="OnePlus",j="Opera",U="OPPO",F="Samsung",$="Sharp",q="Sony",H="Xiaomi",W="Zebra",V="Facebook",G="Chromium OS",z="Mac OS",K=" Browser",J=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},Y=function(e,t){return typeof e===u&&-1!==X(t).indexOf(X(e))},X=function(e){return e.toLowerCase()},Z=function(e,t){if(typeof e===u)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},Q=function(e,t){for(var n,i,r,o,u,l,h=0;h<t.length&&!u;){var d=t[h],f=t[h+1];for(n=i=0;n<d.length&&!u&&d[n];)if(u=d[n++].exec(e))for(r=0;r<f.length;r++)l=u[++i],typeof(o=f[r])===c&&o.length>0?2===o.length?typeof o[1]==a?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3===o.length?typeof o[1]!==a||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):s:this[o[0]]=l?o[1].call(this,l,o[2]):s:4===o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):s):this[o]=l||s;h+=2}},ee=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(Y(t[n][i],e))return"?"===n?s:n}else if(Y(t[n],e))return"?"===n?s:n;return t.hasOwnProperty("*")?t["*"]:e},te={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ne={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,g],[/opios[\/ ]+([\w\.]+)/i],[g,[d,j+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[d,j+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[d,j]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[d,"UC"+k]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[d,"Smart Lenovo "+k]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+k],g],[/\bfocus\/([\w\.]+)/i],[g,[d,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[d,j+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[d,j+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[d,"MIUI"+K]],[/fxios\/([\w\.-]+)/i],[g,[d,C]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+K],g],[/samsungbrowser\/([\w\.]+)/i],[g,[d,F+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,V],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[d,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,I+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[d,"Android "+k]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[g,ee,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[d,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[d,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[g,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[m,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[m,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[m,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[m,/ower/,"",X]],[/ sun4\w[;\)]/i],[[m,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[m,X]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[p,F],[f,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[p,F],[f,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[p,T],[f,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[p,T],[f,b]],[/(macintosh);/i],[h,[p,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[p,$],[f,y]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[h,[p,P],[f,b]],[/honor([-\w ]+)[;\)]/i],[h,[p,P],[f,y]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[h,[p,B],[f,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[p,B],[f,y]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[h,/_/g," "],[p,H],[f,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[h,/_/g," "],[p,H],[f,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[p,U],[f,y]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[h,[p,ee,{OnePlus:["304","403","203"],"*":U}],[f,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[p,"Vivo"],[f,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[p,"Realme"],[f,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[p,N],[f,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[p,N],[f,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[p,M],[f,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[p,M],[f,y]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[h,[p,"Lenovo"],[f,b]],[/(nokia) (t[12][01])/i],[p,h,[f,b]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[h,/_/g," "],[f,y],[p,"Nokia"]],[/(pixel (c|tablet))\b/i],[h,[p,D],[f,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[p,D],[f,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[p,q],[f,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[p,q],[f,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[p,L],[f,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[p,x],[f,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[p,x],[f,y]],[/(playbook);[-\w\),; ]+(rim)/i],[h,p,[f,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[p,_],[f,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[p,S],[f,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[p,S],[f,y]],[/(nexus 9)/i],[h,[p,"HTC"],[f,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[h,/_/g," "],[f,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[p,"TCL"],[f,b]],[/(itel) ((\w+))/i],[[p,X],h,[f,ee,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[p,"Acer"],[f,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[p,"Meizu"],[f,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[p,"Ulefone"],[f,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[p,"Energizer"],[f,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[p,"Cat"],[f,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[p,"Smartfren"],[f,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[p,"Nothing"],[f,y]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[h,[p,"Archos"],[f,b]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[h,[p,"Archos"],[f,y]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[p,h,[f,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[p,h,[f,y]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,h,[f,b]],[/(surface duo)/i],[h,[p,R],[f,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[p,"Fairphone"],[f,y]],[/(u304aa)/i],[h,[p,"AT&T"],[f,y]],[/\bsie-(\w*)/i],[h,[p,"Siemens"],[f,y]],[/\b(rct\w+) b/i],[h,[p,"RCA"],[f,b]],[/\b(venue[\d ]{2,7}) b/i],[h,[p,"Dell"],[f,b]],[/\b(q(?:mv|ta)\w+) b/i],[h,[p,"Verizon"],[f,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[p,"Barnes & Noble"],[f,b]],[/\b(tm\d{3}\w+) b/i],[h,[p,"NuVision"],[f,b]],[/\b(k88) b/i],[h,[p,"ZTE"],[f,b]],[/\b(nx\d{3}j) b/i],[h,[p,"ZTE"],[f,y]],[/\b(gen\d{3}) b.+49h/i],[h,[p,"Swiss"],[f,y]],[/\b(zur\d{3}) b/i],[h,[p,"Swiss"],[f,b]],[/\b((zeki)?tb.*\b) b/i],[h,[p,"Zeki"],[f,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],h,[f,b]],[/\b(ns-?\w{0,9}) b/i],[h,[p,"Insignia"],[f,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[p,"NextBook"],[f,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],h,[f,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],h,[f,y]],[/\b(ph-1) /i],[h,[p,"Essential"],[f,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[p,"Envizen"],[f,b]],[/\b(trio[-\w\. ]+) b/i],[h,[p,"MachSpeed"],[f,b]],[/\btu_(1491) b/i],[h,[p,"Rotor"],[f,b]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[h,[p,O],[f,b]],[/(sprint) (\w+)/i],[p,h,[f,y]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[p,R],[f,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[p,W],[f,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[p,W],[f,y]],[/smart-tv.+(samsung)/i],[p,[f,w]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[p,F],[f,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,M],[f,w]],[/(apple) ?tv/i],[p,[h,T+" TV"],[f,w]],[/crkey/i],[[h,I+"cast"],[p,D],[f,w]],[/droid.+aft(\w+)( bui|\))/i],[h,[p,x],[f,w]],[/(shield \w+ tv)/i],[h,[p,O],[f,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[p,$],[f,w]],[/(bravia[\w ]+)( bui|\))/i],[h,[p,q],[f,w]],[/(mi(tv|box)-?\w+) bui/i],[h,[p,H],[f,w]],[/Hbbtv.*(technisat) (.*);/i],[p,h,[f,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,Z],[h,Z],[f,w]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[h,[f,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,h,[f,v]],[/droid.+; (shield)( bui|\))/i],[h,[p,O],[f,v]],[/(playstation \w+)/i],[h,[p,q],[f,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[p,R],[f,v]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[h,[p,F],[f,E]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[p,h,[f,E]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[h,[p,U],[f,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[p,T],[f,E]],[/(opwwe\d{3})/i],[h,[p,L],[f,E]],[/(moto 360)/i],[h,[p,N],[f,E]],[/(smartwatch 3)/i],[h,[p,q],[f,E]],[/(g watch r)/i],[h,[p,M],[f,E]],[/droid.+; (wt63?0{2,3})\)/i],[h,[p,W],[f,E]],[/droid.+; (glass) \d/i],[h,[p,D],[f,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,h,[f,E]],[/; (quest( \d| pro)?)/i],[h,[p,V],[f,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[f,A]],[/(aeobc)\b/i],[h,[p,x],[f,A]],[/(homepod).+mac os/i],[h,[p,T],[f,A]],[/windows iot/i],[[f,A]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[f,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[f,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,y]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[h,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,g],[/ladybird\//i],[[d,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,g],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[d,[g,ee,te]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,ee,te],[d,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,z],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,d],[/(ubuntu) ([\w\.]+) like android/i],[[d,/(.+)/,"$1 Touch"],g],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[d,g],[/\(bb(10);/i],[g,[d,_]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[g,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[d,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[d,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,G],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,g],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,g]]},ie=function(e,t){if(typeof e===c&&(t=e,e=s),!(this instanceof ie))return new ie(e,t).getResult();var n=typeof r!==o&&r.navigator?r.navigator:s,i=e||(n&&n.userAgent?n.userAgent:""),v=n&&n.userAgentData?n.userAgentData:s,w=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(ne,t):ne,E=n&&n.userAgent==i;return this.getBrowser=function(){var e,t={};return t[d]=s,t[g]=s,Q.call(t,i,w.browser),t[l]=typeof(e=t[g])===u?e.replace(/[^\d\.]/g,"").split(".")[0]:s,E&&n&&n.brave&&typeof n.brave.isBrave==a&&(t[d]="Brave"),t},this.getCPU=function(){var e={};return e[m]=s,Q.call(e,i,w.cpu),e},this.getDevice=function(){var e={};return e[p]=s,e[h]=s,e[f]=s,Q.call(e,i,w.device),E&&!e[f]&&v&&v.mobile&&(e[f]=y),E&&"Macintosh"==e[h]&&n&&typeof n.standalone!==o&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[h]="iPad",e[f]=b),e},this.getEngine=function(){var e={};return e[d]=s,e[g]=s,Q.call(e,i,w.engine),e},this.getOS=function(){var e={};return e[d]=s,e[g]=s,Q.call(e,i,w.os),E&&!e[d]&&v&&v.platform&&"Unknown"!=v.platform&&(e[d]=v.platform.replace(/chrome os/i,G).replace(/macos/i,z)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===u&&e.length>500?Z(e,500):e,this},this.setUA(i),this};ie.VERSION="1.0.41",ie.BROWSER=J([d,g,l]),ie.CPU=J([m]),ie.DEVICE=J([h,p,f,v,y,w,b,E,A]),ie.ENGINE=ie.OS=J([d,g]),typeof t!==o?(e.exports&&(t=e.exports=ie),t.UAParser=ie):n.amdO?(i=function(){return ie}.call(t,n,t,e))===s||(e.exports=i):typeof r!==o&&(r.UAParser=ie);var re=typeof r!==o&&(r.jQuery||r.Zepto);if(re&&!re.ua){var se=new ie;re.ua=se.getResult(),re.ua.get=function(){return se.getUA()},re.ua.set=function(e){se.setUA(e);var t=se.getResult();for(var n in t)re.ua[n]=t[n]}}}("object"==typeof window?window:this)},"./node_modules/idb-keyval/dist/index.js":(e,t,n)=>{"use strict";function i(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function r(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=i(n);return(e,n)=>r.then((i=>n(i.transaction(t,e).objectStore(t))))}let s;function a(){return s||(s=r("keyval-store","keyval")),s}function o(e,t=a()){return t("readonly",(t=>i(t.get(e))))}function c(e,t,n=a()){return n("readwrite",(n=>(n.put(t,e),i(n.transaction))))}function u(e,t=a()){return t("readwrite",(t=>(e.forEach((e=>t.put(e[1],e[0]))),i(t.transaction))))}function l(e,t=a()){return t("readonly",(t=>Promise.all(e.map((e=>i(t.get(e)))))))}function h(e,t,n=a()){return n("readwrite",(n=>new Promise(((r,s)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),r(i(n.transaction))}catch(e){s(e)}}}))))}function d(e,t=a()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function f(e,t=a()){return t("readwrite",(t=>(e.forEach((e=>t.delete(e))),i(t.transaction))))}function p(e=a()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}function g(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},i(e.transaction)}function m(e=a()){return e("readonly",(e=>{if(e.getAllKeys)return i(e.getAllKeys());const t=[];return g(e,(e=>t.push(e.key))).then((()=>t))}))}function v(e=a()){return e("readonly",(e=>{if(e.getAll)return i(e.getAll());const t=[];return g(e,(e=>t.push(e.value))).then((()=>t))}))}function y(e=a()){return e("readonly",(t=>{if(t.getAll&&t.getAllKeys)return Promise.all([i(t.getAllKeys()),i(t.getAll())]).then((([e,t])=>e.map(((e,n)=>[e,t[n]]))));const n=[];return e("readonly",(e=>g(e,(e=>n.push([e.key,e.value]))).then((()=>n))))}))}n.r(t),n.d(t,{clear:()=>p,createStore:()=>r,del:()=>d,delMany:()=>f,entries:()=>y,get:()=>o,getMany:()=>l,keys:()=>m,promisifyRequest:()=>i,set:()=>c,setMany:()=>u,update:()=>h,values:()=>v})},"./node_modules/throttle-debounce/esm/index.js":(e,t,n)=>{"use strict";function i(e,t,n){var i,r=n||{},s=r.noTrailing,a=void 0!==s&&s,o=r.noLeading,c=void 0!==o&&o,u=r.debounceMode,l=void 0===u?void 0:u,h=!1,d=0;function f(){i&&clearTimeout(i)}function p(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];var o=this,u=Date.now()-d;function p(){d=Date.now(),t.apply(o,r)}function g(){i=void 0}h||(c||!l||i||p(),f(),void 0===l&&u>e?c?(d=Date.now(),a||(i=setTimeout(l?g:p,e))):p():!0!==a&&(i=setTimeout(l?g:p,void 0===l?e-u:e)))}return p.cancel=function(e){var t=(e||{}).upcomingOnly,n=void 0!==t&&t;f(),h=!n},p}function r(e,t,n){var r=(n||{}).atBegin;return i(e,t,{debounceMode:!1!==(void 0!==r&&r)})}n.r(t),n.d(t,{debounce:()=>r,throttle:()=>i})},"./node_modules/uuid/dist/esm-browser/native.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}},"./node_modules/uuid/dist/esm-browser/regex.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},"./node_modules/uuid/dist/esm-browser/rng.js":(e,t,n)=>{"use strict";let i;n.r(t),n.d(t,{default:()=>s});const r=new Uint8Array(16);function s(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(r)}},"./node_modules/uuid/dist/esm-browser/stringify.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a,unsafeStringify:()=>s});var i=n("./node_modules/uuid/dist/esm-browser/validate.js");const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));function s(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}const a=function(e,t=0){const n=s(e,t);if(!(0,i.default)(n))throw TypeError("Stringified UUID is invalid");return n}},"./node_modules/uuid/dist/esm-browser/v4.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n("./node_modules/uuid/dist/esm-browser/native.js"),r=n("./node_modules/uuid/dist/esm-browser/rng.js"),s=n("./node_modules/uuid/dist/esm-browser/stringify.js");const a=function(e,t,n){if(i.default.randomUUID&&!t&&!e)return i.default.randomUUID();const a=(e=e||{}).random||(e.rng||r.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=a[e];return t}return(0,s.unsafeStringify)(a)}},"./node_modules/uuid/dist/esm-browser/validate.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var i=n("./node_modules/uuid/dist/esm-browser/regex.js");const r=function(e){return"string"==typeof e&&i.default.test(e)}}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var s=n[t]={exports:{}};return e[t].call(s.exports,s,s.exports,i),s.exports}i.amdO={},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";i.r(r),i.d(r,{AppType:()=>e.AppType,INSTALLATION_ID_LOCAL_STORAGE_KEY:()=>e.INSTALLATION_ID_LOCAL_STORAGE_KEY,MessagingSDK:()=>e.MessagingSDK,PIPELINE:()=>e.PIPELINE});var e=i("./src/MessagingSDK.ts")})();var s=t;for(var a in r)s[a]=r[a];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})()}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={exports:{}};return n[e].call(s.exports,s,s.exports,r),s.exports}r.m=n,(()=>{let e,t;try{"undefined"!=typeof browser&&"function"==typeof browser.runtime?.getURL&&(t=browser)}catch(e){}if(!t)try{"undefined"!=typeof chrome&&"function"==typeof chrome.runtime?.getURL&&(e=!0,t=chrome)}catch(e){}r.webExtRtModern=!e,r.webExtRt=t||{get runtime(){throw new Error("No chrome or browser runtime found")}},t||"object"==typeof self&&self.addEventListener||(r.webExtRt={runtime:{getURL:String}})})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var s=Object.create(null);r.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&n;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>n[e]));return a.default=()=>n,r.d(s,a),s},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>"js/"+(404===e?"pako":e)+".js",r.miniCssF=e=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{let e;r.g.importScripts&&(e=r.g.location+"");const t=r.g.document;if(!e&&t?.currentScript&&(e=t.currentScript.src),!e){if(!r.webExtRt)throw new Error("Automatic publicPath is not supported in this browser");e=r.webExtRt.runtime.getURL("/")}e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e+"../"})(),(()=>{var e={130:1};r.f.i=(t,n)=>{e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunksource=self.webpackChunksource||[],n=t.push.bind(t);t.push=t=>{var[i,s,a]=t;for(var o in s)r.o(s,o)&&(r.m[o]=s[o]);for(a&&a(r);i.length;)e[i.pop()]=1;n(t)}})(),r.webExtRt.runtime.onMessage.addListener(((e,t,n)=>{if("WTW_INJECT"!=e?.type||"number"!=typeof t?.tab?.id)return;let i=e.file;try{i=new URL(i).pathname}catch(e){}if(i){if(r.webExtRt.scripting)r.webExtRt.scripting.executeScript({target:{tabId:t.tab.id,frameIds:[t.frameId]},files:[i]}).then(n);else{const e={frameId:t.frameId,file:i,matchAboutBlank:!0};r.webExtRtModern?r.webExtRt.tabs.executeScript(t.tab.id,e).then(n):r.webExtRt.tabs.executeScript(t.tab.id,e,n)}return!0}})),r.f.i(404),r.f.i(689);(()=>{"use strict";var e={};r.r(e),r.d(e,{BusinessCard:()=>Ma,CouponScraper:()=>Va,Groupon:()=>Ba,HomeDomain:()=>Pa,HotelsWidget:()=>qa,InStoreCashBack:()=>Ra,IncreasedCBNotification:()=>Ja,InstalledExtensions:()=>Wa,Merchant:()=>Na,PriceMagic:()=>Oa,ProcessInterstitial:()=>La,ProductPageTracker:()=>Ua,PromoNotification:()=>Ka,Serp:()=>$a,SimilarStores:()=>Ga,TaxesPromo:()=>Ha,TcppNotification:()=>za});var t,n,i=r(30457),s=r.n(i);!function(e){e[e.DOCUMENTCOMPLETE=0]="DOCUMENTCOMPLETE",e[e.BEFORENAVIGATE=1]="BEFORENAVIGATE",e[e.TABCHANGED=2]="TABCHANGED",e[e.TABUPDATED=3]="TABUPDATED",e[e.NAVIGATIONCOMMITTED=4]="NAVIGATIONCOMMITTED",e[e.TABCLOSED=5]="TABCLOSED"}(t||(t={})),function(e){e[e.NEWTAB=-1]="NEWTAB",e[e.CURRENTTAB=-2]="CURRENTTAB",e[e.NEWWINDOW=-3]="NEWWINDOW",e[e.ALLTABS=-4]="ALLTABS",e[e.BACKGROUNDTAB=-6]="BACKGROUNDTAB"}(n||(n={}));const a="unknown",o="Edge Android",c="Edge iOS",u="WebkitEdge",l="Avast",h="Chrome",d="Firefox",f="Opera";class p{name="chromium";version=a;isWebkitEdge=!1;isEdge=!1;isEdgeAndroid=!1;isEdgeiOS=!1;isEdgeMobile=!1;isChrome=!1;isFirefox=!1;isWebkit=!1;isLegacySafari=!1;isSafariApp=!1;isSafariWebext=!1;isSafariMobile=!1;isSafari=!1;DOCUMENTCOMPLETE=t.DOCUMENTCOMPLETE;BEFORENAVIGATE=t.BEFORENAVIGATE;TABCHANGED=t.TABCHANGED;TABUPDATED=t.TABUPDATED;NAVIGATIONCOMMITTED=t.NAVIGATIONCOMMITTED;TABCLOSED=t.TABCLOSED;NEWTAB=n.NEWTAB;CURRENTTAB=n.CURRENTTAB;NEWWINDOW=n.NEWWINDOW;ALLTABS=n.ALLTABS;BACKGROUNDTAB=n.BACKGROUNDTAB;constructor(){this.parseUserAgent(),this.isEdgeAndroid=this.name===o,this.isEdgeiOS=this.name===c,this.isEdgeMobile=this.isEdgeAndroid||this.isEdgeiOS,this.isWebkitEdge=this.name===u,this.isEdge=this.isWebkitEdge||this.isEdgeMobile,this.isChrome=this.name===h,this.isFirefox=this.name===d,this.isWebkit=this.isChrome||this.isWebkitEdge||this.name===f||this.name===l,this.isLegacySafari=!1,this.isSafariApp=!1,this.isSafari=this.isLegacySafari||this.isSafariApp||this.isSafariWebext||this.isSafariMobile}parseUserAgentData(e){const t={"Google Chrome":h,"Microsoft Edge":u,Opera:f};e.brands?.forEach((e=>{t[e.brand]&&(this.name=t[e.brand],this.version=e.version)})),e.mobile&&this.name===u&&"Android"===e.platform&&(this.name=o)}parseUserAgent(){if(navigator.userAgentData)this.parseUserAgentData(navigator.userAgentData);else if(navigator.userAgent){const e=navigator.userAgent;if(!/Safari\/.+/i.test(e)||/(Chrome|Chromium)\/.+/i.test(e)||/EdgiOS\/.+/i.test(e)){const[,t,n]=e.match(/.*(opr|yabrowser|mrchrome|chrome|firefox|edge|edg|edga|edgios|avast)\/?\s*([.\d]+)/i)||[];if("object"==typeof chrome&&"object"==typeof chrome.avast)this.name=l;else switch(t?.toLowerCase()){case"avast":this.name=l;break;case"opr":this.name=f;break;case"firefox":this.name=d;break;case"edge":this.name="Edge";break;case"edg":this.name=u;break;case"edga":this.name=o;break;case"edgios":this.name=c;break;default:this.name=h}this.version=n||a}else/\b(iPad|iPhone|iPod)\b/.test(e)?(this.name="Safari Mobile",this.isSafariMobile=!0):(this.name="Safari",this.isSafariWebext=!0),this.version=e.match(/ Version\/(.+?) /i)?.[1]||a}}}const g=class extends p{tabManager=[];fnCallbacks={};oPendingNavigates={};constructor(){super(),this.closeTab=this.removeTab,this.on=this.attachEvent,this.emit=this.fireEvent,s().tabs.onActivated.addListener((async e=>{this.oPendingNavigates[e.tabId]&&this.navigate(this.oPendingNavigates[e.tabId]);const t=await s().tabs.get(e.tabId);s().runtime.lastError||this.tabChanged(t)})),s().windows.onFocusChanged.addListener((async e=>{if(e!==s().windows.WINDOW_ID_NONE){const t=await s().tabs.query({windowId:e,active:!0});t&&this.tabChanged(t.pop())}})),s().tabs.onRemoved.addListener((e=>{this.tabManager.splice(e,1),this.fireEvent(t.TABCLOSED,{name:t.TABCLOSED,tabId:e,url:this.tabManager[e]?.url??""})})),s().tabs.onUpdated.addListener(((e,n,i)=>{const r=i.url;r&&(this.tabManager[e]={url:r},this.fireEvent(t.TABUPDATED,{name:t.TABUPDATED,tabId:e,url:r,status:n.status}))})),s().webNavigation&&(s().webNavigation.onCommitted.addListener((e=>this.fireWebNavigationEvent(t.NAVIGATIONCOMMITTED,e))),s().webNavigation.onDOMContentLoaded.addListener((e=>this.fireWebNavigationEvent(t.DOCUMENTCOMPLETE,e)))),s().webRequest?.onBeforeRequest.addListener((e=>this.onBeforeRequestHandler(e)),{urls:["<all_urls>"],types:["main_frame"]}),s().runtime.onMessage.addListener((e=>this.onMessageHandler(e)))}onBeforeRequestHandler(e){(0===e.frameId||this.isSafariWebext&&0===e.parentFrameId)&&e.url&&this.fireEvent(t.BEFORENAVIGATE,{name:t.BEFORENAVIGATE,tabId:e.tabId,url:e.url})}async fireWebNavigationEvent(e,t){if(0!==t.frameId)return Promise.resolve();let n=t.tabId;if(this.isSafariWebext&&0===n){const e=await s().tabs.query({active:!0,currentWindow:!0});if(e.length>0){const t=e[0];t?.id&&(n=t.id)}}try{const i=await s().tabs.get(n);!s().runtime.lastError&&i&&this.fireEvent(e,{name:e,tabId:n,url:t.url,active:i.active})}catch{}}onMessageHandler(e){return new Promise((t=>{switch(e.action){case"ci_browser_navigate":this.navigate(e).then(t);break;case"ci_browser_redirect":this.redirect(e).then(t)}}))}navigate(e,t=()=>{}){const i=new Promise((t=>{let i;i="string"==typeof e?{url:e,tabId:n.NEWTAB}:e;const r=i.tabId||n.CURRENTTAB,a=i.url,o={url:a};switch(r){case n.NEWTAB:o.active=!0,void 0!==i.active&&(o.active=i.active),void 0!==i.pinned&&(o.pinned=i.pinned),s().tabs.create(o).then(t);break;case n.BACKGROUNDTAB:o.active=!1,void 0!==i.pinned&&(o.pinned=i.pinned),s().tabs.create(o).then(t);break;case n.CURRENTTAB:this.redirect(i.url).then(t);break;case n.NEWWINDOW:s().windows.create({url:a,focused:!0}).then(t);break;default:s().tabs.get(i.tabId).then((e=>{!s().runtime.lastError&&e?(s().tabs.update(i.tabId,o).then(t),delete this.oPendingNavigates[i.tabId]):this.oPendingNavigates[i.tabId]=i}))}}));return i.then(t),i}redirect(e,t=()=>{}){const n=new Promise((t=>{const n="object"==typeof e?e.url:e;s().tabs.query({active:!0,currentWindow:!0}).then((e=>{e.length>0&&s().tabs.update(e[0].id,{url:n}).then(t),t(null)}))}));return n.then(t),n}attachEvent(e,t){this.fnCallbacks[e]||(this.fnCallbacks[e]=[]),this.fnCallbacks[e].push(t)}detachEvent(e,t){if(this.fnCallbacks[e])for(let n=this.fnCallbacks[e].length-1;n>=0;n--)this.fnCallbacks[e][n]&&t===this.fnCallbacks[e][n]&&this.fnCallbacks[e].splice(n,1)}fireEvent(e,t){this.fnCallbacks[e]?.forEach((e=>{"function"==typeof e&&e.call(this,t)}))}tabChanged(e){if(e){const n={action:"event",data:{name:t.TABCHANGED,tabId:e.id,url:e.url}};e.id&&0!==e.url?.indexOf("chrome://")&&s().tabs.sendMessage(e.id,n).catch((e=>{})),this.fireEvent(t.TABCHANGED,n.data)}}removeTab(e){s().tabs.remove("number"==typeof e?e:e.id)}};class m{constructor(){const e=s().runtime.getManifest();this.settings={name:e.name,version:e.version,optionsPage:e.options_ui}}get name(){return this.settings.name}get version(){return this.settings.version}get optionsPage(){return this.settings.optionsPage}getItem(e,t=()=>{}){const n=new Promise((t=>{"string"==typeof e||Array.isArray(e)?s().storage.local.get(e).then((n=>{t("string"==typeof e?n?n[e]:null:n)})):t(null)}));return n.then(t),n}setItem(e,t){return"string"==typeof e?void 0===t?s().storage.local.remove(e):s().storage.local.set({[e]:t}):"object"==typeof e?s().storage.local.set(e):Promise.reject()}getURL(e){return s().runtime.getURL(e)}}const v=class extends m{fnCallbacks={};fnListeners={};constructor(){super(),this.on=this.attachEvent,this.emit=this.fireEvent,s().runtime.onMessage.addListener(((e,t)=>this.onMessageHandler(e,t))),s().runtime.onMessageExternal?.addListener(((e,t)=>this.onMessageExternalHandler(e,t)))}onMessageHandler({action:e,data:t,name:i},r){return new Promise((a=>{if("event"===e)if(t?.tabId){const e={action:"event",name:i,data:t.data,tabId:t.tabId};t.tabId===n.ALLTABS?this.broadcastEvent(e).then(a):s().tabs.sendMessage(t.tabId,e).then(a)}else if(this.fnCallbacks[i]){const e={url:r.tab?.url??r.url??"",tabId:r.tab?.id??0,data:t.data};this.fnCallbacks[i].forEach((t=>{2===t.length?t.call(this,e,a):a(t.call(this,e,(()=>{})))}))}else{this.fnListeners[i]||(this.fnListeners[i]=[]);const e={url:r.tab?.url??r.url??"",tabId:r.tab?.id??0,data:t.data};this.fnListeners[i].push({listener:a,message:e})}}))}onMessageExternalHandler({action:e,data:t,name:n},i){return new Promise((r=>{if("event"===e&&i.id&&this.fnCallbacks[n]){const e={name:n,url:i.tab?i.tab.url:i.url,extensionId:i.id};t&&(e.data=t.data),i.tab&&(e.tabId=i.tab.id),this.fnCallbacks[n].forEach((t=>{2===t.length?t.call(this,e,r):r(t.call(this,e,(()=>{})))}))}else r(null)}))}attachEvent(e,t){this.fnListeners[e]&&(this.fnListeners[e].forEach((({listener:e,message:n})=>{t.call(this,n,e)})),delete this.fnListeners[e]),this.fnCallbacks[e]||(this.fnCallbacks[e]=[]),this.fnCallbacks[e].push(t)}detachEvent(e,t){const n=this.fnCallbacks[e];if(n)for(let e=n.length-1;e>=0;e--)n[e]&&t===n[e]&&n.splice(e,1)}fireEvent(e,{tabId:t,data:i,extensionId:r}={},a=function(){}){const o="event";const c=new Promise(((a,c)=>{if(r)s().runtime.sendMessage(r,{action:o,name:e,data:{data:i}}).then(a).catch(c);else if(t===n.ALLTABS)this.broadcastEvent({action:o,name:e,data:{data:i}}).then(a).catch(c);else if(t&&function(e){return!isNaN(parseInt(e,10))&&isFinite(e)}(t)&&t>=0){const n={action:o,name:e,data:{data:i},tabId:t};s().tabs.sendMessage(t,n).then(a).catch(c)}else s().tabs.query({active:!0,currentWindow:!0}).then((t=>{const n=t?.[0];if(n?.id&&n.url&&-1===n.url.indexOf("chrome://")){const t={action:o,name:e,data:{data:i},tabId:n.id};s().tabs.sendMessage(n.id,t).then(a).catch(c)}else c(new Error("No valid active tab found."))}),c);if(this.fnCallbacks[e]){const t={tabId:0,data:i,url:""};this.fnCallbacks[e].forEach((e=>{e.call(this,t,a)}))}}));return c.then(a).catch((e=>{})),c}async broadcastEvent(e){try{const t=await s().windows.getAll({populate:!0});return new Promise((n=>{t.forEach((t=>{t.tabs?.forEach((t=>{if(t.id&&t.url&&-1===t.url.indexOf("chrome://")&&-1===t.url.indexOf("about:")){const i={...e,tabId:t.id};s().tabs.sendMessage(t.id,i).then(n).catch((e=>{}))}}))}))}))}catch{}}},y=[],b="ButtonClick";function w(e){for(const t of y)try{t({tabId:e.id,url:e.url,name:b})}catch{}}function E(e){const t=/rgb\((\d+), (\d+), (\d+)\)/.exec(e);return t?[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),255]:e}const A=class{advised=!1;CLICK=b;constructor(){this.on=this.attachEvent}get browserAction(){return s().action??s().browserAction}attachEvent(e,t){e===this.CLICK&&(this.advised||(this.browserAction?.onClicked.addListener(w),this.advised=!0),y.push(t))}detachEvent(e,t){if(e===this.CLICK){for(let e=y.length-1;e>=0;e--)y[e]===t&&y.splice(e,1);0===y.length&&(this.advised=!1,this.browserAction?.onClicked.removeListener(w))}}setIcon(e){return this.browserAction?.setIcon({path:e})}setPopup(e){const t=e?e.url:"";return this.browserAction?.setPopup({popup:t})}setTitle(e){return this.browserAction?.setTitle({title:e})}setBadgeText(e){return this.browserAction?.setBadgeText({text:e.toString()})}setBadgeBackgroundColor(e){return this.browserAction?.setBadgeBackgroundColor({color:E(e)})}setBadgeTextColor(e){return this.browserAction?.setBadgeTextColor?.({color:E(e)})}},x=class{open(){return s().runtime.openOptionsPage()}},T=new class{constructor(){this.browser=new g,this.extension=new v,this.ui={button:new A,settings:new x}}},S={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let _;const k=new Uint8Array(16);const I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));function C(e,t=0){return(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase()}const D=function(e,t,n){if(S.randomUUID&&!t&&!e)return S.randomUUID();const i=(e=e||{}).random??e.rng?.()??function(){if(!_){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");_=crypto.getRandomValues.bind(crypto)}return _(k)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=i[e];return t}return C(i)};var P=r(45091);const B={PRODUCT_CDN:"product-image.ebates.com",BASE:"https://%domain%",STORE_COUPONS:"%rakuten_api%/button-acs/stores/%storeId%/coupons",PRODUCT_METADATA:"%rakuten_api%/product-metadata-extractor/v1/regions/USA/stores/%storeId%/products",URL_SHORTENER:"https://%domain%/urlshortener/v1/urls",ANONYMOUS_ACTIVATION:"https://%domain%/shopping/ticket/user/anu_ctrl.htm?merchant_id=%storeId%",ABANDONED_PRODUCTS:"https://cas.rrcbsn.com/cart_abandonment/v1/members/%uid%/products",CAPTURE_ORDER:"https://capture.ecbsn.com/api/1.0/commercecapture",MEMBER_DETAILS:"%member_api%/api/v3/button/member",MEMBER_FAVORITES:"%member_api%/api/v3/button/member/favorite/stores",MEMBER_VISITED:"%member_api%/api/v3/button/member/store/visited",MEMBER_PURCHASED:"%member_api%/api/v3/button/member/store/purchased",MEMBER_TICKETS:"%member_api%/api/v3/button/member/trackingticket/list",MEMBER_ONE_RECEIPTS:"%member_api%/api/v3/button/member/receipts/list",MEMBER_ISCB:"%member_api%/api/v3/button/member/instore/offers/available",MEMBER_ISCB_LINKED:"%member_api%/api/v3/button/member/instore/offers/linked",MEMBER_UDPATE_TCPP:"%member_api%/api/v3/button/member/tcpp/update",MEMBER_TAF:"%member_api%/api/v3/button/member/referral/program",MEMBER_GEOGATING:"%member_api%/geogating/v1/checkStatus.do",MILESTONES_URL:"https://www.rakuten.com/rewardshub/v1/regions/USA/members/%uid%/milestones?cursor=1&limit=10",PRICE_MAGIC:"https://search.ecbsn.com/search/price-magic/v1/similar-products?partnerId=1&sourceName=Toolbar",PRICE_MAGIC_BULK:"https://search.ecbsn.com/search/price-magic/v1/bulk-products?sourceName=Toolbar",SETTINGS_PM:"%member_api%/toolbar/config/pm_stores.json",SETTINGS_COUPONS:"%member_api%/toolbar/config/coupons.json",SETTINGS_PRODUCTS:"%member_api%/toolbar/config/products.json",SETTINGS_MERCHANTS:"https://button.rrcbsn.com/settings/merchants.json",SETTINGS_SERP:"https://button.rrcbsn.com/settings/serp.json",SETTINGS_PROMOS:"https://button.rrcbsn.com/settings/promos.json",SETTINGS_NOTIFICATION_DOMAINS:"%cdn%/toolbar/config/notification-domains.json",SETTINGS_NP_DOMAINS:"%cdn%/toolbar/config/np-domains.json",WEB_INSTALL:"https://%domain%/button/%browser/install/success?sourceName=toolbar&eeid=45426&toolbarId=%toolbarId&visit_id=%visitId",WEB_LOGON_FORM:"https://%domain%/account/login?tb=yes&eeid=26118&visit_id=%visitId&targetpage=%2F",WEB_LOGIN:"https://%domain%/button/user-auth.htm?tb=yes&auth_type=su&sourceName=toolbar&visit_id=%visitId",WEB_EXTENSION_LOGIN:"https://%domain%/extension/auth",WEB_SIGNUP_BONUS:"https://%domain%/button/extension-auth?tb=yes&toolbarId=%toolbarId&visit_id=%visitId",WEB_UNINSTALL:"https://%domain%/button/uninstall?tb=yes&toolbarId=%toolbarId&v=%version&visit_id=%visitId&b=%browser",WEB_SEARCH:"https://%domain%/search?term={terms}&tb=yes&ebtoken=%ebtoken&visit_id=%visitId",WEB_HOME:"https://%domain%/?tb=yes&ebtoken=%ebtoken&eeid=26117&visit_id=%visitId",WEB_REFERRAL:"https://%domain%/referral/default.do?tb=yes&ebtoken=%ebtoken&visit_id=%visitId",WEB_TC:"https://%domain%/referral/default.do?tb=yes&ebtoken=%ebtoken&visit_id=%visitId#taf-tc",FIREFOX_ADDON_PRIVACY:"https://addons.mozilla.org/en-US/firefox/addon/ebates/privacy/",WEB_ADVERTISING_DISCLOSURE:"https://%domain%/help/article/advertising-disclosure?tb=yes&eeid=26117",WEB_REFERRAL_TERMS:"https://%domain%/help/article/referral-program-terms?tb=yes&ebtoken=%ebtoken&eeid=61594",WEB_ADD_ADDRESS:"https://%domain%/account-settings.htm?add-address-modal=true&tb=yes&eeid=26117&sourceName=toolbar",WEB_CHOOSE_PAYMENT:"https://%domain%/account-settings.htm?choose-payment=true&tb=yes&eeid=26117&sourceName=toolbar&ebtoken=%ebtoken",WEBSTORE_SAFARI:"https://itunes.apple.com/app/apple-store/id1451893560?pt=117880184&mt=12&ls=1",WEBSTORE_FIREFOX:"https://addons.mozilla.org/en-US/firefox/addon/ebates/reviews/add",WEBSTORE_EDGE:"https://microsoftedge.microsoft.com/addons/detail/gmmlpenookphoknnpfilofakghemolmg",WEBSTORE_CHROME:"https://chromewebstore.google.com/detail/rakuten-get-cash-back-for/chhjbpecpncaggjpdakmflnfcopglcmi/reviews",PURCHASE_EXPERIENCE:"%rakuten_api%/purchase_experience/v2/regions/%region%/members/%uid%/experiences/post-purchase"},M="%feed_api%/datagrid/rest/v1/data",R=()=>s().runtime.getManifest();var N=r(64785),O=r.n(N);const L=(e,t)=>t.some((t=>e instanceof t));let j,U;const F=new WeakMap,$=new WeakMap,q=new WeakMap;let H={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return F.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return z(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function W(e){H=e(H)}function V(e){return(U||(U=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(K(this),t),z(this.request)}:function(...t){return z(e.apply(K(this),t))}}function G(e){return"function"==typeof e?V(e):(e instanceof IDBTransaction&&function(e){if(F.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));F.set(e,t)}(e),L(e,j||(j=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,H):e)}function z(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(z(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return q.set(t,e),t}(e);if($.has(e))return $.get(e);const t=G(e);return t!==e&&($.set(e,t),q.set(t,e)),t}const K=e=>q.get(e);const J=["get","getKey","getAll","getAllKeys","count"],Y=["put","add","delete","clear"],X=new Map;function Z(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(X.get(t))return X.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Y.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!J.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&s.done]))[0]};return X.set(t,s),s}W((e=>({...e,get:(t,n,i)=>Z(t,n)||e.get(t,n,i),has:(t,n)=>!!Z(t,n)||e.has(t,n)})));const Q=["continue","continuePrimaryKey","advance"],ee={},te=new WeakMap,ne=new WeakMap,ie={get(e,t){if(!Q.includes(t))return e[t];let n=ee[t];return n||(n=ee[t]=function(...e){te.set(this,ne.get(this)[t](...e))}),n}};async function*re(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,ie);for(ne.set(n,t),q.set(n,K(t));t;)yield n,t=await(te.get(n)||t.continue()),te.delete(n)}function se(e,t){return t===Symbol.asyncIterator&&L(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&L(e,[IDBIndex,IDBObjectStore])}function ae(e,t){const n=ce(t).toString();return n?e+(e.includes("?")?"&":"?")+n:e}function oe(e,t,{override:n=!0}={}){const i=ce(t);if(""===i.toString())return e.toString();try{const t="string"==typeof e?new URL(e):e;return i.forEach(((e,i)=>{!n&&t.searchParams.has(i)||t.searchParams.set(i,e)})),t.toString()}catch(t){return e.toString()}}function ce(e){if("object"==typeof e){const t={...e};for(const e in t)void 0!==t[e]&&""!==t[e]||delete t[e];return new URLSearchParams(t)}return new URLSearchParams(e)}W((e=>({...e,get:(t,n,i)=>se(t,n)?re:e.get(t,n,i),has:(t,n)=>se(t,n)||e.has(t,n)})));const ue="Network error";function le(e,t={}){e instanceof URL&&(e=e.toString());const n=new Request(e,t);if(n.headers.append("X-Button-Version",R().version),n.url.includes(Oe(M))){n.headers.append("Client-Agent","button"),n.headers.append("Content-Type","application/json");const e=n.headers.get("If-None-Match");e&&n.headers.append("RR-If-None-Match",e)}return self.EBATES&&(n.url.search(/(?!button|mobile)\/member/)>0||n.url.search(/\/geogating\/v1\/checkStatus\.do/)>0||n.url.search(/\/purchase_experience\//)>0)&&n.headers.append("ebToken",self.EBATES.ebToken??""),n}async function he(e,t={}){"object"!=typeof e||e instanceof URL?t.url=e:e=(t=e).url,t.beforeSend&&t.beforeSend(t);const n=t.method||t.type||"GET",i=new Headers(t.headers||{});t.contentType&&i.set("Content-Type",t.contentType),function(e,t=""){if(!e.get("Accept")){const n={text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"};e.set("Accept",Object.keys(n).includes(t)?`${n[t]}, */*; q=0.01`:"*/*")}}(i,t.dataType),"GET"===n&&"object"==typeof t.data&&(e=ae(e.toString(),t.data));const r={method:n,headers:i,redirect:t.redirect};"POST"===n&&(t.body?r.body=t.body:t.data&&(r.body="string"==typeof t.data||t.data instanceof Uint8Array?t.data:JSON.stringify(t.data)));const s=le(e,r);let a=null,o=null,c=null;try{a=await async function(e,t){return t&&AbortSignal.timeout?fetch(e,{signal:AbortSignal.timeout(t)}):fetch(e)}(s,t.timeout),({data:c,error:o}=await async function(e,t={}){let n=null,i=null;if(304===e.status)t.success&&t.success(void 0,e.status,e);else if(e.ok&&e.status>=200&&e.status<300){const r=()=>e.headers.get("Content-Type")?.includes("application/json");try{return n=r()?await e.json():await e.text(),t.success&&t.success(n,e.status,e),{data:n,error:i}}catch{i=de(e,t)}}else i=de(e,t);return{data:n,error:i}}(a,t))}catch(e){o=e instanceof Error?e:new Error(ue),o.details={response:a,options:t},de(a??{status:0},t)}return{data:c,response:a,error:o}}function de(e,t={}){const n=new Error(ue);return e=e||{status:0},t.error?t.error(e,e.status,n):n.details={response:e,options:t},n}function fe(e){const t=(e.get("cache-control")??"").match(/max-age=(\d+)[\s;,]?/);return t&&t.length>1?1e3*parseInt(t[1],10):0}class pe{meta={errorAttempt:0,nextUpdateTime:0,headers:{}};data=null}const ge="Network error";class me extends(O()){cache=null;MAX_ERROR_ATTEMPT=4;_promise=null;UPDATE_INTERVAL=0;DEFAULT_UPDATE_INTERVAL=9e5;ERROR_UPDATE_INTERVAL=0;constructor(){super()}get headers(){return{}}get _headers(){const e={...this.headers},t=this.cache?.meta?.headers?.etag;return t&&!e["If-None-Match"]&&(e["If-None-Match"]=t),e}parse(e){return e}getData(){return this.cache?.data}async ifUpdateRequired(e={}){try{return await this.verifyInternalCache(e),!1}catch{return!0}}async verifyInternalCache({force:e=!1}={}){const{data:t,meta:n}=this.cache??await this.readCache();if(n){if(this.cache={data:t,meta:n},!e&&n.nextUpdateTime&&Date.now()<n.nextUpdateTime){if(!n.errorAttempt)return t;throw new Error(ge)}throw new Error("Data expired")}throw new Error("Invalid cache")}async load(e={}){const{reset:t,force:n}=e;return t&&await this.clearCache(),this._promise||(this._promise=this.verifyInternalCache({force:n}).catch((t=>{if(t.message===ge)throw new Error(ge);return this.fetch(e)})).finally((()=>(this._promise=null,this.cache)))),this._promise}async save(e,t){return this.cache={data:e,meta:t},Te.set(this._id,{data:e,meta:t})}async readCache(){const e=await Te.get(this._id)??new pe;return this.cache=e,e}async clearCache(){return this.cache=null,Te.delete(this._id)}async fetch({reset:e=!1,url:t,method:n="GET",data:i,body:r,headers:s={}}={}){let a;this.emit("beforeRequest",this),e&&(s["Cache-Control"]="max-age=0, no-cache",s.Pragma="no-cache");const o=this.cache?.meta.headers.etag;o&&this.cache?.data&&!s["If-None-Match"]&&(s["If-None-Match"]=o);const c={nextUpdateTime:0,errorAttempt:0,headers:{}},u={meta:c,data:null},l=e=>{const{meta:t=c,data:n}=this.cache||u;t.errorAttempt=t.errorAttempt?Math.min(this.MAX_ERROR_ATTEMPT,++t.errorAttempt):1;const i=this.ERROR_UPDATE_INTERVAL||10*Math.pow(3,t.errorAttempt)*1e3;return t.nextUpdateTime=Date.now()+i,this.save(n,t),new Error(ge)};try{a=await function(e,t){const n=le(e,t);return fetch(n)}(t??this.url,{method:n,mode:"cors",headers:{...this._headers,...s},data:i,body:r})}catch(e){throw l()}if(304===a.status){const{meta:e=c,data:t}=this.cache||u;return e.nextUpdateTime=this.getNextUpdateTime(a.headers),e.errorAttempt=0,this.save(t,e),this.emit("sync",this),t}if(!a.ok)throw l();try{const e=await a.json(),t={nextUpdateTime:this.getNextUpdateTime(a.headers),errorAttempt:0,headers:["cache-control","etag","date"].reduce(((e,t)=>(e[t]=a.headers.get(t),e)),{})},n=this.parse(e);return this.save(n,t),this.emit("sync",this),n}catch(e){throw l()}}getNextUpdateTime(e){let t=this.DEFAULT_UPDATE_INTERVAL;if(this.UPDATE_INTERVAL)t=this.UPDATE_INTERVAL;else{const n=fe(e);n>0&&(t=n)}return Date.now()+t}}const ve=new class extends me{_id="feature-flags";UPDATE_INTERVAL=72e5;_variations={};constructor(){super(),this.get=this.variation}get url(){const e={region:Me.region,browser:T.browser.name,version:R().version};return oe(Me.get("FEATUREFLAGS_URL"),e)}get headers(){return{"APP-ID":Me.get("FEATUREFLAGS_APPID"),"API-KEY":Me.get("FEATUREFLAGS_APIKEY")}}async init(){self.EbatesPromise.then((e=>{e.on("SyncTick",(()=>this.sync()))})),await this.readCache(),this._variations=this.getData()??{}}async sync(){if(await this.ifUpdateRequired()){try{const e=await this.load();this.emitChangeEvents(e),this._variations=e}catch{}return this}}emitChangeEvents(e){const t={};[...new Set([...Object.keys(this._variations),...Object.keys(e)])].forEach((n=>{const i=e[n];this._variations[n]!==i&&(t[n]=i)})),Object.entries(t).forEach((([e,t])=>{this.emit(`change:${e}`,t)}))}variation(e,t=!1){return this._variations[e]??t}toJSON(){return JSON.parse(JSON.stringify(this._variations))}},ye=["view","origin","status","http","date","message","ddsource","service"],be=["IndexedDB Error","Internal error","Internal error opening backing store for indexedDB.open.","Could not establish connection","No tab with id:",": FILE_ERROR_NO_SPACE (","AbortError","Connection is closing"];const we=new class{globalContext={};batch=[];fetching=null;retryAttempts=0;disabled=!1;constructor(){this.setGlobalContextProperty("service","rr-button")}setGlobalContextProperty(e,t){this.globalContext[e]=t}error(e,t={}){return this.addToBatch(e,t,"error")}warn(e,t={}){return this.addToBatch(e,t,"warn")}info(e,t={}){return this.addToBatch(e,t,"info")}async addToBatch(e,t,n){if(this.disabled)return;this.validateMessageData(e,t);const i={...t,...this.globalContext,ddsource:"browser",message:e,date:Date.now(),http:{useragent:navigator.userAgent},status:n,origin:"logger",view:{referrer:`${self.location.origin}/`,url:`${self.location.origin}/`}};ve.get("ddIgnoreList",be).find((t=>e.toLowerCase().includes(t.toLowerCase())))||(this.batch.push(i),await this.fetching,this.send())}validateMessageData(e,t){Object.keys(t).reduce(((e,t)=>(ye.includes(t)&&e.push(t),e)),[]).length}async send(){if(this.disabled||this.fetching||!this.batch.length)return;const e=this.batch.length;try{this.fetching=this.fetch(this.batch);const t=await this.fetching;if(!t.ok)throw new Error(`DataDog response error: ${t.status}`);this.batch=this.batch.slice(e),this.retryAttempts=0}catch(e){this.retryAttempts<3&&(this.retryAttempts++,clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.send.bind(this),1e4))}finally{this.fetching=null}}fetch(e){return fetch(oe("https://browser-intake-datadoghq.com/api/v2/logs",{ddsource:"browser",ddtags:"api:fetch,datacenter:us","dd-api-key":Me.get("DATADOG_TOKEN"),"dd-evp-origin":"browser","dd-request-id":D()}),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},Ee="keyval",Ae="IndexedDB Error";const xe=new class{dbPromise=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(e,t),o=z(a);return i&&a.addEventListener("upgradeneeded",(e=>{i(z(a.result),e.oldVersion,e.newVersion,z(a.transaction),e)})),n&&a.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}("kv-storage",1,{upgrade(e){e.createObjectStore(Ee)}});getKey(e){return"GBR"===Me.region?`gbr.${e}`:e}async set(e,t){try{const n=await this.dbPromise;await n.put(Ee,t,this.getKey(e))}catch(t){we.error(Ae,{description:t.message,method:"set",key:e.toString()})}}async delete(e){try{const t=await this.dbPromise;await t.delete(Ee,this.getKey(e))}catch(t){we.error(Ae,{description:t.message,method:"delete",key:e.toString()})}}async get(e){try{const t=await this.dbPromise;return await t.get(Ee,this.getKey(e))}catch(t){return we.error(Ae,{description:t.message,method:"get",key:e.toString()}),(t.message.startsWith("Data lost due to missing file.")||t.message.startsWith("Failed to read"))&&this.delete(e),Promise.resolve(void 0)}}async getAllKeys(){return(await this.dbPromise).getAllKeys(Ee)}async getAll(){try{const e=await this.dbPromise;return await e.getAll(Ee)}catch(e){return we.error(Ae,{description:e.message,method:"getAll"}),Promise.resolve(null)}}};self.kvStorage=xe;const Te=xe,Se={locale:"en-US",domain:"www.rakuten.com",cdn:"https://static.rakuten.com",member_api:"https://www.rakuten.com",search_api:"https://search.ecbsn.com",feed_api:"https://api.engager.ecbsn.com",rakuten_api:"https://api.rakuten.com",DATADOG_TOKEN:"pub5c8940d1d60d49fa1ad47b86997d8ed9",SEGMENT_HOST:"https://events.engager.ecbsn.com",SEGMENT_KEY:"RRkzrctEwtmgt8PgYWkF6SzN62oaAiID",FEATUREFLAGS_URL:"https://ffconf.ecbsn.com/featureflags",FEATUREFLAGS_APPID:"1af2274e-266f-4228-8765-b498deb0cc46",FEATUREFLAGS_APIKEY:"c0469223-7cfc-49bc-b1d3-378b71d44817",FEATUREFLAGS_EXPERIMENT_URL:"https://api.rakuten.com/experiment/v4/featureflags_variation",FEATUREFLAGS_EXPERIMENT_APIKEY:"4899e0cf-a5ea-4d81-a5f4-6186e72e23bd",FILLR_DEVKEY:"a157b4f6d3f2d669e92ec47175b7a5b1",FILLR_AUTOFILL_DEVKEY:"0596af22036ba5ce87be02936efeffd3",FILLR_AUTOFILL_SECRETKEY:"Tm1ReU56RTRNR1ptTjJNd09UVTVaakJoTVRZeVptTT0=",FILLR_OCP_DOM_UPLOAD_DEVKEY:"f401eb0b18d9ca5c20ad6e16574b0e27",FILLR_OCP_DOM_UPLOAD_URL:"https://capture.fillr-tech.com/api/v1.0/capture",URL_TERMS:"https://www.rakuten.com/help/category/legal-115001470127",CC_TENANT_ID:1,FACEBOOK_APP_ID:0xc2ee9ccb8e0a,currency:"$",DEFAULT_REFER_BONUS_AMOUNT:"$30",DEFAULT_REDEEM_THRESHOLD_AMOUNT:"$30",DATE_FORMAT:"M/D/YYYY",SETTINGS_URL:"https://www.rakuten.com/toolbar/config/settings.json",MEMBER_BALANCE:"https://api.rakuten.com/earnings_history/v2/regions/usa/members/%uid%/experience/balance_info",MEMBER_EARNINGS_HISTORY:"https://api.rakuten.com/earnings_history/v2/regions/usa/members/%uid%/journals/%journal_id%/entries",WEB_REWARDS:"https://www.rakuten.com/pending-cash-back.htm?tb=yes&ebtoken=%ebtoken&eeid=26117",WEB_PRIVACY_PREFERENCES:"https://www.rakuten.com/privacy-preferences.htm?tb=yes&ebtoken=%ebtoken&eeid=46021",SHELL_PAGE:"https://www.rakuten.com/help/other-questions?sourceName=toolbar",WEB_HELP:"https://www.rakuten.com/help/category/browser-extension-help-26579223731603?tb=yes"},_e={locale:"en-GB",domain:"www.rakuten.co.uk",cdn:"https://static.rakuten.co.uk/",member_api:"https://www.rakuten.co.uk",search_api:"https://search.ecbsn.co.uk",feed_api:"https://api.engager.ecbsn.co.uk",rakuten_api:"https://api.rakuten.co.uk",DATADOG_TOKEN:"pub5c8940d1d60d49fa1ad47b86997d8ed9",FEATUREFLAGS_URL:"https://ffconf.ecbsn.com/featureflags",FEATUREFLAGS_APPID:"1af2274e-266f-4228-8765-b498deb0cc46",FEATUREFLAGS_APIKEY:"c0469223-7cfc-49bc-b1d3-378b71d44817",FEATUREFLAGS_EXPERIMENT_URL:"https://api.rakuten.com/experiment/v4/featureflags_variation",FEATUREFLAGS_EXPERIMENT_APIKEY:"4899e0cf-a5ea-4d81-a5f4-6186e72e23bd",FILLR_DEVKEY:"a157b4f6d3f2d669e92ec47175b7a5b1",FILLR_AUTOFILL_DEVKEY:"0596af22036ba5ce87be02936efeffd3",FILLR_AUTOFILL_SECRETKEY:"Tm1ReU56RTRNR1ptTjJNd09UVTVaakJoTVRZeVptTT0=",FILLR_OCP_DOM_UPLOAD_DEVKEY:"f401eb0b18d9ca5c20ad6e16574b0e27",URL_TERMS:"https://www.rakuten.co.uk/help/category/legal-21732382742163",URL_COOKIE_CONSENT:"https://www.rakuten.co.uk/help/article/cookie-policy-25679829169171",CC_TENANT_ID:11,FACEBOOK_APP_ID:0xc2ee9ccb8e0a,currency:"\xa3",DEFAULT_REFER_BONUS_AMOUNT:"\xa315",DEFAULT_REDEEM_THRESHOLD_AMOUNT:"\xa315",DATE_FORMAT:"D MMMM YYYY",SETTINGS_URL:"https://www.rakuten.co.uk/toolbar/config/gbr/settings.json",MEMBER_BALANCE:"https://api.rakuten.co.uk/earnings_history/v2/regions/gbr/members/%uid%/experience/balance_info",MEMBER_EARNINGS_HISTORY:"https://api.rakuten.co.uk/earnings_history/v2/regions/gbr/members/%uid%/journals/%journal_id%/entries",WEB_REWARDS:"https://www.rakuten.co.uk/account/balance?tb=yes&ebtoken=%ebtoken&eeid=26117",WEB_PRIVACY_PREFERENCES:"https://www.rakuten.co.uk/account/privacy-preferences?tb=yes&ebtoken=%ebtoken&eeid=46021",SHELL_PAGE:"https://www.rakuten.co.uk/help/other-questions?sourceName=toolbar",WEB_HELP:"https://www.rakuten.co.uk/help/category/browser-extension-21732363738515?tb=yes"},ke={locale:"en-US",domain:"www.rakuten.ca"},Ie={"en-US":JSON.parse('{"buttonTitles":{"neutral":"Rakuten: Get Cash Back for Shopping","activated":"Rakuten: Cash Back Activated","available":"Rakuten: Activate to Earn Cash Back"},"daysFromNow":{"endsToday":"Ends Today","endsTomorrow":"Ends Tomorrow","endsDate":"Ends {date}","ended":"Ended"},"reportingMessage":{"45days":"within 45 days after travel has been booked","afterTravel":"after travel has been completed","fewDays":"within a few days after travel has been completed","week":"within a week after travel has been completed","coupleOfWeeks":"within a couple of weeks after travel has been completed","month":"within a month after travel has been completed","sixWeeks":"\'within six weeks after travel has been completed","3Months":"within 3 months after travel has been completed","6Months":"within 6 months after travel has been completed","today":"today","tomorrow":"tomorrow","inAFewDays":"in a few days","oneWeek":"within one week","fewWeeks":"within a few weeks","fewMonths":"within a few months"},"formatCashback":{"tieredCashbackPercentage":"Up to {amount}%","tieredCashbackFixed":"Up to {amount}","offersOnly":"Offers Only","notAvailable":"Not Available"},"currentText":"{amount} Cash Back","taf":{"defaultMessage":"Have you signed up with Rakuten yet? It\'s the best site for earning Cash Back. Get a $10 bonus when you sign up with my invite link and spend $25. It\'s free! [link]","defaultSubject":"Check this out: Get Cash Back for shopping!","twitter":{"postPurchase":"You can get {cashBack} Cash Back at {storeName} when you shop with Rakuten today. \\n\\nJoin with my invite link and you\'ll also get a $30 bonus when you spend $30 on qualifying purchases at 3,500+ stores. \\n{link}"},"email":{"postPurchase":{"subject":"Get Cash Back at {storeName} (thank me later!)","message":"Hey there,\\n\\nYou can get {cashBack} Cash Back at {storeName} when you shop with Rakuten today. \\n\\nJoin with my invite link and you\'ll also get a $30 bonus when you spend $30 on qualifying purchases at 3,500+ stores.\\n\\n{link}\\n\\n"}}},"messages":{"title":"{rewardAmount} just added!","text":"You just earned {rewardAmount} Cash Back from your purchase at {storeName}!","cta":"See Cash Back Activity"}}'),"en-GB":JSON.parse('{"buttonTitles":{"neutral":"Rakuten: Get Cashback for Shopping","activated":"Rakuten: Cashback Activated","available":"Rakuten: Activate to Earn Cashback"},"currentText":"{amount} Cashback","taf":{"defaultMessage":"Have you signed up with Rakuten yet? It\'s the best site for earning Cashback. Get a $10 bonus when you sign up with my invite link and spend $25. It\'s free! [link]","defaultSubject":"Check this out: Get Cashback for shopping!","twitter":{"postPurchase":"You can get {cashBack} Cashback at {storeName} when you shop with Rakuten today. \\n\\nJoin with my invite link and you\'ll also get an extra 10% Cashback on purchases made at 2,500+ stores for 7 days. You can thank me later!\\n{link}"},"email":{"postPurchase":{"subject":"Get Cashback at {storeName} (thank me later!)","message":"Hey there,\\n\\nYou can get {cashBack} Cashback at {storeName} when you shop with Rakuten today. \\n\\nJoin with my invite link and you\'ll also get an extra 10% Cashback on purchases made at 2,500+ stores for 7 days. You can thank me later!\\n\\n{link}\\n\\n"}}},"messages":{"title":"{rewardAmount} just added!","text":"You just earned {rewardAmount} Cashback from your purchase at {storeName}!","cta":"See Cashback Activity"}}'),"fr-CA":JSON.parse('{"buttonTitles":{"neutral":"Rakuten : Obtenez du Cash Back pour vos achats","activated":"Rakuten : Cash Back Activ\xe9","available":"Rakuten : Activez pour gagner du Cash Back"},"daysFromNow":{"endsToday":"Se termine aujourd\'hui","endsTomorrow":"Se termine demain","endsDate":"Se termine le {date}","ended":"Termin\xe9"},"reportingMessage":{"45days":"dans les 45 jours apr\xe8s la r\xe9servation du voyage","afterTravel":"apr\xe8s la fin du voyage","fewDays":"dans les quelques jours suivant la fin du voyage","week":"dans la semaine suivant la fin du voyage","coupleOfWeeks":"dans les deux semaines suivant la fin du voyage","month":"dans le mois suivant la fin du voyage","sixWeeks":"dans les six semaines suivant la fin du voyage","3Months":"dans les 3 mois suivant la fin du voyage","6Months":"dans les 6 mois suivant la fin du voyage","today":"aujourd\'hui","tomorrow":"demain","inAFewDays":"dans quelques jours","oneWeek":"dans une semaine","fewWeeks":"dans quelques semaines","fewMonths":"dans quelques mois"},"formatCashback":{"tieredCashbackPercentage":"Jusqu\'\xe0 {amount}%","tieredCashbackFixed":"Jusqu\'\xe0 {amount}","offersOnly":"Offres uniquement","notAvailable":"Non disponible"},"taf":{"defaultMessage":"Vous \xeates inscrit sur Rakuten ? C\'est le meilleur site pour gagner du Cash Back. Recevez un bonus de 10 \\\\$ lorsque vous vous inscrivez avec mon lien d\'invitation et d\xe9pensez 25 \\\\$. C\'est gratuit ! [link]","defaultSubject":"Regardez \xe7a : Obtenez du Cash Back pour vos achats !","twitter":{"postPurchase":"Vous pouvez obtenir {cashBack} de Cash Back chez {storeName} en achetant avec Rakuten aujourd\'hui. \\\\n\\\\nInscrivez-vous avec mon lien d\'invitation et vous recevrez \xe9galement un bonus de 30 \\\\$ lorsque vous d\xe9penserez 30 \\\\$ sur des achats \xe9ligibles dans plus de 3 500 magasins. \\\\n{link}"},"email":{"postPurchase":{"subject":"Obtenez du Cash Back chez {storeName} (vous me remercierez plus tard !)","message":"Salut,\\\\n\\\\nVous pouvez obtenir {cashBack} de Cash Back chez {storeName} en achetant avec Rakuten aujourd\'hui. \\\\n\\\\nInscrivez-vous avec mon lien d\'invitation et vous recevrez \xe9galement un bonus de 30 \\\\$ lorsque vous d\xe9penserez 30 \\\\$ sur des achats \xe9ligibles dans plus de 3 500 magasins.\\\\n\\\\n{link}\\\\n\\\\n"}}},"messages":{"title":"{rewardAmount} vient d\'\xeatre ajout\xe9 !","text":"Vous venez de gagner {rewardAmount} de Cash Back gr\xe2ce \xe0 votre achat chez {storeName} !","cta":"Voir l\'activit\xe9 de Cash Back"}}')},Ce="en-US";const De=new class{locale=Ce;setLocale(e=Ce){this.locale=e}getRawText(e){const t=Ie,n=e.split(".");n.unshift(this.locale);const i=e.split(".");return i.unshift(Ce),(0,P.get)(t,n)??(0,P.get)(t,i)}get(e,t){let n=this.getRawText(e);if("string"!=typeof n)return e;if(t){const e=[...n.matchAll(/{(.+?)}/g)];if(!e.length)return n;e.forEach((e=>{const i=e[0],r=t[e[1]];n=n?.replace(i,r)}))}return n}};async function Pe(e,t){try{const n=await(s().cookies?.get({url:`https://${e}`,name:t}));return n?.value??""}catch(e){return""}}class Be extends(O()){region=null;homedomain="www.rakuten.com";constructor(){super(),this.configs={USA:Se,GBR:_e,CAN:ke},this.config=this.configs.USA,this.ready=new Promise((e=>{this.once("change",(()=>e(!0)))})),T.extension.attachEvent("getConfig",(async()=>(await this.ready,this.getAll())))}async migrateRegionStorage(){let e="USA";if(await T.extension.getItem("installVersion")!==R().version){await Te.get("gbr.merchants")&&(e="GBR")}return await this.saveRegion(e),e}async detectRegion(){const e="GBR"===await Pe(Me.homedomain,"extension-install-region")?"GBR":"USA";return await this.saveRegion(e),e}async saveRegion(e){return["USA","GBR","CAN"].includes(e),T.extension.setItem("region",e)}async saveLocale(e){e!==await T.extension.getItem("locale")&&(De.setLocale(e),this.config.locale=e,T.extension.setItem("locale",e))}async setRegion(e){const t=await T.extension.getItem("region");if(this.region=e,this.config=this.configs[e],t===e&&t){const e=await T.extension.getItem("locale");De.setLocale(e),e&&e!==this.config.locale&&(this.config.locale=e)}else{const t=this.get("locale",e);De.setLocale(t),T.extension.setItem("locale",t)}this.emit("change",e)}get(e,t){return t?this.configs[t][e]:this.config[e]}getAll(){return this.config}}const Me=new Be;function Re(e,t,n){return"string"==typeof e&&e.startsWith("/")&&(n&&n.search(/pattern/i)<0||!n)?t?Oe(t+e):e.search(/\.(png|jpg|jpeg|gif|svg)$/)>0?Oe(`${Me.get("cdn")}${e}`):Oe(B.BASE+e):"object"==typeof e&&null!==e?Ne(e,t):e}function Ne(e,t){return(0,P.isArray)(e)?(0,P.map)(e,((e,n)=>Re(e,t,n))):(0,P.mapObject)(e,((e,n)=>Re(e,t,n)))}function Oe(e,t={}){const n=self.EBATES?.member,i=self.EBATES?.ebToken??"",r={domain:Me.get("domain"),rakuten_api:Me.get("rakuten_api"),member_api:Me.get("member_api"),search_api:Me.get("search_api"),feed_api:Me.get("feed_api"),cdn:Me.get("cdn"),version:R().version,browser:T.browser.name.toLowerCase().replace(/ /gi,"").replace("webkitedge","edge"),installVersion:self.EBATES?.installVersion??"",toolbarId:self.EBATES?.toolbarId??"",ebtoken:i,targetSet:n?.get("targetSet")??"",uid:n?.id??"",visitId:self.EBATES?.holistic?.visit_id??""};return Object.entries({...r,...t}).reduce(((e,[t,n])=>e.replace(new RegExp(`%${t}%?`,"g"),n)),Re(e))}function Le(e){if(e&&!e.startsWith("data:")){const t=/(?:https?:\/\/)?(?:\w+:\/)?[^:?#/\s]*?([^.\s]+\.(?:[a-z]{2,}|co\.uk|org\.uk|ac\.uk|org\.au|com\.au))(?:[:?#/]|$)/gi.exec(e);return t?t[1].toLowerCase():null}return null}let je=function(e){return e.SurfaceVisited="SurfaceVisited",e.ApplicationInstalled="ApplicationInstalled",e.HoverDismissed="HoverDismissed",e.HoverViewed="HoverViewed",e.ShoppingTripStarted="ShoppingTripStarted",e.PriceMagicMismatch="PriceMagicMismatch",e.MerchantTripStarted="MerchantTripStarted",e.MerchantPageViewed="MerchantPageViewed",e.SerpContentInjected="SerpContentInjected",e.PostPurchaseExperienceViewed="PostPurchaseExperienceViewed",e.PostPurchaseExperienceClicked="PostPurchaseExperienceClicked",e.SerpContentViewed="SerpContentViewed",e.SerpContentClicked="SerpContentClicked",e.DialogViewed="DialogViewed",e.ApplicationDetected="ApplicationDetected",e.ReferAFriendViewed="ReferAFriendViewed",e.ReferAFriendStarted="ReferAFriendStarted",e.ReferAFriendCompleted="ReferAFriendCompleted",e.WebsiteVisited="WebsiteVisited",e.ConfirmationHoverViewed="ConfirmationHoverViewed",e.CartDetailsCaptured="CartDetailsCaptured",e.StandDownTriggered="StandDownTriggered",e.ButtonClicked="ButtonClicked",e.OrderConfirmationPageViewed="OrderConfirmationPageViewed",e.OrderPlaced="OrderPlaced",e.PageViewed="PageViewed",e.CouponApplied="Coupon Applied",e.CouponCaptured="Coupon Captured",e}({});const Ue={[je.SurfaceVisited]:{type:"Surface Visited",schema_id:2346,send_integration_data:!0},[je.ApplicationInstalled]:{type:"Application Installed",schema_id:2419,send_integration_data:!0},[je.HoverViewed]:{type:"Hover Viewed",schema_id:2371,send_integration_data:!0},[je.HoverDismissed]:{type:"Hover Dismissed",schema_id:997},[je.PriceMagicMismatch]:{type:"Price Magic Mismatch",schema_id:748},[je.ShoppingTripStarted]:{type:"Shopping Trip Started",schema_id:2347,send_integration_data:!0},[je.MerchantTripStarted]:{type:"Merchant Trip Started",schema_id:1334},[je.MerchantPageViewed]:{type:"Merchant Page Viewed",schema_id:1356},[je.SerpContentInjected]:{type:"Serp Content Injected",schema_id:970},[je.SerpContentViewed]:{type:"Serp Content Viewed",schema_id:1970},[je.SerpContentClicked]:{type:"Serp Content Clicked",schema_id:1969},[je.DialogViewed]:{type:"Dialog Viewed",schema_id:2411},[je.ApplicationDetected]:{type:"Application Detected",schema_id:2297,send_integration_data:!0},[je.ReferAFriendViewed]:{type:"Refer A Friend Viewed",schema_id:1087},[je.PostPurchaseExperienceViewed]:{type:"Post Purchase Experience Viewed",schema_id:1633},[je.PostPurchaseExperienceClicked]:{type:"Post Purchase Experience Clicked",schema_id:1315},[je.ReferAFriendStarted]:{type:"Refer A Friend Started",schema_id:1089},[je.ReferAFriendCompleted]:{type:"Refer A Friend Completed",schema_id:1088},[je.WebsiteVisited]:{type:"Website Visited",schema_id:2313,send_integration_data:!0},[je.ConfirmationHoverViewed]:{type:"Confirmation Hover Viewed",schema_id:1260},[je.CartDetailsCaptured]:{type:"Cart Details Captured",schema_id:1543},[je.StandDownTriggered]:{type:"Stand Down Triggered",schema_id:1456},[je.ButtonClicked]:{type:"Button Clicked",schema_id:1389},[je.OrderConfirmationPageViewed]:{type:"Order Confirmation Page Viewed",schema_id:1563},[je.OrderPlaced]:{type:"Order Placed",schema_id:1564},[je.PageViewed]:{type:"Page Viewed",schema_id:1580},[je.CouponApplied]:{type:"Coupon Applied",schema_id:1923},[je.CouponCaptured]:{type:"Coupon Captured",schema_id:1867}};async function Fe(){T.extension.attachEvent("SurfaceVisitedData",(async function e({tabId:t,data:i}){if(t===n){const{referring_visit_id:t,campaign:n,legacy_campaign:r}=i;self.EBATES.holistic.track(je.SurfaceVisited,{data:{...Object.keys(n).length&&{campaign:n},...Object.keys(r).length&&{legacy_campaign:r},...t&&{referring_visit_id:t}}}),T.extension.detachEvent("SurfaceVisitedData",e)}}));const e=await Pe(Me.homedomain,"extension-install-source").catch((()=>"")),{url:t,tabId:n}=await async function(e){let t;if(/(?:step2|EB-Test1\d{2,}A)/.test(e)){t=Oe("%domain%?sourceName=toolbar&eeid=45426&toolbarId=%toolbarId&visit_id=%visitId");return{url:t,tabId:(await T.browser.navigate({url:t,tabId:T.browser.NEWTAB},(({id:e})=>{setTimeout((()=>T.extension.fireEvent("welcome",{tabId:e})),2500)}))).id}}return t=Oe(B.WEB_INSTALL),{url:t,tabId:(await T.browser.navigate(t)).id}}(e),i=await async function(){try{const e="JSESSIONID";return await Pe(Me.get("domain"),e)||new Promise((t=>{function n({cookie:r}){r.domain===Me.get("domain")&&r.name===e&&r.value&&(clearTimeout(i),s().cookies.onChanged.removeListener(n),t(r.value))}s().cookies?.onChanged.addListener(n);const i=setTimeout((()=>{s().cookies?.onChanged.removeListener(n),t("")}),8e3)}))}catch{return""}}(),r=await new Promise((e=>{chrome?.instanceID?.getID?chrome.instanceID.getID(e):e(null)}));await T.extension.setItem("installationSource",e),await T.extension.setItem("installSessionId",i),T.browser.isWebkit&&s().windows.getAll({populate:!0}).then((e=>{e.forEach((e=>{e?.tabs?.forEach((({id:e,url:t})=>{t?.includes(Oe("%domain/button-landing/"))&&s().tabs.update(e,{url:t})}))}))})),self.EBATES.segment.track("Install Application",{attribution_source:e,desktop_session_id:i,url:t,instanceId:r}),self.EBATES.holistic.track(je.ApplicationInstalled,{data:{attribution_source:e}})}const $e="toolbar",qe="merchant",He="groupon",We="business\u0421ard",Ve="homeDomain",Ge="inStoreCashBack",ze="priceMagic",Ke="processInterstitial",Je="product-page-tracker",Ye="SERP",Xe="hotelsWidget",Ze="taxesPromo",Qe="InstalledExtensions",et="CouponScraper",tt="similarStores",nt="TcppNotification",it="PromoNotification",rt="increasedCBNotification";let st=function(e){return e[e.DEFAULT=4]="DEFAULT",e[e.PRICE_MAGIC=23]="PRICE_MAGIC",e[e.SHOPSTYLE=12]="SHOPSTYLE",e[e.BUTTON_COMPETITOR_BANNER=29]="BUTTON_COMPETITOR_BANNER",e[e.BUTTON_SERP_ADS=131]="BUTTON_SERP_ADS",e[e.COMMERCE_MEDIA=132]="COMMERCE_MEDIA",e}({});const at={[st.DEFAULT]:"BUTTON",[st.PRICE_MAGIC]:"BUTTON_PRICE_MAGIC",[st.SHOPSTYLE]:"SHOPSTYLE",[st.BUTTON_COMPETITOR_BANNER]:"BUTTON_COMPETITOR_BANNER",[st.BUTTON_SERP_ADS]:"BUTTON_SERP_ADS",[st.COMMERCE_MEDIA]:"BUTTON_COMMERCE_MEDIA"};let ot=function(e){return e[e.TAKEOVER_PREVENTION=38448]="TAKEOVER_PREVENTION",e[e.MPL_STORE=40874]="MPL_STORE",e[e.SHARE_EMAIL=45829]="SHARE_EMAIL",e[e.SHARE_COPY=45830]="SHARE_COPY",e[e.SHARE_FACEBOOK=45831]="SHARE_FACEBOOK",e[e.SHARE_TWITTER=45832]="SHARE_TWITTER",e[e.SHARE_POST_PURCHASE_NOTIFICATION=57122]="SHARE_POST_PURCHASE_NOTIFICATION",e[e.SHARE_RAF_PRODUCT_PAGE=61593]="SHARE_RAF_PRODUCT_PAGE",e[e.PROMO_SERP_BANNER=63100]="PROMO_SERP_BANNER",e}({});const ct="store/radiant-generic/button/store-deals",ut="button/my-deals",lt="button/notification",ht="button/serp-ad-feed",dt="button/similar-stores-feed",ft="Post-Purchase notification",pt="PDP Product Share Widget",gt="Coupons and Cash Back Available Notification - CB CTA",mt="Coupon Magic Results with CB CTA",vt="BTN200",yt="price-magic-test-extension",bt="BTN213",wt="hybrid-background-activation-extension",Et="BTN216",At="BTN220",xt="promo-notification-extension",Tt="BTN227",St="extension-anonymous-xfas",_t="extension-hotels-widget",kt="use-bookkeeper-api-and-design-for-extension-in-all-regions",It="extension-notification-cashback-increase",Ct="extension-anonymous-shopping",Dt="extension-acs-for-anon-users",Pt="acs-for-on-platform-extension",Bt="extension-anonymous-susi-modal",Mt="ca-without-savings",Rt="www\\.google\\.com\\/search",Nt={MONTH:2592e6,WEEK:6048e5,DAY:864e5,HOUR:36e5,MINUTE:6e4};function Ot(e){if(e){const t=e.match(/\.(.*)\./);try{if(t&&t.length>0){const e=t.pop()??"";return JSON.parse(atob(e))}}catch{}}return null}function Lt({url:e,width:t=650,height:n=400,screen:i}){if(T.browser.isSafari)T.browser.navigate(e);else{const r=Math.floor((i.availWidth-t)/2),a=Math.floor((i.availHeight-n)/2);s().windows.create({type:"popup",height:n,width:t,top:r,left:a,url:e})}}const jt=self.ServiceWorkerGlobalScope&&self instanceof self.ServiceWorkerGlobalScope;function Ut(e){return"number"==typeof e&&Number.isFinite(e)}const Ft=Date.now();let $t=null;function qt(){s().runtime.onConnect.addListener((e=>{"popup"===e.name&&($t={startTime:Date.now(),timings:{}},e.onMessage.addListener((e=>{$t&&($t.timings=e.timings,function(e){if(!$t)return;const t=Date.now(),n=t-$t.startTime;if(n<5e3)return;const{timings:i}=$t,r=["account","currentTab","overlays","getPopupStore","settings"].filter((e=>!(e in i)));we.warn("longPopupLoading",{reason:e,duration:n,sinceExtensionStart:t-Ft,timings:$t.timings||{},missingServices:r})}(e.type),$t=null)})))}))}class Ht extends Map{scriptLoadingProcess=new Map;constructor(){super();const e=({tabId:e,url:t,name:n})=>{const i=Object.assign({},this.get(e),{tabId:e,url:t});n===T.browser.NAVIGATIONCOMMITTED&&(i.scripts=[]),this.set(e,i)};this.getCurrentActiveTab().then((t=>{t&&e({...t,name:"tabsInit"})})),T.browser.attachEvent(T.browser.NAVIGATIONCOMMITTED,e),T.browser.attachEvent(T.browser.TABCHANGED,e),T.browser.attachEvent(T.browser.TABCLOSED,(e=>this.delete(e.tabId))),T.extension.attachEvent("currentTab",(()=>this.getActive()))}async getActive(){try{const[{id:e=0,url:t="about:blank"}={id:0,url:"about:blank"}]=await s().tabs.query({active:!0,currentWindow:!0});return{tabId:e,url:t}}catch{return{tabId:0,url:"about:blank"}}}async executeScript({tabId:e,files:t,signal:n,injectImmediately:i=!1}){Array.isArray(t)||(t=[t]),await this.scriptLoadingProcess.get(e);const r=(async()=>{try{const[r]=await s().scripting.executeScript({target:{tabId:e},injectImmediately:i,func:()=>self["__extension-scripts-loaded"]});r?.result||n?.aborted||(await s().scripting.executeScript({injectImmediately:i,target:{tabId:e},files:t}),await s().scripting.executeScript({injectImmediately:i,target:{tabId:e},func:()=>{self["__extension-scripts-loaded"]=!0}}))}catch(e){}})();this.scriptLoadingProcess.set(e,r);try{await r}finally{this.scriptLoadingProcess.delete(e)}return!0}async getCurrentActiveTab(){const e=await s().tabs.query({active:!0,currentWindow:!0});if(!e.length)return null;const t=e[0],{id:n=0,url:i=""}=t;return{tabId:n,url:i}}}const Wt=new Ht;function Vt(e,t){return e.map((e=>e.replace(/[.+?^${}()[\]\\]/g,"\\$&").replace(/\*/g,".*"))).some((e=>new RegExp(e).test(t)))}function Gt({tabId:e,url:t}){const n=Wt.get(e);if(n?.competitorActivation){const i=EBATES.merchants.match(t,e);if(!i?.session.get("activated"))return;const r=i?.session.shoppingTrip.get("ttn"),s=i?.session.shoppingTrip.get("competitors")??[],a=s.find((({name:e,ttn:t})=>e===n.competitorActivation.name&&t===r));if(i&&"show"===a?.state){n.competitorActivation.timeout&&self.clearTimeout(n.competitorActivation.timeout),a.state="activated";const o=s.filter((e=>e.name!==n.competitorActivation.name));o.push(a),i.session.shoppingTrip.set("competitors",o);let c={};try{c=new URL(t)}catch{}EBATES.segment.track("Competitor Activated",{store_id:i.get("storeId"),url:`${c.host}${c.pathname}`,tracking_ticket:r,type:n.competitorActivation.name}),Wt.delete(e)}}else{const n=3e4;(EBATES.settings.standDown??[]).forEach((i=>{if(Vt(i.activationPattern??[],t)){const r=self.setTimeout((()=>{Wt.delete(e)}),n);Wt.set(e,{competitorActivation:{name:i.name,timeout:r},url:t,tabId:e})}}))}}function zt(e=[]){if(!T.browser.isChrome||!e?.length)return;let t=[];try{t=e.reduce(((e,t)=>(t.ui?.urlPattern&&e.push(...t.ui.urlPattern),t.activationPattern&&e.push(...t.activationPattern),e)),[])}catch{}t.length&&s().webRequest.onBeforeRequest.addListener((({initiator:e="",tabId:t,url:n,type:i})=>{try{"main_frame"===i?Gt({tabId:t,url:n}):async function({initiator:e,tabId:t,url:n,type:i}){const r=EBATES.merchants.match(`${e}/`,t);if(!r?.session?.get("activated"))return;const s=r.session.shoppingTrip.get("ttn"),a=(EBATES.settings.standDown??[]).find((e=>e.ui&&Vt(e.ui.urlPattern,n)&&e.ui.type.includes(i)));if(!a)return;const o=r.session.shoppingTrip.get("competitors")??[],c=o.find((e=>a.name===e.name&&s===e.ttn));if("show"===c?.state||"activated"===c?.state)return;const u={name:a.name,state:"show",ttn:s};let l=o;c&&(l=o.filter((e=>e.name!==c.name))),l.push(u),r.session.shoppingTrip.set("competitors",l);const h=await Wt.getActive();let d={};try{d=new URL(h.url)}catch{}EBATES.segment.track("View Competitor UI",{store_id:r.get("storeId"),store_domain:r.get("domainName"),url:`${d.host}${d.pathname}`,tracking_ticket:s,type:a.name,competitor:a.name,guessed_page_type:r.session.get("guessedPageType")})}({initiator:e,tabId:t,url:n,type:i})}catch(e){}}),{urls:t})}class Kt{storage=new Map;isExclamationMarkActive=!1;constructor(){T.extension.attachEvent("updateBadge",(()=>{this.update()}))}init(){const e=EBATES.settings.userSettings.get("badgeExclamationMark");e&&(this.isExclamationMarkActive=e)}async update(e,t){self.EBATES.member.isTcppBlocking()?this.setExclamationMark():(this.setDefaultColors(),self.EBATES.settings.userSettings.get("gatingStatusBadge")?T.ui.button.setBadgeText("1"):self.EBATES.member.isExtensionDisabled()?T.ui.button.setBadgeText(""):(e&&this.storage.set(e,t??0),this.display()))}setExclamationMark(){T.ui.button.setBadgeText("!"),T.ui.button.setBadgeBackgroundColor("red"),T.ui.button.setBadgeTextColor("white"),this.saveExclamationMarkValue(!0)}setDefaultColors(){this.isExclamationMarkActive&&(T.ui.button.setBadgeBackgroundColor("black"),T.ui.button.setBadgeTextColor("white"),this.saveExclamationMarkValue(!1))}display(){let e=0;this.storage.forEach((t=>e+=t)),this.set(e)}set(e){T.ui.button.setBadgeText(e>0?e:"")}saveExclamationMarkValue(e){this.isExclamationMarkActive=e,EBATES.settings.userSettings.save({badgeExclamationMark:e})}}function Jt(e){return Array.isArray?Array.isArray(e):"[object Array]"===nn(e)}function Yt(e){return"string"==typeof e}function Xt(e){return"number"==typeof e}function Zt(e){return!0===e||!1===e||function(e){return Qt(e)&&null!==e}(e)&&"[object Boolean]"==nn(e)}function Qt(e){return"object"==typeof e}function en(e){return null!=e}function tn(e){return!e.trim().length}function nn(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const rn=Object.prototype.hasOwnProperty;class sn{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach((e=>{let n=an(e);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight})),this._keys.forEach((e=>{e.weight/=t}))}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function an(e){let t=null,n=null,i=null,r=1,s=null;if(Yt(e)||Jt(e))i=e,t=on(e),n=cn(e);else{if(!rn.call(e,"name"))throw new Error((e=>`Missing ${e} property in key`)("name"));const a=e.name;if(i=a,rn.call(e,"weight")&&(r=e.weight,r<=0))throw new Error((e=>`Property 'weight' in key '${e}' must be a positive integer`)(a));t=on(a),n=cn(a),s=e.getFn}return{path:t,id:n,weight:r,src:i,getFn:s}}function on(e){return Jt(e)?e:e.split(".")}function cn(e){return Jt(e)?e.join("."):e}var un={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.6,distance:100,...{useExtendedSearch:!1,getFn:function(e,t){let n=[],i=!1;const r=(e,t,s)=>{if(en(e))if(t[s]){const a=e[t[s]];if(!en(a))return;if(s===t.length-1&&(Yt(a)||Xt(a)||Zt(a)))n.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(a));else if(Jt(a)){i=!0;for(let e=0,n=a.length;e<n;e+=1)r(a[e],t,s+1)}else t.length&&r(a,t,s+1)}else n.push(e)};return r(e,Yt(t)?t.split("."):t,0),i?n:n[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1}};const ln=/[^ ]+/g;class hn{constructor({getFn:e=un.getFn,fieldNormWeight:t=un.fieldNormWeight}={}){this.norm=function(e=1,t=3){const n=new Map,i=Math.pow(10,t);return{get(t){const r=t.match(ln).length;if(n.has(r))return n.get(r);const s=1/Math.pow(r,.5*e),a=parseFloat(Math.round(s*i)/i);return n.set(r,a),a},clear(){n.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach(((e,t)=>{this._keysMap[e.id]=t}))}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,Yt(this.docs[0])?this.docs.forEach(((e,t)=>{this._addString(e,t)})):this.docs.forEach(((e,t)=>{this._addObject(e,t)})),this.norm.clear())}add(e){const t=this.size();Yt(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!en(e)||tn(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach(((t,i)=>{let r=t.getFn?t.getFn(e):this.getFn(e,t.path);if(en(r))if(Jt(r)){let e=[];const t=[{nestedArrIndex:-1,value:r}];for(;t.length;){const{nestedArrIndex:n,value:i}=t.pop();if(en(i))if(Yt(i)&&!tn(i)){let t={v:i,i:n,n:this.norm.get(i)};e.push(t)}else Jt(i)&&i.forEach(((e,n)=>{t.push({nestedArrIndex:n,value:e})}))}n.$[i]=e}else if(Yt(r)&&!tn(r)){let e={v:r,n:this.norm.get(r)};n.$[i]=e}})),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function dn(e,t,{getFn:n=un.getFn,fieldNormWeight:i=un.fieldNormWeight}={}){const r=new hn({getFn:n,fieldNormWeight:i});return r.setKeys(e.map(an)),r.setSources(t),r.create(),r}function fn(e,{errors:t=0,currentLocation:n=0,expectedLocation:i=0,distance:r=un.distance,ignoreLocation:s=un.ignoreLocation}={}){const a=t/e.length;if(s)return a;const o=Math.abs(i-n);return r?a+o/r:o?1:a}const pn=32;function gn(e,t,n,{location:i=un.location,distance:r=un.distance,threshold:s=un.threshold,findAllMatches:a=un.findAllMatches,minMatchCharLength:o=un.minMatchCharLength,includeMatches:c=un.includeMatches,ignoreLocation:u=un.ignoreLocation}={}){if(t.length>pn)throw new Error(`Pattern length exceeds max of ${pn}.`);const l=t.length,h=e.length,d=Math.max(0,Math.min(i,h));let f=s,p=d;const g=o>1||c,m=g?Array(h):[];let v;for(;(v=e.indexOf(t,p))>-1;){let e=fn(t,{currentLocation:v,expectedLocation:d,distance:r,ignoreLocation:u});if(f=Math.min(e,f),p=v+l,g){let e=0;for(;e<l;)m[v+e]=1,e+=1}}p=-1;let y=[],b=1,w=l+h;const E=1<<l-1;for(let i=0;i<l;i+=1){let s=0,o=w;for(;s<o;){fn(t,{errors:i,currentLocation:d+o,expectedLocation:d,distance:r,ignoreLocation:u})<=f?s=o:w=o,o=Math.floor((w-s)/2+s)}w=o;let c=Math.max(1,d-o+1),v=a?h:Math.min(d+o,h)+l,A=Array(v+2);A[v+1]=(1<<i)-1;for(let s=v;s>=c;s-=1){let a=s-1,o=n[e.charAt(a)];if(g&&(m[a]=+!!o),A[s]=(A[s+1]<<1|1)&o,i&&(A[s]|=(y[s+1]|y[s])<<1|1|y[s+1]),A[s]&E&&(b=fn(t,{errors:i,currentLocation:a,expectedLocation:d,distance:r,ignoreLocation:u}),b<=f)){if(f=b,p=a,p<=d)break;c=Math.max(1,2*d-p)}}if(fn(t,{errors:i+1,currentLocation:d,expectedLocation:d,distance:r,ignoreLocation:u})>f)break;y=A}const A={isMatch:p>=0,score:Math.max(.001,b)};if(g){const e=function(e=[],t=un.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let a=e.length;s<a;s+=1){let a=e[s];a&&-1===i?i=s:a||-1===i||(r=s-1,r-i+1>=t&&n.push([i,r]),i=-1)}return e[s-1]&&s-i>=t&&n.push([i,s-1]),n}(m,o);e.length?c&&(A.indices=e):A.isMatch=!1}return A}function mn(e){let t={};for(let n=0,i=e.length;n<i;n+=1){const r=e.charAt(n);t[r]=(t[r]||0)|1<<i-n-1}return t}const vn=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class yn{constructor(e,{location:t=un.location,threshold:n=un.threshold,distance:i=un.distance,includeMatches:r=un.includeMatches,findAllMatches:s=un.findAllMatches,minMatchCharLength:a=un.minMatchCharLength,isCaseSensitive:o=un.isCaseSensitive,ignoreDiacritics:c=un.ignoreDiacritics,ignoreLocation:u=un.ignoreLocation}={}){if(this.options={location:t,threshold:n,distance:i,includeMatches:r,findAllMatches:s,minMatchCharLength:a,isCaseSensitive:o,ignoreDiacritics:c,ignoreLocation:u},e=o?e:e.toLowerCase(),e=c?vn(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const l=(e,t)=>{this.chunks.push({pattern:e,alphabet:mn(e),startIndex:t})},h=this.pattern.length;if(h>pn){let e=0;const t=h%pn,n=h-t;for(;e<n;)l(this.pattern.substr(e,pn),e),e+=pn;if(t){const e=h-pn;l(this.pattern.substr(e),e)}}else l(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:n,includeMatches:i}=this.options;if(e=t?e:e.toLowerCase(),e=n?vn(e):e,this.pattern===e){let t={isMatch:!0,score:0};return i&&(t.indices=[[0,e.length-1]]),t}const{location:r,distance:s,threshold:a,findAllMatches:o,minMatchCharLength:c,ignoreLocation:u}=this.options;let l=[],h=0,d=!1;this.chunks.forEach((({pattern:t,alphabet:n,startIndex:f})=>{const{isMatch:p,score:g,indices:m}=gn(e,t,n,{location:r+f,distance:s,threshold:a,findAllMatches:o,minMatchCharLength:c,includeMatches:i,ignoreLocation:u});p&&(d=!0),h+=g,p&&m&&(l=[...l,...m])}));let f={isMatch:d,score:d?h/this.chunks.length:1};return d&&i&&(f.indices=l),f}}class bn{constructor(e){this.pattern=e}static isMultiMatch(e){return wn(e,this.multiRegex)}static isSingleMatch(e){return wn(e,this.singleRegex)}search(){}}function wn(e,t){const n=e.match(t);return n?n[1]:null}class En extends bn{constructor(e,{location:t=un.location,threshold:n=un.threshold,distance:i=un.distance,includeMatches:r=un.includeMatches,findAllMatches:s=un.findAllMatches,minMatchCharLength:a=un.minMatchCharLength,isCaseSensitive:o=un.isCaseSensitive,ignoreDiacritics:c=un.ignoreDiacritics,ignoreLocation:u=un.ignoreLocation}={}){super(e),this._bitapSearch=new yn(e,{location:t,threshold:n,distance:i,includeMatches:r,findAllMatches:s,minMatchCharLength:a,isCaseSensitive:o,ignoreDiacritics:c,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class An extends bn{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,n=0;const i=[],r=this.pattern.length;for(;(t=e.indexOf(this.pattern,n))>-1;)n=t+r,i.push([t,n-1]);const s=!!i.length;return{isMatch:s,score:s?0:1,indices:i}}}const xn=[class extends bn{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},An,class extends bn{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends bn{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends bn{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends bn{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends bn{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},En],Tn=xn.length,Sn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const _n=new Set([En.type,An.type]);class kn{constructor(e,{isCaseSensitive:t=un.isCaseSensitive,ignoreDiacritics:n=un.ignoreDiacritics,includeMatches:i=un.includeMatches,minMatchCharLength:r=un.minMatchCharLength,ignoreLocation:s=un.ignoreLocation,findAllMatches:a=un.findAllMatches,location:o=un.location,threshold:c=un.threshold,distance:u=un.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:n,includeMatches:i,minMatchCharLength:r,findAllMatches:a,ignoreLocation:s,location:o,threshold:c,distance:u},e=t?e:e.toLowerCase(),e=n?vn(e):e,this.pattern=e,this.query=function(e,t={}){return e.split("|").map((e=>{let n=e.trim().split(Sn).filter((e=>e&&!!e.trim())),i=[];for(let e=0,r=n.length;e<r;e+=1){const r=n[e];let s=!1,a=-1;for(;!s&&++a<Tn;){const e=xn[a];let n=e.isMultiMatch(r);n&&(i.push(new e(n,t)),s=!0)}if(!s)for(a=-1;++a<Tn;){const e=xn[a];let n=e.isSingleMatch(r);if(n){i.push(new e(n,t));break}}}return i}))}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:i,ignoreDiacritics:r}=this.options;e=i?e:e.toLowerCase(),e=r?vn(e):e;let s=0,a=[],o=0;for(let i=0,r=t.length;i<r;i+=1){const r=t[i];a.length=0,s=0;for(let t=0,i=r.length;t<i;t+=1){const i=r[t],{isMatch:c,indices:u,score:l}=i.search(e);if(!c){o=0,s=0,a.length=0;break}if(s+=1,o+=l,n){const e=i.constructor.type;_n.has(e)?a=[...a,...u]:a.push(u)}}if(s){let e={isMatch:!0,score:o/s};return n&&(e.indices=a),e}}return{isMatch:!1,score:1}}}const In=[];function Cn(e,t){for(let n=0,i=In.length;n<i;n+=1){let i=In[n];if(i.condition(e,t))return new i(e,t)}return new yn(e,t)}const Dn="$and",Pn="$or",Bn="$path",Mn="$val",Rn=e=>!(!e[Dn]&&!e[Pn]),Nn=e=>({[Dn]:Object.keys(e).map((t=>({[t]:e[t]})))});function On(e,t,{auto:n=!0}={}){const i=e=>{let r=Object.keys(e);const s=(e=>!!e[Bn])(e);if(!s&&r.length>1&&!Rn(e))return i(Nn(e));if((e=>!Jt(e)&&Qt(e)&&!Rn(e))(e)){const i=s?e[Bn]:r[0],a=s?e[Mn]:e[i];if(!Yt(a))throw new Error((e=>`Invalid value for key ${e}`)(i));const o={keyId:cn(i),pattern:a};return n&&(o.searcher=Cn(a,t)),o}let a={children:[],operator:r[0]};return r.forEach((t=>{const n=e[t];Jt(n)&&n.forEach((e=>{a.children.push(i(e))}))})),a};return Rn(e)||(e=Nn(e)),i(e)}function Ln(e,t){const n=e.matches;t.matches=[],en(n)&&n.forEach((e=>{if(!en(e.indices)||!e.indices.length)return;const{indices:n,value:i}=e;let r={indices:n,value:i};e.key&&(r.key=e.key.src),e.idx>-1&&(r.refIndex=e.idx),t.matches.push(r)}))}function jn(e,t){t.score=e.score}class Un{constructor(e,t={},n){this.options={...un,...t},this.options.useExtendedSearch,this._keyStore=new sn(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof hn))throw new Error("Incorrect 'index' type");this._myIndex=t||dn(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){en(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let n=0,i=this._docs.length;n<i;n+=1){const r=this._docs[n];e(r,n)&&(this.removeAt(n),n-=1,i-=1,t.push(r))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:n,includeScore:i,shouldSort:r,sortFn:s,ignoreFieldNorm:a}=this.options;let o=Yt(e)?Yt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,{ignoreFieldNorm:t=un.ignoreFieldNorm}){e.forEach((e=>{let n=1;e.matches.forEach((({key:e,norm:i,score:r})=>{const s=e?e.weight:null;n*=Math.pow(0===r&&s?Number.EPSILON:r,(s||1)*(t?1:i))})),e.score=n}))}(o,{ignoreFieldNorm:a}),r&&o.sort(s),Xt(t)&&t>-1&&(o=o.slice(0,t)),function(e,t,{includeMatches:n=un.includeMatches,includeScore:i=un.includeScore}={}){const r=[];return n&&r.push(Ln),i&&r.push(jn),e.map((e=>{const{idx:n}=e,i={item:t[n],refIndex:n};return r.length&&r.forEach((t=>{t(e,i)})),i}))}(o,this._docs,{includeMatches:n,includeScore:i})}_searchStringList(e){const t=Cn(e,this.options),{records:n}=this._myIndex,i=[];return n.forEach((({v:e,i:n,n:r})=>{if(!en(e))return;const{isMatch:s,score:a,indices:o}=t.searchIn(e);s&&i.push({item:e,idx:n,matches:[{score:a,value:e,norm:r,indices:o}]})})),i}_searchLogical(e){const t=On(e,this.options),n=(e,t,i)=>{if(!e.children){const{keyId:n,searcher:r}=e,s=this._findMatches({key:this._keyStore.get(n),value:this._myIndex.getValueForItemAtKeyId(t,n),searcher:r});return s&&s.length?[{idx:i,item:t,matches:s}]:[]}const r=[];for(let s=0,a=e.children.length;s<a;s+=1){const a=e.children[s],o=n(a,t,i);if(o.length)r.push(...o);else if(e.operator===Dn)return[]}return r},i=this._myIndex.records,r={},s=[];return i.forEach((({$:e,i})=>{if(en(e)){let a=n(t,e,i);a.length&&(r[i]||(r[i]={idx:i,item:e,matches:[]},s.push(r[i])),a.forEach((({matches:e})=>{r[i].matches.push(...e)})))}})),s}_searchObjectList(e){const t=Cn(e,this.options),{keys:n,records:i}=this._myIndex,r=[];return i.forEach((({$:e,i})=>{if(!en(e))return;let s=[];n.forEach(((n,i)=>{s.push(...this._findMatches({key:n,value:e[i],searcher:t}))})),s.length&&r.push({idx:i,item:e,matches:s})})),r}_findMatches({key:e,value:t,searcher:n}){if(!en(t))return[];let i=[];if(Jt(t))t.forEach((({v:t,i:r,n:s})=>{if(!en(t))return;const{isMatch:a,score:o,indices:c}=n.searchIn(t);a&&i.push({score:o,key:e,value:t,idx:r,norm:s,indices:c})}));else{const{v:r,n:s}=t,{isMatch:a,score:o,indices:c}=n.searchIn(r);a&&i.push({score:o,key:e,value:r,norm:s,indices:c})}return i}}Un.version="7.1.0",Un.createIndex=dn,Un.parseIndex=function(e,{getFn:t=un.getFn,fieldNormWeight:n=un.fieldNormWeight}={}){const{keys:i,records:r}=e,s=new hn({getFn:t,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s},Un.config=un,Un.parseQuery=On,function(...e){In.push(...e)}(kn);var Fn=r(36337),$n=r.n(Fn);$n().ajax=he;const qn=$n();var Hn=r(7059),Wn=r.n(Hn);function Vn(e){return e.replace(/\.\*$/,"").replace(/^\.\*/,"").replace(/([a-zA-Z\d])\.([a-zA-Z\d])/g,"$1\\.$2")}function Gn(e){if(e){const t=Me.get("domain").replace(/(?:www\.)?/,"").replace(/\./g,"\\.");return new RegExp(`//(?!global\\.)(?:[\\w-]+\\.)?${t}\\/`,"i").test(e)}return!1}function zn(e,t,n){function i(e){return e&&"string"==typeof e?(e=e.toLowerCase().trim(),/[^a-zA-Z0-9 ]/.test(e)?e.replace(/[^a-zA-Z0-9 ]/g,"").replace(/\s+/g,"").trim():e):""}const r=i(e.name),s=i(t);if(!s)return!1;if(r===s)return!0;const a=n||self.EBATES.merchants?.get(e.id)?.get("storeNamePattern");if(a)try{if(new RegExp(`^${a}$`,"i").test(t))return!0}catch{}return!1}const Kn=qn.Model.extend({toJSON(){return Ne((0,P.clone)(this.attributes))}}),Jn={pauseDocumentCompleteTrigerredUpdates:!0,timeout:null,errorAttempt:0,dynamic:!0,loading:!1,MAX_ERROR_ATTEMPT:4,DEFAULT_UPDATE_INTERVAL:9e5,UPDATE_INTERVAL:null,initialize(){self.EbatesPromise.then((e=>{e.on("SyncTick",(async()=>{this.dynamic&&!this.pauseDocumentCompleteTrigerredUpdates&&await this.ifCacheExpired()&&this.fetch().catch((()=>{}))}))})),this.once("sync",(()=>this._dataSynced=!0)),this.readCache({cache:!0,silent:!0})},setNextUpdateTime(e){this.key&&T.extension.setItem(`${this.key}.nextUpdateTime`,e),this._nextUpdateTime=e},async getNextUpdateTime(){if(!Number.isFinite(this._nextUpdateTime)){const e=this.key?await T.extension.getItem(`${this.key}.nextUpdateTime`):0;this._nextUpdateTime=parseInt(e,10)||0}return this._nextUpdateTime},async ifCacheExpired(){return await this.getNextUpdateTime()<Date.now()},clearCache(){this.noCache=!0,T.extension.setItem(this.key,{noCache:!0}),this.setNextUpdateTime(0)},getCache(){return T.extension.getItem(this.key)},async saveCache(){const{etag:e,noCache:t}=await this.getCache()??{};this.setCache({etag:e,noCache:t,data:this.attributes})},async setCache({...e}){T.extension.setItem(this.key,e)},async readCache({reset:e,force:t,cache:n,silent:i}){let r;if(this.key&&void 0===this.etag&&(this.etag=null,r=await this.getCache(),r?.data&&(this.etag=r.etag??null)),e||this.noCache||t)return!1;if(!n&&await this.ifCacheExpired())return!1;if(this.key&&(r=r??await this.getCache(),this.noCache=r?.noCache,r?.data)){try{this.length||this.set(this.parse(r.data),{silent:i})}catch{return!1}try{this.trigger("sync",this)}catch{}return!0}return!1},async sync(e,t,n={}){const i=n.reset||this.noCache||n.force;if("read"!==e)return qn.Collection.prototype.sync.apply(t,arguments);this.pauseDocumentCompleteTrigerredUpdates=!1;if(await this.readCache(n))return this;if(t.loading)return new Promise((function(e){t.once("sync",(function(){t.trigger("sync",t,null,n),e()}))}));t.etag&&!i&&(n.beforeSend=function(e){e.headers=Object.assign({},e.headers,{"If-None-Match":t.etag})}),i&&(n.headers=Object.assign({},n.headers,{"Cache-Control":"max-age=0, no-cache",Pragma:"no-cache"})),this.noCache=!1,t.loading=!0;const r=n.success;return n.success=function(e,i,s){t.loading=!1;try{t.errorAttempt=0;let i=t.DEFAULT_UPDATE_INTERVAL;if(t.UPDATE_INTERVAL)i=t.UPDATE_INTERVAL;else{const e=s.headers.get("Cache-Control");if(e&&e.indexOf("max-age=")>=0){const e=fe(s.headers);e>0&&(i=e)}}n.headers=s.headers,t.etag=s.headers.get("ETag"),t.setNextUpdateTime(Date.now()+i),t.key&&e&&t.setCache({etag:t.etag,data:e}),r&&200===s.status?r.apply(t,arguments):t.trigger("sync",t)}catch{n.error(s)}},n.error=function(e){if(t.loading=!1,[401,403].includes(e.status))t.pauseDocumentCompleteTrigerredUpdates=!0;else{const e=t.ERROR_UPDATE_INTERVAL||10*Math.pow(3,Math.min(t.MAX_ERROR_ATTEMPT,++t.errorAttempt))*1e3;t.setNextUpdateTime(Date.now()+e)}t.trigger("error",t,e,n)},qn.Collection.prototype.sync.call(t,e,t,n)},stop(){this.pauseDocumentCompleteTrigerredUpdates=!0,this.etag=null,T.extension.setItem(`${this.key}.nextUpdateTime`,0)},ready(){return new Promise((e=>{this._dataSynced?e(this):this.once("sync",(()=>e(this)))}))}},Yn=qn.Collection.extend(Jn),Xn=Kn.extend(Jn);const Zn=Kn.extend({timeout:18e5,errorTimeout:3e4,loading:!1,nextUpdateTime:0,sync:function(e,t,n={}){if("read"!==e)return qn.sync.call(this,e,t,n);if(Date.now()<t.nextUpdateTime&&!n.reset&&!n.force)return new Promise((function(e){t.trigger("sync",t,null,n),e()}));if(t.loading)return new Promise((function(e){t.once("sync",(function(){t.trigger("sync",t,null,n),e()}))}));T.browser.isSafari&&(n.reset||n.force)&&(n.data=(0,P.extend)({_:Date.now()},n.data)),t.ETag&&(n.headers=Object.assign({},n.headers,{"If-None-Match":t.ETag})),(n.reset||n.force)&&(n.headers=Object.assign({},n.headers,{"Cache-Control":"max-age=0, no-cache",Pragma:"no-cache"})),t.loading=!0;const i=n.success;n.success=function(e,r,s){t.loading=!1,t.nextUpdateTime=Date.now()+t.timeout,t.ETag=s.headers.get("ETag"),304!==s.status?i&&(n.headers=s.headers,i.apply(t,arguments)):t.trigger("sync",t,e,n)};const r=n.error;return n.error=function(){t.loading=!1,t.nextUpdateTime=Date.now()+t.errorTimeout,r&&r.apply(t,arguments)},qn.sync.call(this,e,t,n)}}),Qn=qn.Collection.extend({sync:(e,t,n)=>new Promise((i=>{"read"===e&&T.extension.getItem(t.key,(e=>{n.success(e),i()}))})),save(){T.extension.setItem(this.key,this.toJSON())}}),ei=qn.Model.extend({sync(e,t,n){return new Promise((t=>{"read"===e?T.extension.getItem(this.key,(e=>{t(),n.success(e)})):"update"!==e&&"create"!==e||(T.extension.setItem(this.key,(0,P.clone)(this.attributes)),t())}))}}),ti={platform:"Extension",browser:T.browser.name,extension_version:R().version};const ni=new class extends me{_id="experiments";UPDATE_INTERVAL=72e5;memberGuid="";anonymousId="";constructor(){super(),this.get=this.variation}get url(){return Me.get("FEATUREFLAGS_EXPERIMENT_URL")}async init(){T.extension.attachEvent("experiments:activate",(({data:{id:e,props:t}})=>this.activate(e,t))),T.extension.attachEvent("experiments:get",(({data:{id:e}})=>this.getFlag(e))),await this.readCache()}setMember({anonymousId:e,memberGuid:t}){this.memberGuid=t,this.anonymousId=e}async fetchData(){const e={user:{member_guid:this.memberGuid,anonymous_id:this.anonymousId},context:ti,region:Me.region,event_properties:{application_type:"button"}},t=Me.get("FEATUREFLAGS_EXPERIMENT_APIKEY");try{return await this.load({url:this.url,method:"POST",headers:{"api-key":t,"Content-Type":"application/json"},body:JSON.stringify(e)})}catch{return this.getData()??{}}}async getFlag(e){if(e){return(await this.fetchData())[e]}return null}async inExperiment(e){const t=await this.getFlag(e);return!!t?.in_experiment}async variation(e,t){const n=await this.getFlag(e);return n?.value??t}async has(e){const t=await this.get(e);return null!=t}getId(){return this.memberGuid??this.anonymousId??""}async activate(e,t={}){const n=await this.getFlag(e);return n&&(n.in_experiment||"IE-Test-Expedia"===e&&["A","X"].includes(n.value))&&(self.EBATES.member.identify(),self.EBATES.segment.track("View Experiment",{experiment_name:e,variation_name:`${e}${n.value}`,activation_id:this.getId(),activation_id_type:this.memberGuid?"guid":"anonymous",...t})),n?.value}async toJSON(){const e=await this.fetchData(),t={};return Object.keys(e).forEach((n=>t[n]=e[n].value)),t}async canUserAccessFeature(e,t=!0){const n=await this.getFlag(e);if(!n)return!1;t=[].concat(t);const i=void 0!==n.value&&null!==n.value&&t.includes(n.value);return n.in_experiment||i}};class ii extends me{_id="settings-merchants";DEFAULT_UPDATE_INTERVAL=216e5;constructor(){super()}get url(){return Oe(B.SETTINGS_MERCHANTS)}parse(e){return e.merchants.map((e=>(e.track_events=!0,e)))}}var ri=r(38761),si=r.n(ri);const ai=e=>e.toString().replace(/\.0+$/,"");function oi(e){if(!e)return"";switch(e.display){case"Percentage":return e.range&&e.amount?De.get("formatCashback.tieredCashbackPercentage",{amount:ai(e.amount)}):`${ai(e.amount)}%`;case"Fixed":return e.amount&&e.range?De.get("formatCashback.tieredCashbackFixed",{amount:ai(si().formatMoney(e.amount))}):ai(si().formatMoney(e.amount));case"Coupons":return De.get("formatCashback.offersOnly");case"None":return De.get("formatCashback.notAvailable");default:return""}}function ci(e,t){if(!e||!t||e.display!==t.display)return NaN;const n=e.amount,i=t.amount;return n>i?1:n===i?0:-1}function ui(){const e=new Map,t=`//${Me.get("domain").replace(/\./g,"\\.")}/.*?(\\d+)-xfas(?:\\?.*sourceName=[\\w-]*)?`,n=new RegExp(t),i=t=>{e.has(t)&&(e.get(t).timeout&&self.clearTimeout(e.get(t).timeout),e.delete(t))};function r({tab:e,reason:t}){if(!e)return;const n=e.storeId,i=self.EBATES.merchants.get(n),r=i?.session.shoppingTrip.getCurrentState(),s={store_id:n,redirect_chain:e.urls.toString(),reason:t,...r?{activation_type:r.type,attribution_source_previous_click:r.source,tracking_ticket:r.ttn}:{}};self.EBATES.segment.track("Interstitial Failure",s),we.warn("InterstitialStatus",s),self.EBATES.settings.affiliates.clear(e.tabId)}function a(t,n){r({tab:e.get(t),reason:n}),i(t)}T.browser.attachEvent(T.browser.TABCLOSED,(({tabId:e})=>{a(e,"closed tab")}));T.browser.attachEvent(T.browser.NAVIGATIONCOMMITTED,(({tabId:t,url:s})=>{const a=(e=>{const t=n.exec(e);if(t&&t[1]&&self.EBATES){const n=self.EBATES.merchants.get(parseInt(t[1],10));if(n)return{storeId:n.id,location_flag:n.session.shoppingTrip.get("source")||t[2]||"",urls:[e]}}return null})(s);if(a){const n=self.setTimeout((()=>{r({tab:e.get(t),reason:"timed out"})}),3e4);e.set(t,{...a,tabId:t,timeout:n})}else if(e.has(t)){const n=self.EBATES.merchants.match(s,t);if(n&&n.id===e.get(t).storeId)i(t);else{e.get(t).urls.push(s)}}})),s().webNavigation.onCommitted.addListener((e=>{const{tabId:t,transitionType:n,transitionQualifiers:i}=e;"reload"===n?a(t,"reload tab"):i?.includes("forward_back")&&a(t,"forward_back")}))}async function li({name:e,variables:t,channel:n,platform:i}){const{data:r}=await he(Oe(M),{data:{name:e,variables:t},headers:{"X-Platform":i,"X-Channel-ID":n,Authorization:`ebtoken ${self.EBATES?.ebToken??""}`}});return r}const hi="Cash Back";function di(e){const t=[];return e.split("\n").forEach((e=>{const n=e.split(`${hi}`);2===n.length&&t.push({cashBack:`${n[0]}${hi}`,description:n[1].trim()})})),t}class fi extends Map{constructor(){super([[st.DEFAULT,new pi(st.DEFAULT)],[st.PRICE_MAGIC,new pi(st.PRICE_MAGIC)]]),T.extension.attachEvent("getRates",(async({data:e})=>{const t=e.storeIds,n=await this.default.fetch(t);return t.map(((e,t)=>({storeId:e,rate:n[t]||null})))}))}get default(){return this.get(st.DEFAULT)}async init(){await(this.get(st.DEFAULT)?.init())}add(e){if(isNaN(e))throw new Error("Channel must be defined");if(!this.has(e)){const t=new pi(e);return this.set(e,t),t}return this.get(e)}reset(){this.forEach((e=>e.reset()))}}class pi extends(O()){stores=new Map;constructor(e=st.DEFAULT){super(),this.channel=e}get platform(){return at[this.channel]||self.EBATES.settings.get("platforms")?.[this.channel]}get name(){return`rates-${this.platform}`}async readCache(){if(0===this.stores.size){const e=(await Te.get(this.name)??[]).map((([e,{date:t,rate:n}])=>[e,{date:t,rate:new gi({date:t,reward:n})}]));this.stores=new Map(e)}}async save(){const e=[];this.stores.forEach(((t,n)=>{const{promise:i,...r}=t;e.push([n,r])})),await Te.set(this.name,e)}async init(){await this.readCache()}async get(e){let t=this.stores.get(e);return t?t.promise?t.promise:t.rate:(t={date:0,rate:null},this.stores.set(e,t),t.promise=this.fetch(e).then((e=>(t.promise=null,e||new gi))),t.promise)}getRewardAgeByStoreId(e){const t=this.stores.get(e);return t?Date.now()-t.date:0}async reset(){this.stores.forEach((e=>{e.date=0})),await this.save()}async fetch(e){await this.readCache();const t=[].concat(e);if(0===t.length)return Promise.resolve([]);const n=Date.now()-3e5,i=t.filter((e=>{const t=this.stores.get(e)?.date;return!t||t<n}));if(i.length)try{await this.request(i)}catch{}return Array.isArray(e)?t.map((e=>this.stores.get(e)?.rate??new gi)):this.stores.get(e)?.rate??new gi}async request(e){const t=await li({name:"button_reward_v1",variables:JSON.stringify({storeIds:e.map(String)}),platform:this.platform,channel:this.channel}),n=Date.now();return e.forEach((e=>{const i=t?.data.stores.find((({id:t})=>e===t));let r;if(i){const{reward:e,tiered:t,rakplusTargeted:n,date:s}=i;r=new gi({reward:e,tiered:t,rakplusTargeted:n,date:s})}else r=this.stores.get(e)?.rate??new gi;this.stores.set(e,{promise:null,date:n,rate:r})})),await this.save(),this.stores}}class gi{amount=0;display="None";range=!1;tiered=!1;rakplusTargeted=!1;currentText="";current="";expired=!1;constructor({reward:e,tiered:t,rakplusTargeted:n=!1,date:i}={}){if(this.tiered=t??e?.tiered??!1,this.rakplusTargeted=ve.get("rakPlus",!0)&&(n??e?.rakplusTargeted??!1),e&&(this.amount=e.amount,this.display=e.display,this.range=e.range,this.description=e.description,ve.get("wasCashBack",!0)&&(this.previous=e.previous),this.current=e.current??oi(e),this.currentText=e.currentText??De.get("currentText",{amount:this.current})),this.range&&this.description){const e=di(this.description);e?.length&&(this.tiers=e,this.tiered=!0)}}isActive(){return["Percentage","Fixed"].includes(this.display)&&this.amount>0}}const mi=new fi,vi=Kn.extend({idAttribute:"storeId",defaults:{reward:null,lastReward:null,rate:null,cashBackDifference:0,lastVisit:Date.now(),lastVisitsHistory:[]},async recalculateDifference(){const e=await(EBATES.merchants.get(this.id)?.getReward());if(e&&this.get("reward")){const t=parseFloat(oi(e).replace(/[^\d.]/g,"")),n=parseFloat(oi(this.get("reward")).replace(/[^\d.]/g,""));t?this.set({cashBackDifference:t-n}):this.collection.remove(this)}}}),yi=Qn.extend({model:vi,comparator:(e,t)=>e.get("cashBackDifference")===t.get("cashBackDifference")?e.get("lastVisit")>t.get("lastVisit")?-1:1:e.get("cashBackDifference")>t.get("cashBackDifference")?-1:1,key:"recent",size:500,initialize(){this.on({add:function(){this.sort(),this.length>this.size&&this.pop(),this.save()}})},save(){T.extension.setItem(this.key,this.map((e=>e.attributes)))},async visit(e){const t=e.get("storeId"),n=await e.getReward(),i=this.get(t),r=i?.get("lastVisitsHistory")||[],s=Date.now(),a=self.EBATES.settings.get("increasedCBConfig"),o=a?.recentStoreSession??18e5,c=r[0];let u=r;(!c||s-c>=o)&&(u=[s,...r],u.splice(10));const l=this.add({storeId:t,lastVisit:Date.now(),lastReward:n,lastVisitsHistory:u},{merge:!0});if(l.get("reward")){const e=ci(n,l.get("reward"));e<0?(l.set({reward:n}),await l.recalculateDifference(),this.save()):e>0&&!l.updateTimeout&&(l.updateTimeout=setTimeout((async()=>{const e=this.get(t);e&&(e.set({reward:n}),e.updateTimeout=null,await e.recalculateDifference(),this.save())}),9e5))}},async updateRecent(){for(let e=this.length-1;e>=0;e--){const t=this.at(e),n=t.get("storeId");this.get(n)&&"X"!==await(EBATES.merchants.get(n)?.incrementalityTest())?t.recalculateDifference():this.remove(t)}this.sort(),this.save()},getMostRecentStores(e=10,t=Nt.MONTH){const n=Date.now(),i=this.models.filter((e=>(e.get("lastVisitsHistory")||[]).some((e=>e&&n-e<=t)))).sort(((e,i)=>{const r=(e.get("lastVisitsHistory")||[]).filter((e=>e&&n-e<=t)).length;return(i.get("lastVisitsHistory")||[]).filter((e=>e&&n-e<=t)).length-r}));return e?i?.slice(0,e):i},async fetchRatesOnInterval(){const e=Date.now(),t=self.EBATES.settings.get("increasedCBConfig"),n=t?.ratesFetchInterval??Nt.DAY,i=await this.getItem("nextRecentRatesUpdateTime");if(!i||e>=i){await this.updateRates();const t=e+n;this.setItem("nextRecentRatesUpdateTime",t)}},async updateRates(){const e=this.pluck("storeId"),t=await mi.default.fetch(e),n=e.map(((e,n)=>({storeId:e,rate:t?.[n]}))).map((({storeId:e,rate:t})=>{if(t){const n=this.get(e)?.get("rate");return{storeId:e,previousRate:n,rate:t}}})).filter(Boolean);this.set(n,{merge:!0}),this.save()},async getTopRateRecents(e=10,t=5,n=Nt.MONTH){if(!this.getMostRecentStores(e,n).map((e=>e.get("storeId"))).filter((e=>null!=e)).length)return[];await this.fetchRatesOnInterval();const i=this.filter((e=>(e.get("rate")?.amount||0)>(e.get("lastReward")?.amount||0)));return i.sort(((e,t)=>{const n=e.get("rate")?.amount||0;return(t.get("rate")?.amount||0)-n})),i.slice(0,t)},setItem(e,t){T.extension.setItem(e,t)},getItem:async e=>await T.extension.getItem(e),updateReward(e,t){const n=this.get(e);n&&(n.set({lastReward:t}),this.save())}});class bi extends Map{constructor(){super([[st.DEFAULT,new wi(st.DEFAULT)]])}add(e){if(isNaN(e))throw new Error("Channel must be defined");if(!this.has(e)){const t=new wi(e);return this.set(e,t),t}return this.get(e)}}class wi extends(O()){stores=new Map;constructor(e=st.DEFAULT){super(),this.channel=e}get name(){return`tiers-${this.platform}`}get platform(){return at[this.channel]||self.EBATES.settings.get("platforms")?.[this.channel]}async save(){await Te.set(this.name,[...this.stores])}async readCache(){if(0===this.stores.size){const e=await Te.get(this.name)??[];this.stores=new Map(e)}}async fetch(e){await this.readCache();const t=[].concat(e),n=Date.now()-3e5,i=t.filter((e=>{const t=this.stores.get(e)?.date;return!t||t<n}));if(i.length)try{await this.request(i)}catch{}return Array.isArray(e)?t.map((e=>this.stores.get(e)?.tiers)):this.stores.get(e)?.tiers}async request(e){const t=await li({name:"button_tiers_v1",variables:JSON.stringify({storeIds:e.map(String)}),platform:this.platform,channel:this.channel}),n=Date.now();return t?.data.stores.forEach((({storeId:e,tiers:t,reward:i})=>{this.stores.set(e,{date:n,tiers:Ai(t,i)})})),await this.save(),this.stores}}const Ei=new bi;function Ai(e,t){if(e)return e;if(t&&t.range&&t.description){return di(t.description)}return[]}class xi extends me{_id="store_modified_times";UPDATE_INTERVAL=9e5;get url(){return oe(Oe(M),{name:"store_modified_times",variables:'{"storeIds": "ALL"}'})}parse(e){return e?.data?.storeLastModifiedTime?.value??[]}}function Ti(e){if(!e)return{};let t="",n=0,i="";switch(e.display){case"Percentage":t="%";break;case"Fixed":t="$"}return e.amount&&(n=e.amount,i=e.range?"tiered":"flat"),{cash_back_type:t,cash_back:n,cash_back_structure:i}}function Si(e="",t="[&?](?:LinkshareID|wmlspartner|siteID|mkwid|pcrid|cmp|adid|sourceid|veh|tid|kwid|ap|gclid|cid|cjevent|cp|aid|sid|aff\\w*||\\w*email\\w*|ran\\w+)=[^&]*"){const[n]=e.split("?",1);return e.replace(new RegExp(t,"gi"),"").replace(/([&=])[^&=]+(?:@|%40)[\w.-]+\.\w{2,}/g,"$1").replace(`${n}&`,`${n}?`)}const _i=Yn.extend({dynamic:!1,initialize(){return this.on({error:function(e,t){[401,403].includes(t.status)&&EBATES.onTokenExpired()}}),Yn.prototype.initialize.apply(this)}});class ki extends me{toJSON(){return super.getData()??[]}parseDeal(e){const{store:t}=e;return t?.id&&!e.storeId&&(e.storeId=t.id,delete t.id,0===Object.keys(t).length&&delete e.store),e.code?.indexOf("&amp;")&&(e.code=e.code.replace("&amp;","&")),e}}class Ii extends ki{constructor(e){super(),this.storeId=e,this._id=`deals/${e}`}get url(){return oe(Oe(M),{name:"button_store_deals_v1",variables:`{ "storeIds": ["${this.storeId}"] }`})}parse(e){return(e?.data?.stores??[]).flatMap((e=>e.deals.map(this.parseDeal))).sort(this.sortDeals)}sortDeals(e,t){const n=e=>[e.code?0:1,["Other","Free Shipping","Money Off Coupons","Deals of the Week","Store Sales"].indexOf(e.offerTypeText)],i=n(e),r=n(t);for(let e=0;e<i.length;e++){if(i[e]<r[e])return-1;if(i[e]>r[e])return 1}return 0}}class Ci extends ki{_id="deals/top";constructor(){super(),this.readCache()}get url(){return oe(Oe(M),{name:"button_deals_v1",variables:""})}parse(e){return(e?.data?.campaign?.deals??[]).map(this.parseDeal).sort(this.sortDeals)}sortDeals(e,t){const n=e=>{let t=EBATES.member.favorites.get(e.storeId);return t?EBATES.member.favorites.indexOf(EBATES.member.favorites.get(e.storeId)):(t=EBATES.member.purchased.get(e.storeId),t?EBATES.member.favorites.length+EBATES.member.purchased.indexOf(t):(t=EBATES.member.visited.get(e.storeId),t?EBATES.member.favorites.length+EBATES.member.purchased.length+EBATES.member.visited.indexOf(t):EBATES.member.favorites.length+EBATES.member.purchased.length+EBATES.member.visited.length))};return n(e)-n(t)}async load(e={}){return await Promise.all([EBATES.member.favorites.fetch(),EBATES.member.get("accessLevel")>0?EBATES.member.purchased.fetch():null,EBATES.member.visited.fetch()]).catch((()=>{})),super.load(e)}async populateDeals(e){try{await this.load()}catch{}const t=this.toJSON().filter((t=>t&&t.storeId!==e)),n=[...new Set(t.map((e=>e.storeId)))],i=await EBATES.merchants.getStores(n);return t.map(((e,t)=>{const n=i.find((({storeId:t})=>t===e.storeId));if(n?.offers_cb&&n.shoppingURL&&n.activationCode>0&&"X"!==n.incrementalityTest)return{...e,storeName:n.storeName,reward:n.reward,images:n.images,coupon_rank:t,rewardsExpired:n.rewardsExpired}})).filter(Boolean)}}class Di extends me{DEFAULT_UPDATE_INTERVAL=108e5;ERROR_UPDATE_INTERVAL=108e5;constructor(e){super(),this.storeId=e,this._id=`experimental-coupons-${e}`}get url(){return Oe(B.STORE_COUPONS,{storeId:this.storeId})}parse(e){return e?.map((e=>(e.source="ACS",e)))}sort(e){return e.sort(((e,t)=>(t.orders_count??0)-(e.orders_count??0)))}async get(){const e=await this.load();return this.sort(e)}}class Pi extends(O()){constructor(e){if(super(),!e)throw new Error("storageId required");this._storageId=e}save(e){return jt?Te.set(this._storageId,e):Promise.resolve()}clearCache(){return jt?Te.delete(this._storageId):Promise.resolve()}async load(){if(jt)return Te.get(this._storageId)}}const Bi=new class extends Pi{sessions=new Map;constructor(){super("merchant-sessions")}async fetch(){const e=await this.load();if(e){const t=Object.keys(e).map(Number).reduce(((t,n)=>(t.push([n,e[n]]),t)),[]);this.sessions=new Map(t)}else await this.loadOldSessions()}async loadOldSessions(){const e=await Te.getAllKeys();for(const t of e)if("string"==typeof t){const e=parseInt(t.match(/-(\d+)$/)?.[1]??"",10);if(Number.isFinite(e)&&e>0){const n=await Te.get(t),i=await Te.get(`shopping-trip-${e}`);i&&(n.shoppingTrip=i),this.sessions.set(e,n)}}if(this.sessions.size>0){Array.from(this.sessions.keys()).forEach((e=>{Te.delete(`merchant-session-${e}`),Te.delete(`shopping-trip-${e}`)})),await this.save()}return[]}saveSession(e,t){return this.sessions.set(e,t),this.save()}saveShoppingTrip(e,t){const n=this.sessions.get(e);return n&&(n.shoppingTrip=t),this.save()}clearSession(e){return this.sessions.delete(e),this.save()}clearShoppingTrip(e){const t=this.sessions.get(e);return t&&(t.shoppingTrip={}),this.save()}clearCache(){return this.sessions.clear(),this.save()}get(e){return this.sessions.get(e)}async save(){const e=Object.fromEntries(this.sessions);return super.save(e)}};class Mi extends(O()){constructor(e,t){super(),this.storeId=e,this.pending={},this.attributes={},t&&Object.keys(t).length>0&&Object.assign(this.attributes,t)}get(e){return this.attributes[e]}set(e,t){"string"==typeof e&&void 0!==t?this.attributes[e]=t:Object.assign(this.attributes,e),this.save()}start(e={}){if(!e.ttn)throw new Error("Missing ttn");this.attributes={...e,...this.pending},this.pending={},this.emit("start",this),this.save()}save(){Bi.saveShoppingTrip(this.storeId,this.attributes)}reset(){this.attributes={},Bi.clearShoppingTrip(this.storeId)}resetPendingAttributes(){this.pending={}}addPendingAttributes(e){this.pending={...e,...this.pending}}getCurrentState(){return{...this.pending,...this.attributes}}toJSON(){return this.attributes}}const Ri={notificationHover:!0,notificationReminder:!0,notificationCheckout:!0,notificationConfirmation:!0,notificationCaa:!0,activated:!1,suppressed:!1,rab:!1,hoverShownCount:0,visit:null,backgroundActivated:!1};class Ni extends(O()){attributes={...Ri};constructor(e){super(),this.storeId=e;const t=Bi.get(e);let n;if(t&&this.validateCache(t)){const{shoppingTrip:e,...i}=t;i&&0!==Object.keys(i).length&&Object.assign(this.attributes,i),n=e}this.shoppingTrip=new Mi(e,n)}validateCache(e){const t=e.visit;return!(t&&t+2592e6<Date.now())||(Bi.clearSession(this.storeId),!1)}set(e,t){"string"==typeof e?this.attributes[e]=t:"object"==typeof e&&Object.assign(this.attributes,e),Bi.saveSession(this.storeId,this.toJSON())}get(e){return this.attributes[e]}has(e){return void 0!==this.attributes[e]}start({shoppingTrip:e,...t}){(this.shoppingTrip.get("partner")!==e.partner||this.get("suppressed"))&&this.stop(),this.set(t),e&&this.shoppingTrip.start(e),this.set({notificationHover:!0,notificationReminder:!!this.get("anonymous"),activated:!0}),this.emit("start",this)}async suppress(){const e=this.get("competitor");this.reset(),this.shoppingTrip.resetPendingAttributes(),this.set({notificationReminder:!1,notificationHover:!1,suppressed:!0,...e?{competitor:e}:{}}),this.emit("start",this)}stop(){this.reset(),this.emit("stop",this)}reset(){this.attributes={...Ri},this.shoppingTrip.reset(),Bi.clearSession(this.storeId)}checkSessionTimeout(){const e=this.get("sessionInterval")||18e5,t=this.get("visit");t&&(t+e<Date.now()&&(this.stop(),this.shoppingTrip.resetPendingAttributes()),t+36e5<Date.now()&&this.set("notificationHover",!0));const n=this.get("rabSnoozeTimestamp");n&&Date.now()>n&&(delete this.attributes.rabSnoozeTimestamp,this.set("rab",!0))}toJSON(){return{...this.attributes,shoppingTrip:this.shoppingTrip.toJSON()}}}function Oi(e){return new Promise((t=>{setTimeout(t,e)}))}const Li=Kn.extend({idAttribute:"storeId",deals:null,experimentalCoupons:null,session:null,defaults:{activationCode:0},initialize(){const e=this.get("storeId");return this.session=new Ni(e),this.has("storeId")&&(this.deals=new Ii(e),this.experimentalCoupons=new Di(e)),this.session.shoppingTrip.on("start",(e=>{e.get("source")&&(self.EBATES.segment.track("Start Shopping Trip",{version:"Remind me Later",store_name:this.get("storeName"),store_id:this.get("storeId"),tracking_ticket:e.get("ttn"),attribution_source_previous_click:e.get("source"),interstitial_type:e.get("interstitialType"),entity_name:e.get("entity_name"),rank:e.get("rank"),activation_type:e.get("type"),type:e.get("featureType"),guessedPageType:this.session.get("guessedPageType"),...e.get("event_attributes"),...Ti(e.get("reward"))}),self.EBATES.holistic.track(je.ShoppingTripStarted,{data:{tracking_ticket:e.get("ttn")??"",store:{id:this.get("storeId"),name:this.get("storeName")},trip_surface:"WEB"}}))})),this.session.on("start",(()=>{this.session.checkSessionTimeout(),this.visit(),T.extension.fireEvent("merchant.state:change"),this.updateMerchantForCurrentTab()})),this.session.on("stop",(async()=>{const e=await this.getReward();if(e.isActive()){const t=this.collection.recent.get(this.get("storeId"));t&&t.set({reward:e,lastVisit:Date.now()},{merge:!0})}T.extension.fireEvent("merchant.state:change"),this.updateMerchantForCurrentTab()})),Kn.prototype.initialize.call(this)},isButtonMerchant(){return[3,5].includes(this.get("activationCode"))},isActiveMerchant:e=>e.isActive(),isRabDisabled(){const e=ve.get("rabDisabledMerchants",{storeIds:[]}),t=this.get("storeId")??-1;return Array.isArray(e.storeIds)&&e.storeIds.includes(t)},async isActiveButtonMerchant(){const e=await this.getReward();return this.isButtonMerchant()&&e.isActive()},async isEligibleForIconAnimation(){const e="X"===await this.incrementalityTest(),t=await this.isActiveButtonMerchant();return!this.session.get("suppressed")&&!e&&(t||6===this.get("activationCode")&&this.session.get("activated"))},processCode(e){const t=this.get("activationCode"),n=e?.isActive()??!1,i=this.isButtonMerchant(),r=i&&n,s=this.isRabDisabled();return{settings_notification:ve.get("hover",!0)&&3===t&&n||2===t,settings_rab:ve.get("hoverRAB")&&!s&&n&&3===t,settings_confirmation:r||6===t,settings_checkout:3===t&&r,settings_serp:3===t&&n&&!0!==this.get("serpDisabled"),settings_popup:r,settings_caa:i,settings_purchase:i,offers_cb:n}},toJSON(e={},...t){const n=this.session.toJSON(),i=Kn.prototype.toJSON.apply(this,[e,...t]);if(!i.siteUrl){const e=this.get("shoppingURL")?.match(/.*\/(.*?)_\d+/);i.siteUrl=e?e[1]:this.get("domainName")}return{...i,session:n}},serializeWithReward(e){return{...this.toJSON(),...this.processCode(e),reward:e?{...e}:null,rewardsExpired:e?.expired,loggedIn:EBATES.loggedIn}},async getDetailedMerchantJSON(){const e=await self.EBATES.merchants.getStoreContent(this.get("storeId")),t=await this.updateMerchantRates();EBATES.ebToken&&t.isActive()&&await self.EBATES.merchants.recent.visit(this);const n=EBATES.settings.userSettings.get("notificationExcludedStores")??[];return{...this.serializeWithReward(t),...e,blacklisted:n.includes(this.get("storeId")),incrementalityTest:await this.incrementalityTest(),recommendedStoresPromo:await this.getRecommendedStores(),isCaaWithoutActivation:await this.isCaaWithoutActivation()}},async showTakeover(e){if(!e||!ve.variation("takeover",!0))return;if(!(await this.getReward()).isActive())return;let t=e;if("A"===await ni.activate(Tt,{storeId:this.get("storeId")})){const e=await Wt.getActive(),n=self.EBATES.merchants.match(e.url,e.tabId);if(!(n?.get("storeId")===this.get("storeId")))return void this.session.set("showTakeover",!0);t=e.tabId}const n={tabId:t,data:{competitor:this.session.get("competitor")}};try{await T.extension.fireEvent("takeover",n)}catch{await Oi(4e3);try{n.data.repeatAttempt=!0,await T.extension.fireEvent("takeover",n)}catch(e){}}},visit(){const e=Date.now();this.session.set("visit",e)},suppress(){const e=this.session.get("tabId");this.session.suppress(),this.showTakeover(e),this.session.checkSessionTimeout()},async getReward(e=st.DEFAULT){if(!this.isButtonMerchant())return new gi;mi.has(e)||mi.add(e);return await(mi.get(e)?.get(this.id))||new gi},getTiers(e=st.DEFAULT){return"ShopStyle"===this.session.shoppingTrip.get("partner")?e=st.SHOPSTYLE:this.session.shoppingTrip.get("channel")&&(e=this.session.shoppingTrip.get("channel")),this.collection.tiers.add(e).fetch(this.id)},async activateInBackground(e,t="json"){const n=this.session;let i=e;const r=await T.browser.navigate({tabId:T.browser.NEWTAB,active:!1,pinned:!0}),a=r.id;if("xfas"!==t){let r="";if("anon"===t)n.set("anonymous",!0),r="anonymous";else{const{data:t}=await he(`${e}&response=json`),n=t?.ticket[0];n?.storeId&&(i=ae(n.link[0]["@href"],{visit_id:EBATES.holistic.visit_id}),r=n.trackingNumber)}EBATES.settings.affiliates.match(e,a),EBATES.settings.affiliates.activations.addParameters(a,{trackingTicketNumber:r})}const o=setTimeout((()=>{n.set("backgroundActivated",!1),n.set("backgroundActivationDisabled",!0),this.updateMerchantForCurrentTab(),self.EBATES.segment.track("Interstitial Failure",{type:"Background Activation Failed",reason:"timed out",store_id:this.get("storeId"),store_name:this.get("storeName"),activation_type:"xfas"!==t?"json":"xfas"})}),3e4);await T.browser.navigate({tabId:a,url:i});const c=this.get("activationInterval")||EBATES.settings.get("activationInterval");let u;n.shoppingTrip.once("start",(()=>{clearTimeout(o),u=setTimeout((()=>{T.browser.isSafari?T.extension.fireEvent("closeWindow",{tabId:a}):s().tabs.remove(a).catch((()=>{})),T.browser.detachEvent(T.browser.TABCHANGED,l)}),Number.isInteger(c)?c:5e3)}));const l=({tabId:e})=>{e===r.id&&(T.browser.detachEvent(T.browser.TABCHANGED,l),clearTimeout(u))};T.browser.attachEvent(T.browser.TABCHANGED,l)},isEligibleForIgnoredStandDown(){const e=EBATES.settings.promos.get("standdown-config");return!!(e?.get("active")&&e.campaigns&&e.campaigns.find((e=>e.stores.get(this.id))))},isEligibleForBackgroundActivation(){if(this.session.get("backgroundActivationDisabled"))return!1;if(this.get("mpl"))return!0;const e=EBATES.settings.promos.get("background-activation");if(e?.get("active")&&e.campaigns){const t=e.campaigns.find((e=>e.stores.get(this.id)));if(t?.get("test"))return!1}return!1},async incrementalityTest(){if(!T.browser.isChrome)return;const e=ve.get("incrementalityTestMerchantsList",{storeIds:[]}),t=this.get("storeId");return e.storeIds.includes(t)?ni.variation("IE-Test-Expedia"):void 0},async getRecommendedStores(){if(!ve.variation("recommendedBanner",!0))return null;const e=EBATES.settings.promos.findWhere({type:"recommended",active:!0,storeId:this.get("storeId")});if(e){const t=e.id,n=e.get("flagId"),i=e.get("flagValue"),r=ve.get("recommended");if((!r||Object.prototype.hasOwnProperty.call(r,t)&&r[t])&&(!n||!i||await ni.variation(n)===i))return e.toJSON()}return null},async isEligibleForBackgroundActivationV2(e){if(!ve.get("bgActivation",!1)||2===this.get("activationCode")||this.session.get("backgroundActivationDisabled"))return"";const t=ve.get("bgActivationBlacklist",{storeIds:[]}),n=this.get("storeId");if(t.storeIds.includes(n))return"";const i=e?await ni.activate(bt,{storeId:n}):await ni.variation(bt);return"A"===i?"json":"B"===i?"xfas":""},async isEligibleForBackgroundActivationV3(e){if(!ve.get("bgActivation",!1)||2===this.get("activationCode")||this.session.get("backgroundActivationDisabled"))return"";const t=this.get("storeId"),n=ve.get("bgActivationWhitelistA",{storeIds:[]}).storeIds.includes(t),i=ve.get("bgActivationWhitelistB",{storeIds:[]}).storeIds.includes(t);if(!n&&!i)return"";const r=e?await ni.activate(wt,{storeId:t}):await ni.variation(wt);return"A"===r&&n?"json":"A"===r&&i?"xfas":""},async isCaaWithoutActivation(){const e=ve.variation("caaWithoutActivation",{includedDomains:[]}).includedDomains.includes(this.get("domainName")),t=await ni.inExperiment(At);return e&&t},async activate(e){let{sessionAttributes:t,forceBackgroundActivation:n,xfasParams:i,product_url:r,toolbarFeatureId:s,special:a,tabId:o,channel:c=st.DEFAULT,rabActivation:u,backgroundActivation:l,type:h}=e;const d=this.session,f=await this.getReward(c),p=this.toJSON(),g=f.isActive();d.get("backgroundActivationDisabled")&&(l=""),p.clickthroughToStoreOnly||d.shoppingTrip.addPendingAttributes({...t?{...t}:null,featureType:h,channel:c});let m=Si(e.store_url,EBATES.settings.get("sanitization"));8381===this.id&&(m=Si(m,"SourceCode=[^&]+&?"));const v=this.get("mpl")?ot.MPL_STORE:e.eeid;return(async e=>{const h=e;e=`${e.replace("&store_url=%deepLinkUrl%","")}&channel=${c}&tb_v=${R().version}`,this.get("mpl")&&"Travel Req"!==t?.source&&(e+=`&mpl_id=${this.get("mpl")}`),a&&(e+=`&special=${a}`),s&&(e+=`&toolbarFeatureId=${s}`);const y=()=>{let t="xfas",n="";if(r?(e=`${e}&product_url=${encodeURIComponent(r)}`,t="product"):e.indexOf("store_url")<0&&m&&this.get("affiliatizerEnabled")&&(e=`${e}&store_url=${encodeURIComponent(m)}`,t="affiliatizer",n=m),d.shoppingTrip.addPendingAttributes({type:t,startURL:n}),p.tlqsf){const t=p.tlqsf[v]??p.tlqsf["*"];t&&(e=oe(e,{tlqsf:btoa(t)}))}i&&(e=oe(e,i)),e.length>=2048&&(e=h),T.browser.navigate({url:e,tabId:o})};if(o&&o!==T.browser.NEWTAB&&m&&(!g&&2!==this.get("activationCode")||p.nonTrackingPattern&&m.search(p.nonTrackingPattern)>=0||this.isEligibleForBackgroundActivation()||n||u||l||!self.EBATES.loggedIn)){if(!self.EBATES.loggedIn){const t=this.get("storeId");e=Oe(B.ANONYMOUS_ACTIVATION,{storeId:t})}n&&(d.set("activated",!0),d.shoppingTrip.addPendingAttributes({reward:f}),d.shoppingTrip.set("reward",f)),this.activateInBackground(e,l).then((()=>{const e="xfas"!==l?"background":"background_xfas";d.shoppingTrip.addPendingAttributes({type:e}),d.set("backgroundActivated",!0),"Coupons and Cash Back Available Notification - combo CTA"!==t.source?!["Cart Reminder",mt,gt].includes(t.source??"")||l?this.updateMerchantForCurrentTab():d.set("notificationHover",!0):d.set("notificationHover",!1)})).catch((()=>{y()}))}else y();return e})(this.getShoppingURL(v))},getShoppingURL(e="23509"){const t={tb:"yes",sourceName:$e,eeid:e,visit_id:self.EBATES.holistic.visit_id},n=this.get("storeLandingURL")&&Oe(this.get("storeLandingURL"));switch(parseInt(this.get("activationCode"),10)){case 2:if(n)return oe(n,t);case 5:if(n)return oe(n,{tb:"yes",visit_id:EBATES.holistic.visit_id});default:return oe(this.get("shoppingURL")||Oe(B.BASE),{...t,ebtoken:self.EBATES?.ebToken??""})}},async updateMerchantForCurrentTab(){const e=this.get("storeId"),t=await this.updateMerchantRates(),n=this.session.toJSON();n.shoppingTrip.reward||(n.shoppingTrip.reward=t);const i=await s().tabs.query({active:!0}),r={session:n,reward:t,storeId:e};i.forEach((e=>{T.extension.fireEvent("updateMerchant",{tabId:e.id,data:{merchant:r}})}))},async updateMerchantSessionInTab(e){const t={storeId:this.get("storeId"),session:this.session.toJSON()};T.extension.fireEvent("updateMerchant",{tabId:e,data:{merchant:t}})},async updateMerchantRates(){const e=this.get("storeId");return[0,2].includes(this.get("activationCode"))||this.session.get("activated")?await this.getReward():await mi.default.fetch(e)},async activateSession(e){const t=this.get("storeId");let{reward:n,trackingTicketNumber:i,partner:r,interstitialType:s,sessionInterval:a,url:o}=e;const c=this.session,u={partner:r,interstitialType:s,ttn:i||c.shoppingTrip.get("ttn"),source:o?.includes("sourceName=toolbar")?o.match(/[?&]special=([\w-]+)/)?.pop()??"unknown":void 0,channel:parseInt(o?.match(/[?&]channel=([\w-]+)/)?.pop()??"",10)||void 0},l=u.channel??st.DEFAULT;mi.has(l)||await mi.add(l).fetch(t);const h=await this.getReward(l);if(u.reward=h,n&&(n.amount||n.range)){const e=ci(h,n);0!==e&&(u.reward=new gi({reward:n}),a&&e>0&&(a=void 0),we.warn("InterstitialRewardsMismatch",{store_id:t,activation_type:u.type,attribution_source:u.source,interstitial_reward:n,current_reward:h,current_reward_age:mi.get(l)?.getRewardAgeByStoreId(t),channel:l}))}try{c.start({sessionInterval:a,shoppingTrip:u})}catch(e){const t=c.shoppingTrip.getCurrentState();let n="";"string"==typeof e?n=e:e instanceof Error&&(n=e.message),we.warn(n,{merchant_id:this.get("storeId"),activation_type:t.type,attribution_source_previous_click:t.source,tracking_ticket:t.ttn})}},checkAffiliatizer(e){if("affiliatizer"===this.session.shoppingTrip.get("type")){let t,n,i,r;try{t=new URL(this.session.shoppingTrip.get("startURL")),n=new URL(e),i=t.hostname+t.pathname.replace(/\/+$/,"").toLowerCase(),r=n.hostname+n.pathname.replace(/\/+$/,"").toLowerCase()}catch{return}if(t&&n&&i!==r){const e={reason:"url_mismatch",starting_url:i,final_url:r,merchant_id:this.get("storeId")};we.warn("AffiliatizerStatus",e)}}},async processDocumentComplete(e,t){const n=EBATES.session_competition?.domain,i=EBATES.settings.affiliates.state(t);if(i.activation||i.suppress){if(i.activation){const t=await ni.get(Ct);(EBATES.loggedIn||t)&&(!EBATES.loggedIn&&t&&i.suppress.ttn&&(i.activation.trackingTicketNumber=i.suppress.ttn),await this.activateSession(i.activation),this.checkAffiliatizer(e))}else if(i.suppress){EBATES.session_competition&&(self.EBATES.segment.track("Start Competitor Shopping Trip",{store_id:this.get("storeId"),store_domain:this.get("domainName"),url:e,domain:n,tracking_ticket:this.session.shoppingTrip.get("ttn"),guessed_page_type:this.session.get("guessedPageType")}),EBATES.session_competition=null),this.session.set({competitor:n});const t=n&&EBATES.settings.get("standDownDomains").includes(n);if(ve.variation("standDownByMerchant")&&!t&&this.isEligibleForIgnoredStandDown()){const e=this.session.get("activated")?this.session.get("tabId"):null;this.session.stop(),e&&this.showTakeover(e)}else self.EBATES.holistic.track(je.StandDownTriggered,{data:{store:{id:this.get("storeId"),name:this.get("storeName")},tracking_ticket:this.session.shoppingTrip.get("ttn"),competitor_name:n,paid_link_rule:i.suppress.paidLink.toString()}}),self.EBATES.segment.track("Stand Down",{store_id:this.get("storeId"),store_domain:this.get("domainName"),tracking_ticket:this.session.shoppingTrip.get("ttn"),url:i.suppress.url,competitor:n,paidLink:i.suppress.paidLink.toString(),guessed_page_type:this.session.get("guessedPageType")}),this.suppress()}EBATES.settings.affiliates.clear(t)}this.session.get("activated")&&(!this.session.get("tabId")&&this.session.get("backgroundActivated")?Wt.getActive().then((e=>{this.session.set("tabId",e.tabId)})).catch((e=>{this.session.set("tabId",t)})):this.session.set("tabId",t)),n&&EBATES.settings.priceMagic.get("partnerDomains").includes(n)&&(this.session.set("pmDisabled",!0),EBATES.session_competition=null),this.visit()}});const ji=new class{name="stores-content";stores=new Map;DEFAULT_UPDATE_INTERVAL=108e5;MAX_ERROR_ATTEMPT=4;constructor(){this.load()}async load(){if(0===this.stores.size){const e=await Te.get(this.name)||[],t=e.filter((([,e])=>(e?.nextUpdateTime??0)>Date.now()));this.stores=new Map(t),e.length!==t.length&&this.save()}}async save(){await Te.set(this.name,[...this.stores])}get(e){if(!this.stores.has(e))return null;const t=this.stores.get(e)?.storeContent;return t?{...t}:null}async reset(){this.stores.clear(),this.save()}async fetch(e){await this.load(),0===this.stores.size&&(this.stores=new Map(await Te.get(this.name)||[]));const t=[].concat(e),n=Date.now(),i=t.filter((e=>(this.stores.get(e)?.nextUpdateTime??0)<n));if(i.length)try{await this.request(t)}catch{}return Array.isArray(e)?e.map((e=>this.get(e))).filter(Boolean):this.get(e)}async request(e){const t=oe(Oe(M),{name:"button_store_details_v1",variables:JSON.stringify({storeIds:e.map(String)})});let n,i,r;try{({data:n,response:i,error:r}=await he(t))}catch(e){r=e instanceof Error?e:new Error("Network error")}if(!r&&i?.ok){const e=this.getNextUpdateTime(i.headers);n.data.storeContent.forEach((t=>{const n=this.parse(t);n&&this.stores.set(n.storeId,{nextUpdateTime:e,storeContent:n,errorAttempt:0})}))}else e.forEach((e=>{let t=this.stores.get(e)?.errorAttempt??0;const n=10*Math.pow(3,Math.min(this.MAX_ERROR_ATTEMPT,++t))*1e3,i=Date.now()+n;this.stores.set(e,{nextUpdateTime:i,errorAttempt:t})}));return this.save(),this.stores}parse(e){if(!e)return null;const{conditions:t,freeShipping:n,shippingMinimumSubtotal:i,averageReportingHours:r,largeLogo:s,squareLogo:a,storeMark:o,storeMarkInverse:c,storeLogo:u,storeLogoInverse:l,buttonClickableSERP:h,affiliateNetworkId:d,...f}=e,p=t?.find((({type:e})=>1===e)),g=p?.productBrandExclusion?.split("|"),m=t?.find((({type:e})=>2===e));return{...f,images:{largeLogo:s,squareLogo:a,storeMark:o??s,storeMarkInverse:c??s,storeLogo:u,storeLogoInverse:l},freeShipping:{body:n,minimumSubtotal:i?Math.floor(i/100):null},conditions:{reward:p?.description,brandExclusions:g,nonReward:m?.description},averageReportingHours:Math.floor(r),buttonClickableSERP:h,affiliateNetworkId:d}}getNextUpdateTime(e){const t=fe(e),n=t>0?t:this.DEFAULT_UPDATE_INTERVAL;return Date.now()+n}},Ui=Kn.extend({idAttribute:"matchPattern",initialize(){this.set({topDomain:Le(this.get("domainName"))});const e=this.get("matchPattern");if(e&&".*.*"!==e)try{this.match=new RegExp(Vn(this.get("matchPattern")),"i")}catch({message:t}){this.match=null,we.error("RegExpError",{description:t,domainName:this.get("domainName"),matchPattern:e,now:Date.now(),source:"Domains.parse"})}}}),Fi=qn.Collection.extend({model:Ui}),$i=Yn.extend({model:Li,key:"merchants",initialize(...e){return this.storesContent=ji,this.sessions=Bi,this.rates=mi,this.tiers=Ei,this.recent=new yi,this.customMerchants=new ii,this.domains=new Fi,this.lastModifiedTimes=new xi,this.on({remove(e){this.recent.get(e.get("storeId"))&&this.recent.remove(e.get("storeId"))},async sync(){if(ve.variation("customMerchants",!1)){const e=await this.customMerchants.load();this.add(e,{merge:!0});const t=e.filter((({domainName:e,matchPattern:t})=>e&&t)).map((({domainName:e,matchPattern:t,storeId:n})=>({domainName:e,matchPattern:t,storeId:n})));this.domains.add(t,{merge:!0})}}}),T.browser.isSafari&&this.recent.fetch(),this.once("sync",(async()=>{await this.recent.fetch()})),T.extension.attachEvent("activate",(async({tabId:e,data:t})=>{const n=this.get(t.storeId),i=await Wt.getActive();if(n){try{const e=new URL(i.url);t.sessionAttributes=t.sessionAttributes??{},t.sessionAttributes.event_attributes={attribution_source_previous_click_url:e.host+e.pathname,attribution_source_previous_click_domain:e.host,...t.sessionAttributes.event_attributes}}catch{}if(n.session.checkSessionTimeout(),n.activate({tabId:e||i.tabId,...t}),!t.sessionAttributes?.source)throw new Error(`Missing Activation Source: ${JSON.stringify(t)}`)}})),T.extension.attachEvent("getTiers",(async({data:{storeId:e}})=>{const t=this.get(e);return await(t?.getTiers())})),T.extension.attachEvent("getStore",(({data:e})=>this.getStore(e))),T.extension.attachEvent("getPopupStore",(({data:e})=>this.getPopupStore(e))),T.extension.attachEvent("getStores",(async({data:{storeIds:e,channel:t}})=>this.getStores(e,t))),T.extension.attachEvent("getStoresByName",(async({data:{names:e,channel:t}})=>this.getStoresByName(e,t))),T.extension.attachEvent("updateMerchantSession",(({data:{storeId:e,properties:t}})=>this.updateMerchantSession(e,t))),T.extension.attachEvent("getOffers",(({data:e})=>this.getOffers(e.storeId))),T.extension.attachEvent("getCouponOffers",(({data:e})=>this.getCouponOffers(e.storeId))),T.extension.attachEvent("getCoupons",(({data:e})=>this.getCoupons(e.storeId))),T.extension.attachEvent("merchants.search",(({data:e})=>this.search(e.term))),T.extension.attachEvent("merchants.recent",(async()=>{await this.recent.updateRecent();const e=this.recent.map((({id:e})=>e));return this.getStores(e)})),T.extension.attachEvent("isEligibleForBackgroundActivation",(({data:{storeId:e}})=>this.get(e)?.isEligibleForBackgroundActivation())),T.extension.attachEvent("isEligibleForBackgroundActivationV3",(({data:e})=>{const{storeId:t,activateTest:n=!1}=e;return this.get(t)?.isEligibleForBackgroundActivationV3(n)})),Yn.prototype.initialize.apply(this,e)},async getStoresContent(e){return this.storesContent.fetch(e)},async getStoreContent(e){return this.storesContent.fetch(e)},async getPopupStore({url:e}={}){const t=await Wt.getActive();e||=t.url,e=e.replace(/^chrome-extension:\/\/.*\/popup\.html#/,"");const n=this.match(e,t.tabId);return n?await this.getStore({storeId:n.get("storeId"),fetch:!0}):null},async getStore({storeId:e,channel:t=st.DEFAULT}){const n=await this.getStores([e],t,{fetch:!0});return n.length?n[0]:null},async getStoresByName(e,t=st.DEFAULT,n={}){const i=e.map((e=>this.find((t=>{const n={id:t.get("storeId"),name:t.get("storeName")},i=t.get("storeNamePattern");return zn(n,e,i)})))).map((e=>e?.get("storeId"))),r=await this.getStores(i,t,n);return i.map((e=>r.find((t=>t.storeId===e))))},async getStores(e,t=st.DEFAULT,n={}){const{fetchStoreContent:i=!0,fetch:r=!1}=n||{};if(!e.length)return[];const s=[...new Set(e)];if(r)try{await this.fetch()}catch{}const a=s.filter((e=>this.get(e)?.get("activationCode")));if(!a.length)return[];await mi.add(t).fetch(a);const o=i?await this.getStoresContent(a):[];return await Promise.all(a.map((async e=>{const n=this.get(e),i=o.find((t=>t.storeId===e)),r=await n.getReward(t);return{...n.serializeWithReward(r),...i,incrementalityTest:await(n?.incrementalityTest())}})))},async getShouldUseExperimentalCoupons(e){if(!ve.variation("caaAdaptiveSources"))return!1;const t=await ni.inExperiment(At),n=await(e?.isCaaWithoutActivation()),i=await ni.inExperiment(Pt),r=!self.EBATES.loggedIn&&await ni.variation(Ct)&&await ni.inExperiment(Dt),s=i||r,a=ve.variation("acsOnPlatformAllowed",[]),o=a?.storeIds?.includes(e?.id);return t&&n||s&&o},async getCouponOffers(e){if(!e)return[];const t=(await this.getOffers(e)).filter((e=>e.code)).map((e=>(e.source="OC",e))),n=(0,P.uniq)(t,(({code:e})=>e)),i=this.get(e);let r=n;if(await this.getShouldUseExperimentalCoupons(i)){let e=[];try{e=await i.experimentalCoupons.get()}catch{}const t=n.map((e=>e.code.toUpperCase())),s=(0,P.uniq)(e,(({code:e})=>e)).filter((e=>-1===t.indexOf(e.code.toUpperCase())));r=[...n,...s]}const s=await this.getStoreContent(e),a=s?.extensionMaxCouponsUsed??ve.variation("caaWithoutActivation",{maxCoupons:15}).maxCoupons??15;return r.length=r.length>a?a:r.length,r},async getCoupons(e){const t=await this.getCouponOffers(e);return[...new Set(t.map((e=>e.code)).filter(Boolean))]},async getOffers(e){if(e){const t=this.get(e),n=await(t?.isCaaWithoutActivation());if(t?.isButtonMerchant()||n){try{await t.deals.load()}catch{}return t.deals.toJSON()}}return[]},async getStoresToUpdate(){let e=0;const t="USA"===Me.region?3e3:200;if(!this.length||this.domains.length<t){try{const t=await this.lastModifiedTimes.load();e=(0,P.max)(t,(e=>e.lastModifiedTime))?.lastModifiedTime}catch{}return{storeIds:"all",maxLastModifiedTime:e}}if(await this.lastModifiedTimes.ifUpdateRequired()){const t=await this.lastModifiedTimes.load(),n=t.filter((({id:t,lastModifiedTime:n})=>{n>e&&(e=n);const i=this.get(t);return!i||i.get("lastModifiedTime")!==n})).map((({id:e})=>e));if(n.length>100)return{storeIds:"all",maxLastModifiedTime:e};{const i=this.reduce(((e,n)=>(t.find((({id:e})=>e===n.id))||e.push(String(n.id)),e)),[]);return{storeIds:n.map((e=>String(e))),maxLastModifiedTime:e,deactivatedStoreIds:i}}}return{}},async logDatadogError(...e){if(!ve.get("ddDomainsSyncErrors"))return;const t="ddDomainsSyncErrorsTimestamp",n=await T.extension.getItem(t);n&&Date.now()-n<36e5||(we.error(...e),T.extension.setItem(t,Date.now()))},async sync(e){if("read"!==e)return;if(!this.length){const e=await Te.get(this.key)??[];this.set(e);const t=await Te.get(`${this.key}-domains`)??[];this.domains.set(t),this._dataSynced=!0,this.trigger("sync",this)}const{storeIds:t,deactivatedStoreIds:n,maxLastModifiedTime:i}=await this.getStoresToUpdate();if(n?.length&&(this.remove(n),this.domains.remove(this.domains.filter((e=>n.includes(String(e.get("storeId"))))))),t?.length){const{data:e,error:n}=await he(Oe(M),{data:{name:"all"===t?"button_domain_v2":"button_domain_batch_v2",variables:JSON.stringify({storeIds:t}),...i&&{_:i}},headers:{"X-Platform":at[st.DEFAULT]}});n&&this.logDatadogError("Merchants Network Error",{description:n.message,name:n.name,stack:n.stack,url:n.details?.response.url,status:n.details?.response.status,options:n.details?.options});const{stores:r,domains:s}=this.parse(e);return"all"===t?(this.set(r),this.domains.reset(s),Math.abs(r.length-EBATES.merchants.lastModifiedTimes.getData()?.length)>10?this.logDatadogError("Merchants Sync Error",{description:"Stores count mismatch: stores count !== lastModifiedTimes count",storesCount:r.length,lastModifiedTimesCount:EBATES.merchants.lastModifiedTimes.getData()?.length}):s.length<.75*r.length&&this.logDatadogError("Domains Sync Error",{description:"Domains count mismatch: domains count < stores count",domainsCount:s.length,storesCount:r.length})):(this.set(r,{merge:!0,add:!0,remove:!1}),this.domains.remove(this.domains.filter((e=>t.includes(String(e.get("storeId")))))),this.domains.add(s),r.length!==t.length?this.logDatadogError("Merchants Sync Error",{description:"Stores count mismatch: stores count !== storeIds count",storesCount:r.length,storeIdsCount:t.length}):s.length<.75*r.length&&this.logDatadogError("Domains Sync Error",{description:"Domains count mismatch: domains count < stores count",domainsCount:s.length,storesCount:r.length})),this.syncSettingsDomains(),this._dataSynced=!0,this.trigger("sync",this),await Te.set(`${this.key}-domains`,this.domains.map((({attributes:e})=>e))),await Te.set(this.key,this.map((({attributes:e})=>e))),this}},match(e,t){if(Gn(e)||!EBATES)return null;let n=null;const i=Le(e);if(i){const r=this.domains.where({topDomain:i}).filter((t=>t.match?.test(e)));if(r.length){if(t&&Wt.get(t)?.storeId&&r.length>1){const e=Wt.get(t)?.storeId,i=r.find((t=>t.get("storeId")===e));i&&(n=this.get(i.get("storeId")))}if(n=n||this.get((0,P.max)(r,(e=>e.match.source.length)).get("storeId")),n){if(EBATES.settings.featureFlags.variation("whitelistedCountries",!1)&&n.has("whitelistedCountries")&&EBATES.member.get("country_code")&&!n.get("whitelistedCountries").includes(EBATES.member.get("country_code").toUpperCase()))return null;t&&Wt.has(t)&&(Wt.get(t).storeId=n.get("storeId"))}}else if(t&&EBATES.settings.has("sharedPages")){let i=!1;try{i=EBATES.settings.get("sharedPages").find((t=>new RegExp(t).test(e)))}catch({message:e}){we.error("RegExpError",{description:e,sharedPages:EBATES.settings.get("sharedPages").join(","),now:Date.now(),source:"settings.sharedPages"})}if(i){const e=Wt.get(t),i=e?.storeId;i&&(n=this.get(i),n&&(e.storeId=i))}}else Wt.has(t)&&(Wt.get(t).storeId=null)}return n?n.session.checkSessionTimeout():Wt.has(t)&&(Wt.get(t).storeId=null),n},async search(e){const t=new Un(this.map((e=>e.pick(["storeId","storeName","domainName"]))),{isCaseSensitive:!1,includeScore:!1,shouldSort:!0,includeMatches:!1,findAllMatches:!1,threshold:.2,keys:["storeName","domainName"]}).search(e).map((({item:e})=>this.get(e.storeId))).filter((e=>e.isButtonMerchant()));t.length=t.length>50?50:t.length;const n=t.map((e=>e.get("storeId")));let i=await this.getStores(n,st.DEFAULT,{fetchStoreContent:!1});return i=i.filter((e=>this.isActiveMerchant(e.reward))),i},isActiveMerchant:e=>e&&["Percentage","Fixed"].includes(e.display)&&e.amount>0,parseFeedGenDomains:e=>e.reduce(((e,{storeId:t,domains:n=[]})=>e.concat(n.map((e=>({storeId:t,...e}))))),[]),async syncSettingsDomains(){this.length&&this.setMerchantsSettings()},setMerchantsSettings(){if(!ve.variation("customMerchants",!1)&&EBATES.settings.domains){const e=EBATES.settings.domains.map((({domainName:e,matchPattern:t,hoverMessage:n,...i})=>i));this.set(e,{merge:!0,add:!0,remove:!1})}},parse(e){let t=e.data.stores;const n=this.parseFeedGenDomains(t),i=this.lastModifiedTimes.getData();return t=t.map((({storeId:e,domains:t=[],activationCode:n=0,...r})=>({storeId:e,activationCode:n,domainName:t[0]?.domainName,lastModifiedTime:i?.find((({id:t})=>t===e))?.lastModifiedTime||0,...r}))),{stores:t,domains:n}},updateMerchantSession(e,t){const{sessionAttributes:n,...i}=t,r=this.get(e);if(r){const e=r.session;i&&e.set(i),n&&e.shoppingTrip.addPendingAttributes(n)}},sessionsResetAll(){this.forEach((e=>e.session.reset()))}});var qi=r(9964);const Hi=(e,t)=>t.some((t=>e instanceof t));let Wi,Vi;const Gi=new WeakMap,zi=new WeakMap,Ki=new WeakMap;let Ji={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Gi.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Qi(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Yi(e){Ji=e(Ji)}function Xi(e){return(Vi||(Vi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(er(this),t),Qi(this.request)}:function(...t){return Qi(e.apply(er(this),t))}}function Zi(e){return"function"==typeof e?Xi(e):(e instanceof IDBTransaction&&function(e){if(Gi.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));Gi.set(e,t)}(e),Hi(e,Wi||(Wi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Ji):e)}function Qi(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(Qi(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return Ki.set(t,e),t}(e);if(zi.has(e))return zi.get(e);const t=Zi(e);return t!==e&&(zi.set(e,t),Ki.set(t,e)),t}const er=e=>Ki.get(e);const tr=["get","getKey","getAll","getAllKeys","count"],nr=["put","add","delete","clear"],ir=new Map;function rr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ir.get(t))return ir.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=nr.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!tr.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&s.done]))[0]};return ir.set(t,s),s}Yi((e=>({...e,get:(t,n,i)=>rr(t,n)||e.get(t,n,i),has:(t,n)=>!!rr(t,n)||e.has(t,n)})));const sr=["continue","continuePrimaryKey","advance"],ar={},or=new WeakMap,cr=new WeakMap,ur={get(e,t){if(!sr.includes(t))return e[t];let n=ar[t];return n||(n=ar[t]=function(...e){or.set(this,cr.get(this)[t](...e))}),n}};async function*lr(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,ur);for(cr.set(n,t),Ki.set(n,er(t));t;)yield n,t=await(or.get(n)||t.continue()),or.delete(n)}function hr(e,t){return t===Symbol.asyncIterator&&Hi(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&Hi(e,[IDBIndex,IDBObjectStore])}function dr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}Yi((e=>({...e,get:(t,n,i)=>hr(t,n)?lr:e.get(t,n,i),has:(t,n)=>hr(t,n)||e.has(t,n)})));var fr,pr,gr={exports:{}};function mr(){if(pr)return fr;pr=1;var e=1e3,t=60*e,n=60*t,i=24*n,r=7*i,s=365.25*i;function a(e,t,n,i){var r=t>=1.5*n;return Math.round(e/n)+" "+i+(r?"s":"")}return fr=function(o,c){c=c||{};var u=typeof o;if("string"===u&&o.length>0)return function(a){if(a=String(a),!(a.length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(o){var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*r;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}(o);if("number"===u&&isFinite(o))return c.long?function(r){var s=Math.abs(r);return s>=i?a(r,s,i,"day"):s>=n?a(r,s,n,"hour"):s>=t?a(r,s,t,"minute"):s>=e?a(r,s,e,"second"):r+" ms"}(o):function(r){var s=Math.abs(r);return s>=i?Math.round(r/i)+"d":s>=n?Math.round(r/n)+"h":s>=t?Math.round(r/t)+"m":s>=e?Math.round(r/e)+"s":r+"ms"}(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))},fr}var vr=function(e){function t(e){let i,r,s,a=null;function o(...e){if(!o.enabled)return;const n=o,r=Number(new Date),s=r-(i||r);n.diff=s,n.prev=i,n.curr=r,i=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((i,r)=>{if("%%"===i)return"%";a++;const s=t.formatters[r];if("function"==typeof s){const t=e[a];i=s.call(n,t),e.splice(a,1),a--}return i})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(r!==t.namespaces&&(r=t.namespaces,s=t.enabled(e)),s),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,n){const i=t(this.namespace+(typeof n>"u"?":":n)+e);return i.log=this.log,i}function i(e,t){let n=0,i=0,r=-1,s=0;for(;n<e.length;)if(i<t.length&&(t[i]===e[n]||"*"===t[i]))"*"===t[i]?(r=i,s=n,i++):(n++,i++);else{if(-1===r)return!1;i=r+1,s++,n=s}for(;i<t.length&&"*"===t[i];)i++;return i===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(i(e,n))return!1;for(const n of t.names)if(i(e,n))return!0;return!1},t.humanize=mr(),t.destroy=function(){},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var n={};t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))})),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!e&&typeof qi<"u"&&"env"in qi&&(e=n.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0)}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=vr(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(gr,gr.exports);const yr=dr(gr.exports);const br=typeof window<"u"?window.chrome||window.browser:typeof chrome<"u"?chrome:void 0,wr=typeof window<"u"&&typeof br<"u"&&!!br.extension,Er="reclaimEventLog";!function(){if(typeof navigator>"u")return!1;const e=navigator.userAgent;e.includes("Chrome")&&e.includes("Edg/")}();class Ar{}const xr=new class extends Ar{constructor(){super(),this.name="RECLAIM_SDK",this.logger=yr(this.name),this.logMethods=["log","info","warn","error"],this.logMethods.forEach((e=>{this[e]=(...t)=>this.createLogLevel(e)(...t)}))}createLogLevel(e){return["log","info"].includes(e)?()=>{}:wr?(...t)=>{const n=t[0],i=t[1],r={level:e,message:n,data:i,name:this.name,ts:(new Date).toISOString()};!async function(e){try{const t=await(br?.runtime.sendMessage(e));return xr.log("Message received from background script:",t),t}catch(e){return xr.error("Failed to send event to background:",e),Promise.reject(e)}}({name:Er,state:r})}:(this.logger[e]=function(){}.bind(),(...t)=>{const n=t[0],i=t[1];this.logger[e]({level:e,message:n,data:i,name:this.name,ts:(new Date).toISOString()})})}},Tr="PluginState";class Sr{constructor(){try{this.dbPromise=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(e,t),o=Qi(a);return i&&a.addEventListener("upgradeneeded",(e=>{i(Qi(a.result),e.oldVersion,e.newVersion,Qi(a.transaction),e)})),n&&a.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}("ReclaimSDK",1,{upgrade(e){e.objectStoreNames.contains(Tr)||e.createObjectStore(Tr,{keyPath:"key"})}})}catch(e){const t=e;xr.error(`StorageWrapper error: ${t.message}`,e)}}async get(e){return this.dbPromise?(await this.dbPromise).get(Tr,e):void 0}async set(e,t){this.dbPromise&&await(await this.dbPromise).put(Tr,{key:e,value:t,lastUpdated:(new Date).toISOString()})}async delete(e){this.dbPromise&&await(await this.dbPromise).delete(Tr,e)}}function _r(e){return e?Object.keys(e).map((t=>function(e,t){const n=t.indexOf("/"),i=[t.slice(0,n),t.slice(n)];return{name:e,extensionId:i[0],resourcePaths:[i[1]]}}(t,e[t]))):[]}const kr=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Ir=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");const t=e.match(kr);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},Cr=e=>"*"===e||"x"===e||"X"===e,Dr=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},Pr=(e,t)=>{if(Cr(e)||Cr(t))return 0;const[n,i]=((e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t])(Dr(e),Dr(t));return n>i?1:n<i?-1:0},Br=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const i=Pr(e[n]||"0",t[n]||"0");if(0!==i)return i}return 0},Mr=(e,t,n)=>{Or(n);const i=((e,t)=>{const n=Ir(e),i=Ir(t),r=n.pop(),s=i.pop(),a=Br(n,i);return 0!==a?a:r&&s?Br(r.split("."),s.split(".")):r||s?r?-1:1:0})(e,t);return Rr[n].includes(i)},Rr={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},Nr=Object.keys(Rr),Or=e=>{if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===Nr.indexOf(e))throw new Error(`Invalid operator, expected one of ${Nr.join("|")}`)},Lr=(e,t)=>{if((t=t.replace(/([><=]+)\s+/g,"$1")).includes("||"))return t.split("||").some((t=>Lr(e,t)));if(t.includes(" - ")){const[n,i]=t.split(" - ",2);return Lr(e,`>=${n} <=${i}`)}if(t.includes(" "))return t.trim().replace(/\s{2,}/g," ").split(" ").every((t=>Lr(e,t)));const n=t.match(/^([<>=~^]+)/),i=n?n[1]:"=";if("^"!==i&&"~"!==i)return Mr(e,t,i);const[r,s,a,,o]=Ir(e),[c,u,l,,h]=Ir(t),d=[r,s,a],f=[c,null!=u?u:"x",null!=l?l:"x"];if(h){if(!o)return!1;if(0!==Br(d,f))return!1;if(-1===Br(o.split("."),h.split(".")))return!1}const p=f.findIndex((e=>"0"!==e))+1,g="~"===i?2:p>1?p:1;return 0===Br(d.slice(0,g),f.slice(0,g))&&-1!==Br(d.slice(g),f.slice(g))};const jr=qn.Model.extend({idAttribute:"created",defaults:{created:null,removed:!1,shown:!1,text:""},initialize(){this.get("created")||this.set("created",Date.now()),this.on("change:unread",(()=>{this.collection.trigger("change")}))},toJSON(e){const t=qn.Model.prototype.toJSON.apply(this,[e]);if("cashback"===this.get("type")){const e=EBATES.merchants.get(this.get("storeId"));e&&(t.store=e.toJSON())}return t}}),Ur=Qn.extend({key:"messages",model:jr,initialize(){this.fetch({silent:!0}),this.on({"add remove change reset":function(){const e=this.where({shown:!1}).length;EBATES.badge.update("message",e),this.save()},add:async function(e){ve.variation("desktopNotifications",!0)&&T.browser.isWebkit&&e.get("desktop")&&await this.checkPermission()&&new Fr({...e.toJSON(),id:e.id},this).render()}})},flush(){return this.remove(this.filter((e=>{const t=e.has("created")&&e.get("shown")&&e.get("created")<Date.now()-EBATES.settings.get("messageExpires");return e.get("removed")||t}))),Promise.resolve()},async checkPermission(){try{return await s().permissions.contains({permissions:["notifications"]})}catch{return!1}}});class Fr{category="Desktop Notification";notificationId="";constructor(e,t){this.message={...e},this.collection=t,this.attachEvents()}onButtonClicked=async e=>{e===this.notificationId&&(this.click(),this.track("Click Module",{cta_type:this.message.cta}))};onClicked=async e=>{e===this.notificationId&&(this.message.url&&!this.message.cta&&this.click(),this.track("Click Module",{cta_type:"Message"}))};onClosed=e=>{e===this.notificationId&&(this.track("Click Module",{cta_type:"Close"}),!this.message.popup&&this.message.desktop&&this.collection?.remove(this.message),this.detachEvents())};getEventParams(){return{module_type:this.category,entity_name:this.message.entity,store_name:this.getMerchantName()}}getMerchantName(){return this.message.storeId&&EBATES.merchants.has(this.message.storeId)?EBATES.merchants.get(this.message.storeId).get("storeName"):void 0}track(e,t={}){self.EBATES.segment.track(e,{...this.getEventParams(),...t})}async click(){if(!this.message.url)return;const e=ae(this.message.url,{visit_id:EBATES.holistic.visit_id});this.track("Visit Page",{preceding_screen_name:this.category,url:e}),T.browser.navigate({url:e,tabId:T.browser.NEWTAB}),await s().notifications.clear(this.notificationId),this.detachEvents()}attachEvents(){s().notifications.onButtonClicked.addListener(this.onButtonClicked),s().notifications.onClicked.addListener(this.onClicked),s().notifications.onClosed.addListener(this.onClosed)}detachEvents(){s().notifications.onButtonClicked.removeListener(this.onButtonClicked),s().notifications.onClicked.removeListener(this.onClicked),s().notifications.onClosed.removeListener(this.onClosed)}async render(){try{const e=this.message,t=await s().notifications.create({type:"basic",title:e.title??T.extension.name,iconUrl:e.image??s().runtime.getURL("/img/icon/icon-128.png"),message:e.text,buttons:e.url&&e.cta?[{title:e.cta}]:null});this.notificationId=t,this.track("View Module")}catch(e){}}}const $r=Kn.extend({defaults:{popup:!1,badge:!1,shown:!1,active:!1},campaigns:null,initCampaigns(){this.has("campaigns")&&(this.campaigns||(this.campaigns=new Gr(null,this)),this.campaigns.set(this.get("campaigns")))},isActive(){if(EBATES?.member.isExtensionDisabled())return!1;if(this.has("expires")&&this.has("starts")){const e=Date.now(),t=new Date(this.get("starts")).getTime(),n=new Date(this.get("expires")).getTime();return this.set({active:e>=t&&e<n&&this.isCampaignSupported()}),this.get("active")}{const e=this.isCampaignSupported();return e||this.set({active:!1}),e}},initTimeouts(){if(this.has("expires")&&this.has("starts")){this.timeout&&self.clearInterval(this.timeout);const e=Date.now(),t=new Date(this.get("starts")).getTime(),n=new Date(this.get("expires")).getTime();this.set({active:e>=t&&e<n&&this.isCampaignSupported()});const i=e=>(0,P.min)([new Date(e).getTime()-Date.now(),6e5]);let r;e<t?r=i(t):e<n&&(r=i(n)),r&&(this.timeout=self.setInterval((()=>{this.initTimeouts()}),r))}},isCampaignSupported(){let e=!0;return this.get("browser")&&(e=(0,P.contains)(this.get("browser").split(","),T.browser.name)),this.get("version")&&(e=e&&Lr(R().version,this.get("version"))),e},activate(){this.get("badge")&&!this.get("shown")&&(EBATES.badge.update("promo",1),EBATES.member.overlays.where({shown:!1}).forEach((e=>e.set({shown:!0}))),EBATES.member.overlays.save()),ve.variation("desktopNotifications",!0)&&this.get("desktopTitle")&&this.get("desktopMessage")&&!this.get("desktopMessageShown")&&EBATES.member.messages.checkPermission().then((()=>{new Fr({type:this.id,title:this.get("desktopTitle"),text:this.get("desktopMessage"),url:Oe(this.toJSON().url),image:this.get("icon"),entity:this.id}).render(),this.set({desktopMessageShown:!0})})).catch((()=>{})),this.get("overlay")&&this.get("overlay").template&&!EBATES.member.overlays.get(this.id)&&EBATES.member.overlays.add({id:this.id,view:"CustomOverlayView",persistent:this.get("overlay").persistent,template:this.get("overlay").template})},initialize(){this.isCampaignSupported()?(this.on({"change:campaigns":function(){this.initCampaigns()},"change:starts change:expires":function(){this.initTimeouts()},"change:active":function(e,t){t?this.activate():(EBATES.member.overlays.remove(this.id),EBATES.member.overlays.save(),EBATES.badge.update("promo",0)),"icons"===this.id&&setTimeout((()=>EBATES.icon.load()),500)},"change:shown":function(e,t){t&&EBATES.badge.update("promo",0)}}),this.get("active")&&this.activate(),this.initCampaigns(),this.initTimeouts()):this.set({active:!1})},toJSON(e){return{...Kn.prototype.toJSON.apply(this,[e]),...this.collection.savedAttributes.get(this.id)}}}),qr=Yn.extend({model:$r,key:"promos",url:()=>Oe(B.SETTINGS_PROMOS),UPDATE_INTERVAL:108e5,parse(e){return e.promos.map((e=>({...e,...this.savedAttributes.get(e.id)})))},fetch(...e){return!1!==ve.variation("customPromos",!1)&&Yn.prototype.fetch.apply(this,e)},initialize(...e){this.savedAttributes=new Map,Te.get(`${this.key}-attributes`).then(((e=[])=>{this.savedAttributes=new Map(e)}));const t=["shown","desktopMessageShown","interruptShown","serpClosed","disabled","data"];return this.on("change",(e=>{(0,P.intersection)(Object.keys(e.changedAttributes()),t).length>0&&(this.savedAttributes.set(e.id,e.pick(t)),this.saveLocalAttributes())})),T.extension.attachEvent("updatePromo",(({data:e={}})=>{const{id:t,...n}=e;this.get(t)&&(this.get(t).set(n),T.extension.fireEvent("promoUpdated",{tabId:T.browser.ALLTABS,data:this.get(t).toJSON()}))})),T.extension.attachEvent("getCampaignStores",(async({data:e},t)=>{const{id:n,fetch:i=!1,rewards:r=!1}=e,s=(0,P.flatten)(this.map((e=>e.campaigns?.models)).filter(Boolean)).find((e=>e.id===n));if(s){const e=s.get("channel")||st.DEFAULT;if(i)try{await s.stores.fetch(),await mi.add(e).fetch(s.stores.pluck("storeId"))}catch{t(null)}t(r?s.stores.toJSON():s.stores.map((e=>({storeId:e.id}))))}else t(null)})),Yn.prototype.initialize.apply(this,[e])},saveLocalAttributes(){for(const e of this.savedAttributes)this.get(e)||this.savedAttributes.delete(e);Te.set(`${this.key}-attributes`,[...this.savedAttributes])},getActive(){return this.find((e=>e.get("active")&&Date.now()>=new Date(e.get("starts")).getTime()&&Date.now()<new Date(e.get("expires")).getTime()))}}),Hr=Kn.extend({idAttribute:"storeId",toJSON(e){const t=EBATES.merchants.get(this.get("storeId"));if(t?.has("shoppingURL")&&t.isButtonMerchant()){const n=t.toJSON(),i=ae(n.shoppingURL.replace("&store_url=%deepLinkUrl%",""),{merchantId:n.storeId,domainName:n.domainName,tb:"yes",toolbarId:EBATES.toolbarId,sourceName:$e,channel:st.DEFAULT,toolbarFeatureId:"TOPSTORES",tb_v:R().version,eeid:n.mpl?ot.MPL_STORE:"26142",mpl_id:n.mpl});return{...Kn.prototype.toJSON.apply(this,[e]),...n,shoppingURL:i}}}}),Wr=Yn.extend({model:Hr,DEFAULT_UPDATE_INTERVAL:864e5,url(){return oe(Oe(M),{name:"button_campaigns_v1",variables:`{"id": ${this.id}}`})},initialize(e,t,...n){return this.id=t.id,this.key=`campaigns/${this.id}`,this.campaign=t,t.get("update")&&(this.UPDATE_INTERVAL=t.get("update"),this.dynamic=!0),this.on("error",(async(e,t,n)=>{const i=t.status;if(i>=300&&i<600&&304!==i&&418!==i){const e=this.campaign.collection.promo;we.warn("NetworkException",{type:"campaign",url:this.url(),campaign:e?e.toJSON():this.id,localTime:(r="YYYY-MM-DD HH:mm",Wn()(s).format(r)),responseStatus:i,errorThrown:n.errorThrown})}var r,s})),Yn.prototype.initialize.apply(this,[e,t,n])},parse(e){const t=e?.campaigns?e.campaigns?.pop():e?.data?.campaign;if(t)return this.details=(0,P.pick)(t,["name","start","expires"]),t.stores},fetch(...e){const t=this.campaign.collection.promo;return this.id&&t&&t.isActive()?Yn.prototype.fetch.apply(this,e):Promise.resolve()},toJSON(e){return Yn.prototype.toJSON.apply(this,[e]).filter(Boolean)}}),Vr=qn.Model.extend({defaults:{popup:!1,hover:!1,update:0},lastUpdateTimestamp:0,initialize(){this.stores=new Wr(null,this),this.get("stores")&&this.stores.set(this.get("stores")),this.listenTo(this.collection.promo,"change:active",(e=>{this.stores.dynamic=e.get("active"),e.get("active")&&this.get("update")&&(this.get("popup")||this.get("tab")||this.get("hover"))&&(mi.default.reset(),this.stores.fetch())})),this.collection.promo.get("active")&&setTimeout((()=>this.stores.fetch()),3e3),this.collection.promo.set(this.pick((e=>!0===e)))}}),Gr=qn.Collection.extend({model:Vr,initialize(e,t){this.promo=t}});function zr(e,t){let n=0;if(!e)return n;switch(e.display){case"Percentage":n=Math.round(t*e.amount)/100;break;case"Fixed":n=e.amount}return n}function Kr(e,t,n=100){function i(e,t,n){return e.split(/ *&& */).reduce(((e,i)=>function(e,t,n=100){const[i,r,s,a]=/^([<>]=?)(\d+(?:\.\d+)?)(%?)$/.exec(e)||[];if(!i)throw new Error("Invalid input");const o=a?n*parseFloat(s)/100:parseFloat(s);return">"===r?t>o:"<"===r?t<o:">="===r?t>=o:"<="===r&&t<=o}(i,t,n)&&e),!0)}return function(e,t,n){return e.split(/ *\|\| */).reduce(((e,r)=>i(r,t,n)||e),!1)}(e,t,n)}const Jr=/\b(?:clearance|memberships?|pickup|delivery|clearance)\b/,Yr=/\bother\b/;let Xr;class Zr{api_call="";storeName="";module_type="Price Magic";entity_name="Price Magic Notification";constructor({canonical_url:e,domainName:t,query:n={},storeName:i,isLuxury:r}){this.requestId=D(),this.canonical_url=e,this.domainName=t,this.query=n,this.storeName=i,this.isLuxury=r}get url(){return Oe(B.PRICE_MAGIC)}get bulkUrl(){return Oe(B.PRICE_MAGIC_BULK)}async fetch(){const e=await this.getPriceMagicTest(),t=ae(this.url,{...this.query,postfilter:Xr.postfilter,user_abSegment:e});this.api_call=t;const{data:n}=await he({url:t,error:(e,n,i)=>{throw this.trackRequestAPI({url:t,status:n}),{response:e,status:n,error:i}}});if(!n)return;let i=this.parse(n);await this.fetchRewards(i),i=this.populateURLs(i);let r=await this.populateMerchant(i);r=this.processProducts(r,this.query),r=this.sortProducts(r);const s=this.checkProducts(r);return this.trackRequestAPI({url:t,products:r,product:s}),s}async getPriceMagicTest(){if(!await ni.inExperiment(yt))return"";const e=await ni.activate(yt);return"X"===e?"segment_x":"A"===e?"segment_a":""}async fetchBulk(e){let t=0;let n=0,i=[];const r=e.map((({asin:e})=>e)).join(",");if(!r)return[];this.entity_name="Search result micro-activation button";let s=0;const a=await this.getPriceMagicTest();do{const e=ae(this.bulkUrl,{asins:r,hits:60,offset:n,postfilter:Xr.postfilter,user_abSegment:a});this.api_call=e;const{data:o}=await he({url:e,error:(t,n,i)=>{throw this.trackBulkRequestAPI({url:e,status:n}),{response:t,status:n,error:i}}});if(!o)break;let c=this.parse(o);if(await this.fetchRewards(c),c=this.populateURLs(c),c=await this.populateMerchant(c),this.trackBulkRequestAPI({url:e,products:c}),i=i.concat(c),n+=60,t=o.hits.total,s++>=5)break}while(t>i.length);return e.map((e=>{let t=i.filter((({asins:t})=>t.includes(e.asin)));t=t.map((t=>this.processProduct({...t},e))),t=this.sortProducts(t);const n=this.checkProducts(t);return{...e,pmProduct:n}}))}parse(e){return e.hits.hits.map((t=>({...t._source,algorithmMatched:t._source.algorithmMatched??e.algorithmMatched??"idenMatch"})))}fetchRewards(e){if(e.length)try{const t=(0,P.unique)(e.map((e=>e.storeId)));return self.EBATES.merchants.rates.get(st.PRICE_MAGIC).fetch(t)}catch{}}populateURLs(e){return e?.map((e=>Ne({...e},`https://${B.PRODUCT_CDN}`)))}async populateMerchant(e){const t=[...new Set(e.map((e=>e.storeId)))],n=await self.EBATES.merchants.getStores(t,st.PRICE_MAGIC),i=(await Promise.all(e.map((async e=>{const t=n.find((t=>t.storeId===e.storeId));return t?(t.reward.current="",t.reward.currentText="",{...e,merchant:t}):null})))).filter(Boolean);return await(self.EBATES.merchants.tiers.get(st.PRICE_MAGIC)?.fetch(t)),t.forEach((e=>{const t=self.EBATES.merchants.tiers.get(st.PRICE_MAGIC)?.stores.get(e)?.tiers;t&&i.forEach((n=>{n.merchant.storeId===e&&(n.merchant.tiers=t)}))})),i}processProducts(e,t){return e.map((e=>this.processProduct(e,t)))}processProduct(e,t){const n=e.salePrice;let i=0;if(e.eligibleForCashBack&&e.merchant&&e.merchant.reward){let t=e.merchant.reward,r=null;t.range&&e.merchant.tiers&&ve.variation("pmTieredCalc")&&(r=e.merchant.tiers.find((({id:t})=>parseInt(t,10)===parseInt(e.categoryId,10))),e.cb_type="tiered"),r&&(e.merchant.reward=t=r.reward),t.range||(i=zr(t,n)),Xr.affiliatizedLinks.find((t=>e.productUrl.indexOf(t)>0))?e.cta_type="aff_link":e.merchant.affiliatizerEnabled?e.cta_type="affiliatizer-yes":e.cta_type="affiliatizer-no"}else e.cta_type="no-cb";const r=t.salePrice;return e.originalPrice=r,e.salePrice=n,e.finalPrice=n-i,e.cashBackAmount=i,e.savingsAmount=r-n+i,e.asin=t.asin,e.isLuxurySource=this.isLuxury,e}sortProducts=e=>ve.variation("pmScoringEnabled")?this.sortByScores(e):this.sortByPrice(e);sortByPrice=e=>e=(0,P.chain)(e).sortBy((e=>-e.savingsAmount)).sortBy((e=>!e.merchant)).value();sortByScores=e=>(this.setPoints(e),e=(0,P.chain)(e).sortBy((()=>Math.random())).sortBy((e=>e.finalPrice)).sortBy((e=>e.merchant?.pmScore)).sortBy((e=>-(e.points??0))).value());setPoints=e=>{e.forEach((e=>{let t=e.merchant?.pmScore??0;e.savingsAmount<0?t=0:t+=Math.floor(e.savingsAmount),e.points=t}))};processPredictedTiers(e){const t="not found",n="non tier",i={type:t,tier:{id:t,name:t}},r=e.map((e=>{const t=e.merchant;return t?.tiers?function(e,t){if(0===t.length||!("name"in t[0]))return null;const n=e.categoryPathEbates.toLowerCase().split(" > ").reverse(),i=t.map((e=>{const t=e.name.toLowerCase();return{...e,name:t,nameSplit:t.split(/[,&]/).map((e=>e.trim()))}}));for(const e of n)for(const t of i)if(!Jr.test(t.name)&&!Yr.test(t.name)&&t.name===e)return{tier:t,type:"Type A"};const r=n.reduce(((e,t)=>e.concat(t.split(/[,&]/).map((e=>e.trim())))),[]);for(const e of r)for(const t of i)if(!Jr.test(t.name)&&!Yr.test(t.name)&&t.nameSplit.includes(e))return{tier:t,type:"Type B"};if(i.find((e=>Jr.test(e.name))))return null;const s=i.find((e=>Yr.test(e.name)));return s?{tier:s,type:"Type C"}:null}(e,t.tiers)??i:null}));return r.filter(Boolean).length>0?{predicted_tier:r.map((e=>e?.tier?.name??n)).join(","),predicted_tier_id:r.map((e=>e?.tier?.id.toString()??n)).join(","),predicted_tier_type:r.map((e=>e?.type.toString()??n)).join(",")}:{}}async trackRequestAPI({url:e,status:t,products:n=[],product:i}){const r=i,s=r?.merchant,a=n.filter((e=>e.merchant&&e.merchant?.storeId!==s?.storeId)),o=a.map((e=>e.merchant)),c=n.map((e=>this.query.salePrice-e.salePrice)).map((e=>e.toFixed(2))).toString(),u=this.processPredictedTiers(n),l=await Pe("www.rakuten.com","_mall_uuid"),h={entity_name:this.module_type,rec_stores_scores:n.map((e=>e.points)).filter(Number.isInteger).toString(),rec_stores_savings:n.map((e=>e.savingsAmount.toFixed(2))).toString(),title:this.query.title,brandName:this.query.brandName,asin:this.query.asin,breadcrumb:this.query.breadcrumb,current_product_price:this.query.salePrice,rec_stores_priceDelta_savings:c,rec_stores_cashBack_savings:n.map((e=>e.cashBackAmount)).toString(),winning_store_id:s?.storeId,winning_store_listing_type:r?.thirdPartyMerchantTag,winning_store_name:s?.storeName,suppressed_store_ids:o.map((e=>e?.storeId)).filter(Boolean).toString(),suppressed_store_names:o.map((e=>e?.storeName)).filter(Boolean).toString(),product_condition:this.query.condition,isLuxury:this.isLuxury,winningPrice:r?.salePrice,winningCashBack:r?.cashBackAmount,listingId:r?.listingId,cks:l,...u};this.trackBulkRequestAPI({url:e,status:t,products:n,data:h})}trackBulkRequestAPI({url:e,status:t,products:n=[],data:i={}}){const r={module_type:this.module_type,entity_name:`${this.module_type} ${this.entity_name}`,domain:this.domainName,api_call:e,error:t??null,recs:n.length,algorithmMatched:n.length?n[0].algorithmMatched:null,rec_stores:n.map((e=>e.store)).toString(),rec_store_ids:n.map((e=>e.storeId)).toString(),rec_stores_listing_type:n.map((e=>e.thirdPartyMerchantTag)).toString(),canonical_url:this.canonical_url,product_upc:n.map((e=>e.upcs)).toString(),requestId:this.requestId,...i};self.EBATES.segment.track("Request API",r)}checkProducts(e){if(!e.length)return;let t="";const n=e.find((e=>{if(e.savingsAmount>0){const n=Xr.exclusions.find((t=>t.storeId===e.merchant?.storeId));if(n){if(!n.excludedCategories&&!n.includedCategories)return this.excludedEvent("PriceMagic_excluded_rec",e,"exluded store"),!1;if(n.excludedCategories?.includes(e.categoryId)||!n.includedCategories?.includes(e.categoryId))return this.excludedEvent("PriceMagic_excluded_rec",e,"exluded category"),!1}return self.EBATES.settings.userSettings.get("progressiveEducation").PriceMagic&&e.savingsAmount<Xr.thresholdAmount?(t="below first-time savings threshold",!0):e.merchant&&0!==e.merchant.activationCode?this.checkThresholdTier(e)||18397===e.merchant.storeId?(e.merchant.incrementalityTest,!0):(this.excludedEvent("PriceMagic_excluded_rec",e,"excluded range"),!1):(this.excludedEvent("PriceMagic_excluded_rec",e,"exluded store"),!1)}return t=0===e.savingsAmount?"same price":e.salePrice>e.originalPrice?"rec more expensive":"excluded store",!0}));if(!t||!n)return n;this.excludedEvent("PriceMagic_hid_bar",n,t)}checkThresholdTier=e=>{if(!Xr.tiers)return!0;const t=Xr.tiers.find((t=>{const n=!t.algorithmMatched||t.algorithmMatched?.split(",").includes(e.algorithmMatched),i=!t.storeName||t.storeName===this.storeName,r=!t.recommendedStoreIds||t.recommendedStoreIds.includes(e.merchant?.storeId??0);return n&&i&&r}));if(t){const n=t.ranges?.find((t=>(!t.savings||Kr(t.savings,e.savingsAmount,e.originalPrice))&&(!t.price||Kr(t.price,e.finalPrice,e.originalPrice))));return n}return!1};excludedEvent(e,t,n=null){const i={domain:this.domainName,rec_store_name:t.store,rec_store_id:t.storeId,api_call:this.api_call,algorithmMatched:t.algorithmMatched,current_product_price:t.originalPrice?.toFixed(2),savings_amount:t.savingsAmount?.toFixed(2),rec_product_price:t.salePrice?.toFixed(2),category:t.categoryName,product_upc:t.upcs?.toString(),listingId:t.listingId,reason:n};let r="Exclude from Price Magic";return"PriceMagic_hid_bar"===e&&(r="Suppress Module"),this.track(r,i),r}track(e,t={}){self.EBATES.segment.track(e,{module_type:this.module_type,entity_name:this.entity_name,requestId:this.requestId,...t})}}const Qr=new class extends me{_id="price-magic-domains";UPDATE_INTERVAL=108e5;constructor(){super()}get url(){return Oe(B.SETTINGS_PM)}parse(e){const t=e?e.domains:[];return t.forEach((e=>{e.enabled=e.enabled||!0})),t}};class es{key="installedExtensions";extensions=[];constructor(){this.initialize()}set(e){const t=[];for(const[n,i]of Object.entries(e))t.push({installed:!1,...this.extensions.find((e=>e.id===n)),id:n,url:i});Object.assign(this.extensions,t),this.extensions=this.extensions.filter((({id:t})=>e[t])),self.EBATES.setUninstallURL()}initialize(){T.extension.attachEvent("installedExtensions",(()=>this.getInstalledExtensions())),T.extension.attachEvent("saveAndSendInstalledExtensions",(({data:e})=>{const{extensions:t}=e;this.extensions=t,T.extension.setItem("installed_extensions_check",Date.now()),this.save(),this.sendEvents(),self.EBATES.setUninstallURL()})),this.load()}save(){T.extension.setItem(this.key,this.extensions)}async load(){const e=await T.extension.getItem(this.key);e&&Object.assign(this.extensions,e)}sendEvents(){const e=this.getInstalledExtensions();self.EBATES.segment.track("Competitor Applications",{extensions:e.toString()})}getInstalledExtensions(){return this.extensions.filter((({installed:e})=>e)).map((({id:e})=>e))}}class ts{constructor(e,t){this.type=t,this.matches=new Map,this.data=new Set(e)}findMatch(e){return[...this.data].find((t=>"string"==typeof t?e.indexOf(t)>0:!(t.source.includes("booking\\.com")&&!ve.variation("customBookingStanddown"))&&t.test(e)))}add(e){e.forEach((e=>this.data.add(e)))}set(e){this.data=new Set(e)}match(e,t){const n=this.findMatch(e);if(n){if("suppresses"===this.type){const t=self.EBATES?.settings?.get("standDownConfig"),i=t?.selfPrevention;if(i){const t="string"==typeof n?n:n.source,{genericParams:r,rrQueryParams:s}=i,a=r?.some((e=>t.includes(e)));if(a){const t=s?.some((t=>new RegExp(t).test(e)));if(t)return null}}}const i=/ebs(\d{10})sbe/.exec(e),r=i?.[0],s=this.matches.get(t)??[];s.push({url:e,timeStamp:Date.now(),paidLink:n,...r&&{ttn:r}}),this.matches.set(t,s)}return n}clear(e){this.matches.delete(e)}state(e){const t=Date.now()-6e4,n=(this.matches.get(e)??[]).filter((({timeStamp:e})=>e>t));return n.length&&this.matches.set(e,n),n[0]}addParameters(e,t){const n=this.matches.get(e);n?this.matches.set(e,n.map((e=>({...e,...t})))):this.matches.set(e,[{...t,timeStamp:Date.now()}])}}class ns{suppresses=new ts([],"suppresses");activations=new ts([],"activations");constructor(){this.activationRegexs(),T.browser.attachEvent(T.browser.TABCLOSED,(({tabId:e})=>this.clear(e))),T.browser.attachEvent(T.browser.BEFORENAVIGATE,(({url:e,tabId:t})=>{e&&this.match(e,t)})),T.extension.attachEvent("interstitial",(({tabId:e,data:t})=>this.onInterstitial(t,e)))}activationRegexs(){this.activations.set([new RegExp(`^[^?]*${Me.get("domain").replace(/\./g,"\\.")}\\/.*(?:createShoppingSession|xfas|mall_ctrl\\.do)`),/\.shopstyle(?:qa)?\.com\/\w+\/(?:loadRetailerProductPage|apiVisitRetailer)/,/\/\/shopping\.yahoo\.com\/rd\?.*?providerId=rkt/])}onInterstitial(e,t){const{trackingTicketNumber:n,partner:i,reward:r}=e;!i||n&&r?this.activations.addParameters(t,e):this.activations.clear(t)}match(e,t){this.activations.match(e,t)||this.suppresses.match(e,t)}state(e=0){return{tabId:e,activation:this.activations.state(e),suppress:this.suppresses.state(e)}}clear(e=0){this.suppresses.clear(e),this.activations.clear(e)}}function is(e,t=null){return e.then((e=>e)).catch((()=>t))}const rs=new class extends me{_id="coupons";DEFAULT_UPDATE_INTERVAL=864e5;constructor(){super(),T.extension.attachEvent("coupons.getConfigs",(async({data:e})=>{const{url:t,storeId:n}=e;return t?await this.match({url:t,storeId:n}):null})),T.extension.attachEvent("coupons.hasConfigs",(async({data:e})=>{const{storeId:t}=e;if(!t)return!1;const n=await this.getConfigs();return!!n?.find((e=>e.storeId===t&&this.validateConfig(e)))}))}get url(){return Oe(B.SETTINGS_COUPONS)}validateConfig(e){const t=e.controls;return(0,P.isObject)(t)&&((0,P.isObject)(e.apply)&&"submit"in e.apply&&(0,P.isString)(e.apply.submit)||(0,P.isArray)(e.apply)&&e.apply.every((e=>"submit"in e&&(0,P.isString)(e.submit))))&&((0,P.isString)(t.promo)||(0,P.isString)(t.promo?.selector))&&((0,P.isString)(t.total)||(0,P.isString)(t.total?.selector))}async getConfigs(){return ve.get("caa",!0)?is(this.load(),[]):[]}async match({url:e,storeId:t}){if(Gn(e))return[];e=e.substring(0,200);return(await this.getConfigs()).filter((n=>(!t||n.storeId===t)&&[].concat(n.url).find((t=>new RegExp(t,"i").test(e)))))}parse(e){const t=e=>{try{return new RegExp(e),!0}catch{return!1}};return e?.coupons?.length?(e.coupons.forEach((e=>{const n=[].concat(e.url);e.url=n.map(Vn).filter(t)})),e.coupons.filter((e=>e.url.length>0))):[]}};class ss{constructor(){const e=Me.get("domain").replace(/(?:www)?/,"").replace(/\./g,"\\.");this.config=[{matchPattern:e,reward:{ttn:{selector:"meta[name=trackingTicket]",attribute:"content"},amount:{selector:"meta[name=rewardAmount]",attribute:"content"},display:{selector:"meta[name=rewardType]",attribute:"content"},range:{selector:"meta[name=rewardRange]",attribute:"content"},interstitialType:{selector:"meta[name=interstitialType]",attribute:"content"}}},{matchPattern:"\\.shopstyle(?:qa)?\\.com\\/\\w+\\/(?:loadRetailerProductPage|apiVisitRetailer)",defaults:{display:"Percentage",partner:"ShopStyle",sessionInterval:6048e5},reward:{ttn:{selector:"meta[name=trackingTicketNumber]",attribute:"content"},amount:{selector:"meta[name=rewardAmount]",attribute:"content"},display:{selector:"meta[name=rewardType]",attribute:"content"},range:{selector:"meta[name=rewardRange]",attribute:"content"}}},{matchPattern:"\\/\\/shopping\\.yahoo\\.com\\/rd\\?.*?providerId=rkt",defaults:{display:"Percentage",partner:"Yahoo"},reward:{ttn:{selector:'div[class^="Cashback__TrackingInfo-"]',rx:"#(\\d+)"},amount:{selector:'div[class^="Cashback__CashbackInfo-"]',rx:"(.*?)%"}}}]}get(e){return this.config.find((({matchPattern:t})=>e.search(t)>=0))}}const as="similar-stores-exclusions-list";const os=new class{constructor(){T.extension.attachEvent("setSimilarStoreExclusion",(({data:e})=>{this.setStoreExclusion(e.domain)}))}async initStoreExclusions(){if(self.EBATES?.feed?.previewToken)return Te.set(as,new Map),void(this.exclusionsList=new Map);this.exclusionsList??=await Te.get(as)??new Map,this.exclusionsList?.forEach(((e,t)=>{e+18e5<Date.now()&&this.exclusionsList?.delete(t)})),Te.set(as,this.exclusionsList)}async hasStoreExclusion(e){return!!e&&(await this.initStoreExclusions(),this.exclusionsList?.has(e))}async setStoreExclusion(e){e&&(await this.initStoreExclusions(),this.exclusionsList?.set(e,Date.now()),Te.set(as,this.exclusionsList))}async fetch(e){const t=await this.findSimilarResults(e);if(!t)return null;const n=(await this.fetchStores(t.stores.map((e=>e.storeId)))).filter((e=>e.offers_cb)).slice(0,4);return{...this.mergeSimilarStores(t,n),storeDomain:e}}async findSimilarResults(e){const t=await self.EBATES.feed.similarStoresFeed.loadData(),n=t?.find((t=>t.domains.includes(e)));return n??null}async fetchStores(e){return(await self.EBATES.merchants.getStores(e,st.BUTTON_COMPETITOR_BANNER)).filter(Boolean).filter((e=>e.offers_cb))}mergeSimilarStores(e,t){const n=new Map(t.map((e=>[e.storeId,e]))),i=e.stores.reduce(((e,t)=>{const i=t.storeId,r=n.get(i);return r&&e.push({...t,...r}),e}),[]);return{...e,stores:i}}},cs="increased-cashback-notification";const us=new class{lookback=Nt.WEEK;dailyFreq=1;lookbackFreq=7;constructor(){T.extension.attachEvent("increased-cb:shown",(({data:e})=>{const{merchant:t}=e;self.EBATES.merchants.recent.updateReward(t.storeId,t.reward),this.setDisplayTime()}))}async setDisplayTime(){await this.initStorageTimer(),this.lastDisplayTimes?.unshift(Date.now()),this.lastDisplayTimes&&this.lastDisplayTimes.length>this.lookbackFreq&&(this.lastDisplayTimes=this.lastDisplayTimes.slice(0,this.lookbackFreq)),Te.set(cs,this.lastDisplayTimes)}async initStorageTimer(){this.config=self.EBATES.settings.get("increasedCBConfig"),this.lookback=this.config?.lookback??this.lookback,this.dailyFreq=this.config?.dailyFreq??this.dailyFreq,this.lookbackFreq=this.config?.lookbackFreq??this.lookbackFreq,this.lastDisplayTimes??=await Te.get(cs)??[];const e=Date.now()-this.lookback;this.lastDisplayTimes=this.lastDisplayTimes.filter((t=>t>e))}async isTimedOut(){if(await this.initStorageTimer(),!this.lastDisplayTimes||0===this.lastDisplayTimes.length)return!1;const e=Date.now(),t=e-Nt.DAY,n=e-this.lookback,i=this.lastDisplayTimes.filter((e=>e>t)).length,r=this.lastDisplayTimes.filter((e=>e>n)).length;return i>=this.dailyFreq||r>=this.lookbackFreq}async getIncreasedCBMerchant(){const e=this.config?.maxRecent??10,t=this.config?.maxFavorite??10,n=await EBATES.merchants.recent.getTopRateRecents(e,1,this.lookback),i=await EBATES.member.favoritesRates.fetchIncreasedCBFavorites(t);return this.compareStoreObjects(i?.[0],n?.[0])}compareStoreObjects(e,t){const n=e?.get("rate"),i=t?.get("rate");if(!(e&&t&&n&&i))return e||t;const r=this.config?.cashbackThreshold||1,s=n.amount||0,a=i.amount||0,o=s>=r,c=a>=r;if(o&&!c)return e;if(c&&!o)return t;if(!o&&!c)return null;const u={Percentage:3,Tiered:2,Fixed:1},l=u[n.display]||0,h=u[i.display]||0;return n.display!==i.display?l>h?e:t:s>a?e:t}};async function ls(){const e=await T.extension.getItem("blacklist");if(Array.isArray(e)){const t=await async function(e){if(!e.length)return;await self.EBATES.merchants.ready();const t=[];for(const n of e){const e=Le(n),i=EBATES.merchants.domains.where({topDomain:e}).map((e=>e.get("storeId")));t.push(...i)}return t}(e);self.EBATES.settings.userSettings.save({notificationExcludedStores:t}),T.extension.setItem("blacklist")}}const hs=ei.extend({key:"cart_notifications",defaults:{activation:!0,caa:!0,ccch:!0,ccps:!1,bonus:!0}}),ds=ei.extend({key:"settings",defaults:{abandonedProductsReminder:!0,increasedCBNotification:!0,postPurchaseMessage:!0,desktopNotifications:{cashBack:!0},ccHover:0,disabledTieredStores:[],notificationExcludedStores:[],rabExcludedStores:[],reportingEnabled:!0,postInstallPopup:!1,loggingDisabled:!1,boostSerpBannerLastVisit:0,progressiveEducation:{ReminderHover:!0,ConfirmHover:!0,UpToCB:!0,CouponMagic:!0,SERPinjections:!0,SERPinjectionsClickable:!0,PriceMagic:!0,PriceMagicButton:!0,PriceMagicSearch:!0,RAB:!0,RABinactive:!0,RABcoupons:!0,RafProductPagePopover:!0,BackgroundActivation:!0}},initialize(){this.once("sync",(()=>{ls()})),this.on({sync:function(){const e={...this.defaults.progressiveEducation,...this.get("progressiveEducation")};this.save({progressiveEducation:e}),this.has("installedTimestamp")||this.save({installedTimestamp:Date.now()})},"change:isDoNotShareActive":()=>{const e=D();T.extension.setItem("uiid",e),self.EBATES.segment.anonymousId=e},"change:logging change:isDoNotShareActive change:anonymousLogging":()=>this.toggleLogging()}),T.extension.attachEvent("getBrowserNotificationPermission",(({data:e})=>this.requestPermission(e))),T.extension.attachEvent("saveUserSettings",(({data:e})=>this.save(e))),T.extension.attachEvent("blacklist-update",(({data:e})=>this.blacklistUpdate(e))),ve.on("change:dataDogLogging",(()=>this.toggleLogging())),ve.on("change:segmentLogging",(()=>this.toggleLogging())),ve.on("change:fillr",(()=>this.toggleLogging())),T.extension.attachEvent("updateProgressiveEducation",(({data:e})=>this.updateProgressiveEducation(e)))},updateProgressiveEducation(e){e&&this.save({progressiveEducation:{...this.get("progressiveEducation"),...e}})},blacklistUpdate({storeId:e,exclude:t,property:n}){if(!e||"boolean"!=typeof t||void 0===n||!["notificationExcludedStores","rabExcludedStores"].includes(n))return;const i=this.get(n)??[],r=new Set(i);t?r.add(e):r.delete(e),this.save({[n]:Array.from(r)})},toggleLogging(){const e=self.EBATES.member.isExtensionDisabled(),t=self.EBATES.member.id?!0===self.EBATES.member.get("isDoNotShareActive"):this.get("isDoNotShareActive"),n=ve.variation("dataDogLogging",!0),i=ve.variation("segmentLogging",!0),r="opt_out"===this.get("logging")||"pending"===this.get("logging")||e,s="opt_out"===this.get("anonymousLogging")||"pending"===this.get("anonymousLogging")||e,a=r||t;self.EBATES.segment.loggingDisabled=a||!i,self.EBATES.holistic.loggingDisabled=a,this.set("loggingDisabled",a),we.disabled=!n||s||t},resetProgressiveEducation(){this.set("progressiveEducation",this.defaults.progressiveEducation)},async requestPermission(){EBATES.contentRunner.page?.injectContentScripts(),T.extension.fireEvent("permission-request-backdrop",{data:"show",tabId:T.browser.CURRENTTAB});try{const e=await s().permissions.request({permissions:["notifications"]});T.extension.fireEvent("permission-request-backdrop",{data:"hide"}),e?(this.save({notificationsEnabled:"granted"}),new Fr({type:"permission",title:"Desktop notifications are now on!",text:"We'll let you know whenever Cash Back is placed in your account.",url:Oe(Me.get("WEB_REWARDS")),cta:"See Cash Back Activity",desktop:!0,entity:"Opt-in"}).render()):this.save({notificationsSuspended:Date.now(),notificationsEnabled:"rejected"})}catch(e){}}}),fs=Xn.extend({url:()=>Me.get("SETTINGS_URL"),key:"config-settings",checkoutNotifications:new hs,priceMagic:new class{properties={affiliatizedLinks:[".popshops.com/","c.affil.walmart.com/"],thresholdAmount:5,excludedDomains:[],partnerDomains:[],exclusions:[],messages:[]};constructor(){T.extension.attachEvent("getSimilarMultipleProducts",(async({data:e})=>this.getSimilarMultipleProducts(e))),T.extension.attachEvent("getSimilarProducts",(({data:e})=>this.getSimilarProducts(e))),T.extension.attachEvent("saveVisitedProduct",(({data:e})=>this.saveVisitedProduct(e)))}async getSimilarMultipleProducts({products:e,canonical_url:t,domainName:n,storeName:i}){Xr=this.properties;const r=new Zr({canonical_url:t,domainName:n,storeName:i});try{const t=await r.fetchBulk(e);return{url:r.bulkUrl,products:t,requestId:r.requestId}}catch(e){const{response:t}=e;let n="",i=null;try{n=await t.text(),i=JSON.parse(n)}catch(e){}return{url:r.bulkUrl,...i?.apiHeader?{message:"Request failed",details:i.apiHeader.message}:{message:"API error",xhr:n}}}}async getSimilarProducts({query:e,canonical_url:t,domainName:n,isLuxury:i}){const r=e.storeName;Xr=this.properties,e.term&&!e.title&&(e.title=e.term,delete e.term);const s=new Zr({canonical_url:t,domainName:n,query:e,storeName:r,isLuxury:i});try{const e=await s.fetch();if(e)return{product:e,requestId:s.requestId}}catch{}return null}async saveVisitedProduct(e){if(ve.variation("pmSaveProducts",!1)){const t=await Te.get("visited-products")||[];this.cleanUpProducts(t);const n=e.product,i=t.findIndex((({product:e})=>n.sku&&e.sku?e.sku===n.sku:n.upc&&e.upc?e.upc===n.upc:e.title===n.title));i>-1&&t.splice(i,1),t.unshift(e),Te.set("visited-products",t.slice(0,1e3))}}set(e){Object.assign(this.properties,e)}get(e){return e?this.properties[e]:this.properties}toJSON(){return this.properties}cleanUpProducts(e){const t=Date.now()-7776e6;for(let n=e.length-1;n>=0;n--){e[n].ts<=t&&e.splice(n,1)}}},userSettings:new ds,similarStores:os,increasedCBNotification:us,reclaim:new class{constructor(e){this.extensionsList=[],this.handleEventMessage=e=>{const{level:t,data:n}=e.state?.value||{}},this.storage=new Sr,this.legacyExtensionsList=e?.legacyExtensionsList,br?.runtime.onMessage.addListener(this.addListeners.bind(this))}addListeners(e,t,n){switch(e.name){case Er:xr.log("SDK_EVENT_LOG",e),this.handleEventMessage(e);break;case"reclaimGetPluginState":{xr.log("GET_PLUGIN_STATE_MESSAGE_EVENT",e);const{key:t}=e.state||{};if(!t)return n(null),!0;this.storage.get(t).then((e=>{xr.log("Stored state for "+t,e),n(e)}));break}case"reclaimSavePluginState":{xr.log("SAVE_PLUGIN_STATE_MESSAGE_EVENT",e);const t=e.state?.key,i=e.state?.value;if(!t||!i)break;this.storage.get(t).then((e=>{const r={...e?.value,...i};this.storage?.set(t,r).then((()=>{xr.log(`Updated storage state for ${t}`,r),n(r)}))}));break}case"reclaimGetExtensionsList":xr.log("EXTENSIONS_LIST_MESSAGE_EVENT",e),this.legacyExtensionsList?(this.extensionsList=_r("function"==typeof this.legacyExtensionsList?this.legacyExtensionsList():this.legacyExtensionsList),n(this.extensionsList)):(xr.log("No legacy extensions list available, fetching from API."),async function(e="https://www.rakuten.com/toolbar/config/settings.json"){try{return(await(await fetch(e)).json()).installed_extensions}catch(e){return}}().then((e=>{this.extensionsList=_r(e||{}),n(this.extensionsList)})));break;case"reclaimCheckCookie":{xr.log("THIRD_PARTY_COOKIE_MESSAGE_EVENT",e);const{key:t,value:i}=e.state||{};if(!t||!i)break;br?.cookies.getAll({name:t,domain:i}).then((e=>{const t=!!e?.length;if(t){const t=e[0];br?.cookies.remove({name:t.name,url:`https://${t.domain}`,storeId:t.storeId}).then((e=>{xr.log("Cookie Removed",e)}))}n(t)}));break}}return!0}}({legacyExtensionsList:()=>{const e={};return self.EBATES.settings.installedExtensions.extensions.forEach((t=>{e[t.id]=t.url})),e}}),serp:[],iscb:[],UPDATE_INTERVAL:108e5,ERROR_UPDATE_INTERVAL:3e5,defaults:{activationInterval:1e4,serpEnabled:!0,competitorDomains:["shopathome.com","shopstyle.com","dealmoon.com","mrrebates.com","retailmenot.com","dealsplus.com","jet.com","capitaloneshopping.com","honey.io","joinhoney.com"],standDownDomains:[],standDown:[],contentBlackList:[],travelStores:[],interruptBlackList:[],sharedPages:[],groupon:{},deskNotificationReqFreq:2592e6,messageExpires:12096e5,reportingUpdateInterval:108e5,rewardsExpire:864e5,pendingDeletionTemplate:`<h2>Your Account Deletion is Pending</h2>\n\t\t<p>You requested an account deletion. You can check the status of your request by clicking below. You may also wish to remove Rakuten from your browser extensions.</p>\n\t\t<a href="#" data-href=${Oe(Me.get("SHELL_PAGE"))} class="btn">Check Deletion Status</a>`,confirmationTimeout:{default:5e3,background:7e3,deal:1e4,threshold:500},hotelsConfig:[{pattern:"https://www.google.com/travel/search",storeId:3930,radius:.5,queryText:{selector:".FNkAEc"},locationKeyword:{selector:".K4nuhf > .CFH2De:first-child"},checkIn:{selector:"div.GYgkab.YICvqf.M8oMHb:eq(0)",attribute:"data-value"},checkOut:{selector:"div.GYgkab.YICvqf.M8oMHb:eq(1)",attribute:"data-value"}},{pattern:"https://www.google.com/search?",storeId:3930,radius:.5,queryText:{selector:".ssJ7i"},locationKeyword:{selector:".lew4sc > .LrzXr"},checkIn:{selector:".LTL5qe.Il205e[data-chd]",attribute:"data-chd"},lengthOfStay:{selector:".LTL5qe.Il205e[data-los]",attribute:"data-los"}}]},parseResponse(e){if(!e)return;this.checkoutNotifications.set(e.checkoutNotifications),this.affiliates.suppresses.set(e.paidLinks),e.paidLinkPatterns&&this.affiliates.suppresses.add((0,P.map)(e.paidLinkPatterns,(e=>new RegExp(e))));const t=e.betterChoices||e.priceMagic;t&&this.priceMagic.set((0,P.omit)(t,"domains")),e.installed_extensions&&this.installedExtensions&&(this.installedExtensions.set(e.installed_extensions),this.installedExtensions.save()),this.serp=e.serp,this.standDown=e.standDown??[],this.iscb=e.iscb,this.domains=(0,P.map)(e.domains,(function(e){return e.track_events=!0,e})),e.promos&&!1===ve.variation("customPromos",!1)&&this.promos.set(this.promos.parse({promos:[...e.promos,...e.campaigns]})),this.set((0,P.omit)(e,"paidLinks","serp","standDown","domains","optout","promos","campaigns","betterChoices","priceMagic","checkoutNotifications","installed_extensions"))},parse(e){this.parseResponse(e),this.trigger("sync-data",e),EBATES.merchants.syncSettingsDomains()},initialize(...e){return this.promos=new qr,this.affiliates=new ns,this.interstitialConfig=new ss,this.coupons=rs,this.featureFlags=ve,ve.on("change:customPromos",(e=>e&&this.promos.fetch())),T.browser.isChrome&&(this.installedExtensions=new es),T.extension.attachEvent("settings",(({data:e},t)=>{e&&(this.userSettings.save(e),T.extension.fireEvent("updateSettings",{tabId:T.browser.ALLTABS,data:e})),EBATES.merchants.ready().then((()=>{t(this.toJSON())}))})),Xn.prototype.initialize.apply(this,e)},load(){return Promise.all([this.featureFlags.sync(),this.promos.fetch(),this.userSettings.fetch()]).catch((e=>{}))},toJSON(...e){const t=this.userSettings.toJSON();return ve.variation("progressiveEducation",!0)||(t.progressiveEducation={}),(0,P.extend)(t,ei.prototype.toJSON.apply(this,e),{checkoutNotifications:this.checkoutNotifications.toJSON(),serp:this.serp,priceMagic:this.priceMagic.toJSON(),promos:this.promos.toJSON(),user_id:self.EBATES.member.id,ebToken:self.EBATES.ebToken,iscb:this.iscb,extensionDisabled:self.EBATES.member.isExtensionDisabled(),standDown:this.standDown,tcpp:self.EBATES.member.getTcpp(),featureFlags:ve.toJSON(),isOffline:0===self.EBATES.merchants.length,toolbarId:self.EBATES.toolbarId,isFeedPreviewMode:!!self.EBATES.feed.previewToken,region:Me.region,config:Me.getAll(),visitId:self.EBATES.holistic.visit_id})}}),ps={get neutral(){return De.get("buttonTitles.neutral")},get activated(){return De.get("buttonTitles.activated")},get available(){return De.get("buttonTitles.available")}};let gs=null;const ms=32,vs=32,ys=3.3,bs=5,ws=11,Es=8.75;class As{cacheImagesloading=!1;cachedAnimation=new Map;Images=new Map;animationIndex=bs;loopIndex=0;constructor(){this.context=this.getContext(),this.load(),self.setInterval((()=>this.load()),108e5),T.browser.attachEvent(T.browser.DOCUMENTCOMPLETE,this.handlePage.bind(this)),T.browser.attachEvent(T.browser.TABCHANGED,this.handlePage.bind(this)),T.extension.attachEvent("merchant.state:change",this.handlePage.bind(this))}getContext(){return"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(ms,vs).getContext("2d"):function(e,t){const n=document.createElement("canvas");return n.setAttribute("width",`${e}`),n.setAttribute("height",`${t}`),document.body.appendChild(n),n}(ms,vs).getContext("2d")}async cachePromoImage(e){if(self.EBATES){const t=self.EBATES.settings.promos.get("icons");if(t&&t.get("active")&&t.get(e))return this.fetchImage(t.get(e))}return Promise.reject()}async fetchImage(e){const t=await fetch(e);if(!t.ok)throw new Error(t.statusText);const n=await t.blob();return createImageBitmap(n)}async cacheImage(e){try{return await this.cachePromoImage(e)}catch{return this.fetchImage(e)}}reloadCachedImages(){return this.cacheImagesloading?new Promise((e=>{self.setTimeout((()=>this.reloadCachedImages().then(e)),100)})):(this.cacheImagesloading=!0,Promise.all([this.cacheImage("/img/rakuten/icon-32.png"),this.cacheImage("/img/rakuten/icon-32-activated.png"),this.cacheImage("/img/rakuten/icon-32-notactivated.png")]).then((([e,t,n])=>{this.cachedAnimation=new Map,this.Images.set("neutral",e),this.Images.set("activated",t),this.Images.set("available",n)})).catch((()=>{self.setTimeout((()=>{this.reloadCachedImages()}),6e4)})).then((()=>{this.cacheImagesloading=!1})))}animate(e,t){if(!this.context)return;let n=this.cachedAnimation.get(e);if(n||(n=new Map,this.cachedAnimation.set(e,n)),!n.get(t)){this.context.clearRect(0,0,ms,vs),"neutral"!==e&&(this.context.setLineDash([0]),"activated"===e?(this.context.lineWidth=2,this.context.strokeStyle="#4990e2",this.context.fillStyle="#FFF"):"available"===e&&(this.context.lineWidth=2,this.context.fillStyle="#ee5051",this.context.strokeStyle="#ee5051"),this.context.roundRect(16-t*ys/2,16-t*ys/2,t*ys,t*ys,{upperLeft:4,upperRight:4,lowerLeft:4,lowerRight:4},!0));try{this.context.drawImage(this.Images.get(e),0,0,ms,vs),n.set(t,this.context.getImageData(0,0,ms,vs))}catch{}}return{imageData:{32:n.get(t)}}}next({type:e,count:t}){if(++this.animationIndex>=ws&&(this.animationIndex=bs,this.loopIndex++),t&&this.loopIndex>t&&this.animationIndex>=Es)return this.loopIndex=0,this.stop(e);xs(this.animate(e,this.animationIndex)),Ts(ps[e])}play({type:e,count:t=0}){this.stop(),Ts(ps[e]),gs=self.setInterval((()=>this.next({type:e,count:t})),100)}stop(e){gs&&(self.clearInterval(gs),gs=null),this.animationIndex=bs,this.loopIndex=0,e&&(xs(this.animate(e,Es)),Ts(ps[e]))}async load(){return await this.reloadCachedImages(),this.stop("neutral")}async handlePage(e){if(!self.EBATES||self.EBATES.member.isExtensionDisabled())return void this.stop("neutral");if(e.name===T.browser.DOCUMENTCOMPLETE&&!e.active)return;const t=await Wt.getActive(),n=e.url||t.url,i=e.tabId||t.tabId;if(n?.startsWith("http")&&!Gn(n)){const e=self.EBATES.merchants.match(n,i);if(await(e?.isEligibleForIconAnimation())){const t=e.session;if(t.get("activated"))return void(t.get("notificationHover")?this.play({type:"activated",count:2}):this.stop("activated"));if(!self.EBATES.settings.affiliates.state(i).suppress)return this.play({type:"available",count:4})}}this.stop("neutral")}}async function xs(e){if(e)try{const t=s().action?s().action:s().browserAction;await t.setIcon(e)}catch{}}function Ts(e){return T.ui.button.setTitle(e)}async function Ss(e){try{const{data:t}=await he(Oe(B.URL_SHORTENER),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Client-Agent":"button"},body:JSON.stringify({url:e})});return t?.data?.url_path??null}catch{return null}}OffscreenCanvasRenderingContext2D.prototype.roundRect=function(e,t,n,i,r,s,a){const o={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};void 0===a&&(a=!0),"object"==typeof r&&Object.keys(r).forEach((e=>{Object.prototype.hasOwnProperty.call(o,e)&&(o[e]=r[e])})),this.beginPath(),this.moveTo(e+o.upperLeft,t),this.lineTo(e+n-o.upperRight,t),this.quadraticCurveTo(e+n,t,e+n,t+o.upperRight),this.lineTo(e+n,t+i-o.lowerRight),this.quadraticCurveTo(e+n,t+i,e+n-o.lowerRight,t+i),this.lineTo(e+o.lowerLeft,t+i),this.quadraticCurveTo(e,t+i,e,t+i-o.lowerLeft),this.lineTo(e,t+o.upperLeft),this.quadraticCurveTo(e,t,e+o.upperLeft,t),this.closePath(),a&&this.stroke(),s&&this.fill()};const _s=qn.Model.extend({defaults:{badgeColor:"#EF5A4E",shown:!1}}),ks=Qn.extend({key:"overlays",model:_s,initialize(){this.fetch().then((()=>{const e=this.get("smart-cards");e&&e.set({shown:!0})})),this.on("add remove change:shown",(()=>{const e=this.where({shown:!1}).length;EBATES.badge.update("overlay",e)}))}}),Is=qn.Collection.extend({}),Cs=qn.Model.extend({idAttribute:"offerId",activate(e){return new Promise(((t,n)=>{he(ae(Oe(B.MEMBER_ISCB_LINKED),{offerId:this.id,cardId:e,store_id:this.get("store")?this.get("store").id:null}),{method:"POST"}).then((()=>{this.set({linkedCardIds:(0,P.union)(this.get("linkedCardIds"),[e]),cardIds:(0,P.without)(this.get("cardIds"),e)}),t(void 0)}),(()=>{n()}))}))},toJSON(e){const t=e=>this.collection.cardDictionary.get(e)?.toJSON();return(0,P.extend)(qn.Model.prototype.toJSON.apply(this,[e]),{cards:(0,P.map)(this.get("cardIds"),t),linkedCards:(0,P.map)(this.get("linkedCardIds"),t),description:this.get("description")?this.get("description").replace(/^Earn Cash Back/,""):""})},async serializeWithMerchant(e){const t=this.get("store")?this.get("store").id:null,n=t?await EBATES.merchants.getStore({storeId:t}):null;return(0,P.extend)(this.toJSON.apply(this,[e]),{merchant:n})}}),Ds=Yn.extend({key:"stores/isc",dynamic:!1,model:Cs,cardDictionary:new Is,url:()=>Oe(B.MEMBER_ISCB),UPDATE_INTERVAL:108e5,initialize(){return T.extension.attachEvent("ISC-activate",(async(e,t)=>{t(await this.activateOffer(e.data))})),Yn.prototype.initialize.apply(this)},async getOffers({name:e}){if(!EBATES.loggedIn||!EBATES.member.has("accessLevel"))return null;await this.fetch();const t=this.find((t=>zn(t.get("store"),e)));if(!t)return null;return await t.serializeWithMerchant()},async activateOffer({offerId:e,cardId:t}){const n=this.get(e);if(n)try{await n.activate(t);return{offer:await n.serializeWithMerchant(),cardId:t}}catch{return{error:"Oops. We weren't able to enable this card for In-Store Cash Back. Please try again later",cardId:t}}},parse(e){return this.cardDictionary.reset(e.cardDictionary),(0,P.filter)(e.offers,(e=>!e.dateLinked))}});function Ps(e){return Number.isFinite(e)?Math.round(100*e)/100:0}function Bs(e){try{return new URL(e).hostname.replace(/^www\d?\./,"")}catch{return null}}const Ms=new class extends me{_id="notification-domains";UPDATE_INTERVAL=216e5;get url(){return Oe(B.SETTINGS_NOTIFICATION_DOMAINS)}async isEligibleDomain(e){const t=Bs(e);if(!t)return!1;return(await is(this.load(),[])).some((e=>t.includes(e)))}};class Rs extends me{_id="abandoned-products";UPDATE_INTERVAL=18e5;latestApiCall="";products={filtered:[],suppressed:[]};missingProducts=[];reminder=new Ls;get url(){const e=24*ve.variation("cartAbandonmentInterval",14)*60*60*1e3,t=new Date(Date.now()-e).toISOString(),n=ae(Oe(B.ABANDONED_PRODUCTS),{from_timestamp:t,get_full_product:!0,remove_qualifications:!0});return this.latestApiCall=n,n}constructor(){super(),this.on("sync",(()=>{ve.variation("myCartTab")&&!self.EBATES.settings.userSettings.get("myCartTab")&&this.getData()?.length&&self.EBATES.settings.userSettings.save({myCartTab:!0})})),T.extension.attachEvent("hasAbandonedProducts",(async()=>{try{const e=await this.load();return e?.length>0}catch{return!1}})),T.extension.attachEvent("getAllAbandonedProducts",(async()=>{try{const e=await this.load();return await Os(e),Ns(e)}catch{return[]}}))}async getCache(){return await this.readCache(),this.getData()??[]}parse(e){const t=[],n=e.data.map((e=>{const n=e.product_data_at_abandonment.fillr_product_data,i=e.product_data;if(!i)return t.push(n),null;const r=e.product_data_at_abandonment.rakuten_product_data,s=Number(e.store_id),a=self.EBATES.merchants.get(s);if(!a||!a.isButtonMerchant())return null;const o=r?.cash_back_rate_during_abandonment?r?.cash_back_rate_during_abandonment[0]?.reward:null,c=parseFloat(i.list_price),u=parseFloat(i.sale_price);return{id:e.product_id,title:i.title,brandName:i.brand_name,listPrice:c,salePrice:u,discount:Ps(c-u),category_ids:r.category_ids,category_id:r.category_id,imageUrl:(h=i.image_url,oe(h,{_ex:"152x152"})||(l=r.image_url,0===l?.search(/^https:\/\//)?l:"")),productUrl:n.product_url,abandonedTimestamp:new Date(e.assumed_abandoned_timestamp).getTime(),eligibleForCashBack:i.eligible_for_cash_back,previous_ca_tracking_ticket:e.shopping_trip_id,merchant:{storeId:s},isSuppressed:!1,...o&&{previousReward:{amount:o.display_amount,display:o.display_type}},priceSavings:0,savingsAmount:0};var l,h})).filter(Boolean);return this.missingProducts=t,n}}function Ns(e=[]){return e.sort(((e,t)=>t.abandonedTimestamp-e.abandonedTimestamp))}async function Os(e,t){if(!Array.isArray(e)||!e.length)return;const n=e.map((e=>e.merchant.storeId)).concat(t?.map((e=>e.merchant.storeId))),i=[...new Set(n)],r=await self.EBATES.merchants.getStores(i);function s(e){e?.forEach((e=>{const t=r.find((({storeId:t})=>t===e.merchant.storeId));e.merchant=(0,P.pick)(t,"storeId","storeName","reward","affiliatizerEnabled","offers_cb","images"),e.merchant.reward.current="",e.merchant.reward.currentText=""}))}s(e),s(t)}class Ls{_id="abandoned-products-reminder";domains=[];eligibleDomains=[];cache={};maxDailyShowingCount=5;timeoutAfterDisplay=1800;periodAfterAbandonment=3600;ignoreSavings=!1;constructor(){Te.get(this._id).then((e=>{e&&(this.cache=e),this.cleanUpDiscardedProducts()})),T.extension.attachEvent("getReminderProduct",(async()=>{if(!ve.variation("cartAbandonment")||!self.EBATES.member.id)return{};if(this.maxDailyShowingCount=ve.variation("cartAbandonmentToastMaxDailyShowingCount",this.maxDailyShowingCount),this.timeoutAfterDisplay=ve.variation("cartAbandonmentToastTimeoutAfterDisplay",this.timeoutAfterDisplay),this.periodAfterAbandonment=ve.variation("cartAbandonmentToastPeriodAfterAbandonment",this.periodAfterAbandonment),await this.isEligibleForShow()){const e=await this.getProducts(),{showingCounters:t}=this.cache||await Te.get(this._id)||{};return{product:e[0],showingCounters:t}}return{}})),T.extension.attachEvent("getProductsPostPurchase",(async()=>{if(!ve.variation("cartAbandonment")||!self.EBATES.member.id)return[];try{let e=await self.EBATES.member.abandonedProducts.load();return await Os(e),Ns(e),await this.cleanUpDiscardedProducts(),e=await this.filterDiscardedProducts(e),e}catch{return[]}})),T.extension.attachEvent("discardProduct",(async({data:e})=>{let{discardedProducts:t}=this.cache||await Te.get(this._id)||{};t=t||{},t[e.productId]||(t[e.productId]={timestamp:Date.now()}),this.saveCache({discardedProducts:t})})),T.extension.attachEvent("updateShowingInfo",(async({data:e})=>{let{showingCount:t,lastShowingTimestamp:n,showingCounters:i}=this.cache||await Te.get(this._id)||{};t=Wn()().format("DD/MM/YYYY")!==Wn()(n).format("DD/MM/YYYY")?1:(t||0)+1,i=i||{};const r=i[e.type]||0;i[e.type]=(r+1)%3,this.saveCache({showingCount:t,showingCounters:i,lastShowingTimestamp:Date.now()})}))}saveCache(e){this.cache={...this.cache,...e},Te.set(this._id,this.cache)}clearCache(){this.cache={},Te.set(this._id,this.cache)}async cleanUpDiscardedProducts(){const e=24*ve.variation("cartAbandonmentInterval",14)*60*60*1e3;let{discardedProducts:t}=this.cache||await Te.get(this._id)||{};t=t||{};let n=!1;for(const i in t)t[i].timestamp<Date.now()-e&&(delete t[i],n=!0);n&&this.saveCache({discardedProducts:t})}async getProducts(){const e=self.EBATES.member.abandonedProducts,t=await e.getCache().catch((()=>{}))||[],n=await e.load().catch((()=>{}))||[];if(await Os(n,t),Array.isArray(t)&&Array.isArray(n)){this.ignoreSavings=await ni.get(Mt);const i=this.getProductsWithSavings(t,n);await this.cleanUpDiscardedProducts();const r=i.filter((({merchant:e,eligibleForCashBack:t})=>e.offers_cb&&t)),s=await this.filterDiscardedProducts(r),a=this.filterByPeriod(s,1e3*this.periodAfterAbandonment);return a.sort(((e,t)=>e.savingsAmount>t.savingsAmount?-1:1)),e.missingProducts&&this.trackRequest({productsWithSavings:i?.length,productsWithEligibleCb:r?.length,afterDiscard:s?.length,filteredByPeriod:a?.length,oldProducts:t?.length,newProducts:n?.length,missingProducts:e.missingProducts}),a}return[]}calcSavingsAmount(e){const t=e.merchant.reward,n=!t||t.range&&t.amount?0:zr(t,e.salePrice);e.cashBackAmount=Ps(n);const i=t?zr(t,e.salePrice):0;e.cashBackAmountTiered=Ps(i);let r=0;return e.oldPrice&&(r=parseFloat(e.oldPrice)-parseFloat(e.salePrice)||0),e.priceSavings=Ps(r),e.savingsAmount=Ps(e.cashBackAmount+e.priceSavings),e}async filterDiscardedProducts(e){const{discardedProducts:t}=this.cache||await Te.get(this._id)||{};return e.filter((({id:e})=>!t?.[e]))}filterByPeriod(e,t){const n=Date.now()-t;return e.filter((({abandonedTimestamp:e})=>e<n))}getProductsWithSavings(e,t){return t.map((t=>{const n={...t};n.isSavingsExists=!1,n.isCashbackIncrease=!1,t.salePrice<t.listPrice&&(n.oldPrice=t.listPrice,n.isSavingsExists=!0);const i=e.find((({id:e})=>e===t.id));if(i){const e=t.merchant.reward;if(e&&n.previousReward&&ci(e,n.previousReward)>0&&(n.isCashbackIncrease=!0),t.merchant.reward=e,t.salePrice<i.salePrice){i.salePrice-t.salePrice>t.listPrice-t.salePrice&&(n.oldPrice=i.salePrice,n.isSavingsExists=!0)}}return this.ignoreSavings||n.isSavingsExists||n.isCashbackIncrease?this.calcSavingsAmount(n):null})).filter(Boolean)}async isEligibleForShow(){const{showingCount:e=0,lastShowingTimestamp:t=0}=this.cache||await Te.get(this._id)||{};if(Date.now()-t<1e3*this.timeoutAfterDisplay)return!1;const n=Wn()().format("DD/MM/YYYY");return!(Wn()(t).format("DD/MM/YYYY")===n&&e>=this.maxDailyShowingCount)}async isEligibleDomain(e){const t=Le(e);if(!t)return!1;let n=[];try{n=await Ms.load()}catch{}if(n.some((e=>Le(e)===t))){return!(await Qr.load()).find((({domainName:e})=>e===t))}return!1}trackRequest(e){const t={module_type:"Abandoned Products",entity_name:"Abandoned Products",domains:this.domains,...e};self.EBATES.segment.track("Request API",t)}}function js(e,t){return e.indexOf("[link]")>=0?e.replace("[link]",t):`${e} ${t}`}const Us=De.get("taf.defaultMessage"),Fs=Zn.extend({timeout:108e5,defaults:{referBonusAmount:Me.get("DEFAULT_REFER_BONUS_AMOUNT"),referImageToolbar:"/toolbar/images/taf_toolbar@2x.png",referSocialMessage:"",redeemThresholdAmount:Me.get("DEFAULT_REDEEM_THRESHOLD_AMOUNT")},url:()=>Oe(B.MEMBER_TAF),initialize(...e){return T.extension.attachEvent("getTafSettings",(async({data:e={}},t)=>{const{force:n=!1}=e;EbatesPromise.then((async()=>{try{await this.fetch({force:n})}finally{t(this.toJSON())}}))})),Zn.prototype.initialize.apply(this,e)},toJSON(...e){const t=Zn.prototype.toJSON.apply(this,e);return t.referPageHeader=`Get ${t.referBonusAmount}`,t.referImageToolbar=t.referImageToolbar2x,t},async getTwitterMessage(e,t,n){if(n){const{reward:i,storeName:r}=n;if(t===ft&&ve.variation("rafStoreShare",!0)&&!i.rakplusTargeted){const t=oi({...i,range:!0}).toLowerCase();return De.get("taf.twitter.postPurchase",{cashBack:t,storeName:r,link:e})}}await this.fetch();let i=Us;const r=this.get("referSocialMessage");return r&&r.indexOf("|")>=0?i=r.split("|")[1]:r&&(i=r),js(i,e)},async getEmailMessage(e,t,n){if(n){const{reward:i,storeName:r}=n;if(t===ft&&ve.variation("rafStoreShare",!0)&&!i.rakplusTargeted){const t={...i,range:!0},n=De.get("taf.email.postPurchase.subject",{storeName:r}),s=oi(t).toLowerCase();return{subject:n,message:De.get("taf.email.postPurchase.message",{cashBack:s,storeName:r,link:e})}}}await this.fetch();let i=De.get("taf.defaultSubject"),r=Us;const s=this.get("referEmailMessage");if(s?.indexOf("|")>=0){const e=s.split("|");i=e.shift(),r=e.join("\n")}return r=js(r,e),{subject:i,message:r}}}),$s="BLOCKED",qs=Xn.extend({key:"geogating",dynamic:!1,UPDATE_INTERVAL:108e5,defaults:{gatingStatus:"UNRESTRICTED"},url:()=>Oe(B.MEMBER_GEOGATING),async initialize(...e){return await this.readCache({silent:!0,cache:!0}),this.isBlocked()&&this.switchToBlockedState(),this.on({"change:gatingStatus":async e=>{const t=e.get("gatingStatus");e.previous("gatingStatus")===$s&&t!==$s?(EBATES.settings.userSettings.toggleLogging(),EBATES.segment.track("Change Gating Status",{country_code:e.get("countryCode"),gating_status:e.get("gatingStatus")}),EBATES.settings.userSettings.save({gatingStatusBadge:!0}),await this.switchToNormalState()):e.previous("gatingStatus")!==$s&&t===$s&&(EBATES.segment.track("Change Gating Status",{country_code:e.get("countryCode"),gating_status:e.get("gatingStatus")}),EBATES.settings.userSettings.save({gatingStatusBadge:!0})),t===$s&&this.switchToBlockedState(),EBATES.badge.update()}}),Xn.prototype.initialize.apply(this,e)},switchToBlockedState(){T.ui.button.setPopup(),T.ui.button.attachEvent(T.ui.button.CLICK,this.openGatingWebpageUrl),EBATES.settings.userSettings.toggleLogging()},async switchToNormalState(){T.ui.button.detachEvent(T.ui.button.CLICK,this.openGatingWebpageUrl),await EBATES.validateUserToken()&&T.ui.button.setPopup({url:"./popup.html"})},isBlocked(){return this.get("gatingStatus")===$s},isEnabled:()=>ve.variation("geogating",!1),parse:e=>e.data,openGatingWebpageUrl(){const e=ae(EBATES.member.geogating.get("gatingWebpageUrl")||Oe(B.BASE),{visit_id:EBATES.holistic.visit_id});EBATES.settings.userSettings.get("gatingStatusBadge")&&(EBATES.settings.userSettings.save({gatingStatusBadge:!1}),EBATES.badge.update()),EBATES.segment.track("Visit Page",{preceding_screen_name:"Icon",url:e},void 0,{force:!0}),T.browser.navigate(e)}});class Hs extends me{_id="earnings-history";UPDATE_INTERVAL=108e5;prevOrderId=null;constructor(e){super(),this.balance=e,this.readCache(),this.on("beforeRequest",(()=>{const e=this.getData(),t=e?.length?e[0]:null;this.prevOrderId=t?.id??null})),self.EbatesPromise.then((e=>{e.on("SyncTick",(()=>this.load()))})),this.on("sync",(()=>this.checkNewOrder()))}get headers(){return{accept:"application/json","Client-Agent":"button"}}get url(){return Oe(ae(Me.get("MEMBER_EARNINGS_HISTORY"),{status:"all",size:1,sort:"-timestamp",category:"Purchase"}),{journal_id:this.journalId})}isActive(){return ve.get("memberEarningsHistory",!0)}parse(e){return(e?.data?.entries||[]).map((e=>({...e,amount:e.amount?(e.amount/Math.pow(10,e.precision)).toFixed(2):null})))}async load(e={}){if(await this.ifUpdateRequired(e)&&self.EBATES.member.get("accessLevel")&&this.isActive()&&(this.journalId=await this.getJournalId(),this.journalId))return super.load(e)}async getJournalId(){let e=this.balance.getData()?.journal_id;return e||(await this.balance.load(),e=this.balance.getData()?.journal_id),e}checkNewOrder(){if(null===this.prevOrderId)return;const e=this.getData(),t=e?.length?e[0]:null;if(this.prevOrderId===t?.id)return;const n=EBATES.member.messages;e?.forEach((e=>{!e.amount||"Confirmed"!==e.status&&"Pending"!==e.status||"ORDER"!==e.description||n.find((t=>t.get("id")&&t.get("id")===e.id||!t.get("id")&&t.get("memberReward")===e.amount))||this.addMessage({id:e.id,storeId:e.data.store_id?parseInt(e.data.store_id,10):null,amount:e.amount})}))}async addMessage({id:e,storeId:t,amount:n}){const i=await self.EbatesPromise;await i.merchants.ready();const r=EBATES.merchants.get(t),s=r?.get("storeName");if(s){const i=function(e,t,n){return si().formatMoney(e,t,n).replace(/\.0+$/,"")}(n,Me.get("currency"));EBATES.member.messages.add({amount:n,storeId:t,desktop:!!EBATES.settings.userSettings.get("desktopNotifications").cashBack,popup:!0,title:De.get("messages.title",{rewardAmount:i}),text:De.get("messages.text",{rewardAmount:i,storeName:s}),type:"cashback",url:Oe(Me.get("WEB_REWARDS")),cta:De.get("messages.cta"),entity:"Cash Back Added",orderId:e})}}}const Ws={USA:"USD",GBR:"GBP"},Vs={precision:2,currency:"USD",pending:0,total_amount:null,display_values:{pending:0,confirmed:0,total_amount:0},isAmexUser:!1,isBiltUser:!1};class Gs extends Pi{attributes={...Vs};constructor(){super("member-balance-account-summary"),this.readCache()}getData(){return this.attributes}parse(e){const{pendingAmount:t,paidAmount:n}=e,i=Ut(t)&&Ut(n)?t+n:null;return{precision:2,currency:e.payableAmountCurrencyCode,pending:e.pendingAmount,total_amount:i,display_values:{pending:e.pendingAmount,confirmed:e.payableNowAmount,total_amount:i},isAmexUser:!1,isBiltUser:!1}}set(e){const t=this.parse(e);return this.attributes={...t},this.save(this.attributes)}async readCache(){const e=await this.load();e&&0!==Object.keys(e).length&&Object.assign(this.attributes,e)}clear(){return this.attributes={...Vs},this.clearCache()}}class zs extends me{_id="member-balance";prevTotalAmount=null;UPDATE_INTERVAL=9e5;MAX_ERROR_ATTEMPT=6;isBookkeeperAPIEnabled=!1;balanceAccountSummary=new Gs;earningsHistory=new Hs(this);constructor(){super(),this.on("beforeRequest",(()=>{this.prevTotalAmount=this.getData()?.total_amount??null})),this.on("sync",(()=>{this.updateMessages()})),this.readCache(),this.checkBookkeeperAPIEnabled()}get url(){return Oe(Me.get("MEMBER_BALANCE"))}get headers(){return{accept:"application/json","Client-Agent":"button"}}async checkBookkeeperAPIEnabled(){const e=await ni.get(kt);!this.isBookkeeperAPIEnabled&&e&&this.balanceAccountSummary.clear(),this.isBookkeeperAPIEnabled=!!e}async load(e={}){if(await this.checkBookkeeperAPIEnabled(),this.isBookkeeperAPIEnabled){const t=this.getData();return t&&!t.journal_id&&await this.clearCache(),super.load(e)}return await this.balanceAccountSummary.readCache(),this.balanceAccountSummary.getData()}async set(e){await this.checkBookkeeperAPIEnabled(),this.isBookkeeperAPIEnabled||(this.prevTotalAmount=this.balanceAccountSummary.getData().total_amount,await this.balanceAccountSummary.set(e),this.updateMessages())}getData(){return this.isBookkeeperAPIEnabled?super.getData():this.balanceAccountSummary.getData()}async updateMessages(){if(!("USA"===Me.region?ve.get("pendingAmount",!0):this.isBookkeeperAPIEnabled)||null===this.prevTotalAmount)return;const{total_amount:e,journal_id:t}=this.getData()??{};Ut(e)&&e>this.prevTotalAmount&&t&&await this.earningsHistory.load({force:!0})}async clear(){await this.clearCache(),await this.balanceAccountSummary.clear(),await this.earningsHistory.clearCache()}parse(e){const t=Me.region,n=e.data,i=n?.journals?.find((e=>e?.currency===Ws[t??"USA"]));if(Vs.isAmexUser="AMEX"===n?.next_payment.method,Vs.isBiltUser="BILT"===n?.next_payment.method,!i)return{...Vs};const{precision:r=2,currency:s,pending:a,total_amount:o,display_values:c,journal_id:u}=i;return{precision:r,currency:s,pending:a/Math.pow(10,r),total_amount:o/Math.pow(10,r),journal_id:u,display_values:c?{pending:parseFloat(c.pending),confirmed:parseFloat(c.confirmed),total_amount:parseFloat(c.total_amount)}:Vs.display_values,isAmexUser:Vs.isAmexUser,isBiltUser:Vs.isBiltUser}}}const Ks=new class extends me{_id="milestones";UPDATE_INTERVAL=864e5;constructor(){super(),T.extension.attachEvent("getActiveBoost",(async({data:e})=>{if(!self.EBATES.member.id)return;const{storeId:t}=e;return await this.getActiveMilestone(t)})),this.readCache()}get url(){return Oe(B.MILESTONES_URL)}get headers(){return{"Client-Agent":"button"}}parse({data:e}){return e.milestones.map((e=>{const t=e.reward_details?.qualification_rules,n=t?.reduce(((e,t)=>{const n=t.milestone_pr_terms_rules?.find((({rule:e})=>e.startsWith("Good until ")));return n&&(e=n.rule.split("Good until ").pop()),e}),null);let i=null;if(n){const e=Wn()(n.replace("at ","").replace(/([AP]M)/," $1").replace("PT.","-0700"),"MM/DD/YYYY __ HH:mm A ZZ");e.isValid()&&(i=e.valueOf())}return{...e,termsLink:t?.find((e=>e?.milestone_pr_terms_button_cta))?.milestone_pr_terms_button_cta,termsText:t?.find((e=>e?.milestone_pr_terms_button_text))?.milestone_pr_terms_button_text,reward:parseFloat(e.reward_details?.milestone_pr_value?.match(/(?:\+)(\d+(?:\.\d+)?)(?:%)/g)?.[0]??"0"),expires:i}}))}fetchDataOnSignIn(){if(self.EBATES.member.id)return new Promise((e=>{setTimeout((async()=>{const t=ve.variation("signupButtonMilestones",{ids:[]}).ids??[],n=ve.variation("activeButtonMilestones",{ids:[]}).ids??[];t.some((e=>n?.includes(e)))&&await this.load(),e()}),3500)}))}async findAsync(e,t){const n=e.map(t);return e[(await Promise.all(n)).findIndex((e=>e))]}async getActiveMilestone(e=null){const t=ve.variation("activeButtonMilestones",{ids:[]}).ids??[],n=ve.variation("signupButtonMilestones",{ids:[]}).ids??[];if(await this.findAsync(t,(async e=>"A"===await ni.variation(`button-milestone-${e}`,"A"))))try{await this.load()}catch{}const i=this.getData()??[];return await this.findAsync(i,(async i=>{if(!i.incentive_id||!i.expires||i.expires<Date.now()||"PENDING"!==i.milestone_status)return;if(!t.includes(i.incentive_id))return;const r=await ni.variation(`button-milestone-${i.incentive_id}`);if(!n.includes(i.incentive_id)&&"A"!==r)return;const s=EBATES.settings.promos.get("milestones-excluded-stores")?.campaigns?.find((e=>e.get("milestones").includes(i.incentive_id)))?.stores?.map("storeId")??[];if(!e||!s.includes(e)){if(e){const t=await(self.EBATES.merchants.get({storeId:e})?.getReward());if(!t||"Fixed"===t.display)return;const n=function(e=""){const t=/(\b\d{1,2}(?:\.\d{1,2})?\b)%/.exec(e);return t?parseFloat(t[1]):1}(t.previous);if(t.amount<n+i.reward)return}return i}}))}},Js=qn.Model.extend({idAttribute:"storeId",defaults:{previousRate:null,rate:null}}),Ys=_i.extend({key:"stores/favorites",model:Js,url:()=>Oe(B.MEMBER_FAVORITES),parse:e=>(0,P.chain)(e.favorites).map((e=>(e.id&&!e.storeId&&(e.storeId=e.id),delete e.id,e))).flatten().value()}),Xs=Kn.extend({idAttribute:"storeId",defaults:{rate:null,previousRate:null}}),Zs=Qn.extend({model:Xs,key:"favorites-rates",initialize(){},async fetchIncreasedCBFavorites(e=10){return await this.fetchDailyFavorites(),await this.fetchRatesOnInterval(),this.getStoresWithCBIncrease(e)},async fetchDailyFavorites(){const e=Date.now(),t=self.EBATES.settings.get("increasedCBConfig"),n=t?.favoritesFetchInterval??Nt.DAY,i=await this.getItem("nextFavoritesUpdateTime");if(!i||e>=i){await EBATES.member.favorites.fetch();const t=e+n;this.setItem("nextFavoritesUpdateTime",t)}return this},async setRates(){const e=EBATES.member.favorites.pluck("storeId"),t=await mi.default.fetch(e),n=e.map(((e,n)=>({storeId:e,rate:t?.[n]}))),i=e.map((e=>{const t=n.find((t=>t.storeId===e));if(t?.rate){const n=this.get(e)?.get("rate");return n?{storeId:e,previousRate:n}:{storeId:e,rate:t.rate}}})).filter(Boolean);this.set(i),this.save()},async fetchRatesOnInterval(){const e=Date.now(),t=self.EBATES.settings.get("increasedCBConfig"),n=t?.ratesFetchInterval??Nt.DAY,i=await this.getItem("nextFavoritesRatesUpdateTime");if(!i||e>=i){await this.setRates();const t=e+n;this.setItem("nextFavoritesRatesUpdateTime",t)}},getStoresWithCBIncrease(e=10){const t=this.filter((e=>{const t=e.get("rate"),n=e.get("previousRate");return!(!t?.amount||!n?.amount)&&t.amount>n.amount}));return t.sort(((e,t)=>{const n=e.get("rate"),i=e.get("previousRate"),r=t.get("rate"),s=t.get("previousRate"),a=n.amount-i.amount;return r.amount-s.amount-a})),t?t.slice(0,e):[]},formatStores:e=>e?.map((e=>({storeId:e.get("storeId"),rate:e.get("rate")}))),setItem(e,t){T.extension.setItem(e,t)},getItem:async e=>await T.extension.getItem(e),save(){T.extension.setItem(this.key,this.map((e=>e.attributes)))}});const Qs=new class{get url(){const e=Me.region||"USA";return ae(Oe(B.PURCHASE_EXPERIENCE,{region:e}),{feature_name:this.featureName,preview_date:this.previewDate,frequency_cap:this.frequencyCap,deep_frequency_cap:this.deepFrequencyCap})}constructor(){T.extension.attachEvent("getPurchaseExperience",(async({data:e={}})=>{try{return await this.getPurchaseExperience(e)}catch(e){return null}}))}async getPurchaseExperience(e){let t=Oe(this.url,{uid:e.uid??""});t=ae(t,{store_id:e.storeId,store_name:e.storeName,tracking_ticket:e.trackingTicket});const{data:n,error:i}=await he(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","client-agent":`rewards_button/${R().version}`,"accept-language":"en"}});return i?null:n}},ea=qn.Model.extend({idAttribute:"storeId"}),ta=_i.extend({key:"stores/visited",model:ea,url:()=>Oe(B.MEMBER_VISITED),parse:e=>(0,P.chain)(e.stores).map((e=>(e.id&&!e.storeId&&(e.storeId=e.id),delete e.id,e))).flatten().value()}),na=_i.extend({key:"stores/purchased",model:ea,url:()=>Oe(B.MEMBER_PURCHASED),parse:e=>e.stores}),ia=Xn.extend({url:()=>Oe(B.MEMBER_DETAILS),key:"member",defaults:{rakutenMode:!0},async initialize(e){this.overlays=new ks,this.favorites=new Ys,this.favoritesRates=new Zs,this.visited=new ta,this.purchased=new na,this.topDeals=new Ci,this.balance=new zs,this.geogating=new qs,this.messages=new Ur,this.iscb=new Ds,this.tafSettings=new Fs,this.purchaseExperience=Qs,this.abandonedProducts=new Rs,this.milestones=Ks,await this.readCache({cache:!0,silent:!0}),this.identify(),this.get("id")!==e.id&&(this.clearCache(),this.clear(),this.balance.clear()),EBATES.badge.update(),this.on({change:function(e,t){t.unset&&(this.nextUpdateTime=0),(this.hasChanged("id")||this.hasChanged("userStatus"))&&(this.identify(),this.milestones.fetchDataOnSignIn()),this.hasChanged("id")&&(EBATES.merchants.rates.reset(),EBATES.experiments.clearCache(),this.previous("id")&&(this.balance.clear(),Promise.all([this.geogating.isEnabled()&&this.geogating.fetch({reset:!0}),this.balance.load({reset:!0})]).catch((()=>{})),this.iscb.stop(),this.favorites.stop(),this.visited.stop(),this.purchased.stop(),this.messages.reset(),EBATES.settings.userSettings.unset("tcppId"),EBATES.settings.userSettings.save(),this.abandonedProducts.clearCache())),EBATES.badge.update()},"change:accessLevel":async function(e,t){void 0===t?this.clearCache():(this.set({country_code:await Pe(Me.get("domain"),"country_code")}),this.saveCache()),this.saveCache()},error:function(e,t){[401,403].includes(t.status)&&EBATES.onTokenExpired()},"change:isHardDeleteRequested":e=>{if(EBATES)if(EBATES.settings.userSettings.toggleLogging(),EBATES.badge.update(),EBATES.member.isExtensionDisabled())EBATES.merchants.stop(),EBATES.merchants.reset();else{Object.keys(e.previousAttributes()).includes("isHardDeleteRequested")&&EBATES.merchants.fetch()}},"change:isDoNotShareActive":()=>{EBATES&&EBATES.settings.userSettings.toggleLogging()}}),T.extension.attachEvent("account",(async({data:e})=>(await self.EbatesPromise,EBATES?.ebToken?e?(this.set(e),this.toJSON()):this.getAccount():null))),T.extension.attachEvent("member.updateTCPP",(({data:e})=>this.updateTCPP(e))),T.extension.attachEvent("member.dismissTCPP",(()=>{EBATES.settings.userSettings.save({tcppDisplayed:Date.now()})})),T.extension.attachEvent("share",(({data:e})=>this.share(e))),T.extension.attachEvent("topDeals",(async({data:e})=>this.getTopDeals(e))),T.extension.attachEvent("createReferralLink",(({data:e})=>this.createReferralLink(e?.siteUrl))),T.extension.attachEvent("createShareLink",(({data:e})=>{const{merchant:t,productTitle:n,productUrl:i}=e;return this.createShareLink(t,n,i)})),T.extension.attachEvent("urlShortener",(async({data:e})=>await Ss(e?.url)??e?.url)),T.extension.attachEvent("messages",(async({data:e})=>{if(e?.created){const{created:t,...n}=e,i=this.messages.find((e=>e.get("created")===t));i&&i.set(n)}else await this.messages.flush();return this.messages.toJSON()})),T.extension.attachEvent("overlays",(({data:e})=>(e?.id&&(this.overlays.set(e),this.overlays.save()),this.overlays.toJSON())))},async getTopDeals({storeId:e}){return this.topDeals.populateDeals(e)},identify(){if(!this.id)return;const e=this.get("shortURLToken"),t=this.get("userStatus"),n=EBATES.settings.installedExtensions?.getInstalledExtensions().toString()||"";self.EBATES.segment.userId=this.id,self.EBATES.segment.identify(this.id,{referral_token:e,user_status:t,installed_extensions:n}),self.EBATES.holistic.setMember({guid:this.id,anonymous_id:self.EBATES.anonymousId});const i=self.EBATES.toolbarId.toString();self.EBATES.experiments.setMember({memberGuid:this.id,anonymousId:self.EBATES.toolbarId.toString()}),we.setGlobalContextProperty("toolbarId",i),we.setGlobalContextProperty("memberGuid",this.id)},async syncBalanceWithAccountSummary(){const e=await ni.get(kt),t=this.balance.getData();this.set({isAmexUser:t.isAmexUser,isBiltUser:t.isBiltUser});const n=this.get("accountSummary")??await T.extension.getItem("account");if(!e&&n){const e=(0,P.reduce)(n,((e,t,n)=>(e[n]=Number.isFinite(parseFloat(t))?parseFloat(t):t,e)),{});await this.balance.set(e),this.unset("accountSummary"),T.extension.setItem("account")}},async fetch(e,...t){if(!EBATES.ebToken)throw new Error("User is not logged in");this.has("accessLevel")&&(await Xn.prototype.fetch.apply(this,[e,...t]),await Promise.all([this.geogating.isEnabled()?this.geogating.fetch(e):null,this.balance.load(e)])),await this.syncBalanceWithAccountSummary()},parse(e,t){if(t?.headers){const n=t.headers.get("ResponseLevel");n&&(e.accessLevel=parseInt(n,10),this.getCache().then((t=>{t.data=e,this.setCache(t)})))}return(0,P.defaults)(e,{targetSet:"",personalizationSet:"",tcpp:null,isAmexUser:void 0,isBiltUser:void 0})},toJSON(...e){return{...Xn.prototype.toJSON.apply(this,e),ebToken:EBATES.ebToken,balance:this.balance.getData(),tafSettings:this.tafSettings.toJSON(),geogating:this.geogating?.toJSON(),isPendingDeletion:this.isPendingDeletion(),isExtensionDisabled:this.isExtensionDisabled()}},isPendingDeletion(){return!0===this.get("isHardDeleteRequested")},isGatingStatusBlocked(){return this.geogating?.isBlocked()&&this.geogating.isEnabled()},isTcppBlocking(){const e=this.get("tcpp");return e?.length&&(e[0].blocking||ve.variation("tcppBlocking",!1))&&e[0].tcppId!==EBATES.settings.userSettings.get("tcppId")},getTcpp(){const e=this.get("tcpp");if(e?.length){const t={...e[0]};return t.termsUrl=ae(t.termsUrl,{visit_id:EBATES.holistic.visit_id}),t.privacyUrl=ae(t.privacyUrl,{visit_id:EBATES.holistic.visit_id}),t.displayTcppText=t.displayTcppText.replace(t.termsString,`<a href="${Oe(t.termsUrl)}" target="_blank">${t.termsString}</a>`).replace(t.privacyString,`<a href="${Oe(t.privacyUrl)}" target="_blank">${t.privacyString}</a>`),t}return null},isExtensionDisabled(){return this.isPendingDeletion()||this.isGatingStatusBlocked()||this.isTcppBlocking()},updateTCPP(e,t=0){e&&(this.unset("tcpp"),this.saveCache(),EBATES.settings.userSettings.save({tcppId:e.tcppId}),he(Oe(B.MEMBER_UDPATE_TCPP),{method:"POST",contentType:"application/json",body:JSON.stringify({tcppId:e.tcppId,tcppTypeId:e.type_id,acceptedDate:(new Date).toISOString(),deviceInfo:"button"})}).catch((n=>{400!==n.status&&t<10&&setTimeout((()=>this.updateTCPP(e,t+1)),3e5)})))},getDomain:()=>Me.get("domain"),getRefId(){const e=this.get("shortUrl");return e.split("/")?.pop()},createShareLink(e,t,n){const{siteUrl:i,storeId:r}=e,s=Oe(`${B.BASE}/${i}_${r}-xfas`),a=this.getRefId();return ae(s,{eeid:ot.SHARE_RAF_PRODUCT_PAGE,ref_id:a,product_title:t,product_url:n})},async createReferralLink(e){const t=this.get("shortUrl"),n=this.getRefId(),i=ve.variation("rafStoreShare",!0);return e&&n&&i?Oe(`${B.BASE}/store/${e}?ref_id=${n}`):t},getCashBackDetails:e=>({store_name:e.storeName,store_id:e.storeId,...Ti(e.reward)}),async share({method:e,source:t,merchant:n,productTitle:i=null,productUrl:r=null,screen:s}){const a={Email:ot.SHARE_EMAIL,Copy:ot.SHARE_COPY,Facebook:ot.SHARE_FACEBOOK,Twitter:ot.SHARE_TWITTER},o=this.get("shortURLToken");let c=a[e];t===ft?c=ot.SHARE_POST_PURCHASE_NOTIFICATION:t===pt&&(c=ot.SHARE_RAF_PRODUCT_PAGE);const u=ae(await this.createReferralLink(n?.siteUrl),{eeid:c}),l=n?this.getCashBackDetails(n):null,h=(this.get("hasReferral")?"has":"never")+" referred";self.EBATES.segment.track("Start Refer A Friend",{share_method:e,eeid:c,source:t,referral_token:o,type:h,...l}),self.EBATES.holistic.track(je.ReferAFriendStarted,{data:{eeid:c.toString(),method:e,source:t,referrer_type:h}});const d=ve.variation("rafStoreShare",!0);let f=u;if(t===pt){const e=await this.createShareLink(n,i,r);f=await Ss(e)??u}if(t===ft&&d){const e=await this.createShareLink(n);f=await Ss(e)??e}if("Copy"===e)return f;if("Facebook"===e){return Lt({url:ae("https://www.facebook.com/dialog/share?",{display:T.browser.isSafari?"page":"popup",app_id:Me.get("FACEBOOK_APP_ID"),href:f,redirect_uri:Oe("/toolbar/taf/success.htm")}),width:601,height:345,screen:s}),f}if("Twitter"===e){return Lt({url:ae("https://twitter.com/intent/tweet?",{text:await this.tafSettings.getTwitterMessage(f,t,n,i)}),width:550,height:400,screen:s}),f}if("Email"===e){const{subject:e,message:r}=await this.tafSettings.getEmailMessage(f,t,n,i),s=`mailto:?subject=${encodeURIComponent(e)}&body=${encodeURIComponent(r)}`;return T.browser.navigate(s),f}throw new Error("Unknown share method")},async getAccount(){try{await this.fetch()}catch{}return this.toJSON()}});var ra=r(41169),sa=r.n(ra);const aa="webextensionsAnalytics",oa=()=>{};function ca(e){return"string"==typeof e}class ua{anonymousId="";userId="";defaultContext={};defaultProperties={};storage={sessionId:null,sessionTimestamp:null,queue:[]};flushed=!1;timer=null;constructor(e,{host:t="https://api.segment.io",timeout:n=0,flushAt:i=20,flushInterval:r=1e4,context:s={},properties:a={},enable:o}={}){this.writeKey=e;this.host=t.replace(/\/$/,""),this.timeout=n,this.flushAt=Math.max(i,1),this.flushInterval=r,this.defaultContext=s,this.defaultProperties=a,this.enable="boolean"!=typeof o||o,this.init()}async init(){await this.getStorage(),this.storage.sessionTimestamp&&Date.now()>this.storage.sessionTimestamp+18e5&&this.endSession(),s().alarms&&s().alarms.onAlarm.addListener((e=>{e.name===`${aa}.sessionTimeout`&&this.endSession()}))}set(e){Object.assign(this.defaultProperties,e)}setKey(e){this.writeKey=e}setHost(e){this.host=e}setEnable(e){this.enable=e}async getStorage(){const e=await s().storage.local.get(aa);if(e&&e[aa]&&Object.keys(e[aa]).length){const{queue:t,...n}=e[aa];Object.assign(this.storage,n),Array.isArray(t)&&(this.storage.queue=t)}}setStorage(){const e={...this.storage};e.queue=e.queue.map((({...e})=>(delete e.callback,e))),s().storage.local.set({[aa]:{...e}})}startSesssion(e){this.storage.sessionId=e,this.setStorage()}endSession(){this.storage.sessionId&&(s().alarms&&s().alarms.clear(`${aa}.sessionTimeout`),clearInterval(this.sessionTimeout),this.storage.sessionTimestamp=null,this.storage.sessionId=null,this.setStorage())}validateSession(){const e=(new Date).getTime();if(clearInterval(this.sessionTimeout),!this.storage.sessionId)try{this.startSesssion(e)}catch{}this.storage.sessionId&&(s().alarms?s().alarms.create(`${aa}.sessionTimeout`,{delayInMinutes:30}):(this.sessionTimeout=setInterval((()=>this.endSession()),18e5),this.storage.sessionTimestamp=e,this.setStorage()))}reset(){this.flush(),this.userId="",this.anonymousId="",this.defaultProperties={},this.storage.sessionId=null,this.storage.sessionTimestamp=null,this.setStorage()}identify(e,t={},n=oa){this.userId=e;const i={type:"identify",userId:e,anonymousId:this.anonymousId,traits:t};return this.enqueue(i,n),this}track(e,t,n){t=Object.assign({},t,this.defaultProperties);const i={type:"track",userId:this.userId,anonymousId:this.anonymousId,event:e,properties:t};return this.enqueue(i,n),this}enqueue(e,t=oa){if(this.enable&&this.writeKey){if((e=Object.assign({},e)).context=Object.assign({library:{name:"analytics-webextensions",version:"1.2.0"}},this.defaultContext,e.context),e.timestamp||(e.timestamp=new Date),e.messageId||(e.messageId=`node-${sa()(JSON.stringify(e))}-${D()}`),e.anonymousId&&!ca(e.anonymousId)&&(e.anonymousId=JSON.stringify(e.anonymousId)),e.userId&&!ca(e.userId)&&(e.userId=JSON.stringify(e.userId)),this.storage.sessionId&&(e.integrations={Amplitude:{session_id:this.storage.sessionId}},e.properties&&(e.properties.session_id=this.storage.sessionId)),this.storage.queue.push({message:e,callback:t}),this.setStorage(),!this.flushed)return this.flushed=!0,void this.flush();this.storage.queue.length>=this.flushAt&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}else setTimeout(t,0)}flush(){if(!this.enable||!this.writeKey)return Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.storage.queue.length)return Promise.resolve();const e=this.storage.queue.splice(0,this.flushAt),t=e.map((e=>e.callback)),n={batch:e.map((e=>e.message)),timestamp:new Date,sentAt:new Date},i=e=>(t.forEach((t=>"function"==typeof t&&t(e))),n);var r;const s={method:"POST",headers:{Authorization:`Basic ${r=`${this.writeKey}:`,"function"==typeof btoa?btoa(r):Buffer.from(r).toString("base64")}`,"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)};if(this.timeout&&Number.isFinite(this.timeout)&&this.timeout>0){const e=new AbortController;s.signal=e.signal,setTimeout((()=>e.abort()),this.timeout)}return fetch(`${this.host}/v1/batch`,s).then((()=>i())).catch((e=>{if(e.response){const t=new Error(e.response.statusText);return i(t)}return i(e)})).finally((()=>this.setStorage()))}}class la{loggingDisabled=!1;constructor({key:e,host:t}){e&&t&&(this.segmentAnalytics=new ua(e,{host:t,context:{library:{name:"Toolbar"}},properties:{browser:T.browser.name,browser_agent:navigator.userAgent,app_version:R().version,application_type:"Toolbar",application_subtype:"Toolbar",client:"toolbar",tenant:"ebates.com",platform:"Toolbar"}})),T.extension.attachEvent("segment.track",(({data:e})=>this.track(e.event,e.parameters))),T.extension.attachEvent("segment.anonymousId",(()=>this.segmentAnalytics?.anonymousId))}set anonymousId(e){this.segmentAnalytics&&(this.segmentAnalytics.anonymousId=e)}set userId(e){this.segmentAnalytics&&(this.segmentAnalytics.userId=e)}set(e){this.segmentAnalytics?.set(e)}async identify(e,t){if(this.loggingDisabled||!this.segmentAnalytics)return;const n=JSON.stringify({userId:e,...t}),i=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),i=Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("");return i}(n);i!==await T.extension.getItem("segment-signature")?(T.extension.setItem("segment-signature",i),this.segmentAnalytics.identify(e,t)):this.segmentAnalytics.userId=e}track(e,t,n,i={}){if((!this.loggingDisabled||["Install Application"].includes(e)||i.force)&&this.segmentAnalytics)return["Install Application","Update Application"].includes(e)||this.segmentAnalytics.validateSession(),this.segmentAnalytics.track(e,t,n)}}self.addEventListener("error",(e=>{e.message?.startsWith("Uncaught EvalError")||we.error(e.message,{colno:e.colno,error:e.error,filename:e.filename,lineno:e.lineno})}));const ha=["Network error","AbortError"];self.addEventListener("unhandledrejection",(e=>{const t=e.reason;t?.message&&(ha.includes(t.message)||we.warn(t.message,t))})),T.extension.attachEvent("datadogTrack",(({data:{type:e,name:t,data:n}})=>{we[e]?.(t,n)}));class da{constructor(){T.extension.attachEvent("GrouponDealsCollection",(({data:e})=>this.search(e)))}async search({query:e,location:t,limit:n}){try{if(!e||!t)return null;const i={query:e,limit:n||100,show:"id,dealUrl,announcementTitle,title,options,merchant,grid4ImageUrl",other_deals:!0,locale:"en_US",offset:0,metadata:!1,client_id:"0c9926ce2479a25adec0c9b3c1e6327c73946fe7",tsToken:"US_AFF_0_200014_200067_0",secure_assets:!1,lng:t.lng,lat:t.lat},r=`https://api.groupon.com/v2/deals/search?${new URLSearchParams(i)}`,{data:s}=await he(r);if(s)return this.parse(s)}catch{}return null}parse(e){const t=self.EBATES.settings.get("groupon").exclusions||[],n=e.deals.filter((e=>e.title.indexOf("Cash Back")<0));return(0,P.map)(n,(e=>(0,P.extend)({locations:(0,P.flatten)((0,P.map)(e.options,(e=>(0,P.map)(e.redemptionLocations,(e=>t.includes(e.uuid)?null:(0,P.pick)(e,"streetAddress1","city","state","postalCode","phoneNumber"))).filter(Boolean))))},(0,P.pick)(e,"id","dealUrl","announcementTitle","title","grid4ImageUrl","options"),(0,P.pick)(e.merchant,"name","websiteUrl"))))}}var fa=class e{static initParams(e,t){return[e.replace(/\s+/g,"").toLowerCase(),t.replace(/\s+/g,"").toLowerCase()]}static checkThanosType(e){if("string"!=typeof e)throw new Error("first argument should be a string")}static checkRivalType(e){if("string"!=typeof e)throw new Error("second argument should be a string")}static checkAvengersType(e){if(!Array.isArray(e))throw new Error("second argument should be an array of strings");if(e.find((e=>"string"!=typeof e)))throw new Error("second argument should be an array of strings")}sortMatch(t,n){return e.checkThanosType(t),e.checkAvengersType(n),n.map(((e,n)=>({member:e,index:n,rating:this.similarity(t,e)}))).sort(((e,t)=>e.rating-t.rating))}},pa=new class extends fa{similarity(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t);if(!n.length&&!i.length)return 1;if(!n.length||!i.length)return 0;if(n===i)return 1;let r=Array.from(new Set(n.split("").concat(i.split("")))),s=this.stringVectorization(n.split(""),r),a=this.stringVectorization(i.split(""),r),[o,c,u]=[0,0,0];for(let e=0;e<s.length;++e)o+=s[e]*a[e],c+=s[e]*s[e],u+=a[e]*a[e];return c=Math.sqrt(c),u=Math.sqrt(u),Number(o)/(c*u)}distance(e,t){return 1-this.similarity(e,t)}stringVectorization(e,t){return t.map((t=>e.includes(t)?1:0))}},ga=new class extends fa{similarity(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t),[r,s]=[n.length,i.length];if(!n.length&&!i.length||n===i)return 1;if(r<2||s<2)return 0;let a=new Map;for(let e=0;e<r-1;e++){let t=n.slice(e,e+2),i=a.has(t)?a.get(t)+1:1;a.set(t,i)}let o=0;for(let e=0;e<s-1;e++){let t=i.slice(e,e+2),n=a.has(t)?a.get(t):0;n>0&&(a.set(t,n-1),++o)}return 2*o/(r+s-2)}distance(e,t){return 1-this.similarity(e,t)}},ma=new class extends fa{similarity(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t);if(!n.length&&!i.length||n===i)return 1;let r=new Set(n.split("").concat(i.split(""))),s=new Set(n.split("").filter((e=>new Set(i).has(e))));return Number(s.size)/r.size}distance(e,t){return 1-this.similarity(e,t)}},va=new class extends fa{similarity(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t);return n.length||i.length?1-Number(this.distance(n,i))/Math.max(n.length,i.length):1}distance(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t);if(n===i)return 0;let[r,s]=[n.length,i.length];if(!r)return s;if(!s)return r;let a,o=[...Array(r+1)].map((()=>Array(s+1).fill(0)));for(let e=0;e<=r;++e)o[e][0]=e;for(let e=0;e<=s;++e)o[0][e]=e;for(let e=1;e<=r;++e)for(let t=1;t<=s;++t)a=n[e-1]===i[t-1]?0:1,o[e][t]=Math.min(o[e-1][t]+1,o[e][t-1]+1,o[e-1][t-1]+a);return o[r][s]}},ya=new class e extends fa{static lcsLength(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t),[r,s]=[n.length,i.length],a=[...Array(r+1)].map((()=>Array(s+1).fill(0)));for(let e=1;e<=r;++e)for(let t=1;t<=s;++t)a[e][t]=n[e-1]===i[t-1]?a[e-1][t-1]+1:Math.max(a[e][t-1],a[e-1][t]);return a[r][s]}similarity(t,n){fa.checkThanosType(t),fa.checkRivalType(n);let[i,r]=fa.initParams(t,n);return!i.length&&!r.length||i===r?1:2*e.lcsLength(i,r)/(i.length+r.length)}distance(t,n){let[i,r]=fa.initParams(t,n);return i.length+r.length-2*e.lcsLength(i,r)}},ba=ya,wa=new class e extends fa{static lcsLength(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=[e.length,t.length],r=[...Array(n+1)].map((()=>Array(i+1).fill(0)));for(let s=1;s<=n;++s)for(let n=1;n<=i;++n)r[s][n]=e[s-1]===t[n-1]?r[s-1][n-1]+1:Math.max(r[s][n-1],r[s-1][n]);return r[n][i]}similarity(t,n){fa.checkThanosType(t),fa.checkRivalType(n);let[i,r]=fa.initParams(t,n);return!i.length&&!r.length||i===r?1:Number(e.lcsLength(i,r))/Math.max(i.length,r.length)}distance(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t);return n===i?0:1-this.similarity(n,i)}},Ea=wa,Aa=new class extends fa{distance(e,t){fa.checkThanosType(e),fa.checkRivalType(t);let[n,i]=fa.initParams(e,t);if(!n.length&&!i.length)return 1;if(!n.length||!i.length)return 0;if(n===i||n===i)return 1;let r=n.length,s=i.length;if(0===r||0===s)return 0;let a=Math.floor(Math.max(r,s)/2)-1,o=0,c=new Array(n.length).fill(0),u=new Array(i.length).fill(0);for(let e=0;e<r;e++)for(let t=Math.max(0,e-a);t<Math.min(s,e+a+1);t++)if(n[e]===i[t]&&0===u[t]){c[e]=1,u[t]=1,o++;break}if(0===o)return 0;let l=0,h=0;for(let e=0;e<r;e++)if(1===c[e]){for(;0===u[h];)h++;n[e]!==i[h++]&&l++}return l/=2,(o/r+o/s+(o-l)/o)/3}similarity(e,t){let n=this.distance(e,t);if(n>.7){let i=0;for(let n=0;n<Math.min(e.length,t.length)&&e[n]===t[n];n++)i++;i=Math.min(4,i),n+=.1*i*(1-n)}return n}},xa={cosine:pa,diceCoefficient:ga,jaccardIndex:ma,levenshtein:va,lcs:ya,longestCommonSubsequence:ba,mlcs:wa,metricLcs:Ea,jaroWinkler:Aa};class Ta{constructor(){T.extension.attachEvent("searchHotels",(({data:e})=>this.search(e)))}async search({queryText:e,locationKeyword:t,geoLocation:n,checkIn:i,checkOut:r,radius:s=.5,thumbnailImageSize:a="b",pattern:o}){const c=new Headers;c.append("Accept-Encoding","gzip"),c.append("Accept","application/json"),c.append("Client-Agent","button"),c.append("X-Button-Version",R().version);const u=new URL(Oe("%rakuten_api%/price-magic/v1/lodgings"));u.searchParams.append("thumbnail_image_size",a),u.searchParams.append("radius",s.toString()),e&&u.searchParams.append("query_text",e),t&&u.searchParams.append("location_keyword",t),n&&u.searchParams.append("geo_location",n),i&&u.searchParams.append("check_in",new Date(i).toISOString().split("T")[0]),r&&u.searchParams.append("check_out",new Date(r).toISOString().split("T")[0]);const{data:l,error:h}=await he(u,{method:"GET",headers:c,redirect:"follow"});if(h)return this.trackRequest({url:u.toString(),pattern:o,error:h.message}),null;{const t=e?l?.data?.find((t=>this.validateHotelData(t,e))):l?.data?.[0];return this.trackRequest({url:u.toString(),pattern:o}),t}}trackRequest({url:e,pattern:t,error:n}){const i={module_type:"Travel Req",entity_name:"Travel Req",domain:Le(t),pattern:t,api_call:e,error:n};self.EBATES.segment.track("Request API",i)}validateHotelData(e,t){return e?.name&&e.thumbnail_url&&e.room_types.length>0&&e.room_types.every((e=>e.price&&e.links?.web_details?.href&&e.price?.avg_nightly_rate))&&xa.levenshtein.similarity(e.name,t)>.9}}const Sa=new Map;function _a(e){self.EBATES.segment.track("CAA",e)}function ka(e){const t=Sa.get(e);t&&(clearTimeout(t.timeoutId),Sa.delete(e),T.browser.detachEvent(T.browser.TABCLOSED,Ia))}function Ia({tabId:e}){const t=Sa.get(e);t&&(_a({coupon_auto_apply_status:"Terminated",...t.event,duration:Date.now()-t.startTime}),ka(e))}class Ca{constructor(){T.extension.attachEvent("log.caa",(({data:e,tabId:t})=>{const{action:n,event:i}=e,{coupon_auto_apply_status:r,...s}=i,a=Sa.get(t);if(i.duration_ms=a?.startTime?Date.now()-a.startTime:0,_a(i),"start"===n){const e=s.available_coupons?s.available_coupons.split(", ").length:0;if(e>0){const n=setTimeout((()=>function({tabId:e}){const t=Sa.get(e);t&&(_a({coupon_auto_apply_status:"Timeout",...t.event,duration:Date.now()-t.startTime}),ka(e))}({tabId:t})),30*e*1e3),i=Date.now();Sa.set(t,{event:s,timeoutId:n,startTime:i}),T.browser.attachEvent(T.browser.TABCLOSED,Ia)}}else["success","error","cancel"].includes(n)&&ka(t)}))}}class Da{injectImmediately=!1;constructor({settings:e,merchant:t,url:n,tabId:i}){this.settings=e,this.merchant=t,this.url=n,this.tabId=i}}class Pa extends Da{name=Ve;isActive(){return Gn(this.url)}async init(){}getParameters(){return{}}}class Ba extends Da{name=He;grouponSettings={};async init(){this.grouponSettings=this.settings.groupon??{},this.grouponViewKey=Object.keys(this.grouponSettings).find((e=>{const t=this.grouponSettings[e];return!!(t.enable&&t.rx&&new RegExp(t.rx).test(this.url))}))}isActive(){return ve.variation("grouponInjections",!0)&&this.grouponViewKey}getParameters(){return{grouponViewKey:this.grouponViewKey,config:this.grouponSettings[this.grouponViewKey]}}}class Ma extends Da{name=We;async init(){return!0}isActive(){return ve.variation("businessCard",!0)&&!!Rt&&new RegExp(Rt).test(this.url)}getParameters(){return{}}}class Ra extends Da{name=Ge;config=null;async init(){const e=this.settings.iscb;if(e)for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(new RegExp(n.url).test(this.url))return n.category||(n.category=`ISCB ${t.replace(/-/g," ")}`,n.entity_name=t.replace(/-/g," ")),void(this.config=n)}}isActive(){return ve.variation("iscb",!0)&&!!this.config}getParameters(){return{config:this.config}}}class Na extends Da{name=qe;async init(){this.merchant?.session.caaProgress&&(this.injectImmediately=!0)}isActive(){return!!this.merchant}getParameters(){return{merchant:this.merchant}}}class Oa extends Da{abandonedReminderActive=!1;name=ze;async init(){if(!ve.variation("pmEnabled",!0))return;const e=new URL(this.url).host;if(!(this.merchant&&(this.merchant.offers_cb||2===this.merchant.activationCode&&this.merchant.session.notificationHover||this.merchant.session.pmDisabled||this.merchant.session.suppressed&&this.merchant.session.competitor&&this.settings.standDownDomains?.includes(this.merchant.session.competitor)))){const t=this.settings.priceMagic,n=await Qr.load();t.excludedDomains.find((t=>e.search(t)>=0))||(this.config=n.find((({domainName:t})=>e.search(t)>=0))),ve.variation("cartAbandonmentToast",!1)&&self.EBATES.settings.userSettings.get("abandonedProductsReminder")&&await self.EBATES.member.abandonedProducts.reminder.isEligibleDomain(e)&&(this.abandonedReminderActive=!0)}}isActive(){return!!this.config||this.abandonedReminderActive}getParameters(){return{config:this.config,abandonedReminderActive:this.abandonedReminderActive}}}class La extends Da{name=Ke;async init(){this.config=self.EBATES.settings.interstitialConfig.get(this.url)}isActive(){return!!this.config}getParameters(){return{config:this.config}}}const ja=new class extends me{_id="products";DEFAULT_UPDATE_INTERVAL=864e5;get url(){return Oe(B.SETTINGS_PRODUCTS)}getConfigs(){return is(this.load(),[])}parse(e){return e?.stores??[]}};class Ua extends Da{name=Je;async init(){if(!ve.variation("productPageTracker",!0))return;const e=await ja.getConfigs();this.config=e.find((e=>e.url&&new RegExp(e.url).test(this.url)))}isActive(){return!!this.config}getParameters(){return{merchant:this.merchant,config:this.config}}}const Fa=new class extends me{_id="serp";DEFAULT_UPDATE_INTERVAL=216e5;get url(){return Oe(B.SETTINGS_SERP)}parse(e){return e?.serp}};class $a extends Da{name=Ye;async init(){const e=ve.variation("customSerp",!1)?await Fa.load():this.settings.serp,t=new URL(this.url).host;this.config=e?.find((({domain:e})=>t.includes(e)))}isActive(){return ve.variation("serp",!0)&&!!this.config}getParameters(){return{config:this.config}}}class qa extends Da{name=Xe;async init(){if(!(await ni.get(_t)??{}))return;const e=EBATES.settings.userSettings.get("hotelsWidgetClosedDate");(!e||Date.now()>e+36e5)&&(this.config=self.EBATES.settings.get("hotelsConfig").find((({pattern:e})=>this.url.includes(e))))}isActive(){return!!this.config}getParameters(){return this.config??{}}}class Ha extends Da{name=Ze;getPromo(e){const t=this.settings;if(t.promos){const n=(0,P.findWhere)(t.promos,{id:e,active:!0});if(n)return n}}async init(){this.promo=this.getPromo("taxes")}isActive(){return this.promo?.urls?.find((e=>this.url.search(e)>=0))}getParameters(){return{taxes_promo:this.promo}}}class Wa extends Da{name=Qe;timestamp=null;isActive(){return Gn(this.url)&&self.EBATES.settings.installedExtensions&&(!this.timestamp||this.timestamp+864e5<=Date.now())}async init(){this.timestamp=await T.extension.getItem("installed_extensions_check")}getParameters(){return{extensions:self.EBATES.settings.installedExtensions.extensions}}}class Va extends Da{name=et;caaConfigs=[];async init(){this.caaConfigs=await rs.match({url:this.url,storeId:this.merchant?.storeId})}isActive(){return this.caaConfigs.length>0}getParameters(){return{caaConfigs:this.caaConfigs,merchant:this.merchant}}}class Ga extends Da{name=tt;async init(){const e=ve.variation("similarStores",!1),t=Bs(this.url);if(!t||!e)return;if(await os.hasStoreExclusion(t))return void(this.merchant&&(this.merchant.isSimilarStoresIncrementalityTest=!1));if(await ni.variation(vt)&&!(this.isExcludedDomain(t)||this.merchant?.offers_cb||2===this.merchant?.activationCode&&this.merchant.session.notificationHover||this.merchant?.recommendedStoresPromo&&this.merchant.session.notificationHover)){const e=await os.fetch(t);if(e?.stores&&e.stores.length>0){if(await this.blockRenderIncrementalityTest(e,t))return;this.config=e}}}isActive(){return!!this.config}getParameters(){return{config:this.config}}isExcludedDomain(e){return this.settings.serp?.some((({domain:t})=>e===t))}async blockRenderIncrementalityTest(e,t){if("IE-Test-Expedia"===e?.flagId&&this.merchant?.incrementalityTest){if(this.merchant.isSimilarStoresIncrementalityTest=!0,"X"!==this.merchant.incrementalityTest)return!0;await ni.activate("IE-Test-Expedia",{storeId:this.merchant?.storeId,storeDomain:t,placement:"Similar Stores"})}else this.merchant&&(this.merchant.isSimilarStoresIncrementalityTest=!1);return!1}}class za extends Da{name=nt;active=!1;async init(){const e=EBATES.settings.userSettings.get("tcppDisplayed"),t=self.EBATES.member.isTcppBlocking();this.active=this.merchant&&t&&(!e||Date.now()-e>864e5)}isActive(){return this.active}getParameters(){return{active:this.active}}}class Ka extends Da{name=it;active=!1;async init(){if(this.merchant?.offers_cb)return;if(!await ni.canUserAccessFeature(xt))return;if(!await Ms.isEligibleDomain(this.url))return;const e=EBATES.feed.timelines.get(lt);if(!e)return;const t=await e.getActiveDomains(),n=await e.getVisitedDomains();this.domainId=(0,P.without)(t,...n)?.[0]}isActive(){return!!this.domainId}getParameters(){return{domainId:this.domainId}}}class Ja extends Da{name=rt;active=!1;async init(){if(this.merchant?.offers_cb)return;if(!1===self.EBATES.settings.userSettings.get("increasedCBNotificationEnabled"))return;if(!await ni.canUserAccessFeature(It))return;if(await us.isTimedOut())return;await Ms.isEligibleDomain(this.url)&&(this.increasedCBStore=await us.getIncreasedCBMerchant())}isActive(){return!!this.increasedCBStore}getParameters(){return{increasedCBNotification:this.increasedCBStore}}}class Ya extends(O()){scriptsExecutionStatus=new Map;constructor({settings:t,merchant:n,url:i,tabId:r,abortController:s}){super(),this.settings=t,this.merchant=n,this.url=i,this.tabId=r,this.contentFeatures=Object.values(e).map((e=>new e(this))),this.abortController=s}get isBlacklisted(){return Array.isArray(this.settings.contentBlackList)&&this.settings.contentBlackList.some((e=>{const t=e&&new RegExp(e);return t&&t.test(this.url)}))}async injectContentScripts(e=!1){return!this.isBlacklisted&&!this.abortController.signal.aborted&&(await Wt.executeScript({tabId:this.tabId,files:["./js/commons.js","./js/content.js"],signal:this.abortController.signal,injectImmediately:e}),!0)}async process(){if(self.EBATES.member.isTcppBlocking()){const e=this.contentFeatures.find((({name:e})=>e===nt));return e?.init(),void(e?.isActive()&&(await this.injectContentScripts(),await this.execute({settings:this.settings,features:{[nt]:!0}})))}await Promise.allSettled(this.contentFeatures.map((e=>e.init())));const e=this.contentFeatures.filter((e=>e.isActive()));if(e.length){const t=e.some((e=>e.injectImmediately));if(!await this.injectContentScripts(t)||this.abortController.signal.aborted)return;const n={};for(const t of e)n[t.name]=t.getParameters();await this.execute({settings:this.settings,features:n})}}async execute(e){try{await T.extension.fireEvent("execute",{tabId:this.tabId,data:e})}catch(e){0}}}class Xa{page=null;abortControllers=new Map;initAbortController(e){const t=new AbortController;return this.abortControllers.set(e,t),t}deleteAbortController(e){this.abortControllers.delete(e)}abortProcess(e){const t=this.abortControllers.get(e);t?.abort(),this.deleteAbortController(e)}invalidateMerchants=(0,P.throttle)((async function(){try{await self.EBATES.merchants.fetch()}catch{}}),1e3);detectAndTrackCompetitor(e,t){function n(e){const t=Le(e)??"";return!(!self.EBATES.settings.get("competitorDomains").includes(t)||EBATES.session_competition?.domain===t)&&(EBATES.session_competition={url:e,domain:t},self.EBATES.segment.track("Visit Competitor Page",{url:e,domain:t}),!0)}if(!n(e)){const e=self.EBATES.settings.affiliates.state(t),i=e?.suppress?.url;n(i)}}async processPage(e,t){if(self.EBATES.member.isExtensionDisabled()&&!self.EBATES.member.isTcppBlocking()||!Le(e))return;Gt({tabId:t,url:e});const n=self.EBATES.settings.toJSON();"A"!==await ni.get(Et)&&(n.rabExcludedStores=[]),this.abortControllers.has(t)&&this.abortProcess(t);const i=this.initAbortController(t);await this.invalidateMerchants(),this.detectAndTrackCompetitor(e,t);const r=self.EBATES.merchants.match(e,t);await(r?.processDocumentComplete(e,t));const s=await(r?.getDetailedMerchantJSON());this.page=new Ya({settings:n,url:e,tabId:t,merchant:s,abortController:i}),await this.page.process(),this.deleteAbortController(t)}}const Za=2592e6;function Qa(e,t){return!!t&&(!e||(t.storesIn&&t.storesIn.includes(e)||!t.storesIn?.length&&t.storesNotIn&&!t.storesNotIn.includes(e)))}const eo=9e5;class to extends me{constructor({slugName:e,fieldSet:t="events",duration:n}){super(),this._id=e,this.fieldSet=t,n?this.duration=n:(this.duration=eo,self.EbatesPromise.then((()=>{this.duration=ve.variation("feedTimelineUpdateInterval",eo),ve.on("change:feedTimelineUpdateInterval",(e=>{this.duration=e}))})))}get url(){return ae(`${Me.get("feed_api")}/feedapi/v3/timeline`,{slugName:this._id,duration:Math.floor(this.duration/1e3),fieldSet:this.fieldSet})}get headers(){const e=self.EBATES?.feed?.previewToken;return{Authorization:`ebtoken ${self.EBATES?.ebToken}`,"Client-Agent":at[st.DEFAULT].toLowerCase(),"X-Platform":at[st.DEFAULT],"X-Anonymous-ID":self.EBATES?.toolbarId?.toString()??"","X-Web-Host":"",...e&&{"X-Preview-Token":e}}}set duration(e){Number.isFinite(e)&&e>1e3&&(this.UPDATE_INTERVAL=e)}get duration(){return this.UPDATE_INTERVAL}isDomainActive(e,t){const{events:n}=this.getData(),i=Math.floor(Date.now()/1e3),r=n.filter((({event:n})=>n.domainId===e&&Qa(t,n))).sort(((e,t)=>e.timestamp-t.timestamp));return r.reduce(((e,{event:t,timestamp:n})=>(n<=i&&(["running","start"].includes(t.action)?e=!0:"expire"===t.action&&(e=!1)),e)),!1)}async getUniqueDomainIds(e){const{events:t}=await this.load();return[...new Set(t.filter((({event:t})=>Qa(e,t))).map((({event:e})=>e.domainId)))]}async getActiveDomains(e){try{return(await this.getUniqueDomainIds(e)).filter((t=>this.isDomainActive(t,e)))}catch{return[]}}async hasActiveDomains(e){try{return(await this.getUniqueDomainIds(e)).some((t=>this.isDomainActive(t,e)))}catch{return!1}}async visitDomains(e){const t=Date.now(),n=await Te.get(`${this._id}/visited`)??{},i=new Map(Object.entries(n));e.forEach((e=>i.set(e,t))),i.forEach(((e,n)=>{e+this.duration<t&&i.delete(n)}));const r=Object.fromEntries(i);return Te.set(`${this._id}/visited`,r)}async getVisitedDomains(e=0){const t=await Te.get(`${this._id}/visited`)??{},n=Date.now(),i=[],r=e>0?Math.min(Za,e):Za;return Object.entries(t).forEach((([e,s])=>{s+r<n?delete t[e]:i.push(e)})),Te.set(`${this._id}/visited`,t),i}parse(e){return e.data?.viewer?.timeline}}class no{#e="button/feed/badge";timelines=new Map;constructor(e){this.timelines=e,T.extension.attachEvent("feedBadge:visitDomains",(async()=>{const{url:e,tabId:n}=await Wt.getActive(),i=await this.getActiveDomains(e,n),r=await Te.get(this.#e)||[];await Te.set(this.#e,i.concat(r).splice(0,1e3)),t({url:e,tabId:n})}));const t=async({url:e,tabId:t})=>{if(self.EBATES){if(!self.EBATES.member.isExtensionDisabled()&&self.EBATES.feed.enabled){const n=await this.getActiveDomains(e,t);if(n.length){const e=await Te.get(this.#e)||[],t=(0,P.without)(n,...e);return void self.EBATES.badge.update("feed",t.length)}}self.EBATES.badge.update("feed",0)}};T.browser.attachEvent(T.browser.DOCUMENTCOMPLETE,t),T.browser.attachEvent(T.browser.TABCHANGED,t)}async getActiveDomains(e,t){const n=self.EBATES.merchants.match(e,t);return(await(n?.isActiveButtonMerchant())&&"X"!==await(n?.incrementalityTest())?await(this.timelines.get(ct)?.getActiveDomains(n.id.toString())):await(this.timelines.get(ut)?.getActiveDomains()))??[]}reset(){Te.delete(this.#e)}}class io extends me{UPDATE_INTERVAL=216e5;channelId=st.DEFAULT;get url(){return ae(`${Me.get("feed_api")}/feedapi/v1/feed`,{slugName:this._id})}get enabled(){return ve.variation("feed",!0)&&!0}get headers(){const e=self.EBATES?.feed?.previewToken;return{Authorization:`ebtoken ${self.EBATES?.ebToken}`,"Client-Agent":at[st.DEFAULT].toLowerCase(),"X-Platform":at[st.DEFAULT],"X-Channel-ID":this.channelId,"X-Anonymous-ID":self.EBATES?.toolbarId,...e&&{"X-Preview-Token":e}}}get isPreviewMode(){return null!==self.EBATES?.feed?.previewToken}async loadData(e){if(!this.enabled)return[];e=!!this.isPreviewMode||e;return await is(this.load({force:e}),[])}}class ro extends io{_id=dt;channelId=st.BUTTON_COMPETITOR_BANNER;parse(e){const t=e?.data?.viewer?.feed,n=t?.topics?.edges?.[0]?.node?.items?.edges,i=[];if(n)for(const e of n){const t=this.formatNode(e.node);t&&i.push(t)}return i}formatNode({itemData:e,payloads:t}){let n,i=[],r=[];const s=this.formatPrimaryStore(e,t),a=this.formatSecondaryStores(e);try{i=e.domains_text.split(",").map((e=>e.trim())),n=e.eeid_text?parseInt(e.eeid_text,10):void 0,r=e.similarstoreids_text?.split(",").map((e=>({storeId:parseInt(e.trim(),10)})))}catch{return null}return{domains:i,stores:r??[s,...a],eyebrow:e.eyebrow_text||e.primaryeyebrow_text,headline:e.headline_text||e.primaryheadline_text,buttonCopy:e.primarycta_buttontext,eeid:n,additionalText:e.additionalstores_text||e.extrastoresheadline_text,showPreviousCashback:!!r||"true"===e.showpreviouscashback_text,showStoreNames:"true"===e.showstorename_text,flagId:e.flagid_text,flagValue:e.flagvalue_text}}formatSecondaryStores(e){const t=[];for(let n=1;n<=3;n++){const i=`extrastore${n}deeplink_linkurl`,r=`extrastore${n}logo_alttext`,s=`extrastore${n}logo_imageurl`,a=e[`extrastore${n}storeid_text`],o=a?parseInt(a,10):null,c=e[i],u=e[r],l=e[s];o&&t.push({storeId:o,logoUrl:l,altText:u,deepLink:c})}return t}formatPrimaryStore(e,t){return{storeId:t[0]?.payload?.store_id,logoUrl:e.primarystorelogo_imageurl,altText:e.primarystorelogo_alttext,deepLink:e.primarycta_ctaurl}}}class so extends io{_id=ht;channelId=st.BUTTON_SERP_ADS;constructor(){super(),T.extension.attachEvent("feed:serp-ad-fetch",(async()=>this.loadData()))}parse(e){const t=e?.data?.viewer?.feed,n=t?.topics?.edges?.[0].node?.items?.edges;return n.length?this.getActiveSerpBanners(n):null}getActiveSerpBanners(e){if(!e)return null;const t=[];for(const n of e){const e=this.formatNode(n.node);e&&t.push(e)}return t}formatNode({itemData:e,payloads:t}){const n=e.keywords_text.split(",").map((e=>e.trim())),i=t[0]?.payload;let r={"insert-before":"#search"},s={};try{s=e.xfasparams_text?JSON.parse(e.xfasparams_text):s,r=e.insertconfig_text?JSON.parse(e.insertconfig_text):r}catch{}return{id:e.id,type:e.type_text,browser:e.browser_text,flagId:e.flagid_text,flagValue:e.flagvalue_text,config:{keywords:n,xfasParams:s,insertConfig:r,storeId:i.store_id,logo:e.logo_imageurl,title:e.title_text,description:e.description_text,image:e.media_imageurl,ctaUrl:e.cta_ctaurl,ctaText:e.cta_buttontext,badgeText:e.badge_text}}}}const ao={url:"https://preview-www.rakuten.com/",domain:"preview-www.rakuten.com",name:"previewToken"};class oo{previewToken=null;timelines=new Map([[ut,new to({slugName:ut})],[ct,new to({slugName:ct})],[lt,new to({slugName:lt,duration:36e5})]]);constructor(){this.feedBadge=new no(this.timelines),this.serpFeed=new so,this.similarStoresFeed=new ro,T.extension.attachEvent("feed:fetch",(async({data:e})=>{if(!this.enabled)return null;return await this.fetch(e)})),T.extension.attachEvent("feed:exitPreviewMode",(async()=>{try{await(s().cookies?.remove({url:ao.url,name:ao.name}))}catch(e){}T.extension.fireEvent("feed:closePreviewMode",{tabId:T.browser.ALLTABS}),this.clearDynamicCaches()})),T.extension.attachEvent("timeline:visitDomains",(async({data:{timeline:e,domainIds:t}})=>{this.timelines.get(e)?.visitDomains(t)})),s().cookies?.onChanged.addListener((({cookie:e,removed:t})=>{e.domain===ao.domain&&e.name===ao.name&&(this.previewToken=t?null:e.value)})),this.getPreviewToken().then((e=>this.previewToken=e))}get enabled(){return ve.variation("feed",!0)}async getPreviewToken(){try{const e=await(s().cookies?.get({url:ao.url,name:ao.name}));return e?.value||null}catch(e){}return null}parse(e){const t=e?.data?.viewer?.feed;return t?.topics?.edges?.length>0?{pages:[t],pageParams:[null]}:null}async fetch({slugName:e,timelineSlugName:t,storeId:n}){const i=self.EBATES.settings.featureFlags,r=i.variation("feedPreview",!0);if((r&&!this.previewToken||!r)&&t&&i.variation("feed",!0)&&i.variation("feedTimeline",!0)){this.timelines.has(t)||this.timelines.set(t,new to({slugName:t}));if(!await(this.timelines.get(t)?.hasActiveDomains(n?.toString())))return null}const{data:s}=await he(`${Me.get("feed_api")}/feedapi/v1/feed`,{data:{slugName:e,size:"",cursor:""},headers:{Authorization:`ebtoken ${self.EBATES?.ebToken}`,"Client-Agent":at[st.DEFAULT].toLowerCase(),"X-Platform":at[st.DEFAULT],"X-Anonymous-ID":self.EBATES?.toolbarId,"X-Web-Host":"",...this.previewToken&&{"X-Preview-Token":this.previewToken}}});return this.parse(s)}clearDynamicCaches(){this.similarStoresFeed.clearCache(),this.serpFeed.clearCache()}}var co=r(21812),uo=r(80614);const lo="holistic.installation_id",ho="holistic.visit_timestamp",fo="visitId";class po{loggingDisabled=!1;constructor({region:e}){this.isReady=this.init(),T.extension.attachEvent("holistic.track",(({url:e,data:{event:t,type:n,schemaId:i,data:r,...s}})=>{t?this.track(t,{url:e,data:r,...s}):!t&&i&&n&&this.trackBySchemaId({url:e,schemaId:i,type:n,data:r,...s})})),this.messagingSDK=new uo.MessagingSDK;const t=this.getPlatform();this.messagingSDK.init({hostApp:{name:`rr-button-${t}`,version:R().version,type:uo.AppType.Extension},networkConfig:{regions:{USA:{messageGatewayBaseURL:Me.get("rakuten_api","USA"),batchSize:10,lingerDuration:1e4},GBR:{messageGatewayBaseURL:Me.get("rakuten_api","GBR"),batchSize:10,lingerDuration:1e4}}},regionId:e,invalidMessagesHandler:(e=[])=>{0}})}async init(){let e=await T.extension.getItem(lo),t=await T.extension.getItem(fo);this.visit_timestamp=await T.extension.getItem(ho)||Date.now(),e||(e=D(),t=D(),T.extension.setItem(lo,e),T.extension.setItem(fo,t)),this.installation_id=e,this.visit_id=t}async track(e,{url:t,data:n,clientContext:i}){if(this.loggingDisabled&&![je.ApplicationInstalled].includes(e)||!ve.variation("holistic"))return;await this.isReady,this.validateVisitId(e,n);const r=await this.getPage(t);let s;if(Ue[e].send_integration_data){const e=await Pe(Me.get("domain"),"cpa");s=e?{comet:{cpa:e}}:void 0}return this.messagingSDK.send({type:Ue[e].type,schema_id:Ue[e].schema_id,visit_id:this.visit_id,installation_id:this.installation_id,data:n,page:r,clientContext:i,integration_data:s})}async trackBySchemaId({schemaId:e,type:t,url:n,data:i}){if(this.loggingDisabled||!ve.variation("holistic"))return;await this.isReady,this.validateVisitId(je.SurfaceVisited,i);const r=await this.getPage(n);return this.messagingSDK.send({type:t,schema_id:e,visit_id:this.visit_id,installation_id:this.installation_id,data:i,page:r})}getPlatform(){return T.browser.isFirefox?"firefox":T.browser.isEdge?"edge":T.browser.isSafariMobile?"safari-mobile":T.browser.isSafari?"safari":"chrome"}async getPage(e){if((e=e||(await Wt.getActive()).url).length)try{const{host:t,pathname:n,searchParams:i}=new URL((0,co.J)(e));return{host:t,path:n,url:`${t}${n}`,type:"extension",query_params:Object.fromEntries(i)}}catch{return}}setMember(e){this.messagingSDK.setMember(e)}validateVisitId(e,t){t&&(this.visit_timestamp+18e5<Date.now()&&(this.visit_id=D(),T.extension.setItem(fo,this.visit_id),e!==je.SurfaceVisited&&this.track(je.SurfaceVisited,{data:{}})),this.visit_timestamp=Date.now(),T.extension.setItem(ho,this.visit_timestamp))}}async function go(){return ve.get("storageMetrics")?(await async function(){const e=/(activity|deals\/top|deals\/.*|deals\/*\.nextUpdateTime)/,t=await s().storage.local.get();for(const n in t)e.test(n)&&await s().storage.local.remove(n)}(),await async function(){const e=/(merchant-session-\d{1,5})/,t=await Te.getAllKeys();for(const n of t)"string"==typeof n&&e.test(n)&&await Te.delete(n)}(),{chrome:await mo(),indexedDB:await vo()}):{}}async function mo(){const e=s().storage.local;if(!e||!e.getBytesInUse)return{};const t=e.QUOTA_BYTES,n=await e.getBytesInUse();return{used:n,total:t,free:t-n}}async function vo(){try{const e=await navigator.storage.estimate(),t=e.quota||0,n=e.usageDetails?.indexedDB||e.usage||0;return{used:n,total:t,free:t-n}}catch{return{}}}const yo=["CaptureOrderPage","OCPDOMCapture"];class bo{constructor(e){this.messageTracking=Object.fromEntries(yo.map((e=>[e,{}]))),this.deps=e}attachHandlers(){T.extension.attachEvent("CaptureOrderPage",this.handleCaptureOrderPage.bind(this)),T.extension.attachEvent("OCPDOMCapture",this.handleOCPDOMCapture.bind(this)),T.browser.attachEvent(T.browser.DOCUMENTCOMPLETE,this.fnTabHandler.bind(this)),T.browser.attachEvent(T.browser.TABCLOSED,this.fnTabHandler.bind(this))}handleCaptureOrderPage({url:e,tabId:t,data:n}){if(this.deps.isLoggingDisabled()||this.isMessageDuplicate("CaptureOrderPage",t,e))return;const{storeName:i,storeId:r,session:s}=n.merchant;this.postData(this.deps.captureOrderUrl,{},{tenant_id:this.deps.tenantId,source_name:"toolbar",store_name:i,store_id:r,shopping_trip_id:s.shoppingTrip.ttn,rr_member_id:this.deps.getMemberId(),content_source:e,content_type:"order confirmation",content_format:"html",client_type:this.deps.browserName,client_version:this.deps.clientVersion,content:n.content,load_time:n.load_time,javascript_error:n.javascript_error})}handleOCPDOMCapture({url:e,tabId:t,data:n}){if(this.deps.isLoggingDisabled()||this.isMessageDuplicate("OCPDOMCapture",t,e))return;const{storeName:i,storeId:r,session:s}=n.merchant,a=this.deps.getEBToken();if(this.deps.fillrOCPDOMUploadUrl&&a){const e={"x-dev-key":this.deps.domUploadDevKey,ebtoken:a};this.postData(this.deps.fillrOCPDOMUploadUrl,e,{tracking_ticket:s.shoppingTrip.ttn,store_id:r,store_name:i,tenant_id:this.deps.tenantId,content_type:"text/html",content_format:"html",content_source:"browser-form",client_type:this.deps.browserName,source_name:"toolbar",user_agent:this.deps.userAgent,client_version:this.deps.clientVersion,content:n.content})}}isMessageDuplicate(e,t,n){return!(!this.messageTracking[e][t]||this.messageTracking[e][t]!==n)||(this.messageTracking[e][t]=n,!1)}async postData(e,t={},n){const i=await async function(e){return(0,(await r.e(404).then(r.bind(r,3075))).gzip)(e)}(JSON.stringify(n));return await he(e,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip",...t},body:i})}fnTabHandler({url:e,tabId:t}){yo.forEach((n=>{this.messageTracking[n][t]&&e!==this.messageTracking[n][t]&&delete this.messageTracking[n][t]}))}}const wo=new class extends me{_id="np-domains";UPDATE_INTERVAL=864e5;get url(){return Oe(B.SETTINGS_NP_DOMAINS)}async getDomains(){const e=await is(this.load(),[]),t=(await r.e(689).then(r.t.bind(r,28689,19))).default??[];return new Set(t.concat(e))}},Eo="np-domains-last-visit";let Ao,xo;class To extends Pi{data=null;constructor(){super("susi-modal"),this.handleWindowFocusChanged=this.onWindowFocusChanged.bind(this),this.handleWindowRemoved=this.onWindowRemoved.bind(this),this.init()}async init(){this.data=await this.load(),this.data&&this.createListeners()}createListeners(){this.data?.unfocused||s().windows.onFocusChanged.addListener(this.handleWindowFocusChanged),s().windows.onRemoved.addListener(this.handleWindowRemoved),s().cookies.onChanged.addListener(this.onCookieChanged.bind(this))}onCookieChanged(e){const t=Me.get("domain"),{cookie:n}=e;n.domain.includes(t)&&"euid"===n.name&&self.EBATES.validateUserToken()}async onWindowFocusChanged(e){await Oi(100),this.data&&e!==s().windows.WINDOW_ID_NONE&&this.data?.windowId!==e&&(this.data.unfocused=!0,await this.save(this.data),s().windows.onFocusChanged.removeListener(this.handleWindowFocusChanged))}async onWindowRemoved(e){if(this.data?.windowId!==e)return;let{unfocused:t,source:n,tabId:i,storeId:r}=this.data;if(self.EBATES.segment.track("Close Module",{entity_name:n}),await self.EBATES.verifyToken(),self.EBATES.loggedIn){const e=self.EBATES.merchants.get(r);if(e){let r="";if(t||"Clickable SERP"===n)i=T.browser.NEWTAB;else{const e=(await Wt.getActive()).url;e&&"about:blank"!==e&&(r=e)}e.activate({tabId:i,store_url:r,sessionAttributes:{source:n}})}else T.browser.navigate({tabId:T.browser.NEWTAB,url:Oe(B.WEB_HOME)})}this.data=null,await this.save(null),s().windows.onRemoved.removeListener(this.handleWindowRemoved),s().windows.onFocusChanged.removeListener(this.handleWindowFocusChanged),s().cookies.onChanged.removeListener(this.onCookieChanged)}async createPopupAuthWindow({url:e,storeId:t,tabId:n,source:i}){const r=new URL(e);r.search="";const a=r.toString(),o=await s().windows.getCurrent(),c=Math.round((o.width??1920)/2-240+(o.left??0)),u=Math.round((o.height??1055)/2-460+(o.top??0)),l=(await s().tabs.query({url:`${a}*`})).find((e=>e.windowId!==o.id));let h=this.data?.windowId??null;T.extension.fireEvent("activateRabSusiState",{tabId:n});try{if(l)l.windowId&&await s().windows.update(l.windowId,{focused:!0}),e!==l.url&&await s().tabs.update(l.id,{url:e}),l.windowId&&(h=l.windowId);else{h=(await s().windows.create({url:e,width:480,height:920,type:"popup",focused:!0,top:u,left:c})).id??null}this.data||this.createListeners(),this.data={windowId:h,storeId:t,tabId:n,source:i,unfocused:!1},await this.save(this.data)}catch{}}async onSignIn(){const e=Oe(B.WEB_EXTENSION_LOGIN),t=(await s().tabs.query({url:`${e}*`}))[0];if(t?.id){if((t.url??"").indexOf("merchant_id=")>0){const e=await s().windows.getLastFocused(),t=await s().tabs.query({windowId:e.id});t[0]?.id&&T.extension.fireEvent("merchant.state:change",{tabId:t[0].id})}try{await s().tabs.remove(t.id)}catch{}}}}class So extends N.EventEmitter{session_competition=null;experiments=ni;constructor({ebToken:e,toolbarId:t,anonymousId:n,region:i}){let r;if(super(),this.setMaxListeners(20),this.ebToken=e,this.toolbarId=t,this.anonymousId=n,this.region=i,e){const t=Ot(e);r=t?.mId}this.experiments.setMember({memberGuid:r,anonymousId:this.toolbarId.toString()}),this.segment=new la({key:Me.get("SEGMENT_KEY"),host:Me.get("SEGMENT_HOST")}),this.segment.anonymousId=this.anonymousId,this.segment.set({toolbarid:this.toolbarId}),this.holistic=new po({region:i}),this.holistic.setMember({anonymous_id:this.anonymousId}),this.contentRunner=new Xa,ui(),this.orderPageCaptureService=new bo({getMemberId:()=>self.EBATES.member.id,getEBToken:()=>self.EBATES.ebToken,isLoggingDisabled:()=>EBATES.settings.userSettings.get("loggingDisabled"),tenantId:Me.get("CC_TENANT_ID"),browserName:T.browser.name.toLowerCase(),clientVersion:R().version,userAgent:navigator.userAgent,domUploadDevKey:Me.get("FILLR_OCP_DOM_UPLOAD_DEVKEY"),fillrOCPDOMUploadUrl:Me.get("FILLR_OCP_DOM_UPLOAD_URL"),captureOrderUrl:B.CAPTURE_ORDER}),this.orderPageCaptureService.attachHandlers(),this.badge=new Kt,this.merchants=new $i,this.member=new ia({id:r}),this.settings=new fs,this.icon=new As,this.grouponDealsCollection=new da,this.hotelsSearch=new Ta,this.logCoupons=new Ca,this.feed=new oo,this.susiModal=new To,this.on("change:ebToken",((e,t)=>{t||this.setPopup()})),T.extension.attachEvent("acceptedTcpp",(()=>{T.extension.fireEvent("hideTcpp",{tabId:T.browser.ALLTABS})})),T.extension.attachEvent("openOptionsPage",(()=>{T.ui.settings.open()})),s().alarms.onAlarm.addListener((e=>{"Ping"===e.name&&self.EBATES.ping()})),s().alarms.get("Ping").then((e=>{e||s().alarms.create("Ping",{periodInMinutes:60})})),T.browser.attachEvent(T.browser.DOCUMENTCOMPLETE,(({url:e})=>this.handleDocumentComplete(e))),T.browser.attachEvent(T.browser.NAVIGATIONCOMMITTED,(e=>this.contentRunner.processPage(e.url,e.tabId))),T.extension.attachEvent("xfas",(e=>this.handleXfas(e)))}get ebToken(){return this._ebToken}set ebToken(e){if(this._ebToken!==e){const t=this._ebToken;this._ebToken=e,this.emit("change:ebToken",e,t),T.extension.setItem("ebToken",e)}}get loggedIn(){return!!this.ebToken}async init(){await this.validateUserToken(),this.setPopup();try{await this.settings.load(),await this.settings.fetch()}catch{}this.badge.init(),await mi.init(),await Bi.fetch(),this.merchants.fetch().then((()=>{T.extension.fireEvent("merchant.state:change")})).catch((()=>{})),this.settings.userSettings.toggleLogging(),this.setUninstallURL(),zt(this.settings.standDown)}setPopup(){this.ebToken?(this.member.isGatingStatusBlocked()||(T.ui.button.detachEvent(T.ui.button.CLICK,this.buttonOnClicked),T.ui.button.setPopup({url:"./popup.html"})),qt()):(T.ui.button.setPopup(),T.ui.button.detachEvent(T.ui.button.CLICK,this.buttonOnClicked),T.ui.button.attachEvent(T.ui.button.CLICK,this.buttonOnClicked))}buttonOnClicked(e){self.EBATES.login(e)}setDomain(e){const t="^([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$",n="^https?:\\/\\/([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$";for(const[i,r]of Object.entries(e))if("domain"===i){if(!new RegExp(t).test(r))throw new Error(`Invalid url for property ${i}. Does not match with RegExp "${t}"`)}else{if(!new RegExp(n).test(r))throw new Error(`Invalid url for property ${i}. Does not match with RegExp "${n}"`)}for(const[t,n]of Object.entries(e))T.extension.setItem(t,n),B[t]&&(B[t]=n);this.settings.affiliates.activationRegexs()}async handleXfas(e){let{shoppingURL:t,storeURL:n,wid:i,sessionAttributes:r,campaignId:s,tabId:a,eeid:o,channel:c}=e.data;const u=oe(t,{response:"json",store_url:n,sourceName:i||$e,tracking_campaign_id:s,channel:c||st.DEFAULT,eeid:o||23509,tb_v:R().version,ebtoken:this.ebToken??"",visit_id:this.holistic.visit_id});if(a===T.browser.NEWTAB){a=(await T.browser.navigate({url:"about:blank",tabId:T.browser.NEWTAB})).id}else a=e.tabId;this.settings.affiliates.match(u,a);const{data:l}=await he(u),h=l?.ticket[0];if(h?.storeId){const e=h.trackingNumber;this.settings.affiliates.activations.addParameters(a,{trackingTicketNumber:e});this.merchants.get(h.storeId).session.shoppingTrip.addPendingAttributes({type:"silent",...r}),await T.browser.navigate({tabId:a,url:h.link[0]["@href"].replace(/wid=.*?&/,`wid=${i}&`)})}}async handleDocumentComplete(e){if(!e)return;const t=Oe(B.BASE);e.startsWith(t)&&await this.validateUserToken(),async function(e){const t=Bs(e);if(t&&ve.get("trackNP")&&self.EBATES&&(xo||(xo=await wo.getDomains()),t&&xo.has(t))){if(Ao||(Ao=await Te.get(Eo)||new Map),Ao.forEach(((e,t)=>{e+18e5<Date.now()&&Ao.delete(t)})),!Ao.has(t)){self.EBATES.segment.track("Visit NP Page",{host:t});const e=`https://${t}`;self.EBATES.holistic.track(je.WebsiteVisited,{data:{website_visit_id:D()},url:e})}Ao.set(t,Date.now()),Te.set(Eo,Ao)}}(e)}async ping(){const e=await T.extension.getItem("ga_usage"),t=new Date(parseInt(e||0,10)),n=new Date;n.toDateString()!==t.toDateString()&&(T.extension.setItem("ga_usage",n.getTime().toString()),this.trackApplicationDetected())}trackApplicationDetected(){return async function(){const e=self.EBATES,{isOnToolbar:t}=await(s().action?.getUserSettings())??{},n=await s().permissions.contains({permissions:["notifications"]})?"yes":"no",{installDate:i,installationSource:r,installSessionId:a}=await T.extension.getItem(["installDate","installationSource","installSessionId"]),o=await T.extension.getItem("browser_info"),c=await Pe(Me.get("domain"),"eutid"),u=o?{dark_mode:o.darkMode,screen_size:o.screenSize,browser_size:o.browserSize}:void 0;e.segment.track("Heartbeat Application",{anon_id:e.anonymousId,browser_info:{...o,pinned:t,desktop_notification_optin:n},install_info:{source:r,install_desktop_session_id:a},member_info:{isAmexUser:e.member.get("isAmexUser"),isBiltUser:e.member.get("isBiltUser"),eutid:c},storage:await go()}),e.holistic.track(je.ApplicationDetected,{data:{pinned:t,application_subtype:"Toolbar",desktop_notification_optin:n,application_installed_at_millis:i,installation_source:r,installation_session_id:a,browser_info:u}})}()}onTokenExpired(){this.member.unset("accessLevel")}async verifyToken(){const e=await Pe(Me.get("domain"),"euid"),t=Ot(e);if(!e||!t)return!1;!this.ebToken&&e&&this.susiModal.onSignIn();const n=Ot(this.ebToken);return(t.mId!==n?.mId||t.llt!==n?.llt)&&(!(n?.llt&&n.mId&&!t.llt&&t.mId===n.mId)&&(this.ebToken=e,t.mId!==n?.mId&&(we.info("login",t),!0)))}async validateUserToken(){if(await this.verifyToken()){this.member.clearCache(),this.member.set("accessLevel",1,{silent:!0}),this.member.saveCache();try{await this.member.fetch({reset:!0})}catch{}}}setUninstallURL(){new Promise(((e,t)=>{s().management?.getSelf?s().management.getSelf().then((n=>{"normal"===n.installType?e():t()})):e()})).then((()=>{if(s().runtime.setUninstallURL){const e=EBATES.settings.installedExtensions?.getInstalledExtensions().toString(),t=ae(Oe(B.WEB_UNINSTALL),{ext:e});s().runtime.setUninstallURL(t)}})).catch((()=>{}))}set(e,t){T.extension.setItem(e,t)}async login({data:e={},name:t,tabId:n,url:i}){let r=T.browser.NEWTAB,s="",a=e.merchant;!a&&i&&await ni.get(Bt)&&(a=self.EBATES.merchants.match(i,r)?.toJSON());const o="getLogonForm"===e.name,c="GBR"===Me.region,u=a?.storeId,l=e.source??"Badge",h=e.store_url,d=["Badge","Clickable SERP","Hover","RAB","Expanded RAB","Cart Reminder"].includes(l)&&2!==a?.activationCode&&await ni.activate(Bt,{storeId:u,placement:l});o||c||await ni.get(St)?(s=Oe(B.WEB_LOGON_FORM),u&&(s=oe(a.shoppingURL,{tb:"yes",sourceName:$e,eeid:23509,visit_id:this.holistic.visit_id,store_url:h}),r=e.tabId??T.browser.CURRENTTAB)):(s=Oe(d?B.WEB_EXTENSION_LOGIN:B.WEB_LOGIN),u&&(s=oe(s,{merchant_id:a.storeId}),r=e.tabId??T.browser.CURRENTTAB)),this.segment.track("Visit Page",{preceding_screen_name:e.preceding_screen_name||"ButtonClick"===t?"Icon":l,url:s,type:e.type}),l&&(s=ae(s,{special:l})),d?(this.susiModal.createPopupAuthWindow({url:s,storeId:u,tabId:n,source:l}),this.segment.track("View Module",{module_type:"SUSI Modal",entity_name:l})):T.browser.navigate({url:s,tabId:r})}async switchLocale(e){return Me.saveLocale(e)}}self.document||(self.document=void 0),self.EbatesPromise=async function(){const e=await T.extension.getItem(["domain","api","member_api","staticCDN","productCDN"]);for(const[t,n]of Object.entries(e))T.extension.setItem(t,n),B[t]&&(B[t]=n);const t=await T.extension.getItem(["toolbarId","installVersion","installDate","currentVersion","uiid","region","ebToken"]);let{uiid:n,region:i,ebToken:r}=t;n||(n=D(),T.extension.setItem("uiid",n));let a,o,c=0,u=!1,l=!1;const h=R().version;return t.toolbarId?(t.currentVersion!==h&&(T.extension.setItem("currentVersion",h),l=!0,i||(i=await Me.migrateRegionStorage())),c=t.toolbarId,a=t.installVersion||"4.0.0.0",o=t.installDate):(u=!0,i||(i=await Me.detectRegion()),c=Math.floor(1e9*Math.random()),a=h,o=Date.now(),T.extension.setItem("toolbarId",c),T.extension.setItem("installDate",o),T.extension.setItem("installVersion",a),T.extension.setItem("currentVersion",a),T.extension.setItem("notification-explanation",0)),we.setGlobalContextProperty("region",i),we.setGlobalContextProperty("button",{toolbarId:c,version:h,installVersion:a}),await Me.setRegion(i),await ve.init(),await ni.init(),self.EBATES=new So({ebToken:r,toolbarId:c,anonymousId:n,region:i}),await self.EBATES.init(),o&&self.EBATES.segment.set({app_install_ts:o}),l&&self.EBATES.segment.track("Update Application"),function(e,t){const n=Me.get("domain");try{s().cookies?.set({domain:n,url:Oe(B.BASE),name:"toolbarId",value:e.toString()}),s().cookies?.set({domain:n,url:Oe(B.BASE),name:"toolbarRegion",value:t})}catch(e){}}(c,i),u&&(await Fe(),self.EBATES.ping()),self.EBATES}(),T.extension.attachEvent("login",(e=>self.EBATES.login(e))),T.extension.attachEvent("encodeImageURI",(async function({data:e,url:t}){const{fileName:n,force:i}=e,r=ve.variation("encodeImageDomains")?.domains,s=Le(t)??"";if(i||r&&r.includes(s)){const e=e=>fetch(e).then((e=>e.blob())).then((e=>new Promise(((t,n)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=n,i.readAsDataURL(e)}))));try{const t=await e(n);return 0!==t.indexOf("data:text/plain;base64")?t:null}catch{return null}}return n})),T.extension.attachEvent("getProductCatalogDetails",(async function({data:e}){const{merchant:t,detail:n}=e;return async function({merchant:e,detail:t}){const n=Oe(B.PRODUCT_METADATA,{storeId:e.storeId}),i=[];for(const e of["sku","model","mpn","productID"])t[e]?.[0]&&i.push(t[e]?.[0]);const{data:r}=await he(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({store_id:String(e.storeId),product_ids:i,product_url:t.url[0]||t.canonical[0]})}),s=r?.data?.[0];return s?function({listing_id:e,brand_name:t,category_id:n,category_ids:i,category_name:r,category_name_path:s,image_url:a,is_refurbished:o,list_price:c,sale_price:u,product_url:l,store_id:h,store_name:d,group_id:f,shipping_cost:p,...g}){return{listingId:e,brandName:t,categoryId:n,categoryIds:i,categoryName:r,categoryNamePath:s,imageUrl:`https://product-image.ebates.com${a}`,isRefurbished:o,listPrice:c,salePrice:u,productUrl:l,storeId:h,storeName:d,groupId:f,shippingCost:p,...g}}(s):null}({merchant:t,detail:n})}));const _o=new Map;T.extension.attachEvent("getContent",(async({data:e})=>{const{file:t}=e;if(_o.has(t))return _o.get(t);{const e=await fetch(t);let n=await e.text();return n=n.replace(/chrome-extension:\/\/__MSG_%40@extension_id__\//g,s().runtime.getURL("")),_o.set(t,n),n}})),T.extension.attachEvent("getMerchantSession",(async({data:e})=>{const t=await self.EbatesPromise;await t.merchants.ready();const n=t.merchants.get(e.storeId);if(n){const e=n.session.toJSON(),t=await n.getReward();return{session:e,...n.processCode(t),reward:t}}return{}})),T.extension.attachEvent("matchDomain",(async({data:{url:e}})=>{const t=await self.EbatesPromise;await t.merchants.ready();const n=await Wt.getActive(),i=t.merchants.match(e,n.tabId);return i?{storeId:i.id}:null})),T.extension.attachEvent("ISC",(async({data:e})=>{const t=await self.EbatesPromise;return await t.member.iscb.getOffers(e)})),T.browser.attachEvent(T.browser.DOCUMENTCOMPLETE,(0,P.throttle)((async()=>{(await self.EbatesPromise).emit("SyncTick")}),15e3))})(),source={}})()}catch(e){Promise.reject(e)}