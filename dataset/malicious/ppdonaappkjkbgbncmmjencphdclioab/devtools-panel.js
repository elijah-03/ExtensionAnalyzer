"use strict";let lastFilterQuery=null;function generateFilter(e,t){let r=e.url.replace(/^[\w-]+:\/+(?:www\.)?/,"||"),a=[];return"POPUP"==e.type&&(a.push("popup"),"about:blank"==e.url&&(t=!0)),t&&a.push("domain="+e.docDomain),a.length>0&&(r+="$"+a.join(",")),r}function createActionButton(e,t,r){let a=document.createElement("span");return a.textContent=t,a.classList.add("action"),a.addEventListener("click",(()=>{ext.backgroundPage.sendMessage({type:"filters."+e,text:r})}),!1),a}function createRecord(e,t,r){let a=document.importNode(r,!0);a.dataset.type=e.type,a.querySelector(".domain").textContent=e.docDomain,a.querySelector(".type").textContent=e.type;let n=a.querySelector(".url"),s=a.querySelector(".action-wrapper");if(e.url&&(n.textContent=e.url,"POPUP"!=e.type&&(n.classList.add("resourceLink"),n.addEventListener("click",(()=>{ext.devtools.panels.openResource(e.url)}),!1))),t){let r=a.querySelector(".filter"),n=a.querySelector(".origin");r.textContent=t.text,a.dataset.state=t.whitelisted?"whitelisted":"blocked",t.subscription?n.textContent=t.subscription:(t.userDefined?n.textContent="user-defined":n.textContent="unnamed subscription",n.classList.add("unnamed")),t.whitelisted||"ELEMHIDE"==e.type||s.appendChild(createActionButton("add","Add exception","@@"+generateFilter(e,!1))),t.userDefined&&s.appendChild(createActionButton("remove","Remove rule",t.text))}else s.appendChild(createActionButton("add","Block item",generateFilter(e,e.specificOnly)));return lastFilterQuery&&shouldFilterRow(a,lastFilterQuery)&&a.classList.add("filtered-by-search"),a}function shouldFilterRow(e,t){let r=[e.getElementsByClassName("url"),e.getElementsByClassName("filter"),e.getElementsByClassName("origin"),e.getElementsByClassName("type")];for(let e of r)for(let r of e)if(-1!=r.innerText.search(t))return!1;return!0}function performSearch(e,t){for(let r of e.rows)shouldFilterRow(r,t)?r.classList.add("filtered-by-search"):r.classList.remove("filtered-by-search")}function cancelSearch(e){for(let t of e.rows)t.classList.remove("filtered-by-search")}document.addEventListener("DOMContentLoaded",(()=>{let e=document.getElementById("items"),t=e.querySelector("tbody"),r=document.querySelector("template").content.firstElementChild;document.getElementById("reload").addEventListener("click",(()=>{ext.devtools.inspectedWindow.reload()}),!1),document.getElementById("filter-state").addEventListener("change",(t=>{e.dataset.filterState=t.target.value}),!1),document.getElementById("filter-type").addEventListener("change",(t=>{e.dataset.filterType=t.target.value}),!1),ext.onMessage.addListener((a=>{switch(a.type){case"add-record":t.appendChild(createRecord(a.request,a.filter,r));break;case"update-record":let n=t.getElementsByTagName("tr")[a.index],s=createRecord(a.request,a.filter,r);n.parentNode.replaceChild(s,n),s.classList.add("changed"),e.classList.add("has-changes");break;case"remove-record":let l=t.getElementsByTagName("tr")[a.index];l.parentNode.removeChild(l),e.classList.add("has-changes");break;case"reset":t.innerHTML="",e.classList.remove("has-changes")}})),window.addEventListener("message",(e=>{switch(e.data.type){case"performSearch":performSearch(t,e.data.queryString),lastFilterQuery=e.data.queryString;break;case"cancelSearch":cancelSearch(t),lastFilterQuery=null}}));let a=chrome.devtools.panels.themeName||"default";document.body.classList.add(a)}),!1);