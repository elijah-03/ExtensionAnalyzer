try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="dc58de0d-2500-4533-be9d-621c64cc7ea5",e._sentryDebugIdIdentifier="sentry-dbid-dc58de0d-2500-4533-be9d-621c64cc7ea5")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"4.43.1"};(self.webpackChunk=self.webpackChunk||[]).push([[8896],{88896:(e,t,n)=>{n.r(t),n.d(t,{LtQbGcAdapter:()=>In,PreferredMode:()=>he});var r=n(86080),o=n(32009);function i(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,u,"next",e)}function u(e){i(a,r,o,s,u,"throw",e)}s(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var l,f,d,h,p,g,v=function(){var e,t;function n(){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");u(this,"setCoreConfig",void 0),u(this,"setHttpClient",void 0),u(this,"setLoggerClient",void 0),u(this,"computeGrammarCheck",void 0),u(this,"recommendation",void 0),u(this,"setTrackerClient",void 0),u(this,"setStorageClient",void 0),u(this,"setEventCallback",void 0),u(this,"storeSentenceForSkippingCheck",void 0),u(this,"detectLanguageFromGCCore",void 0),this.setCoreConfig=r.setConfig,this.computeGrammarCheck=r.computeGrammarCheck,this.recommendation=r.recommendation,this.setHttpClient=r.setHTTPClient,this.setLoggerClient=r.setLoggerClient,this.setStorageClient=r.setStorageClient,this.storeSentenceForSkippingCheck=r.storeSentenceForSkippingCheck,this.setTrackerClient=r.setTrackerClient,this.detectLanguageFromGCCore=r.detectLanguage,this.setEventCallback=r.setEventCallback}return e=[{key:"getLanguage",value:function(){return a(function(){return c(this,function(e){return[2,(0,r.getConfig)("INPUT_LANGUAGE")]})})()}},{key:"getConfig",value:function(e){return a(function(){return c(this,function(t){return[2,(0,r.getConfig)(e)]})})()}},{key:"getRegionalLanguage",value:function(){return a(function(){return c(this,function(e){return[2,(0,r.getConfig)("REGIONAL_LANGUAGE")]})})()}},{key:"getIsPremium",value:function(){return a(function(){return c(this,function(e){return[2,(0,r.getConfig)("IS_PREMIUM_USER")]})})()}},{key:"setGCStorageClient",value:function(e){return a(function(){return c(this,function(t){return this.setStorageClient(e),[2]})}).call(this)}},{key:"setGCEventCallback",value:function(e){return a(function(){return c(this,function(t){return this.setEventCallback(e),[2]})}).call(this)}},{key:"setGCHttpClient",value:function(e){return a(function(){return c(this,function(t){return this.setHttpClient(e),[2]})}).call(this)}},{key:"setGCTrackerClient",value:function(e){return a(function(){return c(this,function(t){return this.setTrackerClient(e),[2]})}).call(this)}},{key:"setGCLoggerClient",value:function(e){return a(function(){return c(this,function(t){return this.setLoggerClient(e),[2]})}).call(this)}},{key:"setGCCoreConfig",value:function(e,t){return a(function(){return c(this,function(n){return this.setCoreConfig(e,t),[2]})}).call(this)}},{key:"getComputeGrammarCheck",value:function(e,t,n,r,o,i){return a(function(e,t,n,r,o){var i,a,s,u,l,f,d,h,p,g=arguments;return c(this,function(c){switch(c.label){case 0:return i=g.length>5&&void 0!==g[5]?g[5]:null,a=g.length>6&&void 0!==g[6]&&g[6],s=g.length>7&&void 0!==g[7]?g[7]:-1,u=g.length>8&&void 0!==g[8]&&g[8],l=g.length>9&&void 0!==g[9]&&g[9],f=g.length>10&&void 0!==g[10]?g[10]:"",d=g.length>11&&void 0!==g[11]?g[11]:void 0,h=g.length>12&&void 0!==g[12]?g[12]:{},p=g.length>13?g[13]:void 0,[4,this.computeGrammarCheck(e,t,n,r,o,i,a,s,u,l,f,d,h,p)];case 1:return[2,c.sent()]}})}).apply(this,arguments)}},{key:"forceRecommendation",value:function(e){return a(function(e){var t,n=arguments;return c(this,function(r){switch(r.label){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:{},[4,this.recommendation(e,t)];case 1:return[2,r.sent()]}})}).apply(this,arguments)}},{key:"setSentenceForSkippingCheck",value:function(e){return a(function(){return c(this,function(t){switch(t.label){case 0:return[4,this.storeSentenceForSkippingCheck(e)];case 1:return[2,t.sent()]}})}).call(this)}},{key:"detectLanguageFromText",value:function(e,t){return a(function(){return c(this,function(n){return[2,this.detectLanguageFromGCCore(e,t)]})}).call(this)}}],t=[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}],e&&s(n.prototype,e),t&&s(n,t),n}();u(v,"instance",void 0);var m=v.getInstance();function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e){if(e){if("string"==typeof e)return y(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _=function(e){var t=[65279,160],n=0;if(0===e.length)return n;for(var r=0;r<e.length;r+=1){var o=e.charCodeAt(r);t.includes(o)||(n=(n<<5)-n+o,n&=n)}return n},S=function(e){for(var t=[],n=0;n<(null==e?void 0:e.length);n++){var r=e[n],o={paraID:"".concat(_((r.text||"")+n)),id:"gc-editor",text:r.text,startIndex:r.offset,endIndex:r.offset+r.text.length-1,paraType:"text",fontSize:"14px",sentences:[],rteMap:null==r?void 0:r.rteMap};t.push(o)}return t},C={"en-us":"English (US)","de-de":"German (Germany)","pt-br":"Portuguese (Brazil)","ca-es":"Catalan (Spain)"},E=function(e,t){return C[R(e,t)]||"English (US)"},R=function(e,t){return t?"".concat((e||"en").toLowerCase(),"-").concat(t.toLowerCase()):e},I={log:console.log,info:console.info,warn:console.warn,error:console.error},w={English:"EN",German:"DE",French:"FR",Spanish:"ES",Portuguese:"PT",Swiss_German:"DE-CH",Dutch:"NL"},O=[{code:w.Dutch,name:"Dutch"},{code:w.English,name:"English"},{code:w.French,name:"French"},{code:w.German,name:"German"},{code:w.Swiss_German,name:"German (Swiss)"},{code:w.Portuguese,name:"Portuguese (Brazilian)"},{code:w.Spanish,name:"Spanish"}],x={"\xa0":" "};function P(e){for(var t="",n=0;n<e.length;n++)e[n]in x?t+=x[e[n]]:t+=e[n];return t}function T(e){try{var t=new URL(e);if(e.startsWith("https://docs.google.com/")){var n=function(e){var t=e.split("/");if(t.length>3&&"docs.google.com"===t[2]){var n=t[3];return null!=n?n:""}return""}(e);return n?t.origin+"/"+n:t.origin}return t.origin}catch(t){return e}}function k(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function D(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){k(i,r,o,a,s,"next",e)}function s(e){k(i,r,o,a,s,"throw",e)}a(void 0)})}}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var j=function(){var e,t;function n(){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");this._initializeGCCore()}return e=[{key:"_initializeGCCore",value:function(){m.setGCLoggerClient(I)}},{key:"setConfig",value:function(e,t){return D(function(){return L(this,function(n){return m.setGCCoreConfig(e,t),[2]})})()}},{key:"setLanguage",value:function(e){return D(function(){return L(this,function(t){switch(t.label){case 0:return[4,m.getLanguage()];case 1:return t.sent()===e?[3,3]:[4,m.setGCCoreConfig("INPUT_LANGUAGE",e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})()}},{key:"setGCHttpClient",value:function(e){return D(function(){return L(this,function(t){return m.setGCHttpClient(e),[2]})})()}},{key:"setGCTrackerClient",value:function(e){return D(function(){return L(this,function(t){return m.setGCTrackerClient(e),[2]})})()}},{key:"setLoggerClient",value:function(e){return D(function(){return L(this,function(t){return m.setGCLoggerClient(e),[2]})})()}},{key:"setStorageClient",value:function(e){return D(function(){return L(this,function(t){return m.setGCStorageClient(e),[2]})})()}},{key:"setEventCallback",value:function(e){return D(function(){return L(this,function(t){return m.setGCEventCallback(e),[2]})})()}},{key:"setRegionalLanguage",value:function(e){return D(function(){return L(this,function(t){switch(t.label){case 0:return[4,m.getRegionalLanguage()];case 1:return t.sent()===e?[3,3]:[4,m.setGCCoreConfig("REGIONAL_LANGUAGE",e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})()}},{key:"setIsPremium",value:function(e){return D(function(){return L(this,function(t){switch(t.label){case 0:return[4,m.getIsPremium()];case 1:return"true"===t.sent()===e?[3,3]:[4,m.setGCCoreConfig("IS_PREMIUM_USER","".concat(e))];case 2:t.sent(),t.label=3;case 3:return[2]}})})()}},{key:"getIsPremium",value:function(){return D(function(){return L(this,function(e){return[2,m.getIsPremium()]})})()}},{key:"getInputLanguage",value:function(){return D(function(){return L(this,function(e){return[2,m.getLanguage()]})})()}},{key:"getRegionalLangauge",value:function(){return D(function(){return L(this,function(e){return[2,m.getRegionalLanguage()]})})()}},{key:"setPremium",value:function(e){m.setGCCoreConfig("IS_PREMIUM_USER","".concat(e))}},{key:"grammarCheck",value:function(e,t,n,r){return D(function(){var o;return L(this,function(i){return o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){M(e,t,n[t])})}return e}({"qb-Product":"GRAMMAR_CHECKER"},e.header),[2,m.getComputeGrammarCheck(e.prevState,e.currentState,e.gcParams,t,n,e.signal,e.hasUserAcceptedSuggestion,e.changedParagraphsSentencesLength,e.shouldCallRecommendation,e.appliedFixAll,e.writingGoal,e.quickFixEnabled,o,r)]})})()}},{key:"forceRecommendation",value:function(e){return D(function(e){var t,n=arguments;return L(this,function(r){return t=n.length>1&&void 0!==n[1]?n[1]:{},[2,m.forceRecommendation(e,t)]})}).apply(this,arguments)}},{key:"detectLanguageFromText",value:function(e,t){return D(function(){return L(this,function(n){return[2,m.detectLanguageFromText(e,t)]})})()}},{key:"storeSentenceForSkippingCheck",value:function(e){return D(function(){return L(this,function(t){return[2,m.setSentenceForSkippingCheck(e)]})})()}}],t=[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}],e&&A(n.prototype,e),t&&A(n,t),n}();function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function F(e){return function(e){if(Array.isArray(e))return G(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e){if(e){if("string"==typeof e)return G(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}M(j,"instance",void 0);var N=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"_defaultLTResponse",value:function(){return{language:{name:"",code:"",detectedLanguage:{name:"",code:"",confidence:0,source:""}},matches:[],sentenceRanges:[],extendedSentenceRanges:[]}}},{key:"_createLanguageObject",value:function(e,t,n){return{name:e,code:t,detectedLanguage:{name:e,code:t,confidence:n,source:""}}}},{key:"_createSentenceRanges",value:function(e){return e.sentences.map(function(e){return[e.start,e.end]})}},{key:"_createExtendedSentenceRanges",value:function(e,t,n){return e.sentences.map(function(e){var r={from:e.start,to:e.end,detectedLanguages:[{language:t,rate:0}]};return n&&(r.checkStatus=n(e)),r})}},{key:"_getGrammarMatches",value:function(e,t){var n,r=this,o=[];return null==e||null==(n=e.sentences)||n.forEach(function(e){var n,i,a,s,u,c=(null==e||null==(n=e.grammarResponse)?void 0:n.modelID)||"",l=(null==e||null==(i=e.grammarResponse)?void 0:i.discriminatorID)||"",f=(null==e||null==(a=e.grammarResponse)?void 0:a.explainerID)||"";null==e||null==(u=e.grammarResponse)||null==(s=u.contentToReplace)||s.forEach(function(e){if(!r._isReplacementInvalid(e)&&!e.isSuppressed){var n=r._createLTMatch(e,t,c,l,f);o.push(n)}})}),o}},{key:"_isReplacementInvalid",value:function(e){var t=""===(null==e?void 0:e.replacementWord),n=""===(null==e?void 0:e.originalWord),r=P(null==e?void 0:e.replacementWord)===P(null==e?void 0:e.originalWord);return t&&n||r}},{key:"_createLTMatch",value:function(e,t,n,r,o){var i,a,s,u,c,l=(null==(i=e.explainers)?void 0:i[0])||{},f=(null==(a=l.multiple_spelling_suggestion)?void 0:a.filter(function(t){return t!==e.originalWord}))||[],d=this._getIssueType(e,l),h=this._getRuleType(e,d);return c="style"===d?(null==e||null==(s=e.suggestedWords)?void 0:s.suggestions.map(function(e){return{value:e||"",shortDescription:""}}))||[]:[{value:(null==e?void 0:e.replacementWord)||"",shortDescription:""}].concat(F(f.map(function(e){return{value:e||"",shortDescription:""}}))),{message:l.user_explanation||"",shortMessage:l.category||"",upsellShortMessage:"",goodExample:l.good_example||"",badExample:l.bad_example||"",replacements:c,offset:null==e?void 0:e.startIndex,length:(null==e?void 0:e.endIndex)-(null==e?void 0:e.startIndex)+1,type:{typeName:l.type||""},rule:{id:h,description:l.example_summary||"",issueType:d,urls:[{value:""}],category:{id:null!=(u=l.error_type_id)?u:"",name:l.title||""},isPremium:t,confidence:0,operation:l.operation||"",modelId:n||"",discriminatorID:r||"",explainerID:o||"",textDiffs:l.textDiffs||[],highConfidence:(null==e?void 0:e.highConfidence)||!1,confidenceScore:(null==e?void 0:e.confidenceScore)||0},ignoreForIncompleteSentence:!1,contextForSureMatch:0}}},{key:"_getIssueType",value:function(e,t){return t.error_type_name?t.error_type_name:e.isSuggestedWord?"style":""}},{key:"_getRuleType",value:function(e,t){return e.isSpellingSuggestion?"SPELLING_RULE":t||e.originalWord+"/"+e.replacementWord}},{key:"_convertToSingleSentenceArray",value:function(e){for(var t=e.length-1;t>0;t--){var n,r=e[t-1],o=e[t];(n=r.sentences).push.apply(n,F(o.sentences)),e.splice(t,1)}return e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(z=function(){return!!e})()}var H=function(e){var t,n;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function r(){var e,t;if(!(this instanceof r))throw TypeError("Cannot call a class as a function");return t=arguments,e=W(e=r),function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,z()?Reflect.construct(e,t||[],W(this).constructor):e.apply(this,t))}return r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&q(r,e),t=[{key:"transform",value:function(e){var t,n=e.paragraphState,r=e.langData,o=e.isPremium,i=r.language,a=r.confidence,s=r.region,u=null==(t=this._convertToSingleSentenceArray(n))?void 0:t[0],c=function(e){var t=new Set,n=new Set;try{var r=!0,o=!1,i=void 0;try{for(var a,s=e.sentences[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u,c,l,f=a.value;null==f||null==(c=f.grammarResponse)||null==(u=c.contentToReplace)||u.forEach(function(e){e.modelID&&""!==e.modelID.trim()&&"NA"!==e.modelID.trim()&&t.add(e.modelID)}),(null==f||null==(l=f.grammarResponse)?void 0:l.modelID)&&""!==f.grammarResponse.modelID.trim()&&"NA"!==f.grammarResponse.modelID.trim()&&n.add(f.grammarResponse.modelID)}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return t.size>0?b(t):b(n)}catch(e){return[]}}(u),l=E(i,s),f=R(i,s),d=this._defaultLTResponse();return d.language=this._createLanguageObject(l,f,a),d.sentenceRanges=this._createSentenceRanges(u),d.extendedSentenceRanges=this._createExtendedSentenceRanges(u,i,function(e){var t;return(null==e||null==(t=e.grammarResponse)?void 0:t.timedOut)?"failure":"success"}),d.matches=this._getGrammarMatches(u,void 0!==o&&o),d.metaData={textErrors:{errorModelId:c}},d}}],n=[{key:"getInstance",value:function(){return r.instance||(r.instance=new r),r.instance}}],t&&U(r.prototype,t),n&&U(r,n),r}(N);f=void 0,(l="instance")in H?Object.defineProperty(H,l,{value:f,enumerable:!0,configurable:!0,writable:!0}):H[l]=f;var V=H.getInstance();function B(){}B.prototype={diff:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.callback;"function"==typeof r&&(o=r,r={}),this.options=r;var i=this;function a(e){return o?(setTimeout(function(){o(void 0,e)},0),!0):e}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e));var s=(t=this.removeEmpty(this.tokenize(t))).length,u=e.length,c=1,l=s+u;r.maxEditLength&&(l=Math.min(l,r.maxEditLength));var f=null!=(n=r.timeout)?n:1/0,d=Date.now()+f,h=[{oldPos:-1,lastComponent:void 0}],p=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=u&&p+1>=s)return a([{value:this.join(t),count:t.length}]);var g=-1/0,v=1/0;function m(){for(var n=Math.max(g,-c);n<=Math.min(v,c);n+=2){var r,o=h[n-1],l=h[n+1];o&&(h[n-1]=void 0);var f=!1;if(l){var d=l.oldPos-n;f=l&&0<=d&&d<s}var m=o&&o.oldPos+1<u;if(f||m){if(r=!m||f&&o.oldPos+1<l.oldPos?i.addToPath(l,!0,void 0,0):i.addToPath(o,void 0,!0,1),p=i.extractCommon(r,t,e,n),r.oldPos+1>=u&&p+1>=s)return a(function(e,t,n,r,o){for(var i,a=[];t;)a.push(t),i=t.previousComponent,delete t.previousComponent,t=i;a.reverse();for(var s=0,u=a.length,c=0,l=0;s<u;s++){var f=a[s];if(f.removed){if(f.value=e.join(r.slice(l,l+f.count)),l+=f.count,s&&a[s-1].added){var d=a[s-1];a[s-1]=a[s],a[s]=d}}else{if(!f.added&&o){var h=n.slice(c,c+f.count);h=h.map(function(e,t){var n=r[l+t];return n.length>e.length?n:e}),f.value=e.join(h)}else f.value=e.join(n.slice(c,c+f.count));c+=f.count,f.added||(l+=f.count)}}var p=a[u-1];return u>1&&"string"==typeof p.value&&(p.added||p.removed)&&e.equals("",p.value)&&(a[u-2].value+=p.value,a.pop()),a}(i,r.lastComponent,t,e,i.useLongestToken));h[n]=r,r.oldPos+1>=u&&(v=Math.min(v,n-1)),p+1>=s&&(g=Math.max(g,n+1))}else h[n]=void 0}c++}if(o)!function e(){setTimeout(function(){if(c>l||Date.now()>d)return o();m()||e()},0)}();else for(;c<=l&&Date.now()<=d;){var y=m();if(y)return y}},addToPath:function(e,t,n,r){var o=e.lastComponent;return o&&o.added===t&&o.removed===n?{oldPos:e.oldPos+r,lastComponent:{count:o.count+1,added:t,removed:n,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:t,removed:n,previousComponent:o}}},extractCommon:function(e,t,n,r){for(var o=t.length,i=n.length,a=e.oldPos,s=a-r,u=0;s+1<o&&a+1<i&&this.equals(t[s+1],n[a+1]);)s++,a++,u++;return u&&(e.lastComponent={count:u,previousComponent:e.lastComponent}),e.oldPos=a,s},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};var Y=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Q=/\S/,K=new B;K.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!Q.test(e)&&!Q.test(t)},K.tokenize=function(e){for(var t=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&Y.test(t[n])&&Y.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t};var $=new B;function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}$.tokenize=function(e){this.options.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));var t=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var o=n[r];r%2&&!this.options.newlineIsToken?t[t.length-1]+=o:(this.options.ignoreWhitespace&&(o=o.trim()),t.push(o))}return t},(new B).tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)},(new B).tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};var X=Object.prototype.toString,Z=new B;Z.useLongestToken=!0,Z.tokenize=$.tokenize,Z.castInput=function(e){var t=this.options,n=t.undefinedReplacement,r=t.stringifyReplacer,o=void 0===r?function(e,t){return void 0===t?n:t}:r;return"string"==typeof e?e:JSON.stringify(function e(t,n,r,o,i){for(n=n||[],r=r||[],o&&(t=o(i,t)),a=0;a<n.length;a+=1)if(n[a]===t)return r[a];if("[object Array]"===X.call(t)){for(n.push(t),s=Array(t.length),r.push(s),a=0;a<t.length;a+=1)s[a]=e(t[a],n,r,o,i);return n.pop(),r.pop(),s}if(t&&t.toJSON&&(t=t.toJSON()),"object"===J(t)&&null!==t){n.push(t),s={},r.push(s);var a,s,u,c=[];for(u in t)t.hasOwnProperty(u)&&c.push(u);for(c.sort(),a=0;a<c.length;a+=1)s[u=c[a]]=e(t[u],n,r,o,u);n.pop(),r.pop()}else s=t;return s}(e,null,null,o),o,"  ")},Z.equals=function(e,t){return B.prototype.equals.call(Z,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};var ee=new B;function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ne(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){oe(e,t,n[t])})}return e}function se(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ce(e){return function(e){if(Array.isArray(e))return te(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e){if(e){if("string"==typeof e)return te(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return te(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function le(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(le=function(){return!!e})()}ee.tokenize=function(e){return e.slice()},ee.join=ee.removeEmpty=function(e){return e};var fe=function(e){var t,n;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function r(){var e,t;if(!(this instanceof r))throw TypeError("Cannot call a class as a function");return t=arguments,e=ie(e=r),function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,le()?Reflect.construct(e,t||[],ie(this).constructor):e.apply(this,t))}return r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&ue(r,e),t=[{key:"transform",value:function(e){var t,n=e.paragraphState,r=e.langData,o=e.isPremium,i=r.language,a=r.confidence,s=r.region,u=null==(t=this._convertToSingleSentenceArray(n))?void 0:t[0],c=function(e){var t=new Set,n=new Set;try{var r=!0,o=!1,i=void 0;try{for(var a,s=e.sentences[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u,c,l,f,d=a.value;null==d||null==(c=d.recommendationResponse)||null==(u=c.recommendations)||u.forEach(function(e){e.modelId&&""!==e.modelId.trim()&&t.add(e.modelId)}),(null==d||null==(l=d.recommendationResponse)?void 0:l.model_id)&&""!==d.recommendationResponse.model_id.trim()&&n.add(null==(f=d.recommendationResponse)?void 0:f.model_id)}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return t.size>0?b(t):b(n)}catch(e){return[]}}(u),l=E(i,s),f=R(i,s),d=this._defaultLTResponse();return d.language=this._createLanguageObject(l,f,a),d.sentenceRanges=this._createSentenceRanges(u),d.extendedSentenceRanges=this._createExtendedSentenceRanges(u,i),d.matches=this._getRecommendationMatches(u,void 0!==o&&o),d.metaData={textErrors:{recommendationModelId:c}},d}},{key:"_getRecommendationMatches",value:function(e,t){var n,r=this,o=[];return null==e||null==(n=e.sentences)||n.forEach(function(e){if(null==e?void 0:e.recommendationResponse){var n=r._getRecommendationLTMatches(null==e?void 0:e.recommendationResponse,t);o.push.apply(o,ce(n))}}),o}},{key:"_getRecommendationIssueType",value:function(e){return e.isPhraseLevel?"PHRASAL_RECOMMENDATION":"RECOMMENDATION"}},{key:"getTitle",value:function(e,t){var n;return t||!0===e.isLocked||!1===e.isLocked||void 0===e.isLocked&&(null==e||null==(n=e.text)?void 0:n.length)>0?e.cardName:e.upsellCardName}},{key:"_getRecommendationLTMatches",value:function(e,t){var n,r=this,o=[];return null==e||null==(n=e.recommendations)||n.forEach(function(n){var i;null==n||null==(i=n.phrases)||i.map(function(i){var a,s=n.type,u=i.originalPhrase||"",c=(null==i?void 0:i.text)||"";!r._isReplacementInvalid({originalWord:u,replacementWord:c})&&u.trim()!==c.trim()&&(t&&"RECOMMENDATION"===r._getRecommendationIssueType(n)&&0===(null==i||null==(a=i.text)?void 0:a.length)||o.push({message:i.toolTip||"",shortMessage:r.getTitle(i,t)||"",upsellShortMessage:i.upsellCardName||"",goodExample:"",badExample:"",replacements:[{value:i.text||"",htmlValue:i.textHtml||"",shortDescription:""}],offset:i.start,length:i.end-i.start,type:{typeName:""},rule:{id:s,description:"",issueType:r._getRecommendationIssueType(n),urls:[{value:""}],category:{id:i.internalErrorCategory||"",name:i.category||""},isPremium:t,confidence:0,operation:"",modelId:e.model_id||"",discriminatorID:e.discriminator_id||"",explainerID:e.explainer_id||"",textDiffs:(null==i?void 0:i.textDiffs)||[],highConfidence:!1,confidenceScore:0,isPhrase:n.isPhraseLevel,phraseDiff:i.phraseDiff||[],importanceScore:i.importanceScore||0,showInline:i.showInline||!1,isFromCache:(null==e?void 0:e._cached)||!1},isLocked:i.isLocked,ignoreForIncompleteSentence:!1,contextForSureMatch:0}))})}),o}},{key:"transformForceRecommendation",value:function(e){var t=this,n=e.recommendation,r=e.langData,o=e.isPremium,i=void 0!==o&&o,a=r.language,s=r.confidence,u=r.region,c=E(a,u),l=R(a,u),f=this._defaultLTResponse();f.language=this._createLanguageObject(c,l,s),f.sentenceRanges=n.map(function(e){var t,n;return[null!=(t=e.offset)?t:0,e.text.length+(null!=(n=e.offset)?n:0)]}),f.extendedSentenceRanges=n.map(function(e){var t,n;return{from:null!=(t=e.offset)?t:0,to:e.text.length+(null!=(n=e.offset)?n:0),detectedLanguages:[{language:a,rate:0}]}});var d=[];null==n||n.forEach(function(e){var n=t._getRecommendationLTMatches(e,i);n&&d.push.apply(d,ce(n))}),f.matches=d;var h=null==n?void 0:n.flatMap(function(e){var t;return null==(t=e.recommendations)?void 0:t.map(function(e){return e.modelId})}),p=n.map(function(e){return e.model_id});return f.metaData={textErrors:{recommendationModelId:h.length>0?h:p}},f}},{key:"transformRecommendation",value:function(e){var t;return(t=function(){var t,n,r,o,i,a,s,u,c,l,f,d,h,p,g;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(v){return t=e.res,n=e.inputPayload,r=e.language,o=e.region,i=e.confidence,a=this._defaultLTResponse(),s=E(r,o),u=R(r,o),a.language=this._createLanguageObject(s,u,i),l=(c=this._processRecommendationWSResponse(t,n,r)).sentenceRanges,f=c.extendedSentenceRanges,d=c.validSuggestions,h=c.modelIds,a.sentenceRanges=l,a.extendedSentenceRanges=f,a.matches=d,p=h.suggestions.filter(function(e){return""!==e}),g=h.rootLevel,a.metaData={textErrors:{recommendationModelId:p.length>0?p:g}},[2,a]})},function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(e){ne(i,r,o,a,s,"next",e)}function s(e){ne(i,r,o,a,s,"throw",e)}a(void 0)})}).call(this)}},{key:"_processRecommendationWSResponse",value:function(e,t,n){var r=[],o=[],i=[],a={suggestions:[],rootLevel:[]};return e.forEach(function(e){if(r.push([e.sentenceOffset.start,e.sentenceOffset.end]),o.push({from:e.sentenceOffset.start,to:e.sentenceOffset.end,detectedLanguages:[{language:n,rate:0}]}),e.suggestions&&0!==e.suggestions.length){var t,s,u,c=e.suggestions[0],l=(null==(t=c.rule)?void 0:t.textDiffs)||[];if(0===l.length&&e.text){var f,d,h,p=c.offset-e.sentenceOffset.start,g=p+c.length;f=e.text.substring(p,g),d=c.replacements[0].value,h=function(e,t){if("function"==typeof e)t.callback=e;else if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(h,{ignoreWhitespace:!0}),l=K.diff(f,d,h)}var v=se(ae({},c),{rule:se(ae({},c.rule),{textDiffs:l})});i.push(v),(null==(s=c.rule)?void 0:s.modelId)&&a.suggestions.push(c.rule.modelId),e.modelIDs&&e.modelIDs.length>0&&(u=a.rootLevel).push.apply(u,ce(e.modelIDs))}}),{sentenceRanges:r,extendedSentenceRanges:o,validSuggestions:i,modelIds:a}}},{key:"createEmptyResponsesForRemovedTexts",value:function(e){return e.map(function(e){var t,n;return{changeIndex:e.index,modelIDs:[],sentenceOffset:{start:null!=(t=e.value.offset)?t:0,end:(null!=(n=e.value.offset)?n:0)+e.value.text.length},suggestions:[],type:"sentence-suggestions-recommendation",text:e.value.text}})}}],n=[{key:"getInstance",value:function(){return r.instance||(r.instance=new r),r.instance}}],t&&re(r.prototype,t),n&&re(r,n),r}(N);oe(fe,"instance",void 0);var de=fe.getInstance(),he=((d={}).LEGACY_HTTP="legacy_http",d.WS="ws",d.WS_WITH_NON_GDOCS="ws_with_non_gdocs",d.WS_WEBAPP="ws_webapp",d);function pe(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ge(e){return"FIX_APPLIED"===e.errorCode?null:e.errorCode||"TIMEOUT"}function ve(e,t){var n,r,i=Math.max(0,((null==(r=t[e.changeIndex])||null==(n=r.text)?void 0:n.length)||0)-1);return{type:o.ChunkType.SentenceSplitter,changeIndex:e.changeIndex,editorGroupId:e.editorGroupId,editorId:e.editorId,sentenceRanges:[[0,i]],language:e.language||{name:"English (US)",code:"en-us",detectedLanguage:{name:"English (US)",code:"en-us",confidence:1,source:""}},errorCode:ge(e),checkStatus:"failure"}}function me(e,t){var n,r,i=Math.max(0,((null==(r=t[e.changeIndex])||null==(n=r.text)?void 0:n.length)||0)-1);return{type:o.ChunkType.SentenceSuggestionsGC,changeIndex:e.changeIndex,editorGroupId:e.editorGroupId,editorId:e.editorId,suggestions:[],errorCode:ge(e),sentenceOffset:{start:0,end:i}}}function ye(e){return{type:o.ChunkType.SentenceSuggestionsRecommendation,changeIndex:e.changeIndex,editorGroupId:e.editorGroupId,editorId:e.editorId,suggestions:[],sentenceOffset:{start:0,end:0},errorCode:ge(e)}}function be(e,t){if(!e)return[];var n,r,i,a;if("TIMEOUT"===e.errorCode)return n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},e),r=r={text:(null==t||null==(i=t[e.changeIndex])?void 0:i.text)||""},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}),a=n,(null==t?void 0:t[e.changeIndex])?[ve(a,t),me(a,t)]:[ye(a)];switch(e.type){case o.ChunkType.DetectLanguage:return[{name:"English (US)",code:"en-us",detectedLanguage:{name:"English (US)",code:"en-us",confidence:1,source:""}},ve(e,t),me(e,t)];case o.ChunkType.SentenceSplitter:return[ve(e,t),me(e,t)];case o.ChunkType.SentenceSuggestionsGC:return[me(e,t)];case o.ChunkType.SentenceSuggestionsRecommendation:return[ye(e)];default:return[]}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Se(e,t,n[t])})}return e}function Ee(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function Re(e){return function(e){if(Array.isArray(e))return _e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e){if(e){if("string"==typeof e)return _e(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _e(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ie=function(){var e;function t(e,n,r,o,i,a,s,u){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"paragraph-level",l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];if(!(this instanceof t))throw TypeError("Cannot call a class as a function");Se(this,"gcParaMap",{}),Se(this,"recommendationParaMap",{}),Se(this,"gcMergedObservable",void 0),Se(this,"recommendationMergedObservable",void 0),Se(this,"paragraphs",void 0),Se(this,"isGCDone",!1),Se(this,"finalizedLTResponse",{}),Se(this,"returnFromWs",void 0),Se(this,"startTime",void 0),Se(this,"_sentenceSplitterCompletedIds",new Set),Se(this,"_gcCompletedIds",new Set),Se(this,"editorId",void 0),Se(this,"resolveResponse",void 0),Se(this,"rejectResponse",void 0),Se(this,"processingConfig",void 0),Se(this,"errorModelIds",[]),Se(this,"recommendationModelIds",[]),Se(this,"_notifyClient",void 0),Se(this,"_metaData",void 0),Se(this,"_responseType",void 0),Se(this,"_ltDiffParagraphs",[]),Se(this,"handleResponseCallback",void 0),Se(this,"_emptyParaTextMap",new Set),Se(this,"_analyticsData",{numberOfSentencesProcessedForGC:0,numberOfSentencesProcessedForReco:0,errors:[]}),Se(this,"_responseOrderCounter",0),this.gcMergedObservable=e.gcMergedObservable,this.recommendationMergedObservable=e.recommendationMergedObservable,this.paragraphs=n,this.returnFromWs=r,this.startTime=o,this.editorId=i,this.processingConfig=a,this._notifyClient=s,this._metaData=u,this._sentenceSplitterCompletedIds=new Set,this._responseType=c,this._ltDiffParagraphs=l,this._createLtDiffNewLineMap()}return e=[{key:"_createLtDiffNewLineMap",value:function(){for(var e=new Set,t=0;t<this._ltDiffParagraphs.length;t++)""===this._ltDiffParagraphs[t].text&&e.add(this._ltDiffParagraphs[t].offset);this._emptyParaTextMap=e}},{key:"_getNonEmptyParagraphsCount",value:function(){return this.paragraphs.filter(function(e){return e.text.trim().length>0}).length}},{key:"calculateParagraphOffset",value:function(e){for(var t=0,n=0;n<e;n++){if("\n"===this.paragraphs[n].text){var r=this.paragraphs[n].offset;if(!this._emptyParaTextMap.has(r))continue}t+=this.paragraphs[n].text.length+2}return t}},{key:"calculateSentenceEndOffset",value:function(e,t,n,r){return e+n.slice(e,t+1).trimEnd().length+ +!!r}},{key:"transformSentenceRanges",value:function(e,t,n){var r=this;return(null==e?void 0:e.map(function(o,i){var a=i===((null==e?void 0:e.length)||0)-1;if(n&&void 0!==o[0]&&void 0!==o[1]){var s=r.calculateSentenceEndOffset(o[0],o[1],n,a);return[o[0]+t,s+t]}return[o[0]+t,o[1]+t+ +!!a]}))||[]}},{key:"transformExtendedSentenceRanges",value:function(e,t,n,r){var o=this;return(null==e?void 0:e.map(function(e,i){var a=i===t-1;if(r&&void 0!==e.from&&void 0!==e.to){var s=o.calculateSentenceEndOffset(e.from,e.to,r,a);return Ee(Ce({},e),{from:e.from+n,to:s+n,detectedLanguages:e.detectedLanguages,checkStatus:e.checkStatus})}return Ee(Ce({},e),{from:e.from+n,to:e.to+n+ +!!a,detectedLanguages:e.detectedLanguages,checkStatus:e.checkStatus})}))||[]}},{key:"transformMatches",value:function(e,t){return(null==e?void 0:e.map(function(e){var n,r=Ee(Ce({},e),{offset:e.offset+t});return(null==(n=e.rule)?void 0:n.phraseDiff)&&e.rule.phraseDiff.length>0&&(r.rule=Ee(Ce({},e.rule),{phraseDiff:e.rule.phraseDiff.map(function(e){return Ee(Ce({},e),{sourceStart:e.sourceStart+t,sourceEnd:e.sourceEnd+t,targetStart:e.targetStart+t,targetEnd:e.targetEnd+t})})})),r}))||[]}},{key:"createIndividualLtResObj",value:function(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return Ee(Ce({},e),{matches:n,language:e.language,sentenceRanges:e.sentenceRanges,extendedSentenceRanges:e.extendedSentenceRanges,metaData:Ee(Ce({},e.metaData),{textErrors:{errorModelId:o,recommendationModelId:i},paragraphId:null==(r=this.paragraphs[t])?void 0:r.id})})}},{key:"transformSentenceRangesAccToParagraphs",value:function(){for(var e=[],t=[],n=JSON.parse(JSON.stringify(this.gcParaMap)),r=0,o=0;o<this.paragraphs.length;o++){if("\n"===this.paragraphs[o].text){var i,a=this.paragraphs[o].offset;if(!this._emptyParaTextMap.has(a))continue}var s="\n"===this.paragraphs[o].text?0:this.paragraphs[o].text.length,u=n[o],c=this.transformSentenceRanges(u.sentenceRanges,r,this.paragraphs[o].text),l=this.transformExtendedSentenceRanges(u.extendedSentenceRanges,(null==(i=u.sentenceRanges)?void 0:i.length)||0,r,this.paragraphs[o].text);e=e.concat(c||[]),t=t.concat(l||[]),r=r+s+2}return{sentenceRanges:e,extendedSentenceRanges:t}}},{key:"transformResponseAccToParagraphs",value:function(){try{var e=0,t=JSON.parse(JSON.stringify(this.gcParaMap));if(0===Object.keys(t).length)return{};var n=null==(h=Object.values(t).find(function(e){return e.language}))?void 0:h.language;if(!n)throw Error("LanguageNotFound");var r={language:n,matches:[],sentenceRanges:[],extendedSentenceRanges:[],metaData:{textErrors:{errorModelId:Array.from(new Set(this.errorModelIds)),recommendationModelId:Array.from(new Set(this.recommendationModelIds))},errorInfo:[],totalChangedParagraphs:this._getNonEmptyParagraphsCount()}},i=this.transformSentenceRangesAccToParagraphs(),a=i.sentenceRanges,s=i.extendedSentenceRanges;r.sentenceRanges=a,r.extendedSentenceRanges=s;for(var u=0;u<this.paragraphs.length;u++){if("\n"===this.paragraphs[u].text){var c=this.paragraphs[u].offset;if(!this._emptyParaTextMap.has(c))continue}var l="\n"===this.paragraphs[u].text?0:this.paragraphs[u].text.length,f=this.transformMatches(t[u].matches,e),d=this.transformMatches((null==(g=this.recommendationParaMap[u])?void 0:g.matches)||[],e);if(r.matches=Re(r.matches||[]).concat(Re(f||[]),Re(d||[])),(null!=(b=null==(y=t[u].metaData)||null==(m=y.errorInfo)||null==(v=m[0])?void 0:v.totalSentences)?b:0)>0){var h,p,g,v,m,y,b,_,S,C,E,R,I,w,O=null==(S=t[u].metaData)||null==(_=S.errorInfo)?void 0:_[0],x=null==(R=this.recommendationParaMap[u])||null==(E=R.metaData)||null==(C=E.errorInfo)?void 0:C[0],P={totalSentences:(null==O?void 0:O.totalSentences)||0,totalGcErrors:null==O?void 0:O.totalGcErrors,totalRecoErrors:null==x?void 0:x.totalRecoErrors,errorCodes:Re((null==O?void 0:O.errorCodes)||[]).concat(Re((null==x?void 0:x.errorCodes)||[]))};null==(w=r.metaData)||null==(I=w.errorInfo)||I.push(P)}e=e+l+2}return this._notifyClient({eventName:o.ClientEvents.GC_MODEL_STATS,data:Ce({hostUrl:null==(p=this._metaData)?void 0:p.hostUrl,editorId:this.editorId},this._analyticsData)}),this._notifyClient({eventName:o.ClientEvents.GC_RECOM_RES,data:{gcRes:t,recomRes:this.recommendationParaMap,ltRes:r}}),r}catch(e){if("LanguageNotFound"===e.message)throw e;return{}}}},{key:"handleFormulateAndResolveResponse",value:function(){try{var e,t,n=this.transformResponseAccToParagraphs();this.isGCDone=!0,this.finalizedLTResponse=n,null==(t=this.resolveResponse)||t.call(this,n)}catch(t){null==(e=this.rejectResponse)||e.call(this,t)}}},{key:"_addMetaToLTResponse",value:function(e,t){e.metaData=e.metaData||{textErrors:{},errorInfo:[{totalSentences:0,errorCodes:[]}],totalChangedParagraphs:this._getNonEmptyParagraphsCount()},e.metaData.isFromCache=t.isCached;var n,r,i,a,s,u,c,l,f,d,h,p=e.metaData.errorInfo?e.metaData.errorInfo[0]:{totalSentences:0,errorCodes:[]};t.sentenceRanges&&-1!==t.sentenceRanges[0][1]&&(p.totalSentences=t.sentenceRanges.length,(null==t?void 0:t.isCached)||(this._analyticsData.numberOfSentencesProcessedForGC+=t.sentenceRanges.length)),(null==t?void 0:t.isCached)||(t.type===o.ChunkType.SentenceSuggestionsGC?this._analyticsData.errors.push({isRecommendation:!1,modelID:null==(n=t.modelIDs)?void 0:n.filter(function(e){return"string"==typeof e})[0],discriminatorID:null==(r=t.discriminatorIDs)?void 0:r.filter(function(e){return"string"==typeof e})[0],explainerID:null==(i=t.explainerIDs)?void 0:i.filter(function(e){return"string"==typeof e})[0],category:""}):t.type===o.ChunkType.SentenceSuggestionsRecommendation&&t.suggestions.length&&(this._analyticsData.numberOfSentencesProcessedForReco+=1,this._analyticsData.errors.push({isRecommendation:!0,modelID:null==(a=t.modelIDs)?void 0:a.filter(function(e){return"string"==typeof e})[0],discriminatorID:null==(s=t.discriminatorIDs)?void 0:s.filter(function(e){return"string"==typeof e})[0],explainerID:null==(u=t.explainerIDs)?void 0:u.filter(function(e){return"string"==typeof e})[0],category:null==(f=t.suggestions[0])||null==(l=f.rule)||null==(c=l.category)?void 0:c.name}))),t.errorCode&&(p.errorCodes.push(t.errorCode),t.type===o.ChunkType.SentenceSuggestionsGC?p.totalGcErrors=(null!=(d=p.totalGcErrors)?d:0)+1:t.type===o.ChunkType.SentenceSuggestionsRecommendation&&(p.totalRecoErrors=(null!=(h=p.totalRecoErrors)?h:0)+1))}},{key:"_createParagraphStats",value:function(){var e=this.startTime,t=Date.now(),n=this._responseOrderCounter===this.paragraphs.length-1;return{index:this._responseOrderCounter,requestTime:e,responseTime:t,isLast:n}}},{key:"processGCResponse",value:function(e,t){this.gcParaMap[t]=this.gcParaMap[t]||{matches:[]};var n=this.gcParaMap[t];if(e.type===o.ChunkType.SentenceSplitter){if(n.language=e.language,n.sentenceRanges=e.sentenceRanges,n.extendedSentenceRanges=null==(r=e.sentenceRanges)?void 0:r.map(function(t){var n,r;return{from:t[0],to:t[1],detectedLanguages:[{language:(null==e||null==(r=e.language)||null==(n=r.code)?void 0:n.split("-")[0])||"en",rate:0}]}}),this._sentenceSplitterCompletedIds.add(t),this.paragraphs.length===this._sentenceSplitterCompletedIds.size){var r,i,a,s,u=this.transformSentenceRangesAccToParagraphs(),c=u.sentenceRanges,l=u.extendedSentenceRanges,f=n.language;f||(f={name:"English (US)",code:null==(a=this._metaData)?void 0:a.language,detectedLanguage:{confidence:1,name:"English (US)",source:"",code:null==(s=this._metaData)?void 0:s.language}});var d=Ee(Ce({},n),{sentenceRanges:c,extendedSentenceRanges:l,language:f});null==(i=this.handleResponseCallback)||i.call(this,d,"sentence-splitter-response")}this._addMetaToLTResponse(n,e)}if(e.type===o.ChunkType.SentenceSuggestionsGC){var h=this.createIndividualLtResObj(n,t,e.suggestions,e.modelIDs||[]);n.matches=Re(n.matches).concat(Re(e.suggestions));var p=(n.extendedSentenceRanges||[]).map(function(t){return e.sentenceOffset&&t.from===e.sentenceOffset.start&&t.to===e.sentenceOffset.end&&(e.errorCode?t.checkStatus="failure":t.checkStatus="success"),t});if(n.extendedSentenceRanges=p,this._addMetaToLTResponse(n,e),"sentence-level"===this._responseType){var g,v=this._transformIndividualParagraphResponse(t,h);null==(g=this.handleResponseCallback)||g.call(this,v,"grammar-check-response")}}if(e.type===o.ChunkType.SentenceSuggestionsGCCompleted&&this.returnFromWs){this.errorModelIds=Re(this.errorModelIds).concat(Re(e.modelIDs||[])),this._gcCompletedIds.add(Number(t));var m=this.createIndividualLtResObj(n,t,n.matches,e.modelIDs||[]);if("paragraph-level"===this._responseType){var y,b=this._transformIndividualParagraphResponse(t,m);b.metaData&&(b.metaData.paragraphStats=this._createParagraphStats()),this._responseOrderCounter++,null==(y=this.handleResponseCallback)||y.call(this,b,"grammar-check-response")}}}},{key:"_synthesizeFallbackChunksForParagraph",value:function(e,t){var n=be({changeIndex:e,editorId:this.editorId,editorGroupId:(null==(a=this._metaData)?void 0:a.editorGroupId)||"",errorCode:this.processingConfig.isFixApplied?"FIX_APPLIED":"TIMEOUT",language:{name:"English (US)",code:"en-us",detectedLanguage:{name:"English (US)",code:"en-us",confidence:1,source:""}},type:t},this.paragraphs)||[],r=!0,o=!1,i=void 0;try{for(var a,s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value;try{this.processGCResponse(c,e)}catch(e){}}}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}}},{key:"_emitMissingParagraphResponses",value:function(e){if("paragraph-level"===this._responseType)for(var t=0;t<this.paragraphs.length;t++){if("\n"===this.paragraphs[t].text){var n,r,i,a=this.paragraphs[t].offset;if(!this._emptyParaTextMap.has(a))continue}if(!this._gcCompletedIds.has(Number(t))){var s=o.ChunkType.SentenceSplitter,u=!(null==(n=this.gcParaMap[t])?void 0:n.sentenceRanges)||!(null==(r=this.gcParaMap[t])?void 0:r.extendedSentenceRanges);if(u||null==(i=this.gcParaMap[t])||!i.matches){s=u?o.ChunkType.SentenceSplitter:o.ChunkType.SentenceSuggestionsGC,this._synthesizeFallbackChunksForParagraph(t,s);var c=this.gcParaMap[t],l=this._transformIndividualParagraphResponse(t,c);l.metaData&&(l.metaData.paragraphStats=this._createParagraphStats()),this._responseOrderCounter++,null==e||e(l,"grammar-check-response")}}}}},{key:"_transformIndividualParagraphResponse",value:function(e,t){try{var n,r,o,i,a,s,u,c=this.calculateParagraphOffset(e);return Ee(Ce({},t),{matches:this.transformMatches(t.matches,c),sentenceRanges:this.transformSentenceRanges(t.sentenceRanges,c,this.paragraphs[e].text),extendedSentenceRanges:this.transformExtendedSentenceRanges(t.extendedSentenceRanges,(null==(n=t.sentenceRanges)?void 0:n.length)||0,c,this.paragraphs[e].text),metaData:Ee(Ce({},t.metaData),{textErrors:{errorModelId:(null==(o=t.metaData)||null==(r=o.textErrors)?void 0:r.errorModelId)||[],recommendationModelId:(null==(a=t.metaData)||null==(i=a.textErrors)?void 0:i.recommendationModelId)||[]},errorInfo:(null==(s=t.metaData)?void 0:s.errorInfo)||[],paragraphId:null==(u=t.metaData)?void 0:u.paragraphId,totalChangedParagraphs:this._getNonEmptyParagraphsCount()})})}catch(e){return t}}},{key:"handleGCResponse",value:function(e){var t=this;return new Promise(function(n,r){var i;t.resolveResponse=n,t.rejectResponse=r,t.handleResponseCallback=e,null==(i=t.gcMergedObservable)||i.subscribe({next:function(e){var n=e.data,o=e.source;try{t.processGCResponse(n,o)}catch(e){r(e)}},complete:function(){try{t._emitMissingParagraphResponses(e),t.processingConfig.shouldRunRecommendation?t.handleRecommendationResponse(e):((0,o.logTimeForAction)(o.LogActionPrefix.LT_QB_GC_ADAPTER,{type:"GC_COMPLETED",mode:"WS",startTime:t.startTime,currentTime:Date.now(),timeDiff:Date.now()-t.startTime,editorId:t.editorId}),t.handleFormulateAndResolveResponse())}catch(e){r(e)}},error:function(e){r(e)}})})}},{key:"handleRecommendationResponse",value:function(e){var t,n=this;null==(t=this.recommendationMergedObservable)||t.subscribe({next:function(t){try{var r=t.source,i=t.data;n.recommendationParaMap[r]=n.recommendationParaMap[r]||{matches:[]};var a=n.recommendationParaMap[r];if(i.type===o.ChunkType.SentenceSuggestionsRecommendation){if(a.matches=Re(a.matches).concat(Re(i.suggestions)),n.recommendationModelIds=Re(n.recommendationModelIds).concat(Re(i.modelIDs||[])),n.isGCDone){for(var s,u=0,c=0;c<r;c++)u+=n.paragraphs[c].text.length+2;var l=null==(s=i.suggestions)?void 0:s.map(function(e){return Ee(Ce({},e),{offset:e.offset+u})}),f=Ee(Ce({},n.finalizedLTResponse),{matches:l||[]});null==e||e(f,"recommendation-response")}n._addMetaToLTResponse(a,i)}}catch(e){}},complete:function(){n.processingConfig.shouldRunRecommendation&&((0,o.logTimeForAction)(o.LogActionPrefix.LT_QB_GC_ADAPTER,{type:"GC_WITH_RECOMMENDATION_COMPLETED",mode:"WS",startTime:n.startTime,currentTime:Date.now(),timeDiff:Date.now()-n.startTime,editorId:n.editorId}),n.handleFormulateAndResolveResponse())},error:function(e){}})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),we=function(e,t){return(we=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Oe(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}we(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function xe(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function Pe(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function ke(e,t,n){if(n||2==arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function De(e){return this instanceof De?(this.v=e,this):new De(e)}function Ae(e){return"function"==typeof e}function Me(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}"function"==typeof SuppressedError&&SuppressedError;var Le=Me(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function je(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Ge=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,n,r,o,i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=Pe(i),s=a.next();!s.done;s=a.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else i.remove(this);var u=this.initialTeardown;if(Ae(u))try{u()}catch(e){o=e instanceof Le?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var l=Pe(c),f=l.next();!f.done;f=l.next()){var d=f.value;try{Ue(d)}catch(e){o=null!=o?o:[],e instanceof Le?o=ke(ke([],Te(o)),Te(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new Le(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Ue(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(n=this._finalizers)?n:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&je(t,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&je(n,e),e instanceof t&&e._removeParent(this)},(e=new t).closed=!0,t.EMPTY=e,t}(),Fe=Ge.EMPTY;function Ne(e){return e instanceof Ge||e&&"closed"in e&&Ae(e.remove)&&Ae(e.add)&&Ae(e.unsubscribe)}function Ue(e){Ae(e)?e():e.unsubscribe()}var We=void 0,qe=!1;function ze(e){!function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];setTimeout.apply(void 0,ke([e,t],Te(n)))}(function(){throw e})}function He(){}var Ve=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Ne(t)&&t.add(n)):n.destination=$e,n}return Oe(t,e),t.create=function(e,t,n){return new Ke(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ge),Be=Function.prototype.bind;function Ye(e,t){return Be.call(e,t)}var Qe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){ze(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){ze(e)}else ze(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){ze(e)}},e}(),Ke=function(e){function t(t,n,r){var o,i,a=e.call(this)||this;return Ae(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:a&&qe?((i=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},o={next:t.next&&Ye(t.next,i),error:t.error&&Ye(t.error,i),complete:t.complete&&Ye(t.complete,i)}):o=t,a.destination=new Qe(o),a}return Oe(t,e),t}(Ve),$e={closed:!0,next:He,error:function(e){throw e},complete:He},Je="function"==typeof Symbol&&Symbol.observable||"@@observable";function Xe(e){return e}var Ze=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=function(e){return e&&e instanceof Ve||e&&Ae(e.next)&&Ae(e.error)&&Ae(e.complete)&&Ne(e)}(e)?e:new Ke(e,t,n),o=this.operator,i=this.source;return r.add(o?o.call(r,i):i?this._subscribe(r):this._trySubscribe(r)),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=et(t))(function(t,r){var o=new Ke({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)})},e.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},e.prototype[Je]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===e.length?Xe:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)})(this)},e.prototype.toPromise=function(e){var t=this;return new(e=et(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function et(e){var t;return null!=(t=null!=e?e:We)?t:Promise}function tt(e){return Ae(null==e?void 0:e.lift)}function nt(e){return function(t){if(tt(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}function rt(e,t,n,r,o){return new ot(e,t,n,r,o)}var ot=function(e){function t(t,n,r,o,i,a){var s=e.call(this,t)||this;return s.onFinalize=i,s.shouldUnsubscribe=a,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return Oe(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),n||null==(t=this.onFinalize)||t.call(this)}},t}(Ve);function it(e,t){var n=Ze.call(this)||this;return n.source=e,n.subjectFactory=t,n._subject=null,n._refCount=0,n._connection=null,tt(e)&&(n.lift=e.lift),n}Oe(it,Ze),it.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},it.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},it.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()},it.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new Ge;var n=this.getSubject();t.add(this.source.subscribe(rt(n,void 0,function(){e._teardown(),n.complete()},function(t){e._teardown(),n.error(t)},function(){return e._teardown()}))),t.closed&&(this._connection=null,t=Ge.EMPTY)}return t},it.prototype.refCount=function(){return nt(function(e,t){var n=null;e._refCount++;var r=rt(t,void 0,void 0,void 0,function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,o=n;n=null,r&&(!o||r===o)&&r.unsubscribe(),t.unsubscribe()}});e.subscribe(r),r.closed||(n=e.connect())})(this)};var at={now:function(){return(at.delegate||performance).now()},delegate:void 0},st={schedule:function(e){var t=cancelAnimationFrame,n=requestAnimationFrame(function(n){t=void 0,e(n)});return new Ge(function(){return null==t?void 0:t(n)})},requestAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=st.delegate;return((null==n?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,ke([],Te(e)))},cancelAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return cancelAnimationFrame.apply(void 0,ke([],Te(e)))},delegate:void 0};new Ze(function(e){var t=at.now(),n=0,r=function(){e.closed||(n=st.requestAnimationFrame(function(o){n=0;var i=at.now();e.next({timestamp:o,elapsed:i-t}),r()}))};return r(),function(){n&&st.cancelAnimationFrame(n)}});var ut=Me(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ct=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Oe(t,e),t.prototype.lift=function(e){var t=new lt(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new ut},t.prototype.next=function(e){var t,n;if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));try{for(var r=Pe(this.currentObservers),o=r.next();!o.done;o=r.next())o.value.next(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},t.prototype.error=function(e){if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;for(var t=this.observers;t.length;)t.shift().error(e)}},t.prototype.complete=function(){if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;for(var e=this.observers;e.length;)e.shift().complete()}},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null==(e=this.observers)?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this.hasError,r=this.isStopped,o=this.observers;return n||r?Fe:(this.currentObservers=null,o.push(e),new Ge(function(){t.currentObservers=null,je(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,n=this.thrownError,r=this.isStopped;t?e.error(n):r&&e.complete()},t.prototype.asObservable=function(){var e=new Ze;return e.source=this,e},t.create=function(e,t){return new lt(e,t)},t}(Ze),lt=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Oe(t,e),t.prototype.next=function(e){var t,n;null==(n=null==(t=this.destination)?void 0:t.next)||n.call(t,e)},t.prototype.error=function(e){var t,n;null==(n=null==(t=this.destination)?void 0:t.error)||n.call(t,e)},t.prototype.complete=function(){var e,t;null==(t=null==(e=this.destination)?void 0:e.complete)||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!=(n=null==(t=this.source)?void 0:t.subscribe(e))?n:Fe},t}(ct);function ft(e){var t=ct.call(this)||this;return t._value=e,t}Oe(ft,ct),Object.defineProperty(ft.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),ft.prototype._subscribe=function(e){var t=ct.prototype._subscribe.call(this,e);return t.closed||e.next(this._value),t},ft.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,n=this._value;if(e)throw t;return this._throwIfClosed(),n},ft.prototype.next=function(e){ct.prototype.next.call(this,this._value=e)};var dt={now:function(){return(dt.delegate||Date).now()},delegate:void 0};function ht(e,t,n){void 0===e&&(e=1/0),void 0===t&&(t=1/0),void 0===n&&(n=dt);var r=ct.call(this)||this;return r._bufferSize=e,r._windowTime=t,r._timestampProvider=n,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=t===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,t),r}function pt(){var e=null!==ct&&ct.apply(this,arguments)||this;return e._value=null,e._hasValue=!1,e._isComplete=!1,e}Oe(ht,ct),ht.prototype.next=function(e){var t=this.isStopped,n=this._buffer,r=this._infiniteTimeWindow,o=this._timestampProvider,i=this._windowTime;!t&&(n.push(e),r||n.push(o.now()+i)),this._trimBuffer(),ct.prototype.next.call(this,e)},ht.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=n?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},ht.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,n=this._buffer,r=this._infiniteTimeWindow,o=(r?1:2)*e;if(e<1/0&&o<n.length&&n.splice(0,n.length-o),!r){for(var i=t.now(),a=0,s=1;s<n.length&&n[s]<=i;s+=2)a=s;a&&n.splice(0,a+1)}},Oe(pt,ct),pt.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,n=this._hasValue,r=this._value,o=this.thrownError,i=this.isStopped,a=this._isComplete;t?e.error(o):(i||a)&&(n&&e.next(r),e.complete())},pt.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},pt.prototype.complete=function(){var e=this._hasValue,t=this._value;this._isComplete||(this._isComplete=!0,e&&ct.prototype.next.call(this,t),ct.prototype.complete.call(this))};var gt=function(e){function t(t,n){return e.call(this)||this}return Oe(t,e),t.prototype.schedule=function(e,t){return this},t}(Ge),vt=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,ke([e,t],Te(n)))},mt=function(e){return clearInterval(e)},yt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Oe(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n,r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,t)),this.pending=!0,this.delay=t,this.id=null!=(n=this.id)?n:this.requestAsyncId(o,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),vt(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&mt(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,je(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(gt),bt=1,_t={};function St(e){return e in _t&&(delete _t[e],!0)}var Ct=function(e){var t=bt++;return _t[t]=!0,p||(p=Promise.resolve()),p.then(function(){return St(t)&&e()}),t},Et={setImmediate:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Et.delegate;return((null==n?void 0:n.setImmediate)||Ct).apply(void 0,ke([],Te(e)))},clearImmediate:function(e){return function(e){St(e)}(e)},delegate:void 0},Rt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Oe(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=Et.setImmediate(t.flush.bind(t,void 0))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o,i=t.actions;null!=n&&(null==(o=i[i.length-1])?void 0:o.id)!==n&&(Et.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},t}(yt),It=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=dt.now,e}(),wt=function(e){function t(t,n){void 0===n&&(n=It.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return Oe(t,e),t.prototype.flush=function(e){var t,n=this.actions;if(this._active)n.push(e);else{this._active=!0;do{if(t=e.execute(e.state,e.delay))break}while(e=n.shift());if(this._active=!1,t){for(;e=n.shift();)e.unsubscribe();throw t}}},t}(It);new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oe(t,e),t.prototype.flush=function(e){this._active=!0;var t,n=this._scheduled;this._scheduled=void 0;var r=this.actions;e=e||r.shift();do{if(t=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===n&&r.shift());if(this._active=!1,t){for(;(e=r[0])&&e.id===n&&r.shift();)e.unsubscribe();throw t}},t}(wt))(Rt);var Ot=new wt(yt),xt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Oe(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!=r&&r>0||null==r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.flush(this),0)},t}(yt);new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oe(t,e),t}(wt))(xt);var Pt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Oe(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=st.requestAnimationFrame(function(){return t.flush(void 0)})))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o,i=t.actions;null!=n&&n===t._scheduled&&(null==(o=i[i.length-1])?void 0:o.id)!==n&&(st.cancelAnimationFrame(n),t._scheduled=void 0)},t}(yt);function Tt(e,t){void 0===e&&(e=kt),void 0===t&&(t=1/0);var n=wt.call(this,e,function(){return n.frame})||this;return n.maxFrames=t,n.frame=0,n.index=-1,n}new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oe(t,e),t.prototype.flush=function(e){this._active=!0,e?t=e.id:(t=this._scheduled,this._scheduled=void 0);var t,n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(wt))(Pt),Oe(Tt,wt),Tt.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},Tt.frameTimeFactor=10;var kt=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var o=e.call(this,t,n)||this;return o.scheduler=t,o.work=n,o.index=r,o.active=!0,o.index=t.index=r,o}return Oe(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!Number.isFinite(r))return Ge.EMPTY;if(!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var o=new t(this.scheduler,this.work);return this.add(o),o.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var o=e.actions;return o.push(this),o.sort(t.sortActions),1},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(yt),Dt=new Ze(function(e){return e.complete()});function At(e){return e[e.length-1]}function Mt(e){var t;return(t=At(e))&&Ae(t.schedule)?e.pop():void 0}var Lt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function jt(e){return Ae(null==e?void 0:e.then)}function Gt(e){return Symbol.asyncIterator&&Ae(null==e?void 0:e[Symbol.asyncIterator])}function Ft(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Nt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ut(e){return Ae(null==e?void 0:e[Nt])}function Wt(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(e,t){o[e]&&(r[e]=function(t){return new Promise(function(n,r){i.push([e,t,n,r])>1||s(e,t)})},t&&(r[e]=t(r[e])))}function s(e,t){try{var n;(n=o[e](t)).value instanceof De?Promise.resolve(n.value.v).then(u,c):l(i[0][2],n)}catch(e){l(i[0][3],e)}}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function(){var t,n,r;return xe(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,De(t.read())];case 3:return r=(n=o.sent()).value,n.done?[4,De(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,De(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function qt(e){return Ae(null==e?void 0:e.getReader)}function zt(e){if(e instanceof Ze)return e;if(null!=e){var t,n,r,o;if(Ae(e[Je]))return t=e,new Ze(function(e){var n=t[Je]();if(Ae(n.subscribe))return n.subscribe(e);throw TypeError("Provided object does not correctly implement Symbol.observable")});if(Lt(e))return n=e,new Ze(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()});if(jt(e))return r=e,new Ze(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,ze)});if(Gt(e))return Ht(e);if(Ut(e))return o=e,new Ze(function(e){var t,n;try{for(var r=Pe(o),i=r.next();!i.done;i=r.next()){var a=i.value;if(e.next(a),e.closed)return}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}e.complete()});if(qt(e))return Ht(Wt(e))}throw Ft(e)}function Ht(e){return new Ze(function(t){(function(e,t){var n,r,o,i,a,s,u;return a=this,u=function(){var a;return xe(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Pe(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,o){var i,a,s;i=r,a=o,s=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){i({value:e,done:s})},a)})}}}(e),s.label=1;case 1:return[4,n.next()];case 2:if((r=s.sent()).done)return[3,4];if(a=r.value,t.next(a),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o={error:s.sent()},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new((s=void 0)||(s=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):((o=t.value)instanceof s?o:new s(function(e){e(o)})).then(n,r)}o((u=u.apply(a,[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function Vt(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule(function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(i),!o)return i}function Bt(e,t){return void 0===t&&(t=0),nt(function(n,r){n.subscribe(rt(r,function(n){return Vt(r,e,function(){return r.next(n)},t)},function(){return Vt(r,e,function(){return r.complete()},t)},function(n){return Vt(r,e,function(){return r.error(n)},t)}))})}function Yt(e,t){return void 0===t&&(t=0),nt(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Qt(e,t){if(!e)throw Error("Iterable cannot be null");return new Ze(function(n){Vt(n,t,function(){var r=e[Symbol.asyncIterator]();Vt(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function Kt(e,t){return t?function(e,t){if(null!=e){if(Ae(e[Je]))return zt(e).pipe(Yt(t),Bt(t));if(Lt(e))return new Ze(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})});if(jt(e))return zt(e).pipe(Yt(t),Bt(t));if(Gt(e))return Qt(e,t);if(Ut(e))return new Ze(function(n){var r;return Vt(n,t,function(){r=e[Nt](),Vt(n,t,function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)},0,!0)}),function(){return Ae(null==r?void 0:r.return)&&r.return()}});if(qt(e))return Qt(Wt(e),t)}throw Ft(e)}(e,t):zt(e)}function $t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Kt(e,Mt(e))}function Jt(e,t){var n=Ae(e)?e:function(){return e},r=function(e){return e.error(n())};return new Ze(t?function(e){return t.schedule(r,0,e)}:r)}(h=g||(g={})).NEXT="N",h.ERROR="E",h.COMPLETE="C",Me(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}),Me(function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),Me(function(e){return function(t){e(this),this.name="NotFoundError",this.message=t}}),Me(function(e){return function(t){e(this),this.name="SequenceError",this.message=t}});var Xt=Me(function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function Zt(e){throw new Xt(e)}function en(e,t,n){return void 0===n&&(n=1/0),Ae(t)?en(function(n,r){var o;return(o=function(e,o){return t(n,e,r,o)},nt(function(e,t){var n=0;e.subscribe(rt(t,function(e){t.next(o.call(void 0,e,n++))}))}))(zt(e(n,r)))},n):("number"==typeof t&&(n=t),nt(function(t,r){var o,i,a,s,u,c,l,f;return o=n,i=[],a=0,s=0,u=!1,c=function(){!u||i.length||a||r.complete()},l=function(e){return a<o?f(e):i.push(e)},f=function(t){a++;var n=!1;zt(e(t,s++)).subscribe(rt(r,function(e){r.next(e)},function(){n=!0},void 0,function(){if(n)try{for(a--;i.length&&a<o;)!function(){var e=i.shift();f(e)}();c()}catch(e){r.error(e)}}))},t.subscribe(rt(r,l,function(){u=!0,c()})),function(){}}))}function tn(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=Mt(n),i=(e=1/0,"number"==typeof At(n)?n.pop():e);return n.length?1===n.length?zt(n[0]):(void 0===(t=i)&&(t=1/0),en(Xe,t))(Kt(n,o)):Dt}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rn(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function an(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function sn(e){return function(e){if(Array.isArray(e))return nn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||un(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function un(e,t){if(e){if("string"==typeof e)return nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nn(e,t)}}function cn(e,t){if(!t)throw Error("MetaData is required");return void 0!==(null==t?void 0:t.lastEditorContentSavedTimestamp)&&0===t.lastEditorContentSavedTimestamp?e.changedContent.map(function(t){return an(on(an(on({},t),{changeSentenceLength:e.changedParagraphsSentencesLength}),e.hasUserAppliedFix&&{replacementText:null==e?void 0:e.replacementText}),{offset:t.start})}):e.paragraphs.map(function(t){return an(on(an(on({},t),{changeSentenceLength:e.changedParagraphsSentencesLength}),e.hasUserAppliedFix&&{replacementText:null==e?void 0:e.replacementText}),{offset:t.offset,start:t.offset})})}function ln(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e4,o=e.map(function(e,o){var i;return e.pipe(function(e){var t=e instanceof Date&&!isNaN(e)?{first:e}:"number"==typeof e?{each:e}:e,n=t.first,r=t.each,o=t.with,i=void 0===o?Zt:o,a=t.scheduler,s=void 0===a?Ot:a,u=t.meta,c=void 0===u?null:u;if(null==n&&null==r)throw TypeError("No timeout provided.");return nt(function(e,t){var o,a,u=null,l=0,f=function(e){a=Vt(t,s,function(){try{o.unsubscribe(),zt(i({meta:c,lastValue:u,seen:l})).subscribe(t)}catch(e){t.error(e)}},e)};o=e.subscribe(rt(t,function(e){null==a||a.unsubscribe(),l++,t.next(u=e),r>0&&f(r)},void 0,void 0,function(){(null==a?void 0:a.closed)||null==a||a.unsubscribe(),u=null})),l||f(null!=n?"number"==typeof n?n:n-s.now():r)})}(r),function e(t){return nt(function(n,r){var o,i=null,a=!1;i=n.subscribe(rt(r,void 0,void 0,function(s){o=zt(t(s,e(t)(n))),i?(i.unsubscribe(),i=null,o.subscribe(r)):a=!0})),a&&(i.unsubscribe(),i=null,o.subscribe(r))})}(function(e){if("AbortError"===(null==e?void 0:e.reason))throw e;return $t(on({errorCode:"TIMEOUT",changeIndex:o},t))}),en(function(e){if(!e.errorCode)return $t({data:e,source:e.changeIndex});try{var t=be(e,n);return t.length>0?$t.apply(void 0,sn(t.map(function(e){return{data:e,source:e.changeIndex}})).concat([{data:{type:"complete",changeIndex:null==e?void 0:e.changeIndex,editorId:"",editorGroupId:""},source:null==e?void 0:e.changeIndex}])):Jt(function(){return{data:e}})}catch(t){return Jt(function(){return{data:e}})}}),(i=function(e){return"complete"!==e.data.type&&"request-complete"!==e.data.type},nt(function(e,t){e.subscribe(rt(t,function(e){var n=i(e,0);t.next(e),n||t.complete()}))})))});return tn.apply(void 0,sn(o))}function fn(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function dn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){fn(i,r,o,a,s,"next",e)}function s(e){fn(i,r,o,a,s,"throw",e)}a(void 0)})}}function hn(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function pn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function gn(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function vn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){gn(i,r,o,a,s,"next",e)}function s(e){gn(i,r,o,a,s,"throw",e)}a(void 0)})}}function mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){yn(e,t,n[t])})}return e}function _n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function Sn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||En(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cn(e){return function(e){if(Array.isArray(e))return pn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||En(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function En(e,t){if(e){if("string"==typeof e)return pn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pn(e,t)}}function Rn(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}new Ze(He);var In=function(){var e,t;function n(){var e=this,t=this;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");yn(this,"_gcService",void 0),yn(this,"_GC_SUPPORTED_LANGUAGES",O),yn(this,"_PLATFORM_TYPE","chrome-active"),yn(this,"_PLATFORM_VERSION",""),yn(this,"_transport",void 0),yn(this,"_preferredMode",he.LEGACY_HTTP),yn(this,"_returnFromWs",!0),yn(this,"_isRecommendationEnabledForWsFlow",!0),yn(this,"_isRecommendationEnabledForWsFlowV2",!1),yn(this,"_quickFixEnabled",null),yn(this,"_enableMasking",null),yn(this,"_isContextManagementEnabled",!1),yn(this,"getTransport",function(){return e._transport}),yn(this,"_inProgressLangDetectRequests",new Map),yn(this,"storeSentenceForSkippingCheck",function(t){return vn(function(){return Rn(this,function(e){switch(e.label){case 0:return[4,this._gcService.storeSentenceForSkippingCheck(t)];case 1:return e.sent(),[2]}})}).call(e)}),yn(this,"trackRecommendationAnalytics",function(e,t,n){try{var o,i,a={cache:0,api:0};e.map(function(e){e._cached?a.cache++:e.text&&a.api++});var s=t.matches.map(function(e){return{category:e.rule.category.name,modelID:null==e?void 0:e.rule.modelId,isRecommendation:!0}}),u={eventName:"gc_model_stats",data:{hostUrl:null==(o=n.metaData)?void 0:o.hostUrl,editorID:null==(i=n.metaData)?void 0:i.instanceId,errors:s,numberOfSentencesProcessedForGC:0,numberOfSentencesProcessedForReco:a.api+a.cache}};(0,r.notifyClient)(u)}catch(e){}}),yn(this,"recommendation",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vn(function(){var t,r,o,i,a;return Rn(this,function(s){switch(s.label){case 0:return t=this._preferredMode===he.WS_WITH_NON_GDOCS,r=this._isRecommendationEnabledForWsFlowV2,[4,this._gcService.getIsPremium()];case 1:return o="true"===s.sent(),a=_n(bn({},e),{input:_n(bn({},e.input),{enableMasking:null!=(i=this._enableMasking)?i:void 0})}),o&&t&&r?[2,this._handleRecommendationFlowWs(a,n)]:[2,this._handleRecommendationFlowHttp(a,n)]}})}).call(t)}),yn(this,"_handleRecommendationFlowHttp",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vn(function(){var t,r,o,i,a,s,u,c,l,f,d;return Rn(this,function(h){switch(h.label){case 0:return s={"x-website-origin":((null==e||null==(t=e.metaData)?void 0:t.hostUrl)?T(null==e||null==(r=e.metaData)?void 0:r.hostUrl):"")||"","x-website-url":(null==e||null==(o=e.metaData)?void 0:o.hostUrl)||"","platform-type":this._PLATFORM_TYPE,"platform-version":this._PLATFORM_VERSION,"x-regional-language":(null==(a=e.input)||null==(i=a.language)?void 0:i.split("-")[1])||""},[4,this._gcService.forceRecommendation(e.input,_n(bn({},n),{headers:bn({},n.headers,s)}))];case 1:return u=h.sent(),[4,this._gcService.getIsPremium()];case 2:return c="true"===h.sent(),[4,this._gcService.getInputLanguage()];case 3:return l=h.sent(),[4,this._gcService.getRegionalLangauge()];case 4:return f=h.sent(),d=de.transformForceRecommendation({recommendation:u,langData:{language:l,region:f,confidence:0},isPremium:c}),this.trackRecommendationAnalytics(u,d,e),[2,d]}})}).call(t)}),yn(this,"_handleRecommendationFlowWs",function(e){return vn(function(){var t,n,i,a,s,u,c,l,f,d,h,p,g,v,m,y,b,_,S,C;return Rn(this,function(E){switch(E.label){case 0:var R,I;return[4,(R=null==(t=e.input)?void 0:t.texts,I=this._transport,dn(function(){var e,t,n,i,a,s,u,c,l,f,d,h;return hn(this,function(p){switch(p.label){case 0:e=+(0,r.getConfig)("RECOMMENDATION_MIN_TEXT_LENGTH")||10,t=[],n=[],i=0,p.label=1;case 1:var g;return i<R.length?[4,(g=a=R[i],dn(function(){var e,t,n,i;return hn(this,function(a){switch(a.label){case 0:return[4,(0,r.createHash)(g.text.trim())];case 1:return e=a.sent(),[4,r.SentenceStorage.get(e)];case 2:return(t=void 0!==a.sent())?[4,r.SentenceStorage.getDatabaseSize()]:[3,4];case 3:i=a.sent(),null==(n=I.trackEvent)||n.call(I,{tracking:{eventName:o.TrackingEvents.RECOMMENDATION_SENTENCE_IN_IGNORE_CACHE,eventData:{count:i}}}),a.label=4;case 4:return[2,t]}})})())]:[3,4];case 2:s=p.sent(),u=a.text.length<e,s||u?t.push({index:i,value:a}):(d=(f=!!(null==(c=a.paragraph)?void 0:c.rteMap))?(0,r.getBlockTags)((null==(l=a.paragraph)?void 0:l.rteMap)||{}):[],h=f&&a.paragraph&&a.relativeOffset?(0,r.generateSentenceHtml)(a.paragraph.text,a.relativeOffset.text.start,a.relativeOffset.text.end+1,a.paragraph.rteMap||{},d):"",n.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},a,h&&{textHtml:h}))),p.label=3;case 3:return i++,[3,1];case 4:return[2,{filteredTexts:n,removedTexts:t}]}})})())];case 1:return p=(h=E.sent()).filteredTexts,g=h.removedTexts,m=(v=Sn((null==(n=e.input)?void 0:n.language.split("-"))||[],2))[0],y=v[1],[4,this._gcService.getRegionalLangauge()];case 2:return b=E.sent(),_=0,0!==p.length?[3,4]:(S=de.createEmptyResponsesForRemovedTexts(g),[4,de.transformRecommendation({res:S,inputPayload:e.input,language:m,region:b,confidence:_})]);case 3:case 5:return[2,E.sent()];case 4:return C=ln(this._transport.commandV2({editorGroupId:(null==(i=e.metaData)?void 0:i.editorGroupId)||"",editorId:(null==(a=e.metaData)?void 0:a.instanceId)||"",editorContentVersion:Date.now().toString(),processingType:o.ProcessingType.RECOMMENDATION,meta:{language:m,dialect:y,lastEditorTimestamp:null==(s=e.metaData)?void 0:s.lastEditorTimestamp,writingGoal:null==(u=e.input)?void 0:u.writingGoal},context:p.map(function(e){return{text:e.text,pre:e.pre,post:e.post,start:e.offset,textHtml:e.textHtml}}),hostUrl:(null==(c=e.metaData)?void 0:c.hostUrl)||"",product:o.QB_PRODUCT.GRAMMAR_CHECKER,editorSchemaVersion:this._isContextManagementEnabled?"v2":"v1",writingSessionId:null==(l=e.metaData)?void 0:l.writingSessionId}),{editorId:(null==(f=e.metaData)?void 0:f.instanceId)||"",editorGroupId:(null==(d=e.metaData)?void 0:d.editorGroupId)||""},[],this._transport.recoveryConfig.observableTimeout),[4,this._processCommandResponse(C,g,e.input,m,b,_,p)]}})}).call(t)}),yn(this,"_processCommandResponse",function(e,t,n,r,o,i,a){return new Promise(function(a,s){var u=[],c=new Map;n.texts.forEach(function(e){var t;c.set(null!=(t=e.offset)?t:0,e.text)}),e.subscribe({next:function(e){var t=e.data;if(e.source,null==t?void 0:t.suggestions){var n=_n(bn({},t),{text:c.get(t.sentenceOffset.start)||""});u.push(n)}},error:function(e){s(e)},complete:function(){return vn(function(){var e,c;return Rn(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),e=de.createEmptyResponsesForRemovedTexts(t),c=Cn(u).concat(Cn(e)),[4,de.transformRecommendation({res:c,inputPayload:n,language:r,region:o,confidence:i})];case 1:return a(l.sent()),[3,3];case 2:return s(l.sent()),[3,3];case 3:return[2]}})})()}})})}),yn(this,"detectLanguage",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vn(function(){var t;return Rn(this,function(o){switch(o.label){case 0:return t={"platform-type":this._PLATFORM_TYPE,"platform-version":this._PLATFORM_VERSION},[4,(0,r.detectLanguage)(e,_n(bn({},n),{headers:bn({},n.headers,t)}))];case 1:return[2,o.sent()]}})}).call(t)}),yn(this,"unlockRecommendations",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vn(function(){var t,o,i,a,s,u,c,l;return Rn(this,function(f){switch(f.label){case 0:return f.trys.push([0,5,,6]),a={"x-website-origin":((null==e||null==(t=e.metaData)?void 0:t.hostUrl)?T(null==e||null==(o=e.metaData)?void 0:o.hostUrl):"")||"","x-website-url":(null==e||null==(i=e.metaData)?void 0:i.hostUrl)||"","platform-type":this._PLATFORM_TYPE,"platform-version":this._PLATFORM_VERSION},[4,(0,r.unlockRecommendation)(e,_n(bn({},n),{headers:bn({},n.headers,a)}))];case 1:return s=f.sent(),[4,this._gcService.getIsPremium()];case 2:return u="true"===f.sent(),[4,this._gcService.getInputLanguage()];case 3:return c=f.sent(),[4,this._gcService.getRegionalLangauge()];case 4:return l=f.sent(),(null==s?void 0:s.recommendation)?[2,{recommendation:de.transformForceRecommendation({recommendation:[null==s?void 0:s.recommendation],langData:{language:c,region:l,confidence:0},isPremium:u}),quota:null==s?void 0:s.quota}]:[2,void 0];case 5:throw undefined;case 6:return[2]}})}).call(t)}),yn(this,"_reportGrammarAnalysisResults",function(e,t,n,o,i){try{var a,s,u=function(e){try{var t=0,n=0,r=e.flatMap(function(e){return null==e?void 0:e.sentences}),o=!0,i=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c,l=s.value;!0===(null==(c=l.grammarResponse)?void 0:c._cached)?t++:l.grammarResponse&&""!==l.text&&n++}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}return{cache:t,api:n,total:t+n}}catch(e){return{cache:0,api:0,total:0}}}(e),c=t.map(function(e){return{category:null==e?void 0:e.rule.category.name,modelID:null==e?void 0:e.rule.modelId,isRecommendation:!0}}),l=n.matches.map(function(e){return{category:"",modelID:null==e?void 0:e.rule.modelId,discriminatorID:null==e?void 0:e.rule.discriminatorID,explainerID:null==e?void 0:e.rule.explainerID,isRecommendation:!1}}),f={eventName:"gc_model_stats",data:{hostUrl:null==(a=i.metaData)?void 0:a.hostUrl,editorID:null==(s=i.metaData)?void 0:s.instanceId,errors:Cn(c).concat(Cn(l)),numberOfSentencesProcessedForGC:u.total,numberOfSentencesProcessedForReco:o.api+o.cache}};(0,r.notifyClient)(f)}catch(e){}}),yn(this,"_onDeviceSentenceSplitter",function(t,n){return vn(function(){var e,o;return Rn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Promise.allSettled(t.map(function(e){return(0,r.getSplitSentences)({text:e.text,language:n,metaData:{ssBatch:1}},{skipHttpRequest:!0})}))];case 1:if((e=i.sent().map(function(e){return"fulfilled"===e.status?e.value.sentences:[]}).filter(Boolean)).some(function(e){return 0===e.length}))throw Error("Some of the paragraphs has timeout");return o=t.map(function(t,n){return _n(bn({},t),{sentences:e[n]||[]})}),[2,this._convertSentenceIndexToParagraphRelative(o).flatMap(function(e){return e.sentences.map(function(e){return[e.start,e.end]})})];case 2:throw undefined;case 3:return[2]}})}).call(e)}),this._gcService=j.getInstance(),this._transport=o.Transport.getInstance()}return e=[{key:"setConfig",value:function(e,t){return vn(function(){return Rn(this,function(n){switch(n.label){case 0:return void 0===t?[3,2]:[4,this._gcService.setConfig(e,t)];case 1:n.sent(),n.label=2;case 2:return[2]}})}).call(this)}},{key:"setGCHttpClient",value:function(e){return vn(function(){return Rn(this,function(t){return this._gcService.setGCHttpClient(e),[2]})}).call(this)}},{key:"setTrackerClient",value:function(e){return vn(function(){return Rn(this,function(t){return this._gcService.setGCTrackerClient(e),[2]})}).call(this)}},{key:"setLoggerClient",value:function(e){return vn(function(){return Rn(this,function(t){return this._gcService.setLoggerClient(e),[2]})}).call(this)}},{key:"setStorageClient",value:function(e){return vn(function(){return Rn(this,function(t){return this._gcService.setStorageClient(e),[2]})}).call(this)}},{key:"setEventCallback",value:function(e){return vn(function(){return Rn(this,function(t){return this._gcService.setEventCallback(e),this._transport.setEventCallback(e),[2]})}).call(this)}},{key:"setAdapterConfig",value:function(e){return vn(function(){var t,n,r,o,i,a,s,u,c,l,f,d,h,p,g,v,m,y,b;return Rn(this,function(_){switch(_.label){case 0:t=e.GC_SUPPORTED_LANGUAGES,n=e.PREFERRED_MODE,r=e.RETURN_FROM_WS,o=e.IS_RECOMMENDATION_ENABLED_FOR_WS,i=e.IS_RECOMMENDATION_ENABLED_FOR_WS_V2,a=e.QUICK_FIX_ENABLED,s=e.ENABLE_MASKING,u=e.IS_CONTEXT_MANAGEMENT_ENABLED,c=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["GC_SUPPORTED_LANGUAGES","PREFERRED_MODE","RETURN_FROM_WS","IS_RECOMMENDATION_ENABLED_FOR_WS","IS_RECOMMENDATION_ENABLED_FOR_WS_V2","QUICK_FIX_ENABLED","ENABLE_MASKING","IS_CONTEXT_MANAGEMENT_ENABLED"]),t&&(this._GC_SUPPORTED_LANGUAGES=t),e.PLATFORM_TYPE&&(this._PLATFORM_TYPE=e.PLATFORM_TYPE),e.PLATFORM_VERSION&&(this._PLATFORM_VERSION=e.PLATFORM_VERSION),n&&(this._preferredMode=n),void 0!==r&&(this._returnFromWs=r),void 0!==o&&(this._isRecommendationEnabledForWsFlow=o),void 0!==i&&(this._isRecommendationEnabledForWsFlowV2=i),void 0!==u&&(this._isContextManagementEnabled=u),void 0!==a&&(this._quickFixEnabled=a),void 0!==s&&(this._enableMasking=s),this._transport.setUserMeta({premium:"true"===c.IS_PREMIUM_USER}),l=["GC_SUPPORTED_LANGUAGES"],f=!0,d=!1,h=void 0,_.label=1;case 1:_.trys.push([1,6,7,8]),p=Object.entries(c)[Symbol.iterator](),_.label=2;case 2:return(f=(g=p.next()).done)?[3,5]:(m=(v=Sn(g.value,2))[0],y=v[1],l.includes(m)||void 0===y?[3,4]:[4,this.setConfig(m,y)]);case 3:_.sent(),_.label=4;case 4:return f=!0,[3,2];case 5:return[3,8];case 6:return b=_.sent(),d=!0,h=b,[3,8];case 7:try{f||null==p.return||p.return()}finally{if(d)throw h}return[7];case 8:return[2]}})}).call(this)}},{key:"transformRequest",value:function(e){return{currTextState:{text:"",paragraphsState:S(e)}}}},{key:"_detectLanguageIfNeeded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return vn(function(){var o,i,a,s,u,c;return Rn(this,function(l){switch(l.label){case 0:return(o=Sn(e.split("-")||[],1)[0])?[2,{language:o,confidence:1}]:(this._inProgressLangDetectRequests.size>1&&this._inProgressLangDetectRequests.clear(),(null==t?void 0:t.length)<15?[2,{language:w.English.toLowerCase(),confidence:1}]:(i=(null==t?void 0:t.slice(0,1e3))||"",this._inProgressLangDetectRequests.has(i)?[4,this._inProgressLangDetectRequests.get(i)]:[3,2]));case 1:return[2,{language:(a=l.sent()).language,confidence:a.score}];case 2:return u=(0,r.detectLanguage)(i,_n(bn({},n),{signal:null!=(s=null==n?void 0:n.signal)?s:void 0})),this._inProgressLangDetectRequests.set(i,u),[4,u];case 3:return[2,{language:(c=l.sent()).language,confidence:c.score}]}})}).call(this)}},{key:"_getRegion",value:function(e,t){if(!t)return"";var n,r=Sn(t.split("-"),2),o=r[0];return r[1]||(null==e||null==(n=e.find(function(e){return e.startsWith(o)}))?void 0:n.split("-")[1])||""}},{key:"unsupportedLanguageResponse",value:function(e){var t=R(e.language,e.region),n=V._defaultLTResponse();return n.language=V._createLanguageObject("NoopLanguage",t,e.confidence),n}},{key:"isSupportedLanguage",value:function(e){return this._GC_SUPPORTED_LANGUAGES.some(function(t){return t.code===e.toUpperCase()})}},{key:"_convertRecommendationSentenceIndexToParagraphRelative",value:function(e,t){if(0===(null==e?void 0:e.length))return[];var n=JSON.parse(JSON.stringify(t));if(null==n||n.forEach(function(t){t.sentences.forEach(function(n){var r=null==e?void 0:e.find(function(e){return(null==n?void 0:n.sentenceId)===(null==e?void 0:e.sentenceId)&&(null==t?void 0:t.paraID)===(null==e?void 0:e.paraId)});r&&(n.recommendationResponse=r)})}),1===n.length)return n[0].sentences[n[0].sentences.length-1].end=n[0].sentences[n[0].sentences.length-1].end+1,n;var r=0;return n.forEach(function(e){var t,n,o=null==e||null==(t=e.sentences)?void 0:t.length;null==e||null==(n=e.sentences)||n.map(function(e,t){var n,i;e.start=e.start+r,e.end=t===o-1?e.end+r+1:e.end+r,null==e||null==(i=e.recommendationResponse)||null==(n=i.recommendations)||n.forEach(function(t,n){t.phrases.forEach(function(t,o){var i,a=_n(bn({},t),{start:t.start+r,end:t.end+r});(null==e||null==(i=e.recommendationResponse)?void 0:i.recommendations)&&(e.recommendationResponse.recommendations[n].phrases[o]=a),t.phraseDiff&&t.phraseDiff.length>0&&t.phraseDiff.forEach(function(t,i){var a,s,u,c,l,f,d=_n(bn({},t),{sourceStart:t.sourceStart+r,sourceEnd:t.sourceEnd+r,targetStart:t.targetStart+r,targetEnd:t.targetEnd+r});(null==e||null==(f=e.recommendationResponse)||null==(l=f.recommendations)||null==(c=l[n])||null==(u=c.phrases)||null==(s=u[o])||null==(a=s.phraseDiff)?void 0:a[i])&&(e.recommendationResponse.recommendations[n].phrases[o].phraseDiff[i]=d)})})})}),r=r+e.text.length+2}),n}},{key:"_convertSentenceIndexToParagraphRelative",value:function(e){if(1===e.length)return e[0].sentences.forEach(function(e){var t=e.text.trimEnd().length,n=e.start+t;e.end=n}),e[0].sentences[e[0].sentences.length-1].end=e[0].sentences[e[0].sentences.length-1].end+1,e;var t=[],n=0;return e.forEach(function(e){var r=e.sentences.length,o=e.sentences.map(function(e,t){var o,i=e.text.trimEnd().length,a=e.start+i;e.start=e.start+n,e.end=t===r-1?a+n+1:a+n;var s=null==(o=e.grammarResponse)?void 0:o.contentToReplace.map(function(e){return _n(bn({},e),{startIndex:e.startIndex+n,endIndex:e.endIndex+n})});return _n(bn({},e),{grammarResponse:_n(bn({},e.grammarResponse),{contentToReplace:s})})});n=n+e.text.length+2,t.push(_n(bn({},e),{sentences:o}))}),t}},{key:"handleWsFlow",value:function(e){return vn(function(){var t,n,r,i,a,s,u,c,l,f,d,h;return Rn(this,function(p){switch(p.label){case 0:if(t=e.input,n=e.metaData,i=(r=e.logInfo).startTime,a=r.editorId,s=e.handleResponseCallback,u=e.inputShouldCallRecommendation,c=e.quickFixEnabled,l=e.signal,!n)throw new o.CustomException(o.CustomErrors.PROCESSING_ERROR,"No metadata found");p.label=1;case 1:var g,v,m,y,b,_,S,C;return p.trys.push([1,4,,5]),g=t,v=u,m=this._isRecommendationEnabledForWsFlow,b=(y=v&&m)?o.ProcessingType.GC_WITH_RECOMMENDATION:o.ProcessingType.GC,b=g.appliedFixAll&&y?o.ProcessingType.RECOMMENDATION:b,f={shouldRunRecommendation:y,processingType:b,isFixApplied:g.hasUserAppliedFix||g.appliedFixAll},d={language:(S=(null==(_=t)?void 0:_.language)&&(null==_?void 0:_.language.split("-"))||[],C=function(e){if(Array.isArray(e))return e}(S)||function(e){var t,n,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o=[],i=!0,a=!1;try{for(r=r.call(e);!(i=(t=r.next()).done)&&(o.push(t.value),2!==o.length);i=!0);}catch(e){a=!0,n=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw n}}return o}}(S)||un(S,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],userPreferredDialect:C[1]},[4,this._createTransportObservables({input:t,metaData:n,processingConfig:f,languageConfig:d,quickFixEnabled:c,signal:l,handleResponseCallback:s})];case 2:return[4,new Ie(p.sent(),this._isContextManagementEnabled?cn(t,n):t.paragraphs,this._returnFromWs,i,a,f,this._transport.notifyClient,{hostUrl:n.hostUrl,language:d.language,editorGroupId:"editorGroupId-".concat(n.tabId)},t.responseType,t.paragraphs).handleGCResponse(s)];case 3:return[2,p.sent()];case 4:return h=p.sent(),[2,this._handleWsFlowError(h,t)];case 5:return[2]}})}).call(this)}},{key:"_createTransportObservables",value:function(e){return vn(function(){var t,n,r,i,a,s,u;return Rn(this,function(c){var l,f;return t=e.input,n=e.metaData,r=e.processingConfig,i=e.languageConfig,a=e.quickFixEnabled,s=e.signal,u=e.handleResponseCallback,this._isContextManagementEnabled?[2,function(e){var t=e.input,n=e.metaData,r=e.processingConfig,i=e.languageConfig,a=e.quickFixEnabled,s=e.handleResponseCallback,u=e.transport,c=e.signal,l=r.processingType,f=r.isFixApplied,d=i.language,h=i.userPreferredDialect;if(!n)throw Error("MetaData is required");var p=cn(t,n),g=u.contentChangeV2(an(on({editorId:n.instanceId,editorGroupId:"editorGroupId-".concat(n.tabId),product:o.QB_PRODUCT.GRAMMAR_CHECKER,processingType:l,editorCompleteText:t.editorCompleteText,changeType:f?o.ChangeType.ACCEPT_CHANGES:o.ChangeType.USER_CHANGE},f&&{acceptChangeType:t.acceptChangeType}),{changes:t.changedContent,processingChanges:p,hostUrl:n.hostUrl,hostCategory:n.hostCategory,meta:on(an(on({},null!==a&&{quickFixEnabled:a},d&&{language:d},h&&{userPreferredDialect:h}),{recommendationApiVersion:2}),s&&{handleResponseCallback:s}),writingSessionId:n.writingSessionId,editorCategory:"generic",signal:c})),v=Math.min(Math.max(200*t.paragraphs.length,3e4),12e4),m=ln(g,{editorId:n.instanceId,editorGroupId:"editorGroupId-".concat(n.tabId)},p,v);return{gcMergedObservable:m,recommendationMergedObservable:m}}({input:t,metaData:n,processingConfig:r,languageConfig:i,quickFixEnabled:a,handleResponseCallback:u,transport:this._transport,signal:s})]:[2,(l={input:t,metaData:n,processingConfig:r,languageConfig:i,quickFixEnabled:a,signal:s,transport:this._transport},(f=function(){var e,t,n,r,i,a,s,u,c,f,d,h;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(p){switch(p.label){case 0:if(e=l.input,t=l.metaData,r=l.languageConfig,i=l.quickFixEnabled,a=l.signal,s=l.transport,u=(n=l.processingConfig).processingType,c=n.isFixApplied,f=r.language,d=r.userPreferredDialect,!t)throw Error("MetaData is required");return h=Date.now().toString(),[4,s.updateEditorContent(an(on({editorId:t.instanceId,editorGroupId:"editorGroupId-".concat(t.tabId),editorContentVersion:h,product:o.QB_PRODUCT.GRAMMAR_CHECKER,changeType:c?o.ChangeType.ACCEPT_CHANGES:o.ChangeType.USER_CHANGE},c&&{acceptChangeType:e.acceptChangeType}),{editorCompleteText:e.editorCompleteText,changes:e.paragraphs.map(function(t){return on(an(on({},t),{processingType:u,changeSentenceLength:e.changedParagraphsSentencesLength}),e.hasUserAppliedFix&&{replacementText:null==e?void 0:e.replacementText})}),hostUrl:t.hostUrl,hostCategory:t.hostCategory,meta:an(on({},null!==i&&{quickFixEnabled:i},f&&{language:f},d&&{userPreferredDialect:d}),{recommendationApiVersion:2}),signal:a}))];case 1:return[2,p.sent()]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=f.apply(e,t);function i(e){rn(o,n,r,i,a,"next",e)}function a(e){rn(o,n,r,i,a,"throw",e)}i(void 0)})})())]})}).call(this)}},{key:"_handleWsFlowError",value:function(e,t){var n=e||{};if(r=o.MessageErrorCodes.LANGUAGE_NOT_SUPPORTED,n&&n.data&&n.data.errorCode===r||n&&n.details&&n.details.errorCode){var r,i,a,s=t.preferredVariants[0],u=null!=(a=null==n||null==(i=n.data)?void 0:i.language)?a:{},c=u.langCode,l=u.confidenceScore;return s||(s=this._getRegion(t.preferredVariants,c)),this.unsupportedLanguageResponse({language:c,region:s,confidence:l})}throw n}},{key:"_updateInputLanguage",value:function(e){return vn(function(){var t,n,o,i,a,s,u,c,l;return Rn(this,function(f){switch(f.label){case 0:return o=(n=Sn((null==(t=e.language)?void 0:t.split("-"))||[],2))[0],i=n[1],o&&i?[2,e]:(a=this._getRegion(e.preferredVariants,e.language||""),o&&!i&&a?[2,_n(bn({},e),{language:"".concat(o,"-").concat(a)})]:o&&!i&&!a||!(null==(s=(0,r.getConfig)("ON_DEVICE_LANGUAGE_CONFIG"))?void 0:s.enabled)?[2,e]:[4,(0,r.detectLanguage)(e.editorCompleteText.substring(0,1e3),{skipHttpRequest:!0})]);case 1:return(u=f.sent()).language?(l=(c=this._getRegion(e.preferredVariants,u.language||""))?"".concat(u.language,"-").concat(c):u.language,[2,_n(bn({},e),{language:l})]):[2,e]}})}).call(this)}},{key:"_createSentenceSplitterResponse",value:function(e,t,n){var r=E(t,n),o=R(t,n);return{sentenceRanges:e,extendedSentenceRanges:e.map(function(e){return{from:e[0],to:e[1],detectedLanguages:[{language:t,rate:0}]}}),language:{name:r,code:o,detectedLanguage:{confidence:1,name:r,source:"",code:o}},matches:[]}}},{key:"_processOnDeviceSentenceSplitting",value:function(e,t,n){return vn(function(){var o,i,a,s,u,c,l,f;return Rn(this,function(d){switch(d.label){case 0:if(i=[],a="failed",u=(s=Sn((null==t?void 0:t.split("-"))||["",""],2))[0],c=s[1],!(null==(o=(0,r.getConfig)("ON_DEVICE_SENTENCE_SPLITTER_CONFIG"))?void 0:o.enabled)||"en"!==(null==u?void 0:u.toLowerCase()))return[2,{onDeviceSentenceRanges:i,onDeviceProcessingStatus:a}];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this._onDeviceSentenceSplitter(e.paragraphsState,u)];case 2:return(i=d.sent()).length>0&&(l=this._createSentenceSplitterResponse(i,u,c),null==n||n(l,"sentence-splitter-response"),(0,r.notifyClient)({eventName:"ON_DEVICE_SENTENCE_SPLITTER_CALLBACK",data:{type:"sentence-splitter-response",onDeviceProcessed:!0,totalSentences:i.length}}),a="success"),[3,4];case 3:return f=d.sent(),a="failed",(0,r.notifyClient)({eventName:"ON_DEVICE_SENTENCE_SPLITTER_CALLBACK",data:{type:"sentence-splitter-response",onDeviceProcessed:!1,error:(null==f?void 0:f.message)||"Unknown error occurred"}}),[3,4];case 4:return[2,{onDeviceSentenceRanges:i,onDeviceProcessingStatus:a}]}})}).call(this)}},{key:"grammarCheck",value:function(e){return vn(function(){var t,n,r,i,a,s,u,c,l,f,d,h,p,g,v,m,y,b,_,S,C,E,I,w,O,x,P,k,D,A,M,L,j,G,F,N,U,W,q,z,H,B,Y,Q,K,$,J,X,Z,ee,te,ne,re;return Rn(this,function(oe){switch(oe.label){case 0:t=this,oe.label=1;case 1:return oe.trys.push([1,12,,13]),n=e.input,r=e.gcParams,i=e.handleResponseCallback,s=void 0===(a=e.signal)?null:a,u=e.metaData,c=this._preferredMode!==he.WS,l=(null==u?void 0:u.hostUrl)&&!(null==u?void 0:u.hostUrl).includes("docs.google.com"),f=this._preferredMode!==he.WS_WITH_NON_GDOCS,d=(c||l)&&f,h=Date.now(),p={},g=this.transformRequest(n.paragraphs).currTextState,(0,o.logTimeForAction)(o.LogActionPrefix.LT_QB_GC_ADAPTER,{startTime:h,type:"START",editorId:null==u?void 0:u.instanceId}),d&&this._preferredMode!==he.WS_WEBAPP||!u?[3,5]:[4,this._updateInputLanguage(n)];case 2:return v=oe.sent(),[4,this._processOnDeviceSentenceSplitting(g,v.language,i)];case 3:return y=(m=oe.sent()).onDeviceSentenceRanges,b=m.onDeviceProcessingStatus,_=function(e,t){("sentence-splitter-response"!==t||"success"!==b)&&(null==i||i(e,t))},[4,this.handleWsFlow({input:v,metaData:u,handleResponseCallback:_,inputShouldCallRecommendation:!n.disableRecommendations,quickFixEnabled:this._quickFixEnabled,logInfo:{startTime:h,editorId:null==u?void 0:u.instanceId},signal:s})];case 4:return S=oe.sent(),"success"===b&&(S.sentenceRanges=y,S.extendedSentenceRanges=y.map(function(e){var t,n;return{from:e[0],to:e[1],detectedLanguages:[{language:v.language||"",rate:0}],checkStatus:null==(n=S.extendedSentenceRanges)||null==(t=n[0])?void 0:t.checkStatus}})),[2,S||{}];case 5:return!d&&this._returnFromWs?[3,11]:[4,this._gcService.getIsPremium()];case 6:return I="true"===oe.sent(),w={"x-website-origin":T((null==u?void 0:u.hostUrl)||"")||"","x-website-url":(null==u?void 0:u.hostUrl)||"","platform-type":this._PLATFORM_TYPE,"platform-version":this._PLATFORM_VERSION},[4,this._detectLanguageIfNeeded(n.language,n.editorCompleteText,{signal:s,headers:w})];case 7:return x=(O=oe.sent()).language,P=O.confidence,k=this._getRegion(n.preferredVariants,n.language||x),this.isSupportedLanguage(x)?[4,this._gcService.setLanguage(x)]:[2,this.unsupportedLanguageResponse({language:x,region:k,confidence:P})];case 8:return oe.sent(),[4,this._gcService.setRegionalLanguage(k)];case 9:return oe.sent(),D=function(e){null==i||i(V.transform({paragraphState:[e],langData:{language:x,region:k,confidence:P},isPremium:I}),"grammar-check-response")},A=[],M=!1,L={cache:0,api:0},j=function(e){e.map(function(e){e._cached?L.cache++:e.text&&L.api++});var n=t._convertRecommendationSentenceIndexToParagraphRelative(e,g.paragraphsState),r=de.transform({paragraphState:n,langData:{language:x,region:k,confidence:P},isPremium:I});M?null==i||i(r,"recommendation-response"):A.push(r)},G=r?_n(bn({},r),{language:null==x?void 0:x.toUpperCase()}):{language:null==x?void 0:x.toUpperCase()},F=R(x,k),w["qb-dialect"]=F,N=bn({prevState:null,currentState:g,gcParams:G,header:w,hasUserAcceptedSuggestion:n.hasUserAppliedFix,changedParagraphsSentencesLength:n.changedParagraphsSentencesLength,shouldCallRecommendation:!n.disableRecommendations,appliedFixAll:n.appliedFixAll,writingGoal:n.writingGoal},null!==this._quickFixEnabled?{quickFixEnabled:this._quickFixEnabled}:{},s&&{signal:s}),U=function(e,n){var r=N.currentState;if(p[n]=Cn(e),r.paragraphsState.length===Object.keys(p).length){var o=r.paragraphsState.map(function(e,t){var n=function e(t){if(null===t||"object"!=(void 0===t?"undefined":t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t))return t;if(pe(t,Date))return new Date(t);if(pe(t,RegExp))return new RegExp(t);var n=Array.isArray(t)?[]:{};for(var r in t)n[r]=e(t[r]);return n}(p[t]||[]);return _n(bn({},e),{sentences:n,grammarResponse:{}})}),a=t._convertSentenceIndexToParagraphRelative(o),s=V.transform({paragraphState:a,langData:{language:x,region:k,confidence:P},isPremium:I});null==i||i(s,"sentence-splitter-response")}},[4,this._gcService.grammarCheck(N,D,j,U)];case 10:return q=(W=oe.sent().currentTextState.paragraphsState).map(function(e){return{totalSentences:e.sentences.length,totalGcErrors:null==e?void 0:e.sentenceTimeOutCount,errorCodes:[]}}),M=!0,z=this._convertSentenceIndexToParagraphRelative(W),H=V.transform({paragraphState:z,langData:{language:x,region:k,confidence:P},isPremium:I}),B=null==A?void 0:A.flatMap(function(e){return null==e?void 0:e.matches}),Y=Cn(new Set(A.flatMap(function(e){var t,n;return null==e||null==(n=e.metaData)||null==(t=n.textErrors)?void 0:t.recommendationModelId}))),Q=_n(bn({},H),{matches:Cn(H.matches).concat(Cn(B)),metaData:{textErrors:{errorModelId:null==H||null==(E=H.metaData)||null==(C=E.textErrors)?void 0:C.errorModelId,recommendationModelId:Y},errorInfo:q}}),this._reportGrammarAnalysisResults(W,B,H,L,e),(0,o.logTimeForAction)(o.LogActionPrefix.LT_QB_GC_ADAPTER,{type:"GC_COMPLETED",mode:"HTTP",startTime:h,currentTime:Date.now(),timeDiff:Date.now()-h,editorId:null==u?void 0:u.instanceId}),[2,Q];case 11:return[2,{}];case 12:var ie;if((null==($=e.signal)?void 0:$.aborted)||(null!=(ie=AbortSignal)&&"undefined"!=typeof Symbol&&ie[Symbol.hasInstance]?ie[Symbol.hasInstance](K):K instanceof ie))throw(Z=Error("AbortError")).reason="AbortError",Z;if(void 0===o.CustomErrors.TRANSPORT_NOT_INITIALIZED)throw null==(ee=(te=this._transport).trackEvent)||ee.call(te,{tracking:{eventName:o.TrackingEvents.TRANSPORT_ERROR,eventData:{category:o.errorCategory.TRANSPORT_NOT_INITIALIZED,errorOrigin:o.errorOrigin.QB_ADAPTER_GC}}}),K;if(ne=Object.entries({errorData:void 0,reason:void 0,message:void 0,name:void 0,stack:void 0,type:void 0}).reduce(function(e,t){var n=Sn(t,2),r=n[0],o=n[1];return void 0!==o&&(e[r]=o),e},{}),null==(J=(X=this._transport).trackEvent)||J.call(X,{tracking:{eventName:o.TrackingEvents.PROCESSING_ERROR,eventData:bn({errorOrigin:o.errorOrigin.QB_ADAPTER_GC},ne)},logger:{eventName:o.TrackingEvents.PROCESSING_ERROR,eventData:bn({errorOrigin:o.errorOrigin.QB_ADAPTER_GC},ne)}}),void 0===o.CustomErrors.PROCESSING_ERROR)throw K;throw(re=Error(o.CustomErrors.PROCESSING_ERROR)).reason=o.CustomErrors.PROCESSING_ERROR,re;case 13:return[2]}})}).call(this)}}],t=[{key:"getInstance",value:function(){return n._instance||(n._instance=new n),n._instance}}],e&&mn(n.prototype,e),t&&mn(n,t),n}();yn(In,"_instance",void 0),function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="010aeca7-5afc-5bf8-b741-84f37e26c541")}catch(e){}}()}}]);
//# sourceMappingURL=sourceMap/8896.js.map